# access

> Êú¨ÊñáÊ™îÂåÖÂê´ 513 ÂÄãÈ†ÅÈù¢ÁöÑÂÖßÂÆπ
> ÁîüÊàêÊôÇÈñì: 2025-09-08T06:50:29.413Z
> Áî¢ÂìÅÁ∑ö: üîê Zero Trust (Cloudflare One)

## üìë ÁõÆÈåÑ

1. [Cloudflare Zero Trust](#cloudflare-zero-trust)
2. [Get started](#get-started)
3. [Implementation guides](#implementation-guides)
4. [Identity](#identity)
5. [One-time PIN login](#one-time-pin-login)
6. [Device posture](#device-posture)
7. [WARP client checks](#warp-client-checks)
8. [Application check](#application-check)
9. [Carbon Black](#carbon-black)
10. [Client certificate](#client-certificate)
11. [Device serial numbers](#device-serial-numbers)
12. [Device UUID](#device-uuid)
13. [Disk encryption](#disk-encryption)
14. [Domain joined](#domain-joined)
15. [File check](#file-check)
16. [Firewall](#firewall)
17. [OS version](#os-version)
18. [Require Gateway](#require-gateway)
19. [Require WARP](#require-warp)
20. [SentinelOne](#sentinelone)
21. [Service providers](#service-providers)
22. [Custom device posture integration](#custom-device-posture-integration)
23. [CrowdStrike](#crowdstrike)
24. [Kolide](#kolide)
25. [Microsoft Endpoint Manager](#microsoft-endpoint-manager)
26. [SentinelOne](#sentinelone)
27. [Tanium](#tanium)
28. [Uptycs](#uptycs)
29. [Workspace ONE](#workspace-one)
30. [Access integrations](#access-integrations)
31. [Mutual TLS](#mutual-tls)
32. [Tanium (legacy)](#tanium-legacy)
33. [User management](#user-management)
34. [Session management](#session-management)
35. [Seat management](#seat-management)
36. [SCIM provisioning](#scim-provisioning)
37. [Service tokens](#service-tokens)
38. [Authorization cookie](#authorization-cookie)
39. [Validate JWTs](#validate-jwts)
40. [Application token](#application-token)
41. [CORS](#cors)
42. [SSO integration](#sso-integration)
43. [Generic OIDC](#generic-oidc)
44. [Generic SAML 2.0](#generic-saml-20)
45. [Active Directory (SAML)](#active-directory-saml)
46. [Amazon Cognito](#amazon-cognito)
47. [AWS IAM (SAML)](#aws-iam-saml)
48. [Centrify](#centrify)
49. [Centrify (SAML)](#centrify-saml)
50. [Citrix ADC (SAML)](#citrix-adc-saml)
51. [Facebook](#facebook)
52. [GitHub](#github)
53. [Google](#google)
54. [Google Workspace](#google-workspace)
55. [JumpCloud (SAML)](#jumpcloud-saml)
56. [Keycloak (SAML)](#keycloak-saml)
57. [LinkedIn](#linkedin)
58. [Microsoft Entra ID](#microsoft-entra-id)
59. [Okta](#okta)
60. [Okta (SAML)](#okta-saml)
61. [OneLogin](#onelogin)
62. [OneLogin (SAML)](#onelogin-saml)
63. [PingFederate](#pingfederate)
64. [PingOne](#pingone)
65. [PingOne (SAML)](#pingone-saml)
66. [Signed AuthN requests (SAML)](#signed-authn-requests-saml)
67. [Yandex](#yandex)
68. [Connections](#connections)
69. [Cloudflare Tunnel](#cloudflare-tunnel)
70. [Get started](#get-started)
71. [Create a tunnel (dashboard)](#create-a-tunnel-dashboard)
72. [Create a tunnel (API)](#create-a-tunnel-api)
73. [Useful terms](#useful-terms)
74. [Downloads](#downloads)
75. [Update cloudflared](#update-cloudflared)
76. [License](#license)
77. [Copyrights](#copyrights)
78. [Configure cloudflared parameters](#configure-cloudflared-parameters)
79. [Tunnel run parameters](#tunnel-run-parameters)
80. [Origin configuration parameters](#origin-configuration-parameters)
81. [Tunnel with firewall](#tunnel-with-firewall)
82. [Tunnel availability and failover](#tunnel-availability-and-failover)
83. [System requirements](#system-requirements)
84. [Tunnel permissions](#tunnel-permissions)
85. [Use cases](#use-cases)
86. [SSH](#ssh)
87. [SSH with Access for Infrastructure (recommended)](#ssh-with-access-for-infrastructure-recommended)
88. [Connect with self-managed SSH keys](#connect-with-self-managed-ssh-keys)
89. [Connect to SSH in the browser](#connect-to-ssh-in-the-browser)
90. [Connect to SSH with client-side cloudflared (legacy)](#connect-to-ssh-with-client-side-cloudflared-legacy)
91. [RDP](#rdp)
92. [Connect to RDP in a browser](#connect-to-rdp-in-a-browser)
93. [Connect to RDP using WARP](#connect-to-rdp-using-warp)
94. [Connect to RDP with client-side cloudflared](#connect-to-rdp-with-client-side-cloudflared)
95. [SMB](#smb)
96. [gRPC](#grpc)
97. [Environments](#environments)
98. [Ansible](#ansible)
99. [AWS](#aws)
100. [Azure](#azure)
101. [GCP](#gcp)
102. [Kubernetes](#kubernetes)
103. [Terraform](#terraform)
104. [Private networks](#private-networks)
105. [Connect private networks](#connect-private-networks)
106. [Private DNS](#private-dns)
107. [Virtual networks](#virtual-networks)
108. [Load balancing](#load-balancing)
109. [Peer-to-peer connectivity](#peer-to-peer-connectivity)
110. [WARP Connector](#warp-connector)
111. [Connect private network to Internet](#connect-private-network-to-internet)
112. [Connect two or more private networks](#connect-two-or-more-private-networks)
113. [Connect private network to WARP clients](#connect-private-network-to-warp-clients)
114. [Tips for VPC deployments](#tips-for-vpc-deployments)
115. [Public hostnames](#public-hostnames)
116. [DNS records](#dns-records)
117. [Load balancing](#load-balancing)
118. [Monitor tunnels](#monitor-tunnels)
119. [Log streams](#log-streams)
120. [Notifications](#notifications)
121. [Metrics](#metrics)
122. [Troubleshoot tunnels](#troubleshoot-tunnels)
123. [Tunnel diagnostic logs](#tunnel-diagnostic-logs)
124. [Private network connectivity](#private-network-connectivity)
125. [Common errors](#common-errors)
126. [Do more with Tunnel](#do-more-with-tunnel)
127. [Locally-managed tunnels](#locally-managed-tunnels)
128. [Create a locally-managed tunnel](#create-a-locally-managed-tunnel)
129. [Configuration file](#configuration-file)
130. [Run as a service](#run-as-a-service)
131. [Linux](#linux)
132. [macOS](#macos)
133. [Windows](#windows)
134. [Useful commands](#useful-commands)
135. [Tunnel permissions](#tunnel-permissions)
136. [Useful terms](#useful-terms)
137. [Migrate legacy tunnels](#migrate-legacy-tunnels)
138. [Quick Tunnels](#quick-tunnels)
139. [Connect devices](#connect-devices)
140. [WARP](#warp)
141. [Download WARP stable releases](#download-warp-stable-releases)
142. [Download WARP beta releases](#download-warp-beta-releases)
143. [Update WARP](#update-warp)
144. [Migrate 1.1.1.1 app](#migrate-1111-app)
145. [First-time setup](#first-time-setup)
146. [Deploy WARP](#deploy-warp)
147. [Managed deployment](#managed-deployment)
148. [Partners](#partners)
149. [Fleet](#fleet)
150. [Hexnode](#hexnode)
151. [Intune](#intune)
152. [Jamf](#jamf)
153. [JumpCloud](#jumpcloud)
154. [Kandji](#kandji)
155. [Parameters](#parameters)
156. [Connect WARP before Windows login](#connect-warp-before-windows-login)
157. [Multiple users on a Windows device](#multiple-users-on-a-windows-device)
158. [Switch between Zero Trust organizations](#switch-between-zero-trust-organizations)
159. [Manual deployment](#manual-deployment)
160. [Device enrollment permissions](#device-enrollment-permissions)
161. [WARP with firewall](#warp-with-firewall)
162. [WARP with legacy VPN](#warp-with-legacy-vpn)
163. [Configure WARP](#configure-warp)
164. [Device profiles](#device-profiles)
165. [WARP modes](#warp-modes)
166. [Enable Device Information Only](#enable-device-information-only)
167. [WARP settings](#warp-settings)
168. [Captive portal detection](#captive-portal-detection)
169. [Managed networks](#managed-networks)
170. [Route traffic](#route-traffic)
171. [Local Domain Fallback](#local-domain-fallback)
172. [Split Tunnels](#split-tunnels)
173. [WARP architecture](#warp-architecture)
174. [WARP sessions](#warp-sessions)
175. [Troubleshoot WARP](#troubleshoot-warp)
176. [WARP troubleshooting guide](#warp-troubleshooting-guide)
177. [Common issues](#common-issues)
178. [Client errors](#client-errors)
179. [WARP diagnostic logs](#warp-diagnostic-logs)
180. [Known limitations](#known-limitations)
181. [Connectivity status](#connectivity-status)
182. [Remove WARP](#remove-warp)
183. [Agentless options](#agentless-options)
184. [Locations](#locations)
185. [DNS resolver IPs and hostnames](#dns-resolver-ips-and-hostnames)
186. [DNS over TLS (DoT)](#dns-over-tls-dot)
187. [DNS over HTTPS (DoH)](#dns-over-https-doh)
188. [PAC files](#pac-files)
189. [User-side certificates](#user-side-certificates)
190. [Install certificate using WARP](#install-certificate-using-warp)
191. [Install certificate manually](#install-certificate-manually)
192. [Deploy custom certificate](#deploy-custom-certificate)
193. [Applications](#applications)
194. [Add web applications](#add-web-applications)
195. [SaaS applications](#saas-applications)
196. [Generic OIDC application](#generic-oidc-application)
197. [Generic SAML application](#generic-saml-application)
198. [Adobe Acrobat Sign](#adobe-acrobat-sign)
199. [Area 1](#area-1)
200. [Asana](#asana)
201. [Atlassian Cloud](#atlassian-cloud)
202. [AWS](#aws)
203. [Braintree](#braintree)
204. [Coupa](#coupa)
205. [Digicert](#digicert)
206. [DocuSign](#docusign)
207. [Dropbox](#dropbox)
208. [GitHub Enterprise Cloud](#github-enterprise-cloud)
209. [Google Cloud](#google-cloud)
210. [Google Workspace](#google-workspace)
211. [Grafana](#grafana)
212. [Grafana Cloud](#grafana-cloud)
213. [Greenhouse Recruiting](#greenhouse-recruiting)
214. [Hubspot](#hubspot)
215. [Ironclad](#ironclad)
216. [Jamf Pro](#jamf-pro)
217. [Miro](#miro)
218. [PagerDuty](#pagerduty)
219. [Pingboard](#pingboard)
220. [Salesforce (OIDC)](#salesforce-oidc)
221. [Salesforce (SAML)](#salesforce-saml)
222. [ServiceNow (OIDC)](#servicenow-oidc)
223. [ServiceNow (SAML)](#servicenow-saml)
224. [Slack](#slack)
225. [Smartsheet](#smartsheet)
226. [SparkPost](#sparkpost)
227. [Tableau Cloud](#tableau-cloud)
228. [Workday](#workday)
229. [Zendesk](#zendesk)
230. [Zoom](#zoom)
231. [Publish a self-hosted application to the Internet](#publish-a-self-hosted-application-to-the-internet)
232. [MCP server portals](#mcp-server-portals)
233. [Secure MCP servers with Access for SaaS](#secure-mcp-servers-with-access-for-saas)
234. [Authenticate MCP server to self-hosted apps](#authenticate-mcp-server-to-self-hosted-apps)
235. [Cloudflare dashboard SSO application](#cloudflare-dashboard-sso-application)
236. [Non-HTTP applications](#non-http-applications)
237. [Add an infrastructure application](#add-an-infrastructure-application)
238. [Secure a private IP or hostname](#secure-a-private-ip-or-hostname)
239. [Browser-rendered terminal](#browser-rendered-terminal)
240. [Client-side cloudflared](#client-side-cloudflared)
241. [Enable automatic cloudflared authentication](#enable-automatic-cloudflared-authentication)
242. [Arbitrary TCP](#arbitrary-tcp)
243. [Private network applications (legacy)](#private-network-applications-legacy)
244. [Short-lived certificates (legacy)](#short-lived-certificates-legacy)
245. [Cloud Access Security Broker](#cloud-access-security-broker)
246. [Manage findings](#manage-findings)
247. [Available integrations](#available-integrations)
248. [Amazon Web Services (AWS) S3](#amazon-web-services-aws-s3)
249. [Anthropic](#anthropic)
250. [Atlassian Confluence](#atlassian-confluence)
251. [Atlassian Jira](#atlassian-jira)
252. [Bitbucket Cloud](#bitbucket-cloud)
253. [Box](#box)
254. [Dropbox](#dropbox)
255. [GitHub](#github)
256. [Google Cloud Platform (GCP) Cloud Storage](#google-cloud-platform-gcp-cloud-storage)
257. [Google Workspace](#google-workspace)
258. [Gmail](#gmail)
259. [Google Admin](#google-admin)
260. [Google Calendar](#google-calendar)
261. [Google Drive](#google-drive)
262. [Gmail (FedRAMP)](#gmail-fedramp)
263. [Google Admin (FedRAMP)](#google-admin-fedramp)
264. [Google Calendar (FedRAMP)](#google-calendar-fedramp)
265. [Google Drive (FedRAMP)](#google-drive-fedramp)
266. [Gemini for Google Workspace](#gemini-for-google-workspace)
267. [Microsoft 365](#microsoft-365)
268. [Admin Center](#admin-center)
269. [OneDrive](#onedrive)
270. [Outlook](#outlook)
271. [SharePoint](#sharepoint)
272. [Admin Center (FedRAMP)](#admin-center-fedramp)
273. [OneDrive (FedRAMP)](#onedrive-fedramp)
274. [Outlook (FedRAMP)](#outlook-fedramp)
275. [SharePoint (FedRAMP)](#sharepoint-fedramp)
276. [OpenAI](#openai)
277. [Salesforce](#salesforce)
278. [Salesforce (FedRAMP)](#salesforce-fedramp)
279. [ServiceNow](#servicenow)
280. [ServiceNow (FedRAMP)](#servicenow-fedramp)
281. [Slack](#slack)
282. [Scan for sensitive data](#scan-for-sensitive-data)
283. [Troubleshoot integrations](#troubleshoot-integrations)
284. [Troubleshoot compute accounts](#troubleshoot-compute-accounts)
285. [Application Library](#application-library)
286. [Login page](#login-page)
287. [Block page](#block-page)
288. [Add bookmarks](#add-bookmarks)
289. [App Launcher](#app-launcher)
290. [Policies](#policies)
291. [Secure Web Gateway](#secure-web-gateway)
292. [DNS filtering](#dns-filtering)
293. [Network filtering](#network-filtering)
294. [HTTP filtering](#http-filtering)
295. [DNS policies](#dns-policies)
296. [Common policies](#common-policies)
297. [Test DNS filtering](#test-dns-filtering)
298. [Timed DNS policies](#timed-dns-policies)
299. [Network policies](#network-policies)
300. [Common policies](#common-policies)
301. [Protocol detection](#protocol-detection)
302. [SSH proxy and command logs (legacy)](#ssh-proxy-and-command-logs-legacy)
303. [HTTP policies](#http-policies)
304. [Common policies](#common-policies)
305. [TLS decryption](#tls-decryption)
306. [HTTP/3 inspection](#http3-inspection)
307. [Tenant control](#tenant-control)
308. [AV scanning](#av-scanning)
309. [File sandboxing](#file-sandboxing)
310. [Egress policies](#egress-policies)
311. [Dedicated egress IPs](#dedicated-egress-ips)
312. [Resolver policies](#resolver-policies)
313. [Identity-based policies](#identity-based-policies)
314. [Global policies](#global-policies)
315. [Applications and app types](#applications-and-app-types)
316. [Domain categories](#domain-categories)
317. [Order of enforcement](#order-of-enforcement)
318. [Proxy](#proxy)
319. [Lists](#lists)
320. [Block page](#block-page)
321. [Managed service providers (MSPs)](#managed-service-providers-msps)
322. [Access](#access)
323. [Manage Access policies](#manage-access-policies)
324. [Rule groups](#rule-groups)
325. [Require purpose justification](#require-purpose-justification)
326. [External Evaluation rules](#external-evaluation-rules)
327. [Isolate self-hosted application](#isolate-self-hosted-application)
328. [Application paths](#application-paths)
329. [Enforce MFA](#enforce-mfa)
330. [Temporary authentication](#temporary-authentication)
331. [Browser Isolation](#browser-isolation)
332. [Set up Browser Isolation](#set-up-browser-isolation)
333. [Clientless Web Isolation](#clientless-web-isolation)
334. [Non-identity on-ramps](#non-identity-on-ramps)
335. [Isolation policies](#isolation-policies)
336. [Extensions](#extensions)
337. [Accessibility](#accessibility)
338. [Browser Isolation with firewall](#browser-isolation-with-firewall)
339. [Known limitations](#known-limitations)
340. [Data Loss Prevention](#data-loss-prevention)
341. [Scan HTTP traffic](#scan-http-traffic)
342. [Common policies](#common-policies)
343. [Logging options](#logging-options)
344. [DLP profiles](#dlp-profiles)
345. [Predefined profiles](#predefined-profiles)
346. [Integration profiles](#integration-profiles)
347. [Profile settings](#profile-settings)
348. [Detection entries](#detection-entries)
349. [Analytics overview](#analytics-overview)
350. [Access event analytics](#access-event-analytics)
351. [Gateway analytics](#gateway-analytics)
352. [Shadow IT SaaS analytics](#shadow-it-saas-analytics)
353. [DEX](#dex)
354. [Monitoring](#monitoring)
355. [Tests](#tests)
356. [HTTP test](#http-test)
357. [Traceroute test](#traceroute-test)
358. [View test results](#view-test-results)
359. [Rules](#rules)
360. [Remote captures](#remote-captures)
361. [Notifications](#notifications)
362. [IP visibility](#ip-visibility)
363. [DEX MCP Server](#dex-mcp-server)
364. [Logs](#logs)
365. [User logs](#user-logs)
366. [Access audit logs](#access-audit-logs)
367. [Gateway activity logs](#gateway-activity-logs)
368. [Manage PII](#manage-pii)
369. [SCIM activity logs](#scim-activity-logs)
370. [Tunnel audit logs](#tunnel-audit-logs)
371. [Posture logs](#posture-logs)
372. [Logpush integration](#logpush-integration)
373. [Enable Email Security logs](#enable-email-security-logs)
374. [Risk score](#risk-score)
375. [Email Security](#email-security)
376. [Retro Scan](#retro-scan)
377. [Before you begin](#before-you-begin)
378. [API deployment](#api-deployment)
379. [Set up with Microsoft 365](#set-up-with-microsoft-365)
380. [Overview](#overview)
381. [Enable Gmail BCC integration](#enable-gmail-bcc-integration)
382. [Connect your domains](#connect-your-domains)
383. [Add BCC rules](#add-bcc-rules)
384. [Enable auto-moves](#enable-auto-moves)
385. [Microsoft Exchange BCC setup](#microsoft-exchange-bcc-setup)
386. [Microsoft 365 journaling setup](#microsoft-365-journaling-setup)
387. [Manually add domains](#manually-add-domains)
388. [Microsoft 365 as MX Record](#microsoft-365-as-mx-record)
389. [1 - Junk email and Email Security Admin Quarantine](#1-junk-email-and-email-security-admin-quarantine)
390. [2 - Junk email and user managed quarantine](#2-junk-email-and-user-managed-quarantine)
391. [3 - Junk email and administrative quarantine](#3-junk-email-and-administrative-quarantine)
392. [4 - User managed quarantine and administrative quarantine](#4-user-managed-quarantine-and-administrative-quarantine)
393. [5 - Junk email folder and administrative quarantine](#5-junk-email-folder-and-administrative-quarantine)
394. [Google Workspace as MX Record](#google-workspace-as-mx-record)
395. [Cisco - Email Security as MX Record](#cisco-email-security-as-mx-record)
396. [Cisco - Cisco as MX Record](#cisco-cisco-as-mx-record)
397. [MX/Inline deployment](#mxinline-deployment)
398. [Set up MX/Inline deployment](#set-up-mxinline-deployment)
399. [Egress IPs](#egress-ips)
400. [Partner domain TLS](#partner-domain-tls)
401. [Manage domains](#manage-domains)
402. [Email monitoring](#email-monitoring)
403. [Search email](#search-email)
404. [Download disposition report](#download-disposition-report)
405. [Directories](#directories)
406. [Manage groups in your directory](#manage-groups-in-your-directory)
407. [Manage users in your directory](#manage-users-in-your-directory)
408. [Manage Email Security directories](#manage-email-security-directories)
409. [Allow policies](#allow-policies)
410. [Blocked senders](#blocked-senders)
411. [Trusted domains](#trusted-domains)
412. [Impersonation registry](#impersonation-registry)
413. [Additional detections](#additional-detections)
414. [Configure link actions](#configure-link-actions)
415. [Configure text add-ons](#configure-text-add-ons)
416. [Auto-move events](#auto-move-events)
417. [Phish submissions](#phish-submissions)
418. [Outbound Data Loss Prevention (DLP)](#outbound-data-loss-prevention-dlp)
419. [PhishGuard](#phishguard)
420. [How Email Security detects phish](#how-email-security-detects-phish)
421. [Information about your domain](#information-about-your-domain)
422. [Dispositions and attributes](#dispositions-and-attributes)
423. [API and Terraform](#api-and-terraform)
424. [Access API examples](#access-api-examples)
425. [Any valid service token](#any-valid-service-token)
426. [Authentication method](#authentication-method)
427. [Common name](#common-name)
428. [Country Code](#country-code)
429. [Email](#email)
430. [Email domain](#email-domain)
431. [Everyone](#everyone)
432. [G Suite Group](#g-suite-group)
433. [GitHub‚Ñ¢ Organization](#github-organization)
434. [IP range](#ip-range)
435. [Microsoft Entra Group](#microsoft-entra-group)
436. [mTLS certificate](#mtls-certificate)
437. [Okta Group](#okta-group)
438. [Rule group](#rule-group)
439. [SAML Attribute](#saml-attribute)
440. [Service token](#service-token)
441. [Terraform](#terraform)
442. [Tutorials](#tutorials)
443. [Videos](#videos)
444. [Account limits](#account-limits)
445. [Roles and permissions](#roles-and-permissions)
446. [Glossary](#glossary)
447. [FAQ](#faq)
448. [Device UUID](#device-uuid)
449. [Use Microsoft Entra ID Conditional Access policies in Cloudflare Access](#use-microsoft-entra-id-conditional-access-policies-in-cloudflare-access)
450. [Seat management](#seat-management)
451. [Validate JWTs](#validate-jwts)
452. [Configure a tunnel](#configure-a-tunnel)
453. [Tunnels FAQ](#tunnels-faq)
454. [Connect through Cloudflare Access using kubectl](#connect-through-cloudflare-access-using-kubectl)
455. [Monitor Cloudflare Tunnel with Grafana](#monitor-cloudflare-tunnel-with-grafana)
456. [Troubleshooting](#troubleshooting)
457. [WARP modes](#warp-modes)
458. [Êú™Áü•Ê®ôÈ°å](#)
459. [Êú™Áü•Ê®ôÈ°å](#)
460. [Êú™Áü•Ê®ôÈ°å](#)
461. [Êú™Áü•Ê®ôÈ°å](#)
462. [WARP with firewall](#warp-with-firewall)
463. [DNS](#dns)
464. [Glossary](#glossary)
465. [Êú™Áü•Ê®ôÈ°å](#)
466. [MCP servers](#mcp-servers)
467. [Connect through Cloudflare Access using a CLI](#connect-through-cloudflare-access-using-a-cli)
468. [Google Cloud Platform (GCP) Cloud Storage](#google-cloud-platform-gcp-cloud-storage)
469. [Troubleshoot integrations](#troubleshoot-integrations)
470. [Get started](#get-started)
471. [Common policies](#common-policies)
472. [Common policies](#common-policies)
473. [Common policies](#common-policies)
474. [Êú™Áü•Ê®ôÈ°å](#)
475. [Insights](#insights)
476. [Analytics overview](#analytics-overview)
477. [Monitoring](#monitoring)
478. [Device posture](#device-posture)
479. [Post-delivery deployment](#post-delivery-deployment)
480. [Pre-delivery deployment](#pre-delivery-deployment)
481. [BCC/Journaling](#bccjournaling)
482. [BCC setup](#bcc-setup)
483. [Gmail BCC setup](#gmail-bcc-setup)
484. [Journaling setup](#journaling-setup)
485. [Prerequisites](#prerequisites)
486. [Use cases](#use-cases)
487. [Detection settings](#detection-settings)
488. [Manage integrated directories](#manage-integrated-directories)
489. [Reference](#reference)
490. [Create and secure an AI agent wrapper using AI Gateway and Zero Trust](#create-and-secure-an-ai-agent-wrapper-using-ai-gateway-and-zero-trust)
491. [Use Cloudflare Tunnels with Kubernetes client-go plugin](#use-cloudflare-tunnels-with-kubernetes-client-go-plugin)
492. [Send SSO attributes to Access-protected origins with Workers](#send-sso-attributes-to-access-protected-origins-with-workers)
493. [Use virtual networks to change user egress IPs](#use-virtual-networks-to-change-user-egress-ips)
494. [Access and secure a MySQL database using Cloudflare Tunnel and network policies](#access-and-secure-a-mysql-database-using-cloudflare-tunnel-and-network-policies)
495. [Access a web application via its private hostname without WARP](#access-a-web-application-via-its-private-hostname-without-warp)
496. [Protect access to Microsoft 365 with dedicated egress IPs](#protect-access-to-microsoft-365-with-dedicated-egress-ips)
497. [Use Cloudflare R2 as a Zero Trust log destination](#use-cloudflare-r2-as-a-zero-trust-log-destination)
498. [Create custom headers for Cloudflare Access-protected origins with Workers](#create-custom-headers-for-cloudflare-access-protected-origins-with-workers)
499. [Protect access to Amazon S3 buckets with Cloudflare Zero Trust](#protect-access-to-amazon-s3-buckets-with-cloudflare-zero-trust)
500. [Validate the Access token with FastAPI](#validate-the-access-token-with-fastapi)
501. [Isolate risky Entra ID users](#isolate-risky-entra-id-users)
502. [Render a VNC client in browser](#render-a-vnc-client-in-browser)
503. [Integrate Microsoft MCAS with Cloudflare Zero Trust](#integrate-microsoft-mcas-with-cloudflare-zero-trust)
504. [Migrate to Named Tunnels with Load Balancer](#migrate-to-named-tunnels-with-load-balancer)
505. [MongoDB SSH](#mongodb-ssh)
506. [Zero Trust GitLab SSH & HTTP](#zero-trust-gitlab-ssh-http)
507. [Require U2F with Okta](#require-u2f-with-okta)
508. [Getting started with Cloudflare Zero Trust FAQ](#getting-started-with-cloudflare-zero-trust-faq)
509. [General](#general)
510. [Identity FAQ](#identity-faq)
511. [Policies FAQ](#policies-faq)
512. [Devices FAQ](#devices-faq)
513. [Cloudflare Tunnel](#cloudflare-tunnel)

---

## Cloudflare Zero Trust

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/](https://developers.cloudflare.com/cloudflare-one/)

Page options # Cloudflare Zero Trust

Secure your organization with Cloudflare Zero Trust ‚Äî a cloud security model that replaces legacy perimeters with Cloudflare‚Äôs global network.

Available on all plans Cloudflare Zero Trust is part of Cloudflare One, our name for the Secure Access Service Edge (SASE) platform that protects enterprise applications, users, devices, and networks.

By progressively adopting Cloudflare One, organizations can move away from a patchwork of hardware appliances and point solutions, and instead consolidate security and networking through a unified control plane that includes products like Cloudflare Access, Secure Web Gateway (SWG), Cloudflare Tunnel, Data Loss Prevention (DLP), Remote Browser Isolation (RBI), Cloud Access Security Broker (CASB), and Email Security.

Refer to our SASE reference architecture to learn how to plan, deploy, and manage SASE architecture with Cloudflare.

Get started

Zero Trust dashboard

Implementation guides

## Products

Access Authenticate users accessing your applications, seamlessly onboard third-party users, and log every event and request.

Cloudflare Tunnel Securely connect your resources to Cloudflare without exposing a public IP by using Cloudflare Tunnel, which establishes outbound-only connections from your infrastructure to Cloudflare‚Äôs global network via the lightweight cloudflared daemon.

Secure Web Gateway (SWG) Inspect and filter DNS, network, HTTP, and egress traffic to enforce your company's Acceptable Use Policy (UAP), block risky sites with custom blocklists and threat intelligence, and enhance visibility and protection across SaaS applications.

WARP Protect corporate devices by privately sending traffic from those devices to Cloudflare's global network, build device posture rules, and enforce security policies anywhere.

Browser Isolation (RBI) Mitigate the impact of attacks by executing all browser code in the cloud and securely browse high-risk or sensitive websites in a remote browser.

Cloud Access Security Broker (CASB) Protect users and sensitive data at rest in SaaS applications and cloud environments, scan for misconfigurations, and detect insider threats as well as unsanctioned application usage to prevent data leaks and compliance violations.

Data Loss Prevention (DLP) Scan your web traffic and SaaS applications for the presence of sensitive data such as social security numbers, financial information, secret keys, and source code.

Email Security Configure policies to manage your inbox, automatically move emails based on disposition, and use screen criteria to investigate messages.

Digital Experience Monitoring (DEX) Monitor device, network, and application performance across your Zero Trust organization.

## More resources

SASE video series

New to Zero Trust and SASE? Get started with our introductory SASE video
series.

Reference architecture

Explore our reference architecture to learn how to evolve your network and
security architecture to Cloudflare One, our SASE platform.

Plans

Cloudflare Zero Trust offers both Free and Paid plans. Access to certain
features depends on a customer's plan type.

Limits

Learn about account limits. These limits may be increased on Enterprise accounts.

Support

Find answers to common questions or open a ticket with Cloudflare Support.

Community

Ask questions, get answers, and share tips.

Note

Enterprise customers can preview this product as a non-contract service, which provides full access, free of metered usage fees, limits, and certain other restrictions.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Get started

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/setup/](https://developers.cloudflare.com/cloudflare-one/setup/)

Page options # Get started

This guide covers the recommended steps to start securing your users and devices with Cloudflare Zero Trust.

Note

To get started with a specific use case, refer to our implementation guides.

## Prerequisites

Sign up for a Cloudflare account ‚Üó.

## Create a Zero Trust organization

1. In the Cloudflare dashboard ‚Üó, select Zero Trust.
  Go to Zero Trust
2. On the onboarding screen, choose a team name. The team name is a unique, internal identifier for your Zero Trust organization. Users will enter this team name when they enroll their device manually, and it will be the subdomain for your App Launcher (as relevant). Your business name is the typical entry.
3. Complete your onboarding by selecting a subscription plan and entering your payment details. If you chose the Zero Trust Free plan, this step is still needed but you will not be charged.

Welcome to Cloudflare Zero Trust! You can now explore a list of one-click actions we have designed to help you kickstart your Zero Trust experience.

## Install the WARP client on your devices

If you want to enable security features such as Browser Isolation, HTTP filtering, AV scanning, and device posture, or connect networks to Cloudflare, here are the next steps you need to take:

1. Set up a login method. Configure One-time PIN or connect a third-party identity provider in Zero Trust. This is the login method your users will utilize when authenticating to add a new device to your Zero Trust setup.
2. Next, define device enrollment permissions. Create device enrollment rules to define which users in your organization should be able to connect devices to your organization's Zero Trust setup. As you create your rule, you will be asked to select which login method you would like users to authenticate with.
3. Install the Cloudflare root certificate on your devices. Advanced security features including HTTP traffic inspection require users to install and trust the Cloudflare root certificate on their machine or device. If you are installing certificates manually on all your devices, these steps will need to be performed on each new device that is to be subject to HTTP filtering.
4. Download and deploy the WARP client to your devices. Choose one of the different ways to deploy the WARP client, depending on what works best for your organization.
5. Log in to your organization's Cloudflare Zero Trust instance from your devices. On your device, go to the Settings section in the WARP client and insert your organization's team name.

Your devices are now connected to Cloudflare Zero Trust through the WARP client. You can go to My Team > Devices to find a list of your enrolled devices, when they were last seen, and the WARP client version they are running.

Next, enforce security policies on your traffic and access requests.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Implementation guides

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/implementation-guides/](https://developers.cloudflare.com/cloudflare-one/implementation-guides/)

Page options # Implementation guides

Implementation guides cover deployment steps and best practices for specific Cloudflare One use cases.

Secure your Internet Traffic and SaaS apps

Provide your users and networks with a secure, performant, and flexible path
to the Internet.

Replace your VPN

Give users secure, auditable network and application access.

Deploy clientless access

Secure access to internal web applications without a device client.

Secure Microsoft 365 email with Email Security

Use Cloudflare's Email Security to protect your Microsoft 365 email inbox from
phishing and malware attacks.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Identity

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/](https://developers.cloudflare.com/cloudflare-one/identity/)

Page options # Identity

Cloudflare Zero Trust integrates with your organization's identity provider to apply Zero Trust and Secure Web Gateway policies. If you work with partners, contractors, or other organizations, you can integrate multiple identity providers simultaneously.

As an alternative to configuring an identity provider, Cloudflare Zero Trust can send a one-time PIN (OTP) to approved email addresses. No configuration needed ‚Äî simply add a user's email address to an Access policy and to the group that allows your team to reach the application.

You can simultaneously configure an OTP and an identity provider to allow users to use their own authentication method.

Additionally, Cloudflare Zero Trust can integrate with endpoint protection providers to check requests for device posture. This allows you to configure security policies that rely on additional signals from endpoint security providers to allow or deny connections to your applications.

- One-time PIN login
- Device posture
- User management
- Service tokens
- Authorization cookie
- SSO integration

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## One-time PIN login

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/one-time-pin/](https://developers.cloudflare.com/cloudflare-one/identity/one-time-pin/)

Page options # One-time PIN login

Cloudflare Access can send a one-time PIN (OTP) to approved email addresses as an alternative to integrating an identity provider. You can simultaneously configure OTP login and the identity provider of your choice to allow users to select their own authentication method.

For example, if your team uses Okta but you are collaborating with someone outside your organization, you can use OTP to grant access to guests.

Note

Access and WARP will evaluate identity based on a user's last-known state. If a user authenticates via your Identity Provider, but later authenticates with a different method (such as One-Time PIN), Access will no longer evaluate the user's Identity Provider group memberships. Identity Provider group memberships are created and managed by the IdP and group membership data can only persist in an IdP-based authentication.

## Set up OTP

- Dashboard
- API
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Select One-time PIN.

Make a POST request to the Identity Providers endpoint:

Required API token permissions

At least one of the following token permissions is required: - Access: Organizations, Identity Providers, and Groups Write

Add an Access identity provider ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/identity_providers" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "One-time PIN login",    "type": "onetimepin",    "config": {}  }'
```

1. Add the following permission to your cloudflare_api_token ‚Üó:

Access: Organizations, Identity Providers, and Groups Write
2. Access: Organizations, Identity Providers, and Groups Write
3. Configure the cloudflare_zero_trust_access_identity_provider ‚Üó resource:
resource "cloudflare_zero_trust_access_identity_provider" "onetimepin_login" {  account_id = var.cloudflare_account_id  name       = "One-time PIN login"  type       = "onetimepin"  config      = {}}

Tip

If your organization uses a third-party email scanning service (for example, Mimecast or Barracuda), add noreply@notify.cloudflare.com to the email scanning allowlist.

To grant a user access to an application, simply add their email address to an Access policy.

## Log in with OTP

To log in to Access using the one-time PIN:

1. Go to the application protected by Access.
2. On the Access login page, enter your email address and select Send me a code.
3. If the email is allowed by an Access policy, you will receive a PIN in your inbox. This secure PIN expires 10 minutes after the initial request.

Note

By design, blocked users will not receive an email. The login page will always say A code has been emailed to you, regardless of whether or not an email was sent.

1. Paste the PIN into the Access login page and select Sign in.


If the code was valid, you will be redirected to the application.
If the code was invalid, you will see That account does not have access.
2. If the code was valid, you will be redirected to the application.
3. If the code was invalid, you will see That account does not have access.

Note

Access only logs an authentication attempt after the user enters a code. If the user enters their email but never submits a code, the event will not appear in your audit logs.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Device posture

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/](https://developers.cloudflare.com/cloudflare-one/identity/devices/)

Page options # Device posture

With Cloudflare Zero Trust, you can configure Zero Trust policies that rely on additional signals from the WARP client or from third-party endpoint security providers. When device posture checks are configured, users can only connect to a protected application or network resource if they have a managed or healthy device.

## 1. Enable device posture checks

Setup instructions and requirements vary depending on the device posture attribute. Refer to the links below to view the setup guide for your provider.

- WARP client checks are performed by the Cloudflare WARP client.
- Service-to-service checks are performed by third-party device posture providers.
- Access integration checks are only configurable for Access applications. These attributes cannot be used in Gateway policies.

## 2. Verify device posture checks

Before integrating a device posture check in a Gateway or Access policy, verify that the Pass/Fail results match your expectations. To view the latest test results for a specific device:

1. In Zero Trust ‚Üó, go to My Team > Devices.
2. Select the device.
3. Select View details.
4. Select the Posture checks tab.

## 3. Build a device posture policy

You can now use your device posture check in an Access policy or a Gateway network or HTTP policy. In Access, the enabled device posture attributes will appear in the list of available selectors. In Gateway, the attributes will appear when you choose the Passed Device Posture Check selector.

Gateway policy limitation

Gateway does not support device posture checks for the Tanium Access integration.

## 4. Ensure traffic is going through WARP

WARP client and service-to-service posture checks rely on traffic going through WARP to detect posture information for a device. In your Split Tunnel configuration, ensure that the following domains are included in WARP:

- The IdP used to authenticate to Cloudflare Zero Trust if posture check is part of an Access policy.
- <your-team-name>.cloudflareaccess.com if posture check is part of an Access policy.
- The application protected by the Access or Gateway policy.

## Policy enforcement rate

Access detects changes in device posture at the same rate as the polling frequency configured for the posture check.

Because Gateway evaluates network and HTTP policies on every request, it maintains a local cache of posture results that is only updated every five minutes. Therefore, Gateway policies are subject to an additional five-minute delay. For example, if you set your polling frequency to 10 minutes, it may take up to 15 minutes for Gateway to detect posture changes on a device.

```
flowchart LR
accTitle: Device posture policy enforcement
A[Device] --schedule--> B[WARP client]--> C((Cloudflare)) --> D[Access policy]
C --5 min--> E[Cache] --> F[Gateway policy]
A --> G[Service provider] --interval--> C
```

Warning

Gateway does not terminate an active session even if a subsequent posture check fails during that session. Gateway only evaluates posture checks at the beginning of a session, and ongoing sessions will remain uninterrupted.

For example, if you establish an SSH session based on a successful posture check, but a posture requirement fails after the session has started, the session will remain active.

### Expiration

By default, the posture result on Cloudflare remains valid until it is overwritten by new data. You can specify an expiration time using our API. We recommend setting the expiration to be longer than the polling frequency.

### Polling frequency

#### WARP client checks

By default, the WARP client polls the device for status changes every five minutes. To modify the polling frequency, use the API to update the schedule parameter.

#### Service provider checks

When setting up a service-to-service integration, you will choose a polling frequency to determine how often Cloudflare will query the third-party API. To set the polling frequency via the API, use the interval parameter.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## WARP client checks

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/)

Page options # WARP client checks

These device posture checks are performed by the Cloudflare WARP client. To use this feature, you must deploy the WARP client to your devices and enable the desired posture checks.

## Supported WARP modes

- Gateway with WARP
- Secure Web Gateway without DNS filtering
- Device Information Only

## Supported operating systems

| Device posture check | macOS | Windows | Linux | iOS | Android/ChromeOS |
| --- | --- | --- | --- | --- | --- |
| Application check | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Carbon Black | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Client certificate | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Device serial numbers | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Device UUID | ‚ùå | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| Disk encryption | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Domain joined | ‚ùå | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| File check | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Firewall | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| OS version | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| Require Gateway | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| Require WARP | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| SentinelOne | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Application check

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/application-check/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/application-check/)

Page options # Application check

The Application Check device posture attribute checks that a specific application process is running on a device. You can create multiple application checks for each operating system you need to run it on, or if you need to check for multiple applications.

## Prerequisites

- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## Configure an application check

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to WARP client checks and select Add new.
3. Select Application Check.
4. You will be prompted for the following information:

Name: Enter a unique name for this device posture check.
Operating system: Select your operating system.
Application path: Enter the file path for the executable that will be running (for example, C:\Program Files\myfolder\myfile.exe).

Note
Be sure to enter the binary file path, not the application launch path. When checking for an application on macOS, a common mistake is to enter /Applications/ApplicationName.app. This will not work as ApplicationName.app is a folder. The executable file that will be running is located within the folder, for example ApplicationName.app/Contents/MacOS/ApplicationName.
Some applications change their file path after an update. Ensure that the application is always in a stable location, or use an environment variable to identify a specific folder. For example, Windows provides recognized environment variables ‚Üó that you can reference in your file path (%PROGRAMFILES%\myfolder\myfile.exe).
5. Name: Enter a unique name for this device posture check.
6. Operating system: Select your operating system.
7. Application path: Enter the file path for the executable that will be running (for example, C:\Program Files\myfolder\myfile.exe).
8. Be sure to enter the binary file path, not the application launch path. When checking for an application on macOS, a common mistake is to enter /Applications/ApplicationName.app. This will not work as ApplicationName.app is a folder. The executable file that will be running is located within the folder, for example ApplicationName.app/Contents/MacOS/ApplicationName.
9. Some applications change their file path after an update. Ensure that the application is always in a stable location, or use an environment variable to identify a specific folder. For example, Windows provides recognized environment variables ‚Üó that you can reference in your file path (%PROGRAMFILES%\myfolder\myfile.exe).
10. Signing certificate thumbprint (recommended): Enter the thumbprint of the publishing certificate used to sign the binary. Adding this information will enable the check to ensure that the application was signed by the expected software developer.
11. SHA-256 (optional): Enter the SHA-256 value of the binary. This is used to ensure the integrity of the binary file on the device.
12. Select Save.

Next, go to Logs > Posture and verify that the application check is returning the expected results.

## Determine the signing thumbprint

The process to determine the signing thumbprint of an application varies depending on the operating system. This is how you would look up the signing thumbprint of the Cloudflare WARP application on macOS and Windows.

Note

When setting up new device posture checks, we recommend first testing them without setting certificate thumbprint or SHA256 checksum values.

### macOS

1. Create a directory.
Terminal window~/Desktop $ mkdir tmp
~/Desktop $ cd tmp
2. Run the following command to extract certificates for the WARP application:
Terminal window~/Desktop/tmp $ codesign -d --extract-certificates "/Applications/Cloudflare WARP.app/Contents/Resources/CloudflareWARP"Executable=/Applications/Cloudflare WARP.app/Contents/Resources/CloudflareWARP
3. Next, run the following command to extract the SHA1 thumbprint:
Terminal window~/Desktop/tmp $ openssl x509 -inform DER -in codesign0 -fingerprint -sha1 -noout | tr -d :SHA1 Fingerprint=FE2C359D79D4CEAE6BDF7EFB507326C6B4E2436E

### Windows

1. Open a PowerShell window.
2. Use the Get-AuthenticodeSignature command to find the thumbprint. For example:
PowerShellGet-AuthenticodeSignature -FilePath c:\myfile.exe

## Determine the SHA-256 value

The SHA-256 value almost always changes between versions of a file/application.

### macOS

1. Open a Terminal window.
2. Use the shasum command to find the SHA256 value of the file. For example:
Terminal windowshasum -a 256 myfile

### Windows

1. Open a PowerShell window.
2. Use the get-filehash command to find the SHA256 value of the file. For example:
PowerShellget-filehash -path "C:\myfile.exe" -Algorithm SHA256 | format-list

## How WARP checks for an application

Learn how the WARP client determines if an application is running on various systems.

### macOS

To get the list of active processes, run the following command:

Terminal window ```
ps -eo comm | xargs which | sort | uniq | xargs realpath
```

The application path must appear in the output for the check to pass.

### Linux

The WARP client gets the list of running binaries by following the soft links in /proc/<pid>/exe. To view all active processes and their soft links:

Terminal window ```
ps -eo pid | awk '{print "/proc/"$1"/exe"}' | xargs readlink -f | awk '{print $1}' | sort | uniq
```

The application path must appear in the /proc/<pid>/exe output for the check to pass.

### Windows

To get the list of active processes, run the following command:

PowerShell ```
Get-Process | Select-Object ProcessName, Path | Format-Table -AutoSize
```

The application path must appear in the output for the check to pass.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Carbon Black

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/carbon-black/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/carbon-black/)

Page options # Carbon Black

Cloudflare Zero Trust can check if Carbon Black ‚Üó is running on a device to determine if a request should be allowed to reach a protected resource.

## Prerequisites

- Carbon Black agent is deployed on the device.
- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## Configure the Carbon Black check

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to WARP client checks and select Add new.
3. Select Carbon Black.
4. You will be prompted for the following information:

Name: Enter a unique name for this device posture check.
Operating system: Select your operating system. You will need to configure one posture check per operating system (macOS and Windows currently supported).
Application Path: Enter the full path to the Carbon Black process to be checked (for example, c:\program files\CarbonBlack\CarbonBlack.exe).
Signing certificate thumbprint (recommended): Enter the thumbprint of the publishing certificate used to sign the binary. This proves the binary came from Carbon Black and is the recommended way to validate the process.
SHA-256 (optional): Enter a SHA-256 value. This is used to validate the SHA256 signature of the binary and ensures the integrity of the binary file on the device. Note: do not fill out this field unless you strictly control updates to Carbon Black, as this will change between versions.
5. Name: Enter a unique name for this device posture check.
6. Operating system: Select your operating system. You will need to configure one posture check per operating system (macOS and Windows currently supported).
7. Application Path: Enter the full path to the Carbon Black process to be checked (for example, c:\program files\CarbonBlack\CarbonBlack.exe).
8. Signing certificate thumbprint (recommended): Enter the thumbprint of the publishing certificate used to sign the binary. This proves the binary came from Carbon Black and is the recommended way to validate the process.
9. SHA-256 (optional): Enter a SHA-256 value. This is used to validate the SHA256 signature of the binary and ensures the integrity of the binary file on the device. Note: do not fill out this field unless you strictly control updates to Carbon Black, as this will change between versions.

Next, go to Logs > Posture and verify that the Carbon Black check is returning the expected results.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Client certificate

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/client-certificate/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/client-certificate/)

Page options # Client certificate

The Client Certificate device posture attribute checks if the device has a valid client certificate signed by a trusted certificate. The trusted certificate is uploaded to Cloudflare and specified as part of the posture check rule. The client certificate posture check can be used in Gateway and Access policies to ensure that the user is connecting from a managed device.

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| All modes | All plans |

| System | Availability | Minimum WARP version1 |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.6.415.0 |
| macOS | ‚úÖ | 2024.6.416.0 |
| Linux | ‚úÖ | 2024.6.497.0 |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

1 Client certificate checks that ran on an earlier WARP version will continue to work. To configure a new certificate check, update WARP to the versions listed above.

## Prerequisites

- A CA that issues client certificates for your devices. WARP does not evaluate the certificate trust chain; this needs to be the issuing certificate.
Upload the signing certificate that issued the client certificateWhen uploading a certificate to use in posture checks, Cloudflare does not differentiate between root and intermediate certificates. You must upload the actual signing certificate ‚Äì the one that directly signed the client certificate.If you upload a different certificate, even if it exists higher up in the trust chain (for example, the root that issued the signing certificate), the posture check will fail.
- Cloudflare WARP client is deployed on the device.
- A client certificate is installed and trusted on the device.

Note

To generate a sample root CA for testing, refer to Generate mTLS certificates.

## Configure the client certificate check

1. Use the Upload mTLS certificate endpoint to upload the certificate and private key to Cloudflare. The certificate must be a signing certificate, formatted as a single string with \n replacing the line breaks. The private key is only required if you are using this custom certificate for Gateway HTTPS inspection.
 Required API token permissions
 
At least one of the following token permissions 
is required:
Account: SSL and Certificates Write Upload mTLS certificatecurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/mtls_certificates" \  --request POST \  --header "X-Auth-Email: $CLOUDFLARE_EMAIL" \  --header "X-Auth-Key: $CLOUDFLARE_API_KEY" \  --json '{    "name": "example_ca_cert",    "certificates": "-----BEGIN CERTIFICATE-----\nXXXXX\n-----END CERTIFICATE-----",    "private_key": "-----BEGIN PRIVATE KEY-----\nXXXXX\n-----END PRIVATE KEY-----",    "ca": true  }'
The response will return a UUID for the certificate. For example:
{  "success": true,  "errors": [],  "messages": [],  "result": {    "id": "2458ce5a-0c35-4c7f-82c7-8e9487d3ff60",    "name": "example_ca_cert",    "issuer": "O=Example Inc.,L=California,ST=San Francisco,C=US",    "signature": "SHA256WithRSA",    ...  }}
2. Account: SSL and Certificates Write
3. In Zero Trust ‚Üó, go to Settings > WARP Client.
4. Scroll down to WARP client checks and select Add new.
5. Select Client certificate.
6. You will be prompted for the following information:


Name: Enter a unique name for this device posture check.


Operating system: Select your operating system.


OS locations: Specify the location(s) where the client certificate is installed.
 Windows
 
Local machine trust store - User trust store
 
 macOS
 
System keychain
 
 Linux
 
NSSDB (/etc/pki/nssdb) - To search a custom location, enter the
absolute file path(s) to the certificate and private key (for example
/usr/local/mycompany/certs/client.pem and
/usr/local/mycompany/certs/client_key.pem). The certificate and
private key must be in PEM format. They can either be in two different
files or the same file.
 


Certificate ID: Enter the UUID of the signing certificate.


Common name: (Optional) To check for a Common Name (CN) on the client certificate, enter a string with optional ${serial_number} and ${hostname} variables (for example, ${serial_number}_mycompany). WARP will search for an exact, case-insensitive match. If you do not specify a common name, WARP will ignore the common name field on the certificate.


Check for Extended Key Usage: (Optional) Check whether the client certificate has one or more attributes set. Supported values are Client authentication (1.3.6.1.5.5.7.3.2) and/or Email (1.3.6.1.5.5.7.3.4).


Check for private key: (Recommended) When enabled, WARP checks that the device has a private key associated with the client certificate.


Subject Alternative Name: (Optional) To check for a Subject Alternative Name (SAN) on the client certificate, enter a string with optional ${serial_number} and ${hostname} variables (for example, ${serial_number}_mycompany). WARP will search for an exact, case-insensitive match. You can add multiple SANs to the posture check ‚Äî a certificate only needs to match one SAN for the check to pass.
7. Name: Enter a unique name for this device posture check.
8. Operating system: Select your operating system.
9. OS locations: Specify the location(s) where the client certificate is installed.
 Windows
 
Local machine trust store - User trust store
 
 macOS
 
System keychain
 
 Linux
 
NSSDB (/etc/pki/nssdb) - To search a custom location, enter the
absolute file path(s) to the certificate and private key (for example
/usr/local/mycompany/certs/client.pem and
/usr/local/mycompany/certs/client_key.pem). The certificate and
private key must be in PEM format. They can either be in two different
files or the same file.
10. Local machine trust store - User trust store
11. System keychain
12. NSSDB (/etc/pki/nssdb) - To search a custom location, enter the
absolute file path(s) to the certificate and private key (for example
/usr/local/mycompany/certs/client.pem and
/usr/local/mycompany/certs/client_key.pem). The certificate and
private key must be in PEM format. They can either be in two different
files or the same file.
13. Certificate ID: Enter the UUID of the signing certificate.
14. Common name: (Optional) To check for a Common Name (CN) on the client certificate, enter a string with optional ${serial_number} and ${hostname} variables (for example, ${serial_number}_mycompany). WARP will search for an exact, case-insensitive match. If you do not specify a common name, WARP will ignore the common name field on the certificate.
15. Check for Extended Key Usage: (Optional) Check whether the client certificate has one or more attributes set. Supported values are Client authentication (1.3.6.1.5.5.7.3.2) and/or Email (1.3.6.1.5.5.7.3.4).
16. Check for private key: (Recommended) When enabled, WARP checks that the device has a private key associated with the client certificate.
17. Subject Alternative Name: (Optional) To check for a Subject Alternative Name (SAN) on the client certificate, enter a string with optional ${serial_number} and ${hostname} variables (for example, ${serial_number}_mycompany). WARP will search for an exact, case-insensitive match. You can add multiple SANs to the posture check ‚Äî a certificate only needs to match one SAN for the check to pass.
18. Select Save.

Next, go to Logs > Posture and verify that the client certificate check is returning the expected results.

## Troubleshooting

You can use the following commands to check if a client certificate is properly installed and trusted on the device.

- Windows
- macOS
- Linux

1. Open a PowerShell window.
2. To search the local machine trust store for a certificate with a specific common name, run the following command:

PowerShell ```
Get-ChildItem Cert:\LocalMachine\My\ | where{$_.Subject -like "*<COMMON_NAME>*"}
```

1. To search the user trust store for a certificate with a specific common name, run the following command:

PowerShell ```
Get-ChildItem Cert:\CurrentUser\My\ | where{$_.Subject -like "*<COMMON_NAME>*"}
```

1. Open Terminal.
2. To search System Keychain for a certificate with a specific common name, run the following command:

Terminal window ```
/usr/bin/security find-certificate -c "<COMMON_NAME>" -p /Library/Keychains/System.keychain
```

1. Open Terminal.
2. To list all client certificates in NSSDB, run the following command:

Terminal window ```
certutil -L -d /etc/pki/nssdb
```

```
Certificate Nickname                                         Trust Attributes                                                             SSL,S/MIME,JAR/XPI
meow                                                         CTu,Cu,CunoPrivateKey                                                 CT,,
```

1. Open your desired certificate using its certificate nickname. The common name will appear in the line Subject: "CN=123456.mycompany".

Terminal window ```
certutil -L -d /etc/pki/nssdb -n meow
```

```
Certificate:    Data:        Version: 3 (0x2)        Serial Number: 236 (0xec)        Signature Algorithm: PKCS #1 SHA-256 With RSA Encryption        Issuer: "CN=123456.mycompany"        Validity:            Not Before: Tue Jul 02 17:20:40 2024            Not After : Sun Jul 02 17:20:40 2034        Subject: "CN=123456.mycompany"        Subject Public Key Info:            Public Key Algorithm: PKCS #1 RSA Encryption            RSA Public Key:                Modulus:                    <redacted>                Exponent: 65537 (0x10001)    Signature Algorithm: PKCS #1 SHA-256 With RSA Encryption    Signature:        <redacted>    Fingerprint (SHA-256):        <redacted>    Fingerprint (SHA1):        <redacted>
    Mozilla-CA-Policy: false (attribute missing)    Certificate Trust Flags:        SSL Flags:            Valid CA            Trusted CA            User            Trusted Client CA        Email Flags:            Valid CA            Trusted CA            User        Object Signing Flags:            Valid CA            Trusted CA            User
```

For the posture check to pass, a certificate must appear in the output that validates against the uploaded signing certificate.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Device serial numbers

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/corp-device/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/corp-device/)

Page options # Device serial numbers

Cloudflare Zero Trust allows you to build Zero Trust rules based on device serial numbers. You can create these rules so that access to applications is granted only to users connecting from company devices.

## Prerequisites

- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## Create a list of serial numbers

To create rules based on device serial numbers, you first need to create a Gateway List of numbers.

1. In Zero Trust ‚Üó, go to My Team > Lists.
2. Select Create manual list or Upload CSV. For larger teams, we recommend uploading a CSV or using Cloudflare's API endpoint.
3. Give your list a descriptive name, as this name will appear when configuring your policies.
4. Set List Type to Serial numbers.
5. Enter the serial numbers of the devices your team manages, or upload your CSV file.
6. Select Save.

You can now create an Access policy or a Gateway network policy that checks if the device presents a serial number on your list. In Access, the serial number check will appear as a Device Posture - Serial Number List selector. In Gateway, your serial number list will appear in the Value dropdown when you choose the Passed Device Posture Check selector.

## Validate the serial number

You can use the following commands to check the serial number of your device. The results can help you validate if the posture check is working as expected.

### macOS

1. Open a terminal window.
2. Use the system_profiler command to check for the value of SPHardwareDataType and retrieve the serial number.
Terminal windowsystem_profiler SPHardwareDataType | grep 'Serial Number'

### Windows

1. Open a PowerShell window.
2. Use the Get-CimInstance command to get the SerialNumber property of the Win32_BIOS class.
PowerShellGet-CimInstance Win32_BIOS

### Linux

1. Open a Terminal Window
2. Use the dmidecode command to get the version property system-serial-number.
Terminal windowsudo dmidecode -s system-serial-number

### iOS, Android and ChromeOS

Serial number checks are not supported on mobile devices. You can identify mobile devices by a unique client ID instead of by serial number.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Device UUID

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/device-uuid/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/device-uuid/)

Page options # Device UUID

Cloudflare Zero Trust allows you to build Zero Trust rules based on device UUIDs supplied in an MDM file. You can create these rules so that access to applications is granted only to users connecting from company devices.

## Prerequisites

- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## 1. Assign UUIDs to devices

You will need to use a managed deployment tool to assign UUIDs. It is not possible to assign them manually.

1. Generate a unique identifier for each corporate device. For best practices on choosing UUIDs, refer to the Android documentation ‚Üó.
2. Enter the UUIDs into your MDM configuration file using the unique_client_id key.

## 2. Create a list of UUIDs

To create rules based on device UUIDs, you first need to create a Gateway List of UUIDs.

1. In Zero Trust ‚Üó, go to My Team > Lists.
2. Select Create manual list or Upload CSV. For larger teams, we recommend uploading a CSV or using Cloudflare's API endpoint.
3. Give your list a descriptive name, as this name will appear when configuring your policies.
4. Set List Type to Device IDs.
5. Enter the UUIDs of the devices your team manages, or upload your CSV file.
6. Select Save.

Note

Hyphens are automatically stripped from UUIDs. For example, the posture check will match 123e4567-e89b-12d3-a456-426614174000 to 123e4567e89b12d3a456426614174000.

## 3. Enable the posture check

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to WARP client checks and select Add new.
3. Select Unique Client ID.
4. You will be prompted for the following information:

Name: Enter a unique name for this device posture check.
Operating system: Select the operating system of the device.
List: Select your list of UUIDs.
5. Name: Enter a unique name for this device posture check.
6. Operating system: Select the operating system of the device.
7. List: Select your list of UUIDs.
8. Select Save.
9. Verify that the posture check is returning the expected results.

You can now create an Access or Gateway device posture policy that checks if the device presents a UUID on your list.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Disk encryption

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/disk-encryption/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/disk-encryption/)

Page options # Disk encryption

The Disk Encryption device posture attribute ensures that disks are encrypted on a device.

## Prerequisites

- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## Enable the disk encryption check

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to WARP client checks and select Add new.
3. Select Disk Encryption.
4. Enter a descriptive name for the check.
5. Select your operating system.
6. Either enable disk encryption for all volumes, or input the specific volume(s) you want to check for encryption (for example, C).
7. Select Save.

Next, go to Logs > Posture and verify that the disk encryption check is returning the expected results.

## Validate disk encryption status

The following commands will return the disk encryption status on various operating systems. The results can help you validate if the posture check is working as expected.

### macOS

1. Open a terminal window.
2. Run the /usr/sbin/system_profiler SPStorageDataType command to return a list of drivers on the system and note the value of Mount Point.
Terminal window/usr/sbin/system_profiler SPStorageDataType
Storage:
   Data:
     Free: 428.52 GB (428,519,702,528 bytes)     Capacity: 494.38 GB (494,384,795,648 bytes)     Mount Point: /System/Volumes/Data
3. Run the diskutil info command for a specific Mount Point and look for the value returned for FileVault. It must show Yes for the disk to be considered encrypted.
Terminal windowdiskutil info /System/Volumes/Data | grep FileVault
 FileVault:                 Yes

### Windows

1. Open a PowerShell window.
2. Run the Get-BitLockerVolume command to list all volumes detected on the system.
3. Protection Status must be set to On for the disk to be considered encrypted.

### Linux

List all hard drives on the system:

Terminal window ```
lsblk
```

```
NAME                        MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINTnvme0n1                     259:0    0 476.9G  0 disk‚îú‚îÄnvme0n1p1                 259:1    0   512M  0 part  /boot/efi‚îú‚îÄnvme0n1p2                 259:2    0   488M  0 part  /boot‚îî‚îÄnvme0n1p3                 259:3    0   476G  0 part  ‚îî‚îÄnvme0n1p3_crypt         253:0    0 475.9G  0 crypt    ‚îú‚îÄmy--vg-root   253:1            0 474.9G  0 lvm   /    ‚îî‚îÄmy--vg-swap_1 253:2            0   976M  0 lvm   [SWAP]
```

On Linux, encryption is reported per mounted partition, not physical drive. In the example above, the root and swap partitions are considered encrypted because they are located within a crypt container. The /boot and /boot/efi partitions remain unencrypted.

### iOS, Android and ChromeOS

These platforms are always encrypted and so no disk encryption check is supported.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Domain joined

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/domain-joined/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/domain-joined/)

Page options # Domain joined

The Domain Joined device posture attribute ensures that a user is a member of a specific Windows Active Directory domain.

## Prerequisites

- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## Enable the Domain Joined check

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to WARP client checks and select Add new.
3. Select Domain Joined.
4. Enter a descriptive name for the check.
5. Select your operating system.
6. Enter the domain you want to check for, such as example.com.
NoteThe Domain field is case-sensitive. If your domain is example.com, entering Example.com will fail the posture check.
7. Select Save.

Next, go to Logs > Posture and verify that the Domain Joined check is returning the expected results.

## Validate the domain value

To check the domain value on your Windows device:

1. Open a PowerShell window.
2. Run the following command:
PowerShell(Get-WmiObject Win32_ComputerSystem).Domain

The command will return the Active Directory domain to which your device belongs.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## File check

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/file-check/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/file-check/)

Page options # File check

The File Check device posture attribute checks for the presence of a file on a device. You can create multiple file checks for each operating system you need to run it on, or if you need to check for multiple files.

## Prerequisites

- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## Configure a file check

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to WARP client checks and select Add new.
3. Select File Check.
4. You will be prompted for the following information:

Name: Enter a unique name for this device posture check.
Operating system: Select your operating system.
File Path: Enter a file path (for example, c:\my folder\myfile.exe).
Signing certificate thumbprint (recommended): Enter the thumbprint of the publishing certificate used to sign the file. Adding this information will enable the check to ensure that the file was signed by the expected software developer.
SHA-256 (optional): Enter the SHA-256 value of the file. This is used to ensure the integrity of the file on the device.
5. Name: Enter a unique name for this device posture check.
6. Operating system: Select your operating system.
7. File Path: Enter a file path (for example, c:\my folder\myfile.exe).
8. Signing certificate thumbprint (recommended): Enter the thumbprint of the publishing certificate used to sign the file. Adding this information will enable the check to ensure that the file was signed by the expected software developer.
9. SHA-256 (optional): Enter the SHA-256 value of the file. This is used to ensure the integrity of the file on the device.
10. Select Save.

Next, go to Logs > Posture and verify that the file check is returning the expected results.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Firewall

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/firewall/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/firewall/)

Page options # Firewall

The Firewall device posture attribute ensures that a firewall is running on a device.

## Prerequisites

- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## Enable the firewall check

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to WARP client checks and select Add new.
3. Select Firewall.
4. Enter a descriptive name for the check.
5. Select your operating system.
6. Turn on Enable firewall check.
7. Select Save.

Next, go to Logs > Posture and verify that the firewall check is returning the expected results.

## How WARP checks the firewall status

Operating systems determine firewall configuration in various ways. Follow the steps below to understand how the WARP client determines if the firewall is enabled.

### On macOS

macOS has two firewalls: an application-based firewall and a port-based firewall. The WARP client will report a firewall is enabled if either firewall is running.

#### Application-based firewall

1. Open System Settings and go to Network.
2. Verify that Firewall is Active.

#### Port-based firewall

1. Open Terminal and run:
Terminal windowsudo /sbin/pfctl -s info
2. Verify that Status is Enabled.

### On Windows

1. Open PowerShell and run:
PowerShellGet-NetFirewallProfile -PolicyStore ActiveStore -Name Public
2. Verify that Enabled is True.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## OS version

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/os-version/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/os-version/)

Page options # OS version

The OS Version device posture attribute checks whether the version of a device's operating system matches, is greater than or lesser than the configured value.

## Prerequisites

- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## Enable the OS version check

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to WARP client checks and select Add new.
3. Select OS version.
4. Configure the Operating system, Operator, and Version fields to specify the OS version you want devices to match.
NoteThe OS version must be specified as a valid Semver ‚Üó. For example, if your device is running OS version 1.2, you must enter 1.2.0.
5. (Optional) Configure additional OS-specific fields:
      macOS     iOS     Linux      
Version extra: Enter the macOS Rapid Security Response (RSR) ‚Üó version you want devices to match (for example, (a)). Be sure to include the parenthesis around the letter.
  
Version extra: Enter the iOS Rapid Security Response (RSR) ‚Üó version you want devices to match (for example, (a)). Be sure to include the parenthesis around the letter.
  

Distro name and Distro revision: Enter the Linux distribution you want devices to match (for example, ubuntu 22.04). The distro version always matches with an equal-to operator (==) regardless of the Operator setting.


Version extra: Enter the patch version of the kernel. For example, if the kernel is 6.50.0-1007-oem, enter 1007.
6. macOS
7. iOS
8. Linux
9. Version extra: Enter the macOS Rapid Security Response (RSR) ‚Üó version you want devices to match (for example, (a)). Be sure to include the parenthesis around the letter.
10. Version extra: Enter the iOS Rapid Security Response (RSR) ‚Üó version you want devices to match (for example, (a)). Be sure to include the parenthesis around the letter.
11. Distro name and Distro revision: Enter the Linux distribution you want devices to match (for example, ubuntu 22.04). The distro version always matches with an equal-to operator (==) regardless of the Operator setting.
12. Version extra: Enter the patch version of the kernel. For example, if the kernel is 6.50.0-1007-oem, enter 1007.
13. Select Save.

Next, go to Logs > Posture and verify that the OS version check is returning the expected results.

## Determine the OS version

Operating systems display version numbers in different ways. This section covers how to retrieve the version number in each OS, in a format matching what the OS version posture check expects.

### macOS

1. Open a terminal window.
2. Use the defaults command to check for the value of SystemVersionStampAsString.
Terminal windowdefaults read loginwindow SystemVersionStampAsString

### Windows

1. Open a PowerShell window.
2. Use the Get-CimInstance command to get the version property of the Win32_OperatingSystem class.
Terminal window(Get-CimInstance Win32_OperatingSystem).version

### Linux

#### OS version

The Linux OS version check reads the system kernel version.

1. Open a Terminal window.
2. Run the uname -r command to get the complete kernel version. For example,
Terminal window$ uname -r5.14.0-25.el9.x86_64
3. Version is the first three numbers of the output in SemVer format (5.14.0).
4. Version extra is the first number after the SemVer (25).

#### Distro version

The WARP client reads Distro name and Distro revision from the /etc/os-release file. The name comes from the ID field, and the revision comes from the VERSION_ID field.

To determine the Linux distro version on your device:

1. Open a Terminal window.
2. Get the OS identification fields that contain ID:
Terminal windowcat /etc/os-release | grep "ID"
3. If the output of the above command contained ID=ubuntu and VERSION_ID=22.04, Distro name would be ubuntu and Distro revision would be 22.04. The WARP client will check these strings for an exact match.

### ChromeOS

ChromeOS version numbers consist of four parts ‚Üó: MAJOR.MINOR.BUILD.PATCH. The OS version posture check returns MAJOR.MINOR.BUILD.

To determine the ChromeOS version on your device:

1. Open Chrome browser and go to chrome://system.
2. Find the following values:





















PropertyOS version componentCHROMEOS_RELEASE_CHROME_MILESTONEMAJORCHROMEOS_RELEASE_BUILD_NUMBERMINORCHROMEOS_RELEASE_BRANCH_NUMBERBUILD
3. The OS version in Semver format is MAJOR.MINOR.BUILD (for example, 103.14816.131).

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Require Gateway

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/require-gateway/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/require-gateway/)

Page options # Require Gateway

With Require Gateway, you can allow access to your applications only to devices enrolled in your Zero Trust organization. Unlike Require WARP, which will check for any WARP instance (including the consumer version), Require Gateway will only allow requests coming from devices whose traffic is filtered by your organization's Cloudflare Gateway configuration. This policy is best used when you want to protect company-owned assets by only allowing access to employees.

## Prerequisites

- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## 1. Enable the Gateway check

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. In WARP client checks, select Add new.
3. Select Gateway, then select Save.

## 2. Add the check to an Access application

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Locate the application for which you want to require Gateway. Select Configure.
3. In the Policies tab, create a new Access policy or edit an existing policy.
4. In the policy builder, add an Include or Require rule which uses the Gateway selector. Save the policy.
5. Save the Access application.

Before granting access to the application, the policy will check that the device is running the WARP client and enrolled in your Zero Trust organization.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Require WARP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/require-warp/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/require-warp/)

Page options # Require WARP

Note

This device posture attribute will check for all versions of WARP, including the consumer version.

Cloudflare Zero Trust enables you to restrict access to your applications to devices running the Cloudflare WARP client. This allows you to flexibly ensure that a user's traffic is secure and encrypted before allowing access to a resource protected behind Cloudflare Zero Trust.

## Prerequisites

- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## 1. Enable the WARP check

1. In Zero Trust ‚Üó, go to Settings > Network.
2. Ensure that Proxy is enabled.
3. Go to Settings > WARP Client.
4. In WARP client checks, select Add new.
5. Select WARP, then select Save.

## 2. Add the check to an Access policy

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Locate the application for which you want to require WARP. Select Configure.
3. In the Policies tab, create a new Access policy or edit an existing policy.
4. In the policy builder, add an Include or Require rule which uses the WARP selector. Save the policy.
5. Save the Access application.

Before granting access to the application, the policy will check that the device is running the WARP client.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SentinelOne

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/sentinel-one/](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/sentinel-one/)

Page options # SentinelOne

Cloudflare Zero Trust can check if SentinelOne ‚Üó is running on a device to determine if a request should be allowed to reach a protected resource.

## Prerequisites

- SentinelOne agent is deployed on the device.
- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## Configure the SentinelOne check

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to WARP client checks and select Add new.
3. Select SentinelOne.
4. You will be prompted for the following information:


Name: Enter a unique name for this device posture check.


Operating system: Select your operating system. You will need to configure one posture check per operating system.


Application Path: Enter the full path to the SentinelOne process to be checked (for example, C:\Program Files\SentinelOne\Sentinel Agent 21.7.4.1043\SentinelAgent.exe).
NoteThe path of the SentinelOne process may change between updates. Make sure to edit Application Path to match the new path, or use %PATH% variables.


Signing certificate thumbprint (recommended): Enter the thumbprint of the publishing certificate used to sign the binary. This proves the binary came from SentinelOne and is the recommended way to validate the process.


SHA-256 (optional): Enter a SHA-256 value. This is used to validate the SHA256 signature of the binary and ensures the integrity of the binary file on the device. Note: do not fill out this field unless you strictly control updates to SentinelOne, as this will change between versions.
5. Name: Enter a unique name for this device posture check.
6. Operating system: Select your operating system. You will need to configure one posture check per operating system.
7. Application Path: Enter the full path to the SentinelOne process to be checked (for example, C:\Program Files\SentinelOne\Sentinel Agent 21.7.4.1043\SentinelAgent.exe).
NoteThe path of the SentinelOne process may change between updates. Make sure to edit Application Path to match the new path, or use %PATH% variables.
8. Signing certificate thumbprint (recommended): Enter the thumbprint of the publishing certificate used to sign the binary. This proves the binary came from SentinelOne and is the recommended way to validate the process.
9. SHA-256 (optional): Enter a SHA-256 value. This is used to validate the SHA256 signature of the binary and ensures the integrity of the binary file on the device. Note: do not fill out this field unless you strictly control updates to SentinelOne, as this will change between versions.

Next, go to Logs > Posture and verify that the SentinelOne check is returning the expected results.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Service providers

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/](https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/)

Page options # Service providers

Service-to-service integrations allow the WARP client to get device posture data from a third-party API. To use this feature, you must deploy the WARP client to your devices and enable the desired posture checks.

## Supported WARP modes

- Gateway with WARP
- Secure Web Gateway without DNS filtering
- Device Information Only

## Supported operating systems

| Device posture check | macOS | Windows | Linux | iOS | Android/ChromeOS |
| --- | --- | --- | --- | --- | --- |
| Custom integration | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| Crowdstrike | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Kolide | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Microsoft Endpoint Manager | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| SentinelOne | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Tanium | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Uptycs | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| Workspace ONE | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Custom device posture integration

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/custom/](https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/custom/)

Page options # Custom device posture integration

Cloudflare Zero Trust allows you to enforce custom device posture checks on your applications. This involves configuring a WARP service-to-service integration that periodically calls the external API of your choice, whether it is a third-party endpoint provider or a home built solution. When called, the API will receive device identifying information from Cloudflare and be expected to return a value between 0 to 100. You can then set up a device posture check that determines if the returned value counts as a pass or fail; for example, you could allow access to a user only if their device has a posture value greater than 60.

```
sequenceDiagram
    participant WARP
		participant Cloudflare Access
    participant External API
    WARP->>Cloudflare Access: Client ID and Secret
		Cloudflare Access->>External API: Application token
		WARP->>External API: JSON with user and device identity
    External API-->>WARP: JSON with 0-100 result
```

## External API requirements

The custom service provider integration works with any API service that meets the following specifications. For an example of a custom device posture integration API, refer to our Cloudflare Workers sample code ‚Üó.

### Authentication

The WARP client authenticates to the external API through Cloudflare Access. The external API should validate the application token issued by Cloudflare Access to ensure that any requests which bypass Access (for example, due to a network misconfiguration) are rejected.

### Data passed to external API

Cloudflare will pass the following parameters to the configured API endpoint. You can use this data to identify the device and assign a posture score. For some devices, not all identifying information will apply, in which case the field will be blank. A maximum of 1,000 devices will be sent per a request.

| Field | Description |
| --- | --- |
| device_id | Device UUID assigned by the WARP client |
| email | Email address used to authenticate the WARP client |
| serial_number | Device serial number |
| mac_address | Device MAC address |
| virtual_ipv4 | Device virtual IPv4 address |
| hostname | Device name |

Note

Devices are identified by their serial numbers. You must ensure that each of your devices has a unique serial number. If multiple devices have the same serial number, Cloudflare and your external API will not be able to accurately match them.

Example request body:

```
{  "devices": {    [      {        "device_id": "9ece5fab-7398-488a-a575-e25a9a3dec07",        "email": "jdoe@mycompany.com",        "serial_number": "jdR44P3d",        "mac_address": "74:1d:3e:23:e0:fe",        "virtual_ipv4": "100.96.0.10",        "hostname": "string",      },      {...},      {...}    ]  }}
```

### Expected response from external API

For each Cloudflare device_id, the API service is expected to return a posture score and optionally a third-party device ID.

| Field | Description |
| --- | --- |
| s2s_id | Third party device ID (empty string if unavailable) |
| score | Integer value between 0 - 100 |

Example response body:

```
{  "result": {    "9ece5fab-7398-488a-a575-e25a9a3dec07": {      "s2s_id": "",      "score": 10    },    "device_id2": {...},    "device_id3": {...}  }}
```

## Set up custom device posture checks

### 1. Create a service token

WARP uses an Access Client ID and Access Client Secret to securely authenticate to the external API. If you do not already have an Access Client ID and Access Client Secret, create a new service token.

### 2. Create an Access application

Next, secure the external API behind Cloudflare Access so that WARP can authenticate with the service token. To add the API endpoint to Access:

1. Create a self-hosted application for your API endpoint.
2. Add the following Access policy to the application. Make sure that Action is set to Service Auth (not Allow).

















ActionRule typeSelectorValueService AuthIncludeService Token<TOKEN-NAME>

### 3. Add a service provider integration

To create a custom service-to-service integration:

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to Third-party service provider integrations and select Add new.
3. Select Custom service provider.
4. Enter any name for the provider. This name will be used throughout the dashboard to reference this connection.

1. In Access client ID and Access client secret, enter the Access service token used to authenticate to your external API.
2. In Rest API URL, enter the external API endpoint that Cloudflare will query for posture information (for example, https://api.example.com). For more information, refer to External API requirements.
3. In Polling frequency, choose how often Cloudflare Zero Trust should query the external API for information.
4. Select Test and save. The test checks if Cloudflare can authenticate to the API URL using the provided Access credentials.

Next, configure a device posture check to determine if a given posture score constitutes a pass or fail.

### 4. Configure the posture check

1. In Zero Trust ‚Üó, go to Settings > WARP Client > Service provider checks.
2. Select Add new.
3. Select the Custom service provider provider.
4. Enter any name for the posture check.
5. Configure the attributes required for the device to pass the posture check.
6. Select Save.
7. To test, go to Logs > Posture and verify that the service provider posture check is returning the expected results.

You can now use this posture check in a device posture policy.

## Device posture attributes

| Selector | Description | Value |
| --- | --- | --- |
| Score | Posture score returned by external API | 0 to 100 |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## CrowdStrike

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/crowdstrike/](https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/crowdstrike/)

Page options # CrowdStrike

Cloudflare Zero Trust can integrate with Crowdstrike to require that users connect to certain applications from managed devices. This service-to-service posture check uses the WARP client to read endpoint data from Crowdstrike. Devices are identified by their serial numbers. If multiple devices have the same serial number, Cloudflare cannot accurately match a WARP device with a third-party provider device. You must ensure that each of your devices has a unique serial number.

## Prerequisites

Device posture with Crowdstrike requires:

- Falcon Enterprise plan or above
- Crowdstrike agent is deployed on the device.
- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to Service providers.

## Set up CrowdStrike as a service provider

### 1. Obtain CrowdStrike settings

The following CrowdStrike values are needed to set up the CrowdStrike posture check:

- Client ID
- Client Secret
- Base URL
- Customer ID

To retrieve those values:

1. Log in to your Falcon Dashboard.
2. Go to Support and resources > API Clients and Keys.
3. Select Create API client and enter any name for the client.
4. Turn on the following API permissions:





























ScopePermissionDetectionsReadHostsReadEvent StreamsReadUser ManagementReadZero Trust AssessmentRead
5. Select Create.
6. Copy the Client ID, Client Secret, and Base URL to a safe place.
7. Go to Host setup and management > Sensor downloads and copy your Customer ID.

### 2. Add CrowdStrike as a service provider

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to Third-party service provider integrations and select Add new.
3. Select Crowdstrike.
4. Enter any name for the provider. This name will be used throughout the dashboard to reference this connection.

1. Enter the Client ID and Client secret you noted down above.
2. In Rest API URL, enter your Base URL.
3. Enter your Customer ID.
4. Choose a Polling frequency for how often Cloudflare Zero Trust should query CrowdStrike for information.
5. Select Test and save.

### 3. Configure the posture check

1. In Zero Trust ‚Üó, go to Settings > WARP Client > Service provider checks.
2. Select Add new.
3. Select the Crowdstrike provider.
4. Enter any name for the posture check.
5. Configure the attributes required for the device to pass the posture check.
6. Select Save.
7. To test, go to Logs > Posture and verify that the service provider posture check is returning the expected results.

You can now use this posture check in a device posture policy.

## Device posture attributes

Device posture data is gathered from the CrowdStrike Zero Trust Assessment APIs ‚Üó. To learn more about how scores are calculated, refer to the CrowdStrike Zero Trust Assessment ‚Üó documentation.

| Selector | Description | Value |
| --- | --- | --- |
| OS | OS signal score | 1 to 100 |
| Overall | Overall ZTA score | 1 to 100 |
| Sensor config | Sensor signal score | 1 to 100 |
| Version | ZTA score version | 2.1.0 |
| State | Current online status of the device | Online, Offline, or Unknown |
| Last seen | Elapsed time since the device was last seen. Only returned if its state is online or unknown. | In the last 1 hour, 3 hours, 6 hours, 12 hours, 24 hours, 7 days, 30 days, or more than 30 days |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Kolide

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/kolide/](https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/kolide/)

Page options # Kolide

Cloudflare Zero Trust can integrate with Kolide to require that users connect to certain applications from managed devices. This service-to-service posture check uses the WARP client to read endpoint data from Kolide. Devices are identified by their serial numbers. If multiple devices have the same serial number, Cloudflare cannot accurately match a WARP device with a third-party provider device. You must ensure that each of your devices has a unique serial number.

## Prerequisites

- Kolide agent is deployed on the device.
- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to Service providers.

## Set up Kolide as a service provider

### 1. Create a Client Secret in Kolide

1. Log in to your Kolide dashboard.
2. Select your profile and go to Settings > Developers.
3. Select Create New Key.
4. Enter a Key Name and select Save.
5. Copy the Secret token to a safe place. This will be your Client Secret.

### 2. Add Kolide as a service provider

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to Third-party service provider integrations and select Add new.
3. Select Kolide.
4. Enter any name for the provider. This name will be used throughout the dashboard to reference this connection.

1. Enter the Client secret you noted down above.
2. Choose a Polling frequency for how often Cloudflare Zero Trust should query Kolide for information.
3. Select Test and save.

### 3. Configure the posture check

1. In Zero Trust ‚Üó, go to Settings > WARP Client > Service provider checks.
2. Select Add new.
3. Select the Kolide provider.
4. Enter any name for the posture check.
5. Configure the attributes required for the device to pass the posture check.
6. Select Save.
7. To test, go to Logs > Posture and verify that the service provider posture check is returning the expected results.

You can now use this posture check in a device posture policy.

## Device posture attributes

Device posture data is gathered from the Kolide K2 API ‚Üó.

| Selector | Description |
| --- | --- |
| Issue count | Total number of issues detected on the device |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Microsoft Endpoint Manager

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/microsoft/](https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/microsoft/)

Page options # Microsoft Endpoint Manager

Cloudflare Zero Trust can integrate with Microsoft to require that users connect to certain applications from managed devices. This service-to-service posture check uses the WARP client to read endpoint data from Microsoft. Devices are identified by their serial numbers. If multiple devices have the same serial number, Cloudflare cannot accurately match a WARP device with a third-party provider device. You must ensure that each of your devices has a unique serial number.

## Prerequisites

Device posture with Microsoft Endpoint Manager requires:

- An Intune license
- Microsoft Endpoint Manager is managing the device.
- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to Service providers.

## 1. Obtain Microsoft Graph settings

The following values are required:

- Client secret
- Application (client) ID
- Direct (tenant) ID

To retrieve those values:

1. Log in to your Microsoft Dashboard.
2. Go to App Registrations and select New Registrations.
3. Copy the Application (client) ID value to a safe place. This will be your Client ID.
4. Copy the Directory (tenant) ID value to a safe place. This will be your Customer ID.
5. Go to Certificates & Secrets and select New client secret.
6. Fill in a description and how long the secret should be valid.
7. After completing the form, immediately copy the resulting secret. This will be your Client Secret.
8. Go to API Permissions and select Add permission.
9. Select Microsoft Graph.
10. Select Application permissions.
11. Add DeviceManagementManagedDevices.Read.All.
12. If the permission status shows Not granted, select Grant admin consent.

## 2. Add Intune as a service provider

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to Third-party service provider integrations and select Add new.
3. Select Microsoft Endpoint Manager.
4. Enter any name for the provider. This name will be used throughout the dashboard to reference this connection.

1. Enter the Client ID, Client secret and Customer ID as you noted down above.
2. Select a Polling frequency for how often Cloudflare Zero Trust should query Microsoft Graph API for information.
3. Select Test and save.

## 3. Configure the posture check

1. In Zero Trust ‚Üó, go to Settings > WARP Client > Service provider checks.
2. Select Add new.
3. Select the Microsoft Endpoint Manager provider.
4. Enter any name for the posture check.
5. Configure the attributes required for the device to pass the posture check.
6. Select Save.
7. To test, go to Logs > Posture and verify that the service provider posture check is returning the expected results.

You can now use this posture check in a device posture policy.

## Device posture attributes

The Microsoft Endpoint Manager device posture check relies on information from the Microsoft Graph API. Refer to Microsoft's ComplianceState ‚Üó and List managedDevices ‚Üó documentation for a list of properties returned by the API.

To learn more about how to control ComplianceState, refer to Microsoft's compliance policies guide ‚Üó.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SentinelOne

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/sentinelone/](https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/sentinelone/)

Page options # SentinelOne

Cloudflare Zero Trust can integrate with SentinelOne to require that users connect to certain applications from managed devices. This service-to-service posture check uses the WARP client to read endpoint data from SentinelOne. Devices are identified by their serial numbers. If multiple devices have the same serial number, Cloudflare cannot accurately match a WARP device with a third-party provider device. You must ensure that each of your devices has a unique serial number.

## Prerequisites

- SentinelOne agent is deployed on the device.
- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to Service providers.

## Set up SentinelOne as a service provider

### 1. Obtain SentinelOne settings

The following SentinelOne values are needed to set up the SentinelOne posture check:

- API Token
- REST API URL

To retrieve those values:

1. Log in to your SentinelOne Dashboard.
2. Go to Settings > Users > Create new Service User.
3. Select Create New Service User.
4. Enter a Name and Expiration Date and select Next.
5. Set Scope of Access to Viewer.
6. Select Create User. SentinelOne will generate an API Token for this user.
7. Copy the API Token to a safe location.
8. Select Close.
9. Copy the Rest API URL from your browser's address bar (for example, https://<S1-DOMAIN>.sentinelone.net).

### 2. Add SentinelOne as a service provider

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to Third-party service provider integrations and select Add new.
3. Select SentinelOne.
4. Enter any name for the provider. This name will be used throughout the dashboard to reference this connection.

1. In Client Secret, enter your API Token.
2. In Rest API URL, enter https://<S1-DOMAIN>.sentinelone.net.
3. Choose a Polling frequency for how often Cloudflare Zero Trust should query SentinelOne for information.
4. Select Test and save.

### 3. Configure the posture check

1. In Zero Trust ‚Üó, go to Settings > WARP Client > Service provider checks.
2. Select Add new.
3. Select the SentinelOne provider.
4. Enter any name for the posture check.
5. Configure the attributes required for the device to pass the posture check.
6. Select Save.
7. To test, go to Logs > Posture and verify that the service provider posture check is returning the expected results.

You can now use this posture check in a device posture policy.

## Device posture attributes

Device posture data is gathered from the SentinelOne Management APIs. For more information, refer to https://<S1-DOMAIN>.sentinelone.net/api-doc/overview.

| Selector | Description |
| --- | --- |
| Infected | Whether the device is infected |
| Active Threats | Number of active threats on the device |
| Is Active | Whether the SentinelOne Agent is active |
| Network status | Whether the SentinelOne Agent is connected to the SentinelOne service |
| Operational State | The operational state ‚Üó of the SentinelOne Agent. |

### Detect user risk behavior

SentinelOne provides endpoint detection and response (EDR) signals to determine user risk score. User risk scores allow you to detect users that present security risks to your organization. For more information, refer to Predefined risk behaviors.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tanium

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/taniums2s/](https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/taniums2s/)

Page options # Tanium

Cloudflare Zero Trust can integrate with Tanium to require that users connect to certain applications from managed devices. This service-to-service posture check uses the WARP client to read endpoint data from Tanium. Devices are identified by their serial numbers. If multiple devices have the same serial number, Cloudflare cannot accurately match a WARP device with a third-party provider device. You must ensure that each of your devices has a unique serial number.

## Prerequisites

- Either Tanium Cloud or on-premise installations of Tanium with the Benchmark entitlement
- Tanium agent is deployed on the device.
- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to Service providers.

## Set up Tanium as a service provider

### 1. Get Tanium settings

The following Tanium values are needed to set up the Tanium posture check:

- Client Secret
- REST API URL

To retrieve the client secret, create an API token:

1. Log in to your Tanium instance.
2. Go to Administration > API Tokens.
3. Select New API Token.
4. Set Expire in days to an appropriate value for your organization. When this token expires, all device posture results will begin to fail unless updated.
5. Set Trusted IP addresses to 0.0.0.0/0.
6. Select Save.
7. Copy the Client Secret to a safe place.

To retrieve the API URL, determine your Tanium Gateway root endpoint:

- Tanium Cloud: https://<customerName>-api.cloud.tanium.com/plugin/products/gateway/graphql
- Tanium On Prem: https://<server>/plugin/products/gateway/graphql

### 2. Add Tanium as a service provider

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to Third-party service provider integrations and select Add new.
3. Select Tanium.
4. Enter any name for the provider. This name will be used throughout the dashboard to reference this connection.

1. Enter the Client Secret and REST API URL you noted down above.
2. Choose a Polling frequency for how often Cloudflare Zero Trust should query Tanium for information.
3. Select Test and save.

### 3. Configure the posture check

1. In Zero Trust ‚Üó, go to Settings > WARP Client > Service provider checks.
2. Select Add new.
3. Select the Tanium provider.
4. Enter any name for the posture check.
5. Configure the attributes required for the device to pass the posture check.
6. Select Save.
7. To test, go to Logs > Posture and verify that the service provider posture check is returning the expected results.

You can now use this posture check in a device posture policy.

## Device posture attributes

Device posture data is gathered from Tanium's EndpointRisk API ‚Üó. To learn more about how scores are calculated, refer to the Tanium risk score documentation ‚Üó.

| Selector | Description | Value |
| --- | --- | --- |
| Total score | totalScore of the device. | 1 to 1000 |
| Risk level | riskLevel of the device. | Low, medium, high, or critical |
| EID last seen | Elapsed time since the device was last seen, based on its datetime attribute. | In the last 1 hour, 3 hours, 6 hours, 12 hours, 24 hours, 7 days, 30 days, or more than 30 days |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Uptycs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/uptycs/](https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/uptycs/)

Page options # Uptycs

Cloudflare Zero Trust can integrate with Uptycs to require that users connect to certain applications from managed devices. This service-to-service posture check uses the WARP client to read endpoint data from Uptycs. Devices are identified by their serial numbers. If multiple devices have the same serial number, Cloudflare cannot accurately match a WARP device with a third-party provider device. You must ensure that each of your devices has a unique serial number.

## Prerequisites

- Uptycs agent is deployed on the device.
- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to Service providers.

## 1. Obtain Uptycs Settings

The following Uptycs values are needed to set up the Uptycs posture check:

- Client key
- Client Secret
- Customer ID

To obtain these values:

1. Open your Uptycs console.
2. Go to Account Settings > API Key.
3. Generate and download your .json file. This file will contain your Client key, Client Secret and Customer ID.

## 2. Add Uptycs as a service provider

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to Third-party service provider integrations and select Add new.
3. Select Uptycs.
4. Enter any name for the provider. This name will be used throughout the dashboard to reference this connection.

1. Enter the Client ID, Client secret and Customer ID as you noted down above.
2. Select a Polling frequency for how often Cloudflare Zero Trust should query Uptycs for information.
3. Select Test and save.

## 3. Configure the posture check

1. In Zero Trust ‚Üó, go to Settings > WARP Client > Service provider checks.
2. Select Add new.
3. Select the Uptycs provider.
4. Enter any name for the posture check.
5. Configure the attributes required for the device to pass the posture check.
6. Select Save.
7. To test, go to Logs > Posture and verify that the service provider posture check is returning the expected results.

You can now use this posture check in a device posture policy.

## Device posture attributes

| Selector | Description |
| --- | --- |
| Score | Zero Trust score assigned to the device by Uptycs |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Workspace ONE

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/workspace-one/](https://developers.cloudflare.com/cloudflare-one/identity/devices/service-providers/workspace-one/)

Page options # Workspace ONE

Cloudflare Zero Trust can integrate with Workspace ONE to require that users connect to certain applications from managed devices. This service-to-service posture check uses the WARP client to read endpoint data from Workspace ONE. Devices are identified by their serial numbers. If multiple devices have the same serial number, Cloudflare cannot accurately match a WARP device with a third-party provider device. You must ensure that each of your devices has a unique serial number.

## Prerequisites

- Workspace ONE agent is deployed on the device.
- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to Service providers.

## 1. Obtain Workspace ONE Settings

The following Workspace ONE values are needed to set up the Workspace ONE posture check:

- ClientID
- Client Secret
- REST API URL
- Region-Specific token URL

To retrieve those values:

1. Log in to your Workspace ONE dashboard.
2. Go to Groups & Settings > Configurations.
3. Enter OAuth in the search bar labeled Enter a name or category.
4. Select OAuth Client Management in the results. The OAuth Client Management screen displays.
5. Select Add.
6. Enter values for the Name, Description, Organization Group, and Role.
7. Ensure that the Status is Enabled.
8. Select Save.
9. Copy the Client ID and Client Secret to a safe place.
10. To obtain your REST API URL, gp tp Groups & Settings > All Settings > System > Advance > Site URLs > REST API URL.
11. Retrieve the Region-Specific Token URL from Workspace ONE and copy it to a safe place.

## 2. Add Workspace ONE as a service provider

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to Third-party service provider integrations and select Add new.
3. Select Workspace ONE.
4. Enter any name for the provider. This name will be used throughout the dashboard to reference this connection.

1. Enter the Client ID and Client secret you noted down above.
2. Select a Polling frequency for how often Cloudflare Zero Trust should query Workspace ONE for information.
3. Enter the Region-specific token URL and REST API URL you noted down above.
4. Select Test and save.

## 3. Configure the posture check

1. In Zero Trust ‚Üó, go to Settings > WARP Client > Service provider checks.
2. Select Add new.
3. Select the Workspace ONE provider.
4. Enter any name for the posture check.
5. Configure the attributes required for the device to pass the posture check.
6. Select Save.
7. To test, go to Logs > Posture and verify that the service provider posture check is returning the expected results.

You can now use this posture check in a device posture policy.

## Device posture attributes

Workspace ONE posture checks work with the Compliance flags ‚Üó in Workspace ONE. All compliance tests must pass for the device to be considered compliant.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Access integrations

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/access-integrations/](https://developers.cloudflare.com/cloudflare-one/identity/devices/access-integrations/)

Page options # Access integrations

These device posture checks can only be enforced for Cloudflare Access applications. They cannot be used in Gateway network policies.

| Device posture check | macOS | Windows | Linux | iOS | Android/ChromeOS | WARP mode |
| --- | --- | --- | --- | --- | --- | --- |
| Microsoft Entra ID Conditional Access | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | WARP not required |
| Mutual TLS | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | WARP not required |
| Tanium | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | Gateway with WARP, Secure Web Gateway without DNS filtering, or Device Information Only |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Mutual TLS

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/access-integrations/mutual-tls-authentication/](https://developers.cloudflare.com/cloudflare-one/identity/devices/access-integrations/mutual-tls-authentication/)

Page options # Mutual TLS

Note

Only available on Enterprise plans.

Mutual TLS (mTLS) authentication ‚Üó ensures that traffic is both secure and trusted in both directions between a client and server. It allows requests that do not log in with an identity provider (like IoT devices) to demonstrate that they can reach a given resource. Client certificate authentication is also a second layer of security for team members who both log in with an identity provider (IdP) and present a valid client certificate.

With a root certificate authority (CA) in place, Access only allows requests from devices with a corresponding client certificate. When a request reaches the application, Access responds with a request for the client to present a certificate. If the device fails to present the certificate, the request is not allowed to proceed. If the client does have a certificate, Access completes a key exchange to verify.

Important

The mTLS certificate is used only to verify the client certificate. It does not control the SSL certificate presented during the server hello ‚Üó.

## Enforce mTLS authentication

### Prerequisites

- An Access application for the hostname that you would like to secure with mTLS.
- A CA that issues client certificates for your devices.


The CA certificate can be from a publicly trusted CA or self-signed.


In the certificate Basic Constraints, the attribute CA must be set to TRUE.


The certificate must use one of the signature algorithms listed below:
 Allowed signature algorithms
 x509.SHA1WithRSAx509.SHA256WithRSAx509.SHA384WithRSAx509.SHA512WithRSAx509.ECDSAWithSHA1x509.ECDSAWithSHA256x509.ECDSAWithSHA384x509.ECDSAWithSHA512
- The CA certificate can be from a publicly trusted CA or self-signed.
- In the certificate Basic Constraints, the attribute CA must be set to TRUE.
- The certificate must use one of the signature algorithms listed below:
 Allowed signature algorithms
 x509.SHA1WithRSAx509.SHA256WithRSAx509.SHA384WithRSAx509.SHA512WithRSAx509.ECDSAWithSHA1x509.ECDSAWithSHA256x509.ECDSAWithSHA384x509.ECDSAWithSHA512

### Add mTLS to your Access application

1. In Zero Trust ‚Üó, go to Access > Service auth > Mutual TLS.
2. Select Add mTLS Certificate.
3. Enter any name for the root CA.
4. In Certificate content, paste the contents of your root CA.
If the client certificate is directly signed by the root CA, you only need to upload the root. If the client certificate is signed by an intermediate certificate, you must upload the entire CA chain (intermediate and root). For example:
-----BEGIN CERTIFICATE-----<intermediate.pem>-----END CERTIFICATE----------BEGIN CERTIFICATE-----<rootCA.pem>-----END CERTIFICATE-----
 Do not include any SSL/TLS server certificates; Access only uses the CA chain to verify the connection between the user's device and Cloudflare.

1. In Associated hostnames, enter the fully-qualified domain names (FQDN) that will use this certificate.
These FQDNs will be the hostnames used for the resources being protected in the Access policy. You must associate the Root CA with the FQDN that the application being protected uses.
2. Save the policy.
3. Go to Access > Policies.
4. Create an Access policy using one of the following selectors:

Valid Certificate: Any client certificate that can authenticate with the Root CA will be allowed to proceed.
Common Name: Only client certificates with a specific common name will be allowed to proceed.
5. Valid Certificate: Any client certificate that can authenticate with the Root CA will be allowed to proceed.
6. Common Name: Only client certificates with a specific common name will be allowed to proceed.
7. If this is for a client who does not need to log in through an IdP, set the policy Action to Service Auth.
      Example mTLS policy
















ActionRule typeSelectorValueService AuthIncludeCommon NameJohn Doe
8. Save the policy, then go to Access > Applications.
9. Select the application you would like to enforce mTLS on and select Configure. The application must be included in the Associated hostnames list from Step 5.
10. In the Policies tab, add your mTLS policy.
11. Save the application.

You can now authenticate to the application using a client certificate. For instructions on how to present a client certificate, refer to Test mTLS.

## Test mTLS

### Test using cURL

To test the application protected by an mTLS policy:

1. First, attempt to curl the site without a client certificate.
This curl command example is for the site example.com that has an Access application and policy set for https://auth.example.com:
Terminal windowcurl -sv https://auth.example.com
Without a client certificate in the request, a 403 forbidden response displays and the site cannot be accessed.
2. Now, add your client certificate and key to the request:
Terminal windowcurl -sv https://auth.example.com --cert example.pem --key key.pem

When the authentication process completes successfully, a CF_Authorization Set-Cookie header returns in the response.

Warning

Cloudflare Gateway cannot inspect traffic to mTLS-protected domains. If a device has the WARP client turned on and passes HTTP requests through Gateway, access will be blocked unless you bypass HTTP inspection for the domain.

### Test in a browser

To access an mTLS-protected application in a browser, the client certificate must be imported into your browser's certificate manager. Instructions vary depending on the browser. Your browser may use the operating system's root store or its own internal trust store.

The following example demonstrates how to add a client certificate to the macOS system keychain:

Important

The command adds the client certificate to the trusted store on your device. Only proceed if you are comfortable doing so and intend to keep these testing certificates safeguarded.

1. Navigate to the directory containing the client certificate and key.

Open the client.pem file in Keychain Access. If prompted, enter your local password.
In Keychain, choose the access option that suits your needs and select Add.
In the list of certificates, locate the newly installed certificate. Keychain Access will mark this certificate as not trusted. Right-click the certificate and select Get Info.
Select Trust. Under When using this certificate, select Always Trust.
2. Open the client.pem file in Keychain Access. If prompted, enter your local password.
3. In Keychain, choose the access option that suits your needs and select Add.
4. In the list of certificates, locate the newly installed certificate. Keychain Access will mark this certificate as not trusted. Right-click the certificate and select Get Info.
5. Select Trust. Under When using this certificate, select Always Trust.

Assuming your browser uses the macOS system store, you can now connect to the mTLS application through the browser.

## Generate mTLS certificates

You can use open source private key infrastructure (PKI) tools to generate certificates to test the mTLS feature in Cloudflare Access.

### OpenSSL

This section covers how to use OpenSSL ‚Üó to generate a root and intermediate certificate, and then issue client certificates that can authenticate against the CA chain.

#### Generate the root CA

1. Generate the root CA private key:
Terminal window openssl genrsa -aes256 -out rootCA.key 4096
When prompted, enter a password to use with rootCA.key.
2. Create a self-signed root certificate called rootCA.pem:
Terminal windowopenssl req -x509 -new -nodes -key rootCA.key -sha256 -days 3650 -out rootCA.pem
You will be prompted to enter your private key password and fill in some optional fields. For testing purposes, you can leave the optional fields blank.

#### Generate an intermediate certificate

1. Generate the intermediate CA private key:
Terminal window openssl genrsa -aes256 -out intermediate.key 4096
When prompted, enter a password to use with intermediate.key.
2. Create a certificate signing request (CSR) for the intermediate certificate:
Terminal windowopenssl req -new -sha256 -key intermediate.key -out intermediate.csr
You will be prompted to enter your private key password and fill in some optional fields. For testing purposes, you can leave the optional fields blank.
3. Create a CA Extension file called v3_intermediate_ca.ext. For example,
subjectKeyIdentifier = hashauthorityKeyIdentifier = keyid:always,issuerbasicConstraints = critical, CA:truekeyUsage = critical, cRLSign, keyCertSign
Make sure that basicConstraints includes the CA:true property. This property allows the intermediate certificate to act as a CA and sign client certificates.
4. Sign the intermediate certificate with the root CA:
Terminal window openssl x509 -req -in intermediate.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out intermediate.pem -days 1825 -sha256 -extfile v3_intermediate_ca.ext

#### Create a CA chain file

1. Combine the intermediate and root certificates into a single file:
Terminal windowcat intermediate.pem rootCA.pem > ca-chain.pem
The intermediate certificate should be at the top of the file, followed by its signing certificate.
2. Upload the contents of ca-chain.pem to Cloudflare Access. For instructions, refer to Add mTLS to your Access application.

#### Generate a client certificate

1. Generate a private key for the client:
Terminal window openssl genrsa -out client.key 2048
2. Create a CSR for the client certificate:
Terminal windowopenssl req -new -key client.key -out client.csr
You will be prompted to fill in some optional fields. For testing purposes, you can set Common Name to something like John Doe.
3. Sign the client certificate with the intermediate certificate:
Terminal window openssl x509 -req -in client.csr -CA intermediate.pem -CAkey intermediate.key -CAcreateserial -out client.pem -days 365 -sha256
4. Validate the client certificate against the certificate chain:
Terminal windowopenssl verify -CAfile ca-chain.pem client.pem
client.pem: OK

You can now use the client certificate (client.pem) and its key (client.key) to test mTLS.

### Cloudflare PKI

This guide uses Cloudflare's PKI toolkit ‚Üó to generate a root CA and client certificates from JSON files.

#### 1. Install dependencies

The process requires two packages from Cloudflare's PKI toolkit:

- cf-ssl
- cfssljson

You can install these packages from the Cloudflare SSL GitHub repository ‚Üó. You will need a working installation of Go, version 1.12 or later. Alternatively, you can download the packages ‚Üó directly.
Use the instructions under Installation to install the toolkit, and ensure that you install all of the utility programs in the toolkit.

#### 2. Generate the root CA

1. Create a new directory to store the root CA.
2. Within that directory, create two new files:


CSR. Create a file named ca-csr.json and add the following JSON blob, then save the file.
{  "CN": "Access Testing CA",  "key": {    "algo": "rsa",    "size": 4096  },  "names": [    {      "C": "US",      "L": "Austin",      "O": "Access Testing",      "OU": "TX",      "ST": "Texas"    }  ]}


config. Create a file named ca-config.json and add the following JSON blob, then save the file.
{  "signing": {    "default": {      "expiry": "8760h"    },    "profiles": {      "server": {        "usages": ["signing", "key encipherment", "server auth"],        "expiry": "8760h"      },      "client": {        "usages": ["signing", "key encipherment", "client auth"],        "expiry": "8760h"      }    }  }}
3. CSR. Create a file named ca-csr.json and add the following JSON blob, then save the file.
{  "CN": "Access Testing CA",  "key": {    "algo": "rsa",    "size": 4096  },  "names": [    {      "C": "US",      "L": "Austin",      "O": "Access Testing",      "OU": "TX",      "ST": "Texas"    }  ]}
4. config. Create a file named ca-config.json and add the following JSON blob, then save the file.
{  "signing": {    "default": {      "expiry": "8760h"    },    "profiles": {      "server": {        "usages": ["signing", "key encipherment", "server auth"],        "expiry": "8760h"      },      "client": {        "usages": ["signing", "key encipherment", "client auth"],        "expiry": "8760h"      }    }  }}
5. Now, run the following command to generate the root CA with those files.
Terminal windowcfssl gencert -initca ca-csr.json | cfssljson -bare ca
6. The command will output a root certificate (ca.pem) and its key (ca-key.pem).
Terminal windowls
ca-config.json ca-csr.json ca-key.pem ca.csr  ca.pem
7. Upload the contents of ca.pem to Cloudflare Access. For instructions, refer to Add mTLS to your Access application.

#### 3. Generate a client certificate

To generate a client certificate that will authenticate against the uploaded root CA:

1. Create a file named client-csr.json and add the following JSON blob:
{  "CN": "James Royal",  "hosts": [""],  "key": {    "algo": "rsa",    "size": 4096  },  "names": [    {      "C": "US",      "L": "Austin",      "O": "Access",      "OU": "Access Admins",      "ST": "Texas"    }  ]}
2. Now, use the following command to generate a client certificate with the Cloudflare PKI toolkit:
Terminal windowcfssl gencert -ca=ca.pem -ca-key=ca-key.pem  -config=ca-config.json -profile=client client-csr.json | cfssljson -bare client

The command will output a client certificate file (client.pem) and its key (client-key.pem). You can now use these files to test mTLS.

#### Create a certificate revocation list

You can use the Cloudflare PKI toolkit to generate a certificate revocation list (CRL), as well. This list will contain client certificates that are revoked.

1. Get the serial number from the client certificate generated earlier. Add that serial number, or any others you intend to revoke, in hex format in a text file. This example uses a file named serials.txt.
2. Create the CRL with the following command.
Terminal windowcfssl gencrl serials.txt ../mtls-test/ca.pem ../mtls-test/ca-key.pem | base64 -D > ca.crl

You will need to add the CRL to your server or enforce the revocation in a Cloudflare Worker. An example Worker Script can be found on the Cloudflare GitHub repository ‚Üó.

## Forward a client certificate

In addition to enforcing mTLS authentication for your host, you can also forward a client certificate to your origin server as an HTTP header. This setup is often helpful for server logging.

To avoid adding the certificate to every single request, the certificate is only forwarded on the first request of an mTLS connection.

Warning

This process is only available on accounts with Cloudflare Access.

### Cloudflare API

The most common approach to forwarding a certificate is to use the Cloudflare API to update an mTLS certificate's hostname settings.

Required API token permissions

At least one of the following token permissions is required: - Access: Mutual TLS Certificates Write

Update an mTLS certificate's hostname settings ```
curl "https://api.cloudflare.com/client/v4/zones/$ZONE_ID/access/certificates/settings" \  --request PUT \  --header "X-Auth-Email: $CLOUDFLARE_EMAIL" \  --header "X-Auth-Key: $CLOUDFLARE_API_KEY" \  --json '{    "settings": [        {            "hostname": "<HOSTNAME>",            "china_network": false,            "client_certificate_forwarding": true        }    ]  }'
```

Once client_certificate_forwarding is set to true, every request within an mTLS connection will now include the following headers:

- Cf-Client-Cert-Der-Base64
- Cf-Client-Cert-Sha256

### Managed Transforms

You can also modify HTTP response headers using Managed Transforms to pass along TLS client auth headers.

### Cloudflare Workers

Additionally, Workers can provide details around the client certificate.

```
const tlsHeaders = {    'X-CERT-ISSUER-DN': request.cf.tlsClientAuth.certIssuerDN,    'X-CERT-SUBJECT-DN': request.cf.tlsClientAuth.certSubjectDN,    'X-CERT-ISSUER-DN-L': request.cf.tlsClientAuth.certIssuerDNLegacy,    'X-CERT-SUBJECT-DN-L': request.cf.tlsClientAuth.certSubjectDNLegacy,    'X-CERT-SERIAL': request.cf.tlsClientAuth.certSerial,    'X-CERT-FINGER': request.cf.tlsClientAuth.certFingerprintSHA1,    'X-CERT-VERIFY': request.cf.tlsClientAuth.certVerify,    'X-CERT-NOTBE': request.cf.tlsClientAuth.certNotBefore,    'X-CERT-NOTAF': request.cf.tlsClientAuth.certNotAfter};
```

## Known limitations

mTLS does not currently work for:

- Cloudflare Pages site served on a custom domain
- Cloudflare R2 public bucket served on a custom domain

## Set up alerts for mutual TLS certificates

You can configure alerts to receive notifications before your mutual TLS certificates expire.

Access mTLS Certificate Expiration Alert

Who is it for? Access customers that use client certificates for mutual TLS authentication. This notification will be sent 30 and 14 days before the expiration of the certificate.

Other options / filters None.

Included with Purchase of Access and/or Cloudflare for SaaS.

What should you do if you receive one? Upload a renewed certificate.

Refer to Cloudflare Notifications for more information on how to set up an alert.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tanium (legacy)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/access-integrations/tanium/](https://developers.cloudflare.com/cloudflare-one/identity/devices/access-integrations/tanium/)

Page options # Tanium (legacy)

Note

Not recommended for new deployments. We recommend using the Tanium service-to-service integration to get device posture signals from Tanium.

Cloudflare Access can use endpoint data from Tanium‚Ñ¢ ‚Üó to determine if a request should be allowed to reach a protected resource. When users attempt to connect to a resource protected by Access with a Tanium rule, Cloudflare Access will validate the user's identity, and the browser will connect to the Tanium agent before making a decision to grant access.

Gateway device posture limitation

The Tanium integration cannot be used with Gateway device posture policies.

## Prerequisites

- Tanium Core Platform version 7.2 or later
- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to Access integrations.

## Integrate Tanium with Cloudflare Access

Note

The integration does not currently support Safari.

1. Configure your Tanium deployment using the step-by-step documentation ‚Üó provided. You will need the public key to integrate your Tanium deployment with Cloudflare Access.
2. In Zero Trust ‚Üó, go to Settings > WARP Client.
3. Scroll down to WARP client checks and select Add new.
4. Select Tanium from the list of providers.
5. Enter any Name for the integration.
6. For Port, enter 17472.
This is the default port used by the Tanium endpoints to communicate inbound and outbound with Cloudflare Access. You may need to modify it to reflect your organization's deployment.
7. Input the public certificate generated in Step 1.
Adding the certificate allows Cloudflare to validate that the response from the Tanium agent is valid.

You can now build Access policies that check device posture signals from the Tanium endpoint.

## Example Access policy

This example will only grant access to users who are part of your team's email domain and running the Tanium agent.

| Action | Rule type | Selector | Value |
| --- | --- | --- | --- |
| Allow | Include | Emails Ending in | @team.com |
|  | Require | Device Posture - Tanium | Managed |

The Tanium rule will require that the device connecting is managed in your Tanium deployment and has checked into the Tanium server in the last 7 days.

## Tanium endpoint signals

| Signal | Value | Description |
| --- | --- | --- |
| Managed | Boolean | Validates that the device is managed in your organization's Tanium account. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## User management

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/users/](https://developers.cloudflare.com/cloudflare-one/identity/users/)

Page options # User management

Manage users in your Zero Trust organization.

- Session management
- Seat management
- SCIM provisioning

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Session management

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/users/session-management/](https://developers.cloudflare.com/cloudflare-one/identity/users/session-management/)

Page options # Session management

A user session determines how long a user can access an Access application without re-authenticating.

## Session durations

When a user logs in to an application protected by Access, Access validates their identity against your Access policies and generates two signed JSON Web Tokens (JWTs):

| Token | Description | Expiration | Storage |
| --- | --- | --- | --- |
| Global session token | Stores the user's identity from the IdP and provides single sign-on (SSO) functionality for all Access applications. | Global session duration | Your Cloudflare team domain |
| Application token | Allows the user to access a specific Access application. | Policy session duration, which defaults to the application session duration | The hostname protected by the Access application |

The user can access the application for the entire duration of the application token's lifecycle. When the application token expires, Cloudflare will automatically issue a new application token if the global token is still valid (and the user's identity still passes your Access policies). If the global token has also expired, the user will be prompted to re-authenticate with the IdP.

The global token expiration is usually set to equal or exceed the application token expiration. Setting a longer global token provides a more secure way to allow for longer user sessions, since the global token cannot be used to directly access an application.

As an analogy, you can think of the global session like a festival where you buy a ticket to enter for the day. For certain rides or areas, the staff may periodically check your ticket to make sure you are authorized to enter. For example, the backstage area may allow ticket holders to go on a 30 minutes tour, after which you need to sign up for another tour. This is analogous to the app session. Now imagine a special policy exists where VIP ticket holders can go backstage for as long as they want. The VIPs have a policy session duration which overrides the default 30 minutes value.

Note

Access and WARP will evaluate identity based on a user's last-known state. If a user authenticates via your Identity Provider, but later authenticates with a different method (such as One-Time PIN), Access will no longer evaluate the user's Identity Provider group memberships. Identity Provider group memberships are created and managed by the IdP and group membership data can only persist in an IdP-based authentication.

### Global session duration

The global session duration determines how often Cloudflare Access prompts the user to log in to their identity provider. You can set a global session duration between 15 minutes and one month. The default value is 24 hours.

To set the global session duration:

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Global session timeout, select Edit,
3. Select the desired timeout duration from the dropdown menu.
4. Select Save.

The user will be required to re-authenticate with the IdP after this period of time.

### Policy session duration

The policy session duration determines how long the user can access a self-hosted Access application. When the user's session expires, Access rechecks their stored user identity against the application's Access policies.

By default, the policy session duration is equal to the application session duration. To configure more granular permissions for specific users, you can change the policy session duration to a value ranging from immediate timeout to one month. For example, you may wish to set the application session duration to seven days for engineers, but set a policy session duration to 24 hours for contractors.

To set the policy session duration:

1. In Zero Trust ‚Üó, go to Access > Policies.
2. Choose a policy and select Configure.
3. Select a Session Duration from the dropdown menu.
4. Save the policy.

Users who match this policy will be issued an application token with this expiration time.

### Application session duration

The application session duration is the default policy session duration for all policies in an Access application. Available session durations range from immediate timeout to one month. The default value is 24 hours.

To set the application session duration:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Choose an application and select Configure.
3. Select a Session Duration from the dropdown menu.
4. Save the application.

Users who match a policy configured with a Same as application session timeout duration will be issued an application token with this expiration time.

#### SaaS applications

Application session durations only control the front door to a SaaS app; Access does not control how long the user can stay in the SaaS app itself. For example, if the user logs out of the SaaS app and then comes back to it, a valid Access application token allows them to re-authenticate without another login. The SaaS app issues its own authorization cookie that manages the user's session within the app.

#### SSH, RDP, and VNC

Cloudflare does not control the length of an active SSH, VNC, or RDP session. Application session durations determine the window in which a user can initiate a new connection or refresh an existing one.

### WARP session duration

When WARP authentication identity is enabled for an Access application, the WARP session duration overrides the application and policy session durations. If the global session expires but the user already has a valid WARP session, the user will not need to reauthenticate with the IdP until the WARP session expires, given the user is running WARP.

### Order of enforcement

The following flowchart illustrates how Access enforces user sessions for a self-hosted application.

```
flowchart TB
    %% Accessibility
    accTitle: Access session durations
    accDescr: Flowchart describing the order of enforcement for Access sessions

    %% In with user traffic
    start["User goes to Access application"]
    start--"WARP authentication enabled" -->warpsession[WARP session expired?]
    start-- "WARP authentication disabled" --> policysession[Policy session expired?]

		warpsession--"Yes"-->idp[Prompt to log in to IdP]
		warpsession--"No"-->accessgranted[Access granted]

		policysession--"Yes"-->globalsession[Global session expired?]
		policysession--"No"-->accessgranted

		globalsession--"Yes"-->idp
		globalsession--"No"-->refreshtoken[Check identity against Access policies]
		refreshtoken-->accessgranted
		idp-->refreshtoken
```

## Revoke user sessions

Access provides two options for revoking user sessions: per-application and per-user.

### Per-Application

To immediately terminate all active sessions for a specific application:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Locate the application for which you would like to revoke active sessions and select Configure.
3. Select Revoke existing tokens.

Unless there are changes to rules in the policy, users can start a new session if their profile in your identity provider is still active.

### Per-User

Access can immediately revoke a single user session across all applications in your account. However, if the user's identity profile is still active, they can generate a new session.

If you want to permanently revoke a user's access:

1. Disable their account in your identity provider so that they cannot authenticate.
2. In Zero Trust ‚Üó, go to My Team > Users.
3. Select the checkbox next to the user you want to revoke.
4. Select Action > Revoke access.

The user will no longer be able to log in to any application protected by Access. The user will still count towards your seat subscription until you remove the user from your account.

### Subsequent Logins

When administrators revoke a user's Cloudflare Access token, that user will not be able to log in again for up to 1 minute. If they attempt to do so, Cloudflare Access will display an error.

## Log out as a user

To log out of Access, the end user can visit either of the following URLs:

- <your-application-domain>/cdn-cgi/access/logout
- <your-team-name>.cloudflareaccess.com/cdn-cgi/access/logout

This action revokes the user's session across all applications. Access will immediately clear the authorization cookie from the user's browser, and all previously issued tokens will stop being accepted in 20-30 seconds. The only difference between these two URLs is which domain the authorization cookie is deleted from. For example, going to <your-application-domain>/cdn-cgi/access/logout will remove the application cookie and make the logout action feel more instantaneous.

You can use these URLs to create custom logout buttons or links directly within your application.

Note

At this time, end users cannot log themselves out on a per-application basis.

## AJAX

Pages that rely heavily on AJAX or single-page applications can block sub-requests due to an expired Access token without prompting the user to re-authenticate.

You can configure Access to provide a 401 response on sub-requests with an expired session token. We recommend using this response code to either force a page refresh or to display a message to the user that their session has expired.

In order to receive a 401 for an expired session, add the following header to all AJAX requests:

X-Requested-With: XMLHttpRequest

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Seat management

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/users/seat-management/](https://developers.cloudflare.com/cloudflare-one/identity/users/seat-management/)

Page options # Seat management

Cloudflare Zero Trust subscriptions consist of seats that active users in your account consume. Active users are added to Zero Trust through any authentication event.

The amount of seats available in your Zero Trust account depends on the amount of users you purchase. If you want to increase the number of seats available, you will have to purchase more users. Learn more about adding and removing seats from your account in the Zero Trust FAQ.

## Authentication events

A user consumes a seat when they perform an authentication event. For Access, this is any Cloudflare Access authentication event, such as a login to the App Launcher or an application. For Gateway, this is when any devices associated with the user connect to Zero Trust within the specified period.

If either one of these events occurs, that user's identity is added as an Active user to Zero Trust and consumes one seat from your plan. The user will occupy and consume a single seat regardless of the number of applications accessed or login events from their user account. Once the total amount of seats in the subscription has been consumed, additional users who attempt to log in are blocked.

A user who authenticates will hold their seat until you remove the user from your account. By default, inactive users will not be automatically removed from your account. You can remove a single user or all users at any time, and those users will immediately stop counting against the seat count defined in your subscription.

If you notice a number of accounts greater than the number of your users, you may need to configure an Access bypass policy. Alternatively, you can use Access service tokens to allow access to applications without consuming seats.

## Manage users

### Check number of seats used

To check the number of seats consumed by active users in your organization, log in to Zero Trust ‚Üó. Zero Trust overview will display the amount of seats consumed and the remaining amount available. For more details on your users, go to My team > Users.

### Revoke a user

When you revoke a user, this action will terminate active sessions, but will not remove the user's consumption of an active seat.

To revoke a user from your Zero Trust organization:

1. In Zero Trust ‚Üó, go to My team > Users.
2. Select the checkbox next to a user with an Active status in the Seat usage column.
3. Select Action > Revoke.
4. Select Revoke sessions.

Revoked users can still log in if your policies allow them.

### Remove a user

Removing a user from your Zero Trust organization will free up the seat the user consumed. The user will still appear in your list of users.

To remove a user from your Zero Trust organization:

1. In Zero Trust ‚Üó, go to My team > Users.
2. Select the checkbox next to a user with an Active status in the Seat usage column.
3. Select Action > Remove users.
4. Select Remove.

The user will now show as Inactive and will no longer occupy a seat. If a user is removed but authenticates later, they will consume a seat again.

To automate the removal of users who have not logged in or triggered a device enrollment in a specific amount of time, turn on seat expiration.

User record persistence

You cannot delete or archive a user record. You can remove a user from a seat, but their user record will remain in your Zero Trust organization. Inactive users do not count towards billing.

### Enable seat expiration

Cloudflare Zero Trust can automatically remove any user who does not log in to an Access application or whose device does not show any Gateway activity for the specified period (between one month and one year). To determine if a user will be removed, Cloudflare looks for any authentication events and checks the Last seen value for all of the user's devices. If both of those are outside the expiration window, the user will be removed and will no longer count against your number of seats. This process occurs once daily for an account.

To enable user seat expiration:

1. In Zero Trust ‚Üó, go to Settings > Account.
2. In Seat Expiration, select Edit.
3. Select an inactivity time from the dropdown menu.
4. Select Save.

If a user is removed but authenticates later, they will consume a seat again.

For more information about removing a user for Access and Gateway, refer to the FAQ.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SCIM provisioning

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/users/scim/](https://developers.cloudflare.com/cloudflare-one/identity/users/scim/)

Page options # SCIM provisioning

System for Cross-domain Identity Management (SCIM) is an open standard protocol that allows identity providers to synchronize user identity information with cloud applications and services. After configuring SCIM, user identities that you create, edit, or delete in the identity provider are automatically updated across all supported applications. This makes it easier for IT admins to onboard new users, update their groups and permissions, and revoke access in the event of an employee termination or security breach.

Note

This section covers SCIM provisioning for Cloudflare Zero Trust only. To provision access to your Cloudflare account, you will need to set up a distinct dashboard SSO SCIM integration in your IdP. You can assign users and groups to this new SCIM application to define who can access the Cloudflare dashboard.

Users provisioned via the Zero Trust SCIM integration will not have access to your Cloudflare dashboard unless you have manually added them to your Cloudflare dashboard SSO application.

## Supported identity providers

Cloudflare Access supports SCIM provisioning for all SAML and OIDC identity providers that use SCIM version 2.0.

## Sync users and groups in Zero Trust policies

Cloudflare Access can automatically deprovision users from Zero Trust after they are deactivated in the identity provider and display synchronized group names in the Access and Gateway policy builders. Cloudflare does not provision new users in Zero Trust when they are added to the identity provider -- users must first register a device with the WARP client or authenticate to an Access application.

To set up SCIM for Zero Trust, refer to our SSO integration guides.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Service tokens

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/service-tokens/](https://developers.cloudflare.com/cloudflare-one/identity/service-tokens/)

Page options # Service tokens

You can provide automated systems with service tokens to authenticate against your Zero Trust policies. Cloudflare Access will generate service tokens that consist of a Client ID and a Client Secret. Automated systems or applications can then use these values to reach an application protected by Access.

This section covers how to create, renew, and revoke a service token.

## Create a service token

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Access > Service Auth > Service Tokens.
2. Select Create Service Token.
3. Name the service token. The name allows you to easily identify events related to the token in the logs and to revoke the token individually.
4. Choose a Service Token Duration. This sets the expiration date for the token.
5. Select Generate token. You will see the generated Client ID and Client Secret for the service token, as well as their respective request headers.
6. Copy the Client Secret.
WarningThis is the only time Cloudflare Access will display the Client Secret. If you lose the Client Secret, you must generate a new service token.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Access: Service Tokens Write
2. Access: Service Tokens Write
3. Configure the cloudflare_zero_trust_access_service_token ‚Üó resource:
resource "cloudflare_zero_trust_access_service_token" "example_service_token" {  account_id = var.cloudflare_account_id  name       = "Example service token"  duration  = "8760h"
  lifecycle {    create_before_destroy = true  }}
4. Get the Client ID and Client Secret of the service token:
 Example: Output to CLI
 
Output the Client ID and Client Secret to the Terraform state file:
output "example_service_token_client_id" {  value     = cloudflare_zero_trust_access_service_token.example_service_token.client_id}
output "example_service_token_client_secret" {  value     = cloudflare_zero_trust_access_service_token.example_service_token.client_secret  sensitive = true}

Apply the configuration:
Terminal windowterraform apply

Read the Client ID and Client Secret:
Terminal windowterraform output -raw example_service_token_client_id
Terminal windowterraform output -raw example_service_token_client_secret

 
 Example: Store in HashiCorp Vault
   resource "vault_generic_secret" "example_service_token" {    path         = "kv/cloudflare/example_service_token"
    data_json = jsonencode({      "CLIENT_ID"     = cloudflare_access_service_token.example_service_token.client_id      "CLIENT_SECRET" = cloudflare_access_service_token.example_service_token.client_secret    })  }
5. Output the Client ID and Client Secret to the Terraform state file:
output "example_service_token_client_id" {  value     = cloudflare_zero_trust_access_service_token.example_service_token.client_id}
output "example_service_token_client_secret" {  value     = cloudflare_zero_trust_access_service_token.example_service_token.client_secret  sensitive = true}
6. Apply the configuration:
Terminal windowterraform apply
7. Read the Client ID and Client Secret:
Terminal windowterraform output -raw example_service_token_client_id
Terminal windowterraform output -raw example_service_token_client_secret

You can now configure your Access applications and device enrollment permissions to accept this service token. Make sure to set the policy action to Service Auth; otherwise, Access will prompt for an identity provider login.

## Connect your service to Access

### Initial request

To authenticate to an Access application using your service token, add the following to the headers of any HTTP request:

CF-Access-Client-Id: <CLIENT_ID>

CF-Access-Client-Secret: <CLIENT_SECRET>

For example,

Terminal window ```
curl -H "CF-Access-Client-Id: <CLIENT_ID>" -H "CF-Access-Client-Secret: <CLIENT_SECRET>" https://app.example.com
```

If the service token is valid, Access generates a JWT scoped to the application in the form of a CF_Authorization cookie. You can use this cookie to authenticate subsequent requests to the application.

#### Authenticate with a single header

You can configure a self-hosted Access application to accept a service token in a single HTTP header, as an alternative to the CF-Access-Client-Id and CF-Access-Client-Secret pair of headers. This is useful for authenticating SaaS services that only support sending one custom header in a request (for example, the Authorization header).

To authenticate using a single header:

1. Get your existing Access application configuration:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Access: Apps and Policies WriteAccess: Apps and Policies Read Get an Access applicationcurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/apps/$APP_ID" \  --request GET \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
2. Access: Apps and Policies Write
3. Access: Apps and Policies Read
4. Make a PUT request with the name of the header you want to use for service token authentication. To avoid overwriting your existing configuration, the PUT request body should contain all fields returned by the previous GET request.
 Required API token permissions
 
At least one of the following token permissions 
is required:
Access: Apps and Policies Write Update an Access applicationcurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/apps/$APP_ID" \  --request PUT \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "domain": "app.example.com",    "type": "self_hosted",    "read_service_tokens_from_header": "Authorization"  }'
5. Access: Apps and Policies Write
6. Add the header to any HTTP request. For example,
Terminal windowcurl -H "Authorization: {\"cf-access-client-id\": \"<CLIENT_ID>\", \"cf-access-client-secret\": \"<CLIENT_SECRET>\"}" https://app.example.com

### Subsequent requests

After you have authenticated to the application using the service token, add the resulting CF_Authorization cookie to the headers of all subsequent requests:

Terminal window ```
curl -H "cookie: CF_Authorization=<CF_AUTHORIZATION_COOKIE>" https://app.example.com
```

If you prefer to use a raw header, send the value as cf-access-token:

Terminal window ```
curl -H "cf-access-token: <CF_AUTHORIZATION_COOKIE>" https://app.example.com
```

All requests with this cookie will succeed until the JWT expires.

Note

If your Access application only has Service Auth policies, you must send the service token on every subsequent request. You can only use the JWT if the application has at least one Allow policy.

## Renew service tokens

Service tokens expire according to the token duration you selected when you created the token.

To renew the service token:

1. In Zero Trust ‚Üó, go to Access > Service auth > Service Tokens.
2. Locate the token you want to renew.
3. To extend the token's lifetime by one year, select Refresh.
4. To extend the token's lifetime by more than a year:

Select Edit.
Choose a new Service Token Duration.
Select Save. The expiration date will be extended by the selected amount of time.
5. Select Edit.
6. Choose a new Service Token Duration.
7. Select Save. The expiration date will be extended by the selected amount of time.

## Revoke service tokens

If you need to revoke access before the token expires, simply delete the token.

1. In Zero Trust ‚Üó, go to Access > Service auth > Service Tokens.
2. Delete the token you need to revoke.

Services that rely on a deleted service token can no longer reach your application.

Note

When editing an Access application, selecting Revoke existing tokens revokes existing sessions but does not prevent the user from starting a new session. As long as the Client ID and Client Secret are still valid, they can be exchanged for a new token on the next request. To revoke access, you must delete the service token.

## Set a token expiration alert

An alert can be configured to notify a week before a service token expires to allow an administrator to invoke a token refresh.

Expiring Access Service Token Alert

Who is it for? Access customers who want to receive a notification when their service token is about to expire.

Other options / filters None.

Included with Purchase of Access

What should you do if you receive one? Extend the expiration date of the service token. For more details, refer to Renew your service token.

To configure a service token expiration alert:

1. In the Cloudflare dashboard ‚Üó, go to the Notifications page.
  Go to Notifications
2. Select Add.
3. Select Expiring Access Service Token.
4. Enter a name for your alert and an optional description.
5. (Optional) Add other recipients for the notification email.
6. Select Save.

Your alert has been set and is now visible on the Notifications page.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Authorization cookie

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/authorization-cookie/](https://developers.cloudflare.com/cloudflare-one/identity/authorization-cookie/)

Page options # Authorization cookie

When you protect a site with Cloudflare Access, Cloudflare checks every HTTP request bound for that site to ensure that the request has a valid CF_Authorization cookie. If a request does not include the cookie, Access will block the request.

## Access JWTs

The CF_Authorization cookie contains the user's identity in the form of a JSON Web Token (JWT) ‚Üó. Cloudflare securely creates these tokens through the OAUTH or SAML integration between Cloudflare Access and the configured identity provider.

Access generates two separate CF_Authorization tokens depending on the domain:

- Global session token: Generated when a user logs in to Access. This token is stored as a cookie at your team domain (for example, https://<your-team-name>.cloudflareaccess.com) and prevents a user from needing to log in to each application.
- Application token: Generated for each application that a user reaches. This token is stored as a cookie on the protected domain (for example, https://jira.site.com) and may be used to validate requests on your origin.

### Multi-domain applications

Cloudflare Access allows you to protect and manage multiple domains in a single self-hosted application. After a user has successfully authenticated to one domain, Access will automatically issue a CF_Authorization cookie when they go to another domain in the same Access application. This means that users only need to authenticate once to a multi-domain application.

For Access applications with five or less domains, Access will preemptively set the cookie for all domains through a series of redirects. This allows single-page applications (SPAs) to retrieve data from other subdomains, even if the user has not explicitly visited those subdomains. Note that we cannot set cookies up-front for a wildcarded subdomain, because we do not know which concrete subdomain to redirect to (wildcarded paths are allowed).

If the Access application has more than five domains, Access will not preemptively set any cookies. Cookies are only issued as the user visits each domain. This limitation is to avoid latency issues that could affect the user experience.

## Access cookies

The following Access cookies are essential to Access functionality. Cookies that are marked as required cannot be opted out of. The following cookies are not used for tracking or analytics.

### CF_Authorization (team domain)

| Details | Expiration | HttpOnly | SameSite | Required? |
| --- | --- | --- | --- | --- |
| JSON web token (JWT) set on the cloudflareaccess.com team domain that contains the user's identity and enables Access to perform single sign-on (SSO) | ViewIf set, adheres to global session duration.If not, adheres to application session duration.If neither are set, defaults to 24 hours. | Yes | None | Required |

### CF_Authorization (Access application domain)

| Details | Expiration | HttpOnly | SameSite | Required? |
| --- | --- | --- | --- | --- |
| JSON web token (JWT) set on the domain protected by Access that allows Access to confirm that the user has been authenticated and is authorized to reach the origin | ViewIf set, adheres to policy session duration.If not, adheres to application session duration.If neither are set, defaults to 24 hours. | Admin choice (Default: None) | Admin choice (Default: None) | Required |

### CF_Binding

| Details | Expiration | HttpOnly | SameSite | Required? |
| --- | --- | --- | --- | --- |
| Refer to Binding cookie | ViewIf set, adheres to policy session duration.If not, adheres to application session duration.If neither are set, defaults to 24 hours. | Yes | None | Optional |

### CF_Session

| Details | Expiration | HttpOnly | SameSite | Required? |
| --- | --- | --- | --- | --- |
| CSRF ‚Üó token used on the cloudflareaccess.com team domain | 4 hours | Yes | None | Required |

### CF_AppSession

| Details | Expiration | HttpOnly | SameSite | Required? |
| --- | --- | --- | --- | --- |
| CSRF ‚Üó token used per application domain, scoped to individual applications behind Access | 24 hours | Yes | None | Required |

### CF_Device

| Details | Expiration | HttpOnly | SameSite | Required? |
| --- | --- | --- | --- | --- |
| Cookie used to help prevent abuse of the Access OTP flow ‚Üó | 30 days | Yes | Strict | Required |

## Cookie settings

Cloudflare Access provides optional security settings that can be added to the browser cookies generated by Access for an authenticated user.

- SameSite
- HttpOnly flag
- Binding cookie
- Cookie path

To enable these settings:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Locate the application you would like to configure and select Edit.
3. Select Settings and scroll down to Cookie settings.
4. Configure the desired cookie settings.
5. Select Save application.

### SameSite Attribute

The SameSite ‚Üó Attribute selector restricts the cookie to only being sent if the cookie's defined site matches the site being requested in the browser. This adds protection against cross-site request forgery (CSRF) ‚Üó.

The selector options are:

- None - Cookies will be sent in all contexts, including cross-origin requests.
- Lax - Cookies are allowed to be sent with top-level navigations and will be sent along with GET requests initiated by third party websites.
- Strict - Cookies will only be sent in a first-party context and not be sent along with requests initiated by third party websites.

Refer to the Mozilla documentation ‚Üó for more information.

#### When not to use SameSite

Do not enable SameSite restrictions if you have additional sites or applications that rely on a specific application's authorization cookie.

### HttpOnly

The HttpOnly flag is a cookie attribute that prevents the cookie from being accessed by any client-side scripts, reducing the likelihood of Cross-Site Scripting (XSS) attacks. This flag is enabled by default.

#### When not to use HttpOnly

Do not enable HttpOnly if:

- You are using the Access application for non-browser based tools (such as SSH or RDP).
- You have software that relies on being able to access a user's cookie generated by Access.

### Binding cookie

The binding cookie (CF_Binding) is an optional cookie issued when a user successfully authenticates. The binding cookie is sent by the user‚Äôs browser and tied to a specific application‚Äôs CF_Authorization cookie. This cookie is stripped at Cloudflare's edge and never forwarded to the origin server.

Binding cookies protect users' CF_Authorization cookies from possible malicious origins. If a request arrives to Cloudflare's network without the expected binding cookie, Cloudflare rejects the CF_Authorization cookie.

#### When not to use Binding Cookie

Do not enable Binding Cookie if:

- You are using the Access application for non-browser based tools (such as SSH or RDP).
- You have enabled incompatible Cloudflare products on the application domain.
- You have turned on WARP authentication identity for the application.

### Cookie Path Attribute

The Cookie Path Attribute adds the application's path URL to the CF_Authorization cookie. When enabled, a user who logs in to example.com/path1 must re-authenticate to access example.com/path2. When disabled, the CF_Authorization cookie is only scoped to the domain and subdomain.

## Allow third-party cookies in the browser

By default, some browsers block all third-party cookies in private browsing mode, including the CF_Authorization cookie. For XHR requests to work in private windows, you will need to exempt your application and team domain from the browser's tracking protection system.

To enable third-party cookies for an Access application:

Chrome

1. Go to Settings > Privacy and security > Cookies and other site data.
2. Under Sites that can always use cookies, add the following URLs:

Hostname of your Access application (for example, https://jira.site.com)
https://<your-team-name>.cloudflareaccess.com
3. Hostname of your Access application (for example, https://jira.site.com)
4. https://<your-team-name>.cloudflareaccess.com

Safari

1. Go to Safari > Settings > Privacy.
2. Deselect Block all cookies.

Firefox

1. Go to Settings > Privacy & Security.
2. Scroll down to Cookies and Site Data.
3. Select Manage Exceptions.
4. Enter the URL of your Access application (for example, https://jira.site.com) and select Allow.
5. Enter https://<your-team-name>.cloudflareaccess.com and select Allow.
6. Select Save Changes.

Brave

1. Go to brave://settings/cookies.
2. Under Sites that can always use cookies, add the following URLs:

Hostname of your Access application (for example, https://jira.site.com)
https://<your-team-name>.cloudflareaccess.com
3. Hostname of your Access application (for example, https://jira.site.com)
4. https://<your-team-name>.cloudflareaccess.com

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Validate JWTs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/authorization-cookie/validating-json/](https://developers.cloudflare.com/cloudflare-one/identity/authorization-cookie/validating-json/)

Page options # Validate JWTs

When Cloudflare sends a request to your origin, the request will include an application token as a Cf-Access-Jwt-Assertion request header. Requests made through a browser will also pass the token as a CF_Authorization cookie.

Cloudflare signs the token with a key pair unique to your account. You should validate the token with your public key to ensure that the request came from Access and not a malicious third party. We recommend validating the Cf-Access-Jwt-Assertion header instead of the CF_Authorization cookie, since the cookie is not guaranteed to be passed.

## Access signing keys

The public key for the signing key pair is located at https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/certs, where <your-team-name> is your Zero Trust team name.

By default, Access rotates the signing key every 6 weeks. This means you will need to programmatically or manually update your keys as they rotate. Previous keys remain valid for 7 days after rotation to allow time for you to make the update.

You can also manually rotate the key using the API. This can be done for testing or security purposes.

As shown in the example below, https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/certs contains two public keys: the current key used to sign all new tokens, and the previous key that has been rotated out.

- keys: both keys in JWK format
- public_cert: current key in PEM format
- public_certs: both keys in PEM format

```
{  "keys": [    {      "kid": "1a1c3986a44ce6390be42ec772b031df8f433fdc71716db821dc0c39af3bce49",      "kty": "RSA",      "alg": "RS256",      "use": "sig",      "e": "AQAB",      "n": "5PKw-...-AG7MyQ"    },    {      "kid": "6c3bffef71bb0a90c9cbef3b7c0d4a1c7b4b8b76b80292a623afd9dac45d1c65",      "kty": "RSA",      "alg": "RS256",      "use": "sig",      "e": "AQAB",      "n": "pwVn...AA6Hw"    }  ],  "public_cert": {    "kid": "6c3bffef71bb0a90c9cbef3b7c0d4a1c7b4b8b76b80292a623afd9dac45d1c65",    "cert": "-----BEGIN CERTIFICATE----- ... -----END CERTIFICATE----- "  },  "public_certs": [    {      "kid": "1a1c3986a44ce6390be42ec772b031df8f433fdc71716db821dc0c39af3bce49",      "cert": "-----BEGIN CERTIFICATE----- ... -----END CERTIFICATE----- "    },    {      "kid": "6c3bffef71bb0a90c9cbef3b7c0d4a1c7b4b8b76b80292a623afd9dac45d1c65",      "cert": "-----BEGIN CERTIFICATE----- ... -----END CERTIFICATE----- "    }  ]}
```

Avoid key rotation issues

- Validate tokens using the external endpoint rather than saving the public key as a hard-coded value.
- Do not fetch the current key from public_cert, since your origin may inadvertently read an expired value from an outdated cache. Instead, match the kid value in the JWT to the corresponding certificate in public_certs.

## Verify the JWT manually

To verify the token manually:

1. Copy the JWT from the Cf-Access-Jwt-Assertion request header.
2. Go to jwt.io ‚Üó.
3. Select the RS256 algorithm.
4. Paste the JWT into the Encoded box.
5. In the Payload box, ensure that the iss field points to your team domain (https://<your-team-name>.cloudflareaccess.com). jwt.io uses the iss value to fetch the public key for token validation.
6. Ensure that the page says Signature Verified.

You can now trust that this request was sent by Access.

## Programmatic verification

You can run an automated script on your origin server to validate incoming requests. The provided sample code gets the application token from a request and checks its signature against your public key. You will need to insert your own team domain and Application Audience (AUD) tag into the sample code.

### Get your AUD tag

Cloudflare Access assigns a unique AUD tag to each application. The aud claim in the token payload specifies which application the JWT is valid for.

To get the AUD tag:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Configure for your application.
3. From the Basic information tab, copy the Application Audience (AUD) Tag.

You can now paste the AUD tag into your token validation script. The AUD tag will never change unless you delete or recreate the Access application.

### Golang example

```
package main
import (    "context"    "fmt"    "net/http"
    "github.com/coreos/go-oidc/v3/oidc")
var (    ctx        = context.TODO()    teamDomain = "https://test.cloudflareaccess.com"    certsURL   = fmt.Sprintf("%s/cdn-cgi/access/certs", teamDomain)
    // The Application Audience (AUD) tag for your application    policyAUD = "4714c1358e65fe4b408ad6d432a5f878f08194bdb4752441fd56faefa9b2b6f2"
    config = &oidc.Config{        ClientID: policyAUD,    }    keySet   = oidc.NewRemoteKeySet(ctx, certsURL)    verifier = oidc.NewVerifier(teamDomain, keySet, config))
// VerifyToken is a middleware to verify a CF Access tokenfunc VerifyToken(next http.Handler) http.Handler {    fn := func(w http.ResponseWriter, r *http.Request) {        headers := r.Header
        // Make sure that the incoming request has our token header        //  Could also look in the cookies for CF_AUTHORIZATION        accessJWT := headers.Get("Cf-Access-Jwt-Assertion")        if accessJWT == "" {            w.WriteHeader(http.StatusUnauthorized)            w.Write([]byte("No token on the request"))            return        }
        // Verify the access token        ctx := r.Context()        _, err := verifier.Verify(ctx, accessJWT)        if err != nil {            w.WriteHeader(http.StatusUnauthorized)            w.Write([]byte(fmt.Sprintf("Invalid token: %s", err.Error())))            return        }        next.ServeHTTP(w, r)    }    return http.HandlerFunc(fn)}
func MainHandler() http.Handler {    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {        w.Write([]byte("welcome"))    })}
func main() {    http.Handle("/", VerifyToken(MainHandler()))    http.ListenAndServe(":3000", nil)}
```

### Python example

pip install the following:

- flask
- requests
- PyJWT
- cryptography

```
from flask import Flask, requestimport requestsimport jwtimport jsonimport osapp = Flask(__name__)

# The Application Audience (AUD) tag for your applicationPOLICY_AUD = os.getenv("POLICY_AUD")
# Your CF Access team domainTEAM_DOMAIN = os.getenv("TEAM_DOMAIN")CERTS_URL = "{}/cdn-cgi/access/certs".format(TEAM_DOMAIN)
def _get_public_keys():    """    Returns:        List of RSA public keys usable by PyJWT.    """    r = requests.get(CERTS_URL)    public_keys = []    jwk_set = r.json()    for key_dict in jwk_set['keys']:        public_key = jwt.algorithms.RSAAlgorithm.from_jwk(json.dumps(key_dict))        public_keys.append(public_key)    return public_keys
def verify_token(f):    """    Decorator that wraps a Flask API call to verify the CF Access JWT    """    def wrapper():        token = ''        if 'CF_Authorization' in request.cookies:            token = request.cookies['CF_Authorization']        else:            return "missing required cf authorization token", 403        keys = _get_public_keys()
        # Loop through the keys since we can't pass the key set to the decoder        valid_token = False        for key in keys:            try:                # decode returns the claims that has the email when needed                jwt.decode(token, key=key, audience=POLICY_AUD, algorithms=['RS256'])                valid_token = True                break            except:                pass        if not valid_token:            return "invalid token", 403
        return f()    return wrapper

@app.route('/')@verify_tokendef hello_world():    return 'Hello, World!'

if __name__ == '__main__':    app.run()
```

### JavaScript example

```
const express = require("express");const jose = require("jose");
// The Application Audience (AUD) tag for your applicationconst AUD = process.env.POLICY_AUD;
// Your CF Access team domainconst TEAM_DOMAIN = process.env.TEAM_DOMAIN;const CERTS_URL = `${TEAM_DOMAIN}/cdn-cgi/access/certs`;
const JWKS = jose.createRemoteJWKSet(new URL(CERTS_URL));
// verifyToken is a middleware to verify a CF authorization tokenconst verifyToken = async (req, res, next) => {  const token = req.headers["cf-access-jwt-assertion"];
  // Make sure that the incoming request has our token header  if (!token) {    return res.status(403).send({      status: false,      message: "missing required cf authorization token",    });  }
  const result = await jose.jwtVerify(token, JWKS, {    issuer: TEAM_DOMAIN,    audience: AUD,  });
  req.user = result.payload;  next();};
const app = express();
app.use(verifyToken);
app.get("/", (req, res) => {  res.send("Hello World!");});
app.listen(3333);
```

## Related resources

- Verifying JWTs in Cloudflare Workers ‚Üó - Implement JWT verification in Cloudflare Workers.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Application token

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/authorization-cookie/application-token/](https://developers.cloudflare.com/cloudflare-one/identity/authorization-cookie/application-token/)

Page options # Application token

Cloudflare Access includes the application token with all authenticated requests to your origin. A typical JWT looks like this:

eyJhbGciOiJSUzI1NiIsImtpZCI6IjkzMzhhYmUxYmFmMmZlNDkyZjY0.eyJhdWQiOlsiOTdlMmFhZ TEyMDEyMWY5MDJkZjhiYzk5ZmMzNDU5MTNh.zLYsHmLEginAQUXdygQo08gLTExWNXsN4jBc6PKdB

As shown above, the JWT contains three Base64-URL values separated by dots:

- Header
- Payload
- Signature

Unless your application is connected to Access through Cloudflare Tunnel, your application must validate the token to ensure the security of your origin. Validation of the header alone is not sufficient ‚Äî the JWT and signature must be confirmed to avoid identity spoofing.

## Header

```
{  "alg": "RS256",  "kid": "9338abe1baf2fe492f646a736f25afbf7b025e35c627be4f60c414d4c73069b8",  "typ": "JWT"}
```

- alg identifies the encoding algorithm.
- kid identifies the key used to sign the token.
- typ designates the token format.

## Payload

The payload contains the actual claim and user information to pass to the application. Payload contents vary depending on whether you authenticated to the application with an identity provider or with a service token.

### Identity-based authentication

```
{  "aud": ["32eafc7626e974616deaf0dc3ce63d7bcbed58a2731e84d06bc3cdf1b53c4228"],  "email": "user@example.com",  "exp": 1659474457,  "iat": 1659474397,  "nbf": 1659474397,  "iss": "https://yourteam.cloudflareaccess.com",  "type": "app",  "identity_nonce": "6ei69kawdKzMIAPF",  "sub": "7335d417-61da-459d-899c-0a01c76a2f94",  "country": "US"}
```

| Field | Description |
| --- | --- |
| aud | Application audience (AUD) tag of the Access application. |
| email | The email address of the authenticated user, verified by the identity provider. |
| exp | The expiration timestamp for the token (Unix time). |
| iat | The issuance timestamp for the token (Unix time). |
| nbf | The not-before timestamp for the token (Unix time), used to check if the token was received before it should be used. |
| iss | The Cloudflare Access domain URL for the application. |
| type | The type of Access token (app for application token or org for global session token). |
| identity_nonce | A cache key used to get the user's identity. |
| sub | The ID of the user. This value is unique to an email address per account. The user would get a different sub if they are removed and re-added to your Zero Trust organization, or if they log into a different organization. |
| country | The country where the user authenticated from. |

#### Custom SAML attributes and OIDC claims

Access allows you to add custom SAML attributes and OIDC claims to your JWT for enhanced verification, if supported by your identity provider. This is configured when you setup your SAML or OIDC provider.

#### User identity

User identity is useful for checking application permissions. For example, your application can validate that a given user is a member of an Okta or Microsoft Entra ID group such as Finance-Team.

Due to cookie size limits and bandwidth considerations, the application token only contains a subset of the user's identity. To get the user's full identity, send the CF_Authorization cookie to https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/get-identity. Your request should be structured as follows:

Terminal window ```
curl -H 'cookie: CF_Authorization=<user-token>' https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/get-identity
```

Access will return a JSON structure containing the following data:

| Field | Description |
| --- | --- |
| email | The email address of the user. |
| idp | Data from your identity provider. |
| geo | The country where the user authenticated from. |
| user_uuid | The ID of the user. |
| devicePosture | The device posture attributes. |
| account_id | The account ID for your organization. |
| iat | The timestamp indicating when the user logged in. |
| ip | The IP address of the user. |
| auth_status | The status if authenticating with mTLS. |
| common_name | The common name on the mTLS client certificate. |
| service_token_id | The Client ID of the service token used for authentication. |
| service_token_status | True if authentication was through a service token instead of an IdP. |
| is_warp | True if the user enabled WARP. |
| is_gateway | True if the user enabled WARP and authenticated to a Zero Trust team. |
| gateway_account_id | An ID generated by the WARP client when authenticated to a Zero Trust team. |
| device_id | The ID of the device used for authentication. |
| version | The version of the get-identity object. |
| device_sessions | A list of all sessions initiated by the user. |

### Service token authentication

```
{  "type": "app",  "aud": ["32eafc7626e974616deaf0dc3ce63d7bcbed58a2731e84d06bc3cdf1b53c4228"],  "exp": 1659474457,  "iss": "https://yourteam.cloudflareaccess.com",  "common_name": "e367826f93b8d71185e03fe518aff3b4.access",  "iat": 1659474397,  "sub": ""}
```

| Field | Description |
| --- | --- |
| type | The type of Access token (app for application token or org for global session token). |
| aud | The application audience (AUD) tag of the Access application. |
| exp | The expiration timestamp of the JWT (Unix time). |
| iss | The Cloudflare Access domain URL for the application. |
| common_name | The Client ID of the service token (CF-Access-Client-Id). |
| iat | The issuance timestamp of the JWT (Unix time). |
| sub | Contains an empty string when authentication was through a service token. |

## Signature

Cloudflare generates the signature by signing the encoded header and payload using the SHA-256 algorithm (RS256). In RS256, a private key signs the JWTs and a separate public key verifies the signature.

For more information on JWTs, refer to jwt.io ‚Üó.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## CORS

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/authorization-cookie/cors/](https://developers.cloudflare.com/cloudflare-one/identity/authorization-cookie/cors/)

Page options # CORS

Cross-Origin Resource Sharing (CORS ‚Üó) is a mechanism that uses HTTP headers to grant a web application running on one origin permission to reach selected resources in a different origin. The web application executes a cross-origin HTTP request when it requests a resource that has a different origin from its own, including domain, protocol, or port.

For a CORS request to reach a site protected by Access, the request must include a valid CF-Authorization cookie. This may require additional configuration depending on the type of request:

- Simple requests ‚Üó are sent directly to the origin, without triggering a preflight request. For configuration instructions, refer to Allow simple requests.
- Preflighted requests ‚Üó cause the browser to send an OPTIONS request before sending the actual request. The OPTIONS request checks which methods and headers are allowed by the origin. For configuration instructions, refer to Allow preflighted requests.

Important

- Do not troubleshoot CORS in Incognito mode, as this will cause disruptions with Access due to CF-Authorization being blocked as a third-party cookie on cross origin requests.
- Safari, in particular Safari 13.1, handles cookies in a unique format. In some cases, this can cause CORS to fail. This will be dependent on Apple releasing a patch for handling cookies. This is known to impact macOS 10.15.4 when running Safari 13.1 (15609.1.20.111.8).

## Allow simple requests

If you make a simple CORS request to an Access-protected domain and have not yet logged in, the request will return a CORS error. There are two ways you can resolve this error:

- Option 1 ‚Äî Log in and refresh the page.
- Option 2 ‚Äî Create a Cloudflare Worker which automatically sends an authentication token. This method only works if both sites involved in the CORS exchange are behind Access.

### Authenticate manually

1. Visit the target domain in your browser. You will see the Access login page.
2. Log in to the target domain. This generates a CF-Authorization cookie.
3. Refresh the page that made the CORS request. The refresh resends the request with the newly generated cookie.

## Allow preflighted requests

If you make a preflighted cross-origin request to an Access-protected domain, the OPTIONS request will return a 403 error. This error occurs regardless of whether you have logged in to the domain. This is because the browser never includes cookies with OPTIONS requests, by design. Cloudflare will therefore block the preflight request, causing the CORS exchange to fail.

There are three ways you can resolve this error:

- Option 1 ‚Äî Bypass OPTIONS requests to origin.
- Option 2 ‚Äî Configure Cloudflare to respond to the OPTIONS request.
- Option 3 ‚Äî Create a Cloudflare Worker which automatically sends an authentication token. This method only works if both sites involved in the CORS exchange are behind Access.

### Bypass OPTIONS requests to origin

You can configure Cloudflare to send OPTIONS requests directly to your origin server. To bypass Access for OPTIONS requests:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Locate the origin that will be receiving OPTIONS requests and select Configure.
3. Go to Advanced settings > Cross-Origin Resource Sharing (CORS) settings.
4. Turn on Bypass options requests to origin. This will remove all existing CORS settings for this application.

It is still important to enforce CORS for the Access JWT -- this option should only be used if you have CORS enforcement established in your origin server.

### Configure response to preflight requests

You can configure Cloudflare to respond to the OPTIONS request on your behalf. The OPTIONS request never reaches your origin. After the preflight exchange resolves, the browser will then send the main request which does include the authentication cookie (assuming you have logged into the Access-protected domain).

To configure how Cloudflare responds to preflight requests:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Locate the origin that will be receiving OPTIONS requests and select Configure.
3. Go to Advanced settings > Cross-Origin Resource Sharing (CORS) settings.
4. Configure these CORS settings ‚Üó to match the response headers sent by your origin.
For example, if you have configured api.mysite.comto return the following headers:
headers: {  'Access-Control-Allow-Origin': 'https://example.com',  'Access-Control-Allow-Credentials' : true,  'Access-Control-Allow-Methods': 'GET, OPTIONS',  'Access-Control-Allow-Headers': 'office',  'Content-Type': 'application/json',}
then go to api.mysite.com in Access and configure Access-Control-Allow-Origin, Access-Control-Allow-Credentials, Access-Control-Allow-Methods, and Access-Control-Allow-Headers.
5. Select Save application.
6. (Optional) You can check your configuration by sending an OPTIONS request to the origin with curl. For example,
Terminal windowcurl --head --request OPTIONS https://api.mysite.com \--header 'origin: https://example.com' \--header 'access-control-request-method: GET'
should return a response similar to:
HTTP/2 200date: Tue, 24 May 2022 21:51:21 GMTvary: Origin, Access-Control-Request-Method, Access-Control-Request-Headersaccess-control-allow-origin: https://example.comaccess-control-allow-methods: GETaccess-control-allow-credentials: trueexpect-ct: max-age=604800, report-uri="https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct"report-to: {"endpoints":[{"url":"https:\/\/a.nel.cloudflare.com\/report\/v3?s=A%2FbOOWJio%2B%2FjuJv5NC%2FE3%2Bo1zBl2UdjzJssw8gJLC4lE1lzIUPQKqJoLRTaVtFd21JK1d4g%2BnlEGNpx0mGtsR6jerNfr2H5mlQdO6u2RdOaJ6n%2F%2BS%2BF9%2Fa12UromVLcHsSA5Y%2Fj72tM%3D"}],"group":"cf-nel","max_age":604800}nel: {"success_fraction":0.01,"report_to":"cf-nel","max_age":604800}server: cloudflarecf-ray: 7109408e6b84efe4-EWR

## Send authentication token with Cloudflare Worker

If you have two sites protected by Cloudflare Access, example.com and api.mysite.com, requests made between the two will be subject to CORS checks. Users who log in to example.com will be issued a cookie for example.com. When the user's browser requests api.mysite.com, Cloudflare Access looks for a cookie specific to api.mysite.com. The request will fail if the user has not already logged in to api.mysite.com.

To avoid having to log in twice, you can create a Cloudflare Worker that automatically sends authentication credentials to api.mysite.com.

### Prerequisites

- Workers account
- wrangler installation
- example.com and api.mysite.com domains protected by Access

### 1. Generate a service token

Follow these instructions to generate a new Access service token. Copy the Client ID and Client Secret to a safe place, as you will use them in a later step.

### 2. Add a Service Auth policy

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Find your api.mysite.com application and select Edit.
3. Select the Policies tab.
4. Add the following policy:















ActionRule typeSelectorService AuthIncludeService Token

### 3. Create a new Worker

Open a terminal and run the following command:

- npm
- yarn
- pnpm

Terminal window ```
npm create cloudflare@latest -- authentication-worker
```

Terminal window ```
yarn create cloudflare authentication-worker
```

Terminal window ```
pnpm create cloudflare@latest authentication-worker
```

This will prompt you to install the create-cloudflare ‚Üó package and lead you through setup.

For setup, select the following options:

- For What would you like to start with?, choose Hello World example.
- For Which template would you like to use?, choose Worker only.
- For Which language do you want to use?, choose JavaScript.
- For Do you want to use git for version control?, choose Yes.
- For Do you want to deploy your application?, choose No (we will be making some changes before deploying).

Go to your project directory.

Terminal window ```
cd authentication-worker
```

Open /src/index.js and delete the existing code and paste in the following example:

```
// The hostname where your API livesconst originalAPIHostname = "api.mysite.com";
export default {  async fetch(request, env) {    // Change just the host. If the request comes in on example.com/api/name, the new URL is api.mysite.com/api/name    const url = new URL(request.url);    url.hostname = originalAPIHostname;
    // If your API is located on api.mysite.com/anyname (without "api/" in the path),    // remove the "api/" part of example.com/api/name
    // url.pathname = url.pathname.substring(4)
    // Best practice is to always use the original request to construct the new request    // to clone all the attributes. Applying the URL also requires a constructor    // since once a Request has been constructed, its URL is immutable.    const newRequest = new Request(url.toString(), request);
    newRequest.headers.set("cf-access-client-id", env.CF_ACCESS_CLIENT_ID);    newRequest.headers.set("cf-access-client-secret", env.CF_ACCESS_CLIENT_SECRET);    try {      const response = await fetch(newRequest);
      // Copy over the response      const modifiedResponse = new Response(response.body, response);
      // Delete the set-cookie from the response so it doesn't override existing cookies      modifiedResponse.headers.delete("set-cookie");
      return modifiedResponse;    } catch (e) {      return new Response(JSON.stringify({ error: e.message }), {        status: 500,      });    }  },};
```

Then, deploy the Worker to your Cloudflare account:

Terminal window ```
npx wrangler deploy
```

### 4. Configure the Worker

1. In the Cloudflare dashboard ‚Üó, go to the Workers & Pages page.
  Go to Compute (Workers)
2. Select your newly created Worker.
3. In the Triggers tab, go to Routes and add example.com/api/*. The Worker is placed on a subpath of example.com to avoid making a cross-origin request.
4. In the Settings tab, select Variables.
5. Under Environment Variables, add the following secret variables:

CF_ACCESS_CLIENT_ID = <service token Client ID>
CF_ACCESS_CLIENT_SECRET = <service token Client Secret>
6. CF_ACCESS_CLIENT_ID = <service token Client ID>
7. CF_ACCESS_CLIENT_SECRET = <service token Client Secret>

The Client ID and Client Secret are copied from your service token.

1. Enable the Encrypt option for each variable and select Save.

### 5. Update HTTP request URLs

Modify your example.com application to send all requests to example.com/api/ instead of api.mysite.com.

HTTP requests should now work seamlessly between two different Access-protected domains. When a user logs in to example.com, the browser makes a request to the Worker instead of to api.mysite.com. The Worker adds the Access service token to the request headers and then forwards the request to api.mysite.com. Since the service token matches a Service Auth policy, the user no longer needs to log in to api.mysite.com.

## Troubleshooting

In general, we recommend the following steps when troubleshooting CORS issues:

1. Capture a HAR file with the issue described, as well as the JS console log output recorded simultaneously. This is because the HAR file alone will not give full visibility on the reason behind cross-origin issues.
2. Ensure that the application has set credentials: 'same-origin' in all fetch or XHR requests.
3. If you are using the cross-origin setting ‚Üó on script tags, these must be set to "use-credentials".

CORS is failing on the same domain

CORS checks do not occur on the same domain. If this error occurs, it is likely the request is being sent without the CF-Authorization cookie.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SSO integration

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/)

Page options # SSO integration

Cloudflare Zero Trust allows you to integrate your organization's identity providers (IdPs) with Cloudflare Access. Your team can simultaneously use multiple providers, reducing friction when working with partners or contractors.

Adding an identity provider as a login method requires configuration both in Zero Trust ‚Üó and with the identity provider itself. Consult our IdP-specific documentation to learn more about what you need to set up.

Note

Cloudflare Zero Trust supports social identity providers that do not require administrator accounts, open source providers, and corporate providers. Cloudflare also supports using signed AuthN requests with SAML providers.

## Set up IdPs in Zero Trust

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. In the Login methods card, select Add new.
3. Select the identity provider you want to add.
If you do not see your identity provider listed, these providers can typically still be enabled. If they support OIDC or OAuth, select the generic OIDC option. If they support SAML, select the generic SAML option. Cloudflare supports all SAML and OIDC providers and can integrate with the majority of OAuth providers. If your provider supports both SAML and OIDC, we recommend OIDC for ease of configuration.
4. Fill in the necessary fields to set up your identity provider.
Each identity provider will have different required fields for you to fill in. Step-by-step instructions are shown in the dashboard side panel. Alternatively, refer to the IdP-specific documentation.
5. Once you have filled in the necessary fields, select Save.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Access: Organizations, Identity Providers, and Groups Write
2. Access: Organizations, Identity Providers, and Groups Write
3. Add an identity provider to Zero Trust using the cloudflare_zero_trust_access_identity_provider ‚Üó resource. For example, to add a Microsoft Entra ID integration:
resource "cloudflare_zero_trust_access_identity_provider" "microsoft_entra_id" {  account_id = var.cloudflare_account_id  name       = "Entra ID example"  type       = "azureAD"  config      = {    client_id                  = var.entra_id_client_id    client_secret              = var.entra_id_client_secret    directory_id               = var.entra_id_directory_id    support_groups             = true    }}
Each identity provider integration has different required attributes. You will need to obtain these attribute values from your identity provider. For more information, refer to the IdP-specific documentation.
If you do not see your identity provider listed, these providers can typically still be enabled. If they support OIDC or OAuth, use the generic OIDC option. If they support SAML, use the generic SAML option. Cloudflare supports all SAML and OIDC providers and can integrate with the majority of OAuth providers. If your provider supports both SAML and OIDC, we recommend OIDC for ease of configuration.

Your IdP will now be listed in the Login methods card.

## Test IdPs in Zero Trust

To test if an IdP is correctly configured, go to Settings > Authentication. Next, select Test next to the IdP you would like to test. This will attempt to connect to the IdP to verify if a valid connection is established.

### Your provider is connected

If your provider is connected, another window will open in your browser, with this message:

### Your provider is not connected

If your provider is not connected, another window will open in your browser. Along with an error message, you will receive a detailed explanation of why the test has failed.

## Use The API

We recommend that you use our dashboard to configure your identity providers. However, if you would like to use the Cloudflare API ‚Üó, each of the identity provider topics covered here include an example API configuration snippet as well.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Generic OIDC

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/generic-oidc/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/generic-oidc/)

Page options # Generic OIDC

Cloudflare Access has a generic OpenID Connect (OIDC) connector to help you integrate IdPs not already set in Access.

## 1. Create an application in your identity provider

1. Visit your identity provider and create a client/app.
2. When creating a client/app, your IdP may request an authorized redirect URI. Enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
3. Copy the content of these fields:

Client ID
Client secret
Auth URL: The authorization_endpoint URL of your IdP
Token URL: The token_endpoint URL of your IdP
Certificate URL: The jwks_uri endpoint of your IdP to allow the IdP keys to sign the tokens

You can find these values on your identity provider's OIDC discovery endpoint. Some providers call this the "well-known URL".
4. Client ID
5. Client secret
6. Auth URL: The authorization_endpoint URL of your IdP
7. Token URL: The token_endpoint URL of your IdP
8. Certificate URL: The jwks_uri endpoint of your IdP to allow the IdP keys to sign the tokens

## 2. Add an OIDC provider to Zero Trust

- Dashboard
- API
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Choose OpenID Connect.
4. Name your identity provider and fill in the required fields with the information obtained from your identity provider.
5. (Optional) Enable Proof of Key Exchange (PKCE) ‚Üó if the protocol is supported by your IdP. PKCE will be performed on all login attempts.
6. (Optional) To enable SCIM, refer to Synchronize users and groups.
7. (Optional) Under Optional configurations, enter custom OIDC claims that you wish to add to users' identity. This information will be available in the user identity endpoint.
8. Select Save.

Make a POST request to the Identity Providers endpoint:

Required API token permissions

At least one of the following token permissions is required: - Access: Organizations, Identity Providers, and Groups Write

Add an Access identity provider ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/identity_providers" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Generic OIDC example",    "type": "oidc",    "config": {        "client_id": "<your client id>",        "client_secret": "<your client secret>",        "auth_url": "https://accounts.google.com/o/oauth2/auth",        "token_url": "https://accounts.google.com/o/oauth2/token",        "certs_url": "https://www.googleapis.com/oauth2/v3/certs",        "pkce_enabled": false,        "email_claim_name": "email",        "claims": [            "employeeID",            "groups"        ],        "scopes": [            "openid",            "email",            "profile"        ]    }  }'
```

1. Add the following permission to your cloudflare_api_token ‚Üó:

Access: Organizations, Identity Providers, and Groups Write
2. Access: Organizations, Identity Providers, and Groups Write
3. Configure the cloudflare_zero_trust_access_identity_provider ‚Üó resource:
resource "cloudflare_zero_trust_access_identity_provider" "generic_oidc_example" {  account_id = var.cloudflare_account_id  name       = "Generic OIDC example"  type       = "oidc"  config      = {    client_id = "<your client id>"    client_secret = "<your client secret>"    auth_url = "https://accounts.google.com/o/oauth2/auth"    token_url = "https://accounts.google.com/o/oauth2/token"    certs_url = "https://www.googleapis.com/oauth2/v3/certs"    pkce_enabled = false    email_claim_name = "email"    claims = ["employeeID", "groups"]    scopes = ["openid", "email", "profile"]  }}

## 3. Test the connection

To test that your connection is working, go to Authentication > Login methods and select Test next to the login method you want to test. On success, a confirmation screen displays.

## Synchronize users and groups

The generic OIDC integration allows you to synchronize user groups and automatically deprovision users using SCIM.

### Prerequisites

Your identity provider must support SCIM version 2.0.

### 1. Enable SCIM in Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Find the IdP integration and select Edit.
3. Turn on Enable SCIM
4. (Optional) Configure the following settings:

- Enable user deprovisioning: Revoke a user's active session when they are removed from the SCIM application in IdP. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies.
- Remove user seat on deprovision: Remove a user's seat from your Zero Trust account when they are removed from the SCIM application in IdP.
- SCIM identity update behavior: Choose what happens in Zero Trust when the user's identity updates in IdP.

Automatic identity updates: Automatically update the User Registry identity when IdP sends an updated identity or group membership through SCIM. This identity is used for Gateway policies and WARP device profiles; Access will read the user's updated identity when they reauthenticate.
Group membership change reauthentication: Revoke a user's active session when their group membership changes in IdP. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies. Access will read the user's updated group membership when they reauthenticate.
No action: Update the user's identity the next time they reauthenticate to Access or WARP.
- Automatic identity updates: Automatically update the User Registry identity when IdP sends an updated identity or group membership through SCIM. This identity is used for Gateway policies and WARP device profiles; Access will read the user's updated identity when they reauthenticate.
- Group membership change reauthentication: Revoke a user's active session when their group membership changes in IdP. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies. Access will read the user's updated group membership when they reauthenticate.
- No action: Update the user's identity the next time they reauthenticate to Access or WARP.

1. Select Regenerate Secret. Copy the SCIM Endpoint and SCIM Secret. You will need to enter these values into IdP.
2. Select Save.

The SCIM secret never expires, but you can manually regenerate the secret at any time.

### 2. Configure SCIM in the IdP

Setup instructions vary depending on the identity provider. In your identity provider, you will either need to edit the original SSO application or create a new SCIM application. Refer to your identity provider's documentation for more details. For example instructions, refer to our Okta or Jumpcloud guides.

#### IdP groups

If you would like to build policies based on IdP groups:

- Ensure that your IdP sends a groups field. The naming must match exactly (case insensitive). All other values will be sent as a OIDC claim.
- If your IdP requires creating a new SCIM application, ensure that the groups in the SCIM application match the groups in the original SSO application. Because SCIM group membership updates will overwrite any groups in a user's identity, assigning the same groups to each app ensures consistent policy evaluation.

### 3. Verify SCIM provisioning

To check if user identities were updated in Zero Trust, view your SCIM provisioning logs.

Note

New users must first register the WARP client or authenticate to an Access application before SCIM provisioning can begin.

## Optional configurations

### Custom OIDC claims

All OIDC IdP integrations support the use of custom OIDC claims. Once configured, Access will add the claims to the Access JWT for consumption by your origin services. You can reference the custom OIDC claims in Access policies, offering a means to control user access to applications based on custom identity attributes. Custom OIDC claims are not currently supported in Gateway policies.

To add a custom OIDC claim to an IdP integration:

1. In your identity provider, ensure that the custom claim is included in your OIDC ID token.
2. In Zero Trust ‚Üó, go to Settings > Authentication.
3. Under Login methods, find your identity provider and select Edit.
4. Under OIDC Claims, enter the name of your custom claim (for example, oid).
5. Select Save.
6. Select Test and verify that the custom claim appears in oidc_fields. For example,
  "oidc_fields": {    "oid": "54eb1ed2-7150-44e6-bbe4-ead24c132fd4"  },

You can now build an Access policy for the custom claim using the OIDC Claim or IdP OIDC Claim selector. The custom claim will also be passed to origins behind Access in a JWT.

#### Email claim

You can specify a custom Email claim name that Access will use to identify user emails. This is useful if your IdP does not return the standard email claim in the OIDC ID token.

#### Multi-record OIDC claims

Cloudflare Access extends support for multi-record OIDC claims. These claims are parsed out and can be individually referenced in policies. This feature enables granular access control and precise user authorization in applications.

Cloudflare Access does not support partial OIDC claim value references or OIDC scopes.

## Supported algorithms for generic OIDC tokens

Cloudflare supports the following algorithms for verifying generic OIDC tokens:

- RS512
- RS256
- PS512
- ES256
- ES384
- ES512

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Generic SAML 2.0

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/generic-saml/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/generic-saml/)

Page options # Generic SAML 2.0

Cloudflare Zero Trust integrates with any identity provider that supports SAML 2.0. If your identity provider is not listed in the integration list of login methods in Zero Trust, it can be configured using SAML 2.0 (or OpenID if OIDC based). Generic SAML can also be used if you would like to pass additional SAML headers or claims for an IdP in the integration list.

## Prerequisites

Minimum requirements for identity providers:

- The IdP must conform to SAML 2.0.
- The IdP must provide a Single sign-on URL, an Entity ID or Issuer URL, and a Signing certificate.
- The IdP must include the signing public key in the SAML response.

## 1. Create an application in your identity provider

Most identity providers allow users to create an Application. In this context, an application is a set of parameters that the identity provider will then pass on to Cloudflare to establish an integration.

The typical setup requirements are:

1. Create a new integration in the identity provider with the type set as SAML.
2. Set both the Entity/Issuer ID and the Single sign-on URL to:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
3. Set the Name ID/Email format to emailAddress.
4. (Optional) Set the signature policy to Always Sign.

### (Optional) Upload SAML metadata

If your identity provider supports metadata file configuration, you can use the default or identity provider specific metadata endpoint:

- Default: https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/saml-metadata
- Identity provider specific: https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/<identity-provider-id>/saml-metadata, where <identity-provider-id> is the id value obtained from List Access identity providers. Use this endpoint if your IdP requires a configuration not defined in the default metadata file.

To download the SAML metadata file, copy-paste the metadata endpoint into a web browser and save the page as an .xml file. Upload this XML file to the identity provider.

## 2. Add a SAML identity provider to Zero Trust

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > Authentication > Login methods.
2. Select Add new and select SAML.
3. Choose a descriptive name for your identity provider.
4. Enter the Single Sign on URL, IdP Entity ID or Issuer URL, and Signing certificate obtained from your identity provider.
5. (Optional) To enable SCIM, refer to Synchronize users and groups.
6. (Optional) Under Optional configurations, configure additional SAML options.
7. Select Save.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Access: Organizations, Identity Providers, and Groups Write
2. Access: Organizations, Identity Providers, and Groups Write
3. Configure the cloudflare_zero_trust_access_identity_provider ‚Üó resource:
resource "cloudflare_zero_trust_access_identity_provider" "generic_saml_example" {  account_id = var.cloudflare_account_id  name       = "Generic SAML example"  type       = "saml"  config      = {    sso_target_url = "https://example.com/1234/sso/saml"    issuer_url = "https://example.com/1234"    idp_public_certs = ["-----BEGIN CERTIFICATE-----\nXXXXX\n-----END CERTIFICATE-----"]    sign_request = false    email_attribute_name = "email"    attributes = ["employeeID", "groups"]  }}

Warning

Set a reminder for the expiry date of the signing certificate obtained from your generic SAML identity provider. After the certificate expires, you will need to generate a new signing certificate and re-add it to your Cloudflare configuration via the Cloudflare dashboard or Terraform.

## 3. Test the connection

You can now test the IdP integration. A success response should return the configured SAML attributes.

## Synchronize users and groups

The generic SAML integration allows you to synchronize user groups and automatically deprovision users using SCIM.

### Prerequisites

Your identity provider must support SCIM version 2.0.

### 1. Enable SCIM in Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Find the IdP integration and select Edit.
3. Turn on Enable SCIM
4. (Optional) Configure the following settings:

- Enable user deprovisioning: Revoke a user's active session when they are removed from the SCIM application in IdP. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies.
- Remove user seat on deprovision: Remove a user's seat from your Zero Trust account when they are removed from the SCIM application in IdP.
- SCIM identity update behavior: Choose what happens in Zero Trust when the user's identity updates in IdP.

Automatic identity updates: Automatically update the User Registry identity when IdP sends an updated identity or group membership through SCIM. This identity is used for Gateway policies and WARP device profiles; Access will read the user's updated identity when they reauthenticate.
Group membership change reauthentication: Revoke a user's active session when their group membership changes in IdP. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies. Access will read the user's updated group membership when they reauthenticate.
No action: Update the user's identity the next time they reauthenticate to Access or WARP.
- Automatic identity updates: Automatically update the User Registry identity when IdP sends an updated identity or group membership through SCIM. This identity is used for Gateway policies and WARP device profiles; Access will read the user's updated identity when they reauthenticate.
- Group membership change reauthentication: Revoke a user's active session when their group membership changes in IdP. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies. Access will read the user's updated group membership when they reauthenticate.
- No action: Update the user's identity the next time they reauthenticate to Access or WARP.

1. Select Regenerate Secret. Copy the SCIM Endpoint and SCIM Secret. You will need to enter these values into IdP.
2. Select Save.

The SCIM secret never expires, but you can manually regenerate the secret at any time.

### 2. Configure SCIM in the IdP

Setup instructions vary depending on the identity provider. In your identity provider, you will either need to edit the original SSO application or create a new SCIM application. Refer to your identity provider's documentation for more details. For example instructions, refer to our Okta or JumpCloud guides.

#### IdP groups

If you would like to build policies based on IdP groups:

- Ensure that your IdP sends a groups field. The naming must match exactly (case insensitive). All other values will be sent as a SAML attribute.
- If your IdP requires creating a new SCIM application, ensure that the groups in the SCIM application match the groups in the original SSO application. Because SCIM group membership updates will overwrite any groups in a user's identity, assigning the same groups to each app ensures consistent policy evaluation.

### 3. Verify SCIM provisioning

To check if user identities were updated in Zero Trust, view your SCIM provisioning logs.

Note

New users must first register the WARP client or authenticate to an Access application before SCIM provisioning can begin.

## Optional configurations

SAML integrations allow you to pass additional headers or claims to applications.

### Sign SAML authentication request

This optional configuration signs the Access JWT with the Cloudflare Access public key to ensure that the JWT is coming from a legitimate source. The Cloudflare public key can be obtained at https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/certs.

### Email attribute name

Many Access policies depend on a user's email address. Some identity providers have a different naming for the email address attribute (for example, Email, e-mail, emailAddress). This can typically be checked in the identity provider's SAML test option.

Example in Okta:

### SAML headers and attributes

Cloudflare Access supports SAML (Security Assertion Markup Language) attributes and SAML headers for all SAML IdP integrations.

SAML attributes refer to specific data points or characteristics that the IdP shares about the authenticated user. These attributes often include details like email address, name, or role, and are passed along to the service provider upon successful authentication.

SAML headers are metadata in the SAML protocol communication which convey information about the sender, recipient, and the message itself. These headers can be leveraged to provide extra context or control over the communication.

#### SAML attributes

SAML attributes are added to the Access JWT. These attributes can then be consumed by self-hosted or SaaS applications connected to Access. Any SAML attribute configured in the SAML integration must also be sent from the IdP.

Example in Okta:

How to receive these SAML attributes in Cloudflare:

#### SAML headers

If an application specifically requires SAML attributes upon sign-in, then the attributes can be passed as headers. The Attribute name should be the value coming from your IdP (for example, department). You can assign any Header name to the attribute. The header name will appear in the response headers when Access makes the initial authorization request to https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback.

#### Multi-record SAML attributes

Cloudflare Access extends support for multi-record SAML attributes such as groups. These attributes are parsed out and can be individually referenced in policies. This feature enables granular access control and precise user authorization in applications.

Cloudflare Access does not currently support partial attribute value references.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Active Directory (SAML)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/adfs/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/adfs/)

Page options # Active Directory (SAML)

Warning

Microsoft recommends migrating your Active Directory Federation Service (AD FS) SSO to Microsoft Entra ID. For more information, refer to Microsoft Learn ‚Üó.

To set up the Microsoft Entra ID IdP integration with Zero Trust, refer to Microsoft Entra ID.

Active Directory is a directory service developed by Microsoft for Windows domain networks. It is included in most Windows Server operating systems as a set of processes and services. Active Directory integrates with Cloudflare Access using Security Assertion Markup Language (SAML).

## Before you start

To get started, you need:

- An Active Directory Domain Controller where all users have an email attribute.
- Generic SAML enabled for your Access Identity Provider (IdP).
- A Microsoft server running with Active Directory Federation Services (AD FS) installed. All screenshots in these instructions are for Server 2012R2. Similar steps will work for newer versions.
- A browser safe certificate for Active Directory Federation Services (AD FS).

Once you fulfill the requirements above, you are ready to begin. Installation and basic configuration of Active Directory Federation Services (AD FS) is outside the scope of this guide. A detailed guide can be found in a Microsoft KB ‚Üó.

Then to begin the connection between Cloudflare Access and AD FS create a Relying Party Trust in AD FS.

## Create a Relying Party Trust

Run the Add Relying Party Trust wizard to begin SAML AD integration with Cloudflare Access.

To create a Relying Party Trust:

1. In Windows Server, launch the ADFS Management tool.
2. Select the Relying Party Trusts folder.
3. On the Actions sidebar, select Add Relying Party Trust. The Add Relying Party Trust Wizard launches.
4. In the left menu, choose Select Data Source.
5. Select the Enter data about the relying party manually option.
6. Select Next.
7. Enter a Display name. We suggest you use a recognizable name. Include any information regarding this connection in the Notes field.
8. Select Next. The Choose Profile step displays.
9. Select the AD FS profile option.
10. Select Next. The Configure Certificate step displays.
11. Leave the Certificate options at their defaults.
12. Select Next. The Configure URL step displays.
13. Select the Enable support for the SAML 2.0 WebSSO protocol option.
14. In the Relying party SAML 2.0 SSO service URL field, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
15. Select Next. The Configure Identifiers step displays.
16. Paste your callback URL in the Relying party trust identifier field.
17. Select Next. In the Configure Multi-factor Authentication Now? step, you can configure multi-factor authentication.
18. Select Next. The Choose Issuance Authorization Rules step displays.
19. Select the Permit all users to access this relying party option.
20. Select Next. The Ready to Add Trust step displays.
21. Review your settings.
22. Select Next. Cloudflare now relies on AD FS for user-identity authorization.

The Edit Claim Rules for CF Login screen automatically displays.

## Create claim rules

Now create 2 Claim Rules so that AD FS can take information from Cloudflare and return it to create Access policies.

If you closed the Add Relying Trust wizard, use Explorer to find the Relying Party Trusts folder, select the newly created RPT file, and select Edit Claim Rules in the Action sidebar.

To create Claim Rules:

1. In the Edit Claim Rules for CF Login window, select Add Rule. The Choose Rule Type step displays.
2. In the Claim rule template field, select Send LDAP Attributes as Claims from the drop-down list.
3. Select Next. The Edit Rule ‚Äî Send Email step displays.
4. Enter a descriptive Claim rule name.
5. Select Active Directory from the Attribute store drop-down list.
6. Select E-mail-Addresses from the LDAP Attribute and Outgoing Claim Type drop-down lists.

AD FS groups

If you wish to use AD FS groups in your SAML claims, use token-groups - unqualified names instead of is-member-of-DL. Using is-member-of-DL will display the group in the form of LDAP paths, whereas token-groups - unqualified names will return only the group name.

1. Select OK. You return to the Choose Rule Type step.
2. Select Transform an Incoming Claim from the Claim rule template drop-down list to create the second rule.
3. Select Next. The Edit - Create Transient Name Identifier window displays.
4. Enter a descriptive Claim rule name.
5. Select E-Mail Address from the Incoming claim type drop-down list.
6. Select Name ID from the Outgoing claim type drop-down list.
7. Select Transient Identifier from the Outgoing name ID format drop-down list.
8. Ensure that the Pass through all claim values option is selected.
9. Select OK.

Both Claim Rules are now available to export to your Cloudflare Access account.

## Export the certificate

Now you'll configure Cloudflare to recognize AD FS by extracting the token-signing certificate from AD FS.

To export the certificate:

1. Within the AD FS management console, select the Service under AD FS and choose the Certificates folder which contains the certificate to export.
2. In the Certificates card, right-click on the entry under Token-signing, and select View certificate. The Certificates window displays.
3. Select the Details tab, and select the Copy to File option.
4. The Certificate Export Wizard displays.
5. Select Next. The Export File Format window displays.
6. Select the Base-64 encoded X.509 (.CER) option.
7. Select Next.
8. Enter a name for the file.
9. Select Next.
10. Select Finish.
Note the file path for later.

## Configure AD FS to sign SAML responses

To ensure that AD FS signs the full response when communicating with Cloudflare, open your local PowerShell and enter the following command:

Terminal window ```
Set-ADFSRelyingPartyTrust -TargetName "Name of RPT Display Name" -SamlResponseSignature "MessageAndAssertion"
```

## Configure Cloudflare Zero Trust

To enable Cloudflare Zero Trust to accept the claims and assertions sent from AD FS, follow these steps:

1. In Zero Trust, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. The Add a SAML identity provider card displays.
4. Enter an IdP Name.
5. Under Single Sign On URL enter:
https://hostnameOfADFS/adfs/ls/
This is the default location. You can find your federation service identifier in AD FS.
6. In the IdP Entity ID or Issuer URL field, enter your Zero Trust team domain and include this callback at the end of the path: /cdn-cgi/access/callback. For example:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
7. Under Signing certificate, paste the exported certificate.
There can be no spaces or return characters in the text field.
8. Select Save.

To test that your connection is working, go to Authentication > Login methods and select Test next to the login method you want to test.

## Download SP metadata (optional)

Some IdPs allow administrators to upload metadata files from their SP (service provider).

To get your Cloudflare metadata file:

1. Download your unique SAML metadata file at the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/saml-metadata
In Cloudflare Access, you can find a link to this URL in the Edit a SAML identity provider dialog. The link returns a web page with your SAML SP data in XML format.
2. Save the file in XML format.
3. Upload the XML document to your Active Directory account.

## Example API Configuration

```
{  "config": {    "issuer_url": "https://<your-team-name>.cloudflareaccess.com/",    "sso_target_url": "https://adfs.example.com/adfs/ls/",    "attributes": ["email"],    "email_attribute_name": "",    "sign_request": false,    "idp_public_cert": "MIIDpDCCAoygAwIBAgIGAV2ka+55MA0GCSqGSIb3DQEBCwUAMIGSMQswCQYDVQQGEwJVUzETMBEG\nA1UEC.....GF/Q2/MHadws97cZg\nuTnQyuOqPuHbnN83d/2l1NSYKCbHt24o"  },  "type": "saml",  "name": "adfs saml example"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Amazon Cognito

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/awscognito-oidc/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/awscognito-oidc/)

Page options # Amazon Cognito

Amazon Cognito provides SSO identity management for end users of web and mobile apps. You can integrate Amazon Cognito as an OIDC identity provider for Cloudflare Zero Trust.

## Prerequisites

- An Amazon Cognito user pool ‚Üó

## Set up Amazon Cognito (OIDC)

### 1. Obtain Amazon Cognito settings

The following Amazon Cognito values are required to set up the integration:

- App (client) ID
- Client secret
- Auth URL
- Token URL
- Certificate (key) URL

To retrieve those values:

1. Log in to your Amazon Cognito admin portal.
2. Go to User pools and select your user pool.
3. Select the App integration tab.
4. Under Domain, copy your user pool domain or configure a new domain ‚Üó.
5. Make note of the following Amazon Cognito OIDC endpoints ‚Üó:

Auth URL: https://<your user pool domain>/oauth2/authorize
Token URL: https://<your user pool domain>/oauth2/token
Certificate (key) URL: https://cognito-idp.<region>.amazonaws.com/<your user pool ID>/.well-known/jwks.json (This is the Token signing key URL shown in User pool overview.)
6. Auth URL: https://<your user pool domain>/oauth2/authorize
7. Token URL: https://<your user pool domain>/oauth2/token
8. Certificate (key) URL: https://cognito-idp.<region>.amazonaws.com/<your user pool ID>/.well-known/jwks.json (This is the Token signing key URL shown in User pool overview.)
9. Under App client list, select Create app client.
10. For App type, select Confidential client.
11. Enter an App client name for your application.
12. Ensure that Generate a client secret is selected.
13. Configure the following Hosted UI settings:


In Allowed callback URLs, add the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.


Select Identity providers to use with this app client. At minimum, enable Cognito user pool as a provider.


For OAuth 2.0 grant types, select Authorization code grant.


For OpenID Connect scopes, select OpenID, Email, and Profile.
14. In Allowed callback URLs, add the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
15. Select Identity providers to use with this app client. At minimum, enable Cognito user pool as a provider.
16. For OAuth 2.0 grant types, select Authorization code grant.
17. For OpenID Connect scopes, select OpenID, Email, and Profile.
18. Select Create app client.
19. Next, select the app client you just created.
20. Copy its Client ID and Client secret.

### 2. Add Amazon Cognito as an identity provider

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Select OpenID Connect.
4. Name your identity provider and fill in the required fields with the information obtained from Amazon Cognito.
5. (Optional) Enable Proof of Key Exchange (PKCE) ‚Üó if the protocol is supported by your IdP. PKCE will be performed on all login attempts.
6. (Optional) Under Optional configurations, enter custom OIDC claims that you wish to add to users' identity.
7. Select Save.

To test that your connection is working, select Test.

## Example API Configuration

```
{  "config": {    "client_id": "<your client id>",    "client_secret": "<your client secret>",    "auth_url": "https://<your user pool domain>/oauth2/authorize",    "token_url": "https://<your user pool domain>/oauth2/token",    "certs_url": "https://cognito-idp.<region>.amazonaws.com/<your user pool ID>/.well-known/jwks.json",    "scopes": ["openid", "email", "profile"],    "claims": ["sub", "cognito:username", "name", "cognito:groups"]  },  "type": "oidc",  "name": "Amazon Cognito example"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## AWS IAM (SAML)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/aws-saml/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/aws-saml/)

Page options # AWS IAM (SAML)

AWS IAM Identity Center provides SSO identity management for users who interact with AWS resources (such as EC2 instances or S3 buckets). You can integrate AWS IAM with Cloudflare Zero Trust as a SAML identity provider, which allows users to authenticate to Zero Trust using their AWS credentials.

## Prerequisites

- Admin access to an IAM Identity Center organization instance ‚Üó

## Set up AWS IAM as a SAML provider

To set up SAML with AWS IAM as your identity provider:

1. Open your IAM Identity Center console ‚Üó and go to Applications.
2. Select the Customer managed tab.
3. Select Add application.
4. Select I have an application I want to set up.
5. For Application type, select SAML 2.0.
6. Select Next.
7. Enter a Display name for the application (for example, Cloudflare Zero Trust).
8. Download the IAM Identity Center SAML metadata file. You will need this file later when configuring the identity provider in Zero Trust.
9. Under Application metadata, select Manually type your metadata values.
10. In Application ACS URL and Application SAML audience, enter the following URL:

```
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
```

You can find your team name in Zero Trust under Settings > Custom Pages.

1. Select Submit.
2. Next, select the Actions dropdown menu and select Edit attribute mappings.
3. For the Subject user attribute, enter ${user:email}.
4. (Recommended) Add user name attributes:

| User attribute | String value |
| --- | --- |
| name | ${user:name} |
| surName | ${user:familyName} |
| givenName | ${user:givenName} |

1. Select Save changes.
2. Under Assign users and groups, add individuals and/or groups that should be allowed to login to Zero Trust.
3. In Zero Trust ‚Üó, go to Settings > Authentication.
4. Under Login Methods, select Add new.
5. Select SAML.
6. Enter a Name for the IdP integration (for example, AWS).
7. Upload the IAM Identity Center SAML metadata file that you downloaded in Step 8.
8. (Recommended) Enable Sign SAML authentication request.
9. Select Save.

To test that your connection is working, select Test.

## Example API configuration

```
{  "config": {    "issuer_url": "https://portal.sso.eu-central-1.amazonaws.com/saml/assertion/b2yJrC4kjy3ZAS0a2SeDJj74ebEAxozPfiURId0aQsal3",    "sso_target_url": "https://portal.sso.eu-central-1.amazonaws.com/saml/assertion/b2yJrC4kjy3ZAS0a2SeDJj74ebEAxozPfiURId0aQsal3",    "attributes": ["email"],    "email_attribute_name": "email",    "sign_request": true,    "idp_public_certs": [      "MIIDpDCCAoygAwIBAgIGAV2ka+55MA0GCSqGSIb3DQEBCwUAMIGSMQswCQYDVQQGEwJVUzETMBEG\nA1UEC.....GF/Q2/MHadws97cZg\nuTnQyuOqPuHbnN83d/2l1NSYKCbHt24o"    ]  },  "type": "saml",  "name": "AWS IAM SAML example"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Centrify

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/centrify/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/centrify/)

Page options # Centrify

Centrify secures access to infrastructure, DevOps, cloud, and other modern enterprise so you can prevent the number one cause of breaches: privileged access abuse.

## Set up Centrify as an OIDC provider

### 1. Create an application in Centrify

1. Log in to the Centrify administrator panel.
2. Select Apps.
3. Select Add Web Apps.
4. Select the Custom tab, then select Add OpenID Connect.
5. On the Add Web App screen, select Yes to create an OpenID Connect application.
6. Enter an Application ID.
7. Select Save.
8. Select Trust in the Settings menu.
9. Enter a strong application secret on the Trust section.
10. Under Service Provider Configuration enter your application's authentication domain as the resource application URL.
11. Under Authorized Redirect URIs, select Add.
12. Under Authorized Redirect URIs, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
13. Select Save.
14. Copy the following values:

- Client ID
- Client Secret
- OpenID Connect Issuer URL
- Application ID from the Settings tab

1. Go to the User Access tab.
2. Select the roles to grant access to your application.

### 2. Add Centrify to Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Paste in the Client ID, Client Secret, Centrify account URL and Application ID.
4. (Optional) To enable SCIM, refer to Synchronize users and groups.
5. (Optional) Under Optional configurations, enter custom OIDC claims that you wish to add to your users' identity.
6. Select Save.

To test that your connection is working, go to Authentication > Login methods and select Test next to the login method you want to test.

## Example API Config

```
{  "config": {    "client_id": "<your client id>",    "client_secret": "<your client secret>",    "centrify_account": "https://abc123.my.centrify.com/",    "centrify_app_id": "exampleapp"  },  "type": "centrify",  "name": "my example idp"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Centrify (SAML)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/centrify-saml/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/centrify-saml/)

Page options # Centrify (SAML)

Centrify secures access to infrastructure, DevOps, cloud, and other modern enterprise so you can prevent the number one cause of breaches: privileged access abuse.

## Set up Centrify as a SAML provider

## 1. Create an application in Centrify

1. Log in to your Centrify admin portal and select Apps.
2. Select Add Web Apps.
3. Select the Custom tab.
4. Next to the SAML icon, select Add.
5. Enter the required information for your application.
6. Select Save.
7. Select Settings in the left pane.
8. In the middle menu pane, select Trust.
9. Choose the Manual Configuration option.
10. In the SP Entity ID and Assertion Consumer Service (ACS) URL fields, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
11. Select Save.
12. In the middle menu pane, select User Access.
13. Select Add. The Select Role dialog displays.
14. Complete your roles access assignments. The Role rules display on the User Access card.
15. In the User Access card's middle menu pane, select SAML Response.
16. Select Active > Add to create a new Attribute Name, Email.
17. Enter the user email addresses in the Attribute Value field.
18. Select Save.
19. Select Settings again from the left menu pane, and Trust.
20. Select the Manual Configuration option.

### 2. Add Centrify to Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Select SAML.
4. Copy and paste the corresponding information from Centrify into the fields.
5. (Optional) To enable SCIM, refer to Synchronize users and groups.
6. (Optional) Under Optional configurations, configure additional SAML options.
7. Select Save.

To test that your connection is working, go to Authentication > Login methods and select Test next to the login method you want to test.

## Download SP metadata (optional)

Some IdPs allow administrators to upload metadata files from their SP (service provider).

To get your Cloudflare metadata file:

1. Download your unique SAML metadata file at the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/saml-metadata
2. Save the file in XML format.
3. Upload the XML document to your Centrify account.

## Example API configuration

```
{  "config": {    "issuer_url": "https://abc123.my.centrify.com/baaa2117-0ec0-4d76-84cc-abccb551a123",    "sso_target_url": "https://abc123.my.centrify.com/applogin/appKey/baaa2117-0ec0-4d76-84cc-abccb551a123/customerId/abc123",    "attributes": ["email"],    "email_attribute_name": "",    "sign_request": false,    "idp_public_cert": "MIIDpDCCAoygAwIBAgIGAV2ka+55MA0GCSqGSIb3DQEBCwUAMIGSMQswCQYDVQQGEwJVUzETMBEG\nA1UEC.....GF/Q2/MHadws97cZg\nuTnQyuOqPuHbnN83d/2l1NSYKCbHt24o"  },  "type": "saml",  "name": "centrify saml example"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Citrix ADC (SAML)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/citrixadc-saml/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/citrixadc-saml/)

Page options # Citrix ADC (SAML)

Cloudflare Zero Trust can integrate with Citrix ADC (formerly Citrix NetScaler ADC) as a SAML IdP. Documentation from Citrix shows you how to configure Citrix ADC as a SAML IdP ‚Üó. These steps are specific to Cloudflare Zero Trust.

## Set up Citrix ADC (SAML)

To set up Citrix ADC (SAML) as your identity provider:

1. First, you'll need to configure 2 SAML certificates:

A certificate to terminate TLS at the vServer. Ensure that the certificate is issued by a publicly trusted CA.
A certificate for signing SAML assertions.

If you do not already have a certificate for signing SAML assertions, you can use a self-signed certificate generated on Citrix ADC by following these steps:

Go to Traffic Management > SSL.
Select Create and Install a Server Test Certificate.
2. A certificate to terminate TLS at the vServer. Ensure that the certificate is issued by a publicly trusted CA.
3. A certificate for signing SAML assertions.
4. Go to Traffic Management > SSL.
5. Select Create and Install a Server Test Certificate.
6. Select Configuration and enter a Certificate File Name, Fully Qualified Domain Name, and a select a Country.
7. Create a publicly accessible authentication vServer and configure the user identity source (like, local users, LDAP) by following this Citrix documentation ‚Üó.
For the rest of this example, the user refers to the IdP address idp.yourdomain.com.

## Add a new profile

1. Go to Security > AAA - Application Traffic > Policies > Authentication > Advanced Policies > SAML IDP to add a new profile.
Include the following required configuration details:





































FieldDescriptionNameThe certificate name you defined while configuring SAMLAssertion Consumer Service URLhttps://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callbackIdP Certificate NameThe IdP certificate name you defined while configuring SAMLIssuer Namehttps://idp.<yourdomain>.com/saml/loginService Provider IDhttps://idp.<yourdomain>.com/saml/loginName ID FormatEmailAddressAttribute 1email = AAA.USER.ATTRIBUTE("email")
Cloudflare Access currently sends the IdP address in place of the Service Provider ID for the AuthN request.
2. Create an Authentication Policy that refers to the Profile just created, and bind it to the authentication vServer mentioned above.

To configure all of the above using just the CLI, run the following:
add authentication samlIdPProfile samlProf_CloudflareAccess \    -samlIdPCertName SAML_Signing \    -assertionConsumerServiceURL "https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback" \    -samlIssuerName "https://idp.yourdomain.com/saml/login" \    -rejectUnsignedRequests OFF \    -NameIDFormat emailAddress \    -Attribute1 email \    -Attribute1Expr "AAA.USER.ATTRIBUTE(\"email\")" \    -Attribute1Format Basic \    -serviceProviderID "https://idp.yourdomain.com/saml/login"
add authentication samlIdPPolicy samlPol_CloudflareAccess -rule true -action samlProf_CloudflareAccessbind authentication vserver nsidp -policy samlPol_CloudflareAccess
3. In Zero Trust, go to Settings > Authentication.
4. Under Login methods, select Add new.
5. Configure the fields as follows:





























FieldDescriptionNameYour chosen nameSingle Sign On URLThe FQDN of the IdP, with the path /saml/loginIdP Entity ID/Issuer URLAs aboveSigning CertificateThe public certificate from the NetScalerEmail attribute nameThis is listed under Optional configurations
6. Select Save.

To test that your connection is working, go to Authentication > Login methods and select Test next to the login method you want to test.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Facebook

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/facebook-login/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/facebook-login/)

Page options # Facebook

Use these steps to set up Facebook as your identity provider.

1. Go to developers.facebook.com ‚Üó.
2. Select Create App at the top-right. The Create a New App ID card displays.
3. Enter the Display Name and Contact Email.
4. Select Create App ID. The Create a New App ID window displays.
5. Enter the CAPTCHA code to proceed.
6. Select Submit.
7. On the Facebook Login card, select Set Up. A Quickstart card displays offering platform choices.
8. Select Web. The Web tab displays.
9. Enter your Site URL.
10. Select Save.
11. Select Continue. Ignore any JavaScript page that suggests that you install it on your site.
12. Select Settings > Basic.
13. Copy the App ID and App Secret.
14. In Zero Trust ‚Üó, go to Settings > Authentication.
15. Under Login methods, select Add new.
16. Fill in the App ID and App Secret obtained from Facebook.
17. (Optional) Enable Proof of Key Exchange (PKCE) ‚Üó. PKCE will be performed on all login attempts.
18. Select Save.
19. On developers.facebook.com ‚Üó, select Facebook Login > Settings on the left-hand menu.
20. Ensure that the Use Strict Mode for Redirect URIs slider is set to Yes.
21. In the Valid OAuth redirect URIs field, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
22. Select Save Changes.

To test that your connection is working, follow the steps on SSO Integration.

## Example API Configuration

```
{  "config": {    "client_id": "<your client id>",    "client_secret": "<your client secret>"  },  "type": "facebook",  "name": "my example idp"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## GitHub

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/github/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/github/)

Page options # GitHub

Cloudflare Zero Trust allows your team to connect to your applications using their GitHub login. You do not need to have a GitHub organization to use the integration.

## Set up GitHub Access

To configure GitHub access in both GitHub and Cloudflare Zero Trust:

1. Log in to GitHub ‚Üó.
2. Go to your account Settings > Developer Settings.
3. In Developer Settings, select OAuth Apps and select New OAuth app.
4. On the Register a new OAuth application page, enter an Application name. Your users will see this application name on the login page.
5. In the Homepage URL field, enter your team domain:
https://<your-team-name>.cloudflareaccess.com
You can find your team name in Zero Trust ‚Üó by going to Settings > Custom Pages.
6. In the GitHub Authorization callback URL field, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
7. Select Register application.
8. Find the Client ID and Client Secret.
9. In Zero Trust ‚Üó, go to Settings > Authentication.
10. Under Login methods, select Add new.
11. Choose GitHub on the next page.
12. In the App ID field, copy and paste the Client ID you found in step 8. In the Client secret field, copy and paste the Client secret you found in step 8. You will need to select Generate a new client secret if one is not already displayed.
13. Select Save.

To test that your connection is working, go to Zero Trust ‚Üó > Authentication > Login methods and select Test next to your GitHub login method.
If you have GitHub two-factor authentication enabled, you will need to first login to GitHub directly and return to Access.

## Example API Configuration

```
{  "config": {    "client_id": "<your client id>",    "client_secret": "<your client secret>"  },  "type": "github",  "name": "my example idp"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/google/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/google/)

Page options # Google

You can integrate Google authentication with Cloudflare Access without a Google Workspace account. The integration allows any user with a Google account to log in (if the Access policy allows them to reach the resource). Unlike the instructions for Google Workspace, the steps below will not allow you to pull group membership information from a Google Workspace account.

You do not need to be a Google Cloud Platform user to integrate Google as an identity provider with Cloudflare Zero Trust. You will only need to open the Google Cloud Platform to configure IdP integration settings.

## Set up Google as an identity provider

1. Log in to the Google Cloud Platform console ‚Üó. Create a new project, name the project, and select Create.
2. On the project home page, go to APIs & Services and on the sidebar select Credentials.
3. Select Configure Consent Screen.
4. To configure the consent screen:

Select Get started.
Enter an App name and a User support email.
Choose External as the Audience Type. Since this application is not being created in a Google Workspace account, any user with a Gmail address can log in.
Enter your Contact Information. Google Cloud Platform requires an email in your account.
Agree to Google's user data policy and select Continue.
Select Create.
5. Select Get started.
6. Enter an App name and a User support email.
7. Choose External as the Audience Type. Since this application is not being created in a Google Workspace account, any user with a Gmail address can log in.
8. Enter your Contact Information. Google Cloud Platform requires an email in your account.
9. Agree to Google's user data policy and select Continue.
10. Select Create.
11. The OAuth overview page will load. On the OAuth overview screen, select Create OAuth client.
12. Choose Web application as the Application type and give your OAuth Client ID a name.
13. Under Authorized JavaScript origins, in the URIs field, enter your team domain:
https://<your-team-name>.cloudflareaccess.com
You can find your team name in Zero Trust ‚Üó under Settings > Custom Pages.
14. Under Authorized redirect URIs, in the URIs field, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
15. After creating the OAuth client, select the OAuth client that you just created. Google will present the OAuth Client ID value and Client secret value. The client secret field functions like a password and should not be shared. Copy both the OAuth Client ID value and Client secret value.
16. In Zero Trust ‚Üó, go to Settings > Authentication.
17. Under Login methods, select Add new. Choose Google on the next page.
18. Input the Client ID (App ID in the Cloudflare dashboard) and Client Secret fields generated previously.
19. (Optional) Enable Proof of Key Exchange (PKCE) ‚Üó. PKCE will be performed on all login attempts.
20. Select Save.

## Test your connection

To test that your connection is working, go to Authentication > Login methods and select Test next to Google.

## Example API Config

```
{  "config": {    "client_id": "<your client id>",    "client_secret": "<your client secret>"  },  "type": "google",  "name": "my example idp"}
```

## Troubleshooting

### Error 401: deleted_client

If you deleted the OAuth client (or the OAuth client expired) in Google, you will receive a Error 401: deleted_client authorization error.

To fix this issue, complete steps 6 through 12 in the Google guide and steps 9 through 15 in the Google Workspace guide.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Workspace

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/google-workspace/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/google-workspace/)

Page options # Google Workspace

Note

The Google Workspace IdP integration is not supported if your Google Workspace account is protected by Access.

You can integrate a Google Workspace (formerly G Suite) account with Cloudflare Access. Unlike the instructions for generic Google authentication, the steps below will allow you to pull group membership information from your Google Workspace account.

Once integrated, users will log in with their Google Workspace credentials to reach resources protected by Cloudflare Access or to enroll their device into Cloudflare Gateway.

You do not need to be a Google Cloud Platform user to integrate Google Workspace as an identity provider with Cloudflare Zero Trust. You will only need to open the Google Cloud Platform to configure IdP integration settings.

## Set up Google Workspace as an identity provider

### 1. Configure Google Workspace

1. Log in to the Google Cloud Platform console ‚Üó. This is separate from your Google Workspace console.
2. A Google Cloud project is required to enable Google Workspace APIs. If you do not already have a Google Cloud project, go to IAM & Admin > Create Project. Name the project and select Create.
3. Go to APIs & Services and select Enable APIs and Services. The API Library will load.
4. In the API Library, search for admin and select Admin SDK API.
5. Enable the Admin SDK API.
6. Return to the APIs & Services page and go to Credentials.
7. Select Configure Consent Screen.
8. To configure the consent screen:

Select Get Started.
Enter an App name and a User support email.
Choose Internal as the Audience Type. This Audience Type limits authorization requests to users in your Google Workspace and blocks users who have regular Gmail addresses.
Enter your Contact Information. Google Cloud Platform requires an email in your account.
Agree to Google's user data policy and select Continue.
Select Create.
9. Select Get Started.
10. Enter an App name and a User support email.
11. Choose Internal as the Audience Type. This Audience Type limits authorization requests to users in your Google Workspace and blocks users who have regular Gmail addresses.
12. Enter your Contact Information. Google Cloud Platform requires an email in your account.
13. Agree to Google's user data policy and select Continue.
14. Select Create.
15. The OAuth overview page will load. Select Create OAuth Client.
16. Choose Web application as the Application type and give your OAuth Client ID a name.
17. Under Authorized JavaScript origins, in the URIs field, enter your team domain:
https://<your-team-name>.cloudflareaccess.com
You can find your team name in Zero Trust ‚Üó under Settings > Custom Pages.
18. Under Authorized redirect URIs, in the URIs field, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
19. After creating the OAuth client, select the OAuth client that you just created. Google will present the OAuth Client ID value and Client secret value. The client secret field functions like a password and should not be shared. Copy both the OAuth Client ID value and Client secret value.
20. On your Google Admin console ‚Üó, go to Security > Access and data control > API controls.
21. In API Controls, select Settings.
22. Select Internal apps and check the box next to Trust internal apps to enable this option. The Trust internal apps setting is disabled by default and must be enabled for Cloudflare Access to work correctly.

### 2. Add Google Workspace to Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new and choose Google Workspace.
3. Input the Client ID (App ID in the Cloudflare dashboard) and Client Secret fields generated previously. Additionally, enter the domain of your Google Workspace account.
4. (Optional) Enable Proof of Key Exchange (PKCE) ‚Üó. PKCE will be performed on all login attempts.
5. (Optional) Under Optional configurations, enter custom OIDC claims that you wish to add to your user's identity.
6. Select Save. To complete setup, you must visit the generated link. If you are not the Google Workspace administrator, share the link with the administrator.
7. The generated link will prompt you to log in to your Google admin account and to authorize Cloudflare Access to view group information. After allowing permissions, you will see a success page from Cloudflare Access.

To test that your connection is working, go to Authentication > Login methods and select Test next to Google Workspace. Your user identity and group membership should return.

Failed to fetch group information from the identity provider error

To test successfully, you must finish setup ‚Üó. Testing before finishing setup will result in a Failed to fetch user/group information from the identity provider error.

## Example API Configuration

```
{  "config": {    "client_id": "<your client id>",    "client_secret": "<your client secret>",    "apps_domain": "mycompany.com"  },  "type": "google-apps",  "name": "my example idp"}
```

## Troubleshooting

### Error 401: deleted_client

If you deleted the OAuth client (or the OAuth client expired) in Google, you will receive a Error 401: deleted_client authorization error.

To fix this issue, complete steps 6 through 12 in the Google guide and steps 9 through 15 in the Google Workspace guide.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## JumpCloud (SAML)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/jumpcloud-saml/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/jumpcloud-saml/)

Page options # JumpCloud (SAML)

JumpCloud ‚Üó provides SSO identity management. Cloudflare Access integrates with JumpCloud as a SAML identity provider.

The following steps are specific to setting up JumpCloud with Cloudflare Access. For more information on configuring JumpCloud SSO application, refer to the JumpCloud documentation ‚Üó.

## Set up Jumpcloud as a SAML provider

### 1. Create an SSO application in JumpCloud

1. In the JumpCloud Admin Portal ‚Üó, go to SSO Applications.
2. Select Add New Application.
3. In the search bar, enter Cloudflare and select the Cloudflare Access application.
4. Select Next.
5. In Display Label, enter an application name.
6. Select Save Application.
7. Review the application summary and select Configure Application.
8. In the SSO tab, configure the following settings:


In IdP Entity ID, enter your Cloudflare team domain:
https://<your-team-name>.cloudflareaccess.com/
You can find your team name in Zero Trust under Settings > Custom Pages.


Set both SP Entity ID and ACS URL to the following callback URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback


(Optional) Configure SAML attributes that you want to send to Cloudflare Access.


Scroll up to JumpCloud Metadata and select Export Metadata. Save this XML file for use in a later step.
9. In IdP Entity ID, enter your Cloudflare team domain:
https://<your-team-name>.cloudflareaccess.com/
You can find your team name in Zero Trust under Settings > Custom Pages.
10. Set both SP Entity ID and ACS URL to the following callback URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
11. (Optional) Configure SAML attributes that you want to send to Cloudflare Access.
12. Scroll up to JumpCloud Metadata and select Export Metadata. Save this XML file for use in a later step.
13. In the User Groups tab, assign user groups ‚Üó to this application.
14. Select Save.

### 2. Add JumpCloud to Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Select SAML.
4. Upload your JumpCloud XML metadata file.
5. (Optional) To enable SCIM, refer to Synchronize users and groups.
6. (Optional) Under Optional configurations, configure additional SAML options.
7. Select Save.

You can now test your connection and create Access policies based on the configured login method and SAML attributes.

## Synchronize users and groups

The JumpCloud integration allows you to synchronize user groups and automatically deprovision users using SCIM.

### 1. Enable SCIM in Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Find the JumpCloud integration and select Edit.
3. Turn on Enable SCIM
4. (Optional) Configure the following settings:

- Enable user deprovisioning: Revoke a user's active session when they are removed from the SCIM application in JumpCloud. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies.
- Remove user seat on deprovision: Remove a user's seat from your Zero Trust account when they are removed from the SCIM application in JumpCloud.
- SCIM identity update behavior: Choose what happens in Zero Trust when the user's identity updates in JumpCloud.

Automatic identity updates: Automatically update the User Registry identity when JumpCloud sends an updated identity or group membership through SCIM. This identity is used for Gateway policies and WARP device profiles; Access will read the user's updated identity when they reauthenticate.
Group membership change reauthentication: Revoke a user's active session when their group membership changes in JumpCloud. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies. Access will read the user's updated group membership when they reauthenticate.
No action: Update the user's identity the next time they reauthenticate to Access or WARP.
- Automatic identity updates: Automatically update the User Registry identity when JumpCloud sends an updated identity or group membership through SCIM. This identity is used for Gateway policies and WARP device profiles; Access will read the user's updated identity when they reauthenticate.
- Group membership change reauthentication: Revoke a user's active session when their group membership changes in JumpCloud. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies. Access will read the user's updated group membership when they reauthenticate.
- No action: Update the user's identity the next time they reauthenticate to Access or WARP.

1. Select Regenerate Secret. Copy the SCIM Endpoint and SCIM Secret. You will need to enter these values into JumpCloud.
2. Select Save.

The SCIM secret never expires, but you can manually regenerate the secret at any time.

### 2. Configure SCIM in JumpCloud

1. In the JumpCloud Admin Portal ‚Üó, go to SSO Applications.
2. Select the Cloudflare application that was created when you Set up JumpCloud as a SAML provider.
3. Select the SSO tab.
4. To provision user groups, select Include group attribute and enter groups. The group attribute name has to exactly match groups or else it will be sent as a SAML attribute.
5. Select the Identity Management tab.
6. Make sure that Enable management of User Groups and Group Membership in this application is turned on.
7. Select Configure.
8. In the Base URL field, enter the SCIM Endpoint obtained from Zero Trust.
9. In the Token Key field, enter the SCIM Secret obtained from Zero Trust.
10. Select Activate. You will receive a confirmation that the Identity Management integration has been successfully verified.
11. Select Save.

To check if user identities were updated in Zero Trust, view your SCIM provisioning logs.

Note

New users must first register the WARP client or authenticate to an Access application before SCIM provisioning can begin.

### Provisioning attributes

Provisioning attributes define the user and group properties that JumpCloud will synchronize with Cloudflare Access. By default, JumpCloud will send the following attributes during a SCIM update event:

| JumpCloud user attribute | Cloudflare Access attribute |
| --- | --- |
| email | email |
| firstname | givenName |
| lastname | surname |

| JumpCloud group attribute | Cloudflare Access attribute |
| --- | --- |
| name | groups |

## Example API configuration

```
{  "config": {    "issuer_url": "jumpcloud",    "sso_target_url": "https://sso.myexample.jumpcloud.com/saml2/cloudflareaccess",    "attributes": ["email", "name", "username"],    "email_attribute_name": "",    "sign_request": false,    "idp_public_cert": "MIIDpDCCAoygAwIBAgIGAV2ka+55MA0GCSqGSIb3DQEBCwUAMIGSMQswCQYDVQQGEwJVUzETMBEG\nA1UEC.....GF/Q2/MHadws97cZg\nuTnQyuOqPuHbnN83d/2l1NSYKCbHt24o"  },  "type": "saml",  "name": "jumpcloud saml example"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Keycloak (SAML)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/keycloak/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/keycloak/)

Page options # Keycloak (SAML)

Keycloak is an open source identity and access management solution built by JBoss. If you need a Keycloak lab environment for testing, refer to this example ‚Üó.

## Set up Keycloak (SAML)

To set up Keycloak (SAML) as your identity provider:

1. In Keycloak, select Clients in the navigation bar and create a new client.
2. Under Client ID, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
3. Change the Name ID Format to email
4. Next, set the valid redirect URI to the Keycloak domain that you are using. For example, https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback.
5. Set the Master SAML Processing URL using the same Keycloak domain: https://<keycloak_domain>/auth/realms/master/protocol/saml.
6. If you wish to enable client signatures, enable Client Signature Required and select save.


You will need to follow the steps here to get the certificate and enable it in the Cloudflare dashboard.


Import the Access certificate you downloaded into the SAML Keys tab. Use Certificate PEM as the format.
7. You will need to follow the steps here to get the certificate and enable it in the Cloudflare dashboard.
8. Import the Access certificate you downloaded into the SAML Keys tab. Use Certificate PEM as the format.
9. Set the built-in protocol mapper for the email property.

Next, you will need to integrate with Cloudflare Access.
10. In Zero Trust ‚Üó, go to Settings > Authentication.
11. Under Login methods, select Add new.
12. Choose SAML on the next page.
You will need to input the Keycloak details manually. The examples below should be replaced with the specific domains in use with Keycloak and Cloudflare Access.





















FieldExampleSingle Sign-On URLhttps://<keycloak_domain>/auth/realms/master/protocol/samlIdP Entity ID or Issuer URLhttps://<unique_id>.cloudflareaccess.com/cdn-cgi/access/callbackSigning certificateUse the X509 Certificate in the Realm Settings from Keycloak
13. Select Save.

To test that your connection is working, go to Authentication > Login methods and select Test next to the login method you want to test.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## LinkedIn

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/linkedin/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/linkedin/)

Page options # LinkedIn

Cloudflare Access allows your users to use LinkedIn as their identity provider (IdP).

## Prerequisites

Sign in to your LinkedIn account before continuing. Configuring LinkedIn as a Cloudflare Access IdP requires a LinkedIn account.

## Set up LinkedIn as an IdP

To configure LinkedIn as an IdP:

1. Go to the LinkedIn Developer Portal ‚Üó.
2. Select Create App.
3. On the Create an app page, enter an App name for your application.
4. Select a LinkedIn Page for your application or select Create a new LinkedIn page if you do not have a LinkedIn page.
5. Select Upload a logo and upload your company logo image file.
6. Select API Terms of Use to read the terms of use, and agree to the terms.
7. Select Create app.
8. In the Products tab of your LinkedIn application, select Request Access next to the Sign In with LinkedIn using OpenID Connect option.
9. In the Auth tab of your LinkedIn application, find the Client ID and Client Secret.
10. In Zero Trust ‚Üó, go to Settings > Authentication.
11. Under Login methods, select Add new.
12. Select LinkedIn as your IdP.
13. In the App ID field, copy and paste the Client ID from step 9. In the Client secret field, copy and paste the Client secret from step 9.
14. Select Save.
15. In the Auth tab of your LinkedIn application, go to OAuth 2.0 settings and select the pencil icon next to Authorized redirect URLs for your app.
16. Enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name by going to Zero Trust ‚Üó > Settings > Custom Pages.

To test that your connection is working, go to Zero Trust ‚Üó > Settings > Authentication > Login methods > select Test next to your LinkedIn login method.

## Example API configuration

```
{  "config": {    "client_id": "<your client id>",    "client_secret": "<your client secret>"  },  "type": "linkedin",  "name": "my example idp"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Microsoft Entra ID

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/entra-id/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/entra-id/)

Page options # Microsoft Entra ID

You can integrate Microsoft Entra ID (formerly Azure Active Directory) with Cloudflare Zero Trust and build policies based on user identity and group membership. Users will authenticate to Zero Trust using their Entra ID credentials.

## Set up Entra ID as an identity provider

### 1. Obtain Entra ID settings

The following Entra ID values are required to set up the integration:

- Application (client) ID
- Directory (tenant) ID
- Client secret

To retrieve those values:

1. Log in to the Microsoft Entra admin center ‚Üó.
2. Go to Applications > Enterprise applications.
3. Select New application, then select Create your own application.
4. Name your application.
5. Select Register an application to integrate with Microsoft Entra ID (App you're developing). If offered, do not select any of the gallery applications. Select Create.
6. Under Redirect URI, select the Web platform and enter the following URL.
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
In Zero Trust ‚Üó, go to Settings > Custom Pages to find your team name.
7. Select Register.
8. Next, return to Microsoft Entra ID and go to Applications > App registrations.
9. Select All applications and select the app you just created. Copy the Application (client) ID and Directory (tenant) ID. You will need these values when adding Entra ID as an identity provider in step 3.
10. On the same page, under Client credentials, go to Add a certificate or secret. Select New client secret.
11. Name the client secret and choose an expiration period.
NoteWhen the client secret expires, users will be unable to log in through Access. Take note of your expiry date to prevent login errors and renew your client secret when necessary.
12. After the client secret is created, copy its Value field. Store the client secret in a safe place, as it can only be viewed immediately after creation. You will need this client secret value when adding Entra ID as an identity provider in step 3.

### 2. Configure API permissions in Entra ID

1. Go to App registrations > All applications > select your application > API permissions.
2. Select Add a permission.
3. Select Microsoft Graph.
4. Select Delegated permissions and enable the following permissions ‚Üó:

email
offline_access
openid
profile
User.Read
Directory.Read.All
GroupMember.Read.All
5. email
6. offline_access
7. openid
8. profile
9. User.Read
10. Directory.Read.All
11. GroupMember.Read.All

Note

More narrow permissions may be used, however this is the set of permissions that are tested and supported by Cloudflare.

1. Once all seven permissions are enabled, select Add permissions.
2. Select Grant admin consent.

### 3. Add Entra ID as an identity provider

- Dashboard
- API
- Terraform

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Select Azure AD.
4. Enter the Application (client) ID, Client secret, and Directory (tenant) ID obtained from Microsoft Entra ID.
5. Select Save.
6. To test that your connection is working, select Test.
7. (Optional) Configure the following settings:

Proof Key for Code Exchange: Perform PKCE ‚Üó on all login attempts.
Support Groups: Allow Cloudflare to read a user's Entra ID group membership.
Entra ID Policy Sync: Refer to our Entra ID Conditional Access tutorial.
Enable SCIM: Refer to Synchronize users and groups.
Email claim: Enter the Entra ID claim that you wish to use for user identification (for example, preferred_username).
OIDC Claims: Enter custom OIDC claims that you wish to add to your users' identity.
8. Proof Key for Code Exchange: Perform PKCE ‚Üó on all login attempts.
9. Support Groups: Allow Cloudflare to read a user's Entra ID group membership.
10. Entra ID Policy Sync: Refer to our Entra ID Conditional Access tutorial.
11. Enable SCIM: Refer to Synchronize users and groups.
12. Email claim: Enter the Entra ID claim that you wish to use for user identification (for example, preferred_username).
13. OIDC Claims: Enter custom OIDC claims that you wish to add to your users' identity.

Make a POST request to the Identity Providers endpoint:

Required API token permissions

At least one of the following token permissions is required: - Access: Organizations, Identity Providers, and Groups Write

Add an Access identity provider ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/identity_providers" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Entra ID example",    "type": "azureAD",    "config": {        "client_id": "<your client id>",        "client_secret": "<your client secret>",        "directory_id": "<your azure directory uuid>",        "support_groups": true    }  }'
```

Provider versions

The following example requires Cloudflare provider version 4.40.0 or greater.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Access: Organizations, Identity Providers, and Groups Write
2. Access: Organizations, Identity Providers, and Groups Write
3. Configure the cloudflare_zero_trust_access_identity_provider ‚Üó resource:
resource "cloudflare_zero_trust_access_identity_provider" "microsoft_entra_id" {  account_id = var.cloudflare_account_id  name       = "Entra ID example"  type       = "azureAD"  config      = {    client_id                  = var.entra_id_client_id    client_secret              = var.entra_id_client_secret    directory_id               = var.entra_id_directory_id    support_groups             = true    }}

#### UPN and email

If your organization's UPNs do not match users' email addresses, you must add a custom claim for email. For example, if your organization's email format is user@domain.com but the UPN is u908080@domain.com, you must create an email claim if you are configuring email-based policies.

By default, Cloudflare will first look for the unique claim name you created and configured in Zero Trust to represent email (for example, email_identifier) in the id_token JSON response. If you did not configure a unique claim name, Cloudflare will then look for an email claim. Last, if neither claim exists, Cloudflare will look for the UPN claim.

To receive an email claim in the id_token from Microsoft Entra, you must:

1. In the Microsoft Entra admin center ‚Üó, go to Application > App registration > All applications > select the relevant application > under Manage, select Token configuration.
2. Add a claim for email.

The example above includes both a UPN claim and an email claim. Because an email claim was created in the Microsoft Entra configuration, Cloudflare will look for the email key-value pair in the JSON response.
3. If you gave your email claim another name than email, you must update your configuration in Zero Trust:
a. In Zero Trust ‚Üó, go to Settings > Authentication > Azure AD > Edit.
b. Under Optional configurations > Email claim, enter the name of the claim representing your organization's email addresses.

#### Object ID

If you are concerned that users' emails or UPNs may change, you can pass the user's object ID (oid) from Microsoft Entra to Cloudflare Access. To configure Access to receive the object ID, refer to custom OIDC claims. No additional configuration is required in Microsoft Entra.

## Synchronize users and groups

The Microsoft Entra ID integration allows you to synchronize IdP groups and automatically deprovision users using SCIM.

### Prerequisites

- Microsoft Entra ID P1 or P2 license

### 1. Enable SCIM in Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Find the Entra ID integration and select Edit.
3. Turn on Enable SCIM  and Support groups.
4. (Optional) Configure the following settings:

- Enable user deprovisioning: Revoke a user's active session when they are removed from the SCIM application in Entra ID. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies.
- Remove user seat on deprovision: Remove a user's seat from your Zero Trust account when they are removed from the SCIM application in Entra ID.
- SCIM identity update behavior: Choose what happens in Zero Trust when the user's identity updates in Entra ID.

Automatic identity updates: Automatically update the User Registry identity when Entra ID sends an updated identity or group membership through SCIM. This identity is used for Gateway policies and WARP device profiles; Access will read the user's updated identity when they reauthenticate.
Group membership change reauthentication: Revoke a user's active session when their group membership changes in Entra ID. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies. Access will read the user's updated group membership when they reauthenticate.
No action: Update the user's identity the next time they reauthenticate to Access or WARP.
- Automatic identity updates: Automatically update the User Registry identity when Entra ID sends an updated identity or group membership through SCIM. This identity is used for Gateway policies and WARP device profiles; Access will read the user's updated identity when they reauthenticate.
- Group membership change reauthentication: Revoke a user's active session when their group membership changes in Entra ID. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies. Access will read the user's updated group membership when they reauthenticate.
- No action: Update the user's identity the next time they reauthenticate to Access or WARP.

1. Select Regenerate Secret. Copy the SCIM Endpoint and SCIM Secret. You will need to enter these values into Entra ID.
2. Select Save.

The SCIM secret never expires, but you can manually regenerate the secret at any time.

### 2. Configure SCIM in Entra ID

Note

SCIM requires a separate enterprise application from the one created during initial setup.

1. In the Microsoft Entra ID menu, go to Enterprise applications.
2. Select New application > Create your own application.
3. Name your application (for example, Cloudflare Access SCIM).
4. Select Integrate any other application you don't find in the gallery (Non-gallery). If offered, do not select any of the gallery applications. Select Create.
5. After you have created the application, go to Provisioning > select New Configuration.
6. In the Tenant URL field, enter the SCIM Endpoint obtained from your Entra ID integration in Zero Trust in the previous step.
7. In the Secret token field, enter the SCIM Secret obtained from your Entra ID integration in Zero Trust in the previous step.
8. Select Test Connection to ensure that the credentials were entered correctly. If the test fails, go to your Entra ID integration in Zero Trust, select Regenerate Secret, select Save, and enter your new SCIM Secret in the Secret token field.
9. Select Create.
10. Once the SCIM application is created, assign users and groups to the application ‚Üó.

Note

Groups in this SCIM application should match the groups in your other Cloudflare Access enterprise application. Because SCIM group membership updates will overwrite any groups in a user's identity, assigning the same groups to each app ensures consistent policy evaluation.

1. Go to Provisioning and select Start provisioning.
2. For Provisioning Mode, the default mode should be set by Microsoft to Automatic.
3. On the Overview page in Entra ID, you will see the synchronization status.

To check which users and groups were synchronized, select Provisioning logs.

To check if user identities were updated in Zero Trust, view your SCIM provisioning logs.

Note

New users must first register the WARP client or authenticate to an Access application before SCIM provisioning can begin.

To monitor the exchange of identity details between Cloudflare Access and Microsoft Entra ID, go to Zero Trust ‚Üó > Logs > SCIM provisioning and view the SCIM activity logs.

### Provisioning attributes

Provisioning attributes define the user properties that Entra ID will synchronize with Cloudflare Access. To modify your provisioning attributes, go to the Attribute mapping and select Provision Microsoft Entra ID Users.

If not already configured, Cloudflare recommends enabling the following user attribute mappings:

| customappsso Attribute | Entra ID Attribute | Recommendation |
| --- | --- | --- |
| emails[type eq "work"].value | mail | Required |
| name.givenName | givenName | Recommended |
| name.familyName | surname | Recommended |

## Entra groups in Zero Trust policies

### Automatic entry

When SCIM synchronization is enabled, your Entra group names will automatically appear in the Access and Gateway policy builders.

If building a Gateway policy, choose the User Group Names selector.

### Manual entry

You can create Access and Gateway policies for groups that are not synchronized with SCIM. Entra ID exposes directory groups in a format that consists of random strings, the Object Id, that is distinct from the Name.

1. Make sure you enable Support groups as you set up Microsoft Entra ID in Zero Trust.
2. In your Microsoft Entra dashboard, note the Object Id for the Entra group. In the example below, the group named Admins has an ID of 61503835-b6fe-4630-af88-de551dd59a2.
3. If building an Access policy, choose the Azure Groups selector. If building a Gateway policy, choose the User Group IDs selector.
4. In the Value field, enter the Object Id for the Entra group.

### Nested groups

#### Authentication

Access and Gateway policies for an Entra group will also apply to all nested groups ‚Üó. For example, if a user belongs to the group US devs, and US devs is part of the broader group Devs, the user would be allowed or blocked by all policies created for Devs.

#### SCIM provisioning

For SCIM provisioning, nested groups are not supported ‚Üó. Microsoft Entra ID's SCIM implementation does not send information about nested group memberships to Cloudflare. Only users who are direct members of an explicitly assigned group will be provisioned. To ensure group memberships are correctly synchronized, you must flatten your groups in Entra ID by directly assigning users to the groups you want to provision.

Since the SCIM request from Microsoft does not include nested group information, neither Cloudflare nor Microsoft can provide a notification that nested groups are not being synchronized.

## Force user interaction during WARP reauthentication

You can require users to re-enter their credentials into Entra ID whenever they re-authenticate their WARP session. To configure this setting:

1. Make a GET request to the Identity Providers endpoint and copy the response for the Entra ID identity provider.
 Required API token permissions
 
At least one of the following token permissions 
is required:
Access: Organizations, Identity Providers, and Groups WriteAccess: Organizations, Identity Providers, and Groups Read Get an Access identity providercurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/identity_providers/$IDENTITY_PROVIDER_ID" \  --request GET \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
2. Access: Organizations, Identity Providers, and Groups Write
3. Access: Organizations, Identity Providers, and Groups Read
4. Update the Entra ID identity provider using a PUT request. In the request body, include all existing configurations and set the prompt parameter to either login or select_account. For example:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Access: Organizations, Identity Providers, and Groups Write Update an Access identity providercurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/identity_providers/$IDENTITY_PROVIDER_ID" \  --request PUT \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "id": "f174e90a-fafe-4643-bbbc-4a0ed4fc8415",    "type": "azureAD",    "uid": "f174e90a-fafe-4643-bbbc-4a0ed4fc8415",    "name": "Entra ID",    "version": "31e74e9b4f033e16b604552091a72295",    "config": {        "azure_cloud": "default",        "client_id": "<CLIENT_ID>",        "conditional_access_enabled": false,        "directory_id": "<AZURE_DIRECTORY_ID>",        "redirect_url": "https://<TEAM_NAME>.cloudflareaccess.com/cdn-cgi/access/callback",        "prompt": "login",        "support_groups": true    },    "scim_config": {        "enabled": true,        "user_deprovision": true,        "seat_deprovision": false,        "group_member_deprovision": false,        "identity_update_behavior": "automatic"    },    "scim_base_url": "https://<TEAM_NAME>.cloudflareaccess.com/populations/f174e90a-fafe-4643-bbbc-4a0ed4fc8415/scim/v2"  }'
5. Access: Organizations, Identity Providers, and Groups Write

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Okta

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/okta/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/okta/)

Page options # Okta

Okta provides cloud software that helps companies manage and secure user authentication to modern applications, and helps developers build identity controls into applications, website web services, and devices. You can integrate Okta with Cloudflare Zero Trust and build rules based on user identity and group membership. Cloudflare Zero Trust supports Okta integrations using either the OIDC (default) or SAML protocol.

Additionally, you can configure Okta to use risk information from Zero Trust user risk scores to create SSO-level policies. For more information, refer to Send risk score to Okta.

## Set up Okta as an OIDC provider

1. On your Okta admin dashboard, go to Applications > Applications.
2. Select Create App Integration.
3. For the Sign-in method, select OIDC - OpenID Connect.
4. For the Application type, select Web Application. Select Next.
5. Enter any name for the application. In the Sign-in redirect URIs field, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
6. Choose the desired Assignment option and select Save.
7. From the application view, go to the Sign On tab.
8. Scroll down to the OpenID ConnectID Token and select Edit.
9. Set the Groups claim filter to Matches regex and its value to .*.
NoteGroups managed outside of Okta (for example, Microsoft Entra ID or Google groups) may require different regex values. For more information, refer to the Okta documentation on Groups Claims ‚Üó and OpenID Connect Claims ‚Üó.
10. In the General tab, copy the Client ID and Client secret.
11. In Zero Trust ‚Üó, go to Settings > Authentication.
12. Under Login methods, select Add new. Select Okta as your identity provider.
13. Fill in the following information:

Name: Name your identity provider.
App ID: Enter your Okta client ID.
Client secret: Enter your Okta client secret.
Okta account URL: Enter your Okta domain ‚Üó, for example https://my-company.okta.com.
14. Name: Name your identity provider.
15. App ID: Enter your Okta client ID.
16. Client secret: Enter your Okta client secret.
17. Okta account URL: Enter your Okta domain ‚Üó, for example https://my-company.okta.com.
18. (Optional) Create an Okta API token and enter it in Zero Trust (the token can be read-only). This will prevent your Okta groups from failing if you have more than 100 groups.
19. (Optional) To configure custom OIDC claims:

In Okta, create a custom authorization server ‚Üó and ensure that the groups scope is enabled.
In Zero Trust, enter the Authorization Server ID obtained from Okta.
Under Optional configurations, enter the claims that you wish to add to your users' identity.
20. In Okta, create a custom authorization server ‚Üó and ensure that the groups scope is enabled.
21. In Zero Trust, enter the Authorization Server ID obtained from Okta.
22. Under Optional configurations, enter the claims that you wish to add to your users' identity.
23. (Optional) Enable Proof of Key Exchange (PKCE) ‚Üó. PKCE will be performed on all login attempts.
24. Select Save.

To test that your connection is working, select Test.

Note

If you see the error Failed to fetch user/group information from the identity, double-check your Okta configuration:

- If you have more than 100 Okta groups, ensure you include the API token.
- The request may be blocked by the ThreatInsights feature ‚Üó within Okta.

## Synchronize users and groups

The Okta integration allows you to synchronize IdP groups and automatically deprovision users using SCIM. To enable SCIM provisioning between Access and Okta, you need two separate app integrations in Okta:

- The Okta OIDC connector you created when adding Okta as an identity provider.
- A second Okta application of type SCIM 2.0 Test App (Header Auth). This is technically a SAML app but is responsible for sending user and group info via SCIM.

Note

If you would like to only maintain one Okta app instance, Okta does support SAML and SCIM within the same application. Create a generic SAML integration and configure those values in the Sign-On field of your Okta SCIM application.

### 1. Enable SCIM in Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Find the Okta integration and select Edit.
3. Turn on Enable SCIM
4. (Optional) Configure the following settings:

- Enable user deprovisioning: Revoke a user's active session when they are removed from the SCIM application in Okta. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies.
- Remove user seat on deprovision: Remove a user's seat from your Zero Trust account when they are removed from the SCIM application in Okta.
- SCIM identity update behavior: Choose what happens in Zero Trust when the user's identity updates in Okta.

Automatic identity updates: Automatically update the User Registry identity when Okta sends an updated identity or group membership through SCIM. This identity is used for Gateway policies and WARP device profiles; Access will read the user's updated identity when they reauthenticate.
Group membership change reauthentication: Revoke a user's active session when their group membership changes in Okta. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies. Access will read the user's updated group membership when they reauthenticate.
No action: Update the user's identity the next time they reauthenticate to Access or WARP.
- Automatic identity updates: Automatically update the User Registry identity when Okta sends an updated identity or group membership through SCIM. This identity is used for Gateway policies and WARP device profiles; Access will read the user's updated identity when they reauthenticate.
- Group membership change reauthentication: Revoke a user's active session when their group membership changes in Okta. This will invalidate all active Access sessions and prompt for reauthentication for any WARP session policies. Access will read the user's updated group membership when they reauthenticate.
- No action: Update the user's identity the next time they reauthenticate to Access or WARP.

1. Select Regenerate Secret. Copy the SCIM Endpoint and SCIM Secret. You will need to enter these values into Okta.
2. Select Save.

The SCIM secret never expires, but you can manually regenerate the secret at any time.

### 2. Configure SCIM in Okta

1. On your Okta admin dashboard, go to Applications > Applications.
2. Select Browse App Catalog.
3. Search for SCIM Header Auth and select SCIM 2.0 Test App (Header Auth).
4. Select Add Integration.
5. On the General Settings tab, name your application and select Next.
6. On the Sign-on Options tab, ensure that SAML 2.0 is selected. Select Done to create the integration.
7. On the Provisioning tab, select Configure API Integration.
8. Select Enable API integration.
9. In the Base URL field, enter the SCIM Endpoint obtained from Zero Trust.
10. In the API Token field, enter the SCIM Secret obtained from Zero Trust.
11. Select Test API Credentials to ensure that the credentials were entered correctly. Select Save.
12. On the Provisioning tab, select Edit and enable:

Create Users
Update User Attributes
Deactivate Users
13. Create Users
14. Update User Attributes
15. Deactivate Users
16. Select Save to complete the configuration.
17. In the Assignments tab, add the users you want to synchronize with Cloudflare Access. You can add users in batches by assigning a group. If a user is removed from the application assignment via a either direct user assignment or removed from the group that was assigned to the app, this will trigger a deprovisioning event from Okta to Cloudflare.
18. In the Push Groups tab, add the Okta groups you want to synchronize with Cloudflare Access. These groups will display in the Access policy builder and are the group memberships that will be added and removed upon membership change in Okta.
NoteGroups in this SCIM app Push Groups integration should match the groups in your base OIDC app integration. Because SCIM group membership updates will overwrite any groups in a user's identity, assigning the same groups to each app ensures consistent policy evaluation.

To verify the integration, select View Logs in the Okta SCIM application.

To check if user identities were updated in Zero Trust, view your SCIM provisioning logs.

Note

New users must first register the WARP client or authenticate to an Access application before SCIM provisioning can begin.

## Example API Configuration

```
{  "config": {    "client_id": "<your client id>",    "client_secret": "<your client secret>",    "okta_account": "https://dev-abc123.oktapreview.com"  },  "type": "okta",  "name": "my example idp"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Okta (SAML)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/okta-saml/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/okta-saml/)

Page options # Okta (SAML)

Cloudflare Zero Trust can integrate SAML with Okta as an identity provider.

## Set up Okta as a SAML provider

To set up SAML with Okta as your identity provider:

1. On your Okta admin dashboard, go to Applications > Applications.
2. Select Create App Integration.
3. In the pop-up dialog, select SAML 2.0 and then elect Next.
4. Enter an app name and select Next.
5. In the Single sign on URL and the Audience URI (SP Entity ID) fields, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
6. In the Attribute Statements section, enter the following information:

Name: Enter email.
Value: Enter user.email.
7. Name: Enter email.
8. Value: Enter user.email.
9. (Optional) If you are using Okta groups, create a Group Attribute Statement with the following information:

Name: Enter groups.
Filter: Select Matches regex and enter .*.
10. Name: Enter groups.
11. Filter: Select Matches regex and enter .*.

1. Select Next.
2. Select I'm an Okta customer adding an internal app and check This is an internal app that we have created.

1. Select Finish.
2. In the Assignments tab, select Assign and assign individuals or groups you want to grant access to.
3. Select Done. The assigned individuals and groups will display in the Assignments tab.

1. To retrieve the SAML provider information, go to the Sign On tab and select View Setup Instructions. A new page will open showing the Identity Provider Single Sign-on URL, Identity Provider Issuer, and X.509 Certificate. Save this information for configuring your Zero Trust settings.

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Select Add new under Login Methods, and select SAML.
3. Fill in the following information:

Name: Name your identity provider.
Single Sign On URL: Enter the Identity Provider Single-Sign-On URL from Okta.
Issuer ID: Enter the Identity Provider Issuer from Okta, for example http://www.okta.com/<your-okta-entity-id>.
Signing Certificate: Copy-paste the X.509 Certificate from Okta.
4. Name: Name your identity provider.
5. Single Sign On URL: Enter the Identity Provider Single-Sign-On URL from Okta.
6. Issuer ID: Enter the Identity Provider Issuer from Okta, for example http://www.okta.com/<your-okta-entity-id>.
7. Signing Certificate: Copy-paste the X.509 Certificate from Okta.
8. (Recommended) Enable Sign SAML authentication request.
9. (Recommended) Under SAML attributes, add the email and groups attributes. The groups attribute is required if you want to create policies based on Okta groups.

1. Select Save.

To test that your connection is working, go to Settings > Authentication > Login methods and select Test next to Okta. A success response should return the configured SAML attributes.

Warning

SAML attributes are only refreshed during authentications with the Okta identity provider. This means the Okta group membership is not updated unless a user logs in and out of the WARP client, or logs in to an Access application.

## Example API configuration

```
{  "config": {    "issuer_url": "http://www.okta.com/exkbhqj29iGxT7GwT0h7",    "sso_target_url": "https://dev-abc123.oktapreview.com/app/myapp/exkbhqj29iGxT7GwT0h7/sso/saml",    "attributes": ["email", "group"],    "email_attribute_name": "",    "sign_request": false,    "idp_public_certs": [      "MIIDpDCCAoygAwIBAgIGAV2ka+55MA0GCSqGSIb3DQEBCwUAMIGSMQswCQYDVQQGEwJVUzETMBEG\nA1UEC.....GF/Q2/MHadws97cZg\nuTnQyuOqPuHbnN83d/2l1NSYKCbHt24o"    ]  },  "type": "saml",  "name": "okta saml example"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## OneLogin

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/onelogin-oidc/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/onelogin-oidc/)

Page options # OneLogin

OneLogin provides SSO identity management. Cloudflare Access supports OneLogin as an OIDC identity provider.

## Set up OneLogin as an OIDC provider

### 1. Create an application in OneLogin

1. Log in to your OneLogin admin portal.
2. Go to Applications > Applications and select Add App.
3. Search for OIDC and select OpenId Connect (OIDC) by OneLogin, Inc.
4. In Display Name, enter any name for your application. Select Save.
5. Next, go to Configuration. In the Redirect URI field, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
6. Select Save.
7. Go to Access and choose the Roles that can access this application. Select Save.
8. Go to SSO and select Show client secret.
9. Copy the Client ID and Client Secret.

### 2. Add OneLogin to Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Select OneLogin.
4. Fill in the following information:

Name: Name your identity provider.
App ID: Enter your OneLogin client ID.
Client secret: Enter your OneLogin client secret.
OneLogin account URL: Enter your OneLogin domain, for example https://<your-domain>.onelogin.com.
5. Name: Name your identity provider.
6. App ID: Enter your OneLogin client ID.
7. Client secret: Enter your OneLogin client secret.
8. OneLogin account URL: Enter your OneLogin domain, for example https://<your-domain>.onelogin.com.
9. (Optional) To enable SCIM, refer to Synchronize users and groups.
10. (Optional) Under Optional configurations, enter custom OIDC claims that you wish to add to your user's identity.
11. Select Save.

To test that your connection is working, go to Authentication > Login methods and select Test next to OneLogin.

## Example API Config

```
{  "config": {    "client_id": "<your client id>",    "client_secret": "<your client secret>",    "onelogin_account": "https://mycompany.onelogin.com"  },  "type": "onelogin",  "name": "my example idp"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## OneLogin (SAML)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/onelogin-saml/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/onelogin-saml/)

Page options # OneLogin (SAML)

OneLogin provides SSO identity management. Cloudflare Access supports OneLogin as an SAML identity provider.

## Set up OneLogin as a SAML provider

## 1. Create an application in OneLogin

1. Log in to your OneLogin admin portal.
2. Select Apps > Add Apps.
3. Under Find Applications, search for Cloudflare Access.
4. Select the result sponsored by Cloudflare, Inc. You can customize the name or logo.
5. Select Save. You can change this information at any time.
6. Select the Configuration tab.
7. In the Cloudflare Access Authorization Domain field, paste your team domain:
https://<your-team-name>.cloudflareaccess.com
You can find your team name in Zero Trust under Settings > Custom Pages.
8. Select the Parameters tab, select Add Parameter and enter your values for Cloudflare Access Field.
9. Select the Access tab
10. In Roles, use the mapping to programmatically and automatically assign users that can access the application.
11. Select the SSO tab.
12. Copy the OneLogin SAML 2.0 Endpoint (HTTP) to the Cloudflare Single Sign On URL.
13. Copy the OneLogin Issuer URL to the Cloudflare IdP Entity ID.
14. Copy the X.509 Certificate to the Cloudflare Signing Certificate.

### 2. Add OneLogin to Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Select SAML.
4. Input the details from your OneLogin account in the fields.
5. (Optional) To enable SCIM, refer to Synchronize users and groups.
6. (Optional) Under Optional configurations, configure additional SAML options. If you added other SAML headers and attribute names to OneLogin, be sure to add them to Cloudflare.
7. Select Save.

To test that your connection is working, go to Authentication > Login methods and select Test next to the login method you want to test.

## Download SP metadata (optional)

OneLogin SAML allows administrators to upload metadata files from the service provider.

To add a metadata file to your OneLogin SAML configuration:

1. Download your unique SAML metadata file at the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/saml-metadata
2. Save the file as an XML document.
3. Upload the XML document to OneLogin.

## Example API configuration

```
{  "config": {    "issuer_url": "https://app.onelogin.com/saml/metadata/1b84ee45-d4fa-4373-8853-abz438942123",    "sso_target_url": "https://sandbox.onelogin.com/trust/saml2/http-post/sso/123456",    "attributes": ["email"],    "email_attribute_name": "",    "sign_request": false,    "idp_public_cert": "MIIDpDCCAoygAwIBAgIGAV2ka+55MA0GCSqGSIb3DQEBCwUAMIGSMQswCQYDVQQGEwJVUzETMBEG\nA1UEC.....GF/Q2/MHadws97cZg\nuTnQyuOqPuHbnN83d/2l1NSYKCbHt24o"  },  "type": "saml",  "name": "onelogin saml example"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## PingFederate

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/pingfederate-saml/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/pingfederate-saml/)

Page options # PingFederate

The PingFederate offering from PingIdentity provides SSO identity management. Cloudflare Access supports PingFederate as a SAML identity provider.

## Set up PingFederate as an identity provider

1. Log in to your Ping dashboard and go to Applications.
2. Select Add Application.
3. Select New SAML Application.
4. Complete the fields for name, description, and category.

These can be any value. A prompt displays to select a signing certificate to use.

1. In the SAML attribute configuration dialog select Email attribute > urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress.
2. Go to SP Connections > SP Connection > Credentials.
3. Add the matching certificate that you upload into the Cloudflare SAML configuration for Ping. Select Include the certificate in the signature <KEYINFO> element.

Note

There is an additional setting for PingFederate prior to 9.0.

1. In the Signature Policy tab, disable the option to Always Sign Assertion.
2. Leave the option enabled for Sign Response As Required.

This ensures that SAML destination headers are sent during the integration.

In versions 9.0 above, you can leave both of these options enabled.

1. A prompt displays to download the SAML metadata from Ping.

This file shares several fields with Cloudflare Access so you do not have to input this data.

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Select SAML.
4. In the IdP Entity ID field, enter the following URL:

```
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
```

You can find your team name in Zero Trust under Settings > Custom Pages.

1. Fill the other fields with values from your Ping dashboard.
2. Select Save.

To test that your connection is working, go to Authentication > Login methods and select Test next to the login method you want to test.

## Example API configuration

```
{  "config": {    "issuer_url": "https://example.cloudflareaccess.com/cdn-cgi/access/callback",    "sso_target_url": "https://sso.connect.pingidentity.com/sso/idp/SSO.saml2?idpid=aebe6668-32fe-4a87-8c2b-avcd3599a123",    "attributes": ["PingOne.AuthenticatingAuthority", "PingOne.idpid"],    "email_attribute_name": "",    "sign_request": false,    "idp_public_cert": "MIIDpDCCAoygAwIBAgIGAV2ka+55MA0GCSqGSIb3DQEBCwUAMIGSMQswCQYDVQQGEwJVUzETMBEG\nA1UEC.....GF/Q2/MHadws97cZg\nuTnQyuOqPuHbnN83d/2l1NSYKCbHt24o"  },  "type": "saml",  "name": "ping saml example"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## PingOne

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/pingone-oidc/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/pingone-oidc/)

Page options # PingOne

The PingOne cloud platform from PingIdentity provides SSO identity management. Cloudflare Access supports PingOne as an OIDC identity provider.

## Set up PingOne as an OIDC provider

### 1. Create an application in PingOne

1. In your PingIdentity environment, go to Connections > Applications.
2. Select Add Application.
3. Enter an Application Name.
4. Select OIDC Web App and then Save.
5. Select Resource Access and add the email and profile scopes.
6. In the Configuration tab, select General.
7. Copy the Client ID, Client Secret, and Environment ID to a safe place. These ids will be used in a later step to add PingOne to Zero Trust.
8. In the Configuration tab, select the pencil icon.
9. In the Redirect URIs field, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
10. Select Save.

### 2. Add PingOne to Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Select PingOne.
4. Input the Client ID, Client Secret, and Environment ID generated previously.
5. (Optional) Enable Proof of Key Exchange (PKCE) ‚Üó. PKCE will be performed on all login attempts.
6. (Optional) To enable SCIM, refer to Synchronize users and groups.
7. (Optional) Under Optional configurations, enter custom OIDC claims that you wish to add to your users' identity.
8. Select Save.

You can now test your connection and create Access policies based on the configured login method.

## Example API configuration

```
{  "config": {    "client_id": "<your client id>",    "client_secret": "<your client secret>",    "ping_env_id": "<your ping environment id>"  },  "type": "ping",  "name": "my example idp"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## PingOne (SAML)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/pingone-saml/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/pingone-saml/)

Page options # PingOne (SAML)

The PingOne cloud platform from PingIdentity provides SSO identity management. Cloudflare Access supports PingOne as a SAML identity provider.

## Set up PingOne as a SAML provider

## 1. Create an application in PingOne

1. In your PingIdentity environment, go to Connections > Applications.
2. Select Add Application.
3. Enter an Application Name.
4. Select SAML Application.
5. Select Configure.
6. To fill in your Cloudflare Access metadata:

Select Import from URL.
Set the Import URL to:

https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/saml-metadata
where <your-team-name> is your Cloudflare Zero Trust team name.

Select Import.
Save the configuration.
7. Select Import from URL.
8. Set the Import URL to:
9. Select Import.
10. Save the configuration.
11. In the Configuration tab, select Download metadata and save the XML metadata file. This file will be used in a later step to add PingOne to Zero Trust.
12. In the Attribute Mappings tab, add the following required attributes (case sensitive) and select Save.





















Application attributeOutgoing valueemailEmail AddressgivenNameGiven NamesurNameFamily Name
These SAML attributes tell Cloudflare Access who the user is.
13. Set the application to Active.

### 2. Add PingOne to Zero Trust

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Select SAML.
4. Upload your PingOne XML metadata file.
5. (Optional) To enable SCIM, refer to Synchronize users and groups.
6. (Optional) Under Optional configurations, configure additional SAML options.
7. Select Save.

You can now test your connection and create Access policies based on the configured login method and SAML attributes.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Signed AuthN requests (SAML)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/signed_authn/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/signed_authn/)

Page options # Signed AuthN requests (SAML)

In a SAML request flow, Cloudflare Access functions as the service provider (SP) to the identity provider (IdP). Cloudflare Access sends a SAML request to your IdP. The signing certificate that you upload from your SAML provider verifies the response.

In some cases, administrators need to verify that the request from the SP is authentic. By validating both the requests from the SP and the responses from the IdP, teams can ensure that operations in the SAML relationship are signed in both directions.

Cloudflare Access supports this requirement in the form of Signed AuthN requests. When enabled, Access sends a signature embedded in an HTTP POST request that contains the AuthN details.

## Set up Signed AuthN requests

To set up Signed AuthN requests:

1. In Zero Trust, go to Settings > Authentication.
2. Under Login methods, select Add new.
3. Choose SAML on the next page.
4. Complete the fields in the dialog.
5. Go to this URL to find the certificate:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/public-cert
Ensure that your IdP validation uses the most recent certificate. Cloudflare Access routinely rotates the public key as a security measure.
Cloudflare Access uses a certificate that includes the following 2 distinguished name fields:

Issuer Distinguished Name - CN=cloudflareaccess.com, C=US, ST=Texas, L=Austin, O=Cloudflare
Subject Distinguished Name - CN=*.cloudflareaccess.com, C=US, ST=Texas, L=Austin, O=Cloudflare

Most IdP configurations require 3 components to enforce AuthN signature verification:

Certificate issuer distinguished name (DN) ‚Üó
Certificate subject distinguished name
Public certificate
6. Issuer Distinguished Name - CN=cloudflareaccess.com, C=US, ST=Texas, L=Austin, O=Cloudflare
7. Subject Distinguished Name - CN=*.cloudflareaccess.com, C=US, ST=Texas, L=Austin, O=Cloudflare
8. Certificate issuer distinguished name (DN) ‚Üó
9. Certificate subject distinguished name
10. Public certificate
11. In your IdP account, replace your authorization domain with the team domain generated by Cloudflare Access.
This is an example format:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/public-cert

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Yandex

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/yandex/](https://developers.cloudflare.com/cloudflare-one/identity/idp-integration/yandex/)

Page options # Yandex

Yandex is a web search engine that also offers identity provider (IdP) services.

## Set up Yandex

To set up Yandex for Cloudflare Access:

1. Log in to your Yandex account.
2. Select Open a new OAuth Application.
3. Select New client.
4. Complete the required fields.
5. Choose Yandex.Passport API to set the basic scopes.
6. Select the Access to email address, Access to user avatar, and Access to username, first name and surname, gender options.
7. Select Platform and select Web Services.
8. In the Callback URL #1 field, enter the following URL:
https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/callback
You can find your team name in Zero Trust under Settings > Custom Pages.
9. Select Add.
10. Scroll to the Platforms card, and select Submit.
Yandex OAuth card titled Cloudflare Access App displays.
11. Copy the ID and Password.
12. In Zero Trust, go to Settings > Authentication.
13. Under Login methods, select Add new.
14. Select Yandex.
15. Paste the ID and password in the appropriate fields.
16. Select Save.

## Example API Config

```
{  "config": {    "client_id": "<your client id>",    "client_secret": "<your client secret>"  },  "type": "yandex",  "name": "my example idp"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connections

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/](https://developers.cloudflare.com/cloudflare-one/connections/)

Page options # Connections

Learn how you can connect your applications, devices, and networks to Cloudflare.

- Cloudflare Tunnel
- Connect devices

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Cloudflare Tunnel

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/)

Page options # Cloudflare Tunnel

Cloudflare Tunnel provides you with a secure way to connect your resources to Cloudflare without a publicly routable IP address. With Tunnel, you do not send traffic to an external IP ‚Äî instead, a lightweight daemon in your infrastructure (cloudflared) creates outbound-only connections to Cloudflare's global network. Cloudflare Tunnel can connect HTTP web servers, SSH servers, remote desktops, and other protocols safely to Cloudflare. This way, your origins can serve traffic through Cloudflare without being vulnerable to attacks that bypass Cloudflare.

Refer to our reference architecture for details on how to implement Cloudflare Tunnel into your existing infrastructure.

## How it works

Cloudflared establishes outbound connections (tunnels) between your resources and Cloudflare's global network. Tunnels are persistent objects that route traffic to DNS records. Within the same tunnel, you can run as many 'cloudflared' processes (connectors) as needed. These processes will establish connections to Cloudflare and send traffic to the nearest Cloudflare data center.

## Outbound-only connection

Cloudflare Tunnel uses an outbound-only connection model to enable bidirectional communication. When you install and run cloudflared, cloudflared initiates an outbound connection through your firewall from the origin to the Cloudflare global network.

Once the connection is established, traffic flows in both directions over the tunnel between your origin and Cloudflare. Most firewalls allow outbound traffic by default. cloudflared takes advantage of this standard by connecting out to the Cloudflare network from the server you installed cloudflared on. You can then configure your firewall to allow only these outbound connections and block all inbound traffic, effectively blocking access to your origin from anything other than Cloudflare. This setup ensures that all traffic to your origin is securely routed through the tunnel.

## Next steps

- Create a tunnel using the Cloudflare dashboard or API.
- Learn more about cloudflared, the server-side daemon that connects your infrastructure to Cloudflare.
- Review useful Tunnel terms to familiarize yourself with the concepts used in Tunnel documentation.
- Troubleshoot your Tunnel by reviewing available logs and common errors.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Get started

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/)

Page options # Get started

To create and manage tunnels, you will need to install and authenticate cloudflared on your origin server. cloudflared is what connects your server to Cloudflare's global network.

- Create a tunnel (dashboard)
- Create a tunnel (API)
- Useful terms

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Create a tunnel (dashboard)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/create-remote-tunnel/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/create-remote-tunnel/)

Page options # Create a tunnel (dashboard)

Follow this step-by-step guide to create your first remotely-managed tunnel using Zero Trust.

## 1. Create a tunnel

1. Log in to Zero Trust ‚Üó and go to Networks > Tunnels.
2. Select Create a tunnel.
3. Choose Cloudflared for the connector type and select Next.
4. Enter a name for your tunnel. We suggest choosing a name that reflects the type of resources you want to connect through this tunnel (for example, enterprise-VPC-01).
5. Select Save tunnel.
6. Next, you will need to install cloudflared and run it. To do so, check that the environment under Choose an environment reflects the operating system on your machine, then copy the command in the box below and paste it into a terminal window. Run the command.
7. Once the command has finished running, your connector will appear in Zero Trust.
8. Select Next.

The next steps depend on whether you want to connect an application or connect a network.

## 2a. Connect an application

Before you connect an application through your tunnel, you must:

- Add a website to Cloudflare.
- Change your domain nameservers to Cloudflare.

Follow these steps to connect an application through your tunnel. If you are looking to connect a network, skip to the Connect a network section.

1. In the Public Hostnames tab, select Add a public hostname.
2. Enter a subdomain and select a Domain from the dropdown menu. Specify any subdomain or path information.
NoteIf you add a multi-level subdomain (more than one level of subdomain), you must order an Advanced Certificate for the hostname.
3. Specify a service, for example https://localhost:8000.
4. Under Additional application settings, specify any parameters you would like to add to your tunnel configuration.
5. Select Save hostname.

The application is now publicly available on the Internet. To allow or block specific users, create an Access application.

## 2b. Connect a network

Follow these steps to connect a private network through your tunnel.

1. In the Private Networks tab, add the IP or CIDR of your service.
2. Select Save tunnel.

To configure Zero Trust policies and connect as a user, refer to Connect private networks.

## 3. View your tunnel

After saving the tunnel, you will be redirected to the Tunnels page. Look for your new tunnel to be listed along with its active connector.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Create a tunnel (API)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/create-remote-tunnel-api/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/create-remote-tunnel-api/)

Page options # Create a tunnel (API)

Follow this guide to set up a Cloudflare Tunnel using the API.

## Create an API token

Create an API token with the following permissions:

| Type | Item | Permission |
| --- | --- | --- |
| Account | Cloudflare Tunnel | Edit |
| Zone | DNS | Edit |

## 2. Create a tunnel

Make a POST request to the Cloudflare Tunnel endpoint:

Required API token permissions

At least one of the following token permissions is required: - Cloudflare One Connectors Write
- Cloudflare One Connector: cloudflared Write
- Cloudflare Tunnel Write

Create a Cloudflare Tunnel ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/cfd_tunnel" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "api-tunnel",    "config_src": "cloudflare"  }'
```

```
{  "success": true,  "errors": [],  "messages": [],  "result": {    "id": "c1744f8b-faa1-48a4-9e5c-02ac921467fa",    "account_tag": "699d98642c564d2e855e9661899b7252",    "created_at": "2025-02-18T22:41:43.534395Z",    "deleted_at": null,    "name": "example-tunnel",    "connections": [],    "conns_active_at": null,    "conns_inactive_at": "2025-02-18T22:41:43.534395Z",    "tun_type": "cfd_tunnel",    "metadata": {},    "status": "inactive",    "remote_config": true,    "credentials_file": {      "AccountTag": "699d98642c564d2e855e9661899b7252",      "TunnelID": "c1744f8b-faa1-48a4-9e5c-02ac921467fa",      "TunnelName": "api-tunnel",      "TunnelSecret": "bTSquyUGwLQjYJn8cI8S1h6M6wUc2ajIeT7JotlxI7TqNqdKFhuQwX3O8irSnb=="    },    "token": "eyJhIjoiNWFiNGU5Z..."  }}
```

Copy the id and token values shown in the output. You will need these values to configure and run the tunnel.

The next steps depend on whether you want to connect an application or connect a network.

## 3a. Connect an application

Before you connect an application through your tunnel, you must:

- Add a website to Cloudflare.
- Change your domain nameservers to Cloudflare.

Follow these steps to connect an application through your tunnel. If you are looking to connect a network, skip to the Connect a network section.

1. Make a PUT request to route your local service URL to a public hostname. For example,
 Required API token permissions
 
At least one of the following token permissions 
is required:
Cloudflare One Connectors WriteCloudflare One Connector: cloudflared WriteCloudflare Tunnel Write Put configurationcurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/cfd_tunnel/$TUNNEL_ID/configurations" \  --request PUT \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "config": {        "ingress": [            {                "hostname": "app.example.com",                "service": "http://localhost:8001",                "originRequest": {}            },            {                "service": "http_status:404"            }        ]    }  }'
NoteIf you add a multi-level subdomain (more than one level of subdomain), you must order an Advanced Certificate for the hostname.
Your ingress rules must include a catch-all rule at the end. In this example, cloudflared will respond with a 404 status code when the request does not match any of the previous hostnames.
2. Cloudflare One Connectors Write
3. Cloudflare One Connector: cloudflared Write
4. Cloudflare Tunnel Write
5. Create a DNS record for your application:
 Required API token permissions
 
At least one of the following token permissions 
is required:
DNS Write Create DNS Recordcurl "https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "type": "CNAME",    "proxied": true,    "name": "app.example.com",    "content": "c1744f8b-faa1-48a4-9e5c-02ac921467fa.cfargotunnel.com"  }'
This DNS record allows Cloudflare to proxy app.example.com traffic to your Cloudflare Tunnel (<tunnel-id>.cfargotunnel.com).
6. DNS Write

This application will be publicly available on the Internet once you run the tunnel. To allow or block specific users, create an Access application.

## 3b. Connect a network

To connect a private network through your tunnel, add a tunnel route:

Required API token permissions

At least one of the following token permissions is required: - Cloudflare One Networks Write
- Cloudflare Tunnel Write

Create a tunnel route ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/teamnet/routes" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "network": "172.16.0.0/16",    "tunnel_id": "c1744f8b-faa1-48a4-9e5c-02ac921467fa",    "comment": "Example private network route"  }'
```

To configure Zero Trust policies and connect as a user, refer to Connect private networks.

## 4. Install and run the tunnel

Install cloudflared on your server and run the tunnel using the token value obtained in 2. Create a tunnel. You can also get the tunnel token using the Cloudflare Tunnel token endpoint.

- Linux
- Windows
- macOS
- Docker

1. Download and install ‚Üó cloudflared.
2. Run the following command:
Terminal windowsudo cloudflared service install <TUNNEL_TOKEN>

1. Download and install cloudflared.
2. Open Command Prompt as administrator.
3. Run the following command:
cloudflared.exe service install <TUNNEL_TOKEN>

1. Download and install cloudflared.
2. Open a terminal window and run the following command:
Terminal windowsudo cloudflared service install <TUNNEL_TOKEN>

1. Open a terminal window.
2. Run the following command:
Terminal windowdocker run cloudflare/cloudflared:latest tunnel --no-autoupdate run --token <TUNNEL_TOKEN>

## 5. Verify tunnel status

To check if the tunnel is serving traffic:

Required API token permissions

At least one of the following token permissions is required: - Cloudflare One Connectors Write
- Cloudflare One Connectors Read
- Cloudflare One Connector: cloudflared Write
- Cloudflare One Connector: cloudflared Read
- Cloudflare Tunnel Write
- Cloudflare Tunnel Read

Get a Cloudflare Tunnel ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/cfd_tunnel/c1744f8b-faa1-48a4-9e5c-02ac921467fa" \  --request GET \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
```

```
{  "success": true,  "errors": [],  "messages": [],  "result": {    "id": "c1744f8b-faa1-48a4-9e5c-02ac921467fa",    "account_tag": "699d98642c564d2e855e9661899b7252",    "created_at": "2025-02-18T22:41:43.534395Z",    "deleted_at": null,    "name": "example-tunnel",    "connections": [      {        "colo_name": "bos01",        "uuid": "2xz99mfm-a59e-4924-gyh9-z9vafaw6k0i2",        "id": "2xz99mfm-a59e-4924-gyh9-z9vafaw6k0i2",        "is_pending_reconnect": false,        "origin_ip": "10.1.0.137",        "opened_at": "2025-02-19T19:11:12.101642Z",        "client_id": "4xh4eb3f-cz0j-2aso-hu6i-36207018771a",        "client_version": "2025.2.0"      },      {        "colo_name": "phl01",        "uuid": "axe2socu-2fb5-3akx-b860-898zyes3cs9q",        "id": "axe2socu-2fb5-3akx-b860-898zyes3cs9q",        "is_pending_reconnect": false,        "origin_ip": "10.1.0.137",        "opened_at": "2025-02-19T19:11:12.006297Z",        "client_id": "4xh4eb3f-cz0j-2aso-hu6i-36207018771a",        "client_version": "2025.2.0"      },      {        "colo_name": "phl01",        "uuid": "9b5y0wm9-ca7f-ibq6-8ff4-sm53xekfyym1",        "id": "9b5y0wm9-ca7f-ibq6-8ff4-sm53xekfyym1",        "is_pending_reconnect": false,        "origin_ip": "10.1.0.137",        "opened_at": "2025-02-19T19:11:12.004721Z",        "client_id": "4xh4eb3f-cz0j-2aso-hu6i-36207018771a",        "client_version": "2025.2.0"      },      {        "colo_name": "bos01",        "uuid": "g6cdeiz1-80f5-3akx-b18b-3y0ggktoxwkd",        "id": "g6cdeiz1-80f5-3akx-b18b-3y0ggktoxwkd",        "is_pending_reconnect": false,        "origin_ip": "10.1.0.137",        "opened_at": "2025-02-19T19:11:12.110765Z",        "client_id": "4xh4eb3f-cz0j-2aso-hu6i-36207018771a",        "client_version": "2025.2.0"      }    ],    "conns_active_at": "2025-02-19T19:11:12.004721Z",    "conns_inactive_at": null,    "tun_type": "cfd_tunnel",    "metadata": {},    "status": "healthy",    "remote_config": true  }}
```

A healthy tunnel will have four connections to Cloudflare's network.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Useful terms

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/tunnel-useful-terms/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/get-started/tunnel-useful-terms/)

Page options # Useful terms

Review terminology for Cloudflare Tunnels.

## Tunnel

A tunnel is a secure, outbound-only pathway you can establish between your origin and Cloudflare's global network. Each tunnel you create will be assigned a name and a UUID.

## Tunnel UUID

A tunnel UUID is an alphanumeric, unique ID assigned to a tunnel. The tunnel UUID can be used whenever you need to reference a specific tunnel.

## Tunnel name

A tunnel name is a unique, user-friendly identifier that you choose for a tunnel. Since a tunnel can proxy traffic to multiple services, tunnel names do not need to be hostnames. For example, you can assign your tunnel a name that represents your application/network, a particular server, or the cloud environment where it runs.

## Connector

The connector, referred to as cloudflared, establishes connectivity from your origin server to the Cloudflare global network. Our connector offers high availability by creating four long-lived connections to two distinct data centers within Cloudflare's global network. This built-in redundancy means that if an individual connection, server, or data center goes down, your origin remains available.

## Replica

You can create and configure a tunnel once and run that tunnel through multiple, unique instances of the connector, cloudflared. These instances are known as replicas. DNS records and Cloudflare Load Balancers will still point to the tunnel and its DNS Record (UUID.cfargotunnel.com), while that tunnel sends traffic to the multiple instances of cloudflared that run through it. Today, there is no guarantee about which replica will be chosen. Replicas are often deployed to provide tunnels with high availability in the event a given host running cloudflared is interrupted or taken offline.

## Remotely-managed tunnel

A remotely-managed tunnel is a tunnel that was created in Zero Trust ‚Üó under Networks > Tunnels. Tunnel configuration is stored in Cloudflare, which allows you to manage the tunnel from the dashboard or using the API.

## Locally-managed tunnel

A locally-managed tunnel is a tunnel that was created by running cloudflared tunnel create <NAME> on the command line. Tunnel configuration is stored in your local cloudflared directory. For terminology specific to locally-managed tunnels, refer to the Locally-managed tunnel glossary.

## Quick tunnels

Quick tunnels, when run, will generate a URL that consists of a random subdomain of the website trycloudflare.com, and point traffic to localhost on port 8080. If you have a web service running at that address, users who visit the generated subdomain will be able to visit your web service through Cloudflare's network. Refer to TryCloudflare for more information on how to run quick tunnels.

## Virtual networks

A virtual network is a software abstraction that allows you to logically segregate resources on your private network. Virtual networks are especially useful for exposing resources which have overlapping IP routes. To connect to a resource, end users would select a virtual network in their WARP client settings before entering the destination IP.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Downloads

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/)

Page options # Downloads

Cloudflare Tunnel requires the installation of a lightweight server-side daemon, cloudflared, to connect your infrastructure to Cloudflare. If you are creating a tunnel through the dashboard, you can simply copy-paste the installation command shown in the dashboard.

To download and install cloudflared manually, use one of the following links.

## GitHub repository

cloudflared is an open source project ‚Üó maintained by Cloudflare.

- All releases ‚Üó
- Release notes ‚Üó

## Latest release

### Linux

You can download and install cloudflared via the Cloudflare Package Repository ‚Üó.

Alternatively, download the latest release directly:

| Type | amd64 / x86-64 | x86 (32-bit) | ARM | ARM64 |
| --- | --- | --- | --- | --- |
| Binary | Download ‚Üó | Download ‚Üó | Download ‚Üó | Download ‚Üó |
| .deb | Download ‚Üó | Download ‚Üó | Download ‚Üó | Download ‚Üó |
| .rpm | Download ‚Üó | Download ‚Üó | Download ‚Üó | Download ‚Üó |

### macOS

Download and install cloudflared via Homebrew:

Terminal window ```
brew install cloudflared
```

Alternatively, download the latest Darwin arm64 release ‚Üó or latest Darwin amd64 release ‚Üó directly.

### Windows

Download and install cloudflared via winget ‚Üó:

Terminal window ```
winget install --id Cloudflare.cloudflared
```

Alternatively, download the latest release directly:

| Type | 32-bit | 64-bit |
| --- | --- | --- |
| Executable | Download ‚Üó | Download ‚Üó |

Note

Instances of cloudflared do not automatically update on Windows. You will need to perform manual updates.

### Docker

A Docker image of cloudflared is available on DockerHub ‚Üó.

## Deprecated releases

Cloudflare supports versions of cloudflared that are within one year of the most recent release. Breaking changes unrelated to feature availability may be introduced that will impact versions released more than one year ago. For example, as of January 2023 Cloudflare will support cloudflared version 2023.1.1 to cloudflared 2022.1.1.

To update cloudflared, refer to these instructions.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Update cloudflared

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/update-cloudflared/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/update-cloudflared/)

Page options # Update cloudflared

Updates will cause cloudflared to restart which will impact traffic currently being served. You can perform zero-downtime upgrades by using Cloudflare's Load Balancer product or by using multiple cloudflared instances.

## Update the cloudflared service

Refer to the following commands to update cloudflared for a remotely-managed tunnel created through the dashboard or a locally-managed tunnel. Locally-managed tunnels must be set up to run as a service for the following commands to execute successfully.

- Windows
- macOS
- Debian
- Red Hat
- Docker
- Other

Run the following command:

PowerShell ```
cloudflared update
```

After running cloudflared update to update cloudflared, you must restart the service for it to take effect. Run:

PowerShell ```
net start cloudflared
```

1. Update the cloudflared package:

Terminal window ```
brew upgrade cloudflared
```

1. Restart the service:

Terminal window ```
sudo launchctl stop com.cloudflare.cloudflaredsudo launchctl unload /Library/LaunchDaemons/com.cloudflare.cloudflared.plistsudo launchctl load /Library/LaunchDaemons/com.cloudflare.cloudflared.plistsudo launchctl start com.cloudflare.cloudflared
```

If installed via apt:

1. Update the cloudflared package:

Terminal window ```
sudo apt-get update && sudo apt-get install --only-upgrade cloudflared
```

1. Restart the service:

Terminal window ```
sudo systemctl restart cloudflared.service
```

If installed via dpkg -i:

Use the following commands if you installed cloudflared using the dpkg package manager.

You can check if cloudflared was installed by a package manager by running ls -la /usr/local/etc/cloudflared/ and looking for .installedFromPackageManager in the output.

1. Update the cloudflared package:

Terminal window ```
curl --location --output cloudflared.deb https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb && sudo dpkg -i cloudflared.deb
```

1. Restart the service:

Terminal window ```
sudo systemctl restart cloudflared.service
```

1. Update the cloudflared package:

Terminal window ```
sudo yum update cloudflared
```

1. Restart the service:

Terminal window ```
sudo systemctl restart cloudflared.service
```

If you created a remotely-managed tunnel using the dashboard:

1. In Zero Trust ‚Üó, go to Networks > Tunnels.
2. Select your tunnel and select Configure.
3. Select Docker and copy the installation command shown in the dashboard. The copied command will contain your token.
4. Paste this command into a terminal window.

This command creates a new container from the latest cloudflared image. You can now delete the old container.

Warning

Cloudflare recommends creating remotely-managed tunnels when working with Docker.

If you created a remotely or locally-managed tunnel using the API, run the following command:

Terminal window ```
docker run --pull always cloudflare/cloudflared:latest tunnel --no-autoupdate run --token <TOKEN>
```

If you created a locally-managed tunnel using the CLI:

1. Mount your local .cloudflared directory into the Docker container using a volume.
2. Run the following command to update cloudflared:
Terminal windowdocker run --pull always -v <PATH-TO-YOUR-LOCAL-CLOUDFLARED>:/home/nonroot/.cloudflared cloudflare/cloudflared:latest tunnel --no-autoupdate run <TUNNEL-ID>

If you installed cloudflared from GitHub-provided binaries or from source, run the following command:

Terminal window ```
cloudflared update
```

If you installed cloudflared with a package manager, you must update it using the same package manager.

You can check if cloudflared was installed by a package manager by running ls -la /usr/local/etc/cloudflared/ and looking for .installedFromPackageManager in the output.

## Update with Cloudflare Load Balancer

You can update cloudflared without downtime by using Cloudflare's Load Balancer product with your Cloudflare Tunnel deployment.

1. Install a new instance of cloudflared and create a new Tunnel.
2. Configure the instance to point traffic to the same locally-available service as your current, active instance of cloudflared.
3. Add the address of the new instance of cloudflared into your Load Balancer pool as priority 2.
4. Swap the priority such that the new instance is now priority 1 and monitor to confirm traffic is being served.
5. Once confirmed, you can remove the older version from the Load Balancer pool.

## Update with multiple cloudflared instances

If you are not using Cloudflare's Load Balancer, you can use multiple instances of cloudflared to update without the risk of downtime.

1. Install a new instance of cloudflared and create a new Tunnel.
2. Configure the instance to point traffic to the same locally-available service as your current, active instance of cloudflared.
3. In the Cloudflare DNS dashboard, replace the address of the current instance of cloudflared with the address of the new instance. Save the record.
4. Remove the now-inactive instance of cloudflared.

Traffic handling

When the old replica is stopped, it will drop long-lived HTTP requests (for example, WebSocket) and TCP connections (for example, SSH). UDP flows will also be dropped, as they are modeled based on timeouts. When the new replica connects, it will handle all new traffic, including new HTTP requests, TCP connections, and UDP flows.

### Run multiple instances in Windows

Windows systems require services to have a unique name and display name. You can run multiple instances of cloudflared by creating cloudflared services with unique names.

1. Install and configure cloudflared.
2. Next, create a service with a unique name and point to the cloudflared executable and configuration file.

PowerShell ```
sc.exe create <unique-name> binPath='<path-to-exe>' --config '<path-to-config>' displayname="Unique Name"
```

1. Proceed to create additional services with unique names.
2. You can now start each unique service.

PowerShell ```
sc.exe start <unique-name>
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## License

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/license/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/license/)

Page options # License

Apache License
Version 2.0, January 2004
http://www.apache.org/licenses/ ‚Üó

```
TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
1. Definitions.
  "License" shall mean the terms and conditions for use, reproduction,  and distribution as defined by Sections 1 through 9 of this document.
  "Licensor" shall mean the copyright owner or entity authorized by  the copyright owner that is granting the License.
  "Legal Entity" shall mean the union of the acting entity and all  other entities that control, are controlled by, or are under common  control with that entity. For the purposes of this definition,  "control" means (i) the power, direct or indirect, to cause the  direction or management of such entity, whether by contract or  otherwise, or (ii) ownership of fifty percent (50%) or more of the  outstanding shares, or (iii) beneficial ownership of such entity.
  "You" (or "Your") shall mean an individual or Legal Entity  exercising permissions granted by this License.
  "Source" form shall mean the preferred form for making modifications,  including but not limited to software source code, documentation  source, and configuration files.
  "Object" form shall mean any form resulting from mechanical  transformation or translation of a Source form, including but  not limited to compiled object code, generated documentation,  and conversions to other media types.
  "Work" shall mean the work of authorship, whether in Source or  Object form, made available under the License, as indicated by a  copyright notice that is included in or attached to the work  (an example is provided in the Appendix below).
  "Derivative Works" shall mean any work, whether in Source or Object  form, that is based on (or derived from) the Work and for which the  editorial revisions, annotations, elaborations, or other modifications  represent, as a whole, an original work of authorship. For the purposes  of this License, Derivative Works shall not include works that remain  separable from, or merely link (or bind by name) to the interfaces of,  the Work and Derivative Works thereof.
  "Contribution" shall mean any work of authorship, including  the original version of the Work and any modifications or additions  to that Work or Derivative Works thereof, that is intentionally  submitted to Licensor for inclusion in the Work by the copyright owner  or by an individual or Legal Entity authorized to submit on behalf of  the copyright owner. For the purposes of this definition, "submitted"  means any form of electronic, verbal, or written communication sent  to the Licensor or its representatives, including but not limited to  communication on electronic mailing lists, source code control systems,  and issue tracking systems that are managed by, or on behalf of, the  Licensor for the purpose of discussing and improving the Work, but  excluding communication that is conspicuously marked or otherwise  designated in writing by the copyright owner as "Not a Contribution."
  "Contributor" shall mean Licensor and any individual or Legal Entity  on behalf of whom a Contribution has been received by Licensor and  subsequently incorporated within the Work.
2. Grant of Copyright License. Subject to the terms and conditions of  this License, each Contributor hereby grants to You a perpetual,  worldwide, non-exclusive, no-charge, royalty-free, irrevocable  copyright license to reproduce, prepare Derivative Works of,  publicly display, publicly perform, sublicense, and distribute the  Work and such Derivative Works in Source or Object form.
3. Grant of Patent License. Subject to the terms and conditions of  this License, each Contributor hereby grants to You a perpetual,  worldwide, non-exclusive, no-charge, royalty-free, irrevocable  (except as stated in this section) patent license to make, have made,  use, offer to sell, sell, import, and otherwise transfer the Work,  where such license applies only to those patent claims licensable  by such Contributor that are necessarily infringed by their  Contribution(s) alone or by combination of their Contribution(s)  with the Work to which such Contribution(s) was submitted. If You  institute patent litigation against any entity (including a  cross-claim or counterclaim in a lawsuit) alleging that the Work  or a Contribution incorporated within the Work constitutes direct  or contributory patent infringement, then any patent licenses  granted to You under this License for that Work shall terminate  as of the date such litigation is filed.
4. Redistribution. You may reproduce and distribute copies of the  Work or Derivative Works thereof in any medium, with or without  modifications, and in Source or Object form, provided that You  meet the following conditions:
  (a) You must give any other recipients of the Work or      Derivative Works a copy of this License; and
  (b) You must cause any modified files to carry prominent notices      stating that You changed the files; and
  (c) You must retain, in the Source form of any Derivative Works      that You distribute, all copyright, patent, trademark, and      attribution notices from the Source form of the Work,      excluding those notices that do not pertain to any part of      the Derivative Works; and
  (d) If the Work includes a "NOTICE" text file as part of its      distribution, then any Derivative Works that You distribute must      include a readable copy of the attribution notices contained      within such NOTICE file, excluding those notices that do not      pertain to any part of the Derivative Works, in at least one      of the following places: within a NOTICE text file distributed      as part of the Derivative Works; within the Source form or      documentation, if provided along with the Derivative Works; or,      within a display generated by the Derivative Works, if and      wherever such third-party notices normally appear. The contents      of the NOTICE file are for informational purposes only and      do not modify the License. You may add Your own attribution      notices within Derivative Works that You distribute, alongside      or as an addendum to the NOTICE text from the Work, provided      that such additional attribution notices cannot be construed      as modifying the License.
  You may add Your own copyright statement to Your modifications and  may provide additional or different license terms and conditions  for use, reproduction, or distribution of Your modifications, or  for any such Derivative Works as a whole, provided Your use,  reproduction, and distribution of the Work otherwise complies with  the conditions stated in this License.
5. Submission of Contributions. Unless You explicitly state otherwise,  any Contribution intentionally submitted for inclusion in the Work  by You to the Licensor shall be under the terms and conditions of  this License, without any additional terms or conditions.  Notwithstanding the above, nothing herein shall supersede or modify  the terms of any separate license agreement you may have executed  with Licensor regarding such Contributions.
6. Trademarks. This License does not grant permission to use the trade  names, trademarks, service marks, or product names of the Licensor,  except as required for reasonable and customary use in describing the  origin of the Work and reproducing the content of the NOTICE file.
7. Disclaimer of Warranty. Unless required by applicable law or  agreed to in writing, Licensor provides the Work (and each  Contributor provides its Contributions) on an "AS IS" BASIS,  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or  implied, including, without limitation, any warranties or conditions  of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A  PARTICULAR PURPOSE. You are solely responsible for determining the  appropriateness of using or redistributing the Work and assume any  risks associated with Your exercise of permissions under this License.
8. Limitation of Liability. In no event and under no legal theory,  whether in tort (including negligence), contract, or otherwise,  unless required by applicable law (such as deliberate and grossly  negligent acts) or agreed to in writing, shall any Contributor be  liable to You for damages, including any direct, indirect, special,  incidental, or consequential damages of any character arising as a  result of this License or out of the use or inability to use the  Work (including but not limited to damages for loss of goodwill,  work stoppage, computer failure or malfunction, or any and all  other commercial damages or losses), even if such Contributor  has been advised of the possibility of such damages.
9. Accepting Warranty or Additional Liability. While redistributing  the Work or Derivative Works thereof, You may choose to offer,  and charge a fee for, acceptance of support, warranty, indemnity,  or other liability obligations and/or rights consistent with this  License. However, in accepting such obligations, You may act only  on Your own behalf and on Your sole responsibility, not on behalf  of any other Contributor, and only if You agree to indemnify,  defend, and hold each Contributor harmless for any liability  incurred by, or claims asserted against, such Contributor by reason  of your accepting any such warranty or additional liability.
END OF TERMS AND CONDITIONS
APPENDIX: How to apply the Apache License to your work.
  To apply the Apache License to your work, attach the following  boilerplate notice, with the fields enclosed by brackets "[]"  replaced with your own identifying information. (Don't include  the brackets!)  The text should be enclosed in the appropriate  comment syntax for the file format. We also recommend that a  file or class name and description of purpose be included on the  same "printed page" as the copyright notice for easier  identification within third-party archives.
Copyright [yyyy] [name of copyright owner]
Licensed under the Apache License, Version 2.0 (the "License");you may not use this file except in compliance with the License.You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an "AS IS" BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License.
```

## Runtime Library Exception to the Apache 2.0 License:

```
As an exception, if you use this Software to compile your source code andportions of this Software are embedded into the binary product as a result,you may redistribute such product without providing attribution as wouldotherwise be required by Sections 4(a), 4(b) and 4(d) of the License.
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Copyrights

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/copyrights/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/copyrights/)

Page options # Copyrights

https://github.com/BurntSushi/toml ‚Üó

The MIT License (MIT)

Copyright (c) 2013 TOML authors

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

https://github.com/Sirupsen/logrus ‚Üó

The MIT License (MIT)

Copyright (c) 2014 Simon Eskildsen

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

https://github.com/beorn7/perks/ ‚Üó

Copyright (C) 2013 Blake Mizerany

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

https://github.com/certifi/gocertifi ‚Üó

This Source Code Form is subject to the terms of the Mozilla Public License,
v. 2.0. If a copy of the MPL was not distributed with this file, You can obtain
one at http://mozilla.org/MPL/2.0/ ‚Üó.

https://github.com/coreos/go-oidc/ ‚Üó
https://github.com/coreos/go-systemd/ ‚Üó

Apache License
Version 2.0, January 2004
http://www.apache.org/licenses/ ‚Üó

TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

1. Definitions.
"License" shall mean the terms and conditions for use, reproduction,
and distribution as defined by Sections 1 through 9 of this document.
"Licensor" shall mean the copyright owner or entity authorized by
the copyright owner that is granting the License.
"Legal Entity" shall mean the union of the acting entity and all
other entities that control, are controlled by, or are under common
control with that entity. For the purposes of this definition,
"control" means (i) the power, direct or indirect, to cause the
direction or management of such entity, whether by contract or
otherwise, or (ii) ownership of fifty percent (50%) or more of the
outstanding shares, or (iii) beneficial ownership of such entity.
"You" (or "Your") shall mean an individual or Legal Entity
exercising permissions granted by this License.
"Source" form shall mean the preferred form for making modifications,
including but not limited to software source code, documentation
source, and configuration files.
"Object" form shall mean any form resulting from mechanical
transformation or translation of a Source form, including but
not limited to compiled object code, generated documentation,
and conversions to other media types.
"Work" shall mean the work of authorship, whether in Source or
Object form, made available under the License, as indicated by a
copyright notice that is included in or attached to the work
(an example is provided in the Appendix below).
"Derivative Works" shall mean any work, whether in Source or Object
form, that is based on (or derived from) the Work and for which the
editorial revisions, annotations, elaborations, or other modifications
represent, as a whole, an original work of authorship. For the purposes
of this License, Derivative Works shall not include works that remain
separable from, or merely link (or bind by name) to the interfaces of,
the Work and Derivative Works thereof.
"Contribution" shall mean any work of authorship, including
the original version of the Work and any modifications or additions
to that Work or Derivative Works thereof, that is intentionally
submitted to Licensor for inclusion in the Work by the copyright owner
or by an individual or Legal Entity authorized to submit on behalf of
the copyright owner. For the purposes of this definition, "submitted"
means any form of electronic, verbal, or written communication sent
to the Licensor or its representatives, including but not limited to
communication on electronic mailing lists, source code control systems,
and issue tracking systems that are managed by, or on behalf of, the
Licensor for the purpose of discussing and improving the Work, but
excluding communication that is conspicuously marked or otherwise
designated in writing by the copyright owner as "Not a Contribution."
"Contributor" shall mean Licensor and any individual or Legal Entity
on behalf of whom a Contribution has been received by Licensor and
subsequently incorporated within the Work.
2. Grant of Copyright License. Subject to the terms and conditions of
this License, each Contributor hereby grants to You a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
copyright license to reproduce, prepare Derivative Works of,
publicly display, publicly perform, sublicense, and distribute the
Work and such Derivative Works in Source or Object form.
3. Grant of Patent License. Subject to the terms and conditions of
this License, each Contributor hereby grants to You a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
(except as stated in this section) patent license to make, have made,
use, offer to sell, sell, import, and otherwise transfer the Work,
where such license applies only to those patent claims licensable
by such Contributor that are necessarily infringed by their
Contribution(s) alone or by combination of their Contribution(s)
with the Work to which such Contribution(s) was submitted. If You
institute patent litigation against any entity (including a
cross-claim or counterclaim in a lawsuit) alleging that the Work
or a Contribution incorporated within the Work constitutes direct
or contributory patent infringement, then any patent licenses
granted to You under this License for that Work shall terminate
as of the date such litigation is filed.
4. Redistribution. You may reproduce and distribute copies of the
Work or Derivative Works thereof in any medium, with or without
modifications, and in Source or Object form, provided that You
meet the following conditions:
(a) You must give any other recipients of the Work or
Derivative Works a copy of this License; and
(b) You must cause any modified files to carry prominent notices
stating that You changed the files; and
(c) You must retain, in the Source form of any Derivative Works
that You distribute, all copyright, patent, trademark, and
attribution notices from the Source form of the Work,
excluding those notices that do not pertain to any part of
the Derivative Works; and
(d) If the Work includes a "NOTICE" text file as part of its
distribution, then any Derivative Works that You distribute must
include a readable copy of the attribution notices contained
within such NOTICE file, excluding those notices that do not
pertain to any part of the Derivative Works, in at least one
of the following places: within a NOTICE text file distributed
as part of the Derivative Works; within the Source form or
documentation, if provided along with the Derivative Works; or,
within a display generated by the Derivative Works, if and
wherever such third-party notices normally appear. The contents
of the NOTICE file are for informational purposes only and
do not modify the License. You may add Your own attribution
notices within Derivative Works that You distribute, alongside
or as an addendum to the NOTICE text from the Work, provided
that such additional attribution notices cannot be construed
as modifying the License.
You may add Your own copyright statement to Your modifications and
may provide additional or different license terms and conditions
for use, reproduction, or distribution of Your modifications, or
for any such Derivative Works as a whole, provided Your use,
reproduction, and distribution of the Work otherwise complies with
the conditions stated in this License.
5. Submission of Contributions. Unless You explicitly state otherwise,
any Contribution intentionally submitted for inclusion in the Work
by You to the Licensor shall be under the terms and conditions of
this License, without any additional terms or conditions.
Notwithstanding the above, nothing herein shall supersede or modify
the terms of any separate license agreement you may have executed
with Licensor regarding such Contributions.
6. Trademarks. This License does not grant permission to use the trade
names, trademarks, service marks, or product names of the Licensor,
except as required for reasonable and customary use in describing the
origin of the Work and reproducing the content of the NOTICE file.
7. Disclaimer of Warranty. Unless required by applicable law or
agreed to in writing, Licensor provides the Work (and each
Contributor provides its Contributions) on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied, including, without limitation, any warranties or conditions
of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
PARTICULAR PURPOSE. You are solely responsible for determining the
appropriateness of using or redistributing the Work and assume any
risks associated with Your exercise of permissions under this License.
8. Limitation of Liability. In no event and under no legal theory,
whether in tort (including negligence), contract, or otherwise,
unless required by applicable law (such as deliberate and grossly
negligent acts) or agreed to in writing, shall any Contributor be
liable to You for damages, including any direct, indirect, special,
incidental, or consequential damages of any character arising as a
result of this License or out of the use or inability to use the
Work (including but not limited to damages for loss of goodwill,
work stoppage, computer failure or malfunction, or any and all
other commercial damages or losses), even if such Contributor
has been advised of the possibility of such damages.
9. Accepting Warranty or Additional Liability. While redistributing
the Work or Derivative Works thereof, You may choose to offer,
and charge a fee for, acceptance of support, warranty, indemnity,
or other liability obligations and/or rights consistent with this
License. However, in accepting such obligations, You may act only
on Your own behalf and on Your sole responsibility, not on behalf
of any other Contributor, and only if You agree to indemnify,
defend, and hold each Contributor harmless for any liability
incurred by, or claims asserted against, such Contributor by reason
of your accepting any such warranty or additional liability.

END OF TERMS AND CONDITIONS

APPENDIX: How to apply the Apache License to your work.

```
To apply the Apache License to your work, attach the following  boilerplate notice, with the fields enclosed by brackets "{}"  replaced with your own identifying information. (Don't include  the brackets!)  The text should be enclosed in the appropriate  comment syntax for the file format. We also recommend that a  file or class name and description of purpose be included on the  same "printed page" as the copyright notice for easier  identification within third-party archives.
```

Copyright [yyyy] [name of copyright owner]

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

```
http://www.apache.org/licenses/LICENSE-2.0
```

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

https://github.com/facebookgo/grace ‚Üó

BSD License

For grace software

Copyright (c) 2015, Facebook, Inc. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

- Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.
- Redistributions in binary form must reproduce the above copyright notice,
this list of conditions and the following disclaimer in the documentation
and/or other materials provided with the distribution.
- Neither the name Facebook nor the names of its contributors may be used to
endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

https://github.com/getsentry/raven-go ‚Üó

Copyright (c) 2013 Apollic Software, LLC. All rights reserved.
Copyright (c) 2015 Functional Software, Inc. All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

- Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.
- Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following disclaimer
in the documentation and/or other materials provided with the
distribution.
- Neither the name of Apollic Software, LLC nor the names of its
contributors may be used to endorse or promote products derived from
this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

https://github.com/glycerine/rbtree ‚Üó

Copyright (C) 2012 Yasushi Saito

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

https://github.com/golang/protobuf ‚Üó

Go support for Protocol Buffers - Google's data interchange format

Copyright 2010 The Go Authors. All rights reserved.
https://github.com/golang/protobuf ‚Üó

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

```
* Redistributions of source code must retain the above copyright
```

notice, this list of conditions and the following disclaimer. * Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following disclaimer
in the documentation and/or other materials provided with the
distribution. * Neither the name of Google Inc. nor the names of its
contributors may be used to endorse or promote products derived from
this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

https://github.com/lib/pq ‚Üó

Copyright (c) 2011-2013, 'pq' Contributors
Portions Copyright (C) 2011 Blake Mizerany

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

https://godoc.org/github.com/matttproud/golang\_protobuf\_extensions/pbutil ‚Üó

```
Apache License                       Version 2.0, January 2004                    http://www.apache.org/licenses/
```

TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

1. Definitions.
"License" shall mean the terms and conditions for use, reproduction,
and distribution as defined by Sections 1 through 9 of this document.
"Licensor" shall mean the copyright owner or entity authorized by
the copyright owner that is granting the License.
"Legal Entity" shall mean the union of the acting entity and all
other entities that control, are controlled by, or are under common
control with that entity. For the purposes of this definition,
"control" means (i) the power, direct or indirect, to cause the
direction or management of such entity, whether by contract or
otherwise, or (ii) ownership of fifty percent (50%) or more of the
outstanding shares, or (iii) beneficial ownership of such entity.
"You" (or "Your") shall mean an individual or Legal Entity
exercising permissions granted by this License.
"Source" form shall mean the preferred form for making modifications,
including but not limited to software source code, documentation
source, and configuration files.
"Object" form shall mean any form resulting from mechanical
transformation or translation of a Source form, including but
not limited to compiled object code, generated documentation,
and conversions to other media types.
"Work" shall mean the work of authorship, whether in Source or
Object form, made available under the License, as indicated by a
copyright notice that is included in or attached to the work
(an example is provided in the Appendix below).
"Derivative Works" shall mean any work, whether in Source or Object
form, that is based on (or derived from) the Work and for which the
editorial revisions, annotations, elaborations, or other modifications
represent, as a whole, an original work of authorship. For the purposes
of this License, Derivative Works shall not include works that remain
separable from, or merely link (or bind by name) to the interfaces of,
the Work and Derivative Works thereof.
"Contribution" shall mean any work of authorship, including
the original version of the Work and any modifications or additions
to that Work or Derivative Works thereof, that is intentionally
submitted to Licensor for inclusion in the Work by the copyright owner
or by an individual or Legal Entity authorized to submit on behalf of
the copyright owner. For the purposes of this definition, "submitted"
means any form of electronic, verbal, or written communication sent
to the Licensor or its representatives, including but not limited to
communication on electronic mailing lists, source code control systems,
and issue tracking systems that are managed by, or on behalf of, the
Licensor for the purpose of discussing and improving the Work, but
excluding communication that is conspicuously marked or otherwise
designated in writing by the copyright owner as "Not a Contribution."
"Contributor" shall mean Licensor and any individual or Legal Entity
on behalf of whom a Contribution has been received by Licensor and
subsequently incorporated within the Work.
2. Grant of Copyright License. Subject to the terms and conditions of
this License, each Contributor hereby grants to You a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
copyright license to reproduce, prepare Derivative Works of,
publicly display, publicly perform, sublicense, and distribute the
Work and such Derivative Works in Source or Object form.
3. Grant of Patent License. Subject to the terms and conditions of
this License, each Contributor hereby grants to You a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
(except as stated in this section) patent license to make, have made,
use, offer to sell, sell, import, and otherwise transfer the Work,
where such license applies only to those patent claims licensable
by such Contributor that are necessarily infringed by their
Contribution(s) alone or by combination of their Contribution(s)
with the Work to which such Contribution(s) was submitted. If You
institute patent litigation against any entity (including a
cross-claim or counterclaim in a lawsuit) alleging that the Work
or a Contribution incorporated within the Work constitutes direct
or contributory patent infringement, then any patent licenses
granted to You under this License for that Work shall terminate
as of the date such litigation is filed.
4. Redistribution. You may reproduce and distribute copies of the
Work or Derivative Works thereof in any medium, with or without
modifications, and in Source or Object form, provided that You
meet the following conditions:
(a) You must give any other recipients of the Work or
Derivative Works a copy of this License; and
(b) You must cause any modified files to carry prominent notices
stating that You changed the files; and
(c) You must retain, in the Source form of any Derivative Works
that You distribute, all copyright, patent, trademark, and
attribution notices from the Source form of the Work,
excluding those notices that do not pertain to any part of
the Derivative Works; and
(d) If the Work includes a "NOTICE" text file as part of its
distribution, then any Derivative Works that You distribute must
include a readable copy of the attribution notices contained
within such NOTICE file, excluding those notices that do not
pertain to any part of the Derivative Works, in at least one
of the following places: within a NOTICE text file distributed
as part of the Derivative Works; within the Source form or
documentation, if provided along with the Derivative Works; or,
within a display generated by the Derivative Works, if and
wherever such third-party notices normally appear. The contents
of the NOTICE file are for informational purposes only and
do not modify the License. You may add Your own attribution
notices within Derivative Works that You distribute, alongside
or as an addendum to the NOTICE text from the Work, provided
that such additional attribution notices cannot be construed
as modifying the License.
You may add Your own copyright statement to Your modifications and
may provide additional or different license terms and conditions
for use, reproduction, or distribution of Your modifications, or
for any such Derivative Works as a whole, provided Your use,
reproduction, and distribution of the Work otherwise complies with
the conditions stated in this License.
5. Submission of Contributions. Unless You explicitly state otherwise,
any Contribution intentionally submitted for inclusion in the Work
by You to the Licensor shall be under the terms and conditions of
this License, without any additional terms or conditions.
Notwithstanding the above, nothing herein shall supersede or modify
the terms of any separate license agreement you may have executed
with Licensor regarding such Contributions.
6. Trademarks. This License does not grant permission to use the trade
names, trademarks, service marks, or product names of the Licensor,
except as required for reasonable and customary use in describing the
origin of the Work and reproducing the content of the NOTICE file.
7. Disclaimer of Warranty. Unless required by applicable law or
agreed to in writing, Licensor provides the Work (and each
Contributor provides its Contributions) on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied, including, without limitation, any warranties or conditions
of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
PARTICULAR PURPOSE. You are solely responsible for determining the
appropriateness of using or redistributing the Work and assume any
risks associated with Your exercise of permissions under this License.
8. Limitation of Liability. In no event and under no legal theory,
whether in tort (including negligence), contract, or otherwise,
unless required by applicable law (such as deliberate and grossly
negligent acts) or agreed to in writing, shall any Contributor be
liable to You for damages, including any direct, indirect, special,
incidental, or consequential damages of any character arising as a
result of this License or out of the use or inability to use the
Work (including but not limited to damages for loss of goodwill,
work stoppage, computer failure or malfunction, or any and all
other commercial damages or losses), even if such Contributor
has been advised of the possibility of such damages.
9. Accepting Warranty or Additional Liability. While redistributing
the Work or Derivative Works thereof, You may choose to offer,
and charge a fee for, acceptance of support, warranty, indemnity,
or other liability obligations and/or rights consistent with this
License. However, in accepting such obligations, You may act only
on Your own behalf and on Your sole responsibility, not on behalf
of any other Contributor, and only if You agree to indemnify,
defend, and hold each Contributor harmless for any liability
incurred by, or claims asserted against, such Contributor by reason
of your accepting any such warranty or additional liability.

END OF TERMS AND CONDITIONS

APPENDIX: How to apply the Apache License to your work.

```
To apply the Apache License to your work, attach the following  boilerplate notice, with the fields enclosed by brackets "{}"  replaced with your own identifying information. (Don't include  the brackets!)  The text should be enclosed in the appropriate  comment syntax for the file format. We also recommend that a  file or class name and description of purpose be included on the  same "printed page" as the copyright notice for easier  identification within third-party archives.
```

Copyright [yyyy] [name of copyright owner]

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

```
http://www.apache.org/licenses/LICENSE-2.0
```

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

https://github.com/mitchellh/go-homedir ‚Üó

The MIT License (MIT)

Copyright (c) 2013 Mitchell Hashimoto

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

https://github.com/pkg/errors ‚Üó

Copyright (c) 2015, Dave Cheney dave@cheney.net
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

- Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.
- Redistributions in binary form must reproduce the above copyright notice,
this list of conditions and the following disclaimer in the documentation
and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

https://github.com/prometheus/client_golang ‚Üó
https://github.com/prometheus/client_model ‚Üó
https://github.com/prometheus/common ‚Üó
https://github.com/prometheus/procfs ‚Üó

```
Apache License                       Version 2.0, January 2004                    http://www.apache.org/licenses/
```

TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

1. Definitions.
"License" shall mean the terms and conditions for use, reproduction,
and distribution as defined by Sections 1 through 9 of this document.
"Licensor" shall mean the copyright owner or entity authorized by
the copyright owner that is granting the License.
"Legal Entity" shall mean the union of the acting entity and all
other entities that control, are controlled by, or are under common
control with that entity. For the purposes of this definition,
"control" means (i) the power, direct or indirect, to cause the
direction or management of such entity, whether by contract or
otherwise, or (ii) ownership of fifty percent (50%) or more of the
outstanding shares, or (iii) beneficial ownership of such entity.
"You" (or "Your") shall mean an individual or Legal Entity
exercising permissions granted by this License.
"Source" form shall mean the preferred form for making modifications,
including but not limited to software source code, documentation
source, and configuration files.
"Object" form shall mean any form resulting from mechanical
transformation or translation of a Source form, including but
not limited to compiled object code, generated documentation,
and conversions to other media types.
"Work" shall mean the work of authorship, whether in Source or
Object form, made available under the License, as indicated by a
copyright notice that is included in or attached to the work
(an example is provided in the Appendix below).
"Derivative Works" shall mean any work, whether in Source or Object
form, that is based on (or derived from) the Work and for which the
editorial revisions, annotations, elaborations, or other modifications
represent, as a whole, an original work of authorship. For the purposes
of this License, Derivative Works shall not include works that remain
separable from, or merely link (or bind by name) to the interfaces of,
the Work and Derivative Works thereof.
"Contribution" shall mean any work of authorship, including
the original version of the Work and any modifications or additions
to that Work or Derivative Works thereof, that is intentionally
submitted to Licensor for inclusion in the Work by the copyright owner
or by an individual or Legal Entity authorized to submit on behalf of
the copyright owner. For the purposes of this definition, "submitted"
means any form of electronic, verbal, or written communication sent
to the Licensor or its representatives, including but not limited to
communication on electronic mailing lists, source code control systems,
and issue tracking systems that are managed by, or on behalf of, the
Licensor for the purpose of discussing and improving the Work, but
excluding communication that is conspicuously marked or otherwise
designated in writing by the copyright owner as "Not a Contribution."
"Contributor" shall mean Licensor and any individual or Legal Entity
on behalf of whom a Contribution has been received by Licensor and
subsequently incorporated within the Work.
2. Grant of Copyright License. Subject to the terms and conditions of
this License, each Contributor hereby grants to You a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
copyright license to reproduce, prepare Derivative Works of,
publicly display, publicly perform, sublicense, and distribute the
Work and such Derivative Works in Source or Object form.
3. Grant of Patent License. Subject to the terms and conditions of
this License, each Contributor hereby grants to You a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
(except as stated in this section) patent license to make, have made,
use, offer to sell, sell, import, and otherwise transfer the Work,
where such license applies only to those patent claims licensable
by such Contributor that are necessarily infringed by their
Contribution(s) alone or by combination of their Contribution(s)
with the Work to which such Contribution(s) was submitted. If You
institute patent litigation against any entity (including a
cross-claim or counterclaim in a lawsuit) alleging that the Work
or a Contribution incorporated within the Work constitutes direct
or contributory patent infringement, then any patent licenses
granted to You under this License for that Work shall terminate
as of the date such litigation is filed.
4. Redistribution. You may reproduce and distribute copies of the
Work or Derivative Works thereof in any medium, with or without
modifications, and in Source or Object form, provided that You
meet the following conditions:
(a) You must give any other recipients of the Work or
Derivative Works a copy of this License; and
(b) You must cause any modified files to carry prominent notices
stating that You changed the files; and
(c) You must retain, in the Source form of any Derivative Works
that You distribute, all copyright, patent, trademark, and
attribution notices from the Source form of the Work,
excluding those notices that do not pertain to any part of
the Derivative Works; and
(d) If the Work includes a "NOTICE" text file as part of its
distribution, then any Derivative Works that You distribute must
include a readable copy of the attribution notices contained
within such NOTICE file, excluding those notices that do not
pertain to any part of the Derivative Works, in at least one
of the following places: within a NOTICE text file distributed
as part of the Derivative Works; within the Source form or
documentation, if provided along with the Derivative Works; or,
within a display generated by the Derivative Works, if and
wherever such third-party notices normally appear. The contents
of the NOTICE file are for informational purposes only and
do not modify the License. You may add Your own attribution
notices within Derivative Works that You distribute, alongside
or as an addendum to the NOTICE text from the Work, provided
that such additional attribution notices cannot be construed
as modifying the License.
You may add Your own copyright statement to Your modifications and
may provide additional or different license terms and conditions
for use, reproduction, or distribution of Your modifications, or
for any such Derivative Works as a whole, provided Your use,
reproduction, and distribution of the Work otherwise complies with
the conditions stated in this License.
5. Submission of Contributions. Unless You explicitly state otherwise,
any Contribution intentionally submitted for inclusion in the Work
by You to the Licensor shall be under the terms and conditions of
this License, without any additional terms or conditions.
Notwithstanding the above, nothing herein shall supersede or modify
the terms of any separate license agreement you may have executed
with Licensor regarding such Contributions.
6. Trademarks. This License does not grant permission to use the trade
names, trademarks, service marks, or product names of the Licensor,
except as required for reasonable and customary use in describing the
origin of the Work and reproducing the content of the NOTICE file.
7. Disclaimer of Warranty. Unless required by applicable law or
agreed to in writing, Licensor provides the Work (and each
Contributor provides its Contributions) on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied, including, without limitation, any warranties or conditions
of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
PARTICULAR PURPOSE. You are solely responsible for determining the
appropriateness of using or redistributing the Work and assume any
risks associated with Your exercise of permissions under this License.
8. Limitation of Liability. In no event and under no legal theory,
whether in tort (including negligence), contract, or otherwise,
unless required by applicable law (such as deliberate and grossly
negligent acts) or agreed to in writing, shall any Contributor be
liable to You for damages, including any direct, indirect, special,
incidental, or consequential damages of any character arising as a
result of this License or out of the use or inability to use the
Work (including but not limited to damages for loss of goodwill,
work stoppage, computer failure or malfunction, or any and all
other commercial damages or losses), even if such Contributor
has been advised of the possibility of such damages.
9. Accepting Warranty or Additional Liability. While redistributing
the Work or Derivative Works thereof, You may choose to offer,
and charge a fee for, acceptance of support, warranty, indemnity,
or other liability obligations and/or rights consistent with this
License. However, in accepting such obligations, You may act only
on Your own behalf and on Your sole responsibility, not on behalf
of any other Contributor, and only if You agree to indemnify,
defend, and hold each Contributor harmless for any liability
incurred by, or claims asserted against, such Contributor by reason
of your accepting any such warranty or additional liability.

END OF TERMS AND CONDITIONS

APPENDIX: How to apply the Apache License to your work.

```
To apply the Apache License to your work, attach the following  boilerplate notice, with the fields enclosed by brackets "[]"  replaced with your own identifying information. (Don't include  the brackets!)  The text should be enclosed in the appropriate  comment syntax for the file format. We also recommend that a  file or class name and description of purpose be included on the  same "printed page" as the copyright notice for easier  identification within third-party archives.
```

Copyright [yyyy] [name of copyright owner]

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

```
http://www.apache.org/licenses/LICENSE-2.0
```

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

https://github.com/urfave/cli ‚Üó

MIT License

Copyright (c) 2016 Jeremy Saenz & Contributors

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

https://github.com/go-yaml/yaml ‚Üó

```
Apache License                       Version 2.0, January 2004                    http://www.apache.org/licenses/
```

TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

1. Definitions.
"License" shall mean the terms and conditions for use, reproduction,
and distribution as defined by Sections 1 through 9 of this document.
"Licensor" shall mean the copyright owner or entity authorized by
the copyright owner that is granting the License.
"Legal Entity" shall mean the union of the acting entity and all
other entities that control, are controlled by, or are under common
control with that entity. For the purposes of this definition,
"control" means (i) the power, direct or indirect, to cause the
direction or management of such entity, whether by contract or
otherwise, or (ii) ownership of fifty percent (50%) or more of the
outstanding shares, or (iii) beneficial ownership of such entity.
"You" (or "Your") shall mean an individual or Legal Entity
exercising permissions granted by this License.
"Source" form shall mean the preferred form for making modifications,
including but not limited to software source code, documentation
source, and configuration files.
"Object" form shall mean any form resulting from mechanical
transformation or translation of a Source form, including but
not limited to compiled object code, generated documentation,
and conversions to other media types.
"Work" shall mean the work of authorship, whether in Source or
Object form, made available under the License, as indicated by a
copyright notice that is included in or attached to the work
(an example is provided in the Appendix below).
"Derivative Works" shall mean any work, whether in Source or Object
form, that is based on (or derived from) the Work and for which the
editorial revisions, annotations, elaborations, or other modifications
represent, as a whole, an original work of authorship. For the purposes
of this License, Derivative Works shall not include works that remain
separable from, or merely link (or bind by name) to the interfaces of,
the Work and Derivative Works thereof.
"Contribution" shall mean any work of authorship, including
the original version of the Work and any modifications or additions
to that Work or Derivative Works thereof, that is intentionally
submitted to Licensor for inclusion in the Work by the copyright owner
or by an individual or Legal Entity authorized to submit on behalf of
the copyright owner. For the purposes of this definition, "submitted"
means any form of electronic, verbal, or written communication sent
to the Licensor or its representatives, including but not limited to
communication on electronic mailing lists, source code control systems,
and issue tracking systems that are managed by, or on behalf of, the
Licensor for the purpose of discussing and improving the Work, but
excluding communication that is conspicuously marked or otherwise
designated in writing by the copyright owner as "Not a Contribution."
"Contributor" shall mean Licensor and any individual or Legal Entity
on behalf of whom a Contribution has been received by Licensor and
subsequently incorporated within the Work.
2. Grant of Copyright License. Subject to the terms and conditions of
this License, each Contributor hereby grants to You a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
copyright license to reproduce, prepare Derivative Works of,
publicly display, publicly perform, sublicense, and distribute the
Work and such Derivative Works in Source or Object form.
3. Grant of Patent License. Subject to the terms and conditions of
this License, each Contributor hereby grants to You a perpetual,
worldwide, non-exclusive, no-charge, royalty-free, irrevocable
(except as stated in this section) patent license to make, have made,
use, offer to sell, sell, import, and otherwise transfer the Work,
where such license applies only to those patent claims licensable
by such Contributor that are necessarily infringed by their
Contribution(s) alone or by combination of their Contribution(s)
with the Work to which such Contribution(s) was submitted. If You
institute patent litigation against any entity (including a
cross-claim or counterclaim in a lawsuit) alleging that the Work
or a Contribution incorporated within the Work constitutes direct
or contributory patent infringement, then any patent licenses
granted to You under this License for that Work shall terminate
as of the date such litigation is filed.
4. Redistribution. You may reproduce and distribute copies of the
Work or Derivative Works thereof in any medium, with or without
modifications, and in Source or Object form, provided that You
meet the following conditions:
(a) You must give any other recipients of the Work or
Derivative Works a copy of this License; and
(b) You must cause any modified files to carry prominent notices
stating that You changed the files; and
(c) You must retain, in the Source form of any Derivative Works
that You distribute, all copyright, patent, trademark, and
attribution notices from the Source form of the Work,
excluding those notices that do not pertain to any part of
the Derivative Works; and
(d) If the Work includes a "NOTICE" text file as part of its
distribution, then any Derivative Works that You distribute must
include a readable copy of the attribution notices contained
within such NOTICE file, excluding those notices that do not
pertain to any part of the Derivative Works, in at least one
of the following places: within a NOTICE text file distributed
as part of the Derivative Works; within the Source form or
documentation, if provided along with the Derivative Works; or,
within a display generated by the Derivative Works, if and
wherever such third-party notices normally appear. The contents
of the NOTICE file are for informational purposes only and
do not modify the License. You may add Your own attribution
notices within Derivative Works that You distribute, alongside
or as an addendum to the NOTICE text from the Work, provided
that such additional attribution notices cannot be construed
as modifying the License.
You may add Your own copyright statement to Your modifications and
may provide additional or different license terms and conditions
for use, reproduction, or distribution of Your modifications, or
for any such Derivative Works as a whole, provided Your use,
reproduction, and distribution of the Work otherwise complies with
the conditions stated in this License.
5. Submission of Contributions. Unless You explicitly state otherwise,
any Contribution intentionally submitted for inclusion in the Work
by You to the Licensor shall be under the terms and conditions of
this License, without any additional terms or conditions.
Notwithstanding the above, nothing herein shall supersede or modify
the terms of any separate license agreement you may have executed
with Licensor regarding such Contributions.
6. Trademarks. This License does not grant permission to use the trade
names, trademarks, service marks, or product names of the Licensor,
except as required for reasonable and customary use in describing the
origin of the Work and reproducing the content of the NOTICE file.
7. Disclaimer of Warranty. Unless required by applicable law or
agreed to in writing, Licensor provides the Work (and each
Contributor provides its Contributions) on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied, including, without limitation, any warranties or conditions
of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
PARTICULAR PURPOSE. You are solely responsible for determining the
appropriateness of using or redistributing the Work and assume any
risks associated with Your exercise of permissions under this License.
8. Limitation of Liability. In no event and under no legal theory,
whether in tort (including negligence), contract, or otherwise,
unless required by applicable law (such as deliberate and grossly
negligent acts) or agreed to in writing, shall any Contributor be
liable to You for damages, including any direct, indirect, special,
incidental, or consequential damages of any character arising as a
result of this License or out of the use or inability to use the
Work (including but not limited to damages for loss of goodwill,
work stoppage, computer failure or malfunction, or any and all
other commercial damages or losses), even if such Contributor
has been advised of the possibility of such damages.
9. Accepting Warranty or Additional Liability. While redistributing
the Work or Derivative Works thereof, You may choose to offer,
and charge a fee for, acceptance of support, warranty, indemnity,
or other liability obligations and/or rights consistent with this
License. However, in accepting such obligations, You may act only
on Your own behalf and on Your sole responsibility, not on behalf
of any other Contributor, and only if You agree to indemnify,
defend, and hold each Contributor harmless for any liability
incurred by, or claims asserted against, such Contributor by reason
of your accepting any such warranty or additional liability.

END OF TERMS AND CONDITIONS

APPENDIX: How to apply the Apache License to your work.

```
To apply the Apache License to your work, attach the following  boilerplate notice, with the fields enclosed by brackets "{}"  replaced with your own identifying information. (Don't include  the brackets!)  The text should be enclosed in the appropriate  comment syntax for the file format. We also recommend that a  file or class name and description of purpose be included on the  same "printed page" as the copyright notice for easier  identification within third-party archives.
```

Copyright [yyyy] [name of copyright owner]

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

```
http://www.apache.org/licenses/LICENSE-2.0
```

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

https://zombiezen.com/go/capnproto2 ‚Üó

go-capnproto is licensed under the terms of the MIT license reproduced below.

===============================================================================

Copyright (C) 2014 the go-capnproto authors and contributors.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

===============================================================================

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Configure cloudflared parameters

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/cloudflared-parameters/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/cloudflared-parameters/)

Page options # Configure cloudflared parameters

Remotely-managed tunnels run as a service on your OS. You can modify the Cloudflare Tunnel service with one or more general-purpose tunnel parameters.

Note

For instructions on configuring a locally-managed tunnel, refer to the configuration file documentation.

## Update tunnel run parameters

- Linux
- macOS
- Windows

On Linux, Cloudflare Tunnel installs itself as a system service using systemctl. By default, the service will be named cloudflared.service. To configure your tunnel on Linux:

1. Open cloudflared.service.
Terminal windowsudo systemctl edit --full cloudflared.service
2. Modify the cloudflared tunnel run command with the desired configuration flag. For example,
[Unit]Description=Cloudflare TunnelAfter=network.target
[Service]TimeoutStartSec=0Type=notifyExecStart=/usr/local/bin/cloudflared tunnel --loglevel debug --logfile /var/log/cloudflared/cloudflared.log run --token <TOKEN VALUE>Restart=on-failureRestartSec=5s
[Install]WantedBy=multi-user.target
3. Restart cloudflared.service:
Terminal windowsudo systemctl restart cloudflared
4. To verify the new configuration, check the service status:
Terminal windowsudo systemctl status cloudflared
‚óè cloudflared.service - cloudflared Loaded: loaded (/etc/systemd/system/cloudflared.service; enabled; preset: enabled) Active: active (running) since Wed 2024-10-09 20:02:59 UTC; 2s agoMain PID: 2157 (cloudflared)  Tasks: 8 (limit: 1136) Memory: 16.3M    CPU: 136ms CGroup: /system.slice/cloudflared.service         ‚îî‚îÄ2157 /usr/bin/cloudflared tunnel --loglevel debug --logfile /var/log/cloudflared/cloudflared.log run --token eyJhIjoi...

On macOS, Cloudflare Tunnel installs itself as a launch agent using launchctl. By default, the agent will be called com.cloudflare.cloudflared. To configure your tunnel on macOS:

1. Stop the cloudflared service.
Terminal windowsudo launchctl stop com.cloudflare.cloudflared
2. Unload the configuration file.
Terminal windowsudo launchctl unload /Library/LaunchDaemons/com.cloudflare.cloudflared.plist
3. Open /Library/LaunchDaemons/com.cloudflare.cloudflared.plist in a text editor.
4. Modify the ProgramArguments key with the desired configuration flag. For example,
<plist version="1.0">    <dict>        <key>Label</key>        <string>com.cloudflare.cloudflared</string>        <key>ProgramArguments</key>        <array>            <string>/opt/homebrew/bin/cloudflared</string>            <string>tunnel</string>            <string>--logfile</string>            <string><PATH></string>            <string>--loglevel</string>            <string>debug</string>            <string>run</string>            <string>--token</string>            <string><TOKEN VALUE> </string>        </array>
5. Load the updated configuration file.
Terminal windowsudo launchctl load /Library/LaunchDaemons/com.cloudflare.cloudflared.plist
6. Start the cloudflared service.
Terminal windowsudo launchctl start com.cloudflare.cloudflared

On Windows, Cloudflare Tunnel installs itself as a system service using the Registry Editor. By default, the service will be named cloudflared. To configure your tunnel on Windows:

1. Open the Registry Editor.
2. Go to HKEY_LOCAL_MACHINE > SYSTEM > CurrentControlSet > Services > cloudflared.
3. Double-click ImagePath.
4. Modify Value data with the desired configuration flag. For example,
C:\Program Files (x86)\cloudflared\.\cloudflared.exe tunnel --loglevel debug --logfile <PATH> run --token <TOKEN VALUE>

## Update origin configuration

To configure how cloudflared sends requests to your public hostname services:

1. In Zero Trust ‚Üó, go to Networks > Tunnels.
2. Choose a tunnel and select Configure.
3. Select the Public Hostname tab.
4. Choose a route and select Edit.
5. Under Additional application settings, modify one or more origin configuration parameters.
6. Select Save hostname.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tunnel run parameters

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/cloudflared-parameters/run-parameters/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/cloudflared-parameters/run-parameters/)

Page options # Tunnel run parameters

This page lists general-purpose configuration options that you can add to the cloudflared tunnel run command.

Alternatively, if you are running a locally-managed tunnel you can add these flags to your configuration file as key/value pairs.

## autoupdate-freq

| Syntax | Default |
| --- | --- |
| cloudflared tunnel --autoupdate-freq <FREQ> run <UUID or NAME> | 24h |

Configures the frequency of cloudflared updates.

By default, cloudflared will periodically check for updates and restart with the new version. Restarts are performed by spawning a new process that connects to the Cloudflare global network. On successful connection, the old process will gracefully shut down after handling all outstanding requests. See also: no-autoupdate.

## config

Note

For locally-managed tunnels only.

| Syntax | Default |
| --- | --- |
| cloudflared tunnel --config <PATH> run <UUID or NAME> | ~/.cloudflared/config.yml |

Specifies the path to a configuration file in YAML format.

## edge-bind-address

| Syntax | Environment Variable |
| --- | --- |
| cloudflared tunnel --edge-bind-address <IP> run <UUID or NAME> | TUNNEL_EDGE_BIND_ADDRESS |

Specifies the outgoing IP address used to establish a connection between cloudflared and the Cloudflare global network.

By default, cloudflared lets the operating system decide which IP address to use. This option is useful if you have multiple network interfaces available and want to prefer a specific interface.

The IP version of edge-bind-address will override edge-ip-version (if provided). For example, if you enter an IPv6 source address, cloudflared will always connect to an IPv6 destination.

## edge-ip-version

| Syntax | Default | Environment Variable |
| --- | --- | --- |
| cloudflared tunnel --edge-ip-version <VERSION> run <UUID or NAME> | 4 | TUNNEL_EDGE_IP_VERSION |

Specifies the IP address version (IPv4 or IPv6) used to establish a connection between cloudflared and the Cloudflare global network. Available values are auto, 4, and 6.

The value auto relies on the host operating system to determine which IP version to select. The first IP version returned from the DNS resolution of the region lookup will be used as the primary set. In dual IPv6 and IPv4 network setups, cloudflared will separate the IP versions into two address sets that will be used to fallback in connectivity failure scenarios.

## grace-period

| Syntax | Default | Environment Variable |
| --- | --- | --- |
| cloudflared tunnel --grace-period <PERIOD> run <UUID or NAME> | 30s | TUNNEL_GRACE_PERIOD |

When cloudflared receives SIGINT/SIGTERM it will stop accepting new requests, wait for in-progress requests to terminate, then shut down. Waiting for in-progress requests will timeout after this grace period, or when a second SIGTERM/SIGINT is received.

## logfile

| Syntax | Environment Variable |
| --- | --- |
| cloudflared tunnel --logfile <PATH> run <UUID or NAME> | TUNNEL_LOGFILE |

Saves application log to this file. Mainly useful for reporting issues. For more details on what information you need when contacting Cloudflare support, refer to this guide.

## loglevel

| Syntax | Default | Environment Variable |
| --- | --- | --- |
| cloudflared tunnel --loglevel <VALUE> run <UUID or NAME> | info | TUNNEL_LOGLEVEL |

Specifies the verbosity of logging for the local cloudflared instance. Available values are debug, info (default), warn, error, and fatal. At the debug level, cloudflared will log and display the request URL, method, protocol, content length, as well as all request and response headers. However, note that this can expose sensitive information in your logs.

## metrics

| Syntax | Default | Environment Variable |
| --- | --- | --- |
| cloudflared tunnel --metrics <IP:PORT> run <UUID or NAME> | Refer to Tunnel metrics | TUNNEL_METRICS |

Exposes a Prometheus endpoint on the specified IP address and port, which you can then query for usage metrics.

## no-autoupdate

Note

Does not apply if you installed cloudflared using a package manager.

You can check if cloudflared was installed by a package manager by running ls -la /usr/local/etc/cloudflared/ and looking for .installedFromPackageManager in the output.

| Syntax | Environment Variable |
| --- | --- |
| cloudflared tunnel --no-autoupdate run <UUID or NAME> | NO_AUTOUPDATE |

Disables automatic cloudflared updates. See also: autoupdate-freq.

## origincert

Note

For locally-managed tunnels only.

| Syntax | Default | Environment Variable |
| --- | --- | --- |
| cloudflared tunnel --origincert <PATH> run <UUID or NAME> | ~/.cloudflared/cert.pem | TUNNEL_ORIGIN_CERT |

Specifies the account certificate for one of your zones, authorizing the client to serve as an origin for that zone. You can obtain a certificate by using the cloudflared tunnel login command or by visiting https://dash.cloudflare.com/argotunnel.

## pidfile

| Syntax | Environment Variable |
| --- | --- |
| cloudflared tunnel --pidfile <PATH> run <UUID or NAME> | TUNNEL_PIDFILE |

Writes the application's process identifier (PID) to this file after the first successful connection. Mainly useful for scripting and service integration.

## post-quantum

| Syntax | Environment Variable |
| --- | --- |
| cloudflared tunnel run --post-quantum <UUID or NAME> | TUNNEL_POST_QUANTUM |

By default, Cloudflare Tunnel connections over quic are encrypted using post-quantum cryptography (PQC) but will fall back to non-PQ if there are issues connecting. If the --post-quantum flag is provided, quic connections are only allowed to use PQ key agreements, with no fallback to non-PQ.

Post-quantum key agreements are not supported when using http2 protocol.

## protocol

| Syntax | Default | Environment Variable |
| --- | --- | --- |
| cloudflared tunnel --protocol <VALUE> run <UUID or NAME> | auto | TUNNEL_TRANSPORT_PROTOCOL |

Specifies the protocol used to establish a connection between cloudflared and the Cloudflare global network. Available values are auto, http2, and quic.

The auto value will automatically configure the quic protocol. If cloudflared is unable to establish UDP connections, it will fallback to using the http2 protocol.

## region

| Syntax | Environment Variable |
| --- | --- |
| cloudflared tunnel --region <VALUE> run <UUID or NAME> | TUNNEL_REGION |

Allows you to choose the regions to which connections are established. Currently the only available value is us, which routes all connections through data centers in the United States. Omit or leave empty to connect to the global region.

When the region is set to us, cloudflared uses different US-specific hostnames and IPs. Refer to Tunnel with firewall for details.

## retries

| Syntax | Default | Environment Variable |
| --- | --- | --- |
| cloudflared tunnel --retries <VALUE> run <UUID or NAME> | 5 | TUNNEL_RETRIES |

Specifies the maximum number of retries for connection/protocol errors. Retries use exponential backoff (retrying at 1, 2, 4, 8, 16 seconds by default), so it is not recommended that you increase this value significantly.

## tag

| Syntax | Environment Variable |
| --- | --- |
| cloudflared tunnel --tag <KEY=VAL> run <UUID or NAME> | TUNNEL_TAG |

Specifies custom tags used to identify this tunnel. Multiple tags may be specified by adding additional --tag <KEY=VAL> flags to the command. If entering multiple tags into a configuration file, delimit with commas: tag: {KEY1=VALUE1, KEY2=VALUE2}.

## token

Note

For remotely-managed tunnels only.

| Syntax | Environment Variable |
| --- | --- |
| cloudflared tunnel run --token <TUNNEL_TOKEN> | TUNNEL_TOKEN |

Associates the cloudflared instance with a specific tunnel. The tunnel's token is shown in the dashboard when you first create the tunnel. You can also retrieve the token using the API.

## token-file

Note

For remotely-managed tunnels only. Requires 2025.4.0 or later.

| Syntax | Environment Variable |
| --- | --- |
| cloudflared tunnel run --token-file <PATH> | TUNNEL_TOKEN_FILE |

Associates the cloudflared instance with a specific tunnel using a file which contains the token.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Origin configuration parameters

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/cloudflared-parameters/origin-parameters/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/cloudflared-parameters/origin-parameters/)

Page options # Origin configuration parameters

Origin configuration parameters determine how cloudflared proxies traffic to your origin server. If you are using remotely-managed tunnels (default), configure these settings using the dashboard or API. If you are using locally-managed tunnels, add these parameters to your configuration file.

## TLS settings

### originServerName

| Default | UI name |
| --- | --- |
| "" | Origin Server Name |

Hostname that cloudflared should expect from your origin server certificate. If null, the expected hostname is the service URL, for example localhost if the service is https://localhost:443.

### caPool

| Default | UI name |
| --- | --- |
| "" | Certificate Authority Pool |

Local file path to the certificate authority (CA) for your origin server certificate (for example, /root/certs/ca.pem). The path should point to a certificate store file or a bundle file in .pem or .crt format that contains one or more trusted root CA certificates. You should only configure this setting if your certificate is not signed by Cloudflare.

### noTLSVerify

| Default | UI name |
| --- | --- |
| false | No TLS Verify |

When false, TLS verification is performed on the certificate presented by your origin.

When true, TLS verification is disabled. This will allow any certificate from the origin to be accepted.

### tlsTimeout

| Default | UI name |
| --- | --- |
| 10s | TLS Timeout |

Timeout for completing a TLS handshake to your origin server, if you have chosen to connect Tunnel to an HTTPS server.

### http2Origin

| Default | UI name |
| --- | --- |
| false | HTTP2 connection |

When false, cloudflared will connect to your origin with HTTP/1.1.

When true, cloudflared will attempt to connect to your origin server using HTTP/2.0 instead of HTTP/1.1. HTTP/2.0 is a faster protocol for high traffic origins but requires you to deploy an SSL certificate on the origin. We recommend using this setting in conjunction with noTLSVerify so that you can use a self-signed certificate.

## HTTP settings

### httpHostHeader

| Default | UI name |
| --- | --- |
| "" | HTTP Host Header |

Sets the HTTP Host header on requests sent to the local service.

### disableChunkedEncoding

| Default | UI name |
| --- | --- |
| false | Disable Chunked Encoding |

When false, cloudflared performs chunked transfer encoding when transferring data over HTTP/1.1.

When true, chunked transfer encoding is disabled. This is useful if you are running a Web Server Gateway Interface (WSGI) server.

## Connection settings

### connectTimeout

| Default | UI name |
| --- | --- |
| 30s | Connect Timeout |

Timeout for establishing a new TCP connection to your origin server. This excludes the time taken to
establish TLS, which is controlled by tlsTimeout.

### noHappyEyeballs

| Default | UI name |
| --- | --- |
| false | No Happy Eyeballs |

When false, cloudflared uses the Happy Eyeballs algorithm for IPv4/IPv6 fallback if your local network has misconfigured one of the protocols.

When true, Happy Eyeballs is disabled.

### proxyType

| Default | UI name |
| --- | --- |
| "" | Proxy Type |

cloudflared starts a proxy server to translate HTTP traffic into TCP when proxying, for example, SSH or RDP.
This configures what type of proxy will be started. Valid options are:

- "" for the regular proxy
- "socks" for a SOCKS5 proxy. Refer to the tutorial on connecting through Cloudflare Access using kubectl for more information.

### proxyAddress

Note

For locally-managed tunnels only.

| Default | UI name |
| --- | --- |
| 127.0.0.1 | -- |

cloudflared starts a proxy server to translate HTTP traffic into TCP when proxying, for example, SSH or RDP.
This configures the listen address for that proxy.

### proxyPort

Note

For locally-managed tunnels only.

| Default | UI name |
| --- | --- |
| 0 | -- |

cloudflared starts a proxy server to translate HTTP traffic into TCP when proxying, for example, SSH or RDP.
This configures the listen port for that proxy. If set to zero, an unused port will randomly be chosen.

### keepAliveTimeout

| Default | UI name |
| --- | --- |
| 1m30s | Idle Connection Expiration Time |

Timeout after which an idle keepalive connection can be discarded.

### keepAliveConnections

| Default | UI name |
| --- | --- |
| 100 | Keep Alive Connections |

Default: 100

Maximum number of idle keepalive connections between Cloudflare and your origin. This does not restrict the total number of concurrent connections.

### tcpKeepAlive

| Default | UI name |
| --- | --- |
| 30s | TCP Keep Alive Interval |

Default: 30s

The timeout after which a TCP keepalive packet is sent on a connection between Cloudflare and the origin server.

## Access settings

### access

| Default | UI name |
| --- | --- |
| "" | Protect with Access |

Requires cloudflared to validate the Cloudflare Access JWT prior to proxying traffic to your origin. You can enforce this check on public hostname routes that are protected by an Access application. For all L7 requests to these hostnames, Access will send the JWT to cloudflared as a Cf-Access-Jwt-Assertion request header.

To enable this security control in a configuration file, get the AUD tag for your Access application and add the following rule to originRequest:

```
access:  required: true  teamName: <your-team-name>  audTag:    - <Access-application-audience-tag>    - <Optional-additional-tags>
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tunnel with firewall

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/tunnel-with-firewall/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/tunnel-with-firewall/)

Page options # Tunnel with firewall

You can implement a positive security model with Cloudflare Tunnel by blocking all ingress traffic and allowing only egress traffic from cloudflared. Only the services specified in your tunnel configuration will be exposed to the outside world.

## Ports

The parameters below can be configured for egress traffic inside of a firewall.

How you configure your firewall depends on the firewall type:

- If your firewall supports domain-based rules (FQDN allowlists), you can allow outbound connections to the hostnames listed below.
- If your firewall requires IP-based rules, allow outbound connections to all listed IP addresses for each domain.

Ensure port 7844 is allowed for both TCP and UDP protocols (for http2 and quic).

### Required for tunnel operation

cloudflared connects to Cloudflare's global network on port 7844. To use Cloudflare Tunnel, your firewall must allow outbound connections to the following destinations on port 7844 (via UDP if using the quic protocol or TCP if using the http2 protocol).

#### region1.v2.argotunnel.com

| IPv4 | IPv6 | Port | Protocols |
| --- | --- | --- | --- |
| 198.41.192.167 198.41.192.67 198.41.192.57 198.41.192.107 198.41.192.27 198.41.192.7 198.41.192.227 198.41.192.47 198.41.192.37 198.41.192.77 | 2606:4700:a0::1 2606:4700:a0::2 2606:4700:a0::3 2606:4700:a0::4 2606:4700:a0::5 2606:4700:a0::6 2606:4700:a0::7 2606:4700:a0::8 2606:4700:a0::9 2606:4700:a0::10 | 7844 | TCP/UDP (http2/quic) |

#### region2.v2.argotunnel.com

| IPv4 | IPv6 | Port | Protocols |
| --- | --- | --- | --- |
| 198.41.200.13 198.41.200.193 198.41.200.33 198.41.200.233 198.41.200.53 198.41.200.63 198.41.200.113 198.41.200.73 198.41.200.43 198.41.200.23 | 2606:4700:a8::1 2606:4700:a8::2 2606:4700:a8::3 2606:4700:a8::4 2606:4700:a8::5 2606:4700:a8::6 2606:4700:a8::7 2606:4700:a8::8 2606:4700:a8::9 2606:4700:a8::10 | 7844 | TCP/UDP (http2/quic) |

#### _v2-origintunneld._tcp.argotunnel.com

| IPv4 | IPv6 | Port | Protocols |
| --- | --- | --- | --- |
| Not applicable | Not applicable | 7844 | TCP (http2) |

This rule is only required for firewalls that enforce SNI.

#### cftunnel.com

| IPv4 | IPv6 | Port | Protocols |
| --- | --- | --- | --- |
| Not applicable | Not applicable | 7844 | TCP/UDP (http2/quic) |

This rule is only required for firewalls that enforce SNI.

#### h2.cftunnel.com

| IPv4 | IPv6 | Port | Protocols |
| --- | --- | --- | --- |
| Not applicable | Not applicable | 7844 | TCP (http2) |

This rule is only required for firewalls that enforce SNI.

#### quic.cftunnel.com

| IPv4 | IPv6 | Port | Protocols |
| --- | --- | --- | --- |
| Not applicable | Not applicable | 7844 | UDP (quic) |

This rule is only required for firewalls that enforce SNI.

### Region US

When using the US region, ensure your firewall allows outbound connections to these US-region destinations on port 7844 (TCP/UDP) for tunnel operation.

#### us-region1.v2.argotunnel.com

| IPv4 | IPv6 | Port | Protocol |
| --- | --- | --- | --- |
| 198.41.218.1 198.41.218.2 198.41.218.3 198.41.218.4 198.41.218.5 198.41.218.6 198.41.218.7 198.41.218.8 198.41.218.9 198.41.218.10 | 2606:4700:a1::1 2606:4700:a1::2 2606:4700:a1::3 2606:4700:a1::4 2606:4700:a1::5 2606:4700:a1::6 2606:4700:a1::7 2606:4700:a1::8 2606:4700:a1::9 2606:4700:a1::10 | 7844 | TCP/UDP (http2/quic) |

#### us-region2.v2.argotunnel.com

| IPv4 | IPv6 | Port | Protocol |
| --- | --- | --- | --- |
| 198.41.219.1 198.41.219.2 198.41.219.3 198.41.219.4 198.41.219.5 198.41.219.6 198.41.219.7 198.41.219.8 198.41.219.9 198.41.219.10 | 2606:4700:a9::1 2606:4700:a9::2 2606:4700:a9::3 2606:4700:a9::4 2606:4700:a9::5 2606:4700:a9::6 2606:4700:a9::7 2606:4700:a9::8 2606:4700:a9::9 2606:4700:a9::10 | 7844 | TCP/UDP (http2/quic) |

### Optional

Opening port 443 enables some optional features. Failure to allow these connections may prompt a log error, but cloudflared will still run correctly.

#### api.cloudflare.com

Allows cloudflared to query if software updates are available.

| IPv4 | IPv6 | Port | Protocols |
| --- | --- | --- | --- |
| 104.19.192.29 104.19.192.177 104.19.192.175 104.19.193.29 104.19.192.174 104.19.192.176 | 2606:4700:300a::6813:c0af 2606:4700:300a::6813:c01d 2606:4700:300a::6813:c0ae 2606:4700:300a::6813:c11d 2606:4700:300a::6813:c0b0 2606:4700:300a::6813:c0b1 | 443 | TCP (HTTPS) |

#### update.argotunnel.com

Allows cloudflared to query if software updates are available.

| IPv4 | IPv6 | Port | Protocols |
| --- | --- | --- | --- |
| 104.18.25.129 104.18.24.129 | 2606:4700::6812:1881 2606:4700::6812:1981 | 443 | TCP (HTTPS) |

#### github.com

Allows cloudflared to download the latest release and perform a software update.

| IPv4 | IPv6 | Port | Protocols |
| --- | --- | --- | --- |
| GitHub's IPs ‚Üó | GitHub's IPs ‚Üó | 443 | TCP (HTTPS) |

#### <your-team-name>.cloudflareaccess.com

Allows cloudflared to validate the Access JWT. Only required if the access ‚Üó setting is enabled.

| IPv4 | IPv6 | Port | Protocols |
| --- | --- | --- | --- |
| 104.19.194.29 104.19.195.29 | 2606:4700:300a::6813:c31d 2606:4700:300a::6813:c21d | 443 | TCP (HTTPS) |

#### pqtunnels.cloudflareresearch.com

Allows cloudflared to report post-quantum key exchange ‚Üó errors to Cloudflare.

| IPv4 | IPv6 | Port | Protocols |
| --- | --- | --- | --- |
| 104.18.4.64 104.18.5.64 | 2606:4700::6812:540 2606:4700::6812:440 | 443 | TCP (HTTPS) |

## Firewall configuration

### Cloud VM firewall

If you host your services on a virtual machine (VM) instance in a cloud provider, you may set up instance-level firewall rules to block all ingress traffic and allow only egress traffic. For example, on Google Cloud Platform (GCP), you may delete all ingress rules, leaving only the relevant egress rules. This is because GCP's firewall denies ingress traffic unless it matches an explicit rule.

### OS firewall

Alternatively, you may use operating system (OS)-level firewall rules to block all ingress traffic and allow only egress traffic. For example, if your server runs on Linux, you may use iptables to set up firewall rules:

1. Check your current firewall rules.
Terminal windowsudo iptables -L
2. Allow localhost to communicate with itself.
Terminal windowsudo iptables -A INPUT -i lo -j ACCEPT
3. Allow already established connection and related traffic.
Terminal windowsudo iptables -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
4. Allow new SSH connections.
Terminal windowsudo iptables -A INPUT -p tcp --dport ssh -j ACCEPT
5. Drop all other ingress traffic.
WarningBe very careful with the following command. If you did not preserve the current SSH connection or allow new SSH connections, you would be logged out and unable to SSH back into the system again.
Terminal windowsudo iptables -A INPUT -j DROP
6. After setting the firewall rules, use this command to check the current iptables settings:
Terminal windowsudo iptables -L

Run your tunnel and check that all configured services are still accessible to the outside world via the tunnel, but not via the external IP address of the server.

You can also secure your application with Cloudflare Access.

## Test connectivity

### Test with dig

To test your connectivity to Cloudflare, you can use the dig command to query the hostnames listed above. Note that cloudflared defaults to connecting with IPv4.

Terminal window ```
dig A region1.v2.argotunnel.com
```

```
;; ANSWER SECTION:region1.v2.argotunnel.com. 86400 IN  A  198.41.192.167region1.v2.argotunnel.com. 86400 IN  A  198.41.192.67region1.v2.argotunnel.com. 86400 IN  A  198.41.192.57region1.v2.argotunnel.com. 86400 IN  A  198.41.192.107region1.v2.argotunnel.com. 86400 IN  A  198.41.192.27region1.v2.argotunnel.com. 86400 IN  A  198.41.192.7region1.v2.argotunnel.com. 86400 IN  A  198.41.192.227region1.v2.argotunnel.com. 86400 IN  A  198.41.192.47region1.v2.argotunnel.com. 86400 IN  A  198.41.192.37region1.v2.argotunnel.com. 86400 IN  A  198.41.192.77...
```

Terminal window ```
dig AAAA region1.v2.argotunnel.com
```

```
...;; ANSWER SECTION:region1.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a0::1region1.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a0::2region1.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a0::3region1.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a0::4region1.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a0::5region1.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a0::6region1.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a0::7region1.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a0::8region1.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a0::9region1.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a0::10...
```

Terminal window ```
dig A region2.v2.argotunnel.com
```

```
;; ANSWER SECTION:region2.v2.argotunnel.com. 86400 IN  A  198.41.200.13region2.v2.argotunnel.com. 86400 IN  A  198.41.200.193region2.v2.argotunnel.com. 86400 IN  A  198.41.200.33region2.v2.argotunnel.com. 86400 IN  A  198.41.200.233region2.v2.argotunnel.com. 86400 IN  A  198.41.200.53region2.v2.argotunnel.com. 86400 IN  A  198.41.200.63region2.v2.argotunnel.com. 86400 IN  A  198.41.200.113region2.v2.argotunnel.com. 86400 IN  A  198.41.200.73region2.v2.argotunnel.com. 86400 IN  A  198.41.200.43region2.v2.argotunnel.com. 86400 IN  A  198.41.200.23...
```

Terminal window ```
dig AAAA region2.v2.argotunnel.com
```

```
...;; ANSWER SECTION:region2.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a8::1region2.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a8::2region2.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a8::3region2.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a8::4region2.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a8::5region2.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a8::6region2.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a8::7region2.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a8::8region2.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a8::9region2.v2.argotunnel.com. 86400 IN  AAAA  2606:4700:a8::10...
```

### Test with PowerShell

On Windows, you can use PowerShell commands if dig is not available.

To test DNS:

PowerShell ```
Resolve-DnsName -Name _v2-origintunneld._tcp.argotunnel.com SRV
```

```
Name                                     Type   TTL   Section    NameTarget                     Priority Weight Port----                                     ----   ---   -------    ----------                     -------- ------ ----_v2-origintunneld._tcp.argotunnel.com       SRV    112   Answer     region2.v2.argotunnel.com         2        1      7844_v2-origintunneld._tcp.argotunnel.com       SRV    112   Answer     region1.v2.argotunnel.com         1        1      7844
```

To test ports:

PowerShell ```
tnc region1.v2.argotunnel.com -port 443
```

```
ComputerName     : region1.v2.argotunnel.comRemoteAddress    : 198.41.192.227RemotePort       : 443InterfaceAlias   : EthernetSourceAddress    : 10.0.2.15TcpTestSucceeded : True
```

PowerShell ```
tnc region1.v2.argotunnel.com -port 7844
```

```
ComputerName     : region1.v2.argotunnel.comRemoteAddress    : 198.41.192.227RemotePort       : 7844InterfaceAlias   : EthernetSourceAddress    : 10.0.2.15TcpTestSucceeded : True
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tunnel availability and failover

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/tunnel-availability/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/tunnel-availability/)

Page options # Tunnel availability and failover

Our lightweight and open-source connector, cloudflared ‚Üó, was built to be highly available without any additional configuration requirements. When you run a tunnel, cloudflared establishes four outbound-only connections between the origin server and the Cloudflare network. These four connections are made to four different servers spread across at least two distinct data centers. This model ensures high availability and mitigates the risk of individual connection failures. This means in event a single connection, server, or data center goes offline, your resources will remain available.

## cloudflared replicas

Cloudflare Tunnel also allows users to deploy additional instances of our connector, cloudflared, for availability and failover scenarios. We refer to these unique instances as replicas. Each replica establishes four new connections which serve as additional points of ingress to your origin, should you need them. Each of the replicas will point to the same tunnel. This ensures that your network remains up in the event a single host running cloudflared goes down.

By design, replicas do not offer any level of traffic steering (random, hash, or round-robin). Instead, when a request arrives to Cloudflare, it will be forwarded to the replica that is geographically closest. If that distance calculation is unsuccessful or the connection fails, we will retry others, but there is no guarantee about which connection is chosen.

### When to use cloudflared replicas

- To provide additional points of availability for a single tunnel.
- To allocate failover nodes within your network.
- To update the configuration of a tunnel without downtime.

### Deploy cloudflared replicas

To deploy multiple instances of cloudflared, you can create and configure one tunnel and run it on multiple hosts. If your tunnel runs as a service, only one cloudflared instance is allowed per host.

Remotely-managed tunnels

1. To create a remotely-managed tunnel, follow the dashboard setup guide.
2. On the Tunnels page, select your newly created tunnel. The Connectors section shows all of the cloudflared instances for that tunnel.
3. Select Configure.
4. Select the operating system of the host where you want to deploy a replica.
5. Copy the installation command and run it on the host.

The new replica will appear on the Connectors list for the tunnel.

Locally-managed tunnels

1. To create a locally-managed tunnel, complete Steps 1 through 5 in the CLI setup guide.
2. Run your newly created tunnel.
Terminal windowcloudflared tunnel run <NAME>
This will start a cloudflared instance and generate a unique connector_id.
3. In a separate window or on another host, run the same command again:
Terminal windowcloudflared tunnel run <NAME>
This will initialize another cloudflared instance and generate another connector_id.
4. Run tunnel info to show each cloudflared instance running your tunnel:
Terminal windowcloudflared tunnel info <NAME>

This will output your tunnel UUID as well as two Connector IDs, one for each cloudflared process running your tunnel. With this command, you can also see that your tunnel is now being served by eight connections.

You can run the same tunnel across various cloudflared processes for up to 100 connections (25 replicas) per tunnel. Cloudflare Load Balancers and DNS records can still point to the tunnel and its UUID. Traffic will be sent to all cloudflared processes associated with the tunnel.

Deploy replicas in Kubernetes

For information about running cloudflared in a Kubernetes deployment, refer to the Kubernetes guide.

## Cloudflare Load Balancers

Cloudflare Load Balancing allows users to proactively steer traffic away from unhealthy origins (or other endpoints) and intelligently distribute the traffic load based on a multitude of steering algorithms. This process ensures that errors are not served to end users and empowers businesses to tightly couple overall business objectives to their traffic behavior.

In this model, more than one tunnel is required with identical configurations. The DNS record (UUID.cfargotunnel.com) for each Cloudflare Tunnel can be used at the origin within the load balancer. You can then define traffic steering policies to determine how traffic should be routed to each tunnel.

### When to use load balancers

- To intelligently steer traffic based on latency, geolocation, or other signals.
- To implement failover logic if a tunnel reaches an inactive state.
- To get alerted when a tunnel reaches an inactive state.
- To distribute traffic more evenly across your Cloudflare Tunnel-accessible origins or endpoints.

### Deploy a load balancer

Refer to the Load Balancer page for more information.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## System requirements

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/tunnel-availability/system-requirements/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/tunnel-availability/system-requirements/)

Page options # System requirements

Our connector, cloudflared, was designed to be lightweight and flexible enough to be effectively deployed on Raspberry Pi, your laptop or a server in a data center.

Unlike legacy VPNs where throughput is determined by the server's memory, CPU and other hardware specifications, Cloudflare Tunnel throughput is primarily limited by the number of ports configured in system software. Therefore, when sizing your cloudflared server, the most important element is sizing the available ports on the machine to reflect the expected throughput of TCP and UDP traffic.

## Recommendations

For most use cases, we recommend the following baseline configuration:

- Run a cloudflared replica on two dedicated host machines per network location. Using two hosts enables server-side redundancy and traffic balancing.
- Size each host with minimum 4GB of RAM and 4 CPU cores.
- Allocate 50,000 ports to the cloudflared process on each host.

This setup is usually sufficient to handle traffic from 8,000 WARP users (4,000 per host). The actual amount of resources used by cloudflared will depend on many variables, including the number of requests per second, bandwidth, network path and hardware. As additional users are onboarded, or if network traffic increases beyond your existing tunnel capacity, you can scale your tunnel by adding an additional cloudflared host in that location.

### Number of ports

When cloudflared receives a request from a WARP device, it uses the ports on the host machine to evaluate and forward the request to your origin service. Every machine by system design is hardware-limited to a maximum 65,535 ports. Additionally, each service on the machine has a limited number of ports that it can consume. For this reason, we recommend the following deployment model:

- cloudflared should be deployed on a dedicated host machine. This model is typically appropriate, but there may be serverless or clustered workflows where a dedicated host is not possible.
- The host machine should allocate 50,000 ports to be available for use by the cloudflared service. The remaining ports are reserved for system administrative processes.

- Linux
- Windows

To increase the number of ports available to cloudflared on Linux:

If your machine has a /etc/sysctl.d/ directory:

Terminal window ```
echo 'net.ipv4.ip_local_port_range = 11000 60999' | sudo tee -a /etc/sysctl.d/99-cloudflared.confsudo sysctl -p /etc/sysctl.d/99-cloudflared.conf
```

Otherwise:

Terminal window ```
echo 'net.ipv4.ip_local_port_range = 11000 60999' | sudo tee -a /etc/sysctl.confsudo sysctl -p /etc/sysctl.conf
```

To increase the number of ports available to cloudflared on Windows, set the dynamic port range ‚Üó for TCP and UDP:

```
netsh int ipv4 set dynamicport tcp start=11000 num=50000netsh int ipv4 set dynamicport udp start=11000 num=50000netsh int ipv6 set dynamicport tcp start=11000 num=50000netsh int ipv6 set dynamicport udp start=11000 num=50000
```

### Private DNS

DNS queries utilize more system resources compared to TCP and non-DNS UDP requests. To optimize service availability, Cloudflare recommends splitting private DNS traffic into its own Cloudflare Tunnel. The tunnel should run on a dedicated host and only include routes for your internal DNS resolver IPs.

### ulimits

On Linux and macOS, ulimit settings determine the system resources available to a logged-in user. We recommend configuring the following ulimits on the cloudflared server:

| ulimit | Description | Value |
| --- | --- | --- |
| -n | Maximum number of open files or file descriptors | ‚â• 70,000 |

To view your current ulimits, open a terminal and run:

Terminal window ```
ulimit -a
```

To set the open files ulimit:

Terminal window ```
ulimit -n 70000
```

The command above sets the open files limit only for the current terminal session and will not persist after a reboot or new login. To apply this limit permanently, configure it using the persistent method appropriate for your operating system.

## Estimated throughput

Most private network traffic proxied by cloudflared falls in one of two categories:

- TCP requests (more common, less resource intensive)
- UDP requests (less common, more resource intensive)

TCP traffic uses and releases ports almost instantaneously. This means that in order to overload a cloudflared instance with 50,000 available ports, your organization would need to continuously generate 50,001 TCP requests per second.

UDP traffic is more unique. DNS queries - usually the bulk of UDP traffic - are held by ports in cloudflared for five seconds. Non-DNS UDP traffic holds each port for the duration of the connection, which can be any amount of time. This means that in order to overload a cloudflared instance with 50,000 available ports, you would need to continuously generate either 10,000 DNS queries to your private resolver per second, or a cumulative 50,000 non-DNS UDP requests over a shorter time than your connection reset rate.

### Calculate your tunnel capacity

Our baseline recommendations serve as a starting point for a Cloudflare Tunnel deployment. Once you have a representative population of users engaging with your network for at least a week, you can customize tunnel sizing according to your own traffic patterns.

To calculate your tunnel capacity:

1. Set up a metrics service when you run the tunnel.
2. After a week or so, query the following tunnel metrics:

cloudflared_tcp_total_sessions
cloudflared_udp_total_sessions
3. cloudflared_tcp_total_sessions
4. cloudflared_udp_total_sessions
5. Compute the average TCP requests per second and Non-DNS UDP requests per second by dividing total sessions by total time.
6. In your private DNS resolver, obtain the average Private DNS requests per second.
7. Input your values into our sizing calculator:

System configuration

Available ports per host Number of cloudflared replicas DNS UDP session timeout (in seconds) Average non-DNS UDP session timeout (seconds) Metrics

TCP requests per second Non-DNS UDP requests per second Private DNS requests per second Result

Percent capacity per replica Percent capacity across all replicas Maximum DNS requests per minute across all replicas This calculator is for informational purposes only and all results are
	estimates. You can use these results to determine if your tunnel is appropriately sized. To increase your tunnel capacity, add identical host machines running cloudflared replicas.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tunnel permissions

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/remote-tunnel-permissions/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/remote-tunnel-permissions/)

Page options # Tunnel permissions

A remotely-managed tunnel only requires the tunnel token to run. Anyone with access to the token will be able to run the tunnel.

## Get the tunnel token

To get the token for a remotely-managed tunnel:

- Dashboard
- API
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Networks > Tunnels.
2. Select a cloudflared tunnel and select Edit.
3. Copy the cloudflared installation command.
4. Paste the installation command into any text editor. The token value is of the form eyJhIjoiNWFiNGU5Z...

Make a GET request to the Cloudflare Tunnel token endpoint:

Required API token permissions

At least one of the following token permissions is required: - Cloudflare One Connectors Write
- Cloudflare One Connector: cloudflared Write
- Cloudflare Tunnel Write

Get a Cloudflare Tunnel token ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/cfd_tunnel/$TUNNEL_ID/token" \  --request GET \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
```

```
{  "success": true,  "errors": [],  "messages": [],  "result": "eyJhIjoiNWFiNGU5Z..."}
```

The token value can be found in the result.

```
data "cloudflare_zero_trust_tunnel_cloudflared_token" "tunnel_token" {  account_id = var.cloudflare_account_id  tunnel_id = cloudflare_zero_trust_tunnel_cloudflared.example_tunnel.id}
```

If your host machine is not managed in Terraform or you want to install the tunnel manually, you can output the token value to the CLI.

Example: Output to CLI

1. Output the tunnel token to the Terraform state file:
output "tunnel_token" {  value       = data.cloudflare_zero_trust_tunnel_cloudflared_token.tunnel_token.token  sensitive   = true}
2. Apply the configuration:
Terminal windowterraform apply
3. Read the tunnel token:
Terminal windowterraform output -raw tunnel_token
eyJhIj...

Alternatively, pass data.cloudflare_zero_trust_tunnel_cloudflared_token.tunnel_token.token directly into your host's Terraform configuration or store the token in your secret management tool.

Example: Store in HashiCorp Vault

```
resource "vault_generic_secret" "tunnel_token" {  path         = "kv/cloudflare/tunnel_token"
  data_json = jsonencode({    "TUNNEL_TOKEN" = data.cloudflare_zero_trust_tunnel_cloudflared_token.tunnel_token.token  })}
```

## Rotate a token without service disruption

Cloudflare recommends rotating the tunnel token at a regular cadence to reduce the risk of token compromise. You can rotate a token with minimal disruption to users as long as the tunnel is served by at least two cloudflared replicas. To ensure service availability, we recommend performing token rotations outside of working hours or in a maintenance window.

To rotate a tunnel token:

1. Refresh the token on Cloudflare:

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Networks > Tunnels.
2. Select a cloudflared tunnel and select Edit.
3. Select Refresh token.
4. Copy the cloudflared installation command for your operating system. This command contains the new token.

1. Generate a random base64 string (minimum size 32 bytes) to use as a tunnel secret:
Terminal windowopenssl rand -base64 32
AQIDBAUGBwgBAgMEBQYHCAECAwQFBgcIAQIDBAUGBwg=
2. Make a PATCH request to the Cloudflare Tunnel endpoint:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Cloudflare One Connectors WriteCloudflare One Connector: cloudflared WriteCloudflare Tunnel Write Update a Cloudflare Tunnelcurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/cfd_tunnel/$TUNNEL_ID" \  --request PATCH \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Example tunnel",    "tunnel_secret": "AQIDBAUGBwgBAgMEBQYHCAECAwQFBgcIAQIDBAUGBwg="  }'
{  "success": true,  "errors": [],  "messages": [],  "result": {    "id": "f70ff985-a4ef-4643-bbbc-4a0ed4fc8415",    "account_tag": "699d98642c564d2e855e9661899b7252",    "created_at": "2024-12-04T22:03:26.291225Z",    "deleted_at": null,    "name": "Example tunnel",    "connections": [],    "conns_active_at": null,    "conns_inactive_at": "2024-12-04T22:03:26.291225Z",    "tun_type": "cfd_tunnel",    "metadata": {},    "status": "inactive",    "remote_config": true,    "token": "eyJhIjoiNWFiNGU5Z..."  }}
3. Cloudflare One Connectors Write
4. Cloudflare One Connector: cloudflared Write
5. Cloudflare Tunnel Write
6. Copy the token value shown in the output.

After refreshing the token, cloudflared can no longer establish new connections to Cloudflare using the old token. However, existing connectors will remain active and the tunnel will continue serving traffic.

1. On half of your cloudflared replicas, update cloudflared to use the new token. For example, on a Linux host:
Terminal windowsudo cloudflared service install <TOKEN>
2. Restart cloudflared:
Terminal windowsudo systemctl restart cloudflared.service
3. Confirm that the service started correctly:
Terminal windowsudo systemctl status cloudflared
While these replicas are connecting to Cloudflare with the new token, traffic will automatically route through the other replicas.
4. Wait 10 minutes for traffic to route through the new connectors.
5. Repeat steps 2, 3, and 4 for the second half of the replicas.

The tunnel token is now fully rotated. The old token is no longer in use.

## Rotate a compromised token

If your tunnel token is compromised, we recommend taking the following steps:

1. Refresh the token using the dashboard or API. Refer to Step 1 of Rotate a token without service disruption.
2. Delete all connections between cloudflared and Cloudflare:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Cloudflare One Connectors WriteCloudflare One Connector: cloudflared WriteCloudflare Tunnel Write Clean up Cloudflare Tunnel connectionscurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/cfd_tunnel/$TUNNEL_ID/connections" \  --request DELETE \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
This will clean up any unauthorized connections and prevent users from connecting to your network.
3. Cloudflare One Connectors Write
4. Cloudflare One Connector: cloudflared Write
5. Cloudflare Tunnel Write
6. On each cloudflared replica, update cloudflared to use the new token. For example, on a Linux host:
Terminal windowsudo cloudflared service install <TOKEN>
7. Restart cloudflared:
Terminal windowsudo systemctl restart cloudflared.service
8. Confirm that the service started correctly:
Terminal windowsudo systemctl status cloudflared

The tunnel token is now fully rotated. The old token is no longer in use.

## Account-scoped roles

Minimum permissions needed to create, delete, and configure tunnels for an account:

- Cloudflare Access

Additional permissions needed to route traffic to a public hostname:

- DNS

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Use cases

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/)

Page options # Use cases

Cloudflare Tunnel creates a secure, outbound-only connection between your services and Cloudflare by deploying a lightweight connector in your environment. Here is how to use tunnels with some specific services:

- SSH
- RDP
- SMB
- gRPC

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SSH

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/ssh/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/ssh/)

Page options # SSH

The Secure Shell Protocol (SSH) enables users to remotely access devices through the command line. With Cloudflare Zero Trust, you can make your SSH server available over the Internet without the risk of opening inbound ports on the server.

Cloudflare offers four ways to secure SSH:

- SSH with Access for Infrastructure (recommended)
- Self-managed SSH keys
- Browser-rendered SSH terminal
- SSH with client-side cloudflared (legacy)

For an overview of these connection options, refer to non-HTTP applications.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SSH with Access for Infrastructure (recommended)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/ssh/ssh-infrastructure-access/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/ssh/ssh-infrastructure-access/)

Page options # SSH with Access for Infrastructure (recommended)

Access for Infrastructure provides granular control over how users can connect to your SSH servers. This feature uses the same deployment model as WARP-to-Tunnel but unlocks more policy options and command logging functionality.

Furthermore, Access for Infrastructure replaces traditional SSH keys with short-lived certificates issued to your users based on the token generated by their Access login. In traditional models, users generate an SSH keypair and administrators grant access to individual SSH servers by deploying their users' public keys to those servers. These SSH keys can remain unchanged on these servers for months or years. Cloudflare Access removes the burden of managing SSH keys, while also improving security by replacing long-lived SSH keys with ephemeral SSH certificates.

## 1. Connect the server to Cloudflare

1. Create a Cloudflare Tunnel for your server by following our dashboard setup guide. You can skip the connect an application step and go straight to connecting a network.

1. In the Private Networks tab for the tunnel, enter the IP or CIDR address of your server. Typically this would be a private IP, but public IPs are also allowed.

## 2. Set up the client

To connect your devices to Cloudflare:

1. Deploy the WARP client on your devices in Gateway with WARP mode.
2. Enable the Gateway proxy for TCP.
3. Create device enrollment rules to determine which devices can enroll to your Zero Trust organization.

## 3. Route server IPs through WARP

By default, WARP excludes traffic bound for RFC 1918 space ‚Üó, which are IP addresses typically used in private networks and not reachable from the Internet. In order for WARP to send traffic to your SSH server, you must configure Split Tunnels so that the IP/CIDR of your SSH server routes through WARP.

1. First, check whether your Split Tunnels mode is set to Exclude or Include mode.
2. If you are using Include mode, add your SSH server's IP/CIDR range to the list. Your list should also include the domains necessary for Cloudflare Zero Trust functionality.
3. If you are using Exclude mode:
a. Delete your SSH server's IP/CIDR range from the list. For example, if your network uses the default AWS range of 172.31.0.0/16, delete 172.16.0.0/12.
b. Re-add IP/CIDR ranges that are not explicitly used by your SSH server. For the AWS example above, you would add new entries for 172.16.0.0/13, 172.24.0.0/14, 172.28.0.0/15, and 172.30.0.0/16. This ensures that only traffic to 172.31.0.0/16 routes through WARP.
You can use the following calculator to determine which IP addresses to re-add:
Base CIDR: Excluded CIDRs: Calculate
In Base CIDR, enter the RFC 1918 range that you deleted from Split Tunnels. In Excluded CIDRs, enter the IP/CIDR range used by your SSH server. Re-add the calculator results to your Split Tunnel Exclude mode list.

By tightening the private IP range included in WARP, you reduce the risk of breaking a user's access to local resources.

## 4. Add a target

A target represents a single resource in your infrastructure (such as a server, Kubernetes cluster, database, or container) that users will connect to through Cloudflare.

Targets are protocol-agnostic, meaning that you do not need to define a new target for each protocol that runs on the server. To create a new target:

- Dashboard
- API
- Terraform

1. In Zero Trust ‚Üó, go to Networks > Targets.
2. Select Add a target.
3. In Target hostname, enter a user-friendly name for the target. We recommend using the server hostname, for example production-server. The target hostname does not need to be unique and can be reused for multiple targets. Hostnames are used to define the targets secured by an Access application; they are not used for DNS address resolution.
 Format restrictions
 
Case insensitive
Contain no more than 253 characters
Contain only alphanumeric characters, -, or . (no spaces allowed)
Start and end with an alphanumeric character
4. Case insensitive
5. Contain no more than 253 characters
6. Contain only alphanumeric characters, -, or . (no spaces allowed)
7. Start and end with an alphanumeric character
8. In IP addresses, enter the IPv4 and/or IPv6 address of the target resource. The dropdown menu will not populate until you type in the full IP address.

Note

If the target IP does not appear in the dropdown, go to Networks > Routes and confirm that the IP routes through Cloudflare Tunnel.

1. In the dropdown menu, select the IP address and virtual network where the resource is located. This IP address and virtual network pairing is now assigned to this target and cannot be reused in another target by design.
2. Select Add target.

Make a POST request to the Infrastructure Access Targets endpoint:

Create new target ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/infrastructure/targets" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "hostname": "infra-access-target",    "ip": {        "ipv4": {            "ip_addr": "187.26.29.249",            "virtual_network_id": "c77b744e-acc8-428f-9257-6878c046ed55"        },        "ipv6": {            "ip_addr": "64c0:64e8:f0b4:8dbf:7104:72b0:ec8f:f5e0",            "virtual_network_id": "c77b744e-acc8-428f-9257-6878c046ed55"        }    }  }'
```

Provider versions

The following example requires Cloudflare provider version >=4.45.0.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Configure the cloudflare_zero_trust_infrastructure_access_target ‚Üó resource:
resource "cloudflare_zero_trust_infrastructure_access_target" "infra-ssh-target" {  account_id = var.cloudflare_account_id    hostname   = "infra-access-target"    ip = {      ipv4 = {        ip_addr = "187.26.29.249"        virtual_network_id = "c77b744e-acc8-428f-9257-6878c046ed55"      }      ipv6 = {        ip_addr = "64c0:64e8:f0b4:8dbf:7104:72b0:ec8f:f5e0"        virtual_network_id = "c77b744e-acc8-428f-9257-6878c046ed55"      }    }}

Next, create an Access application to secure the target.

## 5. Add an infrastructure application

- Dashboard
- API
- Terraform (v4)

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Select Infrastructure.
4. Enter any name for the application.
5. In Target criteria, select the target hostname(s) that you want to secure. This application definition will apply to all targets that share the selected hostname, including any targets added in the future. Similarly, if you later decide to change the hostname for a target, the renamed target will no longer be covered by this application.
6. Enter the Protocol and Port that will be used to connect to the server.
7. (Optional) If a protocol runs on more than one port, select Add new target criteria and reconfigure the same target hostname and protocol with a different port number.
NoteAccess for Infrastructure only supports assigning one protocol per port. You can reuse a port/protocol pairing across infrastructure applications, but the port cannot be reassigned to another protocol.
8. Select Next.
9. To secure your targets, configure a policy that defines who can connect and how they can connect:


Enter any name for your policy.


Create a rule that matches the users who are allowed to reach the targets. For more information, refer to Access policies and review the list of infrastructure policy selectors.


In Connection context, configure the following settings:

SSH user: Enter the UNIX usernames that users can log in as (for example, root or ec2-user).
Allow users to log in as their email alias: (Optional) When selected, users who match your policy definition will be able to access the target using their lowercased email address prefix. For example, Jdoe@company.com could log in as jdoe.

NoteCloudflare will not create new users on the target. UNIX users must already be present on the server.
10. Enter any name for your policy.
11. Create a rule that matches the users who are allowed to reach the targets. For more information, refer to Access policies and review the list of infrastructure policy selectors.
12. In Connection context, configure the following settings:

SSH user: Enter the UNIX usernames that users can log in as (for example, root or ec2-user).
Allow users to log in as their email alias: (Optional) When selected, users who match your policy definition will be able to access the target using their lowercased email address prefix. For example, Jdoe@company.com could log in as jdoe.

NoteCloudflare will not create new users on the target. UNIX users must already be present on the server.
13. SSH user: Enter the UNIX usernames that users can log in as (for example, root or ec2-user).
14. Allow users to log in as their email alias: (Optional) When selected, users who match your policy definition will be able to access the target using their lowercased email address prefix. For example, Jdoe@company.com could log in as jdoe.
15. Select Add application.

Make a POST request to the Access applications endpoint:

Required API token permissions

At least one of the following token permissions is required: - Access: Apps and Policies Write

Add an Access application ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/apps" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Example infrastructure app",    "type": "infrastructure",    "target_criteria": [        {            "target_attributes": {                "hostname": [                    "infra-access-target"                ]            },            "port": 22,            "protocol": "SSH"        }    ],    "policies": [        {            "name": "Allow a specific email",            "decision": "allow",            "include": [                {                    "email": {                        "email": "jdoe@company.com"                    }                }            ],            "connection_rules": {                "ssh": {                    "usernames": [                        "root",                        "ec2-user"                    ]                }            }        }    ]  }'
```

Provider versions

The following example requires Cloudflare provider version >=4.45.0.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Access: Apps and Policies Write
2. Access: Apps and Policies Write
3. Use the cloudflare_zero_trust_access_application ‚Üó resource to create an infrastructure application:
resource "cloudflare_zero_trust_access_application" "infra-app" {  account_id = var.cloudflare_account_id  name       = "Example infrastructure app"  type       = "infrastructure"
  target_criteria {    port     = 22    protocol = "SSH"    target_attributes {      name = "hostname"      values = ["infra-access-target"]    }  }}
4. Use the cloudflare_zero_trust_access_policy ‚Üó resource to add an infrastructure policy to the application:
resource "cloudflare_zero_trust_access_policy" "infra-app-policy" {  application_id = cloudflare_zero_trust_access_application.infra-app.id  account_id = var.cloudflare_account_id  name       = "Allow a specific email"  decision   = "allow"  precedence = 1
  include {    email = ["jdoe@company.com"]  }
  connection_rules {    ssh {      usernames = ["root", "ec2-user"]    }  }}

The targets in this application are now secured by your infrastructure policies.

## 6. (Recommended) Modify order of precedence in Gateway

By default, Cloudflare will evaluate Access application policies after evaluating all Gateway network policies. To evaluate Access applications before or after specific Gateway policies:

1. Create the following Gateway network policy:
















SelectorOperatorValueActionAccess Infrastructure TargetisPresentAllow
2. Update the policy's order of precedence using the dashboard or API.

This Gateway policy will apply to all Access for Infrastructure targets, including RDP and SSH.

Note

Users must pass the policies in your Access application before they are granted access. The Gateway Allow policy is strictly for routing and connectivity purposes.

## 7. Configure SSH server

Next, configure your SSH server to trust the Cloudflare SSH CA. This allows Access to authenticate using short-lived certificates instead of traditional SSH keys.

### Generate a Cloudflare SSH CA

Note

Other short-lived CAs, such as those used to secure SSH servers behind Cloudflare Access, are incompatible with the Gateway SSH proxy. For SSH logging to work, you must create a new CA using the gateway_ca API endpoint.

To generate a Cloudflare SSH CA and get its public key:

1. Create an API token with the following permissions:















TypeItemPermissionAccountAccess: SSH AuditingEdit
2. If you have not yet generated a Cloudflare SSH CA, make a POST request to the Cloudflare API:

Required API token permissions

At least one of the following token permissions is required: - Access: SSH Auditing Write

Add a new SSH Certificate Authority (CA) ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/gateway_ca" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
```

1. If you have already created a Cloudflare SSH CA or receive the error message access.api.error.gateway_ca_already_exists, make a GET request instead:

Required API token permissions

At least one of the following token permissions is required: - Access: SSH Auditing Write
- Access: SSH Auditing Read

List SSH Certificate Authorities (CA) ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/gateway_ca" \  --request GET \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
```

1. Copy the public_key value returned in the response.

### Save the public key

1. Use the following command to change directories to the SSH configuration directory on the remote target machine:
Terminal windowcd /etc/ssh
2. Once there, you can use the following command to both generate the file and open a text editor to input/paste the public key.
Terminal windowvim ca.pub
3. In the ca.pub file, paste the public key without any modifications.
ca.pubecdsa-sha2-nistp256 <redacted> open-ssh-ca@cloudflareaccess.org
The ca.pub file can hold multiple keys, listed one per line. Empty lines and comments starting with # are also allowed.
4. Save the ca.pub file. In some systems, you may need to use the following command to force the file to save depending on your permissions:
Terminal window:w !sudo tee %:q!

### Modify your sshd_config file

Configure your SSH server to trust the Cloudflare SSH CA by updating the sshd_config file on the remote target machine.

1. While in the /etc/ssh directory on the remote machine, open the sshd_config file.
Terminal window sudo vim /etc/ssh/sshd_config
2. Press i to enter insert mode, then add the following lines at the top of the file, above all other directives:
PubkeyAuthentication yesTrustedUserCAKeys /etc/ssh/ca.pub
Be aware of your include statementsIf there are any include statements below these lines, the configurations in those files will not take precedence.
3. Press esc and then type :x and press Enter to save and exit.

Note

For certain distributions, such as Amazon Linux 1 (based on RHEL), the certificate file permissions must be set to 600. You can set file permissions with the following command:

Terminal window ```
chmod 600 /etc/ssh/ca.pub
```

### Reload your SSH server

Once you have modified your SSHD configuration, reload the SSH service on the remote machine for the changes to take effect.

- Debian/Ubuntu
- CentOS/RHEL

For Debian/Ubuntu:

Terminal window ```
sudo systemctl reload ssh
```

For CentOS/RHEL 7 and newer:

Terminal window ```
sudo systemctl reload sshd
```

## 8. Connect as a user

Users can use any SSH client to connect to the target, as long as they are logged into the WARP client on their device. If the target is located within a particular virtual network, ensure that the WARP client is connected to that virtual network before initiating the connection. Users do not need to modify any SSH configs on their device. For example, to SSH from a terminal:

Terminal window ```
ssh <username>@<target IP>
```

Access for Infrastructure also supports scp, sftp, and rsync commands. Refer to Known limitations for a list of unsupported SSH commands and features.

To learn more about user connections, refer to the Access for Infrastructure documentation.

## SSH command logs

SSH command logs contain the actual SSH commands that a user ran on the target. Customers on all plans can store SSH logs on Cloudflare and download the logs from the dashboard. Downloadable logs are encrypted using a public key provided by the customer and are not visible to Cloudflare. Delivery of downloadable SSH logs is best effort; for guaranteed delivery, Enterprise customers can configure a Logpush job to send SSH logs to storage destinations. Logpush payloads are not encrypted with a customer-provided public key.

### Download encrypted SSH logs

Follow these instructions to encrypt and download SSH command logs from Zero Trust.

#### Enable SSH command logging

To log SSH commands, you will need to generate an HPKE key pair and upload the public key to Cloudflare.

1. Download ‚Üó the Cloudflare ssh-log-cli utility.
2. Using the ssh-log-cli utility, generate a public and private key pair.
Terminal window./ssh-log-cli generate-key-pair -o sshkeyls
README.md    ssh-log-cli    sshkey    sshkey.pub
This command outputs two files, an sshkey.pub public key and a matching sshkey private key.
3. In Zero Trust ‚Üó, go to Settings > Network.
4. In SSH encryption public key, paste the contents of sshkey.pub and select Save.

All proxied SSH commands are immediately encrypted using this public key. The matching private key is required to view logs.

#### Disable SSH command logging

To turn off SSH command logging, delete your uploaded public key:

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Settings > Network > SSH encryption public key.
2. Select Remove.
3. Select Remove key to confirm.

Cloudflare will stop logging SSH commands to your targets, as well as any commands subject to Gateway Audit SSH policies.

To delete the SSH encryption public key using the API:

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Update Zero Trust SSH settings ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/audit_ssh_settings" \  --request PUT \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "public_key": ""  }'
```

#### View SSH logs

SSH command logs are not visible from the dashboard itself and must be exported and decrypted.

To manually retrieve logs:

1. In Zero Trust ‚Üó, go to Logs > Access.
2. Filter the logs using the name of your SSH application.
3. Select the SSH session for which you want to export command logs.
4. In the side panel, scroll down to SSH logs and select Download.
5. To decrypt the log, follow the instructions in the SSH Logging CLI repository ‚Üó. In the following example, sshkey is the private key that matches the public key uploaded to Cloudflare.
Terminal window./ssh-log-cli decrypt -i sshlog -k sshkey
This command outputs a sshlog-decrypted.zip file with the decrypted logs.

### Export SSH logs with Logpush

Availability

Only available on Enterprise plans.

Cloudflare allows you to send SSH command logs to storage destinations configured in Logpush, including third-party destinations. For a list of available data fields, refer to the SSH logs dataset.

To set up the Logpush job, refer to Logpush integration.

## Known limitations

### SSH features

The following SSH features are not supported:

- Local and remote port forwarding
- SSH agent forwarding
- X11 forwarding

### Session duration

SSH sessions have a maximum expected duration of 10 hours. For more information, refer to the Troubleshooting FAQ.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect with self-managed SSH keys

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/ssh/ssh-warp-to-tunnel/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/ssh/ssh-warp-to-tunnel/)

Page options # Connect with self-managed SSH keys

If you want to manage your own SSH keys, you can use Cloudflare Tunnel to create a secure, outbound-only connection from your server to Cloudflare's global network. This requires running the cloudflared daemon on the server (or any other host machine within the private network). Users with SSH keys that are trusted by the SSH server can access the server by installing the Cloudflare WARP client on their device and enrolling in your Zero Trust organization. Remote devices will be able to connect as if they were on your private network. By default, all devices enrolled in your organization can SSH to the server unless you build policies to allow or block specific users.

Note

If you want to create more granular access policies, allow Cloudflare to manage SSH keys for you, or to obtain command logs, consider using Access for Infrastructure instead.

This example walks through how to set up an SSH server on a Google Cloud Platform (GCP) virtual machine (VM), but you can use any machine that supports SSH connections.

## 1. Create an SSH key pair

Before creating your VM instance you will need to create an SSH key pair.

1. Open a terminal and type the following command:
Terminal windowssh-keygen -t rsa -f ~/.ssh/gcp_ssh -C <username in GCP>
2. Enter your passphrase when prompted. It will need to be entered twice.
Two files will be generated: gcp_ssh which contains the private key, and gcp_ssh.pub which contains the public key.
3. In the command line, enter:
Terminal windowcat ~/.ssh/gcp_ssh.pub
4. Copy the output. This will be used when creating the VM instance in GCP.

## 2. Create a VM instance in GCP

Now that the SSH key pair has been created, you can create a VM instance.

1. In your Google Cloud Console ‚Üó, create a new project ‚Üó.
2. Go to Compute Engine > VM instances.
3. Select Create instance.
4. Name your VM instance, for example ssh-server.
5. Scroll down to Advanced options > Security > Manage Access.
6. Under Add manually generated SSH keys, select Add item and paste the public key that you have created.
7. Select Create.
8. Once your VM instance is running, open the dropdown next to SSH and select Open in browser window.

Note

In order to be able to establish an SSH connection, do not enable OS Login ‚Üó on the VM instance.

## 3. Connect the server to Cloudflare

1. Create a Cloudflare Tunnel for your server by following our dashboard setup guide. You can skip the connect an application step and go straight to connecting a network.

1. In the Private Networks tab for the tunnel, enter the private IP or CIDR address of your server. In GCP, the server IP is the Internal IP of the VM instance.
2. (Optional) Set up Zero Trust policies to fine-tune access to your server.

## 4. Set up the client

To connect your devices to Cloudflare:

1. Deploy the WARP client on your devices in Gateway with WARP mode or generate a proxy endpoint and deploy a PAC file.
2. Create device enrollment rules to determine which devices can enroll to your Zero Trust organization.

## 5. Route private network IPs through WARP

By default, WARP excludes traffic bound for RFC 1918 space ‚Üó, which are IP addresses typically used in private networks and not reachable from the Internet. In order for WARP to send traffic to your private network, you must configure Split Tunnels so that the IP/CIDR of your private network routes through WARP.

1. First, check whether your Split Tunnels mode is set to Exclude or Include mode.
2. If you are using Include mode, add your private network's IP/CIDR range to the list. Your list should also include the domains necessary for Cloudflare Zero Trust functionality.
3. If you are using Exclude mode:
a. Delete your private network's IP/CIDR range from the list. For example, if your network uses the default AWS range of 172.31.0.0/16, delete 172.16.0.0/12.
b. Re-add IP/CIDR ranges that are not explicitly used by your private network. For the AWS example above, you would add new entries for 172.16.0.0/13, 172.24.0.0/14, 172.28.0.0/15, and 172.30.0.0/16. This ensures that only traffic to 172.31.0.0/16 routes through WARP.
You can use the following calculator to determine which IP addresses to re-add:
Base CIDR: Excluded CIDRs: Calculate
In Base CIDR, enter the RFC 1918 range that you deleted from Split Tunnels. In Excluded CIDRs, enter the IP/CIDR range used by your private network. Re-add the calculator results to your Split Tunnel Exclude mode list.

By tightening the private IP range included in WARP, you reduce the risk of breaking a user's access to local resources.

## 6. Connect as a user

Once you have set up the application and the user device, the user can now SSH into the machine using its private IP address. If your SSH server requires an SSH key, the key should be included in the command.

Terminal window ```
ssh -i ~/.ssh/gcp_ssh <username>@<server IP>
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect to SSH in the browser

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/ssh/ssh-browser-rendering/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/ssh/ssh-browser-rendering/)

Page options # Connect to SSH in the browser

Cloudflare's browser-based terminal allows end users to connect to an SSH server without managing SSH keys or installing the WARP client.

This method requires routing SSH access to the server through a public hostname. The traffic is proxied over this connection, and the user logs in to the server with their Cloudflare Access credentials.

The browser-based terminal can be used in conjunction with routing over WARP and Access for Infrastructure so that there are multiple ways to connect to the server. You can reuse the same Cloudflare Tunnel when configuring each connection method.

## 1. Connect the server to Cloudflare

1. Create a Cloudflare Tunnel by following our dashboard setup guide.
2. In the Public Hostnames tab, choose a domain from the drop-down menu and specify any subdomain (for example, ssh.example.com).
3. For Service, select SSH and enter localhost:22. If the SSH server is on a different machine from where you installed the tunnel, enter <server IP>:22.
4. Select Save hostname.
5. (Recommended) Add a self-hosted application to Cloudflare Access in order to manage access to your server.

## 2. Connect as a user

To enable browser-rendering for SSH, refer to Browser-rendered terminal.

When users visit the public hostname URL (for example, https://ssh.example.com) and log in with their Access credentials, Cloudflare will render a terminal in their browser.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect to SSH with client-side cloudflared (legacy)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/ssh/ssh-cloudflared-authentication/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/ssh/ssh-cloudflared-authentication/)

Page options # Connect to SSH with client-side cloudflared (legacy)

Note

Not recommended for new deployments. We recommend using Access for Infrastructure to connect to SSH.

End users can connect to an SSH server without the WARP client by authenticating through cloudflared in their native terminal. This method requires having cloudflared installed on both the server machine and on the client machine, as well as an active zone on Cloudflare. The traffic is proxied over this connection, and the user logs in to the server with their Cloudflare Access credentials.

Client-side cloudflared can be used in conjunction with routing over WARP and Access for Infrastructure so that there are multiple ways to connect to the server. You can reuse the same Cloudflare Tunnel when configuring each connection method.

## 1. Connect the server to Cloudflare

1. Create a Cloudflare Tunnel by following our dashboard setup guide.
2. In the Public Hostnames tab, choose a domain from the drop-down menu and specify any subdomain (for example, ssh.example.com).
3. For Service, select SSH and enter localhost:22. If the SSH server is on a different machine from where you installed the tunnel, enter <server IP>:22.
4. Select Save hostname.
5. (Recommended) Add a self-hosted application to Cloudflare Access in order to manage access to your server.

## 2. Connect as a user

1. Install cloudflared on the client machine.
2. Make a one-time change to your SSH configuration file:
Terminal windowvim ~/.ssh/config
3. Input the following values; replacing ssh.example.com with the hostname you created.
Host ssh.example.comProxyCommand /usr/local/bin/cloudflared access ssh --hostname %h
The cloudflared path may be different depending on your OS and package manager. For example, if you installed cloudflared on macOS with Homebrew, the path is /opt/homebrew/bin/cloudflared.
4. You can now test the connection by running a command to reach the service:
Terminal windowssh <username>@ssh.example.com
When the command is run, cloudflared will launch a browser window to prompt you to authenticate with your identity provider before establishing the connection from your terminal.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## RDP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/rdp/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/rdp/)

Page options # RDP

The Remote Desktop Protocol (RDP) provides a graphical interface for users to connect to a computer remotely. RDP is most commonly used to facilitate simple remote access to machines or workstations which users cannot physically access. However, this also makes RDP connections the frequent subject of attacks, since a misconfiguration can inadvertently allow unauthorized access to the machine.

With Cloudflare Zero Trust, you can make your RDP server available over the Internet without the risk of opening any inbound ports on your local server.

Cloudflare offers three ways to secure RDP:

- Browser-based RDP
- RDP with WARP client
- RDP with client-side cloudflared

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect to RDP in a browser

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/rdp/rdp-browser/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/rdp/rdp-browser/)

Page options # Connect to RDP in a browser

Users can connect to an RDP server without installing an RDP client or the WARP client on their device. Browser-based RDP leverages Cloudflare Tunnel, which creates a secure, outbound-only connection from your RDP server to Cloudflare's global network. Setup involves running the cloudflared daemon on the RDP server (or any other host machine within the private network) and routing RDP traffic over a public hostname.

There are two ways for users to reach the RDP server in their browser:

- App Launcher (recommended): Users can log in to the Access App Launcher with their Cloudflare Access credentials and then initiate an RDP connection within the browser to their Windows machine. Users will authenticate to the Windows machine using their pre-configured Windows username and password. Cloudflare does not manage any credentials on the Windows server.
- Direct URL: A user may also navigate directly to the Windows server at https://<app-domain>/rdp/<vnet-id>/<target-ip>/<port>, where vnet-id is the virtual network assigned to the Cloudflare Tunnel route. The authentication flow is the same as for the App Launcher; first users must log in to Cloudflare Access and then use their Windows credentials to authenticate to the Windows machine.

Browser-based RDP can be used in conjunction with routing over WARP so that there are multiple ways to connect to the server. You can reuse the same Cloudflare Tunnel when configuring each connection method.

## Prerequisites

- An active domain on Cloudflare.
- The domain uses either a full setup or a partial (CNAME) setup.
- An RDP server running a supported Windows operating system.

## 1. Connect the server to Cloudflare

1. Create a Cloudflare Tunnel for your server by following our dashboard setup guide. You can skip the connect an application step and go straight to connecting a network.

1. In the Private Networks tab for the tunnel, enter the IP or CIDR address of your server. Typically this would be a private IP, but public IPs are also allowed.

## 2. Add a target

A target represents a single resource in your infrastructure (such as a server, Kubernetes cluster, database, or container) that users will connect to through Cloudflare.

Create a target for each Windows machine that requires RDP access. To create a new target:

- Dashboard
- API
- Terraform

1. In Zero Trust ‚Üó, go to Networks > Targets.
2. Select Add a target.
3. In Target hostname, enter a user-friendly name for the target. We recommend using the server hostname, for example production-server. The target hostname does not need to be unique and can be reused for multiple targets. Hostnames are used to define the targets secured by an Access application; they are not used for DNS address resolution.
 Format restrictions
 
Case insensitive
Contain no more than 253 characters
Contain only alphanumeric characters, -, or . (no spaces allowed)
Start and end with an alphanumeric character
4. Case insensitive
5. Contain no more than 253 characters
6. Contain only alphanumeric characters, -, or . (no spaces allowed)
7. Start and end with an alphanumeric character
8. In IP addresses, enter the IPv4 and/or IPv6 address of the target resource. The dropdown menu will not populate until you type in the full IP address.

Note

If the target IP does not appear in the dropdown, go to Networks > Routes and confirm that the IP routes through Cloudflare Tunnel.

1. In the dropdown menu, select the IP address and virtual network where the resource is located. This IP address and virtual network pairing is now assigned to this target and cannot be reused in another target by design.
2. Select Add target.

Make a POST request to the Infrastructure Access Targets endpoint:

Create new target ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/infrastructure/targets" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "hostname": "infra-access-target",    "ip": {        "ipv4": {            "ip_addr": "187.26.29.249",            "virtual_network_id": "c77b744e-acc8-428f-9257-6878c046ed55"        },        "ipv6": {            "ip_addr": "64c0:64e8:f0b4:8dbf:7104:72b0:ec8f:f5e0",            "virtual_network_id": "c77b744e-acc8-428f-9257-6878c046ed55"        }    }  }'
```

Provider versions

The following example requires Cloudflare provider version >=4.45.0.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Configure the cloudflare_zero_trust_infrastructure_access_target ‚Üó resource:
resource "cloudflare_zero_trust_infrastructure_access_target" "infra-ssh-target" {  account_id = var.cloudflare_account_id    hostname   = "infra-access-target"    ip = {      ipv4 = {        ip_addr = "187.26.29.249"        virtual_network_id = "c77b744e-acc8-428f-9257-6878c046ed55"      }      ipv6 = {        ip_addr = "64c0:64e8:f0b4:8dbf:7104:72b0:ec8f:f5e0"        virtual_network_id = "c77b744e-acc8-428f-9257-6878c046ed55"      }    }}

Next, create an Access application to secure the target.

## 3. Create a DNS record

To make your RDP targets (that is, your Windows machines) available through the browser, you will need a Cloudflare DNS record for the domain and subdomain that users will connect to. This domain will be used to access any targets that are available to users through your Access application (see Step 4).

For example, if want users to connect to targets on rdp.example.com, create a DNS record for rdp.example.com. You can create either an A, AAAA, or CNAME record:

A record

The following DNS record points your public subdomain (rdp) to an IPv4 address in the Class E address space ‚Üó.

- Type: A
- Name: rdp
- IPv4 address: 240.0.0.0
- Proxy status: On

AAAA record

The following DNS record points your public subdomain (rdp) to the IPv6 discard address range ‚Üó:

- Type: AAAA
- Name: rdp
- IPv6 address: 100::
- Proxy status: On

CNAME record

The following CNAME record points your public subdomain (rdp) to a fully qualified domain name.

- Type: CNAME
- Name: rdp
- Target: www.rdp.example.com
- Proxy status: On

The CNAME Target field is unrelated to the RDP targets configured in Step 2.

The DNS record does not need to point to an active destination IP address or hostname; the DNS record just needs to be valid. Cloudflare's RDP proxy will handle the routing to the correct RDP target.

## 4. Create an Access application

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Select Self-hosted.
4. Enter any name for the application.
5. In Session Duration, choose how often the user's application token should expire.
Cloudflare checks every HTTP request to your application for a valid application token. If the user's application token (and global token) has expired, they will be prompted to reauthenticate with the IdP. For more information, refer to Session management.

1. Select Add public hostname.
NoteBrowser-based RDP is only compatible with public hostnames. If you add a private hostname or IP, RDP functionality will not be available in this application.
2. In the Domain dropdown, select the domain that will represent the application. Domains must belong to an active zone in your Cloudflare account. You can use wildcards to protect multiple parts of an application that share a root path.
Alternatively, to use a Cloudflare for SaaS custom hostname, set Input method to Custom and enter your custom hostname.
NoteYou can only enable browser-based RDP on domains and subdomains, not for specific paths. The selected domain and subdomain must also have a corresponding DNS record (refer to Step 3).
3. Expand Browser rendering settings. In the Browser rendering dropdown, select RDP.
4. In Target criteria, select the target hostname(s) that define your RDP servers. The application definition will apply to all targets that share the selected target hostname, including any targets added in the future.
5. In Port, enter the RDP listening port ‚Üó of your server. It will likely be port 3389.
6. (Optional) If you run RDP on more than one port, select Add new target criteria and reconfigure the same target hostname(s) with the different port number.
7. Add Access policies to control who can connect to your application. All Access applications are deny by default -- a user must match an Allow policy before they are granted access.

Note

Ensure that only Allow or Block policies are present. Bypass and Service Auth are not supported for browser-rendered applications.

1. Configure how users will authenticate:
Select the Identity providers you want to enable for your application.(Recommended) If you plan to only allow access via a single IdP, turn on Instant Auth. End users will not be shown the Cloudflare Access login page. Instead, Cloudflare will redirect users directly to your SSO login event.  WARP authentication identity is not supported for browser-based RDP and should remain turned off.
2. Select the Identity providers you want to enable for your application.
3. (Recommended) If you plan to only allow access via a single IdP, turn on Instant Auth. End users will not be shown the Cloudflare Access login page. Instead, Cloudflare will redirect users directly to your SSO login event.
4. WARP authentication identity is not supported for browser-based RDP and should remain turned off.
5. Select Next.
6. (Recommended) Turn on Show application in App Launcher and configure App Launcher settings for the application. The App Launcher allows users to view the Windows servers that they can access using browser-based RDP. Without the App Launcher, users will need to know each target's direct URL.
NoteEnsure that users match an Allow rule in your App Launcher policies.
7. Under Block page, choose what end users will see when they are denied access to the application:

Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
Redirect URL: Redirect to the specified website.
Custom page template: Display a custom block page hosted in Zero Trust.
8. Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
9. Redirect URL: Redirect to the specified website.
10. Custom page template: Display a custom block page hosted in Zero Trust.
11. Select Next.
12. (Optional) Configure advanced settings:

Cross-Origin Resource Sharing (CORS) settings
Cookie settings
401 Response for Service Auth policies: Return a 401 response code when a user (or machine) makes a request to the application without the correct service token.
13. Cross-Origin Resource Sharing (CORS) settings
14. Cookie settings
15. 401 Response for Service Auth policies: Return a 401 response code when a user (or machine) makes a request to the application without the correct service token.
16. Select Save.

## 5. (Recommended) Modify order of precedence in Gateway

By default, Cloudflare will evaluate Access application policies after evaluating all Gateway network policies. To evaluate Access applications before or after specific Gateway policies:

1. Create the following Gateway network policy:
















SelectorOperatorValueActionAccess Infrastructure TargetisPresentAllow
2. Ensure that Enforce WARP client session duration is turned off, otherwise users will be blocked from accessing RDP targets.
3. Update the policy's order of precedence using the dashboard or API.

This Gateway policy will apply to all Access for Infrastructure targets, including RDP and SSH.

Note

Users must pass the policies in your Access application before they are granted access. The Gateway Allow policy is strictly for routing and connectivity purposes.

## 6. Connect as a user

To connect to a Windows machine over RDP:

1. Open a browser and go to your App Launcher URL:
https://<your-team-name>.cloudflareaccess.com
Replace <your-team-name> with your Zero Trust team name.
2. Follow the prompts to log in to your identity provider.
Once you have authenticated, the App Launcher will display tiles showing the applications that you are authorized to use. Windows servers (targets) available through browser-based RDP will also appear as tiles. If a target is reachable through multiple Access applications, the target will have a tile per Access application.
3. Select the target you want to connect to.
The App Launcher tile will launch a URL of the form https://<app-domain>/rdp/<vnet-id>/<target-ip>/<port>. You may also navigate directly to this URL.
Virtual network IDvnet-id refers to the virtual network (VNET) that the RDP target is assigned to in your Cloudflare Tunnel configuration. If you did not specify a VNET when routing the target through Cloudflare Tunnel, the target is automatically added to the default VNET.To fetch a list of all VNETs and their IDs, make a GET request to the List Virtual Networks endpoint. The default VNET will have the parameter "is_default_network": true.
4. Select the port that you want to connect to. The port selection screen only appears if the Access application allows RDP traffic on multiple ports (for example, port 3389 and port 65321).
5. (Optional) In your browser settings, allow the Access application to access the clipboard. Clipboard permissions grant the ability to copy or paste text between the local machine and the remote Windows machine.
6. Enter your Windows username and password. For more information on how to format your username, refer to User identifier formats.

You now have access to the remote Windows desktop.

## Compatibility

### RDP server operating systems

Browser-based RDP supports connecting to Windows machines that run the following operating systems:

- Windows 11 Pro
- Windows 11 Enterprise
- Windows 10 Pro
- Windows 10 Enterprise
- Windows Server 2025
- Windows Server 2022
- Windows Server 2019
- Windows Server 2016

### Browsers

| Browser | Compatibility |
| --- | --- |
| Google Chrome | ‚úÖ |
| Mozilla Firefox | ‚úÖ |
| Safari | ‚ùå |
| Microsoft Edge (Chromium-based) | ‚úÖ |
| Other Chromium-based browsers (Opera, Brave) | ‚úÖ |
| Internet Explorer 11 and below | ‚ùå |

### Powershell

Run Powershell 7 or higher to mitigate a prior Microsoft issue where keystrokes are not recorded.

### User identifier formats

Browser-based RDP supports connecting to Windows machines using the following login credentials:

#### Security Account Manager (SAM)

SAM-formatted user identifiers are supported with and without spaces.

Examples:

- DOMAIN\username
- DOMAIN\username with spaces
- .\username
- .\username with spaces
- username
- username with spaces

Character limits

Identifiers which specify a domain, such as DOMAIN\username, can have a maximum of 20 characters for the domain and 15 characters for the username.

Identifiers without a domain, such as .\username, will use the default domain. The username can have a maximum of 20 characters.

#### User Principal Name (UPN)

UPN-formatted user identifiers are supported with spaces, with and without quotes.

Examples:

- "username with spaces"@domain.org
- username with spaces@domain.org
- username@domain.org

Note

Cloudflare will not configure user identifiers on the RDP target. Any user identifier used to authenticate must be pre-configured on the server.

#### Microsoft Entra ID

User identifiers that are bound to Microsoft Entra ID domains must enter their username as AzureAD\user@example.com or AzureAD\user. The AzureAD\ prefix is case-insensitive.
The login flow differs slightly when using an Microsoft Entra ID-bound username:

1. Enter your username in one of the formats outlined above.
2. Once the username is entered, the password box will disappear and the RDP connection will initiate.
3. The RDP server will then prompt for the password before granting access to the RDP server.

### Cloudflare products

When using Access self-hosted applications, the majority of Cloudflare products will be compatible with your application.

However, the following products are not supported:

- Automatic Signed Exchanges
- Automatic Platform Optimization
- Zaraz

You can disable Automatic Signed Exchanges and Zaraz for a specific application - instead of across your entire zone - using a Configuration Rule scoped to the application domain.

## Known limitations

- TLS certificate verification: Cloudflare uses TLS to connect to the RDP target but does not verify the origin TLS certificate.
- WARP authentication: Since browser-based RDP traffic does not go through the WARP client, users cannot use their WARP session identity to authenticate.
- Audio over RDP: Users cannot use their microphone and speaker to interact with the remote machine.
- Clipboard size limit: Data copied between the local machine and the browser-based RDP session may not exceed 500 KB.
- Clipboard controls: Admins do not have the ability to restrict copy/paste actions between the remote machine and the user's local clipboard.
- File transfers: Users cannot copy/paste files from their local machine to the remote machine and vice versa.
- Print to local printer: Users cannot print information from their browser-based RDP session to a printer in their local network.
- Network Level Authentication for Entra-joined accounts: Browser-based RDP does not support PKU2U authentication which is required for Network Level Authentication (NLA) ‚Üó with Entra-joined accounts. Connecting to Entra-joined accounts requires disabling enforcement of NLA on the remote Windows machine. You can disable NLA from Settings > System > Remote Desktop, or use the Local Group Policy Editor to disable Require user authentication for remote connections by using Network Level Authentication.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect to RDP using WARP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/rdp/rdp-warp-to-tunnel/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/rdp/rdp-warp-to-tunnel/)

Page options # Connect to RDP using WARP

Cloudflare WARP to Tunnel allows users to connect to RDP servers using their preferred RDP client. Cloudflare Tunnel creates a secure, outbound-only connection from your RDP server to Cloudflare's global network; this requires running the cloudflared daemon on the server (or any other host machine within the private network). Users install the Cloudflare WARP client on their device and enroll in your Zero Trust organization. Remote devices will be able to connect as if they were on your private network. By default, all devices enrolled in your organization can connect to the RDP server unless you build policies to allow or block specific users.

This example walks through how to set up an RDP server on a Google Cloud Platform (GCP) virtual machine (VM), but you can use any machine that supports RDP connections.

## 1. Set up an RDP server in GCP

1. In your Google Cloud Console ‚Üó, create a new project ‚Üó.
2. Go to Compute Engine > VM instances.
3. Select Create instance.
4. Name your VM instance, for example windows-rdp-server.
5. Configure your VM instance:

Scroll down to Boot Disk and select Change.
For Operating system, select Windows Server.
Choose a Version with Desktop Experience, for example Windows Server 2016 Datacenter.
6. Scroll down to Boot Disk and select Change.
7. For Operating system, select Windows Server.
8. Choose a Version with Desktop Experience, for example Windows Server 2016 Datacenter.
9. Once your VM is running, open the dropdown next to RDP and select View gcloud command to reset password.
10. Select Run in Cloud Shell.
11. Run the command in the Cloud Shell terminal. You will be asked to confirm the password reset.
12. Copy the auto-generated password and username to a safe place.

## 2. Install Microsoft Remote Desktop

You can use any RDP client to access and configure the RDP server.

To access the server through Microsoft Remote Desktop:

1. Download and install Microsoft Remote Desktop ‚Üó.
2. Once downloaded, open Microsoft Remote Desktop and select Add a PC.
3. For PC name, enter the public IP address of your RDP server. In GCP, this is the External IP of the VM instance.
4. For User account, select Add User Account and enter your auto-generated password and username.
5. Select Add. The PC will display in Microsoft Remote Desktop.
6. To test basic connectivity, double-click the newly added PC.
7. When asked if you want to continue, select Continue.

You can now remotely access the RDP server using its public IP. The next steps will configure access to the server using its private IP.

Note

By default, Internet Explorer will be installed and configured in Enhanced Security mode ‚Üó. If the browser is slow or unable to load, you can turn off Enhanced Security and install an alternate browser such as Google Chrome.

## 3. Connect the server to Cloudflare

1. Create a Cloudflare Tunnel for your server by following our dashboard setup guide. You can skip the connect an application step and go straight to connecting a network.

1. In the Private Networks tab for the tunnel, enter the private IP or CIDR address of your server. In GCP, the server IP is the Internal IP of the VM instance.
2. (Optional) Set up Zero Trust policies to fine-tune access to your server.

## 4. Set up the client

To connect your devices to Cloudflare:

1. Deploy the WARP client on your devices in Gateway with WARP mode or generate a proxy endpoint and deploy a PAC file.
2. Create device enrollment rules to determine which devices can enroll to your Zero Trust organization.

## 5. Route private network IPs through WARP

By default, WARP excludes traffic bound for RFC 1918 space ‚Üó, which are IP addresses typically used in private networks and not reachable from the Internet. In order for WARP to send traffic to your private network, you must configure Split Tunnels so that the IP/CIDR of your private network routes through WARP.

1. First, check whether your Split Tunnels mode is set to Exclude or Include mode.
2. If you are using Include mode, add your private network's IP/CIDR range to the list. Your list should also include the domains necessary for Cloudflare Zero Trust functionality.
3. If you are using Exclude mode:
a. Delete your private network's IP/CIDR range from the list. For example, if your network uses the default AWS range of 172.31.0.0/16, delete 172.16.0.0/12.
b. Re-add IP/CIDR ranges that are not explicitly used by your private network. For the AWS example above, you would add new entries for 172.16.0.0/13, 172.24.0.0/14, 172.28.0.0/15, and 172.30.0.0/16. This ensures that only traffic to 172.31.0.0/16 routes through WARP.
You can use the following calculator to determine which IP addresses to re-add:
Base CIDR: Excluded CIDRs: Calculate
In Base CIDR, enter the RFC 1918 range that you deleted from Split Tunnels. In Excluded CIDRs, enter the IP/CIDR range used by your private network. Re-add the calculator results to your Split Tunnel Exclude mode list.

By tightening the private IP range included in WARP, you reduce the risk of breaking a user's access to local resources.

## 6. Connect as a user

Once the WARP client is configured, you can use your RDP client to connect to the server's private IP address (instead of the public IP address used initially).

To connect in Microsoft Remote Desktop:

1. Open Microsoft Remote Desktop and select Add a PC.
2. For PC name, enter the private IP address of your RDP server. In GCP, this is the Internal IP of the VM instance.
3. For User account, enter your RDP server username and password.
4. To test Zero Trust connectivity, double-click the newly added PC.
5. When asked if you want to continue, select Continue.

You now have secure, remote access to the RDP server.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect to RDP with client-side cloudflared

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/rdp/rdp-cloudflared-authentication/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/rdp/rdp-cloudflared-authentication/)

Page options # Connect to RDP with client-side cloudflared

End users can connect to an RDP server without the WARP client by authenticating through cloudflared in their native terminal. This method requires having cloudflared installed on both the server machine and on the client machine, as well as an active zone on Cloudflare. The traffic is proxied over this connection, and the user logs in to the server with their Cloudflare Access credentials.

Client-side cloudflared can be used in conjunction with routing over WARP and Browser-based RDP so that there are multiple ways to connect to the server. You can reuse the same Cloudflare Tunnel when configuring each connection method.

## 1. Connect the server to Cloudflare

1. Create a Cloudflare Tunnel by following our dashboard setup guide.
2. In the Public Hostnames tab, choose a domain from the drop-down menu and specify any subdomain (for example, rdp.example.com).
3. For Service, select RDP and enter the RDP listening port ‚Üó of your server (for example, localhost:3389). It will likely be port 3389.
4. Select Save hostname.

## 2. (Recommended) Create an Access application

By default, anyone on the Internet can connect to the server using its public hostname. To allow or block specific users, create a self-hosted application in Cloudflare Access.

## 3. Connect as a user

1. Install cloudflared on the client machine.
2. Run this command to open an RDP listening port:
Terminal windowcloudflared access rdp --hostname rdp.example.com --url rdp://localhost:3389
This process will need to be configured to stay alive and autostart. If the process is killed, users will not be able to connect.

Note

If the client machine is running Windows, port 3389 may already be consumed locally. Select an alternative port to 3389 that is not being used.

1. While cloudflared access is running, connect from an RDP client such as Microsoft Remote Desktop:

Open Microsoft Remote Desktop and select Add a PC.
For PC name, enter localhost:3389.
For User account, enter your RDP server username and password.
Double-click the newly added PC.
When asked if you want to continue, select Continue.
2. Open Microsoft Remote Desktop and select Add a PC.
3. For PC name, enter localhost:3389.
4. For User account, enter your RDP server username and password.
5. Double-click the newly added PC.
6. When asked if you want to continue, select Continue.

When the client launches, a browser window will open and prompt the user to authenticate with Cloudflare Access.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SMB

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/smb/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/smb/)

Page options # SMB

The Server Message Block (SMB) protocol allows users to read, write, and access shared resources on a network. Due to security risks, firewalls and ISPs usually block public connections to an SMB file share. With Cloudflare Tunnel, you can provide secure and simple SMB access to users outside of your network.

Cloudflare Zero Trust offers two solutions for connecting to SMB servers:

- Private subnet routing with Cloudflare WARP to Tunnel
- Public hostname routing with cloudflared access

## Set up an SMB server on Linux

While SMB was developed for Microsoft Windows, Samba provides SMB connectivity from UNIX-like and BSD systems. A Samba server can be set up using this guide ‚Üó on an Ubuntu machine.

## Connect to SMB server with WARP to Tunnel

You can use Cloudflare Tunnel to create a secure, outbound-only connection from your server to Cloudflare's global network. This requires running the cloudflared daemon on the server. Users reach the service by installing the Cloudflare WARP client on their device and enrolling in your Zero Trust organization. Remote devices will be able to connect as if they were on your private network. By default, all devices enrolled in your organization can access the service unless you build policies to allow or block specific users.

### 1. Connect the server to Cloudflare

1. Create a Cloudflare Tunnel for your server by following our dashboard setup guide. You can skip the connect an application step and go straight to connecting a network.

1. In the Private Networks tab for the tunnel, enter the private IP or CIDR address of your server.
2. (Optional) Set up Zero Trust policies to fine-tune access to your server.

### 2. Set up the client

To connect your devices to Cloudflare:

1. Deploy the WARP client on your devices in Gateway with WARP mode or generate a proxy endpoint and deploy a PAC file.
2. Create device enrollment rules to determine which devices can enroll to your Zero Trust organization.

### 3. Route private network IPs through WARP

By default, WARP excludes traffic bound for RFC 1918 space ‚Üó, which are IP addresses typically used in private networks and not reachable from the Internet. In order for WARP to send traffic to your private network, you must configure Split Tunnels so that the IP/CIDR of your private network routes through WARP.

1. First, check whether your Split Tunnels mode is set to Exclude or Include mode.
2. If you are using Include mode, add your private network's IP/CIDR range to the list. Your list should also include the domains necessary for Cloudflare Zero Trust functionality.
3. If you are using Exclude mode:
a. Delete your private network's IP/CIDR range from the list. For example, if your network uses the default AWS range of 172.31.0.0/16, delete 172.16.0.0/12.
b. Re-add IP/CIDR ranges that are not explicitly used by your private network. For the AWS example above, you would add new entries for 172.16.0.0/13, 172.24.0.0/14, 172.28.0.0/15, and 172.30.0.0/16. This ensures that only traffic to 172.31.0.0/16 routes through WARP.
You can use the following calculator to determine which IP addresses to re-add:
Base CIDR: Excluded CIDRs: Calculate
In Base CIDR, enter the RFC 1918 range that you deleted from Split Tunnels. In Excluded CIDRs, enter the IP/CIDR range used by your private network. Re-add the calculator results to your Split Tunnel Exclude mode list.

By tightening the private IP range included in WARP, you reduce the risk of breaking a user's access to local resources.

### 4. Connect as a user

#### macOS

1. In the Finder menu, select Go > Connect to Server.
2. Enter smb://<smb-server-ip-address>/sambashare.
3. Sign in with the username and password created while setting up the server.

#### Windows

1. Open File Explorer and right-click Network > Map Network Drive.
2. For Folder, enter \\<server-private-ip>\sambashare.
3. Select Connect using different credentials.
4. Select Finish.
5. Sign in with the username and password created while setting up the server.

## Connect to SMB server with cloudflared access

Cloudflare Tunnel can also route applications through a public hostname, which allows users to connect to the application without the WARP client. This method requires having cloudflared installed on both the server machine and on the client machine, as well as an active zone on Cloudflare. The traffic is proxied over this connection, and the user logs in to the server with their Cloudflare Access credentials.

The public hostname method can be implemented in conjunction with routing over WARP so that there are multiple ways to connect to the server. You can reuse the same tunnel for both the private network and public hostname routes.

### 1. Connect the server to Cloudflare

1. Create a Cloudflare Tunnel by following our dashboard setup guide.
2. In the Public Hostnames tab, choose a domain from the drop-down menu and specify any subdomain (for example, smb.example.com).
3. For Service, select TCP and enter the SMB listening port (for example, localhost:445). SMB drives listen on port 139 or 445 by default.
4. Select Save hostname.
5. (Recommended) Add a self-hosted application to Cloudflare Access in order to manage access to your server.

### 2. Connect as a user

1. Install cloudflared on the client machine.
2. Run the following command to open an SMB listening port. You can specify any available port on the client machine.
Terminal windowcloudflared access tcp --hostname smb.example.com --url localhost:8445
This command can be wrapped as a desktop shortcut so that end users do not need to use the command line.
3. Open your SMB client and configure the client to point to smb://localhost:8445/sambashare. Do not input the hostname.
4. Sign in with the username and password created while setting up the server.

#### Windows-specific requirements

If you are using a Windows machine and cannot specify the port for SMB, you might need to disable the local server. The local server on a client machine uses the same default port 445 for CIFS/SMB. By listening on that port, the local server can block the cloudflare access connection.

Warning

The Windows Server service supports share actions over a network like file, print, and named-pipe. Disabling this service can cause those actions to fail to start.

To disable the local server on a Windows machine:

1. Select Win+R to open the Run window.
2. Type services.msc and select Enter.
3. Locate the local server process, likely called Server.
4. Stop the service and set Startup type to Disabled.
5. Repeat steps 3 and 4 for TCP/IP NetBIOS Helper.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## gRPC

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/grpc/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/use-cases/grpc/)

Page options # gRPC

gRPC is a Remote Procedure Call (RPC) framework that allows client applications to call methods on a remote server as if they were running on the same local machine. You can connect gRPC servers and clients to Cloudflare's global network, making it easier to build applications that use services across different data centers and environments.

Cloudflare Tunnel supports gRPC traffic via private subnet routing. Public hostname deployments are not currently supported.

In this example, we will connect a gRPC server to Cloudflare using the
cloudflared daemon, secure
the server with Gateway policies, and open a gRPC channel to the server using
the Cloudflare WARP client.

## 1. Set up a gRPC server

1. To set up a gRPC Python application, follow this quick start guide ‚Üó.
2. Start the server:

Terminal window ```
~/grpc/examples/python/helloworld $ python3 greeter_server.pyWARNING: All log messages before absl::InitializeLog() is called are written to STDERRI0000 00:00:1721770418.373806    3677 config.cc:230] gRPC experiments enabled: call_status_override_on_cancellation, event_engine_dns, event_engine_listener, http2_stats_fix, monitoring_experiment, pick_first_new, trace_record_callops, work_serializer_clears_time_cacheServer started, listening on 50051
```

## 2. Connect the server to Cloudflare

To establish a secure, outbound-only connection to Cloudflare:

1. Create a Cloudflare Tunnel for your server by following our dashboard setup guide. You can skip the connect an application step and go straight to connecting a network.

1. In the Private Networks tab for the tunnel, enter the private IP or CIDR address of your server.

## 3. Route private network IPs through WARP

By default, WARP excludes traffic bound for RFC 1918 space ‚Üó, which are IP addresses typically used in private networks and not reachable from the Internet. In order for WARP to send traffic to your private network, you must configure Split Tunnels so that the IP/CIDR of your private network routes through WARP.

1. First, check whether your Split Tunnels mode is set to Exclude or Include mode.
2. If you are using Include mode, add your private network's IP/CIDR range to the list. Your list should also include the domains necessary for Cloudflare Zero Trust functionality.
3. If you are using Exclude mode:
a. Delete your private network's IP/CIDR range from the list. For example, if your network uses the default AWS range of 172.31.0.0/16, delete 172.16.0.0/12.
b. Re-add IP/CIDR ranges that are not explicitly used by your private network. For the AWS example above, you would add new entries for 172.16.0.0/13, 172.24.0.0/14, 172.28.0.0/15, and 172.30.0.0/16. This ensures that only traffic to 172.31.0.0/16 routes through WARP.
You can use the following calculator to determine which IP addresses to re-add:
Base CIDR: Excluded CIDRs: Calculate
In Base CIDR, enter the RFC 1918 range that you deleted from Split Tunnels. In Excluded CIDRs, enter the IP/CIDR range used by your private network. Re-add the calculator results to your Split Tunnel Exclude mode list.

By tightening the private IP range included in WARP, you reduce the risk of breaking a user's access to local resources.

## 4. (Recommended) Create a Gateway policy

You can configure Gateway network policies to either block or allow access to the gRPC server. The following example consists of two policies: the first allows gRPC connections from devices that pass device posture checks, and the second blocks all other traffic. Make sure that the Allow policy has higher priority.

### 1. Allow secured devices

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Destination Port | is | 50051 | And | Allow |
| Destination IP | is | 172.31.0.133 | And |  |
| Passed Device Posture Checks | is | macOS firewall (Firewall) | And |  |
| Passed Device Posture Checks | is | macOS disk encryption (Disk encryption) |  |  |

### 2. Block everything else

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Destination IP | in | 172.31.0.0/16 | Block |

For more details on setting up the Gateway proxy, refer to Filter network traffic with Gateway.

## 5. Set up the client

gRPC clients can connect to the server by installing Cloudflare WARP on the device and enrolling in your Zero Trust organization. When the client makes a request to a private IP exposed through Cloudflare Tunnel, WARP routes the connection through Cloudflare's network to the corresponding tunnel.

To set up the gRPC client:

1. Deploy the WARP client on your device in Gateway with WARP mode.
2. Create device enrollment rules to determine which devices can enroll to your Zero Trust organization.
3. Install gRPC on the device by following this quick start guide ‚Üó.
4. Modify greeter.py to point to the private IP of your gRPC server. This is the same private IP configured in your Cloudflare Tunnel routes. For example,

```
def run():    # NOTE(gRPC Python Team): .close() is possible on a channel and should be    # used in circumstances in which the with statement does not fit the needs    # of the code.    print("Will try to greet world ...")    with grpc.insecure_channel("172.31.0.133:50051") as channel:        stub = helloworld_pb2_grpc.GreeterStub(channel)        response = stub.SayHello(helloworld_pb2.HelloRequest(name="you"))    print("Greeter client received: " + response.message)
```

## 6. Test the connection

1. On the client device, ensure that WARP is Connected.
2. Run the gRPC client application:

Terminal window ```
~/grpc/examples/python/helloworld $ python3 greeter_client.pyWill try to greet world ...WARNING: All log messages before absl::InitializeLog() is called are written to STDERRI0000 00:00:1721771484.489711 4414247 config.cc:230] gRPC experiments enabled: call_status_override_on_cancellation, event_engine_dns, event_engine_listener, http2_stats_fix, monitoring_experiment, pick_first_new, trace_record_callops, work_serializer_clears_time_cacheGreeter client received: Hello, you!
```

You can view Tunnel logs to validate that requests are coming into the tunnel and reaching the gRPC server as intended.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Environments

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/)

Page options # Environments

Learn how to deploy Cloudflare Tunnel in specific environments:

- Ansible
- AWS
- Azure
- GCP
- Kubernetes
- Terraform

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Ansible

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/ansible/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/ansible/)

Page options # Ansible

Ansible is a software tool that enables at scale management of infrastructure. Ansible is agentless ‚Äî all it needs to function is the ability to SSH to the target and Python installed on the target.

Ansible works alongside Terraform to streamline the Cloudflare Tunnel setup process. In this guide, you will use Terraform to deploy an SSH server on Google Cloud and create a locally-managed tunnel that makes the server available over the Internet. Terraform will automatically run an Ansible playbook that installs and configures cloudflared on the server.

## Prerequisites

To complete the steps in this guide, you will need:

- A Google Cloud Project ‚Üó and GCP CLI installed and authenticated ‚Üó.
- Basic knowledge of Terraform and Terraform installed ‚Üó.
- A zone on Cloudflare.
- A Cloudflare API token with Cloudflare Tunnel and DNS permissions.

## 1. Install Ansible

Refer to the Ansible installation instructions ‚Üó.

## 2. (Optional) Create an SSH key pair

Terraform and Ansible require an unencrypted SSH key to connect to the GCP server. If you do not already have a key, you can generate one as follows:

1. Open a terminal and type the following command:
Terminal windowssh-keygen -t rsa -f ~/.ssh/gcp_ssh -C <username in GCP>
2. When prompted for a passphrase, press the Enter key twice to leave it blank. Terraform cannot decode encrypted private keys.

Two files will be generated: gcp_ssh which contains the private key, and gcp_ssh.pub which contains the public key.

## 3. Create a configuration directory

1. Create a folder for your Terraform and Ansible configuration files:
Terminal windowmkdir ansible-tunnel
2. Change to the new directory:
Terminal windowcd ansible-tunnel

## 4. Create Terraform configuration files

### Define input variables

The following variables will be passed into your GCP and Cloudflare configuration.

1. In your configuration directory, create a .tf file:
Terminal windowtouch variables.tf
2. Open the file in a text editor and copy and paste the following:
# GCP variablesvariable "gcp_project_id" {  description = "Google Cloud Platform (GCP) project ID"  type        = string}
variable "zone" {  description = "Geographical zone for the GCP VM instance"  type        = string}
variable "machine_type" {  description = "Machine type for the GCP VM instance"  type        = string}
# Cloudflare variablesvariable "cloudflare_zone" {  description = "Domain used to expose the GCP VM instance to the Internet"  type        = string}
variable "cloudflare_zone_id" {  description = "Zone ID for your domain"  type        = string}
variable "cloudflare_account_id" {  description = "Account ID for your Cloudflare account"  type        = string  sensitive   = true}
variable "cloudflare_email" {  description = "Email address for your Cloudflare account"  type        = string  sensitive   = true}
variable "cloudflare_token" {  description = "Cloudflare API token"  type        = string  sensitive   = true}

### Assign values to the variables

1. In your configuration directory, create a .tfvars file:
Terminal windowtouch terraform.tfvars
Terraform will automatically use these variables if the file is named terraform.tfvars, otherwise the variable file will need to be manually passed in.
2. Add the following variables to terraform.tfvars. Be sure to modify the example with your own values.
cloudflare_zone           = "example.com"cloudflare_zone_id        = "023e105f4ecef8ad9ca31a8372d0c353"cloudflare_account_id     = "372e67954025e0ba6aaa6d586b9e0b59"cloudflare_email          = "user@example.com"cloudflare_token          = "y3AalHS_E7Vabk3c3lX950F90_Xl7YtjSlzyFn_X"gcp_project_id            = "testvm-123"zone                      = "us-central1-a"machine_type              = "e2-medium"

Warning

To prevent accidentally exposing sensitive credentials, do not save terraform.tfvars in your version control system. For example, if your version control is git, add terraform.tfvars to your .gitignore file.

### Configure Terraform providers

You will need to declare the providers ‚Üó used to provision the infrastructure.

1. In your configuration directory, create a .tf file:
Terminal windowtouch providers.tf
2. Add the following providers to providers.tf. The random provider is used to generate a tunnel secret.
terraform {  required_providers {    cloudflare = {      source = "cloudflare/cloudflare"      version = ">= 5.8.2"    }    google = {      source = "hashicorp/google"    }  }  required_version = ">= 1.2"}
# Providersprovider "cloudflare" {  api_token    = var.cloudflare_token}provider "google" {  project    = var.gcp_project_id}provider "random" {}

### Configure Cloudflare resources

The following configuration will modify settings in your Cloudflare account.

1. In your configuration directory, create a .tf file:
Terminal windowtouch Cloudflare-config.tf
2. Add the following resources to Cloudflare-config.tf:
# Creates a new remotely-managed tunnel for the GCP VM.resource "cloudflare_zero_trust_tunnel_cloudflared" "gcp_tunnel" {  account_id    = var.cloudflare_account_id  name          = "Ansible GCP tunnel"  config_src    = "cloudflare"}
# Reads the token used to run the tunnel on the server.data "cloudflare_zero_trust_tunnel_cloudflared_token" "gcp_tunnel_token" {  account_id   = var.cloudflare_account_id  tunnel_id   = cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.id}
# Creates the CNAME record that routes http_app.${var.cloudflare_zone} to the tunnel.resource "cloudflare_dns_record" "http_app" {  zone_id = var.cloudflare_zone_id  name    = "http_app"  content = "${cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.id}.cfargotunnel.com"  type    = "CNAME"  ttl     = 1  proxied = true}
# Configures tunnel with a public hostname route for clientless access.resource "cloudflare_zero_trust_tunnel_cloudflared_config" "gcp_tunnel_config" {  tunnel_id  = cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.id  account_id = var.cloudflare_account_id  config     = {    ingress   = [      {        hostname = "http_app.${var.cloudflare_zone}"        service  = "http://localhost:80"      },      {        service  = "http_status:404"      }    ]  }}

### Configure GCP resources

The following configuration defines the specifications for the GCP virtual machine and installs Python3 on the machine. Python3 allows Ansible to configure the GCP instance instead of having to run a startup script on boot.

1. In your configuration directory, create a .tf file:
Terminal windowtouch GCP-config.tf
2. Open the file in a text editor and copy and paste the following example. Be sure to insert your own GCP username and SSH key pair.
# Selects the OS for the GCP VM.data "google_compute_image" "image" {family  = "ubuntu-2204-lts"project = "ubuntu-os-cloud"}
# Sets up a GCP VM instance.resource "google_compute_instance" "http_server" {name         = "ansible-inst"machine_type = var.machine_typezone         = var.zonetags         = []boot_disk {    initialize_params {    image = data.google_compute_image.image.self_link    }}network_interface {    network = "default"    access_config {    // Ephemeral IP    }}scheduling {    preemptible = true    automatic_restart = false}
// Installs Python3 on the VM.provisioner "remote-exec" {    inline = [    "sudo apt update", "sudo apt install python3 -y",  "echo Done!"    ]    connection {    host = self.network_interface.0.access_config.0.nat_ip    user = "<username in GCP>"    type = "ssh"    private_key= file("<path to private key>")    }}provisioner "local-exec" {    // If specifying an SSH key and user, add `--private-key <path to private key> -u var.name`    command = "ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook -u <username in GCP> --private-key <path to private key> -i ${self.network_interface.0.access_config.0.nat_ip}, playbook.yml"}
metadata = {    cf-email     = var.cloudflare_email    cf-zone      = var.cloudflare_zone    ssh-keys     = "<username in GCP>:${file("<path to public key>")}"}depends_on = [    local_file.tf_ansible_vars_file]}

### Export variables to Ansible

The following Terraform resource exports the tunnel token and other variables to tf_ansible_vars_file.yml. Ansible will use the tunnel token to configure and run cloudflared on the server.

1. In your configuration directory, create a new tf file:
Terminal windowtouch export.tf
2. Copy and paste the following content into export.tf:
resource "local_file" "tf_ansible_vars_file" {  content = <<-DOC    # Ansible vars_file containing variable values from Terraform.    tunnel_id: ${cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.id}    tunnel_name: ${cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.name}    tunnel_token: ${data.cloudflare_zero_trust_tunnel_cloudflared_token.gcp_tunnel_token.token}    DOC
  filename = "./tf_ansible_vars_file.yml"}

## 5. Create the Ansible playbook

Ansible playbooks are YAML files that declare the configuration Ansible will deploy.

1. Create a new .yml file:
Terminal windowtouch playbook.yml
2. Open the file in a text editor and copy and paste the following content:

```
---- hosts: all  become: yes  # Import tunnel variables into the VM.  vars_files:    - ./tf_ansible_vars_file.yml  # Execute the following commands on the VM.  tasks:    - name: Download the cloudflared Linux package.      shell: wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb    - name: Depackage cloudflared.      shell: sudo dpkg -i cloudflared-linux-amd64.deb    - name: Install the tunnel as a systemd service.      shell: "cloudflared service install {{ tunnel_token }}"    - name: Start the tunnel.      systemd:        name: cloudflared        state: started        enabled: true        masked: no    - name: Deploy an example Apache web server on port 80.      shell: apt update && apt -y install apache2    - name: Edit the default Apache index file.      copy:        dest: /var/www/html/index.html        content: |          <!DOCTYPE html>          <html>          <body>            <h1>Hello Cloudflare!</h1>            <p>This page was created for a Cloudflare demo.</p>          </body>          </html>
```

Keywords ‚Üó define how Ansible will execute the configuration. In the example above, the vars_files keyword specifies where variable definitions are stored, and the tasks keyword specifies the actions Ansible will perform.

Modules ‚Üó specify what tasks to complete. In this example, the copy module creates a file and populates it with content.

## 6. Deploy the configuration

Once you have created the configuration files, you can deploy them through Terraform. The Ansible deployment happens within the Terraform deployment when the ansible-playbook command is run.

1. Initialize your configuration directory:
Terminal windowterraform init
2. (Optional) Preview everything that will be created:
Terminal windowterraform plan
3. Deploy the configuration:
Terminal windowterraform apply

It may take several minutes for the GCP instance and tunnel to come online. You can view your new tunnel in Zero Trust ‚Üó under Networks > Tunnels.

## 7. Test the connection

To test, open a browser and go to http://http_app.<CLOUDFLARE_ZONE>.com (for example, http_app.example.com). You should see the Hello Cloudflare! test page.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## AWS

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/aws/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/aws/)

Page options # AWS

This guide covers how to connect an Amazon Web Services (AWS) virtual machine to Cloudflare using our lightweight connector, cloudflared.

We will deploy:

- An EC2 virtual machine that runs a basic HTTP server.
- A Cloudflare Tunnel that allows users to connect to the service via either a public hostname or a private IP address.

### Prerequisites

To complete the following procedure, you will need to:

- Add a website to Cloudflare
- Deploy the WARP client on an end-user device

## 1. Create a VM instance in AWS

1. From the AWS console, go to Compute > EC2 > Instances
2. Select Launch instance.
3. Name your VM instance. In this example we will name it http-test-server.
4. For *Amazon Machine Image (AMI) choose your desired operating system and specifications. For this example, we will use Ubuntu Server 24.04 LTS (HVM), SSD Volume Type.
5. For Instance type:, you can select t2.micro which is available on the free tier.
6. In Key pair (login), create a new key pair to use for SSH. You will need to download the .pem file onto your local machine.
7. In Network settings, select Create security group.
8. Turn on the following Security Group rules:

Allow SSH traffic from My IP to prevent the instance from being publicly accessible.
Allow HTTPS traffic from the internet
Allow HTTP traffic from the internet
9. Allow SSH traffic from My IP to prevent the instance from being publicly accessible.
10. Allow HTTPS traffic from the internet
11. Allow HTTP traffic from the internet
12. Select Launch instance.
13. Once the instance is up and running, go to the Instances summary page and copy its Public IPv4 DNS hostname (for example, ec2-44-202-59-16.compute-1.amazonaws.com).
14. To log in to the instance over SSH, open a terminal and run the following commands:

Terminal window ```
cd Downloads
```

```
chmod 400 "YourKeyPair.pem"
```

Terminal window ```
ssh -i "YourKeyPair.pem" ubuntu@ec2-44-202-59-16.compute-1.amazonaws.com
```

1. Run sudo su to gain full admin rights to the instance.
2. For testing purposes, you can deploy a basic Apache web server on port 80:

Terminal window ```
$ apt update
$ apt -y install apache2
$ cat <<EOF > /var/www/html/index.html<html><body><h1>Hello Cloudflare!</h1><p>This page was created for a Cloudflare demo.</p></body></html>EOF
```

1. To verify that the Apache server is running, open a browser and go to http://ec2-44-202-59-16.compute-1.amazonaws.com (make sure to connect over http, not https). You should see the Hello Cloudflare! test page.

## 2. Create a Cloudflare Tunnel

Next, we will create a Cloudflare Tunnel in Zero Trust and run the tunnel on the AWS instance.

1. Log in to Zero Trust ‚Üó and go to Networks > Tunnels.
2. Select Create a tunnel.
3. Choose Cloudflared for the connector type and select Next.
4. Enter a name for your tunnel (for example, aws-tunnel).
5. Select Save tunnel.
6. Under Choose your environment, select Debian. Copy the command shown in the dashboard and run it on your AWS instance.
7. Once the command has finished running, your connector will appear in Zero Trust.
8. Select Next.

## 3. Connect using a public hostname

Public hostname routes allow anyone on the Internet to connect to HTTP resources hosted on your virtual private cloud (VPC). To add a public hostname route for your Cloudflare Tunnel:

1. In the Public Hostname tab, enter a hostname for the application (for example, hellocloudflare.<your-domain>.com).
2. Under Service, enter http://localhost:80.
3. Select Save hostname.
4. To test, open a browser and go to http://hellocloudflare.<your-domain>.com. You should see the Hello Cloudflare! test page.

You can optionally create an Access application to control who can access the service.

## 4. Connect using a private IP

Private network routes allow users to connect to your virtual private cloud (VPC) using the WARP client. To add a private network route for your Cloudflare Tunnel:

1. In the Private Network tab, enter the Private IPv4 address of your AWS instance (for example, 172.31.19.0). You can expand the IP range later if necessary.
2. In your Split Tunnel configuration, make sure the private IP is routing through WARP. For example, if you are using Split Tunnels in Exclude mode, delete 172.16.0.0/12. We recommend re-adding the IPs that are not explicitly used by your AWS instance.
To determine which IP addresses to re-add, subtract your AWS instance IPs from 172.16.0.0/12:
Base CIDR: Excluded CIDRs: Calculate
Add the results back to your Split Tunnel Exclude mode list.
3. To test on a user device:

Log in to the WARP client.
Open a terminal window and connect to the service using its private IP:

Terminal window$ curl 172.31.19.0<html><body><h1>Hello Cloudflare!</h1><p>This page was created for a Cloudflare demo.</p></body></html>
4. Log in to the WARP client.
5. Open a terminal window and connect to the service using its private IP:

You can optionally create Gateway network policies to control who can access the instance via its private IP.

Warning

Avoid configuring your Local Domain Fallback or Resolver Policy to direct all *.amazonaws.com DNS resolution via AWS Route 53 Resolver.

Some AWS endpoints (such as ssm.us-east-1.amazonaws.com) are public AWS endpoints that are not resolvable via internal VPC resolution. This can break AWS Console features for users on WARP.

Only route specific Route 53 zones, or VPC Endpoints (such as vpce.amazonaws.com), through the internal VPC resolver.

## Firewall configuration

To secure your AWS instance, you can configure your Security Group rules ‚Üó to deny all inbound traffic and allow only outbound traffic to the Cloudflare Tunnel IP addresses. All Security Group rules are Allow rules; traffic that does not match a rule is blocked. Therefore, you can delete all inbound rules and leave only the relevant outbound rules.

Note

If you delete the inbound rule for port 22, you will be unable to SSH back into the instance.

After configuring your Security Group rules, verify that you can still access the service through Cloudflare Tunnel via its public hostname or private IP. The service should no longer be accessible from outside Cloudflare Tunnel -- for example, if you go to http://ec2-44-202-59-16.compute-1.amazonaws.com the test page should no longer load.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Azure

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/azure/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/azure/)

Page options # Azure

The purpose of this guide is to walk through some best practices for accessing private resources on Azure by deploying Cloudflare's lightweight connector, cloudflared.

We will walk through how to initialize a service on a Linux VM in Azure, and route to it from another VM running cloudflared. This deployment guide does not take into account routing beyond basic security groups and default VPCs.

## Prerequisites

- In Zero Trust ‚Üó, create a Cloudflare Zero Trust account.
- Enroll an end-user device into your Cloudflare Zero Trust account.

## Create your environment

Make sure you sign up for Azure and create a new subscription.

1. First, create your first resource group.
2. In addition, create your first keypair as well. You will be using the keypair to SSH into your Virtual Machine.
3. Next, define your inbound and outbound ports to the VM. If these ports are not configured properly, the solution will not function as intended. For testing purposes, we will leave access open.

Create two Ubuntu 20.04 LTS VMs, and make sure you record their internal IP addresses. Azure by default uses the 10.0.0.0/8 subnet.

## Deploy cloudflared

1. SSH into your Azure instance using the command line.
Terminal windowcd Downloads
Terminal windowssh -i <private key path> azureuser@20.115.124.241
2. Run sudo su to gain full admin rights to the Virtual Machine.
3. Install cloudflared on your instance. In this example, we are running a Debian-based instance, so use the Debian package of cloudflared:

Add Cloudflare's package signing key:

Terminal windowsudo mkdir -p --mode=0755 /usr/share/keyringscurl -fsSL https://pkg.cloudflare.com/cloudflare-main.gpg | sudo tee /usr/share/keyrings/cloudflare-main.gpg >/dev/null

Add Cloudflare's apt repo to your apt repositories:

Terminal windowecho "deb [signed-by=/usr/share/keyrings/cloudflare-main.gpg] https://pkg.cloudflare.com/cloudflared any main" | sudo tee /etc/apt/sources.list.d/cloudflared.list

Update repositories and install cloudflared:

Terminal windowsudo apt-get update && sudo apt-get install cloudflared
4. Add Cloudflare's package signing key:
5. Add Cloudflare's apt repo to your apt repositories:
6. Update repositories and install cloudflared:
7. Run the following command to authenticate cloudflared with your Cloudflare account. The command will launch a browser window where you will be prompted to log in with your Cloudflare account and pick any zone you have added to Cloudflare.
Terminal windowcloudflared tunnel login
8. Create a tunnel.
Terminal windowcloudflared tunnel create Azure-01

## Complete tunnel configuration

1. Make a directory for your configuration file.
Terminal windowmkdir /etc/cloudflared
Terminal windowcd /etc/cloudflared
2. Build a configuration file. Before moving forward and entering vim, copy your Tunnel ID and credentials path to a notepad.
Terminal windowvim config.yml
3. Type i to begin editing the file and copy-paste the following settings in it.
tunnel: <Tunnel ID/name>credentials-file: /root/.cloudflared/<Tunnel ID>.jsonprotocol: quicwarp-routing:   enabled: truelogfile: /var/log/cloudflared.log#cloudflared to the origin debugloglevel: debug#cloudflared to cloudflare debugtransport-loglevel: info
4. Press esc and then enter :x to save and exit.
5. Run cloudflared as a service.

Terminal window ```
cloudflared service install
```

Terminal window ```
systemctl start cloudflared
```

Terminal window ```
systemctl status cloudflared
```

Next, visit Zero Trust and ensure your new tunnel shows as active. Optionally, begin creating Access policies to secure your private resources.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## GCP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/google-cloud-platform/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/google-cloud-platform/)

Page options # GCP

This guide covers how to connect a Google Cloud Project (GCP) virtual machine to Cloudflare using our lightweight connector, cloudflared.

We will deploy:

- A Google Cloud Project (GCP) virtual machine that runs a basic HTTP server.
- A Cloudflare Tunnel that allows users to connect to the service via either a public hostname or a private IP address.

### Prerequisites

To complete the following procedure, you will need to:

- Add a website to Cloudflare
- Deploy the WARP client on an end-user device

## 1. Create a VM instance in GCP

1. In your Google Cloud Console ‚Üó, create a new project ‚Üó.
2. Go to Compute Engine > VM instances.
3. Select Create instance.
4. Name your VM instance. In this example we will name it http-test-server.
5. Choose your desired operating system and specifications. For this example, you can use the following settings:

Machine family: General Purpose
Series: E2
Machine type: e2-micro
Boot disk image: Debian GNU/Linux 12
Firewalls: Allow HTTP and HTTPS traffic
6. Machine family: General Purpose
7. Series: E2
8. Machine type: e2-micro
9. Boot disk image: Debian GNU/Linux 12
10. Firewalls: Allow HTTP and HTTPS traffic
11. Under Advanced options > Management > Automation, add the following startup script. This example deploys a basic Apache web server on port 80.
#!/bin/bashapt updateapt -y install apache2cat <<EOF > /var/www/html/index.html<html><body><h1>Hello Cloudflare!</h1><p>This page was created for a Cloudflare demo.</p></body></html>EOF
12. Select Create.
13. The operating system automatically starts the Apache HTTP server. To verify that the server is running:

Copy the External IP for the VM instance.
Open a browser and go to http://<EXTERNAL IP>. You should see the Hello Cloudflare! test page.
14. Copy the External IP for the VM instance.
15. Open a browser and go to http://<EXTERNAL IP>. You should see the Hello Cloudflare! test page.
16. To login to the VM instance, open the dropdown next to SSH and select Open in browser window.

## 2. Create a Cloudflare Tunnel

Next, we will create a Cloudflare Tunnel in Zero Trust and run the tunnel on the GCP VM.

1. Log in to Zero Trust ‚Üó and go to Networks > Tunnels.
2. Select Create a tunnel.
3. Choose Cloudflared for the connector type and select Next.
4. Enter a name for your tunnel (for example, gcp-tunnel).
5. Select Save tunnel.
6. Under Choose your environment, select Debian. Copy the command shown in the dashboard and run it on your GCP VM.
7. Once the command has finished running, your connector will appear in Zero Trust.
8. Select Next.

## 3. Connect using a public hostname

Public hostname routes allow anyone on the Internet to connect to HTTP resources hosted on your virtual private cloud (VPC). To add a public hostname route for your Cloudflare Tunnel:

1. In the Public Hostname tab, enter a hostname for the application (for example, hellocloudflare.<your-domain>.com).
2. Under Service, enter http://localhost:80.
3. Select Save hostname.
4. To test, open a browser and go to http://hellocloudflare.<your-domain>.com. You should see the Hello Cloudflare! test page.

You can optionally create an Access application to control who can access the service.

## 4. Connect using a private IP

To configure a private network route for your Cloudflare Tunnel:

1. In the Private Network tab, enter the Internal IP of your GCP VM instance (for example, 10.0.0.2). You can expand the IP range later if necessary.
2. In your Split Tunnel configuration, make sure the internal IP is routing through WARP. For example, if you are using Split Tunnels in Exclude mode, delete 10.0.0.0/8. We recommend re-adding the IPs that are not explicitly used by your GCP VM.
To determine which IP addresses to re-add, subtract your GCP instance IPs from 10.0.0.0/8:
Base CIDR: Excluded CIDRs: Calculate
Add the results back to your Split Tunnel Exclude mode list.
3. To test on a user device:

Log in to the WARP client.
Open a terminal window and connect to the service using its private IP:

Terminal windowcurl 10.0.0.2
<html><body><h1>Hello Cloudflare!</h1><p>This page was created for a Cloudflare demo.</p></body></html>
4. Log in to the WARP client.
5. Open a terminal window and connect to the service using its private IP:

You can optionally create Gateway network policies to control who can access the VM via its private IP.

## Firewall configuration

To secure your VM instance, you can configure your VPC firewall rules ‚Üó to deny all ingress traffic and allow only egress traffic to the Cloudflare Tunnel IP addresses. Since GCP denies ingress traffic by default ‚Üó, you can delete all ingress rules and leave only the relevant egress rules.

Note

If you delete the default allow-ssh rule, you will be unable to SSH back into the VM.

After configuring your VPC firewall rules, verify that you can still access the service through Cloudflare Tunnel via its public hostname or private IP. The service should no longer be accessible from outside Cloudflare Tunnel -- for example, if you go to http://<EXTERNAL IP> the test page should no longer load.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Kubernetes

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/kubernetes/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/kubernetes/)

Page options # Kubernetes

Kubernetes ‚Üó is a container orchestration tool that is used to deploy applications onto physical or virtual machines, scale the deployment to meet traffic demands, and push updates without downtime. The Kubernetes cluster, or environment, where the application instances are running is connected internally through a private network. You can install the cloudflared daemon inside of the Kubernetes cluster in order to connect applications inside of the cluster to Cloudflare.

This guide will cover how to expose a Kubernetes service to the public Internet using a remotely-managed Cloudflare Tunnel. For the purposes of this example, we will deploy a basic web application alongside cloudflared in Google Kubernetes Engine (GKE). The same principles apply to any other Kubernetes environment (such as minikube, kubeadm, or a cloud-based Kubernetes service) where cloudflared can connect to Cloudflare's network.

Locally-managed tunnels

If you are looking to set up a locally-managed tunnel in Kubernetes, refer to the example code in GitHub ‚Üó.

## Architecture

As shown in the diagram, we recommend setting up cloudflared as an adjacent deployment ‚Üó to the application deployments. Having a separate Kubernetes deployment for cloudflared allows you to scale cloudflared independently of the application. In the cloudflared deployment, you can spin up multiple replicas running the same Cloudflare Tunnel ‚Äî there is no need to build a dedicated tunnel for each cloudflared pod. Each cloudflared replica / pod can reach all Kubernetes services in the cluster.

Note

We do not recommend using cloudflared in autoscaling setups because downscaling (removing replicas) will break existing user connections to that replica. Additionally, cloudflared does not load balance across replicas; replicas are strictly for high availability. To load balance traffic to your nodes, you can use Cloudflare Load Balancer or a third-party load balancer.

Once the cluster is connected to Cloudflare, you can configure Cloudflare Tunnel routes to control how cloudflared will proxy traffic to services within the cluster. For example, you may wish to publish certain Kubernetes applications to the Internet and restrict other applications to internal WARP client users.

## Prerequisites

To complete the following procedure, you will need:

- A Google Cloud Project ‚Üó
- A zone on Cloudflare

## 1. Create a GKE cluster

To create a new Kubernetes cluster in Google Cloud:

1. Open Google Cloud ‚Üó and go to Kubernetes Engine.
2. In Clusters, select Create.
3. Name the cluster. In this example, we will name it cloudflare-tunnel.
4. (Optional) Choose your desired region and other cluster specifications. For this example, we will use the default specifications.
5. Select Create.
6. To connect to the cluster:

Select the three-dot menu.
Select Connect.
Select Run in Cloud Shell to open a terminal in the browser.
Select Authorize.
Press Enter to run the pre-populated gcloud command.
(Recommended) In the Cloud Shell menu, select Open Editor to launch the built-in IDE.
7. Select the three-dot menu.
8. Select Connect.
9. Select Run in Cloud Shell to open a terminal in the browser.
10. Select Authorize.
11. Press Enter to run the pre-populated gcloud command.
12. (Recommended) In the Cloud Shell menu, select Open Editor to launch the built-in IDE.
13. In the Cloud Shell terminal, run the following command to check the cluster status:
Terminal windowkubectl get all
NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGEservice/kubernetes   ClusterIP   34.118.224.1   <none>        443/TCP   15m

## 2. Create pods for the web app

A pod represents an instance of a running process in the cluster. In this example, we will deploy the httpbin ‚Üó application with two pods and make the pods accessible inside the cluster at httpbin-service:80.

1. Create a folder for your Kubernetes manifest files:
Terminal windowmkdir tunnel-example
2. Change into the directory:
Terminal windowcd tunnel-example
3. In the tunnel-example directory, create a new file called httpbin.yaml. This file defines the Kubernetes deployment for the httpbin app.
httpbin.yamlapiVersion: apps/v1kind: Deploymentmetadata:  name: httpbin-deployment  namespace: defaultspec:  replicas: 2  selector:    matchLabels:      app: httpbin  template:    metadata:      labels:        app: httpbin    spec:      containers:      - name: httpbin        image: kennethreitz/httpbin:latest        imagePullPolicy: IfNotPresent        ports:        - containerPort: 80
4. Create a new httpbinsvc.yaml file. This file defines a Kubernetes service that allows other apps in the cluster (such as cloudflared) to access the set of httpbin pods.
httpbinsvc.yamlapiVersion: v1kind: Servicemetadata:  name: httpbin-service  namespace: defaultspec:  type: LoadBalancer  selector:    app: httpbin  ports:  - port: 80    targetPort: 80
5. Use the following command to run the application inside the cluster:
Terminal windowkubectl create -f httpbin.yaml -f httpbinsvc.yaml
6. Check the status of your deployment:
Terminal windowkubectl get all
NAME                                     READY   STATUS    RESTARTS   AGEpod/httpbin-deployment-bc6689c5d-b5ftk   1/1     Running   0          79spod/httpbin-deployment-bc6689c5d-cbd9m   1/1     Running   0          79s
NAME                      TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)        AGEservice/httpbin-service   LoadBalancer   34.118.225.147   34.75.201.60   80:31967/TCP   79sservice/kubernetes        ClusterIP      34.118.224.1     <none>         443/TCP        24h
NAME                                 READY   UP-TO-DATE   AVAILABLE   AGEdeployment.apps/httpbin-deployment   2/2     2            2           79s
NAME                                           DESIRED   CURRENT   READY   AGEreplicaset.apps/httpbin-deployment-bc6689c5d   2         2         2       79s

## 3. Create a tunnel

To create a Cloudflare Tunnel:

1. Open a new browser tab and log in to Zero Trust ‚Üó.
2. Go to Networks > Tunnels.
3. Select Create a tunnel.
4. Choose Cloudflared for the connector type and select Next.
5. Enter a name for your tunnel (for example, gke-tunnel).
6. Select Save tunnel.
7. Under Choose an environment, select Docker.
Applications must be packaged into a containerized image before you can run it in Kubernetes. Therefore, we will use the cloudflared Docker container image to deploy the tunnel in Kubernetes.
8. Instead of running the installation command, copy just the token value rather than the whole command. The token value is of the form eyJhIjoiNWFiNGU5Z... You will need the token for the Kubernetes manifest file.

Leave the Cloudflare Tunnel browser tab open while we focus on the Kubernetes deployment.

## 4. Store the tunnel token

cloudflared uses a tunnel token to run a remotely-managed Cloudflare Tunnel. You can store the tunnel token in a Kubernetes secret ‚Üó, which requires data to be encoded as a base64-encoded string. The encoding is not meant to protect the token from being read but to allow for the safe handling of binary data within Kubernetes.

1. Convert the tunnel token into base64 format:
Terminal window'eyJhIjoiNWFiNGU5Z...' | base64
ZXlKa...NKOQo=
2. In GKE Cloud Shell, create a tunnel-token.yaml file with the following content. Make sure to replace <base64_tunnel_token> with your base64-encoded token value (ZXlKa...NKOQo=).
tunnel-token.yamlapiVersion: v1data:    token: <base64_tunnel_token>kind: Secretmetadata:    name: tunnel-token    namespace: defaulttype: Opaque
3. Create the secret:
Terminal windowkubectl create -f tunnel-token.yaml
4. Check the newly created secret:
Terminal windowkubectl get secrets
NAME        TYPE     DATA   AGEtunnel-token   Opaque   1      100s

## 5. Create pods for cloudflared

To run the Cloudflare Tunnel in Kubernetes:

1. Create a Kubernetes deployment for a remotely-managed Cloudflare Tunnel:

tunnel.yaml ```
apiVersion: apps/v1kind: Deploymentmetadata:  name: cloudflared-deployment  namespace: defaultspec:  replicas: 2  selector:    matchLabels:      pod: cloudflared  template:    metadata:      labels:        pod: cloudflared    spec:      securityContext:        sysctls:        # Allows ICMP traffic (ping, traceroute) to resources behind cloudflared.          - name: net.ipv4.ping_group_range            value: "65532 65532"      containers:        - image: cloudflare/cloudflared:latest          name: cloudflared          env:            # Defines an environment variable for the tunnel token.            - name: TUNNEL_TOKEN              valueFrom:                secretKeyRef:                  name: tunnel-token                  key: token          command:            # Configures tunnel run parameters            - cloudflared            - tunnel            - --no-autoupdate            - --loglevel            - debug            - --metrics            - 0.0.0.0:2000            - run          livenessProbe:            httpGet:              # Cloudflared has a /ready endpoint which returns 200 if and only if              # it has an active connection to Cloudflare's network.              path: /ready              port: 2000            failureThreshold: 1            initialDelaySeconds: 10            periodSeconds: 10
```

1. Deploy cloudflared to the cluster:
Terminal windowkubectl create -f tunnel.yaml
Kubernetes will install the cloudflared image on two pods and run the tunnel using the command cloudflared tunnel --no-autoupdate --loglevel debug --metrics 0.0.0.0:2000 run. cloudflared will consume the tunnel token from the TUNNEL_TOKEN environment variable.
2. Check the status of your cluster:
Terminal windowkubectl get all
NAME                                          READY   STATUS    RESTARTS   AGEpod/cloudflared-deployment-6d5f9f9666-85l5w   1/1     Running   0          21spod/cloudflared-deployment-6d5f9f9666-wb96x   1/1     Running   0          21spod/httpbin-deployment-bc6689c5d-b5ftk        1/1     Running   0          3m36spod/httpbin-deployment-bc6689c5d-cbd9m        1/1     Running   0          3m36s
NAME                      TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)        AGEservice/httpbin-service   LoadBalancer   34.118.225.147   34.75.201.60   80:31967/TCP   3m36sservice/kubernetes        ClusterIP      34.118.224.1     <none>         443/TCP        24h
NAME                                     READY   UP-TO-DATE   AVAILABLE   AGEdeployment.apps/cloudflared-deployment   2/2     2            2           22sdeployment.apps/httpbin-deployment       2/2     2            2           3m37s
NAME                                                DESIRED   CURRENT   READY   AGEreplicaset.apps/cloudflared-deployment-6d5f9f9666   2         2         2       22sreplicaset.apps/httpbin-deployment-bc6689c5d        2         2         2       3m37s

You should see two cloudflared pods and two httpbin pods with a Running status. If your cloudflared pods keep restarting, check the command syntax in tunnel.yaml and make sure that the tunnel run parameters  are in the correct order.

## 6. Verify tunnel status

To print logs for a cloudflared instance:

Terminal window ```
kubectl logs pod/cloudflared-deployment-6d5f9f9666-85l5w
```

```
2025-06-11T22:00:47Z INF Starting tunnel tunnelID=64c359b6-e111-40ec-a3a9-199c2a6566132025-06-11T22:00:47Z INF Version 2025.6.0 (Checksum 72f233bb55199093961bf099ad62d491db58819df34b071ab231f622deff33ce)2025-06-11T22:00:47Z INF GOOS: linux, GOVersion: go1.24.2, GoArch: amd642025-06-11T22:00:47Z INF Settings: map[loglevel:debug metrics:0.0.0.0:2000 no-autoupdate:true token:*****]2025-06-11T22:00:47Z INF Generated Connector ID: aff7c4a0-85a3-4ac9-8475-1e0aa1af8d942025-06-11T22:00:47Z DBG Fetched protocol: quic2025-06-11T22:00:47Z INF Initial protocol quic...
```

## 7. Add a tunnel route

Now that the tunnel is up and running, we can use the Zero Trust dashboard to route the httpbin service through the tunnel.

1. Switch to the browser tab where you were configuring Cloudflare Tunnel.
2. Go to the Route tunnel step.
3. In the Public hostnames tab, enter a hostname for the application (for example, httpbin.<your-domain>.com).
4. Under Service, enter http://httpbin-service. httpbin-service is the name of the Kubernetes service defined in httpbinsvc.yaml.
5. Select Complete setup.

## 8. Test the connection

To test, open a new browser tab and go to httpbin.<your-domain>.com. You should see the httpbin homepage.

You can optionally create an Access application to control who can access the service.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Terraform

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/terraform/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/deployment-guides/terraform/)

Page options # Terraform

Terraform ‚Üó is an infrastructure as code software tool that allows you to deploy services from different providers using a standardized configuration syntax. When creating a Terraform configuration file, you define the final state of the configuration rather than the step-by-step procedure. This allows you to easily deploy, modify, and manage your Tunnels alongside your other infrastructure.

In this guide, you will use Terraform to deploy:

- A Google Cloud Project (GCP) virtual machine that runs an HTTP test server
- A Cloudflare Tunnel that makes the server available over the Internet
- A Cloudflare Access policy that defines who can connect to the server

## Prerequisites

To complete the following procedure, you will need:

- A Google Cloud Project ‚Üó
- A zone on Cloudflare
- Enabled one-time PIN login or integrated an identity provider

## 1. Install Terraform

Refer to the Terraform installation guide ‚Üó for your operating system.

## 2. Install the gcloud CLI

1. Install the gcloud CLI ‚Üó so that Terraform can interact with your GCP account.
2. Authenticate with the CLI by running:
Terminal windowgcloud auth application-default login

## 3. Create a Cloudflare API token

Create an API token so that Terraform can interact with your Cloudflare account. At minimum, your token should include the following permissions:

| Type | Item | Permission |
| --- | --- | --- |
| Account | Cloudflare Tunnel | Edit |
| Account | Access: Apps and Policies | Edit |
| Zone | DNS | Edit |

## 4. Create a configuration directory

Terraform functions through a working directory that contains configuration files. You can store your configuration in multiple files or just one ‚Äî Terraform will evaluate all of the configuration files in the directory as if they were in a single document.

1. Create a folder for your Terraform configuration:
Terminal windowmkdir cloudflare-tf
2. Change into the directory:
Terminal windowcd cloudflare-tf

## 5. Create Terraform configuration files

### Define input variables

The following variables will be passed into your GCP and Cloudflare configuration.

1. In your configuration directory, create a .tf file:
Terminal windowtouch variables.tf
2. Open the file in a text editor and copy and paste the following:
# GCP variablesvariable "gcp_project_id" {  description = "Google Cloud Platform (GCP) project ID"  type        = string}
variable "zone" {  description = "Geographical zone for the GCP VM instance"  type        = string}
variable "machine_type" {  description = "Machine type for the GCP VM instance"  type        = string}
# Cloudflare variablesvariable "cloudflare_zone" {  description = "Domain used to expose the GCP VM instance to the Internet"  type        = string}
variable "cloudflare_zone_id" {  description = "Zone ID for your domain"  type        = string}
variable "cloudflare_account_id" {  description = "Account ID for your Cloudflare account"  type        = string  sensitive   = true}
variable "cloudflare_email" {  description = "Email address for your Cloudflare account"  type        = string  sensitive   = true}
variable "cloudflare_token" {  description = "Cloudflare API token"  type        = string  sensitive   = true}

### Assign values to the variables

1. In your configuration directory, create a .tfvars file:
Terminal windowtouch terraform.tfvars
Terraform will automatically use these variables if the file is named terraform.tfvars, otherwise the variable file will need to be manually passed in.
2. Add the following variables to terraform.tfvars. Be sure to modify the example with your own values.
cloudflare_zone           = "example.com"cloudflare_zone_id        = "023e105f4ecef8ad9ca31a8372d0c353"cloudflare_account_id     = "372e67954025e0ba6aaa6d586b9e0b59"cloudflare_email          = "user@example.com"cloudflare_token          = "y3AalHS_E7Vabk3c3lX950F90_Xl7YtjSlzyFn_X"gcp_project_id            = "testvm-123"zone                      = "us-central1-a"machine_type              = "e2-medium"

Warning

To prevent accidentally exposing sensitive credentials, do not save terraform.tfvars in your version control system. For example, if your version control is git, add terraform.tfvars to your .gitignore file.

### Configure Terraform providers

You will need to declare the providers ‚Üó used to provision the infrastructure.

1. In your configuration directory, create a .tf file:
Terminal windowtouch providers.tf
2. Add the following providers to providers.tf. The random provider is used to generate a tunnel secret.
      Terraform (v5)     Terraform (v4)      terraform {  required_providers {    cloudflare = {      source = "cloudflare/cloudflare"      version = ">= 5.8.2"    }    google = {      source = "hashicorp/google"    }  }  required_version = ">= 1.2"}
# Providersprovider "cloudflare" {  api_token    = var.cloudflare_token}provider "google" {  project    = var.gcp_project_id}provider "random" {}  terraform {  required_providers {    cloudflare = {      source = "cloudflare/cloudflare"      version = ">= 4.40.0, < 5.0.0"    }    google = {      source = "hashicorp/google"    }    random = {      source = "hashicorp/random"    }  }  required_version = ">= 1.2"}
# Providersprovider "cloudflare" {  api_token    = var.cloudflare_token}provider "google" {  project    = var.gcp_project_id}provider "random" {}
3. Terraform (v5)
4. Terraform (v4)

### Configure Cloudflare resources

The following configuration will modify settings in your Cloudflare account.

1. In your configuration directory, create a .tf file:
Terminal windowtouch Cloudflare-config.tf
2. Add the following resources to Cloudflare-config.tf:
      Terraform (v5)     Terraform (v4)      # Creates a new remotely-managed tunnel for the GCP VM.resource "cloudflare_zero_trust_tunnel_cloudflared" "gcp_tunnel" {  account_id    = var.cloudflare_account_id  name          = "Terraform GCP tunnel"  config_src    = "cloudflare"}
# Reads the token used to run the tunnel on the server.data "cloudflare_zero_trust_tunnel_cloudflared_token" "gcp_tunnel_token" {  account_id   = var.cloudflare_account_id  tunnel_id   = cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.id}
# Creates the CNAME record that routes http_app.${var.cloudflare_zone} to the tunnel.resource "cloudflare_dns_record" "http_app" {  zone_id = var.cloudflare_zone_id  name    = "http_app"  content = "${cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.id}.cfargotunnel.com"  type    = "CNAME"  ttl     = 1  proxied = true}
# Configures tunnel with a public hostname route for clientless access.resource "cloudflare_zero_trust_tunnel_cloudflared_config" "gcp_tunnel_config" {  tunnel_id  = cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.id  account_id = var.cloudflare_account_id  config     = {    ingress   = [      {        hostname = "http_app.${var.cloudflare_zone}"        service  = "http://httpbin:80"      },      {        service  = "http_status:404"      }    ]  }}
# (Optional) Routes internal IP of GCP instance through the tunnel for private network access using WARP.resource "cloudflare_zero_trust_tunnel_cloudflared_route" "example_tunnel_route" {account_id         = var.cloudflare_account_idtunnel_id          = cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.idnetwork            = google_compute_instance.http_server.network_interface.0.network_ipcomment            = "Example tunnel route"}
# Creates a reusable Access policy.resource "cloudflare_zero_trust_access_policy" "allow_emails" {  account_id   = var.cloudflare_account_id  name         = "Allow email addresses"  decision     = "allow"  include      = [    {      email = {        email = var.cloudflare_email      }    },    {      email_domain = {        domain = "@example.com"      }    }  ]}
# Creates an Access application to control who can connect to the public hostname.resource "cloudflare_zero_trust_access_application" "http_app" {  account_id       = var.cloudflare_account_id  type             = "self_hosted"  name             = "Access application for http_app.${var.cloudflare_zone}"  domain           = "http_app.${var.cloudflare_zone}"  policies = [    {      id = cloudflare_zero_trust_access_policy.allow_emails.id      precedence = 1    }  ]}  # Generates a 32-byte secret for the tunnel.resource "random_bytes" "tunnel_secret" {  byte_length = 32}
# Creates a new remotely-managed tunnel for the GCP VM.resource "cloudflare_zero_trust_tunnel_cloudflared" "gcp_tunnel" {  account_id = var.cloudflare_account_id  name       = "Terraform GCP tunnel"  secret     = random_bytes.tunnel_secret.base64}
# Creates the CNAME record that routes http_app.${var.cloudflare_zone} to the tunnel.resource "cloudflare_record" "http_app" {  zone_id = var.cloudflare_zone_id  name    = "http_app"  content   = "${cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.cname}"  type    = "CNAME"  proxied = true}
# Configures tunnel with a public hostname route for clientless access.  resource "cloudflare_zero_trust_tunnel_cloudflared_config" "gcp_tunnel_config" {    tunnel_id = cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.id    account_id = var.cloudflare_account_id    config {      ingress_rule {        hostname = "${cloudflare_record.http_app.hostname}"        service  = "http://httpbin:80"      }      ingress_rule {        service  = "http_status:404"      }    }  }
# (Optional) Route internal IP of GCP instance through the tunnel for private network access using WARP.resource "cloudflare_zero_trust_tunnel_route" "example_tunnel_route" {account_id         = var.cloudflare_account_idtunnel_id          = cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.idnetwork            = google_compute_instance.http_server.network_interface.0.network_ipcomment            = "Example tunnel route"}
# Creates an Access application to control who can connect to the public hostname.resource "cloudflare_zero_trust_access_application" "http_app" {  account_id          = var.cloudflare_account_id  name             = "Access application for http_app.${var.cloudflare_zone}"  domain           = "http_app.${var.cloudflare_zone}"}
# Creates a (legacy) Access policy for the Access application.resource "cloudflare_zero_trust_access_policy" "allow_emails" {  application_id = cloudflare_zero_trust_access_application.http_app.id  account_id        = var.cloudflare_account_id  name           = "Example policy for http_app.${var.cloudflare_zone}"  precedence     = "1"  decision       = "allow"  include {    email = [var.cloudflare_email]  }}
3. Terraform (v5)
4. Terraform (v4)

To learn more about these resources, refer to the Cloudflare provider documentation ‚Üó.

### Configure GCP resources

The following configuration defines the specifications for the GCP virtual machine and configures a startup script to run upon boot.

1. In your configuration directory, create a .tf file:
Terminal windowtouch GCP-config.tf
2. Add the following content to GCP-config.tf:
      Terraform (v5)     Terraform (v4)      # OS the server will usedata "google_compute_image" "image" {  family  = "ubuntu-2204-lts"  project = "ubuntu-os-cloud"}
# GCP Instance resourceresource "google_compute_instance" "http_server" {  name         = "test"  machine_type = var.machine_type  zone         = var.zone  tags         = []  boot_disk {    initialize_params {      image = data.google_compute_image.image.self_link    }  }
  network_interface {    network = "default"    access_config {      //Ephemeral IP    }  }  // Optional config to make instance ephemeral/*  scheduling {    preemptible       = true    automatic_restart = false  } */
  // Pass the tunnel token to the GCP server so that the server can install and run the tunnel upon startup.  metadata_startup_script = templatefile("./install-tunnel.tftpl",    {      tunnel_token = data.cloudflare_zero_trust_tunnel_cloudflared_token.gcp_tunnel_token.token    })}  # OS the server will usedata "google_compute_image" "image" {  family  = "ubuntu-2204-lts"  project = "ubuntu-os-cloud"}
# GCP Instance resourceresource "google_compute_instance" "http_server" {  name         = "test"  machine_type = var.machine_type  zone         = var.zone  tags         = []  boot_disk {    initialize_params {      image = data.google_compute_image.image.self_link    }  }
  network_interface {    network = "default"    access_config {      //Ephemeral IP    }  }  // Optional config to make instance ephemeral/*  scheduling {    preemptible       = true    automatic_restart = false  } */
  // Pass the tunnel token to the GCP server so that the server can install and run the tunnel upon startup.  metadata_startup_script = templatefile("./install-tunnel.tftpl",    {      tunnel_token = cloudflare_zero_trust_tunnel_cloudflared.gcp_tunnel.tunnel_token    })}
3. Terraform (v5)
4. Terraform (v4)

### Create a startup script

The following script will install cloudflared and run the tunnel as a service. This example also installs a lightweight HTTP application that you can use to test connectivity.

Note

If you would prefer to manually install the tunnel, refer to Install and run the tunnel.

1. In your configuration directory, create a Terraform template file:
Terminal windowtouch install-tunnel.tftpl
2. Open the file in a text editor and copy and paste the following bash script:
Terminal window# Script to install Cloudflare Tunnel and Docker resources
# Docker configurationcd /tmpsudo apt-get install software-properties-common# Retrieving the docker repository for this OScurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable"# The OS is updated and docker is installedsudo apt update -y && sudo apt upgrade -ysudo apt install docker docker-compose -y# Add the HTTPBin application and run it on localhost:8080.cat > /tmp/docker-compose.yml << "EOF"version: '3'services:  httpbin:    image: kennethreitz/httpbin    restart: always    container_name: httpbin    ports:      - 8080:80
  cloudflared:    image: cloudflare/cloudflared:latest    restart: always    container_name: cloudflared    command: tunnel run --token ${tunnel_token}EOFcd /tmpsudo docker-compose up -d

## 6. Deploy Terraform

To deploy the configuration files:

1. Initialize your configuration directory:
Terminal windowterraform init
2. Preview everything that will be created:
Terminal windowterraform plan
3. Apply the configuration:
Terminal windowterraform apply

It may take several minutes for the GCP instance and tunnel to come online. You can view your new tunnel, Access application, and Access policy in Zero Trust ‚Üó. The new DNS records are available in the Cloudflare dashboard.

Remove Terraform resources

If you need to roll back the configuration, run terraform destroy to delete everything created through Terraform. Both terraform apply and terraform destroy prompt for user input before applying the changes. To run without requiring user input, you can add the -auto-approve flag to the command.

## 7. Test the connection

1. In Networks > Tunnels, verify that your tunnel is active.
2. In Access > Applications, verify that your Cloudflare email is allowed by the Access policy.
3. From any device, open a browser and go to http_app.<CLOUDFLARE_ZONE> (for example, http_app.example.com).
You will see the Access login page if you have not recently logged in.
4. Log in with your Cloudflare email.
You should see the HTTPBin ‚Üó homepage.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Private networks

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/)

Page options # Private networks

With Cloudflare Zero Trust, you can connect private networks and the services running in those networks to Cloudflare's global network. This involves installing a connector on the private network, and then setting up routes which define the IP addresses available in that environment. Unlike public hostname routes, private network routes can expose both HTTP and non-HTTP resources.

To reach private network IPs, end users must connect their device to Cloudflare and enroll in your Zero Trust organization. The most common method is to install the WARP client on their device, or you can onboard their network traffic to Cloudflare using our WARP Connector or Magic WAN.

Administrators can optionally set Gateway network policies to control access to services based on user identity and device posture.

## Connectors

Here are the different ways you can connect your private network to Cloudflare:

- cloudflared installs on a server in your private network to create a secure, outbound tunnel to Cloudflare. Cloudflare Tunnel using cloudflared only proxies traffic initiated from a user to a server. Any service or application running behind the tunnel will use the server's default routing table for server-initiated connectivity.
- WARP-to-WARP uses the Cloudflare WARP client to establish peer-to-peer connectivity between two or more devices. Each device running WARP can access services on any other device running WARP via an assigned virtual IP address.
- WARP Connector installs on a Linux server in your private network to establish site-to-site, bidirectional, and mesh networking connectivity. The WARP Connector acts as a subnet router to relay client-initiated and server-initiated traffic between all devices on a private network and Cloudflare.
- Magic WAN relies on configuring legacy networking equipment to establish anycast GRE or IPsec tunnels between an entire network location and Cloudflare.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect private networks

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/cloudflared/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/cloudflared/)

Page options # Connect private networks

A private network has two primary components: the server and the client. The server's infrastructure (whether that is a single application, multiple applications, or a network segment) is connected to Cloudflare's global network by Cloudflare Tunnel. This is done by running the cloudflared daemon on the server.

On the client side, end users connect to Cloudflare's global network using the Cloudflare WARP client. The WARP client can be rolled out to your entire organization in just a few minutes using your in-house MDM tooling. When users connect to an IP made available through Cloudflare Tunnel, WARP sends their connection through Cloudflare's network to the corresponding tunnel.

To enable remote access to your private network, follow the guide below.

## 1. Connect the server to Cloudflare

To connect your infrastructure with Cloudflare Tunnel:

1. Create a Cloudflare Tunnel for your server by following our dashboard setup guide. You can skip the connect an application step and go straight to connecting a network.

1. In the Private Networks tab for the tunnel, enter the IP/CIDR range that you wish to route through the tunnel (for example 10.0.0.0/8).

## 2. Set up the client

To connect your devices to Cloudflare:

1. Deploy the WARP client on your devices in Gateway with WARP mode or generate a proxy endpoint and deploy a PAC file.
2. Create device enrollment rules to determine which devices can enroll to your Zero Trust organization.

## 3. Route private network IPs through WARP

By default, WARP excludes traffic bound for RFC 1918 space ‚Üó, which are IP addresses typically used in private networks and not reachable from the Internet. In order for WARP to send traffic to your private network, you must configure Split Tunnels so that the IP/CIDR of your private network routes through WARP.

1. First, check whether your Split Tunnels mode is set to Exclude or Include mode.
2. If you are using Include mode, add your private network's IP/CIDR range to the list. Your list should also include the domains necessary for Cloudflare Zero Trust functionality.
3. If you are using Exclude mode:
a. Delete your private network's IP/CIDR range from the list. For example, if your network uses the default AWS range of 172.31.0.0/16, delete 172.16.0.0/12.
b. Re-add IP/CIDR ranges that are not explicitly used by your private network. For the AWS example above, you would add new entries for 172.16.0.0/13, 172.24.0.0/14, 172.28.0.0/15, and 172.30.0.0/16. This ensures that only traffic to 172.31.0.0/16 routes through WARP.
You can use the following calculator to determine which IP addresses to re-add:
Base CIDR: Excluded CIDRs: Calculate
In Base CIDR, enter the RFC 1918 range that you deleted from Split Tunnels. In Excluded CIDRs, enter the IP/CIDR range used by your private network. Re-add the calculator results to your Split Tunnel Exclude mode list.

By tightening the private IP range included in WARP, you reduce the risk of breaking a user's access to local resources.

## 4. (Recommended) Filter network traffic with Gateway

By default, all WARP devices enrolled in your Zero Trust organization can connect to your private network through Cloudflare Tunnel. You can configure Gateway inspect your network traffic and either block or allow access based on user identity and device posture.

### Enable the Gateway proxy

- Dashboard
- Terraform (v5)

1. Go to Settings > Network.
2. In Firewall, turn on Proxy.
3. Select TCP.
4. (Recommended) To proxy traffic to internal DNS resolvers, select UDP.
5. (Recommended) To proxy traffic for diagnostic tools such as ping and traceroute, select ICMP. You may also need to update your system to allow ICMP traffic through cloudflared.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Turn on the TCP and/or UDP proxy using the cloudflare_zero_trust_device_settings ‚Üó resource:
resource "cloudflare_zero_trust_device_settings "global_warp_settings" {  account_id            = var.cloudflare_account_id  gateway_proxy_enabled = true  gateway_udp_proxy_enabled = true}

Cloudflare will now proxy traffic from enrolled devices, except for the traffic excluded in your split tunnel settings. For more information on how Gateway forwards traffic, refer to Gateway proxy.

### Zero Trust policies

Cloudflare Zero Trust allows you to configure security policies using either Access or Gateway. If you have applications clearly defined by IPs or hostnames, we recommend creating an Access application and managing user access alongside your SaaS and other web apps. Alternatively, if you prefer to secure a private network using a traditional firewall model, you can build Gateway network and DNS policies for IP ranges and domains.

## 5. Connect as a user

End users can now reach HTTP or TCP-based services on your network by visiting any IP address in the range you have specified.

### Troubleshooting

#### Device configuration

To check that their device is properly configured, the user can visit https://help.teams.cloudflare.com/ to ensure that:

- The page returns Your network is fully protected.
- In HTTP filtering, both WARP and Gateway Proxy are enabled.
- The Team name matches the Zero Trust organization from which you created the tunnel.

#### Router configuration

Check the local IP address of the device and ensure that it does not fall within the IP/CIDR range of your private network. For example, some home routers will make DHCP assignments in the 10.0.0.0/24 range, which overlaps with the 10.0.0.0/8 range used by most corporate private networks. When a user's home network shares the same IP addresses as the routes in your tunnel, their device will be unable to connect to your application.

To resolve the IP conflict, you can either:

- Reconfigure the user's router to use a non-overlapping IP range. Compatible routers typically use 192.168.1.0/24, 192.168.0.0/24 or 172.16.0.0/24.
- Tighten the IP range in your Split Tunnel configuration to exclude the 10.0.0.0/24 range. This will only work if your private network does not have any hosts within 10.0.0.0/24.
- Change the IP/CIDR of your private network so that it does not overlap with a range commonly used by home networks.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Private DNS

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/cloudflared/private-dns/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/cloudflared/private-dns/)

Page options # Private DNS

By default, the WARP client sends DNS requests to 1.1.1.1, Cloudflare's public DNS resolver, for resolution. With Cloudflare Tunnel, you can connect an internal DNS resolver to Cloudflare and use it to resolve non-publicly routed domains.

## Configure private DNS

1. Connect your private network with Cloudflare Tunnel.
2. Under Networks > Routes, verify that the IP address of your internal DNS resolver is included in the tunnel.
3. Enable the Gateway proxy for TCP and UDP.
4. Next, create a Local Domain Fallback entry that points to the internal DNS resolver. For example, you can instruct the WARP client to resolve all requests for myorg.privatecorp through an internal resolver at 10.0.0.25 rather than attempting to resolve this publicly.

Note

Ensure that Split Tunnels are configured to include traffic to private IPs and hostnames.

1. Finally, ensure that your tunnel uses QUIC as the default transport protocol. This will enable cloudflared to proxy UDP-based traffic which is required in most cases to resolve DNS queries.

The WARP client will now resolve requests through the internal DNS server you set up in your private network.

## Test the setup

For testing, run a dig command for the internal DNS service:

Terminal window ```
dig AAAA www.myorg.privatecorp
```

The dig command will work because myorg.privatecorp was configured above as a fallback domain. If you skip that step, you can still force dig to use your private DNS resolver:

Terminal window ```
dig @10.0.0.25 AAAA www.myorg.privatecorp
```

Both dig commands will fail if the WARP client is disabled on your end user's device.

## Troubleshooting

Use the following troubleshooting strategies if you are running into issues while configuring your private network with Cloudflare Tunnel.

- Ensure that cloudflared is connected to Cloudflare by visiting Networks > Tunnels in Zero Trust.
- Ensure that cloudflared is running with the quic protocol (search for Initial protocol quic in its logs).
- Ensure that the machine where cloudflared is running is allowed to egress via UDP to port 7844 to talk out to Cloudflare.
- Ensure that end-user devices are enrolled into WARP by visiting https://help.teams.cloudflare.com ‚Üó.
- Double-check the precedence of your application policies in the Gateway Network policies tab. Ensure that a more global Block or Allow policy will not supersede the application policies.
- Check the Gateway Audit Logs Network tab to see whether your UDP DNS resolutions are being allowed or blocked.
- Ensure that your Private DNS resolver is available over a routable private IP address. You can check that by trying the dig commands on your machine running cloudflared.
- Check your set up by using dig ... +tcp to force the DNS resolution to use TCP instead of UDP.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Virtual networks

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/cloudflared/tunnel-virtual-networks/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/cloudflared/tunnel-virtual-networks/)

Page options # Virtual networks

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP Secure Web Gateway without DNS filtering | All plans |

| System | Availability |
| --- | --- |
| Windows | ‚úÖ |
| macOS | ‚úÖ |
| Linux | ‚úÖ |
| iOS | ‚úÖ |
| Android | ‚úÖ |
| ChromeOS | ‚úÖ |

Virtual networks allow you to connect private networks that have overlapping IP ranges without creating conflicts for users or services. For example, an organization may want to expose two distinct virtual private cloud (VPC) networks which they consider to be "production" and "staging". However, if the two private networks happened to receive the same RFC 1918 IP assignment, there may be two different resources with the same IP address. By creating two separate virtual networks, you can deterministically route traffic to duplicative private addresses like 10.128.0.1/32 staging and 10.128.0.1/32 production. These virtual networks will appear as user-selectable options within the WARP client GUI.

## Use cases

Here are a few scenarios where virtual networks may prove useful:

- Manage production and staging environments that use the same address space.
- Manage acquisitions or mergers between organizations that use the same address space.
- Allow IT professional services to access their customer's network for various administration and management purposes.
- Allow developers or homelab users to deterministically route traffic through their home network to enforce additional security controls.
- Guarantee additional segmentation (beyond just policy enforcement) between networks and resources for security reasons, while keeping all configuration within a single Cloudflare account.

## Prerequisites

- Install cloudflared on each private network.
- Deploy the WARP client on user devices.

## Create a virtual network

The following example demonstrates how to add two overlapping IP routes to Cloudflare (10.128.0.1/32 staging and 10.128.0.1/32 production).

- Dashboard
- Terraform (v5)
- Locally-managed tunnels

To route overlapping IPs over virtual networks:

1. First, create two unique virtual networks:

In Zero Trust ‚Üó, go to Settings > WARP Client.
Find the Virtual networks setting and select Manage.
Select Create virtual network.
Name your virtual network staging-vnet and select Save.
Repeat Steps 1a-1d to create another virtual network called production-vnet.
2. In Zero Trust ‚Üó, go to Settings > WARP Client.
3. Find the Virtual networks setting and select Manage.
4. Select Create virtual network.
5. Name your virtual network staging-vnet and select Save.
6. Repeat Steps 1a-1d to create another virtual network called production-vnet.
7. Next, create a Cloudflare Tunnel for each private network:

Go to Networks > Tunnels.
Select Create a tunnel.
Name your tunnel Staging tunnel and select Save tunnel.
Install the connector within your staging environment.
In the Private Network tab, add 10.128.0.1/32.
Select Additional settings. Under Virtual networks, select staging-vnet.
Save the tunnel.
Repeat Steps 2a-2g to create another tunnel called Production tunnel. Be sure to install the connector within your production environment and assign the route to production-vnet.
8. Go to Networks > Tunnels.
9. Select Create a tunnel.
10. Name your tunnel Staging tunnel and select Save tunnel.
11. Install the connector within your staging environment.
12. In the Private Network tab, add 10.128.0.1/32.
13. Select Additional settings. Under Virtual networks, select staging-vnet.
14. Save the tunnel.
15. Repeat Steps 2a-2g to create another tunnel called Production tunnel. Be sure to install the connector within your production environment and assign the route to production-vnet.

We now have two overlapping IP addresses routed over staging-vnet and production-vnet respectively. You can use the Cloudflare WARP client to switch between virtual networks.

To route overlapping IPs over virtual networks:

1. Add the following permission to your cloudflare_api_token ‚Üó:

Cloudflare Tunnel Write
2. Cloudflare Tunnel Write
3. Create two unique virtual networks:
resource "cloudflare_zero_trust_tunnel_cloudflared_virtual_network" "staging_vnet" {  account_id = var.cloudflare_account_id  name       = "staging-vnet"  comment    = "Staging virtual network"  is_default = false}
resource "cloudflare_zero_trust_tunnel_cloudflared_virtual_network" "production_vnet" {  account_id = var.cloudflare_account_id  name       = "production-vnet"  comment    = "Production virtual network"  is_default = false}
4. Create a Cloudflare Tunnel for each private network:
resource "cloudflare_zero_trust_tunnel_cloudflared" "staging_tunnel" {  account_id = var.cloudflare_account_id  name       = "Staging tunnel"  config_src = "cloudflare"}
resource "cloudflare_zero_trust_tunnel_cloudflared" "production_tunnel" {  account_id = var.cloudflare_account_id  name       = "Production tunnel"  config_src = "cloudflare"}
5. Route 10.128.0.1/32 through Staging tunnel and assign it to staging-vnet. Route 10.128.0.1/32 through Production tunnel and assign it to production-vnet.
resource "cloudflare_zero_trust_tunnel_cloudflared_route" "staging_tunnel_route" {  account_id         = var.cloudflare_account_id  tunnel_id          = cloudflare_zero_trust_tunnel_cloudflared.staging_tunnel.id  network            = "10.128.0.1/32"  comment            = "Staging tunnel route"  virtual_network_id = cloudflare_zero_trust_tunnel_cloudflared_virtual_network.staging_vnet.id}
resource "cloudflare_zero_trust_tunnel_cloudflared_route" "production_tunnel_route" {  account_id         = var.cloudflare_account_id  tunnel_id          = cloudflare_zero_trust_tunnel_cloudflared.production_tunnel.id  network            = "10.128.0.1/32"  comment            = "Production tunnel route"  virtual_network_id = cloudflare_zero_trust_tunnel_cloudflared_virtual_network.production_vnet.id}
6. Get the token for each tunnel.
7. Using the tunnel tokens, run Staging tunnel in your staging environment and run Production tunnel in your production environment. Refer to Install and run the tunnel.

To route overlapping IPs over virtual networks for locally-managed tunnels:

1. Create a tunnel for each private network:


Within your staging environment, authenticate cloudflared:
Terminal windowcloudflared login


Create a tunnel to connect your staging network to Cloudflare.
Terminal windowcloudflared tunnel create staging-tunnel


Within your production environment, authenticate cloudflared:
Terminal windowcloudflared login


Create a tunnel to connect your production network to Cloudflare.
Terminal windowcloudflared tunnel create production-tunnel
2. Within your staging environment, authenticate cloudflared:
Terminal windowcloudflared login
3. Create a tunnel to connect your staging network to Cloudflare.
Terminal windowcloudflared tunnel create staging-tunnel
4. Within your production environment, authenticate cloudflared:
Terminal windowcloudflared login
5. Create a tunnel to connect your production network to Cloudflare.
Terminal windowcloudflared tunnel create production-tunnel

The following steps may be executed from any cloudflared instance.

1. Create two unique virtual networks.
Terminal windowcloudflared tunnel vnet add staging-vnetcloudflared tunnel vnet add production-vnet
2. Before moving on, run the following command to verify that your newly created virtual networks are listed correctly:
Terminal windowcloudflared tunnel vnet list

Default virtual network

All accounts come pre-configured with a virtual network named default. You can choose a new default by typing cloudflared tunnel vnet update --default <virtual-network-name>.

1. Configure your tunnels with the IP/CIDR range of your private networks, and assign the tunnels to their respective virtual networks.
Terminal windowcloudflared tunnel route ip add --vnet staging-vnet 10.128.0.3/32 staging-tunnelcloudflared tunnel route ip add --vnet production-vnet 10.128.0.3/32 production-tunnel
2. Verify that the IP routes are listed correctly:
Terminal windowcloudflared tunnel route ip list
We now have two overlapping IP addresses routed over staging-vnet and production-vnet respectively.


Within your staging environment, create a configuration file for staging-tunnel. The configuration file will be structured as follows:
tunnel: <Tunnel-UUID>credentials-file: /root/.cloudflared/credentials-file.jsonwarp-routing:   enabled: true


Run your tunnel.
Terminal windowcloudflared tunnel run staging-tunnel


Within your production environment, repeat Steps 6 and 7 for production-tunnel.


You can use now the Cloudflare WARP client to switch between virtual networks.
3. Within your staging environment, create a configuration file for staging-tunnel. The configuration file will be structured as follows:
tunnel: <Tunnel-UUID>credentials-file: /root/.cloudflared/credentials-file.jsonwarp-routing:   enabled: true
4. Run your tunnel.
Terminal windowcloudflared tunnel run staging-tunnel
5. Within your production environment, repeat Steps 6 and 7 for production-tunnel.

## Delete a virtual network

- Dashboard
- Locally-managed tunnels

To delete a virtual network:

1. In Zero Trust ‚Üó, go to Networks > Tunnels and ensure that no IP routes are assigned to the virtual network you are trying to delete. If your virtual network is in use, delete the route or reassign it to a different virtual network.
2. Next, go to Settings > WARP Client.
3. Find the Virtual networks setting and select Manage.
4. Select the three-dot menu for your virtual network and select Delete.

You can optionally delete the tunnel associated with your virtual network.

To delete a virtual network for locally-managed tunnels:

1. Delete all IP routes in the virtual network. For example,
Terminal windowcloudflared tunnel route ip delete --vnet staging-vnet 10.128.0.3/32
2. (Optional) Delete the tunnel associated with the virtual network.
Terminal windowcloudflared tunnel delete staging-tunnel
3. Delete the virtual network.
Terminal windowcloudflared tunnel vnet delete staging-vnet

You can verify that the virtual network was successfully deleted by typing cloudflared tunnel vnet list.

## Connect to a virtual network

### Windows, macOS, and Linux

1. Open the WARP client.
2. Go to Settings > Gateway with WARP > Virtual Networks.
3. Choose the virtual network you want to connect to, for example staging-vnet.

When you visit 10.128.0.3/32, WARP will route your request to the staging environment.

### iOS, Android, and ChromeOS

1. Launch the Cloudflare One Agent app.
2. Go to Advanced > Connection options > Virtual networks.
3. Choose the virtual network you want to connect to, for example staging-vnet.

When you visit 10.128.0.3/32, WARP will route your request to the staging environment.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Load balancing

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/cloudflared/load-balancing/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/cloudflared/load-balancing/)

Page options # Load balancing

You can use Cloudflare Private Network Load Balancing to distribute traffic across private endpoints connected via Cloudflare Tunnel. Common use cases include:

- Load balancing internal employee traffic to internal applications
- Geosteering WARP traffic to internal applications
- Load balancing internal API calls

To set up load balancing for private IP addresses, refer to the Private Network Load Balancing documentation.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Peer-to-peer connectivity

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/warp-to-warp/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/warp-to-warp/)

Page options # Peer-to-peer connectivity

With Cloudflare Zero Trust, you can create a private network between any two or more devices running Cloudflare WARP. This means that you can have a private network between your phone and laptop without ever needing to be connected to the same physical network. If you already have an existing Zero Trust deployment, you can also enable this feature to add device-to-device connectivity to your private network with the press of a button. This will allow you to connect to any service that relies on TCP, UDP, or ICMP-based protocols through Cloudflare's network.

Users in your organization can reach these services by enrolling into your organization's Zero Trust account. Once enrolled, each device is assigned a virtual IP address in the 100.96.0.0/12 range which will allow users or systems to address these devices directly. Administrators will then be able to build Zero Trust policies to determine who within your organization can reach those virtual IPs.

This guide covers how to:

- Enable WARP-to-WARP connectivity to establish a private network between your devices.
- Manage Split Tunnel preferences for the WARP client to determine what traffic should be routed to the Cloudflare global network.
- Create Zero Trust security policies to restrict access.
- Connect to virtual IP spaces from WARP devices without any client-side configuration changes.

## Prerequisites

- Install the Cloudflare WARP client on your devices.
- Define device enrollment permissions.
- Enroll your devices in your Zero Trust organization.‚Äã‚Äã

## Enable WARP-to-WARP

1. In Zero Trust ‚Üó, go to Settings > Network.
2. Enable Proxy.
3. Enable Warp-to-Warp. This allows Cloudflare to route traffic to the CGNAT IP space.
4. In your Split Tunnel configuration, ensure that traffic to 100.96.0.0/12 is going through WARP:

- If using Exclude mode, delete 100.64.0.0/10 from the list and re-add 100.64.0.0/11 and 100.112.0.0/12.
- If using Include mode, add 100.96.0.0/12 to your list.

This will instruct WARP to begin proxying any traffic destined for a 100.96.0.0/12 IP address to Cloudflare for routing and policy enforcement.

## Connect via WARP

Once enrolled, your users and services will be able to connect to the virtual IPs configured for TCP, UDP, or ICMP-based traffic. You can optionally create Gateway network policies to define the users and devices that can access the 100.96.0.0/12 IP space.

## Troubleshooting

### Check your firewall

Verify that your local firewall allows traffic from the WARP CGNAT IPs. For example, Windows Firewall blocks inbound traffic from 100.96.0.0/12 by default. On Windows devices, you will need to add a firewall rule that allows incoming requests from 100.96.0.0/12 for the desired protocols and/or ports.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## WARP Connector

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/warp-connector/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/warp-connector/)

Page options # WARP Connector

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP | All plans |

| System | Availability |
| --- | --- |
| Windows | ‚ùå |
| macOS | ‚ùå |
| Linux | ‚úÖ |
| iOS | ‚ùå |
| Android | ‚ùå |
| ChromeOS | ‚ùå |

Note

WARP Connector is not currently supported in accounts that have Magic WAN enabled.

Cloudflare WARP Connector (beta) is a software client1 that enables site-to-site, bidirectional, and mesh networking connectivity without requiring changes to underlying network routing infrastructure. WARP Connector establishes a secure Layer 3 proxy between a private network and Cloudflare, allowing you to:

- Connect two or more private networks to each other.
- Connect IoT devices that cannot run external software, such as printers and IP phones.
- Filter and log server-initiated traffic, such as VoIP and SIP traffic.
- Apply Zero Trust security policies based on the source IP of the request.

As shown in the diagram, WARP Connector acts as a router for a subnet within the private network to on-ramp and off-ramp traffic through Cloudflare. All devices on the subnet can access any services connected to Cloudflare, and all devices connected to Cloudflare can access any services on the subnet. Each subnet runs a WARP Connector on a designated Linux machine (typically the default gateway router), but other devices on the network do not need to install software.

To set up WARP Connector, refer to the guide for your use case:

- Site-to-Internet: Send requests from your private network to the Internet.
- Site-to-site: Send requests between two or more private networks.
- User-to-site: Allow WARP client devices to send requests to your private network.
- Internet-to-site: Not supported by WARP Connector. To provide clientless access to applications on your private network, set up a Cloudflare Tunnel with cloudflared and configure a public hostname route.

## Footnotes

1. WARP Connector is an extension of the WARP client. ‚Ü©

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect private network to Internet

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/warp-connector/site-to-internet/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/warp-connector/site-to-internet/)

Page options # Connect private network to Internet

This guide covers how to connect a private network to the Internet using WARP Connector. In this example, we will create a WARP Connector for subnet 10.0.0.0/24 and install it on 10.0.0.1.

```
flowchart LR
      subgraph subnet1[Subnet 10.0.0.0/24]
        device1["Device
        10.0.0.2"]-->router1["WARP Connector
        10.0.0.1"]
      end
      router1-->C((Cloudflare))-->I{Internet}
```

## Prerequisites

- A Linux host 1 on the subnet
- Verify that your firewall allows inbound/outbound traffic over the WARP IP addresses, ports, and domains.

## 1. Install a WARP Connector

To install WARP Connector on a host machine:

1. In Zero Trust ‚Üó, go to Networks > Tunnels.
2. Select Create a tunnel.
3. For the tunnel type, select WARP Connector.
4. You will be prompted to turn on Warp to Warp and Override local interface IP if they are currently turned off. These settings allow Cloudflare to assign a unique CGNAT IP to each WARP device and route traffic between them.
5. Give the tunnel any name (for example, Subnet-10.0.0.0/24) and select Create tunnel.
6. Select the operating system of your host machine.
7. On your host machine, open a terminal window and run the commands shown in the Zero Trust dashboard. Those commands will install the WARP Connector, enable IP forwarding on the host, and connect WARP Connector to your Zero Trust organization.
Remote SSH connectionsIf you are managing the deployment remotely over SSH, your connection may drop when you install the WARP Connector. Because the WARP connector immediately starts forwarding traffic to Cloudflare, the remote SSH server's traffic will now route via Cloudflare instead of via the server's public IP. To work around the issue:

Option 1: In your WARP Connector device profile, temporarily add the public IP of your local machine to the Split Tunnel Exclude list.


Option 2: If your local machine is connected to Zero Trust (for example, via the WARP client), you can SSH to the CGNAT IP of the WARP Connector. Traffic to the CGNAT IP must route through the WARP tunnel.
8. Option 1: In your WARP Connector device profile, temporarily add the public IP of your local machine to the Split Tunnel Exclude list.
9. Option 2: If your local machine is connected to Zero Trust (for example, via the WARP client), you can SSH to the CGNAT IP of the WARP Connector. Traffic to the CGNAT IP must route through the WARP tunnel.
10. (Optional) Configure IP forwarding:
 Enable IP forwarding to persist after reboot
 Terminal windowecho 'net.ipv4.ip_forward = 1' | sudo tee -a /etc/sysctl.d/99-warp-svc.confsudo sysctl -p /etc/sysctl.d/99-warp-svc.conf 
 Configure IP forwarding with iptables
 If you are setting up WARP Connector on a host with iptables enabled, make sure that your iptables FORWARD chain includes rules to accept the desired traffic. For testing and troubleshooting purposes, you can set the default policy for the WARP interface to ACCEPT:Terminal windowiptables -A FORWARD -i CloudflareWARP -J ACCEPTiptables -A FORWARD -o CloudflareWARP -J ACCEPT
11. To verify that the WARP Connector is connected to Cloudflare:
Terminal window$ warp-cli statusStatus update: Connected
 Troubleshoot connection
 If WARP is disconnected, try the following troubleshooting strategies:

Run warp-cli connect.


If your private network uses a firewall to restrict Internet traffic, ensure that it allows the WARP ports and IPs.


Review your WARP daemon logs for information about why the connection is failing.
12. Run warp-cli connect.
13. If your private network uses a firewall to restrict Internet traffic, ensure that it allows the WARP ports and IPs.
14. Review your WARP daemon logs for information about why the connection is failing.

WARP Connector software is now installed but not yet routing traffic.

## 2. (Recommended) Create a device profile

A dedicated device profile allows you to manage the WARP Connector host machine separately from WARP client user devices. WARP Connector hosts are registered to your Zero Trust organization with the email address warp_connector@<your-team-name>.cloudflareaccess.com. To set up a device profile for WARP Connector:

1. Create a new profile that matches on the following expression:















SelectorOperatorValueUser emailiswarp_connector@<your-team-name>.cloudflareaccess.com
2. In the profile settings, ensure that Service mode is set to Gateway with WARP.

Note

warp_connector@<your-team-name>.cloudflareaccess.com will only match WARP Connectors deployed with WARP client version 2024.9.346.0 and above. WARP Connectors deployed using the legacy workflow will use the generic email for service token registrations (non-identity@<your-team-name>.cloudflareaccess.com).

## 3. Route traffic from subnet to WARP Connector

Depending on where you installed the WARP Connector, you may need to configure other devices on the subnet to route outbound requests through WARP Connector.

### Option 1: Default gateway

If you installed WARP Connector on your router, no additional configuration is necessary. All traffic will use the router as the default gateway.

### Option 2: Alternate gateway

If you have access to the router but installed WARP Connector on another machine, you can configure the router to forward traffic to the WARP Connector. This typically involves adding a static route for the destination IPs that you want to connect to through Cloudflare. Refer to your router documentation for specific instructions on how to add an IP route.

#### Add route to router

For example, for all traffic from the subnet to egress through WARP Connector, add a rule on the router that routes 0.0.0.0 to the WARP Connector host machine (10.0.0.100).

When a device on the subnet sends a request, the router will first redirect the traffic to the WARP Connector host. WARP Connector encrypts the traffic, changes its destination IP to the WARP ingress IP, and sends it back to the router. The router will now forward this encrypted traffic to Cloudflare.

Note

Ensure that your routing rules do not forward the WARP ingress IP back to the WARP Connector.

### Option 3: Intermediate gateway

If you do not have access to the router, you will need to configure each device on the subnet to egress through the WARP Connector machine instead of the default gateway.

#### Add route to devices

You can configure all traffic on a device to egress through WARP Connector with its local source IP. All traffic will be filtered by your Gateway network policies.

- Linux
- macOS
- Windows

Terminal window ```
sudo ip route add default via <WARP-CONNECTOR-IP> dev eth0 metric 101
```

Ensure that the metric value is lower than other default gateways.

Terminal window ```
sudo route -n change default <WARP-CONNECTOR-IP> -interface en0
```

Terminal window ```
route /p add 0.0.0.0 mask 0.0.0.0 <WARP-CONNECTOR-IP> metric 101
```

Ensure that the metric value is lower than other default gateways.

#### Verify routes

To validate subnet routing, check your routing table and ensure that traffic is routing through the CloudflareWARP virtual interface.

## 4. Test the WARP Connector

You can now test if traffic from your subnet routes through Cloudflare. For example,

1. On the 10.0.0.2 device, run curl --ipv4 www.google.com.
2. Check your Gateway DNS logs for queries from warp_connector@<your-team-name>.cloudflareaccess.com. Logs may take a few minutes to populate.

```
flowchart LR
      subgraph subnet1[Subnet 10.0.0.0/24]
        device1["Device
        10.0.0.2"]--Request-->router1["WARP Connector
        10.0.0.1"]
      end
      router1-->C((Cloudflare))-->I{Internet}
```

## Footnotes

1. Check the system requirements. Package dependencies are the following: curl, gpg, iptables, iptables-persistent, lsb-core, and sudo.
‚Ü©

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect two or more private networks

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/warp-connector/site-to-site/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/warp-connector/site-to-site/)

Page options # Connect two or more private networks

This guide covers how to connect two independent subnets with WARP Connector. Each subnet must run its own WARP Connector on a Linux host. Installing on your router is the simplest setup, but if you do not have access to the router, you may choose any other machine on the subnet.

```
flowchart LR
      subgraph subnet1[Subnet 10.0.0.0/24]
      router1["WARP Connector #1
        10.0.0.1"]
      end
      subgraph subnet2[Subnet 192.168.1.0/24]
        router2["WARP Connector #2
        192.168.1.97"]
      end
      router1<-->C((Cloudflare))<-->router2
```

In this example, we will create a WARP Connector for subnet 10.0.0.0/24 and install it on 10.0.0.1. We will then create a second WARP Connector for subnet 192.168.1.0/24 and install it on 192.168.1.97.

## Prerequisites

- A Linux host 1 on each subnet.
- Verify that your firewall allows inbound/outbound traffic over the WARP IP addresses, ports, and domains.

## 1. Install a WARP Connector

To install WARP Connector on a host machine:

1. In Zero Trust ‚Üó, go to Networks > Tunnels.
2. Select Create a tunnel.
3. For the tunnel type, select WARP Connector.
4. You will be prompted to turn on Warp to Warp and Override local interface IP if they are currently turned off. These settings allow Cloudflare to assign a unique CGNAT IP to each WARP device and route traffic between them.
5. Give the tunnel any name (for example, Subnet-10.0.0.0/24) and select Create tunnel.
6. Select the operating system of your host machine.
7. On your host machine, open a terminal window and run the commands shown in the Zero Trust dashboard. Those commands will install the WARP Connector, enable IP forwarding on the host, and connect WARP Connector to your Zero Trust organization.
Remote SSH connectionsIf you are managing the deployment remotely over SSH, your connection may drop when you install the WARP Connector. Because the WARP connector immediately starts forwarding traffic to Cloudflare, the remote SSH server's traffic will now route via Cloudflare instead of via the server's public IP. To work around the issue:

Option 1: In your WARP Connector device profile, temporarily add the public IP of your local machine to the Split Tunnel Exclude list.


Option 2: If your local machine is connected to Zero Trust (for example, via the WARP client), you can SSH to the CGNAT IP of the WARP Connector. Traffic to the CGNAT IP must route through the WARP tunnel.
8. Option 1: In your WARP Connector device profile, temporarily add the public IP of your local machine to the Split Tunnel Exclude list.
9. Option 2: If your local machine is connected to Zero Trust (for example, via the WARP client), you can SSH to the CGNAT IP of the WARP Connector. Traffic to the CGNAT IP must route through the WARP tunnel.
10. (Optional) Configure IP forwarding:
 Enable IP forwarding to persist after reboot
 Terminal windowecho 'net.ipv4.ip_forward = 1' | sudo tee -a /etc/sysctl.d/99-warp-svc.confsudo sysctl -p /etc/sysctl.d/99-warp-svc.conf 
 Configure IP forwarding with iptables
 If you are setting up WARP Connector on a host with iptables enabled, make sure that your iptables FORWARD chain includes rules to accept the desired traffic. For testing and troubleshooting purposes, you can set the default policy for the WARP interface to ACCEPT:Terminal windowiptables -A FORWARD -i CloudflareWARP -J ACCEPTiptables -A FORWARD -o CloudflareWARP -J ACCEPT
11. To verify that the WARP Connector is connected to Cloudflare:
Terminal window$ warp-cli statusStatus update: Connected
 Troubleshoot connection
 If WARP is disconnected, try the following troubleshooting strategies:

Run warp-cli connect.


If your private network uses a firewall to restrict Internet traffic, ensure that it allows the WARP ports and IPs.


Review your WARP daemon logs for information about why the connection is failing.
12. Run warp-cli connect.
13. If your private network uses a firewall to restrict Internet traffic, ensure that it allows the WARP ports and IPs.
14. Review your WARP daemon logs for information about why the connection is failing.

WARP Connector software is now installed but not yet routing traffic.

## 2. (Recommended) Create a device profile

A dedicated device profile allows you to manage the WARP Connector host machine separately from WARP client user devices. WARP Connector hosts are registered to your Zero Trust organization with the email address warp_connector@<your-team-name>.cloudflareaccess.com. To set up a device profile for WARP Connector:

1. Create a new profile that matches on the following expression:















SelectorOperatorValueUser emailiswarp_connector@<your-team-name>.cloudflareaccess.com
2. In the profile settings, ensure that Service mode is set to Gateway with WARP.

Note

warp_connector@<your-team-name>.cloudflareaccess.com will only match WARP Connectors deployed with WARP client version 2024.9.346.0 and above. WARP Connectors deployed using the legacy workflow will use the generic email for service token registrations (non-identity@<your-team-name>.cloudflareaccess.com).

## 3. Route traffic from WARP Connector to subnet

1. In Zero Trust ‚Üó, go to Networks > Routes.
2. Select Create route.
3. In CIDR, enter the private IPv4 address range that you wish to route through this WARP Connector (for example, 10.0.0.0/24). WARP Connector does not currently support IPv6 routes.
NoteIf you do not already have a private network range, you can choose a subnet from one of these pre-defined CIDRs ‚Üó.
4. For Tunnel, select the name of your WARP Connector (Subnet-10.0.0.0/24).
5. Select Create.
6. In your WARP Connector device profile, configure Split Tunnels so that traffic to your private network CIDR (10.0.0.0/24) routes through the WARP tunnel. For example, if you are using Exclude mode, delete 10.0.0.0/8 from Split Tunnels and re-add the following IPs: 10.0.1.0/24, 10.0.2.0/23, 10.0.4.0/22, 10.0.8.0/21, 10.0.16.0/20, 10.0.32.0/19, 10.0.64.0/18, 10.0.128.0/17, 10.1.0.0/16, 10.2.0.0/15, 10.4.0.0/14, 10.8.0.0/13, 10.16.0.0/12, 10.32.0.0/11, 10.64.0.0/10, 10.128.0.0/9

The WARP Connector will now forward inbound requests to devices on the subnet.

```
flowchart LR
      subgraph subnet1[Subnet 10.0.0.0/24]
      router1["WARP Connector #1
        10.0.0.1"]
			device["Device
        10.0.0.2"]
      end

      C((Cloudflare))--Requests to 10.0.0.2--> router1 --> device
```

## 4. Route traffic from subnet to WARP Connector

Depending on where you installed the WARP Connector, you may need to configure other devices on the subnet to route outbound requests through WARP Connector.

```
flowchart LR
      subgraph subnet1[Subnet 10.0.0.0/24]
      router1["WARP Connector #1
        10.0.0.1"]
			device["Device
        10.0.0.2"]
      end

      device --Requests to
			192.168.1.0/24 --> router1 --> C((Cloudflare))
```

### Option 1: Default gateway

If you installed WARP Connector on your router, no additional configuration is necessary. All traffic will use the router as the default gateway.

### Option 2: Alternate gateway

If you have access to the router but installed WARP Connector on another machine, you can configure the router to forward traffic to the WARP Connector. This typically involves adding a static route for the destination IPs that you want to connect to through Cloudflare. Refer to your router documentation for specific instructions on how to add an IP route.

#### Add route to router

For example, for devices on subnet 10.0.0.0/24 to reach applications behind subnet 192.168.1.0/24, add a rule on the router that routes 192.168.1.0/24 to the WARP Connector host machine (10.0.0.100).

When a device on the subnet sends a request, the router will first redirect the traffic to the WARP Connector host. WARP Connector encrypts the traffic, changes its destination IP to the WARP ingress IP, and sends it back to the router. The router will now forward this encrypted traffic to Cloudflare.

Note

Ensure that your routing rules do not forward the WARP ingress IP back to the WARP Connector.

### Option 3: Intermediate gateway

If you do not have access to the router, you will need to configure each device on the subnet to egress through the WARP Connector machine instead of the default gateway.

#### Add route to devices

You can configure all traffic on a device to egress through WARP Connector with its local source IP. All traffic will be filtered by your Gateway network policies.

- Linux
- macOS
- Windows

Terminal window ```
sudo ip route add default via <WARP-CONNECTOR-IP> dev eth0 metric 101
```

Ensure that the metric value is lower than other default gateways.

Terminal window ```
sudo route -n change default <WARP-CONNECTOR-IP> -interface en0
```

Terminal window ```
route /p add 0.0.0.0 mask 0.0.0.0 <WARP-CONNECTOR-IP> metric 101
```

Ensure that the metric value is lower than other default gateways.

Alternatively, you can configure only certain routes to egress through WARP Connector. For example, you may only want to filter traffic destined to internal applications and devices, but allow public Internet traffic to bypass Cloudflare.

- Linux
- macOS
- Windows

Terminal window ```
sudo ip route add <DESTINATION-IP> via <WARP-CONNECTOR-IP> dev eth0
```

Terminal window ```
sudo route -n add -net <DESTINATION-IP> <WARP-CONNECTOR-IP>
```

Terminal window ```
route /p add <DESTINATION-IP> mask 255.255.255.255 <WARP-CONNECTOR-IP>
```

#### Verify routes

To validate subnet routing, check your routing table and ensure that traffic is routing through the CloudflareWARP virtual interface.

## 5. Install another WARP Connector

Repeat steps 1, 3, and 4 above to install an additional WARP Connector on subnet 192.168.1.0/24. The device profile created in Step 2 will apply to all WARP Connectors.

```
flowchart LR
      subgraph subnet1[Subnet 10.0.0.0/24]
      router1["WARP Connector #1
        10.0.0.1"]
      end
      subgraph subnet2[Subnet 192.168.1.0/24]
        router2["WARP Connector #2
        192.168.1.97"]
      end
      router1<-->C((Cloudflare))<-->router2
```

## 6. Test the WARP Connector

You can now test the connection between the two subnets. For example, on the 10.0.0.2 device run ping 192.168.1.100.

```
flowchart LR
      subgraph subnet1[Subnet 10.0.0.0/24]
        device1["Device
        10.0.0.2"]--"ping
        192.168.1.100"-->router1["WARP Connector #1
        10.0.0.1"]
      end
      subgraph subnet2[Subnet 192.168.1.0/24]
        router2["WARP Connector #2
        192.168.1.97"]-->device2["Device
        192.168.1.100"]
      end
      router1-->C((Cloudflare))-->router2
```

Note

If you are testing with curl using private hostnames, add the --ipv4 flag to your curl commands.

## Footnotes

1. Check the system requirements. Package dependencies are the following: curl, gpg, iptables, iptables-persistent, lsb-core, and sudo.
‚Ü©

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect private network to WARP clients

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/warp-connector/user-to-site/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/warp-connector/user-to-site/)

Page options # Connect private network to WARP clients

This guide covers how to connect WARP client user devices to a private network behind WARP Connector. In this example, we will create a WARP Connector for subnet 10.0.0.0/24 and install it on 10.0.0.1.

```
flowchart LR
      subgraph subnet1[Subnet 10.0.0.0/24]
				router1["WARP Connector
        10.0.0.1"]--> device1["Device
        10.0.0.2"]
      router1["WARP Connector
        10.0.0.1"]
      end
      W[WARP clients]-->C((Cloudflare))-->router1
```

## Prerequisites

- A Linux host 1 on the subnet.
- For WARP Connector to connect to Cloudflare services, your firewall should allow inbound/outbound traffic for the WARP IP addresses, ports, and domains.
- For WARP clients to connect to your subnet, your firewall should allow inbound traffic from the WARP CGNAT IP range: 100.96.0.0/12

## 1. Install a WARP Connector

To install WARP Connector on a host machine:

1. In Zero Trust ‚Üó, go to Networks > Tunnels.
2. Select Create a tunnel.
3. For the tunnel type, select WARP Connector.
4. You will be prompted to turn on Warp to Warp and Override local interface IP if they are currently turned off. These settings allow Cloudflare to assign a unique CGNAT IP to each WARP device and route traffic between them.
5. Give the tunnel any name (for example, Subnet-10.0.0.0/24) and select Create tunnel.
6. Select the operating system of your host machine.
7. On your host machine, open a terminal window and run the commands shown in the Zero Trust dashboard. Those commands will install the WARP Connector, enable IP forwarding on the host, and connect WARP Connector to your Zero Trust organization.
Remote SSH connectionsIf you are managing the deployment remotely over SSH, your connection may drop when you install the WARP Connector. Because the WARP connector immediately starts forwarding traffic to Cloudflare, the remote SSH server's traffic will now route via Cloudflare instead of via the server's public IP. To work around the issue:

Option 1: In your WARP Connector device profile, temporarily add the public IP of your local machine to the Split Tunnel Exclude list.


Option 2: If your local machine is connected to Zero Trust (for example, via the WARP client), you can SSH to the CGNAT IP of the WARP Connector. Traffic to the CGNAT IP must route through the WARP tunnel.
8. Option 1: In your WARP Connector device profile, temporarily add the public IP of your local machine to the Split Tunnel Exclude list.
9. Option 2: If your local machine is connected to Zero Trust (for example, via the WARP client), you can SSH to the CGNAT IP of the WARP Connector. Traffic to the CGNAT IP must route through the WARP tunnel.
10. (Optional) Configure IP forwarding:
 Enable IP forwarding to persist after reboot
 Terminal windowecho 'net.ipv4.ip_forward = 1' | sudo tee -a /etc/sysctl.d/99-warp-svc.confsudo sysctl -p /etc/sysctl.d/99-warp-svc.conf 
 Configure IP forwarding with iptables
 If you are setting up WARP Connector on a host with iptables enabled, make sure that your iptables FORWARD chain includes rules to accept the desired traffic. For testing and troubleshooting purposes, you can set the default policy for the WARP interface to ACCEPT:Terminal windowiptables -A FORWARD -i CloudflareWARP -J ACCEPTiptables -A FORWARD -o CloudflareWARP -J ACCEPT
11. To verify that the WARP Connector is connected to Cloudflare:
Terminal window$ warp-cli statusStatus update: Connected
 Troubleshoot connection
 If WARP is disconnected, try the following troubleshooting strategies:

Run warp-cli connect.


If your private network uses a firewall to restrict Internet traffic, ensure that it allows the WARP ports and IPs.


Review your WARP daemon logs for information about why the connection is failing.
12. Run warp-cli connect.
13. If your private network uses a firewall to restrict Internet traffic, ensure that it allows the WARP ports and IPs.
14. Review your WARP daemon logs for information about why the connection is failing.

WARP Connector software is now installed but not yet routing traffic.

## 2. (Recommended) Create a device profile

A dedicated device profile allows you to manage the WARP Connector host machine separately from WARP client user devices. WARP Connector hosts are registered to your Zero Trust organization with the email address warp_connector@<your-team-name>.cloudflareaccess.com. To set up a device profile for WARP Connector:

1. Create a new profile that matches on the following expression:















SelectorOperatorValueUser emailiswarp_connector@<your-team-name>.cloudflareaccess.com
2. In the profile settings, ensure that Service mode is set to Gateway with WARP.

Note

warp_connector@<your-team-name>.cloudflareaccess.com will only match WARP Connectors deployed with WARP client version 2024.9.346.0 and above. WARP Connectors deployed using the legacy workflow will use the generic email for service token registrations (non-identity@<your-team-name>.cloudflareaccess.com).

## 3. Route CGNAT IPs through Cloudflare

WARP clients and WARP Connectors are accessed using their CGNAT IP. Therefore, CGNAT IP traffic must route through Cloudflare on both the WARP Connector host and WARP client devices.

1. In your WARP Connector device profile, go to Split Tunnels.
2. Ensure that 100.96.0.0/12 routes through the WARP tunnel. For example, if you are using Exclude mode, delete 100.64.0.0/10 from the list and re-add 100.64.0.0/11 and 100.112.0.0/12.
3. Repeat the previous steps for all WARP client device profiles.

## 4. Route traffic from subnet to WARP Connector

Depending on where you installed the WARP Connector, you may need to configure other devices on the subnet to route requests through WARP Connector.

### Option 1: Default gateway

If you installed WARP Connector on your router, no additional configuration is necessary. All traffic will use the router as the default gateway.

### Option 2: Alternate gateway

If you have access to the router but installed WARP Connector on another machine, you can configure the router to forward traffic to the WARP Connector. This typically involves adding a static route for the destination IPs that you want to connect to through Cloudflare. Refer to your router documentation for specific instructions on how to add an IP route.

#### Add route to router

100.96.0.0/12 is the default CIDR for all user devices running the WARP client. On your router, add a rule that routes the destination IP 100.96.0.0/12 to the WARP Connector host machine (10.0.0.100).

When a device on the subnet sends a request, the router will first redirect the traffic to the WARP Connector host. WARP Connector encrypts the traffic, changes its destination IP to the WARP ingress IP, and sends it back to the router. The router will now forward this encrypted traffic to Cloudflare.

Note

Ensure that your routing rules do not forward the WARP ingress IP back to the WARP Connector.

### Option 3: Intermediate gateway

If you do not have access to the router, you will need to configure each device on the subnet to egress through the WARP Connector machine instead of the default gateway.

#### Add route to devices

To route all CGNAT IP traffic through WARP Connector:

- Linux
- macOS
- Windows

Terminal window ```
sudo ip route add 100.96.0.0/12 via <WARP-CONNECTOR-IP> dev eth0
```

Terminal window ```
sudo route -n add -net 100.96.0.0/12 <WARP-CONNECTOR-IP>
```

Terminal window ```
route /p add 100.96.0.0/12 mask 255.255.255.255 <WARP-CONNECTOR-IP>
```

#### Verify routes

To validate subnet routing, check your routing table and ensure that traffic is routing through the CloudflareWARP virtual interface.

## 5. Test the WARP Connector

You can now send a request from a WARP client user device to a device behind WARP connector. For example, on the WARP client device run ping 10.0.0.2.

```
flowchart LR
      subgraph subnet1[Subnet 10.0.0.0/24]
				router1["WARP Connector
        10.0.0.1"]--> device1["Device
        10.0.0.2"]
      router1["WARP Connector
        10.0.0.1"]
      end
      W[WARP client]--ping 10.0.0.2 -->C((Cloudflare))-->router1
```

## Footnotes

1. Check the system requirements. Package dependencies are the following: curl, gpg, iptables, iptables-persistent, lsb-core, and sudo.
‚Ü©

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tips for VPC deployments

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/warp-connector/vpc-deployments/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/private-net/warp-connector/vpc-deployments/)

Page options # Tips for VPC deployments

When setting up WARP Connector on a virtual private cloud (VPC), you may need to configure additional settings in the cloud service provider.

## GCP

For Google Cloud Project (GCP) deployments, enable IP forwarding ‚Üó on the VM instance where you installed WARP Connector.

## AWS

For Amazon Web Services (AWS) deployments:

- Stop source/destination checking ‚Üó on the EC2 instance where you installed WARP Connector.
- In your subnet route table ‚Üó, route all IPv4 traffic to the EC2 instance where you installed WARP Connector. For example,













DestinationTarget0.0.0.0/0eni-11223344556677889

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Public hostnames

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/routing-to-tunnel/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/routing-to-tunnel/)

Page options # Public hostnames

With Cloudflare Tunnel, you can expose your HTTP resources to the Internet via a public hostname. For example, you can add a route that points docs.example.com to localhost:8080. Anyone can now view your local application by going to docs.example.com in their web browser.

Cloudflare can route traffic to your Cloudflare Tunnel connection using a DNS record or Cloudflare Load Balancer. You can configure either option from the Cloudflare dashboard by pointing a DNS CNAME record or a load balancer pool to the Cloudflare Tunnel subdomain for your connection. You can also associate these records with your tunnel from cloudflared directly.

Note

You do not need a paid Cloudflare Access plan to publish an application via Cloudflare Tunnel. Access seats are only required if you want to secure the application using Access policies, such as requiring users to log in via an identity provider.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## DNS records

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/routing-to-tunnel/dns/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/routing-to-tunnel/dns/)

Page options # DNS records

When you create a tunnel, Cloudflare generates a subdomain of cfargotunnel.com with the UUID of the created tunnel. You can treat <UUID>.cfargotunnel.com as if it were an origin target in the Cloudflare dashboard.

Unlike publicly routable IP addresses, the subdomain will only proxy traffic for a DNS record in the same Cloudflare account. If someone discovers your subdomain UUID, they will not be able to create a DNS record in another account or system to proxy traffic to the address.

## Create a DNS record for the tunnel

- Dashboard
- cli

To create a new DNS record for your tunnel:

1. Log in to the Cloudflare dashboard ‚Üó and select your account and domain.
2. Go to DNS > Records.
3. Select Add record.
4. Input the following information:

Type: CNAME
Name: Subdomain of your application
Target: <UUID>.cfargotunnel.com
5. Type: CNAME
6. Name: Subdomain of your application
7. Target: <UUID>.cfargotunnel.com
8. Select Save.

You can create a new DNS record directly from cloudflared:

Terminal window ```
cloudflared tunnel route dns <UUID or NAME> www.app.com
```

This command create a CNAME record that points to the tunnel subdomain, but will not proxy traffic if the tunnel is not currently running.

Note

To create DNS records using cloudflared, the cert.pem file must be installed on your system.

The DNS record is distinct from the state of the tunnel. You can create DNS records that point to a tunnel that is not currently running. If the tunnel stops running, the DNS record will not be deleted. If you point the DNS record to a tunnel not currently running, visitors will see a 1016 error message.

Additionally, you can create multiple DNS records that point to the same tunnel subdomain. If you are routing traffic from multiple hostnames to multiple services, you will need to create a CNAME entry for each hostname. The CNAME entries will share the same target.

## Optional Cloudflare settings

The application will default to the Cloudflare settings of the hostname in your account that includes the Cloudflare Tunnel DNS record, including cache rules and firewall policies. You can changes these settings for your hostname in Cloudflare's dashboard.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Load balancing

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/routing-to-tunnel/lb/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/routing-to-tunnel/lb/)

Page options # Load balancing

When you create a tunnel, Cloudflare generates a subdomain of cfargotunnel.com with the UUID of the created tunnel. You can treat <UUID>.cfargotunnel.com as if it were a Load Balancing endpoint in the Cloudflare dashboard.

Unlike publicly routable IP addresses, the subdomain will only proxy traffic for a load balancer pool in the same Cloudflare account. If someone discovers your subdomain UUID, they will not be able to create a DNS record in another account or system to proxy traffic to the address.

## Add a tunnel to a load balancer pool

- Dashboard
- cli

To create a load balancer, refer to the Load Balancing documentation. The endpoint address is the subdomain of your tunnel, <UUID>.cfargotunnel.com.

If you want to add a monitor to your load balancer pool, you will need to add a host header to Advanced health check settings. The header will be similar to Header Name: Host and Value: www.your-zone.com. The monitor will not work without the host header if you are using a config file that defines the ingress field, as shown in this example ‚Üó.

You can add Cloudflare Tunnel to an existing load balancer pool directly from cloudflared:

Terminal window ```
cloudflared tunnel route lb <tunnel name/uuid> <hostname> <load balancer pool>
```

- <hostname>: the DNS hostname of the load balancer, for example lb.example.com.
- <load balancer pool>: the name of the pool that will contain the tunnel subdomain.

This command creates an LB DNS record that points the specified hostname to the subdomain of your tunnel (<UUID>.cfargotunnel.com). Traffic will not be proxied unless the tunnel is running.

Note

To create DNS records using cloudflared, the cert.pem file must be installed on your system.

## Optional Cloudflare settings

The application will default to the Cloudflare settings for the load balancer hostname, including cache rules and firewall policies. You can change the settings for your hostname in the Cloudflare dashboard ‚Üó.

## Known limitations

### Monitors and TCP Tunnel origins

If you have a tunnel to a port or SSH port, do not run a TCP health check.

Instead, set up a health check endpoint in cloudflared ‚Äî for example, an ingress entry rule that returns a fixed HTTP status response ‚Äî and create an HTTP monitor for that endpoint. The monitor will only verify that your server is reachable. It does not check whether the server is running and accepting requests.

### Session affinity and replicas

The load balancer does not distinguish between replicas of the same tunnel. If you run the same tunnel UUID on two separate hosts, the load balancer treats both hosts as a single endpoint. To maintain session affinity between a client and a particular host, you will need to connect each host to Cloudflare using a different tunnel UUID.

### Local connection preference

If you notice traffic imbalances across endpoints in different locations, you may have to adjust your load balancer setup.

cloudflared connections give preference to tunnels that terminate in the same Cloudflare data center. This behavior can impact how connections are weighted and traffic is distributed.

The solution depends on the type of tunnel being used. If running legacy tunnels, put your origins in different pools. If running Cloudflare tunnel replicas (using a shared ID), switch to separate Cloudflare tunnels as distinct origins.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Monitor tunnels

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/monitor-tunnels/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/monitor-tunnels/)

Page options # Monitor tunnels

- Log streams
- Notifications
- Metrics

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Log streams

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/monitor-tunnels/logs/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/monitor-tunnels/logs/)

Page options # Log streams

Tunnel logs record all activity between a cloudflared instance and Cloudflare's global network, as well as all activity between cloudflared and your origin server. These logs allow you to investigate connectivity or performance issues with a Cloudflare Tunnel. You can configure your server to store persistent logs, or you can stream real-time logs from any client machine.

## View logs on the server

If you have access to the origin server, you can use the --loglevel flag to enable logging when you start the tunnel. By default, cloudflared prints logs to stdout and does not store logs on the server. You can optionally use the --logfile flag to write your logs to a file.

To enable logs for a locally-managed tunnel:

Terminal window ```
cloudflared tunnel --loglevel debug --logfile cloudflared.log run <UUID>
```

To enable logs for a remotely-managed tunnel, add --loglevel debug and --logfile <PATH> to your system service as shown in Add tunnel run parameters.

## View logs on your local machine

You can view real-time logs for a Cloudflare Tunnel via the dashboard or from any machine that has cloudflared installed. With remote log streams, you do not need to SSH into the server that is running the tunnel. To get remote logs, the tunnel must be active and able to receive requests.

### Dashboard

Dashboard log streams are only available for remotely-managed tunnels. To view logs from the dashboard:

1. In Zero Trust ‚Üó, go to Networks > Tunnels and select a remotely-managed tunnel.
2. In the sidebar, select the Connector ID for the cloudflared instance you want to view.
3. Select Begin log stream.

### CLI

The cloudflared daemon can stream logs from any tunnel in your account to the local command line. cloudflared must be installed on both your local machine and the origin server.

#### View logs

1. On your local machine, authenticate cloudflared to your Zero Trust account:
Terminal windowcloudflared tunnel login
2. Run cloudflared tail for a specific tunnel:
Terminal windowcloudflared tail <UUID>
For a more structured view of the JSON message, you can pipe the output to tools like jq ‚Üó:
Terminal windowcloudflared tail --output=json <UUID> | jq .

#### Filter logs

You can filter logs by event type (--event), event level (--level), or sampling rate (-sampling) to reduce the volume of logs streamed from the origin. This helps mitigate the performance impact on the origin, especially when the origin is normally under high load. For example:

Terminal window ```
cloudflared tail --level debug <UUID>
```

| Flag | Description | Allowed values | Default value |
| --- | --- | --- | --- |
| --event | Filter by the type of event / request. | cloudflared, http, tcp, udp | All events |
| --level | Return logs at this level and above. Works independently of the --loglevel setting on the server. | debug, info, warn, error, fatal | debug |
| --sampling | Sample a fraction of the total logs. | Number from 0.0 to 1.0 | 1.0 |
|  |  |  |  |

#### View logs for a replica

If you are running multiple cloudflared instances for the same tunnel (also known as replicas), you must specify an individual instance to stream logs from:

1. In Zero Trust ‚Üó, go to Networks > Tunnels and select your tunnel.
2. Find the Connector ID for the cloudflared instance you want to view.
3. Specify the Connector ID in cloudflared tail:
Terminal windowcloudflared tail --connector-id <CONNECTOR ID> <UUID>

### Performance considerations

- The logging session will only be held open for one hour. All logging systems introduce some level of performance overhead, and this limit helps prevent longterm impact to your tunnel's end-to-end latencies.
- When streaming logs for a high throughput tunnel, Cloudflare intentionally prioritizes service stability over log delivery. To reduce the number of dropped logs, try requesting fewer logs. To ensure that you are seeing all logs, view logs on the server instead of streaming the logs remotely.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Notifications

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/monitor-tunnels/notifications/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/monitor-tunnels/notifications/)

Page options # Notifications

Administrators can receive an alert when Cloudflare Tunnels in an account change their health or deployment status. Notifications can be delivered via email, webhook, and third-party services.

## Manage notifications

Tunnel notifications are configured on the Cloudflare dashboard ‚Üó. For more information, refer to Create a notification.

## Available notifications

Tunnel Creation or Deletion Event

Who is it for? Customers who want to receive a notification when Cloudflare Tunnels are created or deleted in their account.

Other options / filters None.

Included with All Cloudflare Zero Trust plans.

What should you do if you receive one? No action is needed.

Tunnel Health Alert

Who is it for? Customers who want to be warned about changes in health status for their Cloudflare Tunnels.

Other options / filters None.

Included with All Cloudflare Zero Trust plans.

What should you do if you receive one? Monitor tunnel health over time and consider deploying cloudflared replicas or load balancers.

Additional information | Health status | Description |
| --- | --- |
| Healthy | The tunnel is active and serving traffic through four connections to the Cloudflare global network. |
| Degraded | The tunnel is active and serving traffic, but at least one individual connection has failed. Further degradation in tunnel availability could risk the tunnel going down and failing to serve traffic. |
| Down | The tunnel cannot serve traffic as it has no connections to the Cloudflare global network. |
| Inactive | This value is reserved for tunnels which have been created, but have never been run. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Metrics

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/monitor-tunnels/metrics/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/monitor-tunnels/metrics/)

Page options # Metrics

Tunnel metrics show a Cloudflare Tunnel's throughput and resource usage over time. When you run a tunnel, cloudflared will spin up a Prometheus metrics endpoint ‚Äî an HTTP server that exposes metrics in Prometheus ‚Üó format. You can use the Prometheus toolkit on a remote machine to scrape metrics data from the cloudflared server.

## Default metrics server address

In non-containerized environments, cloudflared starts the metrics server on 127.0.0.1:<PORT>/metrics, where <PORT> is the first available port in the range 20241 to 20245. In case of all ports being unavailable then the fallback is to bind to a random port. In containerized environments such as Docker and Kubernetes, the default address is 0.0.0.0:<PORT>/metrics.

To determine the default port being used by a cloudflared instance, you can check your Tunnel logs around the time when the tunnel started. For example:

```
2024-12-19T21:17:58Z INF Starting metrics server on 127.0.0.1:20241/metrics
```

## Configure the metrics server address

To serve metrics on a custom IP address and port, perform these steps on the cloudflared host:

1. Run the tunnel using the --metrics flag. Here is an example command for a locally-managed tunnel:
Terminal windowcloudflared tunnel --metrics 127.0.0.1:60123 run my-tunnel
To learn how to add the --metrics flag to a remotely-managed tunnel, refer to Configure a remotely-managed tunnel.
NoteIf you plan to fetch metrics from another machine on the local network, replace 127.0.0.1 with the internal IP of the cloudflared server (for example, 198.168.x.x). To serve metrics on all available network interfaces, use 0.0.0.0.
2. Verify that the metrics server is running by going to http://localhost:60123/metrics. This will only work if you configured a localhost IP (127.0.0.1 or 0.0.0.0).

You can now export the metrics to Prometheus and Grafana in order to visualize and query the data. Refer to our tutorial for instructions on getting started with these tools.

## Available metrics

### cloudflared metrics

| Name | Description | Type | Labels |
| --- | --- | --- | --- |
| build_info | Build and version information. | GAUGE | goversion, revision, type, version |
| cloudflared_config_local_config_pushes | Number of local configuration pushes to Cloudflare. | COUNTER |  |
| cloudflared_config_local_config_pushes_errors | Number of errors that occurred during local configuration pushes. | COUNTER |  |
| cloudflared_orchestration_config_version | Configuration version. | GAUGE |  |
| cloudflared_tcp_active_sessions | Concurrent number of TCP sessions that are being proxied to any origin. | GAUGE |  |
| cloudflared_tcp_total_sessions | Total number of TCP sessions that have been proxied to any origin. | COUNTER |  |
| cloudflared_tunnel_active_streams | Total number of active streams. | GAUGE |  |
| cloudflared_tunnel_concurrent_requests_per_tunnel | Concurrent number of requests proxied through each tunnel. | GAUGE |  |
| cloudflared_tunnel_ha_connections | Number of active HA connections. | GAUGE |  |
| cloudflared_tunnel_request_errors | Number of errors proxying to origin. | COUNTER |  |
| cloudflared_tunnel_server_locations | Where each tunnel is connected to. 1 means current location, 0 means previous locations. | GAUGE | connection_id, edge_location |
| cloudflared_tunnel_timer_retries | Unacknowledged heart beats count. | GAUGE |  |
| cloudflared_tunnel_total_requests | Number of requests proxied through all tunnels. | COUNTER |  |
| cloudflared_tunnel_tunnel_authenticate_success | Number of successful tunnel authentication events. | COUNTER |  |
| cloudflared_tunnel_tunnel_register_success | Number of successful tunnel registrations. | COUNTER | rpcName |
| cloudflared_udp_active_sessions | Concurrent number of UDP sessions that are being proxied to any origin. | GAUGE |  |
| cloudflared_udp_total_sessions | Total number of UDP sessions that have been proxied to any origin. | COUNTER |  |
| coredns_panics_total | Number of panics. | COUNTER |  |
| quic_client_closed_connections | Number of connections that have been closed. | COUNTER |  |
| quic_client_latest_rtt | Latest round-trip time (RTT) measured on a connection. | GAUGE | conn_index |
| quic_client_lost_packets | Number of packets that have been lost from a connection. | COUNTER | conn_index, reason |
| quic_client_min_rtt | Lowest RTT measured on a connection in ms. | GAUGE | conn_index |
| quic_client_packet_too_big_dropped | Number of packets received from origin that are too big to send to Cloudflare and are dropped as a result. | COUNTER |  |
| quic_client_smoothed_rtt | Smoothed RTT calculated for a connection in ms. | GAUGE | conn_index |
| quic_client_total_connections | Number of connections initiated. For all QUIC metrics, client means the side initiating the connection. | COUNTER |  |

### Prometheus metrics

| Name | Description | Type | Labels |
| --- | --- | --- | --- |
| promhttp_metric_handler_requests_in_flight | Current number of scrapes being served. | GAUGE |  |
| promhttp_metric_handler_requests_total | Total number of scrapes by HTTP status code. | COUNTER | code |
|  |  |  |  |

### Go runtime metrics

| Name | Description | Type | Labels |
| --- | --- | --- | --- |
| go_gc_duration_seconds | A summary of the pause duration of garbage collection cycles. | SUMMARY |  |
| go_goroutines | Number of goroutines that currently exist. | GAUGE |  |
| go_info | Information about the Go environment. | GAUGE | version |
| go_memstats_alloc_bytes | Number of bytes allocated and still in use. | GAUGE |  |
| go_memstats_alloc_bytes_total | Total number of bytes allocated, even if freed. | COUNTER |  |
| go_memstats_buck_hash_sys_bytes | Number of bytes used by the profiling bucket hash table. | GAUGE |  |
| go_memstats_frees_total | Total number of frees. | COUNTER |  |
| go_memstats_gc_sys_bytes | Number of bytes used for garbage collection system metadata. | GAUGE |  |
| go_memstats_heap_alloc_bytes | Number of heap bytes allocated and still in use. | GAUGE |  |
| go_memstats_heap_idle_bytes | Number of heap bytes waiting to be used. | GAUGE |  |
| go_memstats_heap_inuse_bytes | Number of heap bytes that are in use. | GAUGE |  |
| go_memstats_heap_objects | Number of allocated objects. | GAUGE |  |
| go_memstats_heap_released_bytes | Number of heap bytes released to OS. | GAUGE |  |
| go_memstats_heap_sys_bytes | Number of heap bytes obtained from system. | GAUGE |  |
| go_memstats_last_gc_time_seconds | Number of seconds since 1970 of last garbage collection. | GAUGE |  |
| go_memstats_lookups_total | Total number of pointer lookups. | COUNTER |  |
| go_memstats_mallocs_total | Total number of mallocs. | COUNTER |  |
| go_memstats_mcache_inuse_bytes | Number of bytes in use by mcache structures. | GAUGE |  |
| go_memstats_mcache_sys_bytes | Number of bytes used for mcache structures obtained from system. | GAUGE |  |
| go_memstats_mspan_inuse_bytes | Number of bytes in use by mspan structures. | GAUGE |  |
| go_memstats_mspan_sys_bytes | Number of bytes used for mspan structures obtained from system. | GAUGE |  |
| go_memstats_next_gc_bytes | Number of heap bytes when next garbage collection will take place. | GAUGE |  |
| go_memstats_other_sys_bytes | Number of bytes used for other system allocations. | GAUGE |  |
| go_memstats_stack_inuse_bytes | Number of bytes in use by the stack allocator. | GAUGE |  |
|  |  |  |  |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Troubleshoot tunnels

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/troubleshoot-tunnels/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/troubleshoot-tunnels/)

Page options # Troubleshoot tunnels

- Private network connectivity
- Tunnel diagnostic logs
- Common errors

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tunnel diagnostic logs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/troubleshoot-tunnels/diag-logs/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/troubleshoot-tunnels/diag-logs/)

Page options # Tunnel diagnostic logs

Cloudflare Tunnel generates a set of diagnostic logs that can be used to troubleshoot issues with cloudflared. A diagnostic report collects data from a single instance of cloudflared running on the local machine.

## Get diagnostic logs

The steps for getting diagnostic logs depend on your cloudflared deployment environment.

### Prerequisites

- cloudflared version 2024.12.2 or later installed on the host

### Host environment

These instructions apply to remotely-managed and locally-managed tunnels running directly on the host machine.

1. (Linux only) To include network diagnostics in the logs, allow the cloudflared user to create RAW and PACKET sockets without root permissions:
Terminal windowsudo setcap cap_net_raw+ep /usr/bin/traceroute && sudo setcap cap_net_raw+ep /usr/bin/traceroute
If you do not set cap_net_raw, then traceroute data will be unavailable.
2. Get diagnostic logs:
Terminal windowcloudflared tunnel diag
If multiple instances of cloudflared are running on the same host, specify the metrics server IP and port for the instance you want to diagnose. For example:
Terminal windowcloudflared tunnel diag --metrics 127.0.0.1:20241

This command will output the status of each diagnostic task and place a cloudflared-diag-YYYY-MM-DDThh-mm-ss.zip file in your working directory.

### Docker

cloudflared reads diagnostic data from the tunnel metrics server. To get diagnostic logs, the metrics server must be exposed from the Docker container and reachable from the host machine.

1. Determine the metrics server port for the cloudflared instance running in Docker.
2. Ensure the container is deployed with port forwarding enabled. The diagnostic feature will request information from the Docker instance using local port 20241, therefore you should forward port 20241 to the container port obtained in Step 1:
Terminal windowdocker run -d -p 20241:<metrics_port> docker.io/cloudflare/cloudflared tunnel ...
3. Verify that you can reach the metrics server address from the Docker host environment:
Terminal windowcurl localhost:20241/diag/tunnel
This command should return a JSON:
{  "tunnelID": "ef96b330-a7f5-4bce-a00e-827ce5be077f",  "connectorID": "d236670a-9f74-422f-adf1-030f5c5f0523",  "connections": [    { "isConnected": true, "protocol": 1, "edgeAddress": "198.41.192.167"},    {"isConnected": true, "protocol": 1, "edgeAddress": "198.41.200.113", "index": 1},    {"isConnected": true, "protocol": 1, "edgeAddress": "198.41.192.47", "index": 2},    {"isConnected": true, "protocol": 1, "edgeAddress": "198.41.200.73", "index": 3}  ],  "icmp_sources": ["192.168.1.243", "fe80::c59:bd4a:e815:ed6"]}
4. Run the diagnostic using the Docker container ID:
Terminal windowcloudflared tunnel diag --diag-container-id=<containerID>
Alternatively, you can specify the container's name instead of its ID:
Terminal windowcloudflared tunnel diag --diag-container-id=<containerName>
Running the diagnostic command with the container ID allows cloudflared to collect information from the Docker environment such as logs and container details.

This command will output the status of each diagnostic task and place a cloudflared-diag-YYYY-MM-DDThh-mm-ss.zip file in your working directory.

### Kubernetes

The diagnostic feature will request data from the tunnel metrics server using ports 20241 to 20245. You will need to use port forwarding to allow the local cloudflared instance to connect to the metrics server on one of these ports.

1. Determine the tunnel's metrics server port.
2. Enable port forwarding:
Terminal windowkubectl port-forward <pod> <diagnostic_port>:<metrics_port>

<pod>: Name of the pod where the tunnel is running
<diagnostic_port> is any local port in the range 20241 to 20245.
<metrics_port> is the Kubernetes pod port for the cloudflared instance you want to diagnose (obtained in Step 1).

For example, if you set the metrics server address to 0.0.0.0:12345:
Terminal windowkubectl port-forward cloudflared-6d4897585b-r8kfz 20244:12345
Connections made to local port 20244 are forwarded to port 12345 of the pod that is running the tunnel.
3. <pod>: Name of the pod where the tunnel is running
4. <diagnostic_port> is any local port in the range 20241 to 20245.
5. <metrics_port> is the Kubernetes pod port for the cloudflared instance you want to diagnose (obtained in Step 1).
6. Run the diagnostic:
Terminal windowcloudflared tunnel diag --diag-pod-id=<podID>
If the pod has multiple applications/services running and cloudflared is not the first in the pod, you must specify either the container ID or name:
Terminal windowcloudflared tunnel diag --diag-pod-id=<podID> --diag-container-id=<containerName>

This command will output the status of each diagnostic task and place a cloudflared-diag-YYYY-MM-DDThh-mm-ss.zip file in your working directory.

## cloudflared-diag files

The cloudflared-diag-YYYY-MM-DDThh-mm-ss.zip archive contains the files listed below. The data in a file either applies to the cloudflared instance being diagnosed (diagnosee) or the instance that triggered the diagnosis (diagnoser). For example, if your tunnel is running in a Docker container, the diagnosee is the Docker instance and the diagnoser is the host instance.

| File name | Description | Instance |
| --- | --- | --- |
| cli-configuration.json | Tunnel run parameters used when starting the tunnel | diagnosee |
| cloudflared_logs.txt | Tunnel log file1 | diagnosee |
| configuration.json | Tunnel configuration parameters | diagnosee |
| goroutine.pprof | goroutine profile made available by pprof | diagnosee |
| heap.pprof | heap profile made available by pprof | diagnosee |
| metrics.txt | Snapshot of Tunnel metrics at the time of diagnosis | diagnosee |
| network.txt | JSON traceroutes to Cloudflare's global network using IPv4 and IPv6 | diagnoser |
| raw-network.txt | Raw traceroutes to Cloudflare's global network using IPv4 and IPv6 | diagnoser |
| systeminformation.json | Operating system information and resource usage | diagnosee |
| task-result.json | Result of each diagnostic task | diagnoser |
| tunnelstate.json | Tunnel connections at the time of diagnosis | diagnosee |

## Footnotes

1. If the log file is blank, you may need to set --loglevel to debug when you start the tunnel. The --loglevel parameter is only required if you ran the tunnel from the CLI using a cloudflared tunnel run command. It is not necessary if the tunnel runs as a Linux/macOS service or runs in Docker/Kubernetes. ‚Ü©

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Private network connectivity

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/troubleshoot-tunnels/private-networks/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/troubleshoot-tunnels/private-networks/)

Page options # Private network connectivity

Follow this troubleshooting procedure when end users running Cloudflare WARP have issues connecting to a private network behind Cloudflare Tunnel.

## 1. Is the WARP client connected to a Cloudflare data center?

The WARP client GUI should display Connected and Your Internet is protected.

If WARP is stuck in the Disconnected state or frequently changes between Connected and Disconnected, refer to Unable to connect WARP.

## 2. Is the WARP client connecting to your private DNS server?

This step is only needed if users access your application via a private hostname (for example, wiki.internal.com).

- If you are using custom resolver policies to handle private DNS, go to your Gateway DNS logs (Logs > Gateway > DNS) and search for DNS queries to the hostname.
- If you are using Local Domain Fallback to handle private DNS, go to your Gateway Network logs (Logs > Gateway > Network) and search for port 53 traffic to your DNS server IP.

If there are no relevant Gateway logs, it means that WARP was unable to forward the query to your private DNS server. Check your resolver policies or Local Domain Fallback configuration and refer to How WARP handles DNS requests.

## 3. Is network traffic to the application going through WARP?

Next, check if your Gateway Network logs (Logs > Gateway > Network) show any traffic to the destination IP.

If WARP is connected but there are no network logs, it means that your private network IPs are not routing through WARP. You can confirm this by searching the routing table on the device for the IP address of your application. Traffic to your application should route through the Cloudflare WARP interface. If another interface is used, check your Split Tunnel configuration.

## 4. Is the user blocked by a Gateway policy?

To check if a Gateway block event occurred:

1. Go to Logs > Gateway and select the DNS, Network, or HTTP tab.
2. Apply the following filters:

Email: User's email address
Event: Blocked
Date Time Range: Time period when the user accessed the application
3. Email: User's email address
4. Event: Blocked
5. Date Time Range: Time period when the user accessed the application

## 5. Is the user matching the correct Gateway policy?

Determine whether the user is matching any policy, or if they are matching a policy that has a higher priority than the expected policy.

1. To determine the actual policy that was applied:

Go to Logs > Gateway and select the DNS, Network, or HTTP tab.
Apply the following filters:

Email: User's email address
Date Time Range: Time period when the user accessed the application


In the search box, filter by the destination IP or FQDN.
In the results, select a log and note its Policy Name value.
2. Go to Logs > Gateway and select the DNS, Network, or HTTP tab.
3. Apply the following filters:

Email: User's email address
Date Time Range: Time period when the user accessed the application
4. Email: User's email address
5. Date Time Range: Time period when the user accessed the application
6. In the search box, filter by the destination IP or FQDN.
7. In the results, select a log and note its Policy Name value.
8. Go to Gateway > Firewall Policies and compare the order of enforcement of the matched policy versus the expected policy.
9. Compare the Gateway log values with the expected policy criteria.


If the mismatched value is related to identity, check the user registry and verify the values that are passed to Gateway from your IdP. Cloudflare updates the registry when the user enrolls in the WARP client. If the user's identity is outdated, ask the user to re-authenticate WARP (Preferences > Account > Re-Authenticate Session).


If the mismatched value is related to device posture, view posture check results for the user's device. Verify that the device passes the posture checks configured in the policy.
10. If the mismatched value is related to identity, check the user registry and verify the values that are passed to Gateway from your IdP. Cloudflare updates the registry when the user enrolls in the WARP client. If the user's identity is outdated, ask the user to re-authenticate WARP (Preferences > Account > Re-Authenticate Session).
11. If the mismatched value is related to device posture, view posture check results for the user's device. Verify that the device passes the posture checks configured in the policy.

## 6. Are the correct Gateway proxy settings enabled?

Under Settings > Network, ensure that Proxy is enabled for TCP, UDP, and ICMP traffic. UDP is required for proxying DNS traffic and other UDP packets, while ICMP is required for ping and other administrative functions.

## 7. Is the user's traffic reaching the tunnel?

Review your tunnel log stream. If you do not see any requests to your application, ensure that you have added the appropriate static routes to your Cloudflare Tunnel.

## 8. Is the tunnel forwarding requests to your application?

Verify that you can connect to the application directly from the cloudflared host machine:

- macOS and Linux
- Windows

Open Terminal and run the following command:

Terminal window ```
telnet test.example.com 443
```

If telnet fails to open the connection, check your infrastructure for firewalls, load balancers, or other network devices that may be interfering with the connection between cloudflared and the application server.

Open PowerShell and run the following command:

PowerShell ```
PS C:\Users\JohnDoe> Test-NetConnection test.example.com -port 443
```

If the output shows TcpTestSucceeded : False, check your infrastructure for firewalls, load balancers, or other network devices that may be interfering with the connection between cloudflared and the application server.

You can also use a packet capture tool such as tcpdump or Wireshark to trace whether traffic from the user device successfully reaches cloudflared and routes to your application. Traffic to your application will carry the source IP of the cloudflared host.

## 9. How is your application handling requests?

1. Check if the application server has a local firewall in place that is blocking requests from the cloudflared host machine.
2. Check if the application server needs to initiate any connection towards the user's device. If so, this is a limitation of cloudflared and you should instead deploy WARP Connector to enable bidirectional traffic.

## 10. Is TLS inspection affecting the connection to your application?

If there is a problem with TLS inspection, the user will get an Insecure Upstream error when they access the application in a browser. They will probably not get an error if they access the application outside of a browser.

Customers who have Logpush enabled can check the Gateway HTTP dataset for any hostnames which have an elevated rate of 526 HTTP status codes.

To troubleshoot TLS inspection:

1. Create a temporary Gateway HTTP policy that disables TLS inspection for all traffic to the application. For example:

















SelectorOperatorValueActionDestination IPin10.2.3.4/32Do Not Inspect
2. If the Do Not Inspect policy enables the user to connect, verify that the TLS certificate used by your application is trusted by a public CA and not self-signed. Cloudflare Gateway is unable to negotiate TLS with applications that use self-signed certificates. For more information, refer to TLS inspection limitations.
To work around the issue:

Option 1: Create a permanent Do Not Inspect HTTP policy for this application.
Option 2: Customers who use their own certificate infrastructure for inspection can opt to create an Allow Pass Through policy which enables our proxy to accept the TLS negotiation from your application. This will allow requests to flow correctly without the need for a Do Not Inspect policy.
Option 3: If your application uses HTTPS or other common protocols, you can add a public hostname route to your Cloudflare Tunnel and set noTLSVerify to true. This will allow cloudflared to trust your self-signed certificate.
3. Option 1: Create a permanent Do Not Inspect HTTP policy for this application.
4. Option 2: Customers who use their own certificate infrastructure for inspection can opt to create an Allow Pass Through policy which enables our proxy to accept the TLS negotiation from your application. This will allow requests to flow correctly without the need for a Do Not Inspect policy.
5. Option 3: If your application uses HTTPS or other common protocols, you can add a public hostname route to your Cloudflare Tunnel and set noTLSVerify to true. This will allow cloudflared to trust your self-signed certificate.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Common errors

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/troubleshoot-tunnels/common-errors/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/troubleshoot-tunnels/common-errors/)

Page options # Common errors

This section covers the most common errors you might encounter when connecting resources with Cloudflare Tunnel. If you do not see your issue listed below, refer to the troubleshooting FAQ, view your Tunnel logs, or contact Cloudflare Support.

## I see cloudflared service is already installed.

If you see this error when installing a remotely-managed tunnel, ensure that no other cloudflared instances are running as a service on this machine. Only a single instance of cloudflared may run as a service on any given machine. Instead, we recommend adding additional routes to your existing tunnel. Alternatively, you can run sudo cloudflared service uninstall to uninstall cloudflared.

## I see An A, AAAA, or CNAME record with that host already exists.

If you are unable to save your tunnel's public hostname, choose a different hostname or delete the existing DNS record. Check the DNS records for your domain from the Cloudflare dashboard ‚Üó.

## Tunnel credentials file doesn't exist or is not a file.

If you encounter the following error when running a tunnel, double check your config.yml file and ensure that the credentials-file points to the correct location. You may need to change /root/ to your home directory.

Terminal window ```
cloudflared tunnel run
```

```
2021-06-04T06:21:16Z INF Starting tunnel tunnelID=928655cc-7f95-43f2-8539-2aba6cf3592dTunnel credentials file '/root/.cloudflared/928655cc-7f95-43f2-8539-2aba6cf3592d.json' doesn't exist or is not a file
```

## My tunnel fails to authenticate.

To start using Cloudflare Tunnel, a super administrator in the Cloudflare account must first log in through cloudflared login. The client will launch a browser window and prompt the user to select a hostname in their Cloudflare account. Once selected, Cloudflare generates a certificate that consists of three components:

- The public key of the origin certificate for that hostname
- The private key of the origin certificate for that domain
- A token that is unique to Cloudflare Tunnel

Those three components are bundled into a single PEM file that is downloaded one time during that login flow. The host certificate is valid for the root domain and any subdomain one-level deep. Cloudflare uses that certificate file to authenticate cloudflared to create DNS records for your domain in Cloudflare.

The third component, the token, consists of the zone ID (for the selected domain) and an API token scoped to the user who first authenticated with the login command. When user permissions change (if that user is removed from the account or becomes an admin of another account, for example), Cloudflare rolls the user's API key. However, the certificate file downloaded through cloudflared retains the older API key and can cause authentication failures. The user will need to login once more through cloudflared to regenerate the certificate. Alternatively, the administrator can create a dedicated service user to authenticate.

## I see an error: x509: certificate signed by unknown authority.

This means the origin is using a certificate that cloudflared does not trust. For example, you may get this error if you are using SSL/TLS inspection in a proxy between your server and Cloudflare. To solve this:

- Add the certificate to the system certificate pool.
- Use the --origin-ca-pool flag and specify the path to the certificate.
- Use the --no-tls-verify flag to stop cloudflared checking the certificate for a trust chain.

## I see an error 1033 when attempting to run a tunnel.

An error 1033 indicates your tunnel is not connected to Cloudflare's edge. First, run cloudflared tunnel list to see whether your tunnel is listed as active. If it isn't, check the following:

1. Make sure you correctly routed traffic to your tunnel (step 5 in the Tunnel guide) by assigning a CNAME record to point traffic to your tunnel. Alternatively, check this guide to route traffic to your tunnel using load balancers.
2. Make sure you run your tunnel (step 6 in the Tunnel guide).

For more information, here is a comprehensive list of Cloudflare 1xxx errors.

## I see ERR_TOO_MANY_REDIRECTS when attempting to connect to an Access self-hosted app.

This error occurs when cloudflared does not recognize the SSL/TLS certificate presented by your origin. To resolve the issue, set the origin server name parameter to the hostname on your origin certificate. Here is an example of a locally-managed tunnel configuration:

```
ingress:  - hostname: test.example.com    service: https://localhost:443    originRequest:      originServerName: test.example.com
```

## cloudflared access shows an error websocket: bad handshake.

This means that your cloudflared access client is unable to reach your cloudflared tunnel origin.
To diagnose this, you should look at the cloudflared tunnel logs. A very often root cause is that the cloudflared tunnel is unable to proxy to your origin (e.g. because the ingress is mis-configured, or the origin is down, or because the origin HTTPS certificate cannot be validated by cloudflared tunnel).
If cloudflared tunnel has no logs, it means Cloudflare Edge is not even able to route the websocket traffic to it.

There are a few different possible root causes behind the websocket: bad handshake error:

- Your cloudflared tunnel is either not running or not connected to Cloudflare Edge.
- WebSockets are not enabled.
- Your Cloudflare account has Universal SSL enabled but your SSL/TLS encryption mode is set to Off (not secure). To resolve:

On the Cloudflare dashboard for your zone, go to SSL/TLS > Overview.
Ensure that your SSL/TLS encryption mode is set to either Flexible, Full or Full (strict).
- On the Cloudflare dashboard for your zone, go to SSL/TLS > Overview.
- Ensure that your SSL/TLS encryption mode is set to either Flexible, Full or Full (strict).
- Your requests are blocked by Super Bot Fight Mode. To resolve, make sure you set Definitely automated to Allow in the bot fight mode settings.
- Your SSH or RDP Access application has the Binding Cookie enabled. To disable the cookie, go to Access > Applications and edit the application settings.
- One or more Workers routes are overlapping with the tunnel hostname, and the Workers do not properly handle the traffic. To resolve, you could either exclude your tunnel from the Worker route by not defining a route that includes the tunnel's hostname or update your Worker to only handle specific paths and forward all other requests to the origin, for example, by using return fetch(req).

## My tunnel randomly disconnects.

Long-lived connections initiated through the Cloudflare Zero Trust platform, such as SSH sessions, can last up to eight hours. However, disruptions along the service path may result in more frequent disconnects. Often, these disconnects are caused by regularly scheduled maintenance events such as data center, server, or service updates and restarts. If you believe these events are not the cause of disconnects in your environment, collect the relevant WARP logs and Tunnel logs and contact Support.

## Tunnel connections fail with SSL error.

If cloudflared returns error error="remote error: tls: handshake failure", check to make sure the hostname in question is covered by a SSL certificate. If using a multi-level subdomain, an advanced certificate may be required as the Universal SSL will not cover more than one level of subdomain. This may surface in the browser as ERR_SSL_VERSION_OR_CIPHER_MISMATCH.

## Tunnel connections fail with Too many open files error.

If your Cloudflare Tunnel logs returns a socket: too many open files error, it means that cloudflared has exhausted the open files limit on your machine. The maximum number of open files, or file descriptors, is an operating system setting that determines how many files a process is allowed to open. To increase the open file limit, you will need to configure ulimit settings on the machine running cloudflared.

## I see failed to sufficiently increase receive buffer size in my cloudflared logs.

This buffer size increase is reported by the quic-go library ‚Üó leveraged by cloudflared ‚Üó. You can learn more about the log message in the quic-go repository ‚Üó. This log message is generally not impactful and can be safely ignored when troubleshooting. However, if you have deployed cloudflared within a unique, high-bandwidth environment then buffer size can be manually overridden for testing purposes.

To set the maximum receive buffer size on Linux:

1. Create a new file under /etc/sysctl.d/:

Terminal window ```
sudo vi 98-core-rmem-max.conf
```

1. In the file, define the desired buffer size:

```
net.core.rmem_max=2500000
```

1. Reboot the host machine running cloudflared.
2. To validate that these changes have taken effect, use the grep command:

Terminal window ```
sudo sysctl -a | grep net.core.rmem_max
```

```
net.core.rmem_max = 2500000
```

## ping and traceroute commands do not work.

To ping an IP address behind Cloudflare Tunnel, your system must allow ICMP traffic through cloudflared. For configuration instructions, refer to the ICMP proxy documentation.

## Cloudflare Tunnel is buffering my streaming response instead of streaming it live.

Proxied traffic through Cloudflare Tunnel is buffered by default unless the origin server includes the response header Content-Type: text/event-stream. The Content-Type: text/event-stream response header tells cloudflared to stream data as it arrives instead of buffering the entire response.

## Troubleshooting

Troubleshooting - Browse other Cloudflare One-related troubleshooting errors and solutions.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Do more with Tunnel

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/)

Page options # Do more with Tunnel

- Locally-managed tunnels
- Migrate legacy tunnels
- Quick Tunnels

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Locally-managed tunnels

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/)

Page options # Locally-managed tunnels

A locally-managed tunnel is a Cloudflare Tunnel created by running cloudflared tunnel create <NAME> on the command line. Tunnel configuration is stored in your local cloudflared directory.

Note

Cloudflare recommends setting up a remotely-managed tunnel. Remotely-managed configurations are stored on Cloudflare, which allows you to manage the tunnel from any machine using the dashboard, API, or Terraform.

- Create a locally-managed tunnel
- Configuration file
- Run as a service
- Useful commands
- Tunnel permissions
- Useful terms

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Create a locally-managed tunnel

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/create-local-tunnel/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/create-local-tunnel/)

Page options # Create a locally-managed tunnel

Follow this step-by-step guide to get your first tunnel up and running using the CLI.

## Prerequisites

Before you start, make sure you:

- Add a website to Cloudflare.
- Change your domain nameservers to Cloudflare.

## 1. Download and install cloudflared

- Windows
- macOS
- Linux
- Build from source

1. Download cloudflared on your machine. Visit the downloads page to find the right package for your OS.
2. Rename the executable to cloudflared.exe
3. In PowerShell, change directory to your Downloads folder and run .\cloudflared.exe --version. It should output the version of cloudflared. Note that cloudflared.exe could be cloudflared-windows-amd64.exe or cloudflared-windows-386.exe if you have not renamed it.

PowerShell ```
PS C:\Users\Administrator\Downloads\cloudflared-stable-windows-amd64> .\cloudflared.exe --version
```

To download and install cloudflared:

Terminal window ```
brew install cloudflared
```

Alternatively, you can download the latest Darwin amd64 release directly.

Debian and Ubuntu APT

Use the apt package manager to install cloudflared on compatible machines.

1. Add Cloudflare's package signing key:

Terminal window ```
sudo mkdir -p --mode=0755 /usr/share/keyringscurl -fsSL https://pkg.cloudflare.com/cloudflare-main.gpg | sudo tee /usr/share/keyrings/cloudflare-main.gpg >/dev/null
```

1. Add Cloudflare's apt repo to your apt repositories:

Terminal window ```
echo "deb [signed-by=/usr/share/keyrings/cloudflare-main.gpg] https://pkg.cloudflare.com/cloudflared any main" | sudo tee /etc/apt/sources.list.d/cloudflared.list
```

1. Update repositories and install cloudflared:

Terminal window ```
sudo apt-get update && sudo apt-get install cloudflared
```

RHEL RPM

Use the rpm package manager to install cloudflared on compatible machines.

1. Add Cloudflare's repository:

Terminal window ```
curl -fsSL https://pkg.cloudflare.com/cloudflared-ascii.repo | sudo tee /etc/yum.repos.d/cloudflared.repo
```

1. Update repositories and install cloudflared:

Terminal window ```
sudo yum update && sudo yum install cloudflared
```

Arch Linux

cloudflared is in the Arch Linux community repository ‚Üó.
Use pacman to install cloudflared on compatible machines.

Terminal window ```
pacman -Syu cloudflared
```

Other

Alternatively you can download the cloudflared binary or the linux packages to your machine and install manually. Visit the downloads page to find the right package for your OS.

To build the latest version of cloudflared from source:

Terminal window ```
git clone https://github.com/cloudflare/cloudflared.gitcd cloudflaredmake cloudflaredgo install github.com/cloudflare/cloudflared/cmd/cloudflared
```

Depending on where you installed cloudflared, you can move it to a known path as well.

Terminal window ```
mv /root/cloudflared/cloudflared /usr/bin/cloudflared
```

## 2. Authenticate cloudflared

Terminal window ```
cloudflared tunnel login
```

Running this command will:

- Open a browser window and prompt you to log in to your Cloudflare account. After logging in to your account, select your hostname.
- Generate an account certificate, the cert.pem file, in the default cloudflared directory.

## 3. Create a tunnel and give it a name

Terminal window ```
cloudflared tunnel create <NAME>
```

Running this command will:

- Create a tunnel by establishing a persistent relationship between the name you provide and a UUID for your tunnel. At this point, no connection is active within the tunnel yet.
- Generate a tunnel credentials file in the default cloudflared directory.
- Create a subdomain of .cfargotunnel.com.

From the output of the command, take note of the tunnel's UUID and the path to your tunnel's credentials file.

Confirm that the tunnel has been successfully created by running:

Terminal window ```
cloudflared tunnel list
```

## 4. Create a configuration file

1. In your .cloudflared directory, create a config.yml file using any text editor. This file will configure the tunnel to route traffic from a given origin to the hostname of your choice.
2. Add the following fields to the file:

If you are connecting an application:

```
url: http://localhost:8000tunnel: <Tunnel-UUID>credentials-file: /root/.cloudflared/<Tunnel-UUID>.json
```

If you are connecting a private network:

```
tunnel: <Tunnel-UUID>credentials-file: /root/.cloudflared/<Tunnel-UUID>.jsonwarp-routing:  enabled: true
```

1. Confirm that the configuration file has been successfully created by running:
Terminal windowcat config.yml

## 5. Start routing traffic

1. Now assign a CNAME record that points traffic to your tunnel subdomain:

If you are connecting an application, route the service to a public hostname:

Terminal windowcloudflared tunnel route dns <UUID or NAME> <hostname>

If you are connecting a private network, route an IP address or CIDR through the tunnel:

Terminal windowcloudflared tunnel route ip add <IP/CIDR> <UUID or NAME>
2. If you are connecting an application, route the service to a public hostname:
3. If you are connecting a private network, route an IP address or CIDR through the tunnel:
4. Confirm that the route has been successfully established:
Terminal windowcloudflared tunnel route ip show

## 6. Run the tunnel

Run the tunnel to proxy incoming traffic from the tunnel to any number of services running locally on your origin.

Terminal window ```
cloudflared tunnel run <UUID or NAME>
```

If your configuration file has a custom name or is not in the .cloudflared directory, add the --config flag and specify the path.

Terminal window ```
cloudflared tunnel --config /path/your-config-file.yml run <UUID or NAME>
```

Note

Cloudflare Tunnel can install itself as a system service on Linux and Windows and as a launch agent on macOS. For more information, refer to run as a service.

## 7. Check the tunnel

Your tunnel configuration is complete! If you want to get information on the tunnel you just created, you can run:

Terminal window ```
cloudflared tunnel info <UUID or NAME>
```

You can now route traffic to your tunnel using Cloudflare DNS or determine who can reach your tunnel with Cloudflare Access.

To secure your origin, you must validate the application token issued by Cloudflare Access. Token validation ensures that any requests which bypass Cloudflare Access (for example, due to a network misconfiguration) are rejected.

One option is to configure the Cloudflare Tunnel daemon, cloudflared, to validate the token on your behalf. This is done by enabling Protect with Access in your Cloudflare Tunnel settings. Alternatively, if you do not wish to perform automatic validation with Cloudflare Tunnel, you can instead manually configure your origin to check all requests for a valid token.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Configuration file

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/configuration-file/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/configuration-file/)

Page options # Configuration file

Note

Quick tunnels do not need a configuration file.

Locally-managed tunnels run as an instance of cloudflared on your machine.  You can configure cloudflared properties by modifying command line parameters or by editing the tunnel configuration file.

The CLI provides a quick way to handle configurations if you are connecting a single service through cloudflared. The tunnel configuration file is useful if you are connecting multiple services and need to configure properties or exceptions for specific origins. In the configuration file, you can define top-level properties for your cloudflared instance as well as origin-specific properties. For a full list of configuration options, type cloudflared tunnel help in your terminal.

In the absence of a configuration file, cloudflared will proxy outbound traffic through port 8080.

## File structure for private networks

If you are exposing a private network to end users running WARP, you need to add the warp-routing key and set it to true:

```
tunnel: <Tunnel-UUID>credentials-file: /path/<Tunnel-UUID>.jsonwarp-routing:  enabled: true
```

## File structure for public hostnames

If you are exposing local services to the Internet, you can assign a public hostname to each service:

```
tunnel: 6ff42ae2-765d-4adf-8112-31c55c1551efcredentials-file: /root/.cloudflared/6ff42ae2-765d-4adf-8112-31c55c1551ef.json
ingress:  - hostname: gitlab.widgetcorp.tech    service: http://localhost:80  - hostname: gitlab-ssh.widgetcorp.tech    service: ssh://localhost:22  - service: http_status:404
```

Configuration files that contain ingress rules must always include a catch-all rule that concludes the file. In this example, cloudflared will respond with a 404 status code when the request does not match any of the previous hostnames.

### How traffic is matched

When cloudflared receives an incoming request, it evaluates each ingress rule from top to bottom to find which rule matches the request. Rules can match either the hostname or path of an incoming request, or both. If a rule does not specify a hostname, all hostnames will be matched. If a rule does not specify a path, all paths will be matched.

The last ingress rule must be a catch-all rule that matches all traffic.

Here is an example configuration file that specifies several rules:

```
tunnel: 6ff42ae2-765d-4adf-8112-31c55c1551efcredentials-file: /root/.cloudflared/6ff42ae2-765d-4adf-8112-31c55c1551ef.json
ingress:  # Rules map traffic from a hostname to a local service:  - hostname: example.com    service: https://localhost:8000  # Rules can match the request's path to a regular expression:  - hostname: static.example.com    path: \.(jpg|png|css|js)$    service: https://localhost:8001  # Rules can match the request's hostname to a wildcard character:  - hostname: "*.example.com"    service: https://localhost:8002  # An example of a catch-all rule:  - service: https://localhost:8003
```

#### Wildcards

You can use wildcards to match traffic to multiple subdomains. For example, if you set the hostname key to *.example.com, both alpha.example.com and beta.example.com will route traffic to your origin. cloudflared does not support wildcards in the middle of the hostname, such as test.*.example.com.

You can also enter regular expressions for the path key. For example, if hostname is static.example.com and path is \.(jpg|png|css|js)$, matching URLs could include https://static.example.com/data.js, http://static.example.com/images/photo.jpg, and so on. Cloudflare parses the path regex using the Go syntax package ‚Üó.

### Supported protocols

In addition to HTTP, cloudflared supports protocols like SSH, RDP, arbitrary TCP services, and Unix sockets. You can also route traffic to the built-in Hello World test server or respond to traffic with an HTTP status.

```
tunnel: 6ff42ae2-765d-4adf-8112-31c55c1551efcredentials-file: /root/.cloudflared/6ff42ae2-765d-4adf-8112-31c55c1551ef.json
ingress:  # Example of a request over TCP:  - hostname: example.com    service: tcp://localhost:8000  # Example of an HTTP request over a Unix socket:  - hostname: staging.example.com    service: unix:/home/production/echo.sock  # Example of a request mapping to the Hello World test server:  - hostname: test.example.com    service: hello_world  # Example of a rule responding to traffic with an HTTP status:  - service: http_status:404
```

| Service | Description | Example service value |
| --- | --- | --- |
| HTTP/S | Incoming HTTP requests are proxied directly to your local service. | https://localhost:8000 |
| HTTP over Unix socket | Just like HTTP, but using a Unix socket instead. | unix:/home/production/echo.sock |
| HTTPS over Unix socket | Just like HTTPS, but using a Unix socket instead. | unix+tls:/home/production/echo.sock |
| TCP | TCP connections are proxied to your local service. | tcp://localhost:2222 |
| SSH | SSH connections are proxied to your local service. Learn more. | ssh://localhost:22 |
| RDP | RDP connections are proxied to your local service. Learn more. | rdp://localhost:3389 |
| kubectl bastion mode | cloudflared will act like a jumphost, allowing access to any local address. | bastion |
| Hello World | Test server for validating your Cloudflare Tunnel setup. | hello_world |
| HTTP status | Responds to all requests with the given HTTP status. | http_status:404 |

### Origin configuration

If you need to proxy traffic to multiple origins within one instance of cloudflared, you can define the way cloudflared sends requests to each service by specifying configuration options as part of your ingress rules.

In the following example, the top-level configuration connectTimeout: 30s sets a 30-second connection timeout for all services within that instance of cloudflared. The ingress rule for service: localhost:8002 then configures an exception to the top-level configuration by setting connectTimeout for that service at 10s. The 30-second connection timeout still applies to all other services.

```
tunnel: 6ff42ae2-765d-4adf-8112-31c55c1551efcredentials-file: /root/.cloudflared/6ff42ae2-765d-4adf-8112-31c55c1551ef.jsonoriginRequest: # Top-level configuration  connectTimeout: 30s
ingress:  # The localhost:8000 service inherits all root-level configuration.  # In other words, it will use a connectTimeout of 30 seconds.  - hostname: example.com    service: localhost:8000  - hostname: example2.com    service: localhost:8001  # The localhost:8002 service overrides some root-level config.  - service: localhost:8002    originRequest:      connectTimeout: 10s      disableChunkedEncoding: true  # Some built-in services such as `http_status` do not use any configuration.  # The service below will simply respond with HTTP 404.  - service: http_status:404
```

### Validate ingress rules

To validate the ingress rules in your configuration file, run:

Terminal window ```
cloudflared tunnel ingress validate
```

This will ensure that the set of ingress rules specified in your config file is valid.

### Test ingress rules

To verify that cloudflared will proxy the right traffic to the right local service, use cloudflared tunnel ingress rule. This checks a URL against every rule, from first to last, and shows the first rule that matches. For example:

Terminal window ```
cloudflared tunnel ingress rule https://foo.example.com
```

```
Using rules from /usr/local/etc/cloudflared/config.ymlMatched rule #3  hostname: *.example.com  service: https://localhost:8000
```

## Update a configuration file

When making changes to the configuration file for a given tunnel, we suggest relying on cloudflared replicas to propagate the new configuration with minimal downtime.

1. Have a cloudflared instance running with the original version of the configuration file.
2. Start a cloudflared replica running with the updated version of the configuration file.
3. Wait for the replica to be fully running and usable.
4. Stop the first instance of cloudflared.

Your cloudflared will now be running with the updated version of your configuration file.

Traffic handling

When the first instance of cloudflared is stopped, long-lived HTTP requests (for example, Websocket) and TCP connections (for example, SSH) will be dropped. UDP flows will also be dropped, as they are modeled based on timeouts. When the new replica connects, it will handle all new traffic, including new HTTP requests, TCP connections, and UDP flows.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Run as a service

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/as-a-service/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/as-a-service/)

Page options # Run as a service

You can install cloudflared as a system service on Linux and Windows, and as a launch agent on macOS. In most cases, we recommend running cloudflared as a service. Running as a service helps ensure the availability of cloudflared to your origin by allowing the program to start at boot and continue running while your origin is online.

Follow our guides to set up and run cloudflared as a service in your environment:

- Linux
- macOS
- Windows

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Linux

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/as-a-service/linux/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/as-a-service/linux/)

Page options # Linux

You can install cloudflared as a system service on Linux.

## Prerequisites

Before you install Cloudflare Tunnel as a service on Linux, follow Steps 1 through 4 of the Tunnel CLI setup guide. At this point you should have a named tunnel and a config.yml file in your .cloudflared directory.

## 1. Configure cloudflared as a service

By default, Cloudflare Tunnel expects all of the configuration to exist in the $HOME/.cloudflared/config.yml configuration file. At a minimum you must specify the following arguments to run as a service:

| Argument | Description |
| --- | --- |
| tunnel | The UUID of your tunnel |
| credentials-file | The location of the credentials file for your Tunnel |

## 2. Run cloudflared as a service

1. Install the cloudflared service.
Terminal windowcloudflared service install
2. Start the service.
Terminal windowsystemctl start cloudflared
3. (Optional) View the status of the service.
Terminal windowsystemctl status cloudflared

## Next steps

You can now route traffic through your tunnel. If you add IP routes or otherwise change the configuration, restart the service to load the new configuration:

Terminal window ```
systemctl restart cloudflared
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## macOS

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/as-a-service/macos/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/as-a-service/macos/)

Page options # macOS

You can install cloudflared as a system service on macOS.

## Prerequisites

Before you install Cloudflare Tunnel as a service on your OS, follow Steps 1 through 4 of the Tunnel CLI setup guide. At this point you should have a named tunnel and a config.yml file in your $HOME/.cloudflared directory.

## 1. Configure cloudflared as a service

By default, Cloudflare Tunnel expects all of the configuration to exist in the $HOME/.cloudflared/config.yml configuration file. At a minimum you must specify the following arguments to run as a service:

| Argument | Description |
| --- | --- |
| tunnel | The UUID of your tunnel |
| credentials-file | The location of the credentials file for your tunnel |

## 2. Run cloudflared as a service

You can install the service to either run at login or at boot.

### Run at login

Open a terminal window and run the following command:

Terminal window ```
cloudflared service install
```

Cloudflare Tunnel will be installed as a launch agent and start whenever you log in, using your local user configuration found in ~/.cloudflared/.

### Run at boot

Open a terminal window and run the following command:

Terminal window ```
sudo cloudflared service install
```

Cloudflare Tunnel will be installed as a launch daemon and start whenever your system boots, using your configuration found in /etc/cloudflared.

## 3. Manually start the service

Run the following command:

Terminal window ```
sudo launchctl start com.cloudflare.cloudflared
```

The output will be logged to /Library/Logs/com.cloudflare.cloudflared.err.log and /Library/Logs/com.cloudflare.cloudflared.out.log.

## Next steps

You can now route traffic through your tunnel. If you add IP routes or otherwise change the configuration, restart the service to load the new configuration:

Terminal window ```
sudo launchctl stop com.cloudflare.cloudflaredsudo launchctl start com.cloudflare.cloudflared
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Windows

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/as-a-service/windows/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/as-a-service/windows/)

Page options # Windows

You can install cloudflared as a system service on Windows.

## Configure cloudflared as a service

By default, Cloudflare Tunnel expects all of the configuration to exist in the %USERPROFILE%\.cloudflared\config.yml configuration file. At a minimum you must specify the following arguments to run as a service:

| Argument | Description |
| --- | --- |
| tunnel | The UUID of your tunnel |
| credentials-file | The location of the credentials file for your tunnel |

## Run cloudflared as a service

1. Download the latest cloudflared version.
2. Create a new directory:
Terminal windowC:\Cloudflared\bin
3. Copy the .exe file you downloaded in step 1 to the new directory and rename it to cloudflared.exe.
4. Open CMD as an administrator and go to C:\Cloudflared\bin.
5. Run this command to install cloudflared:
Terminal windowcloudflared.exe service install
6. Next, run this command to create another directory:
Terminal windowmkdir C:\Windows\System32\config\systemprofile\.cloudflared
7. Log in and authenticate cloudflared:
Terminal windowcloudflared.exe login
8. The login command will generate a cert.pem file and save it to your user profile by default. Copy the file to the .cloudflared folder created in step 5 using this command:
Terminal windowcopy C:\Users\%USERNAME%\.cloudflared\cert.pem C:\Windows\System32\config\systemprofile\.cloudflared\cert.pem
9. Next, create a tunnel:
Terminal windowcloudflared.exe tunnel create <Tunnel Name>
This will generate a credentials file in .json format.
10. Create a configuration file with the following content:
tunnel: <Tunnel ID>credentials-file: C:\Windows\System32\config\systemprofile\.cloudflared\<Tunnel-ID>.json# Uncomment the following two lines if you are using self-signed certificates in your origin server# originRequest:#   noTLSVerify: true
ingress:  - hostname: app.mydomain.com    service: https://internal.mydomain.com  - service: http_status:404logfile:  C:\Cloudflared\cloudflared.log
11. Copy the credentials file to the folder created in step 6:
Terminal windowcopy C:\Users\%USERNAME%\.cloudflared\<Tunnel-ID>.json C:\Windows\System32\config\systemprofile\.cloudflared\<Tunnel-ID>.json
12. Validate the ingress rule entries in your configuration file using the command:
Terminal windowcloudflared.exe tunnel ingress validate
13. In the Registry Editor, go to Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Cloudflared.
14. In the Cloudflared registry entry, modify ImagePath to point to the cloudflared.exe and config.yml files. Make sure that there are no extra spaces or characters while you modify the registry entry, as this could cause problems with starting the service.
Terminal windowC:\Cloudflared\bin\cloudflared.exe --config=C:\Users\%USERNAME%\.cloudflared\config.yml tunnel run
15. If the service does not start, run the following command from C:\Cloudflared\bin:
Terminal windowsc start cloudflared
You will see the output below:
SERVICE_NAME: cloudflared        TYPE               : 10  WIN32_OWN_PROCESS        STATE              : 2  START_PENDING                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)        WIN32_EXIT_CODE    : 0  (0x0)        SERVICE_EXIT_CODE  : 0  (0x0)        CHECKPOINT         : 0x0        WAIT_HINT          : 0x7d0        PID                : 3548        FLAGS              :

## Next steps

You can now route traffic through your tunnel. If you add IP routes or otherwise change the configuration, restart the service to load the new configuration:

Terminal window ```
sc stop cloudflaredsc start cloudflared
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Useful commands

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/tunnel-useful-commands/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/tunnel-useful-commands/)

Page options # Useful commands

This page lists the most commonly used commands for managing local tunnels.

To view all CLI commands, refer to the CLI help text in your terminal. For example, to view all options for the cloudflared tunnel subcommand, type cloudflared tunnel help.

## Manage tunnels

| Command | Description |
| --- | --- |
| cloudflared tunnel login | Prompts a browser window where you can authenticate your tunnel to your Cloudflare account. |
| cloudflared tunnel list | Displays all active tunnels, their creation time, and associated connections. Use the -d flag to include deleted tunnels. |
| cloudflared tunnel create <NAME or UUID> | Creates a tunnel, registers it with the Cloudflare edge and generates a credential file to run this tunnel. |
| cloudflared tunnel route | Routes traffic through a tunnel. |
| cloudflared tunnel route lb <NAME or UUID> <load balancer name> <load balancer pool> | Creates a Load Balancer with a pool that points to the tunnel. |
| cloudflared tunnel route ip add <IP/CIDR> <NAME or UUID> | Adds any network route space (represented as a CIDR) to your routing table. That network space becomes reachable for requests egressing from a user's machine as long as it is using Cloudflare WARP and is enrolled in the same account that is running the tunnel chosen here. Further, those requests will be proxied to the specified tunnel, and reach an IP in the given CIDR, as long as that IP is reachable from the tunnel. To assign the IP route to a specific Virtual Network, use the --vnet option. |
| cloudflared tunnel route ip show (or list) | Shows your organization's private routing table. You can use additional flags to filter the results. |
| cloudflared tunnel route ip delete | Deletes the row for a given CIDR from your routing table. That portion of your network will no longer be reachable by the WARP client. |
| cloudflared tunnel route ip get <IP/CIDR> | Checks which row of the routing table will be used to proxy a given IP. This helps check and validate your configuration. |
| cloudflared tunnel route dns | Creates a DNS CNAME record hostname that points to the tunnel. |
| cloudflared tunnel --config path/config.yaml run <NAME or UUID> | Runs a tunnel, creating highly available connections between your server and the Cloudflare edge. You can provide name or UUID of the tunnel to run either as the last command line argument or in the configuration file using tunnel: <NAME>. |
| cloudflared tunnel info <NAME or UUID> | Displays details about the active connectors for a given tunnel identified by name of UUID. |
| cloudflared tunnel cleanup <NAME or UUID> | Deletes connections for tunnels with the given UUIDs or names. This is useful if you get an error trying to delete or run a tunnel after cloudflared is not shut down gracefully (for example, if a kill command is issued). |
| cloudflared tunnel cleanup --connector-id <CONNECTOR-ID> <NAME or UUID> | Disconnects and deletes a cloudflared replica with the given connector ID. You can view all replicas for a tunnel by running cloudflared tunnel info <NAME or UUID>. |
| cloudflared tunnel delete <NAME or UUID> | Deletes tunnels with the given name or UUID. A tunnel cannot be deleted if it has active connections. To delete the tunnel unconditionally, use the -f flag. |
| cloudflared tunnel vnet add <NAME or UUID> | Creates a Virtual Network to which IP routes can be assigned. To make this Virtual Network the default for your Zero Trust organization, use the -d flag. |
| cloudflared tunnel vnet delete <NAME or UUID> | Deletes the Virtual Network with the given name or UUID. Before you can delete a Virtual Network, you must first delete all IP routes assigned to the Virtual Network. |
| cloudflared tunnel vnet list | Displays all active Virtual Networks, the default Virtual Network, and their creation times. |
| cloudflared tail <UUID> | Start a session to livestream logs from a specific tunnel. For more information, refer to Tunnel logs. |

## Manage cloudflared

| Command | Description |
| --- | --- |
| cloudflared update | Looks for a new version on the official download server. If a new version exists, it updates the agent binary and quits. Otherwise, no action is performed. This command only works if cloudflared was installed from GitHub binaries or from source. For more information, refer to the update instructions. |
| cloudflared version | Prints the cloudflared version number and build date. |
| cloudflared help | Shows a list of all top-level commands for cloudflared. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tunnel permissions

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/tunnel-permissions/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/tunnel-permissions/)

Page options # Tunnel permissions

Tunnel permissions determine who can run and manage a Cloudflare Tunnel. Two files control permissions for a locally-managed tunnel:

- An account certificate (cert.pem) is issued for a Cloudflare account when you login to cloudflared. Make sure you are intentional about the locations and machines you store this certificate on, as this certificate allows users to create, delete, and manage all tunnels for the account.
- A tunnel credentials file (<TUNNEL-UUID>.json) is issued for a tunnel when you create the tunnel. The credentials file only allows the user to run that specific tunnel, and do nothing else. Hence, as an admin, you can share tunnel credentials with users who will run the tunnel.

Refer to the table below for a comparison between the two files and the purposes for which they are intended.

|  | Account certificate | Tunnel credential |
| --- | --- | --- |
| File name | cert.pem | <TUNNEL-UUID>.json |
| Purpose | Authenticates your instance of cloudflared against your Cloudflare account | Authenticates the tunnel it is associated with |
| Scope | Account-wide | Tunnel-specific |
| File type | .pem | .json |
| Stored in | Default directory | Default directory |
| Issued when running | cloudflared tunnel login | cloudflared tunnel create <NAME> |
| Valid for | At least 10 years, and the service token it contains is valid until revoked | Does not expire |
| Needed to | Manage tunnels (for example, create, route, delete and list tunnels) | Run a tunnel. Create a config file. |

## Tunnel ownership

Tunnel ownership is bound to the Cloudflare account for which the cert.pem file was issued upon authenticating cloudflared. If a user in a Cloudflare account creates a tunnel, any other user in the same account who has access to the cert.pem file for the account can delete, list, or otherwise manage tunnels within it.

## Account-scoped roles

Minimum permissions needed to create, delete, and configure tunnels for an account:

- Cloudflare Access

Additional permissions needed to route traffic to a public hostname:

- DNS

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Useful terms

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/local-tunnel-terms/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/local-management/local-tunnel-terms/)

Page options # Useful terms

This page contains terminology specific to locally-managed Cloudflare Tunnels. For general Tunnel terminology, refer to the Get started section.

## Default cloudflared directory

cloudflared uses a default directory when storing credentials files for your tunnels, as well as the cert.pem file it generates when you run cloudflared login. The default directory is also where cloudflared will look for a configuration file if no other file path is specified when running a tunnel.

| OS | Path to default directory |
| --- | --- |
| Windows | %USERPROFILE%\.cloudflared |
| macOS and Unix-like systems | ~/.cloudflared, /etc/cloudflared, and /usr/local/etc/cloudflared, in this order. |

## Configuration file

This is a YAML file that functions as the operating manual for cloudflared. cloudflared will automatically look for the configuration file in the default cloudflared directory, but you can store your configuration file in any directory. It is recommended to always specify the file path for your configuration file whenever you reference it. By creating a configuration file, you can have fine-grained control over how their instance of cloudflared will operate. This includes operations like what you want cloudflared to do with traffic (for example, proxy websockets to port xxxx or SSH to port yyyy), where cloudflared should search for authorization (credentials file, tunnel token), and what mode it should run in (for example, warp-routing). In the absence of a configuration file, cloudflared will proxy outbound traffic through port 8080. For more information on how to create, store, and structure a configuration file, refer to the dedicated instructions.

## Cert.pem

This is the certificate file issued by Cloudflare when you run cloudflared tunnel login. This file uses a certificate to authenticate your instance of cloudflared and it is required when you create new tunnels, delete existing tunnels, change DNS records, or configure tunnel routing from cloudflared. This file is not required to perform actions such as running an existing tunnel or managing tunnel routing from the Cloudflare dashboard. Refer to the Tunnel permissions page for more details on when this file is needed.

The cert.pem origin certificate is valid for at least 10 years, and the service token it contains is valid until revoked.

## Credentials file

This file is created when you run cloudflared tunnel create <NAME>. It stores your tunnel's credentials in JSON format, and is unique to each tunnel. This file functions as a token authenticating the tunnel it is associated with. Refer to the Tunnel permissions page for more details on when this file is needed.

## Ingress rule

Ingress rules let you specify which local services traffic should be proxied to. If a rule does not specify a path, all paths will be matched. Ingress rules can be listed in your configuration file or when running cloudflared tunnel ingress.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Migrate legacy tunnels

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/migrate-legacy-tunnels/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/migrate-legacy-tunnels/)

Page options # Migrate legacy tunnels

Originally, a Cloudflare Tunnel connection corresponded to a DNS record in your account. Requests to that hostname hit Cloudflare's network first and our edge sends those requests over the tunnel to your origin. However, fitting an outbound-only connection into a reverse proxy creates some ergonomic and stability hurdles. The original Cloudflare Tunnel architecture attempted to both manage DNS records and create connections. When connections became disrupted, Tunnel would recreate the entire deployment. Additionally, Argo Tunnel connections could not be treated like regular origin servers in Cloudflare's control plane and had to be managed directly from the server-side software.

Today, Cloudflare Tunnel's architecture distinguishes between the persistent objects (DNS records, cloudflared) and the ephemeral objects (the connections). To do that, it assigns permanent names and UUIDs to tunnels, which makes them more stable and easier to use. Since the name and UUID for a tunnel do not change, your DNS record never needs to be cleaned up or recreated when Cloudflare Tunnel restarts. In the event of a restart, the enrolled instance of cloudflared connects back to that UUID address.

## Check for legacy tunnels

To check if you still have legacy tunnels:

1. Log into the Cloudflare dashboard ‚Üó and select a zone. Legacy Tunnels are associated with a zone and not by account.
2. Go to Traffic > Cloudflare Tunnel.

If nothing appears, this indicates there are no legacy tunnels associated with the zone. If legacy tunnels appear, follow the migration instructions below.

Note

Named tunnels will only appear in Zero Trust ‚Üó under Networks > Tunnels.

## Migrate legacy tunnels

To migrate your legacy tunnels to the named tunnels architecture:

1. Download the latest version of cloudflared.
2. Obtain a new origin certificate by running cloudflared login. While named tunnels are scoped to an account, for legacy reasons the login page requires selecting a zone.
3. Create a tunnel.
Terminal windowcloudflared tunnel create <TUNNEL-NAME>
4. Route traffic to your tunnel to create routes that your tunnel will serve.


If your legacy tunnel was serving tunnel.example.com, run this command to configure your named tunnel to also serve tunnel.example.com. For more information, refer to the DNS Record routing section.
Terminal windowcloudflared tunnel route dns <TUNNEL-NAME> tunnel.example.com


If you used to run your legacy tunnel with the --lb-pool flag, run this command to set up your named tunnel as a load balancer origin. For more information, refer to the Load Balancers routing section.
Terminal windowcloudflared tunnel route lb <TUNNEL-NAME> <LOAD-BALANCER-NAME> <LOAD-BALANCER-POOL>
5. If your legacy tunnel was serving tunnel.example.com, run this command to configure your named tunnel to also serve tunnel.example.com. For more information, refer to the DNS Record routing section.
Terminal windowcloudflared tunnel route dns <TUNNEL-NAME> tunnel.example.com
6. If you used to run your legacy tunnel with the --lb-pool flag, run this command to set up your named tunnel as a load balancer origin. For more information, refer to the Load Balancers routing section.
Terminal windowcloudflared tunnel route lb <TUNNEL-NAME> <LOAD-BALANCER-NAME> <LOAD-BALANCER-POOL>
7. Next, create a configuration file with ingress rules. The ingress rules describe how to dispatch requests to your origins based on hostname and path. For example, if in the past you used to run cloudflared tunnel --hostname tunnel.example.com --url https://localhost:3000, you should add an equivalent ingress rule to your configuration file:
ingress:  - hostname: tunnel.example.com    service: https://localhost:3000  - service: http_status:404# Note that the last rule is the catch-all rule and is required.
8. Run your tunnel.

## Make sure everything works

Once your migration is done, validate your new named tunnel:

1. Make sure the resource behind the tunnel is accessible.
2. Run cloudflared tunnel info <NAME-or-UUID> to confirm that the named tunnel exists.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Quick Tunnels

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/trycloudflare/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/do-more-with-tunnels/trycloudflare/)

Page options # Quick Tunnels

Developers can use the TryCloudflare tool to experiment with Cloudflare Tunnel without adding a site to Cloudflare's DNS. TryCloudflare will launch a process that generates a random subdomain on trycloudflare.com. Requests to that subdomain will be proxied through the Cloudflare network to your web server running on localhost.

## Use TryCloudflare

1. Follow these instructions to install cloudflared. If you have an older copy, update to 2020.5.1 or later.
2. Launch a web server that is available over localhost to cloudflared.
3. Run the following terminal command to start a free tunnel.

Terminal window ```
cloudflared tunnel --url http://localhost:8080
```

cloudflared will generate a random subdomain when connecting to the Cloudflare network and print it in the terminal for you to use and share. The output will serve traffic from the server on your local machine to the public Internet, using Cloudflare's Argo Smart Routing, at a public URL.

Note

TryCloudflare quick tunnels are currently not supported if a config.yaml configuration file is present in the .cloudflared directory. It may be necessary to rename that file temporarily to use the feature.

## FAQ

### What are some example use cases for TryCloudflare?

- Create a web server for a project on your laptop that you want to share with others on different networks
- Test browser compatibility for a new site by creating a free Tunnel and testing the link in different browsers
- Run speed tests from different regions by using a tool like Pingdom or WebPageTest to connect to the randomly-generated subdomain created by TryCloudflare

### Why does Cloudflare provide this service for free?

- We want more users to experience the speed and security improvements of Cloudflare Tunnel (and Argo Smart Routing). We hope you test it with TryCloudflare and decide to add it to your production sites.
- Cloudflare's features historically require you to own a domain, set that domain's DNS to Cloudflare's nameservers, and configure its DNS records before you can begin to use any services. We hope to make more and more of our products available to trial without that burden.
- We don't guarantee any SLA or uptime of TryCloudflare - we plan to test new Cloudflare Tunnel features and improvements on these free tunnels. This provides us with a group of connections to test before we deploy to production customers. Free tunnels are meant to be used for testing and development, not for deploying a production website.

### Limitations

- Quick Tunnels are subject to a hard limit on the number of concurrent requests that can be proxied at any point in time. Currently, this limit is 200 in-flight requests. If a Quick Tunnel hits this limit, the HTTP response will return a 429 status code.
- Quick Tunnels do not support Server-Sent Events (SSE).

These limitations only apply to Quick Tunnels. To avoid these limitations, sign up ‚Üó for a Cloudflare account and create a Cloudflare Tunnel.

### Legal

Your installation of cloudflared software constitutes a symbol of your signature indicating that you accept the terms of the Cloudflare License, Terms ‚Üó and Privacy Policy ‚Üó.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect devices

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/)

Page options # Connect devices

Configure devices to send DNS queries to Cloudflare, or proxy all traffic leaving the device through Cloudflare's network.

- WARP
- Agentless options
- User-side certificates

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## WARP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/)

Page options # WARP

## About Cloudflare WARP

The Cloudflare WARP client allows you to protect corporate devices by securely and privately sending traffic from those devices to Cloudflare's global network, where Cloudflare Gateway can apply advanced web filtering. The WARP client also makes it possible to apply advanced Zero Trust policies that check for a device's health before it connects to corporate applications.

## How WARP works

WARP is a device client that builds proxy tunnels using either Wireguard or MASQUE, and builds a DNS proxy using DNS-over-HTTPS. WARP supports all major operating systems, all common forms of endpoint management tooling, and has a robust series of management parameters and profiles to accurately scope the needs of a diverse user base.

The WARP client consists of:

- Graphical User Interface (GUI): Control panel that allows end users to view WARP's status and perform actions such as turning WARP on or off.
- WARP daemon (or service): Core background component responsible for establishing secure tunnels (using WireGuard or MASQUE) and handling all WARP functionality on your device.

For more information on how the WARP client routes traffic, refer to the WARP architecture page and watch the video below.

Chapters

- Introduction and WARP GUI Basics  0s
- Consumer vs. Corporate WARP  57s
- Device Profiles Explained  1m35s
- WARP Operating Modes  2m12s
- Split Tunneling  3m44s
- Conclusion  4m56s

## WARP installation details

The GUI and daemon (or service) have different names and are stored in the following locations:

Windows |  | Windows |
| --- | --- |
| Service / Daemon | C:\Program Files\Cloudflare\Cloudflare WARP\warp-svc.exe |
| GUI application | C:\Program Files\Cloudflare\Cloudflare WARP\Cloudflare WARP.exe |
| Logs Location | DaemonC:\ProgramData\Cloudflare\GUI LogsC:\Users\<USER>.WARP\AppData\Localor%LOCALAPPDATA%\Cloudflare |

macOS |  | macOS |
| --- | --- |
| Service / Daemon | /Applications/Cloudflare WARP.app/Contents/Resources/CloudflareWARP |
| GUI application | /Applications/Cloudflare WARP.app/Contents/MacOS/Cloudflare WARP |
| Logs Location | Daemon/Library/Application Support/Cloudflare/GUI Logs~/Library/Logs/Cloudflare/ |

Linux |  | Linux |
| --- | --- |
| Service / Daemon | /bin/warp-svc |
| GUI application | /bin/warp-taskbar |
| Logs Location | /var/log/cloudflare-warp//var/lib/cloudflare-warp |

Along with the WARP GUI and daemon, warp-cli and warp-diag are also installed on the machine and added to the system path for use from any terminal session.

warp-diag is a command-line diagnostics tool that collects logs, configuration details, and connectivity data from the WARP client to help troubleshoot issues.

warp-cli is the command-line interface (CLI) for managing and configuring the Cloudflare WARP client, allowing users to connect, disconnect, and adjust settings programmatically.

## Key benefits of using WARP

Deploying the WARP client significantly enhances your organization's security and visibility within Cloudflare Zero Trust:

- Unified security policies everywhere: With the WARP client deployed in the Gateway with WARP mode, Gateway policies are not location-dependent ‚Äî they can be enforced anywhere.
- Advanced web filtering and threat protection: Activate Gateway features for your device traffic, including:

Anti-Virus scanning
HTTP filtering
Browser Isolation
Identity-based policies
- Anti-Virus scanning
- HTTP filtering
- Browser Isolation
- Identity-based policies
- Application and device-specific insights: With WARP installed on your corporate devices, you can view detailed application and user-level activity on the Zero Trust Shadow IT Discovery page, while also monitoring device and network performance with Digital Experience Monitoring (DEX) to proactively detect and resolve issues.
- Device posture checks: The WARP client provides advanced Zero Trust protection by making it possible to check for device posture. By setting up device posture checks, you can build Zero Trust policies that check for a device's location, disk encryption status, OS version, and more.
- Secure private and infrastructure access: WARP lets devices connect to private networks over Cloudflare Tunnel and is required for Access for Infrastructure, enabling secure SSH with short-lived certificates and detailed logging.

## WARP modes

WARP offers flexible operating modes to suit your specific needs. WARP can control device traffic as a full proxy, manage only DNS traffic as a DNS proxy, or both. WARP is the most common method for sending user device traffic through Cloudflare Gateway for filtering and decryption.

## Next steps

- Review the first-time setup guide to install and deploy the WARP client on your corporate devices.
- Review possible WARP modes and settings to best suit your organization's needs.
- Explore Cloudflare Gateway to enforce advanced DNS, network, HTTP, and egress policies with WARP.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Download WARP stable releases

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/download-warp/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/download-warp/)

Page options # Download WARP stable releases

This page contains the stable WARP client releases currently supported by Cloudflare. We recommend using stable releases for production environments. You can download stable releases from the links below after checking requirements.

Cloudflare also offers an unstable beta release track with the latest features and improvements. To preview new features before they are available in a stable release, refer to the beta release page.

## Windows

Download latest stable release

|  |  |
| --- | --- |
| OS version | Windows 10, Windows 11, Windows 365 Cloud PC running Windows 11 |
| Processor | AMD64 / x86-64 |
| .NET Framework version | 4.7.2 or later |
| HD space | 184 MB |
| Memory | 3 MB |
| Network interface type | WIFI or LAN |
| Minimum MTU | 1360 bytes1 |

## Footnotes

1. WireGuard requires 1360 bytes for IPv6 and 1340 bytes for IPv4. MASQUE requires 1350 bytes for IPv6 and 1330 bytes for IPv4. ‚Ü©

Latest release

Version: Windows 2025.6.1400.0 Date: 2025-08-21 Size: 134 MB Download

#### Release notes

This release contains a hotfix for pre-login for multi-user for the 2025.6.1135.0 release.

Changes and improvements

- Fixes an issue where new pre-login registrations were not being properly created.

Known issues

- For Windows 11 24H2 users, Microsoft has confirmed a regression that may lead to performance issues like mouse lag, audio cracking, or other slowdowns. Cloudflare recommends users experiencing these issues upgrade to a minimum Windows 11 24H2 KB5062553 or higher for resolution.
- Devices using WARP client 2025.4.929.0 and up may experience Local Domain Fallback failures if a fallback server has not been configured. To configure a fallback server, refer to Route traffic to fallback server.
- Devices with KB5055523 installed may receive a warning about Win32/ClickFix.ABA being present in the installer. To resolve this false positive, update Microsoft Security Intelligence to version 1.429.19.0 or later.
- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, please reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Previous version history (14)

Windows 2025.6.1335.0

Version: Windows 2025.6.1335.0 Date: 2025-08-19 Size: 134 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements

- Improvements to better manage multi-user pre-login registrations.
- Fixed an issue preventing devices from reaching split-tunneled traffic even when WARP was disconnected.
- Fix to prevent WARP from re-enabling its firewall rules after a user-initiated disconnect.
- Improvement for faster client connectivity on high-latency captive portal networks.
- Fixed an issue where recursive CNAME records could cause intermittent WARP connectivity issues.

Known issues

- For Windows 11 24H2 users, Microsoft has confirmed a regression that may lead to performance issues like mouse lag, audio cracking, or other slowdowns. Cloudflare recommends users experiencing these issues upgrade to a minimum Windows 11 24H2 version KB5062553 or higher for resolution.
- Devices using WARP client 2025.4.929.0 and up may experience Local Domain Fallback failures if a fallback server has not been configured. To configure a fallback server, refer to Route traffic to fallback server.
- Devices with KB5055523 installed may receive a warning about Win32/ClickFix.ABA being present in the installer. To resolve this false positive, update Microsoft Security Intelligence to version 1.429.19.0 or later.
- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2025.5.943.0

Version: Windows 2025.5.943.0 Date: 2025-07-23 Size: 130 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements

- WARP proxy mode now uses the operating system's DNS settings. Changes made to system DNS settings while in proxy mode require the client to be turned off then back on to take effect.
- Changes to the SCCM VPN boundary support feature to no longer restart the SMS Agent Host (ccmexec.exe) service.
- Fixed an issue affecting clients in Split Tunnel Include mode, where access to split-tunneled traffic was blocked after reconnecting the client.

Known issues

- For Windows 11 24H2 users, Microsoft has confirmed a regression that may lead to performance issues like mouse lag, audio cracking, or other slowdowns. Cloudflare recommends users experiencing these issues upgrade to a minimum Windows 11 24H2 version KB5062553 or higher for resolution.
- Devices using WARP client 2025.4.929.0 and up may experience Local Domain Fallback failures if a fallback server has not been configured. To configure a fallback server, refer to Route traffic to fallback server.
- Devices with KB5055523 installed may receive a warning about Win32/ClickFix.ABA being present in the installer. To resolve this false positive, update Microsoft Security Intelligence to version 1.429.19.0 or later.
- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2025.5.893.0

Version: Windows 2025.5.893.0 Date: 2025-06-30 Size: 129 MB Download

#### Release notes

This release contains improvements and new exciting features, including SCCM VPN boundary support and post-quantum cryptography. By tunneling your corporate network traffic over Cloudflare, you can now gain the immediate protection of post-quantum cryptography without needing to upgrade any of your individual corporate applications or systems.

Changes and improvements

- Fixed a device registration issue that caused WARP connection failures when changing networks.
- Captive portal improvements and fixes:
Captive portal sign in notifications will now be sent through operating system notification services.
Fix for firewall configuration issue affecting clients in DoH only mode.
- Captive portal sign in notifications will now be sent through operating system notification services.
- Fix for firewall configuration issue affecting clients in DoH only mode.
- Improved the connectivity status message in the client GUI.
- Fixed a bug affecting clients in Gateway with DoH mode where the original DNS servers were not restored after disabling WARP.
- The WARP client now applies post-quantum cryptography end-to-end on enabled devices accessing resources behind a Cloudflare Tunnel. This feature can be enabled by MDM.
- Improvement to handle client configuration changes made by an MDM while WARP is not running.
- Improvements for multi-user experience to better handle fast user switching and transitions from a pre-login to a logged-in state.
- Added a WARP client device posture check for SAN attributes to the client certificate check.
- Fixed an issue affecting Split Tunnel Include mode, where traffic outside the tunnel was blocked when switching between Wi-Fi and Ethernet networks.
- Added SCCM VPN boundary support to device profile settings. With SCCM VPN boundary support enabled, operating systems will register WARP's local interface IP with the on-premise DNS server when reachable.
- Fix for an issue causing WARP connectivity to fail without full system reboot.

Known issues

- For Windows 11 24H2 users, Microsoft has confirmed a regression that may lead to performance issues like mouse lag, audio cracking, or other slowdowns. Cloudflare recommends users experiencing these issues upgrade to a minimum Windows 11 24H2 version KB5060829 or higher for resolution.
- Devices with KB5055523 installed may receive a warning about Win32/ClickFix.ABA being present in the installer. To resolve this false positive, update Microsoft Security Intelligence to version 1.429.19.0 or later.
- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2025.4.943.0

Version: Windows 2025.4.943.0 Date: 2025-05-22 Size: 130 MB Download

#### Release notes

This release contains a hotfix for managed networks for the 2025.4.929.0 release.

Changes and improvements

- Fixed an issue where it could take up to 3 minutes for the correct device profile to be applied in some circumstances. In the worst case, it should now only take up to 40 seconds. This will be improved further in a future release.

Known issues

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.
- Microsoft has confirmed a regression with Windows 11 starting around 24H2 that may cause performance issues for some users. These performance issues could manifest as mouse lag, audio cracking, or other slowdowns. A fix from Microsoft is expected in early July.
- Devices with KB5055523 installed may receive a warning about Win32/ClickFix.ABA being present in the installer. To resolve this false positive, update Microsoft Security Intelligence to version 1.429.19.0 or later.

Windows 2025.4.929.0

Version: Windows 2025.4.929.0 Date: 2025-05-14 Size: 130 MB Download

#### Release notes

This release contains two significant changes all customers should be aware of:

1. All DNS traffic now flows inside the WARP tunnel. Customers are no longer required to configure their local firewall rules to allow our DoH IP addresses and domains.
2. When using MASQUE, the connection will fall back to HTTP/2 (TCP) when we detect that HTTP/3 traffic is blocked. This allows for a much more reliable connection on some public WiFi networks.

Changes and improvements

- Fixed an issue causing reconnection loops when captive portals are detected.
- Fixed an issue that caused WARP client disk encryption posture checks to fail due to missing drive names.
- Fixed an issue where managed network policies could incorrectly report network location beacons as missing.
- Improved DEX test error reporting.
- Fixed an issue where some parts of the WARP Client UI were missing in high contrast mode.
- Fixed an issue causing client notifications to fail in IPv6 only environments which prevented the client from receiving configuration changes to settings like device profile.
- Added a TCP fallback for the MASQUE tunnel protocol to improve connectivity on networks that block UDP or HTTP/3 specifically.
- Added new IP addresses for tunnel connectivity checks. If your organization uses a firewall or other policies you will need to exempt these IPs.
- DNS over HTTPS traffic is now included in the WARP tunnel by default.
- Improved the error message displayed in the client GUI when the rate limit for entering an incorrect admin override code is met.
- Improved handling of non-SLAAC IPv6 interface addresses for better connectivity in IPv6 only environments.
- Fixed an issue where frequent network changes could cause WARP to become unresponsive.
- Improvement for WARP to check if tunnel connectivity fails or times out at device wake before attempting to reconnect.
- Fixed an issue causing WARP connection disruptions after network changes.

Known issues

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.
- Microsoft has confirmed a regression with Windows 11 starting around 24H2 that may cause performance issues for some users. These performance issues could manifest as mouse lag, audio cracking, or other slowdowns. A fix from Microsoft is expected in early July.
- Devices with KB5055523 installed may receive a warning about Win32/ClickFix.ABA being present in the installer. To resolve this false positive, update Microsoft Security Intelligence to version 1.429.19.0 or later.

Windows 2025.2.664.0

Version: Windows 2025.2.664.0 Date: 2025-04-08 Size: 128 MB Download

#### Release notes

This release contains a hotfix for captive portal detection for the 2025.2.600.0 release.

Changes and improvements

- Fix to reduce the number of browser tabs opened during captive portal logins.

Known issues

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2025.2.600.0

Version: Windows 2025.2.600.0 Date: 2025-03-31 Size: 128 MB Download

#### Release notes

This release contains support for a new WARP setting, Global WARP override. It also includes significant improvements to our captive portal / public Wi-Fi detection logic. If you have experienced captive portal issues in the past, re-test and give this version a try.

Changes and improvements

- Improved captive portal detection to make more public networks compatible and have faster detection.
- Improved error messages shown in the app.
- Added the ability to control if the WARP interface IPs are registered with DNS servers or not.
- Removed DNS logs view from the Windows client GUI. DNS logs can be viewed as part of warp-diag or by viewing the log file on the user's local directory.
- Fixed an issue that would result in a user receiving multiple re-authentication requests when waking their device from sleep.
- WARP tunnel protocol details can now be viewed using the warp-cli tunnel stats command.
- Improvements to Windows multi-user including support for fast user switching. If you are interested in testing this feature, reach out to your Cloudflare account team.
- Fixed an issue with device revocation and re-registration when switching configurations.
- Fixed an issue where DEX tests would run during certain sleep states where the networking stack was not fully up. This would result in failures that would be ignored.
- Added a new Global WARP override setting. This setting puts account administrators in control of disabling and enabling WARP across all devices registered to an account from the dashboard. Global WARP override is disabled by default.

Known issues

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2025.1.861.0

Version: Windows 2025.1.861.0 Date: 2025-02-19 Size: 128 MB Download

#### Release notes

This release contains only improvements.

Changes and improvements

- Improved command line interface for Access for Infrastructure with added function for filtering and ordering.
- Fixed client connectivity issues when switching between managed network profiles that use different WARP protocols.
- Added support for WARP desktop to use additional DoH endpoints to help reduce NAT congestion.
- Improved connectivity check reliability in certain split tunnel configurations.
- Improved reading of device DNS settings at connection restart.
- Improved WARP connectivity in environments with virtual machine interfaces.
- Improved Wireguard connection stability on reconnections.
- Improved reliability of device posture checks for OS Version, Unique Client ID, Domain Joined, Disk Encryption, and Firewall attributes.
- Added additional HTTP/3 QUIC connectivity test to warp-diag.
- Added support for collection of system health metrics for enhanced device Digital Experience Monitoring.
- Automated the removal of active registrations for devices with multiple registrations with the same Zero Trust organization.

Known issues

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2024.12.760.0

Version: Windows 2024.12.760.0 Date: 2025-01-09 Size: 126 MB Download

#### Release notes

This release contains only a hotfix from the 2024.12.554.0 release.

Changes and improvements:

- Fixed an issue that could prevent clients with certain split tunnel configurations from connecting.

Known issues:

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2024.12.554.0

Version: Windows 2024.12.554.0 Date: 2024-12-19 Size: 126 MB Download

#### Release notes

This release contains improvements to support custom Gateway certificate installation in addition to the changes and improvements included in version 2024.12.492.0.

Changes and improvements:

- Adds support for installing all available custom Gateway certificates from an account to the system store.
- Users can now get a list of installed certificates by running warp-cli certs.

Known issues:

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2024.12.492.0

Version: Windows 2024.12.492.0 Date: 2024-12-18 Size: 126 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements:

- Consumers can now set the tunnel protocol using warp-cli tunnel protocol set <protocol>.
- Extended diagnostics collection time in warp-diag to ensure logs are captured reliably.
- Improved captive portal support by disabling the firewall during captive portal login flows.
- Improved captive portal detection on certain public networks.
- Improved reconnection speed when a Cloudflare server is in a degraded state.
- Fixed an issue where WARP may fail to remove certificates from the user store in Device Information Only mode.
- Ensured at most one Powershell instance is opened when fetching the device serial number for posture checks.
- Fixed an issue to prevent the daemon from following Windows junctions created by non-admin users that could be used to delete files as SYSTEM user and potentially gain SYSTEM user privileges.
- Improved reliability of connection establishment logic under degraded network conditions.
- Fixed an issue that caused high memory usage when viewing connection statistics for extended periods of time.
- Improved WARP connectivity in environments with virtual interfaces from VirtualBox, VMware, and similar tools.
- Reduced connectivity interruptions on WireGuard Split Tunnel Include mode configurations.
- Fixed connectivity issues switching between managed network profiles with different configured protocols.
- QLogs are now disabled by default and can be enabled with warp-cli debug qlog enable. The QLog setting from previous releases will no longer be respected.

Known issues:

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2024.11.309.0

Version: Windows 2024.11.309.0 Date: 2024-11-18 Size: 123 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements:

- Fixed an issue where SSH sessions and other application connections over TCP or UDP could drop when a device that is using MASQUE changes its primary network interface.
- Fixed an issue to ensure the Cloudflare root certificate (or custom certificate) is installed in the trust store if not already there.
- Fixed an issue with the WARP client becoming unresponsive during startup.
- Extended diagnostics collection time in warp-diag to ensure logs are captured reliably.
- Fixed an issue that was preventing proper operation of DNS-over-TLS (DoT) for consumer users.

Known issues:

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2024.9.346.0

Version: Windows 2024.9.346.0 Date: 2024-10-03 Size: 122 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements:

- Added target list to the warp-cli to enhance the user experience with the Access for Infrastructure SSH solution.
- Added pre-login configuration details to the warp-diag output.
- Added a tunnel reset mtu subcommand to the warp-cli.
- Added a JSON output option to the warp-cli.
- Added the ability for warp-cli to use the team name provided in the MDM file for initial registration.
- Added the ability to execute a PCAP on multiple interfaces with warp-cli and warp-dex.
- Improved warp-dex default interface selection for PCAPs and changed warp-dex CLI output to JSON.
- Fixed an issue where the client, when switching between WireGuard and MASQUE protocols, sometimes required a manual tunnel key reset.
- Added MASQUE tunnel protocol support for the consumer version of WARP (1.1.1.1 w/ WARP).

Known issues:

- Using MASQUE as the tunnel protocol may be incompatible if your organization has Regional Services enabled.

Windows 2024.8.458.0

Version: Windows 2024.8.458.0 Date: 2024-09-26 Size: 121 MB Download

#### Release notes

This release contains minor fixes and improvements.

Notable updates

- Added the ability to customize PCAP options in the warp-cli.
- Added a list of installed applications in warp-diag.
- Added a summary of warp-dex traceroute results in its JSON output.
- Improved the performance of firewall operations when enforcing split tunnel configuration.
- Reduced the time it takes for a WARP client update to complete.
- Fixed an issue where clients using service tokens failed to retry the initial connection when there is no network connectivity on startup.
- Fixed issues where incorrect DNS server addresses were being applied following reboots and network changes. Any incorrect static entries set by previous WARP versions must be manually reverted.
- Fixed a known issue which required users to re-register when an older single configuration MDM file was deployed after deploying the newer, multiple configuration format.
- Deprecated warp-cli commands have been removed. If you have any workflows that use the deprecated commands, please update to the new commands where necessary.

Known issues

- Using MASQUE as the tunnel protocol may be incompatible if your organization has Regional Services enabled.
- DNS resolution may be broken when the following condition are all true:
WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.
To work around this issue, please reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.
To work around this issue, please reconnect the WARP client by toggling off and back on.

## macOS

Download latest stable release

|  |  |
| --- | --- |
| OS version | Big Sur 11.0+, Monterey 12.0+, Ventura 13.0+, Sonoma 14.0+, Sequoia 15.1+ (15.0.x is not supported) |
| Processor | Intel or M series |
| HD space | 75 MB |
| Memory | 35 MB |
| Network interface type | WIFI or LAN |
| Minimum MTU | 1360 bytes1 |

## Footnotes

1. WireGuard requires 1360 bytes for IPv6 and 1340 bytes for IPv4. MASQUE requires 1350 bytes for IPv6 and 1330 bytes for IPv4. ‚Ü©

Latest release

Version: macOS 2025.6.1335.0 Date: 2025-08-19 Size: 108 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements

- Fixed an issue preventing devices from reaching split-tunneled traffic even when WARP was disconnected.
- Fix to prevent WARP from re-enabling its firewall rules after a user-initiated disconnect.
- Improvement for faster client connectivity on high-latency captive portal networks.
- Fixed an issue where recursive CNAME records could cause intermittent WARP connectivity issues.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.4 or later.
- Devices using WARP client 2025.4.929.0 and up may experience Local Domain Fallback failures if a fallback server has not been configured. To configure a fallback server, refer to Route traffic to fallback server.

Previous version history (12)

macOS 2025.5.943.0

Version: macOS 2025.5.943.0 Date: 2025-07-23 Size: 96.7 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements

- WARP proxy mode now uses the operating system's DNS settings. Changes made to system DNS settings while in proxy mode require the client to be turned off then back on to take effect.
- Fixed an issue affecting clients in Split Tunnel Include mode, where access to split-tunneled traffic was blocked after reconnecting the client.
- For macOS deployments, the WARP client can now be managed using an mdm.xml file placed in /Library/Application Support/Cloudflare/mdm.xml. This new configuration option offers an alternative to the still supported method of deploying a managed plist through an MDM solution.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.4 or later.
- Devices using WARP client 2025.4.929.0 and up may experience Local Domain Fallback failures if a fallback server has not been configured. To configure a fallback server, refer to Route traffic to fallback server.

macOS 2025.5.893.0

Version: macOS 2025.5.893.0 Date: 2025-06-30 Size: 95.5 MB Download

#### Release notes

This release contains improvements and new exciting features, including post-quantum cryptography. By tunneling your corporate network traffic over Cloudflare, you can now gain the immediate protection of post-quantum cryptography without needing to upgrade any of your individual corporate applications or systems.

Changes and improvements

- Fixed an issue where WARP sometimes failed to automatically relaunch after updating.
- Fixed a device registration issue causing WARP connection failures when changing networks.
- Captive portal improvements and fixes:
Captive portal sign in notifications will now be sent through operating system notification services.
Fix for firewall configuration issue affecting clients in DoH only mode.
- Captive portal sign in notifications will now be sent through operating system notification services.
- Fix for firewall configuration issue affecting clients in DoH only mode.
- Improved the connectivity status message in the client GUI.
- The WARP client now applies post-quantum cryptography end-to-end on enabled devices accessing resources behind a Cloudflare Tunnel. This feature can be enabled by MDM.
- Improvement to handle client configuration changes made by an MDM while WARP is not running.
- Fixed an issue affecting Split Tunnel Include mode, where traffic outside the tunnel was blocked when switching between Wi-Fi and Ethernet networks.
- Improvement for WARP connectivity issues on macOS due to the operating system not accepting DNS server configurations.
- Added a WARP client device posture check for SAN attributes to the client certificate check.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.4 or later.

macOS 2025.4.943.0

Version: macOS 2025.4.943.0 Date: 2025-05-22 Size: 96.4 MB Download

#### Release notes

This release contains a hotfix for managed networks for the 2025.4.929.0 release.

Changes and improvements

- Fixed an issue where it could take up to 3 minutes for the correct device profile to be applied in some circumstances. In the worst case, it should now only take up to 40 seconds. This will be improved further in a future release.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.4 or later.

macOS 2025.4.929.0

Version: macOS 2025.4.929.0 Date: 2025-05-12 Size: 96.4 MB Download

#### Release notes

This release contains two significant changes all customers should be aware of:

1. All DNS traffic now flows inside the WARP tunnel. Customers are no longer required to configure their local firewall rules to allow our DoH IP addresses and domains.
2. When using MASQUE, the connection will fall back to HTTP/2 (TCP) when we detect that HTTP/3 traffic is blocked. This allows for a much more reliable connection on some public WiFi networks.

Changes and improvements

- Fixed an issue where the managed network policies could incorrectly report network location beacons as missing.
- Improved DEX test error reporting.
- Fixed an issue causing client notifications to fail in IPv6 only environments which prevented the client from receiving configuration changes to settings like device profile.
- Improved captive portal detection.
- Added a TCP fallback for the MASQUE tunnel protocol to improve connectivity on networks that block UDP or HTTP/3 specifically.
- Added new IP addresses for tunnel connectivity checks. If your organization uses a firewall or other policies you will need to exempt these IPs.
- DNS over HTTPS traffic is now included in the WARP tunnel by default.
- Improved the error message displayed in the client GUI when the rate limit for entering an incorrect admin override code is met.
- Improved handling of non-SLAAC IPv6 interface addresses for better connectivity in IPv6 only environments.
- Fixed an issue where frequent network changes could cause WARP to become unresponsive.
- Improvement for WARP to check if tunnel connectivity fails or times out at device wake before attempting to reconnect.
- Fixed an issue causing WARP connection disruptions after network changes.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.4 or later.

macOS 2025.2.664.0

Version: macOS 2025.2.664.0 Date: 2025-04-08 Size: 91.8 MB Download

#### Release notes

This release contains a hotfix for captive portal detection and PF state tables for the 2025.2.600.0 release.

Changes and improvements

- Fix to reduce the number of browser tabs opened during captive portal logins.
- Improvement to exclude local DNS traffic entries from PF state table to reduce risk of connectivity issues from exceeding table capacity.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.4 or later.

macOS 2025.2.600.0

Version: macOS 2025.2.600.0 Date: 2025-03-31 Size: 91.8 MB Download

#### Release notes

This release contains support for a new WARP setting, Global WARP override. It also includes significant improvements to our captive portal / public Wi-Fi detection logic. If you have experienced captive portal issues in the past, re-test and give this version a try.

Changes and improvements

- Improved captive portal detection to make more public networks compatible and have faster detection.
- Improved error messages shown in the app.
- WARP tunnel protocol details can now be viewed using the warp-cli tunnel stats command.
- Fixed an issue with device revocation and re-registration when switching configurations.
- Added a new Global WARP override setting. This setting puts account administrators in control of disabling and enabling WARP across all devices registered to an account from the dashboard. Global WARP override is disabled by default.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.3 or later.

macOS 2025.1.861.0

Version: macOS 2025.1.861.0 Date: 2025-02-19 Size: 92.4 MB Download

#### Release notes

This release contains minor fixes and improvements.

Note: If using macOS Sequoia, Cloudflare recommends the use of macOS 15.3 or later. With macOS 15.3, Apple addressed several issues that may have caused the WARP client to not behave as expected when used with macOS 15.0.x.

Changes and improvements

- Improved command line interface for Access for Infrastructure with added function for filtering and ordering.
- Fixed client connectivity issues when switching between managed network profiles that use different WARP protocols.
- Improved OS version posture checks on macOS for greater reliability and availability.
- Added support for WARP desktop to use additional DoH endpoints to help reduce NAT congestion.
- Improved Wireguard connection stability on reconnections.
- Added additional HTTP/3 QUIC connectivity test to warp-diag.
- Added support for collection of system health metrics for enhanced device Digital Experience Monitoring.
- Automated the removal of active registrations for devices with multiple registrations with the same Zero Trust organization.
- Fixes issues with deleted registration at start up.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.3 or later.

macOS 2024.12.554.0

Version: macOS 2024.12.554.0 Date: 2024-12-19 Size: 86.1 MB Download

#### Release notes

This release contains improvements to support custom Gateway certificate installation in addition to the changes and improvements included in version 2024.12.492.0.

Note: If using macOS Sequoia, Cloudflare recommends the use of macOS 15.2 or later. With macOS 15.2, Apple addressed several issues that may have caused the WARP client to not behave as expected when used with macOS 15.0 and 15.1.

Changes and improvements:

- Adds support for installing all available custom Gateway certificates from an account to the system store.
- Users can now get a list of installed certificates by running warp-cli certs.

Known issues:

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.2 or later.

macOS 2024.12.492.0

Version: macOS 2024.12.492.0 Date: 2024-12-19 Size: 84.7 MB Download

#### Release notes

This release contains minor fixes and improvements.

Note: If using macOS Sequoia, Cloudflare recommends the use of macOS 15.2 or later. With macOS 15.2, Apple addressed several issues that may have caused the WARP client to not behave as expected when used with macOS 15.0 and 15.1.

Changes and improvements:

- Consumers can now set the tunnel protocol using warp-cli tunnel protocol set <protocol>.
- Extended diagnostics collection time in warp-diag to ensure logs are captured reliably.
- Improved captive portal support by disabling the firewall during captive portal login flows.
- Improved reliability of connection establishment logic under degraded network conditions.
- Improved reconnection speed when a Cloudflare server is in a degraded state.
- Improved captive portal detection on certain public networks.
- Fixed an issue where admin override displayed an incorrect override end time.
- Reduced connectivity interruptions on WireGuard Split Tunnel Include mode configurations.
- Fixed connectivity issues switching between managed network profiles with different configured protocols.
- QLogs are now disabled by default and can be enabled with warp-cli debug qlog enable. The QLog setting from previous releases will no longer be respected.

Known issues:

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.2 or later.

macOS 2024.11.309.0

Version: macOS 2024.11.309.0 Date: 2024-11-18 Size: 81 MB Download

#### Release notes

This release contains reliability improvements and general bug fixes.

Changes and improvements:

- Fixed an issue where SSH sessions and other application connections over TCP or UDP could drop when a device that is using MASQUE changes its primary network interface.
- Fixed an issue to ensure the Cloudflare root certificate (or custom certificate) is installed in the trust store if not already there.
- Fixed an issue with the WARP client becoming unresponsive during startup.
- Extended warp-diag to collect system profiler firewall state as part of diagnostics.
- Fixed an issue with the WARP client becoming unresponsive while handling LAN inclusion.
- Fixed an issue where users were unable to connect with an IPC error message displayed in the UI.
- Fixed an issue that was preventing proper operation of DNS-over-TLS (DoT) for consumer users.

Known issues:

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare  recommends the use of macOS 15.1 or later.

macOS 2024.9.346.0

Version: macOS 2024.9.346.0 Date: 2024-10-03 Size: 80 MB Download

#### Release notes

This release contains minor fixes and improvements.

All customers running macOS Ventura 13.0 and above (including macOS Sequoia) are advised to upgrade to this release. This release fixes an incompatibility with the firewall that may sometimes result in the firewall becoming disabled.

Changes and improvements:

- Added target list to the warp-cli to enhance the user experience with the Access for Infrastructure SSH solution.
- Added a tunnel reset mtu subcommand to the warp-cli.
- Added the ability for warp-cli to use the team name provided in the MDM file for initial registration.
- Added a JSON output option to the warp-cli.
- Added the ability to execute a PCAP on multiple interfaces with warp-cli and warp-dex.
- Improved warp-dex default interface selection for PCAPs and changed warp-dex CLI output to JSON.
- Improved application posture check compatibility with symbolically linked files.
- Fixed an issue where the client, when switching between WireGuard and MASQUE protocols, sometimes required a manual tunnel key reset.
- Added MASQUE tunnel protocol support for the consumer version of WARP (1.1.1.1 w/ WARP).

Known issues:

- Using MASQUE as the tunnel protocol may be incompatible if your organization has Regional Services enabled.

macOS 2024.8.457.0

Version: macOS 2024.8.457.0 Date: 2024-09-26 Size: 77.8 MB Download

#### Release notes

This release contains minor fixes and improvements.

Notable updates:

- Added the ability to customize PCAP options in warp-cli.
- Added a list of installed applications in warp-diag.
- Added a summary of warp-dex traceroute results in its JSON output.
- Improved the performance of firewall operations when enforcing Split Tunnels configuration.
- Fixed an issue where the DNS logs were not being cleared when the user switched configurations.
- Fixed an issue where clients using service tokens failed to retry after a network change.
- Fixed a known issue which required users to re-register when an older single configuration MDM file was deployed after deploying the newer, multiple configuration format.
- Fixed an issue which prevented the use of private IP ranges that overlapped with end users' home networks.
- Deprecated warp-cli commands have been removed. If you have any workflows that use the deprecated commands, update to the new commands where necessary.

Known issues:

- Cloudflare is investigating temporary networking issues on macOS 15 (Sequoia) that seem to affect some users.
- Using MASQUE as the tunnel protocol may be incompatible if your organization has Regional Services enabled.

## Linux

Package repository

|  |  |
| --- | --- |
| OS version | CentOS 8, RHEL 8, Debian 10, Debian 11, Debian 12, Fedora 34, Fedora 35, Ubuntu 20.04, Ubuntu 22.04, Ubuntu 24.04 |
| Processor | AMD64 / x86-64 or ARM64 / AArch64 |
| HD space | 75 MB |
| Memory | 35 MB |
| Network interface type | WIFI or LAN |
| Minimum MTU | 1360 bytes1 |

## Footnotes

1. WireGuard requires 1360 bytes for IPv6 and 1340 bytes for IPv4. MASQUE requires 1350 bytes for IPv6 and 1330 bytes for IPv4. ‚Ü©

Latest release

Version: Linux 2025.6.1335.0 Date: 2025-08-19 Size: 50.6 MB CentOS / RHEL 8 (arm64)  CentOS / RHEL 8 (x86-64)  Debian 10 (arm64)  Debian 10 (x86-64)  Debian 11 (arm64)  Debian 11 (x86-64)  Debian 12 (arm64)  Debian 12 (x86-64)  Fedora 34 (arm64)  Fedora 34 (x86-64)  Fedora 35 (arm64)  Fedora 35 (x86-64)  Ubuntu 20.04 (arm64)  Ubuntu 20.04 (x86-64)  Ubuntu 22.04 (arm64)  Ubuntu 22.04 (x86-64)  Ubuntu 24.04 (arm64)  Ubuntu 24.04 (x86-64)  
							
Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements

- Fixed an issue preventing devices from reaching split-tunneled traffic even when WARP was disconnected.
- Fix to prevent WARP from re-enabling its firewall rules after a user-initiated disconnect.
- Improvement for faster client connectivity on high-latency captive portal networks.
- Fixed an issue where recursive CNAME records could cause intermittent WARP connectivity issues.

Known issues

- Devices using WARP client 2025.4.929.0 and up may experience Local Domain Fallback failures if a fallback server has not been configured. To configure a fallback server, refer to Route traffic to fallback server.

Previous version history (9)

Linux 2025.5.943.0

Version: Linux 2025.5.943.0 Date: 2025-07-23 Size: 44.3 MB CentOS / RHEL 8 (arm64)  CentOS / RHEL 8 (x86-64)  Debian 10 (arm64)  Debian 10 (x86-64)  Debian 11 (arm64)  Debian 11 (x86-64)  Debian 12 (arm64)  Debian 12 (x86-64)  Fedora 34 (arm64)  Fedora 34 (x86-64)  Fedora 35 (arm64)  Fedora 35 (x86-64)  Ubuntu 20.04 (arm64)  Ubuntu 20.04 (x86-64)  Ubuntu 22.04 (arm64)  Ubuntu 22.04 (x86-64)  Ubuntu 24.04 (arm64)  Ubuntu 24.04 (x86-64)  
							
Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements

- WARP proxy mode now uses the operating system's DNS settings. Changes made to system DNS settings while in proxy mode require the client to be turned off then back on to take effect.
- Fixed an issue affecting clients in Split Tunnel Include mode, where access to split-tunneled traffic was blocked after reconnecting the client.

Known issues

- Devices using WARP client 2025.4.929.0 and up may experience Local Domain Fallback failures if a fallback server has not been configured. To configure a fallback server, refer to Route traffic to fallback server.

Linux 2025.5.893.0

Version: Linux 2025.5.893.0 Date: 2025-06-30 Size: 44.8 MB CentOS / RHEL 8 (arm64)  CentOS / RHEL 8 (x86-64)  Debian 10 (arm64)  Debian 10 (x86-64)  Debian 11 (arm64)  Debian 11 (x86-64)  Debian 12 (arm64)  Debian 12 (x86-64)  Fedora 34 (arm64)  Fedora 34 (x86-64)  Fedora 35 (arm64)  Fedora 35 (x86-64)  Ubuntu 20.04 (arm64)  Ubuntu 20.04 (x86-64)  Ubuntu 22.04 (arm64)  Ubuntu 22.04 (x86-64)  Ubuntu 24.04 (arm64)  Ubuntu 24.04 (x86-64)  
							
Download

#### Release notes

This release contains improvements and new exciting features, including post-quantum cryptography. By tunneling your corporate network traffic over Cloudflare, you can now gain the immediate protection of post-quantum cryptography without needing to upgrade any of your individual corporate applications or systems.

Changes and improvements

- Fixed a device registration issue causing WARP connection failures when changing networks.
- Captive portal improvements and fixes:
Captive portal sign in notifications will now be sent through operating system notification services.
Fix for firewall configuration issue affecting clients in DoH only mode.
- Captive portal sign in notifications will now be sent through operating system notification services.
- Fix for firewall configuration issue affecting clients in DoH only mode.
- Improved the connectivity status message in the client GUI.
- The WARP client now applies post-quantum cryptography end-to-end on enabled devices accessing resources behind a Cloudflare Tunnel. This feature can be enabled by MDM.
- Improvement to handle client configuration changes made by MDM while WARP is not running.
- Fixed an issue affecting Split Tunnel Include mode, where traffic outside the tunnel was blocked when switching between Wi-Fi and Ethernet networks.
- Added a WARP client device posture check for SAN attributes to the client certificate check.

Linux 2025.4.943.0

Version: Linux 2025.4.943.0 Date: 2025-05-22 Size: 45.5 MB CentOS / RHEL 8 (arm64)  CentOS / RHEL 8 (x86-64)  Debian 10 (arm64)  Debian 10 (x86-64)  Debian 11 (arm64)  Debian 11 (x86-64)  Debian 12 (arm64)  Debian 12 (x86-64)  Fedora 34 (arm64)  Fedora 34 (x86-64)  Fedora 35 (arm64)  Fedora 35 (x86-64)  Ubuntu 20.04 (arm64)  Ubuntu 20.04 (x86-64)  Ubuntu 22.04 (arm64)  Ubuntu 22.04 (x86-64)  Ubuntu 24.04 (arm64)  Ubuntu 24.04 (x86-64)  
							
Download

#### Release notes

This release contains a hotfix for managed networks for the 2025.4.929.0 release.

Changes and improvements

- Fixed an issue where it could take up to 3 minutes for the correct device profile to be applied in some circumstances. In the worst case, it should now only take up to 40 seconds. This will be improved further in a future release.

Linux 2025.4.929.0

Version: Linux 2025.4.929.0 Date: 2025-05-12 Size: 45.5 MB CentOS / RHEL 8 (arm64)  CentOS / RHEL 8 (x86-64)  Debian 10 (arm64)  Debian 10 (x86-64)  Debian 11 (arm64)  Debian 11 (x86-64)  Debian 12 (arm64)  Debian 12 (x86-64)  Fedora 34 (arm64)  Fedora 34 (x86-64)  Fedora 35 (arm64)  Fedora 35 (x86-64)  Ubuntu 20.04 (arm64)  Ubuntu 20.04 (x86-64)  Ubuntu 22.04 (arm64)  Ubuntu 22.04 (x86-64)  Ubuntu 24.04 (arm64)  Ubuntu 24.04 (x86-64)  
							
Download

#### Release notes

This release contains two significant changes all customers should be aware of:

1. All DNS traffic now flows inside the WARP tunnel. Customers are no longer required to configure their local firewall rules to allow our DoH IP addresses and domains.
2. When using MASQUE, the connection will fall back to HTTP/2 (TCP) when we detect that HTTP/3 traffic is blocked. This allows for a much more reliable connection on some public WiFi networks.

Changes and improvements

- Fixed an issue where the managed network policies could incorrectly report network location beacons as missing.
- Improved DEX test error reporting.
- Fixed an issue causing client notifications to fail in IPv6 only environments which prevented the client from receiving configuration changes to settings like device profile.
- Added a TCP fallback for the MASQUE tunnel protocol to improve connectivity on networks that block UDP or HTTP/3 specifically.
- Added new IP addresses for tunnel connectivity checks. If your organization uses a firewall or other policies you will need to exempt these IPs.
- Fixed an issue where frequent network changes could cause WARP to become unresponsive.
- DNS over HTTPS traffic is now included in the WARP tunnel by default.
- Improvement for WARP to check if tunnel connectivity fails or times out at device wake before attempting to reconnect.
- Fixed an issue causing WARP connection disruptions after network changes.

Linux 2025.2.600.0

Version: Linux 2025.2.600.0 Date: 2025-03-31 Size: 44.5 MB CentOS / RHEL 8 (arm64)  CentOS / RHEL 8 (x86-64)  Debian 10 (arm64)  Debian 10 (x86-64)  Debian 11 (arm64)  Debian 11 (x86-64)  Debian 12 (arm64)  Debian 12 (x86-64)  Fedora 34 (arm64)  Fedora 34 (x86-64)  Fedora 35 (arm64)  Fedora 35 (x86-64)  Ubuntu 20.04 (arm64)  Ubuntu 20.04 (x86-64)  Ubuntu 22.04 (arm64)  Ubuntu 22.04 (x86-64)  Ubuntu 24.04 (arm64)  Ubuntu 24.04 (x86-64)  
							
Download

#### Release notes

This release contains support for a new WARP setting, Global WARP override. It also includes significant improvements to our captive portal / public Wi-Fi detection logic. If you have experienced captive portal issues in the past, re-test and give this version a try.

Changes and improvements

- Improved captive portal detection to make more public networks compatible and have faster detection.
- WARP tunnel protocol details can now be viewed using the warp-cli tunnel stats command.
- Fixed an issue with device revocation and re-registration when switching configurations.
- Added a new Global WARP override setting. This setting puts account administrators in control of disabling and enabling WARP across all devices registered to an account from the dashboard. Global WARP override is disabled by default.

Linux 2025.1.861.0

Version: Linux 2025.1.861.0 Date: 2025-02-19 CentOS / RHEL 8 (arm64)  CentOS / RHEL 8 (x86-64)  Debian 10 (arm64)  Debian 10 (x86-64)  Debian 11 (arm64)  Debian 11 (x86-64)  Debian 12 (arm64)  Debian 12 (x86-64)  Fedora 34 (arm64)  Fedora 34 (x86-64)  Fedora 35 (arm64)  Fedora 35 (x86-64)  Ubuntu 20.04 (arm64)  Ubuntu 20.04 (x86-64)  Ubuntu 22.04 (arm64)  Ubuntu 22.04 (x86-64)  Ubuntu 24.04 (arm64)  Ubuntu 24.04 (x86-64)  
							
Download

#### Release notes

This release includes fixes and minor improvements.

Changes and improvements

- Improved command line interface for Access for Infrastructure with added function for filtering and ordering.
- Fixed client connectivity issues when switching between managed network profiles that use different WARP protocols.
- Added support for WARP desktop to use additional DoH endpoints to help reduce NAT congestion.
- Improved Wireguard connection stability on reconnections.
- Added additional HTTP/3 QUIC connectivity test to warp-diag.
- Added support for collection of system health metrics for enhanced device Digital Experience Monitoring.
- Automated the removal of active registrations for devices with multiple registrations with the same Zero Trust organization.

Linux 2024.12.554.0

Version: Linux 2024.12.554.0 Date: 2024-12-19 Ubuntu 24.04 (x86-64)  
							
Download

#### Release notes

This release includes fixes and minor improvements.

Changes and improvements

- Consumers can now set the tunnel protocol using warp-cli tunnel protocol set <protocol>.
- Extended diagnostics collection time in warp-diag to ensure logs are captured reliably.
- Improved captive portal support by disabling the firewall during captive portal login flows.
- Improved reliability of connection establishment logic under degraded network conditions.
- Improved reconnection speed when a Cloudflare server is in a degraded state.
- Improved captive portal detection on certain public networks.
- Reduced connectivity interruptions on WireGuard Split Tunnel Include mode configurations.
- Fixed connectivity issues switching between managed network profiles with different configured protocols.
- QLogs are now disabled by default and can be enabled with warp-cli debug qlog enable. The QLog setting from previous releases will no longer be respected.

Linux 2024.11.309.0

Version: Linux 2024.11.309.0 Date: 2024-11-18 Ubuntu 24.04 (x86-64)  
							
Download

#### Release notes

This release contains reliability improvements and general bug fixes.

Changes and improvements

- Fixed an issue where SSH sessions and other connections ould drop when a device that is using MASQUE changes its primary network interface.
- Device posture client certificate checks now support PKCS#1.
- Fixed an issue to ensure the Cloudflare root certificate (or custom certificate) is installed in the trust store if not already there.
- Reduced unnecessary log messages when resolv.conf has no owner.
- Fixed an issue with warp-diag printing benign TLS certificate errors.
- Fixed an issue with the WARP client becoming unresponsive during startup.
- Extended diagnostics collection time in warp-diag to ensure logs are captured reliably.
- Fixed an issue that was preventing proper operation of DNS-over-TLS (DoT) for consumer users.

Linux 2024.9.346.0

Version: Linux 2024.9.346.0 Date: 2024-10-03 Ubuntu 24.04 (x86-64)  
							
Download

#### Release notes

This release contains minor fixes and minor improvements.

Notable updates

- Added target list to the warp-cli to enhance the user experience with the Access for Infrastructure SSH solution.
- Added the ability to customize PCAP options in the warp-cli.
- Added a list of installed applications in warp-diag.
- Added a tunnel reset mtu subcommand to the warp-cli.
- Added the ability for warp-cli to use the team name provided in the MDM file for initial registration.
- Added a JSON output option to the warp-cli.
- Added the ability to execute a PCAP on multiple interfaces with warp-cli.
- Added MASQUE tunnel protocol support for the consumer version of WARP (1.1.1.1 w/ WARP).
- Improved the performance of firewall operations when enforcing split tunnel configuration.
- Fixed an issue where device posture certificate checks were unexpectedly failing.
- Fixed an issue where the Linux GUI fails to open the browser login window when registering a new Zero Trust organization.
- Fixed an issue where clients using service tokens failed to retry after a network change.
- Fixed an issue where the client, when switching between WireGuard and MASQUE protocols, sometimes required a manual tunnel key reset.
- Fixed a known issue which required users to re-register when an older single configuration MDM file was deployed after deploying the newer, multiple configuration format.
- Deprecated warp-cli commands have been removed. If you have any workflows that use the deprecated commands, update to the new commands where necessary.

Known issues:

- Using MASQUE as the tunnel protocol may be incompatible if your organization has Regional Services is enabled.

## iOS

|  |  |
| --- | --- |
| OS version | iOS 11+ |

Download from the iOS App Store ‚Üó or search for "Cloudflare One Agent".

Migrate from 1.1.1.1

The legacy iOS client, 1.1.1.1: Faster Internet ‚Üó, has been replaced by the Cloudflare One Agent. Learn more in our migration guide.

## Android

|  |  |
| --- | --- |
| OS version | 5.0+ |

Download from the Google Play store ‚Üó or search for "Cloudflare One Agent".

Migrate from 1.1.1.1

The legacy Android client, 1.1.1.1 + WARP: Safer Internet ‚Üó, has been replaced by the Cloudflare One Agent. Learn more in our migration guide.

## ChromeOS

|  |  |
| --- | --- |
| OS version | Chromebooks manufactured after 2019 |

Chromebooks are supported by our Android app. All Chromebooks made after 2019 should fully support our Android app. If you have a Chromebook made before 2019, refer to this list ‚Üó to verify that your device is supported.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Download WARP beta releases

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/download-warp/beta-releases/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/download-warp/beta-releases/)

Page options # Download WARP beta releases

Cloudflare tests new WARP features and improvements in an unstable beta release before adding them to the stable release. Beta releases are not recommended for production environments. To get early access to new features, download the latest beta client from the links below.

## Windows

Download latest beta release

|  |  |
| --- | --- |
| OS version | Windows 10, Windows 11, Windows 365 Cloud PC running Windows 11 |
| Processor | AMD64 / x86-64 |
| .NET Framework version | 4.7.2 or later |
| HD space | 184 MB |
| Memory | 3 MB |
| Network interface type | WIFI or LAN |
| Minimum MTU | 1360 bytes1 |

## Footnotes

1. WireGuard requires 1360 bytes for IPv6 and 1340 bytes for IPv4. MASQUE requires 1350 bytes for IPv6 and 1330 bytes for IPv4. ‚Ü©

Latest release

Version: Windows 2025.6.824.1 Date: 2025-07-24 Size: 134 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements

- Improvements to better manage multi-user pre-login registrations.
- Fixed an issue preventing devices from reaching split-tunneled traffic even when WARP was disconnected.
- Fix to prevent WARP from re-enabling its firewall rules after a user-initiated disconnect.
- Improvement to managed network detection checks for faster switching between managed networks.

Known issues

- For Windows 11 24H2 users, Microsoft has confirmed a regression that may lead to performance issues like mouse lag, audio cracking, or other slowdowns. Cloudflare recommends users experiencing these issues upgrade to a minimum Windows 11 24H2 version KB5062553 or higher for resolution.
- Devices using WARP client 2025.4.929.0 and up may experience Local Domain Fallback failures if a fallback server has not been configured. To configure a fallback server, refer to Route traffic to fallback server.
- Devices with KB5055523 installed may receive a warning about Win32/ClickFix.ABA being present in the installer. To resolve this false positive, update Microsoft Security Intelligence to version 1.429.19.0 or later.
- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Previous version history (9)

Windows 2025.5.828.1

Version: Windows 2025.5.828.1 Date: 2025-06-17 Size: 129 MB Download

#### Release notes

This release contains new improvements in addition to the features and improvements introduced in Beta client version 2025.5.735.1.

Changes and improvements

- Improvement to better handle multi-user fast user switching.
- Fix for an issue causing WARP connectivity to fail without full system reboot.

Known issues

- Microsoft has confirmed a regression with Windows 11 starting around 24H2 that may cause performance issues for some users. These performance issues could manifest as mouse lag, audio cracking, or other slowdowns. A fix from Microsoft is expected in early July.
- Devices with KB5055523 installed may receive a warning about Win32/ClickFix.ABA being present in the installer. To resolve this false positive, update Microsoft Security Intelligence to version 1.429.19.0 or later.
- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.
To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.
To work around this issue, reconnect the WARP client by toggling off and back on.

Windows 2025.5.735.1

Version: Windows 2025.5.735.1 Date: 2025-06-05 Size: 129 MB Download

#### Release notes

This release contains improvements and new exciting features, including SCCM VPN boundary support and post-quantum cryptography. By tunneling your corporate network traffic over Cloudflare, you can now gain the immediate protection of post-quantum cryptography without needing to upgrade any of your individual corporate applications or systems.

Changes and improvements

- Fixed a device registration issue causing WARP connection failures when changing networks.
- Captive portal improvements including showing connectivity status in the client and sending system notifications for captive portal sign in.
- Fixed a bug where in Gateway with DoH mode, connection to DNS servers was not automatically restored after reconnecting WARP.
- The WARP client now applies post-quantum cryptography end-to-end on enabled devices accessing resources behind a Cloudflare Tunnel. This feature can be enabled by MDM.
- Improvement to gracefully handle changes made by MDM while WARP is not running.
- Improvement for multi-user mode to avoid unnecessary key rotations when transitioning from a pre-login to a logged-in state.
- Added a WARP client device posture check for SAN attributes to the client certificate check.
- Fixed an issue affecting Split Tunnel Include mode, where traffic outside the tunnel was blocked when switching between Wi-Fi and Ethernet networks.
- Added SCCM VPN boundary support to device profile settings. With SCCM VPN boundary support enabled, operating systems will register WARP's local interface IP with the on-premise DNS server when reachable.

Known issues

- Microsoft has confirmed a regression with Windows 11 starting around 24H2 that may cause performance issues for some users. These performance issues could manifest as mouse lag, audio cracking, or other slowdowns. A fix from Microsoft is expected in early July.
- Devices with KB5055523 installed may receive a warning about Win32/ClickFix.ABA being present in the installer. To resolve this false positive, update Microsoft Security Intelligence to version 1.429.19.0 or later.
- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.
To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.
To work around this issue, reconnect the WARP client by toggling off and back on.

Windows 2025.4.589.1

Version: Windows 2025.4.589.1 Date: 2025-04-22 Size: 130 MB Download

#### Release notes

Changes and improvements

- Fixed an issue causing reconnection loops when captive portals are detected.
- Fixed an issue that caused WARP client disk encryption posture checks to fail due to missing drive names.
- Fixed an issue where managed network policies could incorrectly report network location beacons as missing.
- Improved error reporting for DEX tests.
- Improved WARP client UI high contrast mode.
- Fixed an issue causing client notifications to fail in IPv6 only environments which prevented the client from receiving configuration changes to settings like device profile.
- Added a TCP fallback for the MASQUE tunnel protocol to improve compatibility with networks on MASQUE.
- Added new IP addresses for tunnel connectivity checks. If your organization uses a firewall or other policies you will need to exempt these IPs.
- DNS over HTTPS traffic is now included in the WARP tunnel by default.
- Improved the error message displayed in the client GUI when the rate limit for entering an incorrect admin override code is met.
- Added a Collect Captive Portal Diag button in the client GUI to make it easier for users to collect captive portal debugging diagnostics.
- Improved handling of non-SLAAC IPv6 interface addresses for better connectivity in IPv6 only environments.
- Fixed an issue where frequent network changes could cause WARP to become unresponsive.

Known issues

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2025.2.460.1

Version: Windows 2025.2.460.1 Date: 2025-03-13 Size: 128 MB Download

#### Release notes

This release contains significant improvements to our captive portal / public Wi-Fi detection logic. If you have experienced captive portal issues in the past, re-test and give this version a try.

Changes and improvements

- Improved captive portal detection to make more public networks compatible and have faster detection.
- Improved error messages shown in the app.
- Added the ability to control if the WARP interface IPs are registered with DNS servers or not.
- Removed DNS logs view from the Windows client GUI. DNS logs can be viewed as part of warp-diag or by viewing the log file on the user's local directory.
- Fixed issue that would result in a user receiving multiple re-authentication requests when waking their device from sleep.
- WARP tunnel protocol details can now be viewed using the warp-cli tunnel stats command.
- Improvements to Windows multi-user including support for fast user switching. If you are interested in testing this feature, reach out to your Cloudflare account team.
- Fixed issue with device revocation and re-registration when switching configurations.
- Fixed issue where DEX tests would run during certain sleep states where the networking stack was not fully up. This would result in failures that would be ignored.

Known issues

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2025.1.447.1

Version: Windows 2025.1.447.1 Date: 2025-01-28 Size: 128 MB Download

#### Release notes

This release contains only improvements.

Changes and improvements

- Improved command line interface for Access for Infrastructure with added function for filtering and ordering.
- Fixed client connectivity issues when switching between managed network profiles that use different WARP protocols.
- Added support for WARP desktop to use additional DoH endpoints to help reduce NAT congestion.
- Improved Windows multi-user feature with minor bug fixes and optimizations.
- Improved connectivity check reliability in certain split tunnel configurations.
- Improved reading of device DNS settings at connection restart.
- Improved WARP connectivity in environments with virtual machine interfaces.
- Improved Wireguard connection stability on reconnections.
- Improved reliability of device posture checks for OS Version, Unique Client ID, Domain Joined, Disk Encryption, and Firewall attributes.
- Added additional HTTP/3 QUIC connectivity test to warp-diag.

Known issues

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2024.12.326.1

Version: Windows 2024.12.326.1 Date: 2024-12-13 Size: 126 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements:

- Fixed connectivity issues switching between managed network profiles with different configured protocols.
- Added support for multiple users on shared Windows 10 and Windows 11 devices. Once a user completes the Windows login, all traffic to Cloudflare will be attributed to the currently active Windows user account. Contact your Customer Success Manager to request participation in this beta.

Known issues:

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2024.11.688.1

Version: Windows 2024.11.688.1 Date: 2024-12-06 Size: 126 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements:

- Consumers can now set the tunnel protocol using "warp-cli tunnel protocol set ".
- Extended diagnostics collection time in warp-diag to ensure logs are captured reliably.
- Improved captive portal support by disabling the firewall during captive portal login flows.
- Improved captive portal detection on certain public networks.
- Improved reconnection speed when a Cloudflare server is in a degraded state.
- Fixed an issue where WARP may fail to remove certificates from the user store in device information only mode.
- Ensured at most one powershell instance is opened when fetching the device serial number for posture checks.
- Fixed an issue to prevent the daemon from following Windows junctions created by non-admin users that could be used to delete files as SYSTEM user and potentially gain SYSTEM user privileges.
- Improved reliability of connection establishment logic under degraded network conditions.
- Fixed an issue that caused high memory usage when viewing connection statistics for extended periods of time.
- Improved WARP connectivity in environments with virtual interfaces from VirtualBox, VMware, and similar tools.
- Reduced connectivity interruptions on WireGuard include split tunnel configurations.

Known issues:

- DNS resolution may be broken when the following conditions are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, please reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2024.10.537.1

Version: Windows 2024.10.537.1 Date: 2024-11-05 Size: 124 MB Download

#### Release notes

This release contains an exciting new feature along with reliability improvements and general bug fixes. Please take time over the next few weeks to play with the new functionality and let us know what you think on both the community forum and through your account teams.

New features:

- Added the ability for administrators to initiate remote packet capture (PCAP) and warp-diag collection

Changes and improvements:

- Improved reliability of connection establishment logic under degraded network conditions
- Improved captive portal detection behavior by forcing captive portal checks outside the tunnel
- Allow the ability to configure tunnel protocol for consumer registrations
- Fixed an issue with the WARP client becoming unresponsive during startup
- Extended diagnostics collection time in warp-diag to ensure logs are captured reliably

Known issues:

- DNS resolution may be broken when the following condition are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, please reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

Windows 2024.10.279.1

Version: Windows 2024.10.279.1 Date: 2024-10-22 Size: 123 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements:

- Fixed an issue where SSH sessions and other application connections over TCP or UDP could be dropped when using MASQUE and the device's primary network interface changed.
- Fixed an issue to ensure the managed certificate is installed in the trust store if not already there.

Known issues:

- DNS resolution may be broken when the following condition are all true:

WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
A custom DNS server address is configured on the primary network adapter.
The custom DNS server address on the primary network adapter is changed while WARP is connected.

To work around this issue, please reconnect the WARP client by toggling off and back on.
- WARP is in Secure Web Gateway without DNS filtering (tunnel-only) mode.
- A custom DNS server address is configured on the primary network adapter.
- The custom DNS server address on the primary network adapter is changed while WARP is connected.

## macOS

Download latest beta release

|  |  |
| --- | --- |
| OS version | Big Sur 11.0+, Monterey 12.0+, Ventura 13.0+, Sonoma 14.0+, Sequoia 15.1+ (15.0.x is not supported) |
| Processor | Intel or M series |
| HD space | 75 MB |
| Memory | 35 MB |
| Network interface type | WIFI or LAN |
| Minimum MTU | 1360 bytes1 |

## Footnotes

1. WireGuard requires 1360 bytes for IPv6 and 1340 bytes for IPv4. MASQUE requires 1350 bytes for IPv6 and 1330 bytes for IPv4. ‚Ü©

Latest release

Version: macOS 2025.6.824.1 Date: 2025-07-24 Size: 107 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements

- Fixed an issue preventing devices from reaching split-tunneled traffic even when WARP was disconnected.
- Fix to prevent WARP from re-enabling its firewall rules after a user-initiated disconnect.
- Improvement to managed network detection checks for faster switching between managed networks.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.4 or later.
- Devices using WARP client 2025.4.929.0 and up may experience Local Domain Fallback failures if a fallback server has not been configured. To configure a fallback server, refer to Route traffic to fallback server.

Previous version history (9)

macOS 2025.5.828.1

Version: macOS 2025.5.828.1 Date: 2025-06-17 Size: 95.5 MB Download

#### Release notes

This release contains new improvements in addition to the features and improvements introduced in Beta client version 2025.5.735.1.

Changes and improvements

- Improvement for WARP connectivity issues on macOS due to the operating system not accepting DNS server configurations.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.4 or later.

macOS 2025.5.735.1

Version: macOS 2025.5.735.1 Date: 2025-06-05 Size: 95.2 MB Download

#### Release notes

This release contains improvements and new exciting features, including post-quantum cryptography. By tunneling your corporate network traffic over Cloudflare, you can now gain the immediate protection of post-quantum cryptography without needing to upgrade any of your individual corporate applications or systems.

Changes and improvements

- Fixed an issue where the Cloudflare WARP application may not have automatically relaunched after an update.
- Fixed a device registration issue causing WARP connection failures when changing networks.
- Captive portal improvements including showing connectivity status in the client and sending system notifications for captive portal sign in.
- The WARP client now applies post-quantum cryptography end-to-end on enabled devices accessing resources behind a Cloudflare Tunnel. This feature can be enabled by MDM.
- Improvement to gracefully handle changes made by MDM while WARP is not running.
- Fixed an issue affecting Split Tunnel Include mode, where traffic outside the tunnel was blocked when switching between Wi-Fi and Ethernet networks.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.4 or later.

macOS 2025.4.589.1

Version: macOS 2025.4.589.1 Date: 2025-04-22 Size: 96.4 MB Download

#### Release notes

Changes and improvements

- Fixed an issue where managed network policies could incorrectly report network location beacons as missing.
- Improved DEX test error reporting.
- Fixed an issue causing client notifications to fail in IPv6 only environments which prevented the client from receiving configuration changes to settings like device profile.
- Improved captive portal detection.
- Added a TCP fallback for the MASQUE tunnel protocol to improve compatibility with networks on MASQUE.
- Added new IP addresses for tunnel connectivity checks. If your organization uses a firewall or other policies you will need to exempt these IPs.
- DNS over HTTPS traffic is now included in the WARP tunnel by default.
- Improved the error message displayed in the client GUI when the rate limit for entering an incorrect admin override code is met.
- Added a Collect Captive Portal Diag button in the client GUI to make it easier for users to collect captive portal debugging diagnostics.
- Improved handling of non-SLAAC IPv6 interface addresses for better connectivity in IPv6 only environments.
- Fixed an issue where frequent network changes could cause WARP to become unresponsive.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.4 or later.

macOS 2025.2.460.1

Version: macOS 2025.2.460.1 Date: 2025-03-13 Size: 91.7 MB Download

#### Release notes

This release contains significant improvements to our captive portal / public Wi-Fi detection logic. If you have experienced captive portal issues in the past, re-test and give this version a try.

Changes and improvements

- Improved captive portal detection to make more public networks compatible and have faster detection.
- Improved error messages shown in the app.
- WARP tunnel protocol details can now be viewed using the warp-cli tunnel stats command.
- Fixed issue with device revocation and re-registration when switching configurations.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.3 or later.

macOS 2025.1.634.1

Version: macOS 2025.1.634.1 Date: 2025-02-07 Size: 92.4 MB Download

#### Release notes

This release contains only a hotfix from the 2025.1.447.1 release.
Note: If using macOS Sequoia, Cloudflare recommends the use of macOS 15.2 or later. With macOS 15.2, Apple addressed several issues that may have caused the WARP client to not behave as expected when used with macOS 15.0.x.
Changes and improvements - Improved device registration retrieval for graceful restarts
Known issues - macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.2 or later.

macOS 2025.1.447.1

Version: macOS 2025.1.447.1 Date: 2025-01-28 Size: 92.3 MB Download

#### Release notes

This release contains only improvements.

Note: If using macOS Sequoia, Cloudflare recommends the use of macOS 15.2 or later. With macOS 15.2, Apple addressed several issues that may have caused the WARP client to not behave as expected when used with macOS 15.0.x.

Changes and improvements

- Improved command line interface for Access for Infrastructure with added function for filtering and ordering.
- Fixed client connectivity issues when switching between managed network profiles that use different WARP protocols.
- Improved OS version posture checks on macOS for greater reliability and availability.
- Added support for WARP desktop to use additional DoH endpoints to help reduce NAT congestion.
- Improved Wireguard connection stability on reconnections.
- Added additional HTTP/3 QUIC connectivity test to warp-diag.

Known issues

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.2 or later.

macOS 2024.11.688.1

Version: macOS 2024.11.688.1 Date: 2024-12-05 Size: 85.3 MB Download

#### Release notes

This release contains minor fixes and improvements.

Note: If using macOS Sequoia, Cloudflare recommends the use of macOS 15.1 or later. With macOS 15.1, Apple addressed several issues that may have caused the WARP client to not behave as expected when used with macOS 15.0.x.

Changes and improvements:

- Consumers can now set the tunnel protocol using warp-cli tunnel protocol set <protocol>.
- Extended diagnostics collection time in warp-diag to ensure logs are captured reliably.
- Improved captive portal support by disabling the firewall during captive portal login flows.
- Improved reliability of connection establishment logic under degraded network conditions.
- Improved reconnection speed when a Cloudflare server is in a degraded state.
- Improved captive portal detection on certain public networks.
- Fixed an issue where admin override displayed an incorrect override end time.
- Reduced connectivity interruptions on WireGuard Split Tunnel Include mode configurations.

Known issues:

- macOS Sequoia: Due to changes Apple introduced in macOS 15.0.x, the WARP client may not behave as expected. Cloudflare recommends the use of macOS 15.1 or later.

macOS 2024.10.537.1

Version: macOS 2024.10.537.1 Date: 2024-11-05 Size: 82.3 MB Download

#### Release notes

This release contains an exciting new feature along with reliability improvements and general bug fixes. Please take time over the next few weeks to play with the new functionality and let us know what you think on both the community forum and through your account teams.

New features:

- Added the ability for administrators to initiate remote packet capture (PCAP) and warp-diag collection

Changes and improvements:

- Improved handling of multiple network interfaces on the system
- Improved reliability of connection establishment logic under degraded network conditions
- Improved captive portal detection behavior by forcing captive portal checks outside the tunnel
- Allow the ability to configure tunnel protocol for consumer registrations
- Fixed an issue with the WARP client becoming unresponsive during startup
- Extended diagnostics collection time in warp-diag to ensure logs are captured reliably
- Extended warp-diag to collect system profiler firewall state as part of diagnostics
- Fixed an issue with the Cloudflare WARP GUI showing garbled text in some cases
- Fixed an issue with the WARP client becoming unresponsive while handling LAN inclusion

Known issues:

- The WARP client may not function correctly on macOS 15.0 (Sequoia). We recommend updating to macOS 15.1 to resolve these issues.

macOS 2024.10.279.1

Version: macOS 2024.10.279.1 Date: 2024-10-22 Size: 80.6 MB Download

#### Release notes

This release contains minor fixes and improvements.

Changes and improvements:

- Fixed an issue where SSH sessions and other application connections over TCP or UDP could be dropped when using MASQUE and the device‚Äôs primary network interface changed.
- Fixed an issue to ensure the managed certificate is installed in the trust store if not already there.

Known issues:

- Cloudflare is investigating temporary networking issues caused by  macOS 15 (Sequoia) changes that seem to affect some users and may be seen with any version of the WARP client.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Update WARP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/download-warp/update-warp/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/download-warp/update-warp/)

Page options # Update WARP

This guide covers best practices for updating the WARP client.

## When to update WARP

Cloudflare recommends keeping your WARP deployment as up-to-date as possible. If you run into issues that require troubleshooting or support tickets, one of the first requested actions by our support team will be to update your clients to the latest version.

We also recognize that there is a cost associated for a business to go through an update cycle, potentially related to change management, QA version testing, and other critical activities for software updates. For customers with limited software update cycles, we recommend updating the client on a quarterly basis if possible. This will address ongoing bug fixes, performance improvements, and new feature development at a reasonable cadence. If quarterly updates are not possible, we recommend a minimum of twice a year update cycles.

### Release schedule

Cloudflare does not operate on a major-release upgrade cycle; all releases for the WARP client are incremental. With this in mind, you should choose which releases make the most sense for your business.

Cloudflare publishes release notes for WARP on the Downloads page and in the WARP changelog. You can look at the release notes to determine whether there is an explicit reason for updating to the latest release.

### Support lifecycle

Cloudflare supports WARP client versions for at least one year from release. After one year, WARP clients could potentially be unable to connect. Cloudflare will make every effort to communicate in advance through emails and in dash notifications if such a breaking change will occur.

## How to update WARP

### Windows, macOS, and Linux

#### Managed devices

JAMF, Intune, and other MDM tools perform software updates by installing a new binary file. If you deployed WARP using a device management tool, the update procedure will look exactly the same as your initial installation. To update WARP, simply push the latest binary file with the same deployment parameters. End users will not be signed out of their client, and they will not have to manually engage with the update.

#### Unmanaged devices

If your users have local administration rights on their device, you can allow them to update WARP on their own via the WARP GUI. Allow updates is usually disabled on managed devices, as it can introduce version consistency control issues if WARP versions are centrally managed by IT.

### iOS, Android, and ChromeOS

The iOS App Store and Google Play store can automatically push automatic updates to devices which have auto update enabled. We recommend using this method to keep the Cloudflare One Agent up-to-date on your mobile devices (managed or unmanaged).

## Test before updates

Most issues that occur after an update are due to compatibility issues between WARP and third party security software. Before rolling out an update to your organization, be sure to test the new WARP release alongside your other software.

To deploy an update incrementally:

1. Install the latest version of WARP on a single device.
2. Verify connectivity in your Gateway logs, and verify that your third party software still works as expected.
3. Deploy the update to a few more devices that represent a broad set of configurations within your organization. For example, you could include devices from a variety of departments such as Engineering, Human Resources, and IT.
4. Verify connectivity for these devices.
5. Once everything is working, deploy the update to the rest of your organization.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Migrate 1.1.1.1 app

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/download-warp/cloudflare-one-agent-migration/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/download-warp/cloudflare-one-agent-migration/)

Page options # Migrate 1.1.1.1 app

Users can connect to Cloudflare Zero Trust services through an agent that runs on their device. Cloudflare previously bundled that functionality into the WARP client, an application that also provides privacy-focused DNS and VPN services for consumers (known as 1.1.1.1 w/ WARP). Supporting both enterprise and consumer functionality in the same application allowed us to build Zero Trust upon the same foundation used by millions of consumers across the globe, but has limited the pace at which changes could be released. As a result, we are launching a dedicated Cloudflare One Agent that replaces the WARP client for Zero Trust deployments.

The Cloudflare One Agent supports all existing Zero Trust functionality. The underlying connection technology remains the same, and improvements made to performance and reliability based on feedback from 1.1.1.1 w/ WARP users will continue to be built into the Cloudflare One Agent.

## macOS, Windows, and Linux

No action is required for desktop clients at this time. The existing Cloudflare WARP client will continue to support both Zero Trust and 1.1.1.1 functionality.

## iOS and Android

Zero Trust users must migrate from the 1.1.1.1 app to the Cloudflare One Agent app. Cloudflare is no longer supporting customers using the 1.1.1.1 app for Zero Trust features.

Organizations can migrate their teams with minimal disruption in one of two modes: manually or via a managed endpoint solution.

### Migrate manual deployments

If you downloaded and installed the 1.1.1.1 app manually, here are the recommended migration steps:

- android
- ios

1. Update the 1.1.1.1 app to version 6.29 or above. The update ensures that 1.1.1.1 can co-exist with the new Cloudflare One Agent app.
2. If you have enabled TLS decryption, ensure that you have a Do Not Inspect policy in place for the following applications:

Google Services (Do Not Inspect)
Google Play Store (Do Not Inspect)
Google (Do Not Inspect)
Google Drive (Do Not Inspect)
Google Chat (Do Not Inspect)
Google Meet (Do Not Inspect)

This prevents certificate pinning issues when performing the Android migration.
3. Google Services (Do Not Inspect)
4. Google Play Store (Do Not Inspect)
5. Google (Do Not Inspect)
6. Google Drive (Do Not Inspect)
7. Google Chat (Do Not Inspect)
8. Google Meet (Do Not Inspect)
9. Follow these instructions to install and enroll the Cloudflare One Agent.

1. Update the 1.1.1.1 app to version 6.22 or above. The update ensures that 1.1.1.1 can co-exist with the new Cloudflare One Agent app.
2. Download the Cloudflare One Agent app.
3. Launch the Cloudflare One Agent app. All settings from 1.1.1.1 will automatically migrate over to the Cloudflare One Agent. The user does not need to reauthenticate.

If you enrolled the Cloudflare One Agent in the same Zero Trust organization as 1.1.1.1, you will be automatically logged out of Zero Trust on 1.1.1.1. The 1.1.1.1 app will revert to consumer mode, and the Login with Cloudflare Zero Trust  button on the old app will redirect to the new app.

If you enrolled the Cloudflare One Agent in a different Zero Trust organization, you will remain logged into your other Zero Trust organization on 1.1.1.1.

#### What to do with the old app

While both 1.1.1.1 and Cloudflare One Agent can exist on the device, iOS and Android will only allow one of these applications to connect at a time.

To access your company's resources, you must use the Cloudflare One Agent app.

You can use the 1.1.1.1 app for personal browsing. When connected to 1.1.1.1 w/ WARP, your traffic will be encrypted and privately routed via Cloudflare's network, and your employer will not be able to see any of your browsing activity. To learn more about consumer WARP services, refer to WARP client.

If you do not wish to use the old 1.1.1.1 app for personal browsing, you may uninstall it.

### Migrate managed deployments

If you deployed the 1.1.1.1 app with an MDM provider, perform the migration as follows:

- android
- ios

1. Using your MDM tool, update the 1.1.1.1 app to version 6.29 or above. The update ensures that 1.1.1.1 can co-exist with the new Cloudflare One Agent app during the migration.
2. Add the Cloudflare One Agent app from the Google Play store. Its application ID is com.cloudflare.cloudflareoneagent.
3. Copy your MDM deployment parameters for the 1.1.1.1 app.
4. Paste the MDM deployment parameters into the Cloudflare One Agent app configuration. Make sure that you do not accidentally overwrite the application ID (com.cloudflare.cloudflareoneagent).
5. Using your MDM tool, install the Cloudflare One Agent on your devices.
6. On Android, the user will need to re-authenticate to the new application, following the same onboarding steps they went through initially.

1. Using your MDM tool, update the 1.1.1.1 app to version 6.22 or above. The update ensures that 1.1.1.1 can co-exist with the new Cloudflare One Agent app during the migration.
2. Add the Cloudflare One Agent app from the App store. Its application ID is com.cloudflare.cloudflareoneagent.
3. Copy your MDM deployment parameters for the 1.1.1.1 app.
4. Paste the MDM deployment parameters into the Cloudflare One Agent app configuration. Make sure that you do not accidentally overwrite the application ID (com.cloudflare.cloudflareoneagent).
5. Using your MDM tool, install the Cloudflare One Agent on your devices.

On iOS, the user does not need to re-authenticate ‚Äî registration data from the 1.1.1.1 app is automatically migrated to the new Cloudflare One Agent app.

Once users have enrolled, the migration process is complete. The 1.1.1.1 app will revert to consumer mode and ignore the existing MDM configuration profile. If you do not wish to keep the 1.1.1.1 app, you may uninstall it and delete its MDM configuration.

### Verify migration

To check whether a user has migrated, go to My Team > Devices. A device enrolled through the Cloudflare One Agent will appear as a new device with a new device ID. Their old 1.1.1.1 registration will remain as an inactive device.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## First-time setup

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/set-up-warp/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/set-up-warp/)

Page options # First-time setup

This is a high-level, step-by-step walkthrough on how to get started with WARP in your organization. From downloading the client to sending the first queries to Cloudflare's edge, here is a guide on how to do it for the first time.

## Gateway with WARP (default)

This mode enables our complete suite of device security features.

### 1. Create a Cloudflare Zero Trust account.

The Cloudflare Zero Trust home ‚Üó will be your go-to place to check device connectivity data, as well as create Secure Web Gateway and Zero Trust policies for your organization.

As you complete the Cloudflare Zero Trust onboarding, you will be asked to create a team name for your organization. You will need the team name when you deploy the WARP client on your devices; it will allow your users to connect to your organization's Cloudflare Zero Trust instance.

### 2. Set up a login method.

Configure One-time PIN or connect a third-party identity provider in Zero Trust. This is the login method your users will utilize when authenticating to add a new device to your Cloudflare Zero Trust setup.

### 3. Next, define device enrollment permissions.

Create device enrollment rules to define which users in your organization should be able to connect devices to your organization's Cloudflare Zero Trust setup. As you create your rule, you will be asked to select which login method you would like users to authenticate with.

### 4. Install the Cloudflare root certificate on your devices.

Advanced security features including HTTP traffic inspection require users to install and trust the Cloudflare root certificate on their machine or device. If you are installing certificates manually on all your devices, these steps will need to be performed on each new device that is to be subject to HTTP filtering.

### 5. Download and deploy the WARP client to your devices.

Choose one of the different ways to deploy the WARP client, depending on what works best for your organization.

### 6. Log in to your organization's Cloudflare Zero Trust instance from your devices.

Once the WARP client is installed on the device, log in to your Zero Trust organization. If you have already set up an identity provider in Cloudflare Access, the user will be prompted to authenticate using this method. If you have not set up an identity provider, the user can authenticate with a one-time pin which is enabled by default.

Next, build Secure Web Gateway policies to filter DNS, HTTP, and Network traffic on your devices.

## Gateway with DoH

This mode is best suited for organizations that only want to apply DNS filtering to outbound traffic from their company devices. It does not enable advanced HTTP filtering features such as HTTP policies, identity-based policies, device posture checks, or Browser Isolation.

### 1. Create a Cloudflare Zero Trust account.

Zero Trust will be your go-to place to check device connectivity data, as well as create Secure Web Gateway and Zero Trust policies for your organization.

As you complete the Cloudflare Zero Trust onboarding, you will be asked to create a team name for your organization. You will need the team name when you deploy the WARP client on your devices; it will allow your users to connect to your organization's Cloudflare Zero Trust instance.

### 2. Set up a login method.

Configure One-time PIN or connect a third-party identity provider in Zero Trust. This is the login method your users will utilize when authenticating to add a new device to your Cloudflare Zero Trust setup.

### 3. Next, define device enrollment permissions.

Create device enrollment rules to define which users in your organization should be able to connect devices to your organization's Cloudflare Zero Trust setup. As you create your rule, you will be asked to select which login method you would like users to authenticate with.

### 4. (optional) Add a DNS location to Gateway.

The WARP client will direct DoH queries to a default DNS endpoint when enrolled to your Zero Trust organization. If you need to direct these queries to a separate DNS endpoint, add a DNS location to Gateway. Gateway will assign a DoH subdomain to that location, which you can add when deploying the WARP client to your devices.

### 5. Download and deploy the WARP client to your devices.

Choose one of the different ways to deploy the WARP client, depending on what works best for your organization.

Next, create DNS policies to control how DNS queries from your devices get resolved.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Deploy WARP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/)

Page options # Deploy WARP

Depending on how your organization is structured, you can deploy WARP in one of two ways:

- Manual deployment ‚Äî If you are a small organization, asking your users to download the client themselves and type in the required settings is the ideal way to get started with WARP.
- Managed deployment ‚Äî Bigger organizations with MDM tools like Intune or JAMF can deploy WARP to their entire fleet of devices from a single operation.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Managed deployment

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/)

Page options # Managed deployment

Organizations can deploy WARP automatically to their fleet of devices in a single operation. The WARP client is compatible with the vast majority of managed deployment workflows, including mobility management solutions such as Intune or JAMF, or by executing an .msi file on desktop machines.

This page provides generic instructions for an automated deployment. If you want to deploy the WARP client manually, refer to the instructions for manual deployment.

Warning

MDM parameters that you specify in a local policy file will overrule any WARP settings configured in the dashboard.

## Prerequisites

- Refer to the Download page to review system requirements and download the installer for your operating system.
- After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

## Windows

The WARP client for Windows allows for an automated install via tools like Intune, AD, or any script or management tool that can execute a .msi file.

### Install WARP

To install the WARP client, run the following command:

Terminal window ```
msiexec /i "Cloudflare_WARP_<VERSION>.msi" /qn ORGANIZATION="your-team-name" SUPPORT_URL="http://support.example.com"
```

#### Supported properties

The WARP MSI installer supports the following public properties ‚Üó:

- ORGANIZATION
- GATEWAY_UNIQUE_ID
- AUTH_CLIENT_ID
- AUTH_CLIENT_SECRET
- ONBOARDING
- OVERRIDE_API_ENDPOINT
- OVERRIDE_DOH_ENDPOINT
- OVERRIDE_WARP_ENDPOINT
- SERVICE_MODE
- SUPPORT_URL
- SWITCH_LOCKED

Refer to deployment parameters for a description of each property.

### Uninstall WARP

To uninstall the WARP client:

1. First, locate the .msi package with the following PowerShell command:

PowerShell ```
Get-WmiObject Win32_Product | Where-Object { $_.Name -match "WARP" } | Sort-Object -Property Name | Format-Table IdentifyingNumber, Name, LocalPackage -AutoSize
```

```
IdentifyingNumber                      Name            LocalPackage-----------------                      ----            ------------{5RA4DJWK-13D8-2NSX-QRF8-UANLODWD6D90} Cloudflare WARP C:\WINDOWS\Installer\3f476db.msi
```

1. You can then use the LocalPackage output in the uninstall command. For example,

PowerShell ```
msiexec /x C:\WINDOWS\Installer\<WARP_RELEASE>.msi /quiet
```

### Update MDM parameters

The on-disk configuration of the Windows client can be changed at any time by modifying or replacing the contents of C:\ProgramData\Cloudflare\mdm.xml. The format of this file is as follows:

```
<dict>  <key>organization</key>  <string>your-team-name</string>  <key>onboarding</key>  <false/></dict>
```

Changes to this file are processed immediately by the WARP client.

### Authenticate in embedded browser

By default WARP will use the user's default browser to perform registration. You can override the default setting to instead authenticate users in an embedded browser. The embedded browser will work around any protocol handler issues that may prevent the default browser from launching.

To use an embedded browser:

1. Download and install WebView2 by following the Microsoft instructions ‚Üó.
2. Add a registry key with the following command:
REG ADD HKLM\SOFTWARE\Cloudflare\CloudflareWARP /f /v UseWebView2 /t REG_SZ /d y

The WARP client will now launch WebView2 when the user is registering their device with Zero Trust.

## macOS

The WARP client for macOS allows for an automated install via tools like Jamf, Intune, Kandji, or JumpCloud or any script or management tool that can place a com.cloudflare.warp.plist file in /Library/Managed Preferences. The plist can also be wrapped in a .mobileconfig.

If you do not wish to use a management tool, you can manually place an mdm.xml file in /Library/Application Support/Cloudflare.

### Prepare file for MDM deployment

#### plist file

1. Download an example com.cloudflare.warp.plist file.
2. Modify the file with your desired deployment parameters.

#### mobileconfig file

1. Download an example .mobileconfig file.
2. Run uuidgen from your macOS Terminal. This will generate a value for PayloadUUID, which you can use to replace the default value used for PayloadUUID.
3. Modify the file with your desired deployment parameters.

### Place an unmanaged mdm.xml file

You can configure WARP deployment parameters on macOS by manually placing an mdm.xml file in /Library/Application Support/Cloudflare. This deployment method is an alternative to pushing a plist or mobileconfig using an MDM tool.

The format of /Library/Application Support/Cloudflare/mdm.xml is as follows:

```
<dict>  <key>organization</key>  <string>your-team-name</string></dict>
```

## Linux

The WARP client for Linux allows for an automated install via the presence of an mdm.xml file in /var/lib/cloudflare-warp.

The format of /var/lib/cloudflare-warp/mdm.xml is as follows:

```
<dict>  <key>organization</key>  <string>your-team-name</string></dict>
```

Refer to deployment parameters for a list of accepted arguments.

## iOS

Migrate from 1.1.1.1

The legacy iOS client, 1.1.1.1: Faster Internet ‚Üó, has been replaced by the Cloudflare One Agent. Learn more in our migration guide.

The Cloudflare WARP iOS client, known in the App Store as Cloudflare One Agent ‚Üó, allows for an automated install via tools like Jamf, Intune, or SimpleMDM.

To proceed with the installation, here is an example of the XML code you will need:

```
<dict>    <key>organization</key>    <string>your-team-name</string>    <key>auto_connect</key>    <integer>1</integer>    <key>switch_locked</key>    <false />    <key>service_mode</key>    <string>warp</string>    <key>support_url</key>    <string>https://support.example.com</string></dict>
```

Refer to deployment parameters for a description of each argument.

## Android / ChromeOS

Migrate from 1.1.1.1

The legacy Android client, 1.1.1.1 + WARP: Safer Internet ‚Üó, has been replaced by the Cloudflare One Agent. Learn more in our migration guide.

The Cloudflare WARP Android client, known in the Google Play store as Cloudflare One Agent ‚Üó, allows for an automated install via tools like Intune, Google Endpoint Manager, and others.

To proceed with the installation, here is an example of the XML code you will need:

```
<key>organization</key><string>your-team-name</string><key>switch_locked</key><true /><key>auto_connect</key><integer>0</integer><key>gateway_unique_id</key><string>your_gateway_doh_subdomain</string><key>service_mode</key><string>warp</string><key>support_url</key><string>https://support.example.com</string>
```

If your MDM tool does not support XML, you may need to convert the XML to JSON. Here is an example below:

```
{  "organization": "your-team-name",  "gateway_unique_id": "your_gateway_doh_subdomain",  "onboarding": true,  "switch_locked": true,  "auto_connect": 0,  "service_mode": "warp",  "support_url": "https://support.example.com"}
```

Refer to deployment parameters for a description of each value.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Partners

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/)

Page options # Partners

Cloudflare Zero Trust integrates with Cloudflare Technology Partner ‚Üó tools to help you deploy the WARP client to bigger fleets of devices. Thanks to these collaborations, you can distribute the WARP client application to end-user devices and remotely set up advanced configurations in real time.

This is a list of Technology Partners Cloudflare Zero Trust works with:

- Fleet
- Hexnode
- Intune
- Jamf
- JumpCloud
- Kandji

If you do not see your management software listed above, we can almost certainly still work with it. Refer to our instructions for managed deployments to understand what configuration files are required.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Fleet

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/fleet/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/fleet/)

Page options # Fleet

This guide covers how to deploy the Cloudflare WARP client using Fleet ‚Üó device management software.

## macOS

### 1. Create a custom MDM file

1. Download an example .mobileconfig file.
2. Modify the file with your desired deployment parameters.

### 2. Upload MDM file to Fleet

1. In the Fleet admin console, go to Controls.
2. From the Teams dropdown, select the team (group of hosts) that requires Cloudflare WARP.
3. Select OS settings > Custom settings.
4. Select Add profile and upload the custom .mobileconfig.
5. Select the hosts which require Cloudflare WARP:

All hosts: Deploys WARP to all hosts in the team.
Custom: Deploys WARP to a subset of the hosts in the team. Use labels ‚Üó to define the hosts that should be included or excluded.
6. All hosts: Deploys WARP to all hosts in the team.
7. Custom: Deploys WARP to a subset of the hosts in the team. Use labels ‚Üó to define the hosts that should be included or excluded.
8. Select Add profile.

The defined hosts will immediately receive the deployment profile, but WARP is not yet installed.

### 3. Download WARP package for macOS

Visit the Download page to review system requirements and download the installer for your operating system.

### 4. Upload WARP package to Fleet

To add the WARP client installer package for distribution to your hosts enrolled in Fleet:

1. In the Fleet admin console, go to Software.
2. From the Teams dropdown, select the team (group of hosts) that requires Cloudflare WARP.
3. Select Add Software and upload the .pkg file that was previously downloaded.

### 5. Install WARP with Fleet

To deploy the uploaded .pkg file to your hosts:

1. In the Fleet admin console, go to Hosts.
2. Select the host that requires the WARP client.
3. Go to Software and search for Cloudflare.
4. Select Actions > Install.

Installation will happen automatically when the host comes online. To deploy with REST API or GitOps, refer to the Fleet documentation ‚Üó.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

### 6. Uninstall WARP with Fleet

To uninstall the Fleet-deployed WARP client:

1. In the Fleet admin console, go to Hosts.
2. Select the host that requires the WARP client to be uninstalled.
3. Go to Software and search for Cloudflare.
4. Select Actions > Uninstall.

## Windows

### 1. Download WARP package for Windows

Visit the Download page to review system requirements and download the installer for your operating system.

### 2. Upload WARP package to Fleet

To add the WARP client installer package for distribution to your hosts enrolled in Fleet:

1. In the Fleet admin console, go to Software.
2. From the Teams dropdown, select the team (group of hosts) that requires Cloudflare WARP.
3. Select Add Software and upload the .msi file that was previously downloaded.
4. (Optional) To allow users to install WARP from Fleet Desktop, select Self-service.
5. Select Advanced options.
6. In Install script, replace the default script with the following:

Terminal window ```
$logFile = "${env:TEMP}/fleet-install-software.log"
try {
$installProcess = Start-Process msiexec.exe `  -ArgumentList "/quiet /norestart ORGANIZATION=your-team-name SUPPORT_URL=https://example.com /lv ${logFile} /i `"${env:INSTALLER_PATH}`"" `  -PassThru -Verb RunAs -Wait
Get-Content $logFile -Tail 500
Exit $installProcess.ExitCode
} catch {  Write-Host "Error: $_"  Exit 1}
```

Refer to deployment parameters for a description of each argument.

### 3. Install WARP with Fleet

To deploy the uploaded .pkg file to your hosts:

1. In the Fleet admin console, go to Hosts.
2. Select the host that requires the WARP client.
3. Go to Software and search for Cloudflare.
4. Select Actions > Install.

Installation will happen automatically when the host comes online. To deploy with REST API or GitOps, refer to the Fleet documentation ‚Üó.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

### 4. Uninstall WARP with Fleet

To uninstall the Fleet-deployed WARP client:

1. In the Fleet admin console, go to Hosts.
2. Select the host that requires the WARP client to be uninstalled.
3. Go to Software and search for Cloudflare.
4. Select Actions > Uninstall.

## Linux

Fleet allows you to execute custom scripts ‚Üó on Linux hosts. The following example script creates an MDM file and installs WARP on an Ubuntu 22.04 host:

```
#!/bin/sh
# Write the mdm.xml filetouch /var/lib/cloudflare-warp/mdm.xmlecho -e "<dict>\n   <key>organization</key>\n   <string>your-team-name</string>\n</dict>" > /var/lib/cloudflare-warp/mdm.xml
# Add cloudflare gpg keycurl -fsSL https://pkg.cloudflareclient.com/pubkey.gpg | sudo gpg --yes --dearmor --output /usr/share/keyrings/cloudflare-warp-archive-keyring.gpg
# Add this repo to your apt repositoriesecho "deb [signed-by=/usr/share/keyrings/cloudflare-warp-archive-keyring.gpg] https://pkg.cloudflareclient.com/ any main" | sudo tee /etc/apt/sources.list.d/cloudflare-client.list
# Installsudo apt-get -y update && sudo apt-get -y install cloudflare-warp
```

To install WARP on other Linux distributions, refer to the package repository ‚Üó.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Hexnode

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/hexnode/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/hexnode/)

Page options # Hexnode

## Windows

1. Create a script file with .bat, .cmd, and .ps1 file formats to download, install and configure the Cloudflare WARP client Windows application on the device. Listed below is a sample script with all of the configurable parameters:
<# Choose file name for downloading application #>$filename = filename.msi'
<# Download URL of the installer. #>$url = 'https://downloads.cloudflareclient.com/v1/download/windows/ga'Write-Host 'Downloading App from' $urlInvoke-WebRequest -Uri $url -OutFile $filename
<# Run the installer and wait for the installation to finish #>$arguments = "ORGANIZATION="exampleorg" SERVICE_MODE="warp" GATEWAY_UNIQUE_ID="fmxk762nrj" SUPPORT_URL="http://support.example.com""
$installProcess = (Start-Process $filename -ArgumentList $arguments -PassThru -Wait)
<# Check if installation was successful #>if ($installProcess.ExitCode -ne 0) {    Write-Host "Installation failed!"    exit $installProcess.ExitCode}else {    Write-Host "Installation completed successfully!"}
2. Push the script file to the devices using Hexnode.
3. On your Hexnode console, go to Manage > Devices.
4. Select your device name. This will take you to the Device Summary.
5. Select Actions > Execute Custom Script.
6. Choose the script file source as Upload file, then upload the script file.
7. Select Execute.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

## macOS

1. Download the Cloudflare WARP client for macOS.
2. On your Hexnode console, go to Apps > Add Apps > Enterprise App.
3. Select macOS as the app platform.
4. Add an app name, category and description.
5. Upload the Cloudflare_WARP_<VERSION>.pkg file and select Add.
6. Set up an XML file with the supported app configurations for the app.
Here is a sample XML file with the accepted parameters.
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"><plist version="1.0"><dict><key>organization</key><string>organizationname</string><key>auto_connect</key><integer>1</integer><key>switch_locked</key><false /><key>service_mode</key><string>warp</string><key>support_url</key><string>https://support.example.com</string></dict></plist>
7. On your Hexnode console, go to Policies.
8. Create a new policy and provide a policy name.
9. Go to macOS > App Management > Mandatory Apps and start setting up the policy.
10. Select Add and select the previously uploaded WARP client app.
11. Go to App Configurations > Add new configuration.
12. Select the WARP client app and upload the XML file from Step 6.
13. Now go to Policy Targets and associate the policy with the target entities.

This will push the app along with the configurations to the selected devices.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

## iOS

1. On your Hexnode console, go to Apps > Add Apps > Store App.
2. Select iOS as the app platform.
3. Search for Cloudflare One Agent ‚Üó and Add the app.
4. Set up an XML file with the supported app configurations for the app. Refer this sample XML code to identify the supported arguments:
<dict><key>organization</key><string>yourorganization</string><key>auto_connect</key><integer>1</integer><key>switch_locked</key><false /><key>service_mode</key><string>warp</string><key>support_url</key<string>https://support.example.com</string></dict>
5. Upload the app configurations in Hexnode:

On your Hexnode console, go to the Apps tab.
Find the Cloudflare One Agent app and select its name.
Select the settings icon and choose App Configuration.
Upload the XML file in the corresponding field.
Select Save.
6. On your Hexnode console, go to the Apps tab.
7. Find the Cloudflare One Agent app and select its name.
8. Select the settings icon and choose App Configuration.
9. Upload the XML file in the corresponding field.
10. Select Save.
11. Push the app to the target devices using Hexnode.

On your Hexnode console, go to Policies and create a new policy.
Provide a name for the policy and go to iOS.
Go to Mandatory Apps > Configure.
Select Add > Add app, check the required app, and select Done.
Go to Policy Targets and associate the policy with the required target devices.
12. On your Hexnode console, go to Policies and create a new policy.
13. Provide a name for the policy and go to iOS.
14. Go to Mandatory Apps > Configure.
15. Select Add > Add app, check the required app, and select Done.
16. Go to Policy Targets and associate the policy with the required target devices.

This will push the app along with the configurations to the selected devices.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

## Android

1. On your Hexnode console, go to Apps > Add Apps > Managed Google Apps.
2. Search for the app Cloudflare One Agent ‚Üó.
3. Approve the app as a Managed Google Play app.
4. Go to Policies and create a new policy.
5. Go to Android > App Configurations > Add new configuration.
6. Find the Cloudflare One Agent app and set up your custom configurations.
7. Go to Policy Targets and associate the policy with the required target devices.
8. Save the policy.

This will push the app along with the configurations to the selected devices.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Intune

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/intune/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/intune/)

Page options # Intune

This guide covers how to deploy the Cloudflare WARP client using Microsoft Intune.

## Windows

### Deploy the WARP client

To deploy WARP on Windows using Intune:

1. Download the Cloudflare_WARP_<VERSION>.msi installer.
2. Log in to your Microsoft Intune account.
3. Go to Apps > All Apps > Add.
4. In App type, select Line-of-business app from the drop-down menu. Select Select.
5. Select Select app package file and upload the Cloudflare_WARP_<VERSION>.msi installer you downloaded previously.
6. Select OK.
7. In the Name field, we recommend entering the version number of the package being uploaded.
8. In the Publisher field, we recommend entering Cloudflare, Inc.
9. In the Command-line arguments field, enter a valid installation command.
For example:
/qn ORGANIZATION="your-team-name" SUPPORT_URL="http://support.example.com"
Refer to deployment parameters for a description of each argument. You can change these parameters at any time by pushing a new MDM file.
10. Select Next.
11. Add the users or groups who require Cloudflare WARP and select Next.
12. Review your configuration and select Create.

Intune is now configured to deploy the WARP client.

### Update MDM parameters

You can use Intune to update MDM parameters for the WARP client. On Windows, these parameters are stored on the local device in C:\ProgramData\Cloudflare\mdm.xml.

To push a new mdm.xml file using Intune:

1. Log in to your Microsoft Intune account.
2. Go to Devices > Scripts and remediations.
3. Select the Platform scripts tab and select Add.
4. Select Windows 10 and later.
5. Enter a name for the script (for example, Deploy Cloudflare mdm.xml).
6. In PowerShell script, upload the following .ps1 file. Be sure to modify the XML content with your desired parameters.
mdm-template.ps1# Define the path to the file$filePath = "C:\ProgramData\Cloudflare\mdm.xml"
# Create the XML content as a string$xmlContent = @"<dict>  <key>multi_user</key>  <true/>  <key>pre_login</key>  <dict>    <key>organization</key>    <string>mycompany</string>    <key>auth_client_id</key>    <string>88bf3b6d86161464f6509f7219099e57.access</string>    <key>auth_client_secret</key>    <string>bdd31cbc4dec990953e39163fbbb194c93313ca9f0a6e420346af9d326b1d2a5</string>  </dict>  <key>configs</key>  <array>    <dict>      <key>organization</key>      <string>mycompany</string>      <key>display_name</key>      <string>Production environment</string>    </dict>    <dict>      <key>organization</key>      <string>test-org</string>      <key>display_name</key>      <string>Test environment</string>    </dict>  </array></dict>"@
# Ensure the directory exists$directory = Split-Path $filePath -parentif (-not (Test-Path $directory)) {  New-Item -ItemType Directory -Path $directory | Out-Null}
# Write the XML content to the filetry {  $xmlContent | Out-File -Encoding UTF8 -FilePath $filePath  Write-Host "mdm.xml file created successfully at: $filePath"}catch {  Write-Error "Failed to create mdm.xml file: $_"}
7. In Assignments, select the Windows devices that should receive the new mdm.xml file.
8. To deploy the script, select Add.

Intune will now execute the Powershell script on the target devices and overwrite the previous mdm.xml file. Once the new mdm.xml file is created, WARP will immediately start using the new configuration.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

If you prefer to use Intune's Win32 App tool to run the Powershell script, refer to the Intune documentation ‚Üó.

## macOS

Refer to the generic instructions for macOS.

## iOS

Refer to the generic instructions for iOS.

Intune allows you to insert predefined variables ‚Üó into the XML configuration file. For example, you can set the unique_client_id key to {{deviceid}} for a device UUID posture check deployment.

### Per-app VPN for iOS

Note

Per-app VPN is supported on Cloudflare One Agent version 1.8 or greater for iOS.

Before proceeding with per-app VPN configuration, you must make sure Auto connect is disabled in Zero Trust. To disable Auto connect:

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Under Device Settings, select your device profile and select Edit.
3. Turn off Auto Connect.

To configure per-app VPN:

1. Log in to Microsoft Intune admin center for your organization.
2. Go to Devices > iOS/iPadOS Devices > Manage Devices > Configuration > select + Create > New Policy.
3. Select Templates in the Profile Type dropdown menu, then select VPN as the Template Name and select Create.
4. Give the configuration a name, and an optional description, if you desire, then select Next.
5. Select Custom VPN from the Connection Type dropdown menu.
6. Expand the Base VPN section.

Give the VPN connection a name.
Enter "1.1.1.1" as the VPN server address (this value is not actually used.)
Set Username and password as the Authentication method.
Enter "com.cloudflare.cloudflareoneagent" as the VPN identifier.
Enter any Key and Value into the custom VPN attributes (Cloudflare One does not use these but Intunes requires at least one entry.)
7. Give the VPN connection a name.
8. Enter "1.1.1.1" as the VPN server address (this value is not actually used.)
9. Set Username and password as the Authentication method.
10. Enter "com.cloudflare.cloudflareoneagent" as the VPN identifier.
11. Enter any Key and Value into the custom VPN attributes (Cloudflare One does not use these but Intunes requires at least one entry.)
12. Expand the Automatic VPN section.

Select Per-app VPN as the Type of automatic VPN.
Select packet-tunnel as the Provider Type. Select Next.
13. Select Per-app VPN as the Type of automatic VPN.
14. Select packet-tunnel as the Provider Type. Select Next.
15. Add any Groups, Users, or Devices to which you want to distribute this configuration and select Next.
16. Review the settings and select Create.
17. Go to Apps > iOS/iPadOS Apps and select + Add.
18. Select iOS store app from the App Type dropdown > Select.
19. Select Search the App Store, then search for the app whose traffic you want to go through the VPN > select the desired app > Select.
20. Review the selected app settings and select Next.
21. Select + Add Group to add the group of users to which to distribute this app. Then select None underneath VPN.
22. Select the configuration you just created from the VPN dropdown menu and select OK.
23. Select Next, review the settings, then select Create.
24. Repeat steps 10-16 for each app you want to use the VPN with.

Note

To support re-authentication, you must include a third-party browser that Cloudflare One can use to re-authenticate the user. The following third-party browsers are supported:

- Google Chrome
- Firefox
- Firefox Focus
- Microsoft Edge
- Brave
- Opera

Cloudflare One will continue to use a Safari window for initial authentication per-security best practices.

Note

Cloudflare One cannot apply split tunnel setting for a per app VPN. Included or excluded domains can be added to the Configuration Profile under Associated Domains and Excluded Domains sections respectively.

## Android

To deploy WARP on Android devices:

1. Log in to your Microsoft Intune account.
2. Go to Apps > Android >Add.
3. In App type, select Managed Google Play app.
4. Add the Cloudflare One Agent app from the Google Play store. Its application ID is com.cloudflare.cloudflareoneagent.
5. Go to Apps > App Configuration policies > Add.
6. Select Managed devices.
7. In Name, enter Cloudflare One Agent.
8. For Platform, select Android Enterprise.
9. Choose your desired Profile Type.
10. For Targeted app, select Cloudflare One Agent. Select Next.
11. For Configuration settings format, select Enter JSON data. Enter your desired deployment parameters in the managedProperty field. For example:
{  "kind": "androidenterprise#managedConfiguration",  "productId": "app:com.cloudflare.cloudflareoneagent",  "managedProperty": [    {      "key": "app_config_bundle_list",      "valueBundleArray": [        {          "managedProperty": [            {              "key": "organization",              "valueString": "your-team-name"            },            {              "key": "display_name",              "valueString": "Production environment"            },            {              "key": "service_mode",              "valueString": "warp"            },            {              "key": "onboarding",              "valueBool": false            },            {              "key": "support_url",              "valueString": "https://support.example.com/"            }          ]        },        {          "managedProperty": [            {              "key": "organization",              "valueString": "test-org"            },            {              "key": "display_name",              "valueString": "Test environment"            }          ]        }      ]    }  ]}
Alternatively, if you do not want to copy and paste the JSON data, you can change Configuration settings format to Use configuration designer and manually configure each deployment parameter.
Once you have configured the deployment parameters, select Next.
12. Assign users or groups to this policy and select Next.
13. Save the app configuration policy.
14. Assign users or groups to the application:

Go to Apps > Android > Cloudflare One Agent > Manage Properties.
Select Edit and add users or groups.
Select Review + save > Save.
15. Go to Apps > Android > Cloudflare One Agent > Manage Properties.
16. Select Edit and add users or groups.
17. Select Review + save > Save.

Intune will now deploy the Cloudflare One Agent to user devices.

### Per-app VPN for Android

Note

Per-app VPN is supported on the Cloudflare One Agent app version 2.3 or greater for Android.

Review the following steps to approve and deploy the Cloudflare One Agent application in Microsoft Intune and use a configuration policy to set up the per-app VPN. To use the per-app VPN, the admin must have linked the Microsoft Intune account with the Google-managed Play account. For more information, refer to Connect your Intune account to your managed Google Play account in the Microsoft documentation ‚Üó.

#### Approve the Cloudflare One Agent app within Microsoft Intune

1. Log into the Microsoft Intune admin center.
2. Go to Apps > All apps > select Add.
3. In App type, select Managed Google Play.
4. Search for Cloudflare One Agent > select the app > select Sync.
5. Once the sync is successful, admin will see the Cloudflare One Agent app within the All apps view in the Microsoft Intune admin center.

#### Configure your Cloudflare One Agent app policy

To configure your Cloudflare One Agent app policy:

1. In the Microsoft Intune admin center, go to Apps > App configuration policies > select Add > Managed Devices.
2. Fill out the basic details of your configuration policy:

Enter the Name of the profile. (For example: Cloudflare One Agent - configuration policy)
Select the Platform as Android Enterprise.
Select the desired Profile Type. (For example: Personally-Owned Work Profile Only)
Select Cloudflare One Agent as the Targeted app.
Select Next.
3. Enter the Name of the profile. (For example: Cloudflare One Agent - configuration policy)
4. Select the Platform as Android Enterprise.
5. Select the desired Profile Type. (For example: Personally-Owned Work Profile Only)
6. Select Cloudflare One Agent as the Targeted app.
7. Select Next.
8. Fill out the settings for the configuration policy.


Select Configuration setting format as Enter JSON data.


Enter your desired deployment parameters in the managedProperty field. For example:
Terminal window  {  "kind": "androidenterprise#managedConfiguration",  "productId": "app:com.cloudflare.cloudflareoneagent",  "managedProperty": [    {      "key": "app_config_bundle_list",      "valueBundleArray": [        {          "managedProperty": [            {              "key": "organization",              "valueString": "${ORGANIZATION_NAME-1}"            },            {              "key": "service_mode",              "valueString": "warp"            },            {              "key": "onboarding",              "valueBool": true            },            {              "key": "display_name",              "valueString": "${UNIQUE_DISPLAY_NAME-1}"            },            {              "key": "warp_tunnel_protocol",              "valueString": "MASQUE"            },            {              "key": "tunneled_apps",              "valueBundleArray" :[                {                  "managedProperty": [                    {                      "key": "app_identifier",                      "valueString": "com.android.chrome" # Application package name/unique bundle identifier for the Chrome app browser                    },                    {                      "key": "is_browser",                      "valueBool": true                    }                  ]                },                {                  "managedProperty": [                    {                      "key": "app_identifier",                      "valueString": "com.google.android.gm" # Application package name/unique bundle identifier for the Gmail app                    },                    {                      "key": "is_browser",                      "valueBool": false # Default value is false, if a user does not define `is_browser` property our app would not treat `app_identifier` package name as a browser.                    }                  ]                }              ]            }          ]        },        {          "managedProperty": [            {              "key": "organization",              "valueString": "${ORGANIZATION_NAME-1}"            },            {              "key": "service_mode",              "valueString": "warp"            },            {              "key": "display_name",              "valueString": "${UNIQUE_DISPLAY_NAME-2}"            },            {              "key": "warp_tunnel_protocol",              "valueString": "wireguard"            }          ]        }      ]    }  ]}
Refer to Per-app VPN parameters to learn more about the MDM parameters introduced to support the per-app VPN for Android devices.


After you have configured the deployment parameters, click Next.
9. Select Configuration setting format as Enter JSON data.
10. Enter your desired deployment parameters in the managedProperty field. For example:
Terminal window  {  "kind": "androidenterprise#managedConfiguration",  "productId": "app:com.cloudflare.cloudflareoneagent",  "managedProperty": [    {      "key": "app_config_bundle_list",      "valueBundleArray": [        {          "managedProperty": [            {              "key": "organization",              "valueString": "${ORGANIZATION_NAME-1}"            },            {              "key": "service_mode",              "valueString": "warp"            },            {              "key": "onboarding",              "valueBool": true            },            {              "key": "display_name",              "valueString": "${UNIQUE_DISPLAY_NAME-1}"            },            {              "key": "warp_tunnel_protocol",              "valueString": "MASQUE"            },            {              "key": "tunneled_apps",              "valueBundleArray" :[                {                  "managedProperty": [                    {                      "key": "app_identifier",                      "valueString": "com.android.chrome" # Application package name/unique bundle identifier for the Chrome app browser                    },                    {                      "key": "is_browser",                      "valueBool": true                    }                  ]                },                {                  "managedProperty": [                    {                      "key": "app_identifier",                      "valueString": "com.google.android.gm" # Application package name/unique bundle identifier for the Gmail app                    },                    {                      "key": "is_browser",                      "valueBool": false # Default value is false, if a user does not define `is_browser` property our app would not treat `app_identifier` package name as a browser.                    }                  ]                }              ]            }          ]        },        {          "managedProperty": [            {              "key": "organization",              "valueString": "${ORGANIZATION_NAME-1}"            },            {              "key": "service_mode",              "valueString": "warp"            },            {              "key": "display_name",              "valueString": "${UNIQUE_DISPLAY_NAME-2}"            },            {              "key": "warp_tunnel_protocol",              "valueString": "wireguard"            }          ]        }      ]    }  ]}
Refer to Per-app VPN parameters to learn more about the MDM parameters introduced to support the per-app VPN for Android devices.
11. After you have configured the deployment parameters, click Next.
12. Fill out the assignments for the configuration policy. The admin can Include or Exclude specific groups of users to this policy. After you finish, select Next.
13. Review the policy and select Create.

#### Assign users to the Cloudflare One Agent application

1. Go to Apps > All Apps > select Cloudflare One Agent.
2. Under Manage, select Properties and near Assignments, select Edit.
3. Add the groups of users in the assignments > select Review + Save > select Save.

Intune will now deploy the Cloudflare One Agent application on a user's device with the managed parameters.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Jamf

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/jamf/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/jamf/)

Page options # Jamf

## macOS

### Prerequisites

- Download the Cloudflare_WARP.pkg file
- Create a plist file

### 1. Upload the WARP package

1. Log in to your Jamf ‚Üó account.
2. Go to Computer > All Settings (gear icon).
3. Select Computer Management > Packages > New.
4. Upload the Cloudflare_WARP_<VERSION>.pkg file.
For the Display name, we recommend entering the version number of the package being uploaded.
5. Select Save to complete the upload.

### 2. Create the policy

1. Go to Computers > Policies > + New.
2. Enter a Display name such as Cloudflare WARP Client.
For Triggers, our recommendation is to select Startup, Login, Enrollment Complete and Recurring Check-in, but you can select the value that works best for your organization.
3. Select Packages > Configure.
4. Select Add next to the Cloudflare_WARP_<VERSION>.pkg file you previously uploaded.
5. Select Save.

### 3. Add a Configuration Profile

1. Go to Configuration Profiles > New.
2. Enter a name for your new profile, such as Cloudflare Zero Trust.
3. Scroll through the options list and select Application & Custom Settings > Configure.
4. In Preference Domain, enter com.cloudflare.warp.
5. Upload your plist file and select Save.
6. Go to Scope to configure which devices in your organization will receive this profile.
7. Select Save.

Jamf is now configured to deploy the Cloudflare WARP client.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

## iOS

The Cloudflare One Agent allows for an automated install via Jamf.

### Prerequisites

Create an XML file with your custom deployment preferences.

### Configure Jamf for iOS

1. Log in to your Jamf ‚Üó account.
2. Go to Devices > Mobile Device Apps > + New.
3. Select App store app or apps purchased in volume and select Next.
4. In the search box, enter Cloudflare One Agent. Select Next.
5. In the row for Cloudflare One Agent by Cloudflare Inc., select Add. To verify that it is the correct application, view it in the App Store ‚Üó.
6. Go to Scope and specify the devices in your organization that will receive the application.
7. Go to App Configuration and copy/paste your XML file.
8. Select Save.

Jamf is now configured to deploy the Cloudflare One Agent.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

### Per-app VPN

Note

Per-app VPN is supported on Cloudflare One Agent version 1.8 or greater for iOS.

Before proceeding with per-app VPN configuration, you must make sure Auto connect is disabled in Zero Trust. To disable Auto connect:

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Under Device Settings, select your device profile and select Edit.
3. Turn off Auto Connect.

To configure per-app VPN:

1. Log in to the Jamf dashboard for your organization.
2. Go to Devices > Configuration Policies > select + New.
3. Under Options, select VPN. Then:

Give the VPN a Connection Name.
Select Per-App VPN from the VPN Type dropdown menu.
Check the box for Automatically start Per-App VPN connection.
4. Give the VPN a Connection Name.
5. Select Per-App VPN from the VPN Type dropdown menu.
6. Check the box for Automatically start Per-App VPN connection.
7. Under Per-App VPN Connection Type, set the Connection Type to Custom SSL via the dropdown menu. Then, enter com.cloudflare.cloudflareoneagent as the Identifier, 1.1.1.1 as the Server, and com.cloudflare.cloudflareoneagent.worker as the Provider Bundle Identifier.
8. Set the Provider Type to Packet-Tunnel and select the checkboxes for Include All Networks and Enable VPN on Demand.
9. Go to the Scope tab and add the devices that will use the Per-App VPN.
10. Save the Configuration Profile.
11. Go to Devices > Mobile Device Apps > select + New.
12. As the App Type, select App Store app or apps purchased in volume and select Next.
13. In the search bar, enter the name of the app that you want to use the VPN for and select Next.

Note

Alternatively, if you already know the Bundle Identifier of the app you want to go through the VPN, select Enter Manually.

1. Find the app you are looking for in the search results and select Add.
2. Select your preferred Distribution Method and under Per-App Networking, select the VPN connection you just configured.
3. Repeat steps 8-12 for each app you want to use the VPN.

Note

To support re-authentication, you must include a third-party browser that Cloudflare One can use to re-authenticate the user. The following third-party browsers are supported:

- Google Chrome
- Firefox
- Firefox Focus
- Microsoft Edge
- Brave
- Opera

Cloudflare One will continue to use a Safari window for initial authentication per-security best practices.

Note

Cloudflare One cannot apply split tunnel setting for a per app VPN. Included or excluded domains can be added to the Configuration Profile under Safelisted Domains and Blocklisted Domains sections respectively.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## JumpCloud

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/jumpcloud/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/jumpcloud/)

Page options # JumpCloud

## Windows

1. Log in to the JumpCloud Admin Portal ‚Üó.
2. Go to Device Management > Software Management.
3. Select the Windows tab, then select (+).
4. In the Software Name field, enter a unique display name.
5. In the Package ID field, enter warp.
6. Select Install this software.
7. (Optional) Select Keep software package up to date to automatically update this app as updates become available.
8. (Optional) Select Allow end users to delay updates for up to one week to avoid updates during a busy time.
9. Select save.
10. Select the device(s) you want to deploy the app to:

Single device: Go to the Devices tab and select the target device.
Device group: Go to the Device Groups tab and select the target device group.
11. Single device: Go to the Devices tab and select the target device.
12. Device group: Go to the Device Groups tab and select the target device group.
13. Select save.
14. Select save again.

Verify that Cloudflare WARP was installed by selecting the app and viewing the Status tab.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

## macOS

1. Log in to the JumpCloud Admin Portal ‚Üó.
2. Go to Device Management > Software Management.
3. Select the Apple tab, then select (+).
4. In the Software Description field, enter a unique display name.
5. In the Software Package URL, enter the URL location of the Cloudflare_WARP_<VERSION>.pkg file. If you do not already have the installer package, download it here.
6. Select the device(s) you want to deploy the app to:

Single device: Go to the Devices tab and select the target device. To select all devices, select the checkbox next to Type.
Device group: Go to the Device Groups tab and select the target device group. To select all device groups, select the checkbox next to Type.
7. Single device: Go to the Devices tab and select the target device. To select all devices, select the checkbox next to Type.
8. Device group: Go to the Device Groups tab and select the target device group. To select all device groups, select the checkbox next to Type.
9. Select save to install the client.

Verify that Cloudflare WARP was installed by selecting the app and viewing the Status tab.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Kandji

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/kandji/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/partners/kandji/)

Page options # Kandji

Kandji deploys Cloudflare WARP as a custom app. For an overview of how Kandji deploys custom apps, refer to their knowledge base article ‚Üó.

## macOS

For the simplest deployment, Kandji has created a downloadable configuration profile that enables Cloudflare WARP's user notifications and configures its Privacy Preference Policy Control (PPPC ‚Üó) to have Full Disk Access.

1. Download the custom profile ‚Üó.
2. Add the custom profile:

Go to Library > Add New > Add Library Item > Custom Profile.
Select Add & Configure.
3. Go to Library > Add New > Add Library Item > Custom Profile.
4. Select Add & Configure.
5. Configure the custom profile:

Enter a Name for the custom configuration profile.
Assign your custom profile to a test Blueprint.
Set Device Families to Mac.
Upload the cloudflare_warp.mobileconfig file you previously downloaded.
Save the custom profile.
6. Enter a Name for the custom configuration profile.
7. Assign your custom profile to a test Blueprint.
8. Set Device Families to Mac.
9. Upload the cloudflare_warp.mobileconfig file you previously downloaded.
10. Save the custom profile.
11. Add a custom app:

Go to Library > Add New > Add Library Item > Custom App.
Select Add & Configure.
12. Go to Library > Add New > Add Library Item > Custom App.
13. Select Add & Configure.
14. Configure the custom app:


Name the custom app.


Assign the custom app to the same test Blueprint used for the profile.


Select Audit and Enforce as the installation type.


Copy the Audit and Enforce Script below and paste it into the Audit Script text field.


To enforce a minimum app version, update the ENFORCED_VERSION variable in the audit script with the version number the audit script should enforce (for example, 1.5.207.0).
If ENFORCED_VERSION is left blank (""), the audit script will not check for a version and will only check for the presence of the Cloudflare WARP app in the Applications folder or a subfolder within Applications. Refer to the script comments for more details.


In the Install Details section, select Installer Package.


Under Installer Package, upload the Cloudflare_WARP_<VERSION>.pkg file. If you do not already have the installer package, download it here.


Select Save.
15. Name the custom app.
16. Assign the custom app to the same test Blueprint used for the profile.
17. Select Audit and Enforce as the installation type.
18. Copy the Audit and Enforce Script below and paste it into the Audit Script text field.
19. To enforce a minimum app version, update the ENFORCED_VERSION variable in the audit script with the version number the audit script should enforce (for example, 1.5.207.0).
If ENFORCED_VERSION is left blank (""), the audit script will not check for a version and will only check for the presence of the Cloudflare WARP app in the Applications folder or a subfolder within Applications. Refer to the script comments for more details.
20. In the Install Details section, select Installer Package.
21. Under Installer Package, upload the Cloudflare_WARP_<VERSION>.pkg file. If you do not already have the installer package, download it here.
22. Select Save.

To verify that Cloudflare WARP was installed, select the app in the Custom App library and view its Status tab.

After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

## Audit and Enforce Script

The following audit script checks if the WARP client is installed and optionally enforces a minimum version number.

```
#!/bin/zsh
#################################################################################################### Created by Matt Wilson | se@kandji.io | Kandji, Inc. | Solutions Engineering#################################################################################################### Created on 07/30/2021#################################################################################################### Software Information#################################################################################################### This script is designed to check if an application is present. If the app is present, the# script will check to see if a minimum version is being enforced. If a minimum app version is not# being enforced, the script will only check to see if the app is installed or not.#################################################################################################### License Information#################################################################################################### Copyright 2021 Kandji, Inc.## Permission is hereby granted, free of charge, to any person obtaining a copy of this# software and associated documentation files (the "Software"), to deal in the Software# without restriction, including without limitation the rights to use, copy, modify, merge,# publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons# to whom the Software is furnished to do so, subject to the following conditions:## The above copyright notice and this permission notice shall be included in all copies or# substantial portions of the Software.## THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,# INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR# PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE# FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR# OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER# DEALINGS IN THE SOFTWARE.###################################################################################################
# Script version_VERSION="1.0.0"
######################################################################################################################################### VARIABLES ###################################################################################################################################################### If you would like to enforce a minimum version, be sure to update the ENFORCED_VERSION variable# with the version number that the audit script should enforce. (Example version number# 1.5.207.0). If ENFORCED_VERSION is left blank, the audit script will not check for a version and# will only check for the presence of the Cloudflare WARP app at the defined APP_PATH.ENFORCED_VERSION="1.5.207.0"
###################################################################################################
# Make sure that the application matches the name of the app that will be installed.# This script will dynamically search for the application in the Applications folder. So# there is no need to define an application path. The app must either install in the# Applications folder or up to 3 sub-directories deep.#   For example Applications/<app_folder_name>/<app_name.app>APP_NAME="Cloudflare WARP.app"
# Change the PROFILE_PAYLOAD_ID_PREFIX variable to the profile prefix you want to wait on before# running the installer. If the profile is not found, this audit and enforce script will exit 00# and do nothing until the next kandji agent check-in.PROFILE_PAYLOAD_ID_PREFIX="io.kandji.cloudflare.C59FD67"
######################################################################################################################################### FUNCTIONS #####################################################################################################################################################
return_installed_app_version() {    # Return the currently installed application version    #    # $1 - Is the name of the application.    local app_name="$1"    local installed_version="" # Initialize local variable
    # Uses the find binary to look for the app inside of the Applications directory and    # any subdirectories up to 3 levels deep.    local find_app="$(/usr/bin/find /Applications -maxdepth 3 -name $app_name)"    local ret="$?"
    # Check to see if the app is installed.    if [[ "$ret" -eq 0 ]] && [[ -d "$find_app" ]] &&        [[ "$app_name" == "$(/usr/bin/basename $find_app)" ]]; then        # If the previous command returns true and the returned object is a directory        # and the app name that we are looking for is exactly equal to the app name        # found by the find command.
        # Gets the installed app version and replaces any "-" with "."        installed_version=$(/usr/bin/defaults read \            "$find_app/Contents/Info.plist" CFBundleShortVersionString |            /usr/bin/sed "s/-/./g")
    else        installed_version="None"    fi
    echo "$installed_version"}
######################################################################################################################################### MAIN LOGIC ####################################################################################################################################################
# All of the main logic be here ... modify at your own risk.
# The profiles variable will be set to an array of profiles that match the prefix in# the PROFILE_PAYLOAD_ID_PREFIX variableprofiles=$(/usr/bin/profiles show | grep "$PROFILE_PAYLOAD_ID_PREFIX" | sed 's/.*\ //')
# If the PROFILE_PAYLOAD_ID_PREFIX is not found, exit 0 to wait for the next agent run.if [[ ${#profiles[@]} -eq 0 ]]; then    echo "no profiles with ID $PROFILE_PAYLOAD_ID_PREFIX were found ..."    echo "Waiting until the profile is installed before proceeding ..."    echo "Will check again at the next Kandji agent check-in ..."    exit 0
else    echo "Profile prefix $PROFILE_PAYLOAD_ID_PREFIX present ..."
    # Uses the find binary to look for the app inside of the Applications directory and    # any subdirectories up to 3 levels deep.    find_app="$(/usr/bin/find /Applications -maxdepth 3 -name $APP_NAME)"    ret="$?"
    # Check to see if the app is installed.    if [[ "$ret" -eq 0 ]] && [[ -d "$find_app" ]] &&        [[ "$APP_NAME" == "$(/usr/bin/basename $find_app)" ]]; then        # If the previous command returns true and the returned object is a directory        # and the app name that we are looking for is exactly equal to the app name        # found by the find command.        echo "$find_app was found ..."
        # Check to see if an ENFORCED_VERSION is set. If not, exit 0.        if [[ "$ENFORCED_VERSION" == "" ]]; then            echo "A minimum enforced version is not set ..."            exit 0        fi
        # Get the currently install version        # Pass the APP_NAME variable from above to the return_installed_app_version function        # Removing the periods from the version number so that we can make a comparison.        installed_version="$(return_installed_app_version $APP_NAME | /usr/bin/sed 's/\.//g')"
        # Removing the periods from the version number so that we can make a comparison.        enforced_version="$(echo $ENFORCED_VERSION | /usr/bin/sed 's/\.//g')"
        # Check to see if the installed_version is less than the enforced_version. If it is then        # exit 1 to initiate the installation process.        if [[ "$installed_version" -lt "$enforced_version" ]]; then            echo "Installed app version $installed_version less than enforced version $ENFORCED_VERSION"            echo "Starting the app install process ..."            exit 1
        else            echo "Enforced vers: $enforced_version"            echo "Installed app version: $installed_version"            echo "Minimum app version enforcement met ..."            echo "No need to run the installer ..."            exit 0        fi
    else        echo "$APP_NAME was not found in the Applications folder ..."        echo "Need to install $APP_NAME ..."        exit 1
    fi
fi
exit 0
```

## TLS decryption

The Kandji macOS agent uses certificate pinning, which is incompatible with Gateway TLS decryption. If Gateway TLS decryption is turned on, you must create a Do Not Inspect policy to exempt Kandji from SSL/TLS inspection. For more information, refer to the Kandji documentation ‚Üó.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Parameters

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/parameters/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/parameters/)

Page options # Parameters

Each client supports the following set of parameters as part of their deployment, regardless of the deployment mechanism.

Note

Most of the parameters listed below are also configurable in Zero Trust under Settings > Devices. In the event of conflicting settings, the WARP client will always give precedence to settings on the local device (for example, in your mdm.xml or com.cloudflare.warp.plist files).

## Required for full Cloudflare Zero Trust features

For the majority of Cloudflare Zero Trust features to work, you need to specify a team name. Examples of Cloudflare Zero Trust features which depend on the team name are HTTP policies, Browser Isolation, and device posture.

### organization

Instructs the client to register the device with your organization. Registration requires authentication via an IdP or Service Auth.

Value Type: string

Value: Your team name.

## Required for DNS-only policy enforcement

This field is used to enforce DNS policies when deploying the client in DoH-only mode.

### gateway_unique_id

Instructs the client to direct all DNS queries to a specific Gateway DNS location. This value is only necessary if deploying without a team name or in an organization with multiple DNS locations.  If you do not supply a DoH subdomain, we will automatically use the default Gateway DNS location for your organization.

Value Type: string

Value: Your DoH subdomain.

## Organization parameters

You can use the following parameters to configure a specific Zero Trust organization.

### auth_client_id

Enrolls the device in your Zero Trust organization using a service token.
Requires the auth_client_secret parameter.

Value Type: string

Value: Client ID of the service token.

Example configuration:

```
<key>auth_client_id</key><string>88bf3b6d86161464f6509f7219099e57.access</string><key>auth_client_secret</key><string>bdd31cbc4dec990953e39163fbbb194c93313ca9f0a6e420346af9d326b1d2a5</string>
```

Note

The service token must have Service Auth device enrollment permissions. Allow permissions will not work for service tokens.

### auth_client_secret

Enrolls the device in your Zero Trust organization using a service token.
Requires the auth_client_id parameter.

Value Type: string

Value: Client Secret of the service token.

### auto_connect

If switch has been turned off by user, the client will automatically turn itself back on after the specified number of minutes. We recommend keeping this set to a very low value ‚Äî usually just enough time for a user to log in to hotel or airport Wi-Fi. If any value is specified for auto_connect the default state of the WARP client will always be Connected (for example, after the initial install or a reboot).

Value Type: integer

Value:

- 0 ‚Äî Allow the switch to stay in the off position indefinitely until the user turns it back on.
- 1 to 1440 ‚Äî Turn switch back on automatically after the specified number of minutes.

Note

This parameter replaces the old enabled property, which can no longer be used in conjunction with the new switch_locked and auto_connect. If you want to use these parameters, you must remove enabled.

### display_name

Identifies a Zero Trust organization in the WARP GUI when WARP is deployed with multiple organizations. Required if the organization parameter is specified within a configs array.

Value Type: string

Value: Organization nickname shown to users in the WARP GUI (for example, Test environment).

### enable_post_quantum

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP Secure Web Gateway without DNS filtering | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2025.5.735.1 |
| macOS | ‚úÖ | 2025.5.735.1 |
| Linux | ‚úÖ | 2025.5.735.1 |
| iOS | ‚úÖ | 1.10 |
| Android | ‚úÖ | 2.4 |
| ChromeOS | ‚úÖ | 2.4 |

Use post-quantum cryptography to secure connections from the device to Cloudflare's network.

Value Type: boolean

Value:

- false ‚Äî (default) Disables post-quantum key agreement.
- true ‚Äî Enables post-quantum key agreement for all traffic through the WARP tunnel.

### onboarding

Controls the visibility of the onboarding screens that ask the user to review the privacy policy during an application's first launch.

Value Type: boolean

Value:

- false ‚Äî Screens hidden.
- true ‚Äî (default) Screens visible.

### override_api_endpoint

Overrides the IP address used by the WARP client to communicate with the client orchestration API. If you set this parameter, be sure to update your organization's firewall to ensure the new IP is allowed through.

This functionality is intended for use with a Cloudflare China local network partner or any other third-party network partner that can maintain the integrity of network traffic. Most IT admins should not set this setting as it will redirect all API traffic to a new IP.

Value Type: string

Value: 1.2.3.4 ‚Äî Redirect all client orchestration API calls to 1.2.3.4.

The string must be a valid IPv4 or IPv6 address, otherwise the WARP client will fail to parse the entire MDM file.

### override_doh_endpoint

Note

Only supported in Gateway with DoH mode.1

Overrides the IP address used by the WARP client to resolve DNS queries via DNS over HTTPS (DoH). If you set this parameter, be sure to update your organization's firewall to ensure the new IP is allowed through.

This functionality is intended for use with a Cloudflare China local network partner or any other third-party network partner that can maintain the integrity of network traffic. Most IT admins should not set this setting as it will redirect all DoH traffic to a new IP.

Value Type: string

Value: 1.2.3.4 ‚Äî Redirect all DNS over HTTPS lookups to 1.2.3.4.

The string must be a valid IPv4 or IPv6 address, otherwise the WARP client will fail to parse the entire MDM file.

### override_warp_endpoint

Overrides the IP address and UDP port used by the WARP client to send traffic to Cloudflare's edge.  If you set this parameter, be sure to update your organization's firewall to ensure the new IP is allowed through.

This functionality is intended for use with a Cloudflare China local network partner or any other third-party network partner that can maintain the integrity of network traffic. Most IT admins should not set this setting as it will redirect all WARP traffic to a new IP.

Value Type: string

Value: 203.0.113.0:500 ‚Äî Redirect all WARP traffic to 203.0.113.0 on port 500.

The string must be a valid IPv4 or IPv6 socket address (containing the IP address and port number), otherwise the WARP client will fail to parse the entire MDM file.

### service_mode

Allows you to choose the operational mode of the client.

Value Type: string

Value:

- warp ‚Äî (default) Gateway with WARP.
- 1dot1 ‚Äî Gateway with DoH.
- proxy ‚Äî Proxy mode. Use the proxy_port parameter to specify the localhost SOCKS proxy port (between 0-66535). For example,
<key>service_mode</key><string>proxy</string><key>proxy_port</key><integer>44444</integer>
- postureonly ‚Äî Device Information Only.

The service mode Secure Web Gateway without DNS filtering is not currently supported as a value and must be configured in Zero Trust.

### support_url

When the WARP client is deployed via MDM, the in-app Send Feedback button is disabled by default. This parameter allows you to re-enable the button and direct feedback towards your organization.

Value Type: string

Value:

- https://<support.example.com> ‚Äî Use an https:// link to open your company's internal help site.
- mailto:<yoursupport@example.com> ‚Äî Use a mailto: link to open your default mail client.

### switch_locked

Allows the user to turn off the WARP switch and disconnect the client.

Value Type: boolean

Value:

- false ‚Äî (default) The user is able to turn the switch on/off at their discretion. When the switch is off, the user will not have the ability to reach sites protected by Access that leverage certain device posture checks.
- true ‚Äî The user is prevented from turning off the switch. The WARP client will automatically start in the connected state.

On new deployments, you must also include the auto_connect parameter with at least a value of 0. This will prevent clients from being deployed in the off state without a way for users to manually enable them.

Note

This parameter replaces the old enabled property, which can no longer be used in conjunction with the new switch_locked and auto_connect. If you want to use these parameters, you must remove enabled.

### unique_client_id

Note

Only valid for iOS and Android/ChromeOS.

Assigns a unique identifier to the device for the device UUID posture check.

Value Type: string

Value: UUID for the device (for example, 496c6124-db89-4735-bc4e-7f759109a6f1).

## Top-level parameters

Top-level parameters determine how WARP manages device registrations.

### configs

Allows a user to switch between Zero Trust organizations in the WARP client GUI. The configs array is also required when using another top-level parameter such as multi_user or pre_login, even if only one organization is specified.

Value Type: array

Value: An array containing one or more Zero Trust organizations.

### multi_user

Enables multiple user registrations on a Windows device.

Value Type: boolean

Value:

- false ‚Äî (default) Only one WARP registration is stored per device. After a user logs in to WARP, their settings and identity will apply to all traffic from the device.
- true ‚Äî Each Windows user has their own WARP registration. For more information, refer to Multiple users on a Windows device.

### pre_login

Allows WARP to connect with a service token before a user completes the initial Windows login. For more information, refer to Connect WARP before Windows login.

## Per-app VPN parameters (Android)

Per-app VPN ‚Üó parameters allow you to choose the Android apps that can send traffic through the WARP tunnel. Admins can configure these parameters via any MDM tool that supports deploying an Android app to managed devices or work profiles.

### app_identifier

An application package name/bundle identifier which uniquely identifies the app on the Google Play Store. This application will be tunneled through the WARP service.

Value Type: string

Value: The app identifier can be found in the ID query parameter of the specific app's Play Store URL. For example: in the case of https://play.google.com/store/apps/details?id=com.cloudflare.cloudflareoneagent, the app identifier for the Cloudflare One Agent app is com.cloudflare.cloudflareoneagent.

### is_browser

An optional property. is_browser will help the Cloudflare One Agent application decide which browser to open instead of the default browser for specific features such as re-authentication and Gateway block notifications. If needed, admins should explicitly indicate that a given tunneled_app is a browser, rather than relying on automatic browser detection.

Value Type: boolean

Value: If the value is true, identifies the application defined in app_identifier as a browser. The default value is false and is_browser is an optional property.

## Footnotes

1. Gateway with WARP is supported in client version 2025.2.664.0 and below. In version 2025.4.589.1 and above, this parameter does not apply to Gateway with WARP because all DoH traffic goes inside of the WARP tunnel. ‚Ü©

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect WARP before Windows login

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/windows-prelogin/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/windows-prelogin/)

Page options # Connect WARP before Windows login

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP Gateway with DoH  Secure Web Gateway without DNS filtering  Proxy mode | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.6.415.0 |
| macOS | ‚ùå |  |
| Linux | ‚ùå |  |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

With Cloudflare Zero Trust, you can use an on-premise Active Directory (or similar) server to validate a remote user's Windows login credentials. Before the user enters their Windows login information for the first time, the WARP client establishes a connection using a service token. This initial connection is not associated with a user identity. Once the user completes the Windows login, WARP switches to an identity-based session and applies the user registration to all future logins.

## Prerequisites

- Active Directory resources are connected to Cloudflare.

## 1. Create a service token

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Access > Service Auth > Service Tokens.
2. Select Create Service Token.
3. Name the service token. The name allows you to easily identify events related to the token in the logs and to revoke the token individually.
4. Choose a Service Token Duration. This sets the expiration date for the token.
5. Select Generate token. You will see the generated Client ID and Client Secret for the service token, as well as their respective request headers.
6. Copy the Client Secret.
WarningThis is the only time Cloudflare Access will display the Client Secret. If you lose the Client Secret, you must generate a new service token.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Access: Service Tokens Write
2. Access: Service Tokens Write
3. Configure the cloudflare_zero_trust_access_service_token ‚Üó resource:
resource "cloudflare_zero_trust_access_service_token" "example_service_token" {  account_id = var.cloudflare_account_id  name       = "Example service token"  duration  = "8760h"
  lifecycle {    create_before_destroy = true  }}
4. Get the Client ID and Client Secret of the service token:
 Example: Output to CLI
 
Output the Client ID and Client Secret to the Terraform state file:
output "example_service_token_client_id" {  value     = cloudflare_zero_trust_access_service_token.example_service_token.client_id}
output "example_service_token_client_secret" {  value     = cloudflare_zero_trust_access_service_token.example_service_token.client_secret  sensitive = true}

Apply the configuration:
Terminal windowterraform apply

Read the Client ID and Client Secret:
Terminal windowterraform output -raw example_service_token_client_id
Terminal windowterraform output -raw example_service_token_client_secret

 
 Example: Store in HashiCorp Vault
   resource "vault_generic_secret" "example_service_token" {    path         = "kv/cloudflare/example_service_token"
    data_json = jsonencode({      "CLIENT_ID"     = cloudflare_access_service_token.example_service_token.client_id      "CLIENT_SECRET" = cloudflare_access_service_token.example_service_token.client_secret    })  }
5. Output the Client ID and Client Secret to the Terraform state file:
output "example_service_token_client_id" {  value     = cloudflare_zero_trust_access_service_token.example_service_token.client_id}
output "example_service_token_client_secret" {  value     = cloudflare_zero_trust_access_service_token.example_service_token.client_secret  sensitive = true}
6. Apply the configuration:
Terminal windowterraform apply
7. Read the Client ID and Client Secret:
Terminal windowterraform output -raw example_service_token_client_id
Terminal windowterraform output -raw example_service_token_client_secret

## 2. Create a device enrollment policy

In your device enrollment permissions, create the following policy:

| Rule Action | Rule type | Selector | Value |
| --- | --- | --- | --- |
| Service Auth | Include | Service Token | <TOKEN-NAME> |

## 2. (Optional) Restrict access during pre-login

Devices enrolled via a service token are identified by the email address non_identity@<team-name>.cloudflareaccess.com. Using this email address, you can apply specific device profile settings and Gateway network policies during the pre-login state. For example, you could provide access to only those resources necessary to complete the Windows login and/or device management activities.

Example device profile rule

| Selector | Operator | Value | Logic |
| --- | --- | --- | --- |
| User email | in | non_identity@<team-name>.cloudflareaccess.com | And |
| Operating system | is | Windows |  |

Example Gateway network policy

| Selector | Operator | Value | Logic |
| --- | --- | --- | --- |
| Destination IP | in list | Active Directory servers | And |
| User email | in | non_identity@<team-name>.cloudflareaccess.com | And |
| Passed Device Posture Checks | in | Windows 10 or higher (OS version) |  |

| Action |
| --- |
| Allow |

## 3. Configure the MDM file

To enable the Windows pre-login feature, an MDM file in the following format must be deployed on the device. In the following example, the pre_login key allows the device to connect using the service token, while configs contains your default Zero Trust configuration.

```
<dict>  <key>pre_login</key>  <dict>    <key>organization</key>    <string>mycompany</string>    <key>auth_client_id</key>    <string>TOKEN-ID</string>    <key>auth_client_secret</key>    <string>TOKEN-SECRET</string>  </dict>  <key>configs</key>  <array>    <dict>      <key>organization</key>      <string>mycompany</string>      <key>display_name</key>      <string>Default</string>    </dict>  </array></dict>
```

WARP will only apply the pre-login configuration when no other WARP registration exists and the user has not yet logged into Windows. When the pre-login configuration is in effect, the device will appear on My Team > Devices with the email non_identity@<team-name>.cloudflareaccess.com.

After the user logs into Windows, WARP will automatically switch to the default MDM configuration and prompt the user to authenticate with the IdP. Once authenticated, WARP registers and connects with the user identity. The My Team > Devices page will now show a new device associated with the user's email. This user registration will then be used for any subsequent connections, including before the next Windows user login.

Deleting the user registration would cause WARP to switch back to the pre-login configuration as soon as the user logs out of Windows.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Multiple users on a Windows device

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/windows-multiuser/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/windows-multiuser/)

Page options # Multiple users on a Windows device

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| All modes | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2025.2.460.1 |
| macOS | ‚ùå |  |
| Linux | ‚ùå |  |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

Cloudflare WARP supports multiple user registrations on a single Windows device. When deployed in multi-user mode, the WARP client will automatically switch user registrations after a user logs in to their Windows account. All traffic to Cloudflare will be attributed to the currently active Windows user. This allows administrators to apply identity-based policies and device settings, audit user activity, and remove individual users from a shared workstation.

DNS logging

If a user enables Log DNS queries in the WARP GUI (or runs warp-cli dns log enable), WARP will store all DNS queries on the device onto disk. Any user on the device will be able to examine the DNS queries of another user.

## Enable multi-user mode

To enable multi-user support on Windows, deploy an MDM file onto the device with the multi_user key set to true. For example:

```
<dict>  <key>multi_user</key>  <true/>  <key>configs</key>  <array>    <dict>      <key>organization</key>      <string>your-team-name</string>      <key>display_name</key>      <string>Default</string>    </dict>  </array></dict>
```

To use multi-user mode alongside the Windows pre-login and Switch between Zero Trust organizations options:

```
<dict>  <key>multi_user</key>  <true/>  <key>pre_login</key>  <dict>    <key>organization</key>    <string>mycompany</string>    <key>auth_client_id</key>    <string>88bf3b6d86161464f6509f7219099e57.access</string>    <key>auth_client_secret</key>    <string>bdd31cbc4dec990953e39163fbbb194c93313ca9f0a6e420346af9d326b1d2a5</string>  </dict>  <key>configs</key>  <array>    <dict>      <key>organization</key>      <string>mycompany</string>      <key>display_name</key>      <string>Production environment</string>    </dict>    <dict>      <key>organization</key>      <string>test-org</string>      <key>display_name</key>      <string>Test environment</string>    </dict>  </array></dict>
```

When enabling multi-user mode for the first time, users will need to re-register even if they had a previous registration.

## WARP registration logic

The following flowchart shows how WARP registration settings take effect as users log in and out:

```
flowchart TB
    start(["Enable multi-user mode"])-->reg["Active Windows user is prompted to register WARP"]
		reg--"Log out of Windows"-->prelogin
		reg--"Switch user"-->regexists

    subgraph preloginbehavior["Windows login screen"]
		prelogin{{"Is there a pre-login <br />registration?"}}
    preloginyes["Use pre-login settings"]
		prelogin--"Yes"-->preloginyes
		prelogin-. "No" .->preloginno
		preloginno["Stay registered as <br />previous Windows user"]
		end

		preloginbehavior--"Log in to Windows"---->regexists{{"Has the user already registered with WARP?"}}
		regexists--"Yes"-->user["Switch to that user's registration"]
		regexists-. "No" .->reg
```

### Fast user switching

Note

Requires multi-user mode.

Fast user switching ‚Üó is a Windows feature that allows users to switch accounts without logging out. With fast user switching, multiple users may be logged in to the device and generating network traffic. The WARP client will attribute all traffic to the user who has the interactive windows station ‚Üó. For example, if user A is logged in and fast user switches to user B, traffic from both accounts will appear to come from user B. This is because user B is now actively using the Windows desktop GUI. Now assume that user B logs out and there is no pre-login registration; WARP will continue to attribute traffic to user B until user A logs back in to the Windows desktop.

To accurately attribute network traffic to specific users, Cloudflare recommends disabling fast user switching or at the very least configuring a pre-login registration.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Switch between Zero Trust organizations

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/switch-organizations/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/mdm-deployment/switch-organizations/)

Page options # Switch between Zero Trust organizations

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| All modes | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.1.159.0 |
| macOS | ‚úÖ | 2024.1.160.0 |
| Linux | ‚úÖ | 2024.2.62.0 |
| iOS | ‚úÖ | 1.7 |
| Android | ‚úÖ | 1.4 |
| ChromeOS | ‚úÖ | 1.4 |

In Cloudflare WARP, users can switch between multiple Zero Trust organizations (or other MDM parameters) that administrators specify in an MDM file. Common use cases include:

- Allow IT security staff to switch between test and production environments.
- Allow Managed Service Providers to support multiple customer accounts.
- Allow users to switch between the default WARP ingress IPs and the Cloudflare China ingress IPs.

## MDM file format

To enable multiple organizations, administrators need to modify their MDM file to take an array of configurations. Each configuration must include a display_name parameter that will be visible to users in the WARP client GUI. Because display names are listed in the same order as they appear in the MDM file, we recommend putting the most used configurations at the top of the file. When a user opens the WARP client for the first time, they will be prompted to log into the first configuration in the list.

An MDM file supports a maximum of 25 configurations. The following example includes three configurations.

### XML

mdm.xml ```
<dict>  <key>configs</key>  <array>    <dict>      <key>organization</key>      <string>mycompany</string>      <key>display_name</key>      <string>Production environment</string>    </dict>    <dict>      <key>organization</key>      <string>mycompany</string>      <key>override_api_endpoint</key>      <string>203.0.113.0</string>      <key>override_doh_endpoint</key>      <string>203.0.113.0</string>      <key>override_warp_endpoint</key>      <string>203.0.113.0:0</string>      <key>display_name</key>      <string>China employees</string>    </dict>    <dict>      <key>organization</key>      <string>test-org</string>      <key>display_name</key>      <string>Test environment</string>    </dict>  </array></dict>
```

### plist

Download an example .plist file.

### mobileconfig

Download an example .mobileconfig file.

## Switch organizations in WARP

- Windows, macOS, and Linux
- iOS and Android

To switch to a different organization as a user:

1. Open the WARP client on your device.
2. Select the gear icon.
3. Select Switch configurations. The menu will show the organizations that the admin has configured for your device.
4. Select the organization that you want to connect to.
5. If prompted, complete the authentication steps required for the new organization. Your authentication information will be saved and you will be able to switch back and forth between organizations.

Note

Only admins can add additional organizations to the WARP GUI. To connect to an organization that is not displayed in the GUI, go to Preferences > Account to manually log out of the old organization and log into the new organization.

To switch to a different organization as a user:

1. Open the WARP client on your device.
2. Go to Settings > Advanced.
3. Select Switch configurations. The menu will show the organizations that the admin has configured for your device.
4. Select the organization that you want to connect to.
5. If prompted, complete the authentication steps required for the new organization. Your authentication information will be saved and you will be able to switch back and forth between organizations.

Note

Only admins can add additional organizations to the WARP GUI. To connect to an organization that is not displayed in the GUI, go to Settings > Account to manually log out of the old organization and log into the new organization.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Manual deployment

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/manual-deployment/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/manual-deployment/)

Page options # Manual deployment

If you plan to direct your users to manually download and configure the WARP client, users will need to connect the client to your organization's Cloudflare Zero Trust instance.

## Prerequisites

- Set device enrollment permissions to specify which users can connect.
- After deploying the WARP client, you can check its connection progress using the Connectivity status messages displayed in the WARP GUI.

## Windows, macOS, and Linux

### Enroll using the GUI

To enroll your device using the WARP GUI:

1. Download and install the WARP client.
2. Launch the WARP client.
3. Select the Cloudflare logo in the menu bar.
4. Select the gear icon.
5. Go to Preferences > Account.
6. Select Login with Cloudflare Zero Trust.
7. Enter your team name.
8. Complete the authentication steps required by your organization.
Once authenticated, you will see a Success page and a dialog prompting you to open WARP.
9. Select Open Cloudflare WARP.app to complete the registration.

The device is now protected by your organization's Zero Trust policies.

### Enroll using the CLI

To enroll your device using the terminal:

1. Download ‚Üó and install the WARP package.
2. Open a terminal window. Ensure that you are logged into the terminal as the current user and not as root.
3. Enroll into Cloudflare Zero Trust using your organization's team name:
Terminal windowwarp-cli registration new <your-team-name>
4. In the browser window that opens, complete the authentication steps required by your organization.
Once authenticated, you will see a success page and a dialog prompting you to open a link.
5. Select Open Link.
6. Verify the registration in the terminal:
Terminal windowwarp-cli registration show

Troubleshoot missing registration

The registration process may take a few minutes to complete. If the registration continues to be missing, then manually copy the authentication token from the browser to the WARP client:

1. On the success page, right-click and select View Page Source.
2. Find the HTML metadata tag that contains the token. For example, <meta http-equiv="refresh" content"=0;url=com.cloudflare.warp://<your-team-name>.cloudflareaccess.com/auth?token=yeooilknmasdlfnlnsadfojDSFJndf_kjnasdf..." />
3. Copy the URL field: com.cloudflare.warp://<your-team-name>.cloudflareaccess.com/auth?token=<your-token>
4. In the terminal, run the following command using the URL obtained in the previous step.
Terminal windowwarp-cli registration token "com.cloudflare.warp://<your-team-name>.cloudflareaccess.com/auth?token=<your-token>"

If you get a 401 error, then the token has expired. Generate a new one by refreshing the web page and quickly grab the new token from the page source.

1. If you did not configure WARP to auto-connect, manually turn on WARP:
Terminal windowwarp-cli connect

The device is now protected by your organization's Zero Trust policies. For more information on all available commands, run warp-cli --help.

## iOS, Android, and ChromeOS

### Enroll manually

1. Download and install the Cloudflare One Agent app.
2. Launch the Cloudflare One Agent app.
3. Select Next.
4. Review the privacy policy and select Accept.
5. Enter your team name.
6. Complete the authentication steps required by your organization.
7. After authenticating, select Install VPN Profile.
8. In the Connection request popup window, select OK.
9. If you did not enable auto-connect ‚Üó, manually turn on the switch to Connected.

The device is now protected by your organization's Zero Trust policies.

### Enroll using a URL

Feature availability

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚ùå |  |
| macOS | ‚ùå |  |
| Linux | ‚ùå |  |
| iOS | ‚úÖ | 1.10 |
| Android | ‚úÖ | 2.4 |
| ChromeOS | ‚úÖ | 2.4 |

Administrators can provide users with a custom login URL that automatically fills in your organization's team name during device enrollment. Using a URL reduces the potential for error that comes with manual entry of the team name.

The WARP client supports URLs accessed through a direct link or with a URL handler such as a QR code. Direct links are currently only supported in Safari and Firefox. If your default browser is Chrome (or another unsupported browser), we recommend embedding the link in a QR code.

#### Generate a login URL

To generate a URL for device enrollment:

1. Copy the following link, replacing <your-team-name> with your Zero Trust team name:
txt cf1app://oneapp.cloudflare.com/team?name=<your-team-name>
2. (Optional) Use any QR code generator to embed the link in a QR code.
3. Distribute the link or QR code to users.

#### Use the login URL

To enroll a device using a login URL:

1. Download and install the Cloudflare One Agent app.
2. Go to the login URL provided by your account administrator. To use a QR code, open the QR scanner app on your device and scan the QR code.
The Cloudflare One Agent app will open and start the onboarding flow.
NoteIf the device is already enrolled in the account associated with this URL, Cloudflare One agent will bypass onboarding and show the Connected switch.
3. To complete the onboarding flow:
a. Review the privacy policy and select Accept.
b. On the Enter team name screen, confirm that the pre-populated team name matches your organization.
Already Authenticated errorIf Cloudflare One Agent is logged in using another team name, you must first log out of that account. Go to Settings > Account to log out, and then retry the QR code or login link.
c. Complete the authentication steps required by your organization.
d. After authenticating, select Install VPN Profile.
e. In the Connection request popup window, select OK.
4. If you did not enable auto-connect, manually turn on the switch to Connected.

The device is now protected by your organization's Zero Trust policies.

## Virtual machines

By default, virtual machines (VMs) are subject to the WARP client settings of the host. If you want to deploy a separate instance of WARP in a VM, you must configure the VM to operate in bridged networking mode.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Device enrollment permissions

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/device-enrollment/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/device-enrollment/)

Page options # Device enrollment permissions

Device enrollment permissions determine which users can connect new devices to your organization's Cloudflare Zero Trust instance.

## Set device enrollment permissions

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. In Device enrollment permissions, select Manage.
3. In the Policies tab, configure one or more Access policies to define who can join their device. For example, you could allow all users with a company email address:















Rule typeSelectorValueIncludeEmails ending in@company.com

Note

Device posture checks are not supported in device enrollment policies. WARP can only perform posture checks after the device is enrolled.

1. In the Login methods tab, select the identity providers users can authenticate with. If you have not integrated an identity provider, you can use the one-time PIN.
2. Select Save.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Access: Apps and Policies Write
2. Access: Apps and Policies Write
3. Create a reusable Access policy using the cloudflare_zero_trust_access_policy ‚Üó resource:
resource "cloudflare_zero_trust_access_policy" "allow_company_emails" {  account_id   = var.cloudflare_account_id  name         = "Allow company emails"  decision     = "allow"  include      = [    {      email_domain = {        domain = "@example.com"      }    }  ]}
4. Use the cloudflare_zero_trust_access_application ‚Üó resource to create an application with type warp.
resource "cloudflare_zero_trust_access_application" "device_enrollment" {  account_id       = var.cloudflare_account_id  type             = "warp"  name             = "Warp device enrollment"  allowed_idps              = [cloudflare_zero_trust_access_identity_provider.microsoft_entra_id.id]  auto_redirect_to_identity = true  app_launcher_visible      = false  policies = [    {      id = cloudflare_zero_trust_access_policy.allow_company_emails.id      precedence = 1    }  ]}

Users can now enroll their device by logging in to your identity provider. To prevent users from logging out of your organization after they enroll, disable Allow devices to leave organization in your WARP client settings.

## Example policies

### Check for service token

Instead of requiring users to authenticate with their credentials, you can use a service token to enroll devices without any user interaction. Because users are not required to log in to an identity provider, identity-based policies cannot be enforced on these devices.

To enroll devices using a service token:

- Dashboard
- Terraform (v5)

1. Create a service token.
2. Copy the token's Client ID and Client Secret.
3. Go to Access > Policies and create the following policy:

















Rule ActionRule typeSelectorValueService AuthIncludeService Token<TOKEN-NAME>
Make sure to set Action to Service Auth instead of Allow.
4. Add the Access policy to your device enrollment permissions.
5. In your MDM deployment parameters, add the following fields:

auth_client_id: The Client ID of your service token.
auth_client_secret: The Client Secret of your service token.
6. auth_client_id: The Client ID of your service token.
7. auth_client_secret: The Client Secret of your service token.

1. Add the following permissions to your cloudflare_api_token ‚Üó:

Access: Apps and Policies Write
Access: Service Tokens Write
2. Access: Apps and Policies Write
3. Access: Service Tokens Write
4. Create a service token and copy its Client ID and Client Secret.
5. Create the following Access policy:
resource "cloudflare_zero_trust_access_policy" "warp_enrollment_service_token" {  account_id     = var.cloudflare_account_id  name           = "Allow service token"  decision       = "non_identity"  include = [    {      service_token = {        token_id = cloudflare_zero_trust_access_service_token.example_service_token.id      }    }  ]}
6. Add the policy to your cloudflared_zero_trust_access_application for WARP.
7. In your MDM deployment parameters, add the following fields:

auth_client_id: The Client ID of your service token.
auth_client_secret: The Client Secret of your service token.
8. auth_client_id: The Client ID of your service token.
9. auth_client_secret: The Client Secret of your service token.

When you deploy the WARP client with your MDM provider, WARP will automatically connect the device to your Zero Trust organization.

You can verify which devices have enrolled by going to My Team > Devices. Devices that enrolled using a service token (or any other Service Auth policy) will have the Email field show as non_identity@<team-name>.cloudflareaccess.com.

### Check for mTLS certificate

Enterprise customers can enforce mutual TLS authentication during device enrollment.

Certificate requirements

- The CA certificate can be from a publicly trusted CA or self-signed.
- In the certificate Basic Constraints, the attribute CA must be set to TRUE.
- The certificate must use one of the signature algorithms listed below:
 Allowed signature algorithms
 x509.SHA1WithRSAx509.SHA256WithRSAx509.SHA384WithRSAx509.SHA512WithRSAx509.ECDSAWithSHA1x509.ECDSAWithSHA256x509.ECDSAWithSHA384x509.ECDSAWithSHA512

To check for an mTLS certificate:

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Access > Service auth > Mutual TLS.
2. Select Add mTLS Certificate.
3. Enter any name for the root CA.
4. In Certificate content, paste the contents of your root CA.
If the client certificate is directly signed by the root CA, you only need to upload the root. If the client certificate is signed by an intermediate certificate, you must upload the entire CA chain (intermediate and root). For example:
-----BEGIN CERTIFICATE-----<intermediate.pem>-----END CERTIFICATE----------BEGIN CERTIFICATE-----<rootCA.pem>-----END CERTIFICATE-----

1. In Associated hostnames, enter your Zero Trust team domain: <team-name>.cloudflareaccess.com
2. In your device enrollment permissions, add a Common Name or Valid Certificate rule. For example, the following policy requires a client certificate with a specific common name:

















ActionRule typeSelectorValueAllowRequireCommon Name<CERT-COMMON-NAME>
3. On your device, add the client certificate to the system keychain.

1. Add the following permissions to your cloudflare_api_token ‚Üó:

Access: Mutual TLS Certificates Write
Access: Apps and Policies Write
2. Access: Mutual TLS Certificates Write
3. Access: Apps and Policies Write
4. Use the cloudflare_zero_trust_access_mtls_certificate ‚Üó resource to add an mTLS certificate to your account:
resource "cloudflare_zero_trust_access_mtls_certificate" "example_mtls_cert" {  account_id     = var.cloudflare_account_id  name           = "WARP enrollment mTLS cert"  certificate    = <<EOT  -----BEGIN CERTIFICATE-----  xxxx  xxxx  -----END CERTIFICATE-----  EOT  associated_hostnames = ["your-team-name.cloudflareaccess.com"]}
5. Create the following Access policy:
resource "cloudflare_zero_trust_access_policy" "warp_enrollment_mtls" {  account_id     = var.cloudflare_account_id  name           = "Allow employees with mTLS cert"  decision       = "allow"  include = [    {      email_domain = {        domain = "@example.com"      }    }  ]
  require = [    {      common_name = {        common_name = "Common name 1"      }    },        {      common_name = {        common_name = "Common name 2"      }    }  ]}
6. Add the policy to your cloudflared_zero_trust_access_application for WARP.
7. On your device, add the client certificate to the system keychain.

When users log in to your Zero Trust organization from the WARP client, their device must present a valid client certificate in order to connect.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## WARP with firewall

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/firewall/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/firewall/)

Page options # WARP with firewall

If your organization uses a firewall or other policies to restrict or intercept Internet traffic, you may need to exempt the following IP addresses and domains to allow the WARP client to connect.

## Client orchestration API

The WARP client connects to Cloudflare via a standard HTTPS connection outside the tunnel for operations like registration or settings changes. To perform these operations, you must allow zero-trust-client.cloudflareclient.com which will lookup the following IP addresses:

- IPv4 API Endpoints: 162.159.137.105 and 162.159.138.105
- IPv6 API Endpoints: 2606:4700:7::a29f:8969 and 2606:4700:7::a29f:8a69

If your firewall allows traffic only by domain, you may need to explicitly allow zero-trust-client.cloudflareclient.com. Even though zero-trust-client.cloudflareclient.com may resolve to different IP addresses, WARP overrides the resolved IPs with the IPs listed above. To avoid connectivity issues, ensure that the above IPs are permitted through your firewall.

## DoH IP

Note

Only required for Gateway with DoH mode.

In Gateway with DoH mode, the WARP client sends DNS requests to Gateway over an HTTPS connection. For DNS to work correctly, you must allow <ACCOUNT_ID>.cloudflare-gateway.com which will lookup the following IPs:

- IPv4 DoH Addresses: 162.159.36.1 and 162.159.46.1
- IPv6 DoH Addresses: 2606:4700:4700::1111 and 2606:4700:4700::1001

If your firewall allows traffic only by domain, you may need to explicitly allow <ACCOUNT_ID>.cloudflare-gateway.com. Even though <ACCOUNT_ID>.cloudflare-gateway.com may resolve to different IP addresses, WARP overrides the resolved IPs with the IPs listed above. To avoid connectivity issues, ensure that the above IPs are permitted through your firewall.

### Android devices

If you are deploying the Cloudflare One Agent on Android/ChromeOS, you must also add cloudflare-dns.com to your firewall exception list. On Android/ChromeOS devices, WARP uses cloudflare-dns.com to resolve domains on your Split Tunnel list.

## Client authentication endpoint

When you log in to your Zero Trust organization, you will have to complete the authentication steps required by your organization in the browser window that opens. To perform these operations, you must allow the following domains:

- The IdP used to authenticate to Cloudflare Zero Trust
- <your-team-name>.cloudflareaccess.com

## WARP ingress IP

WARP connects to the following IP addresses, depending on which tunnel protocol is configured for your device (WireGuard or MASQUE). All network traffic from your device to Cloudflare goes through these IPs and ports over UDP.

### WireGuard

|  |  |
| --- | --- |
| IPv4 address | 162.159.193.0/24 |
| IPv6 address | 2606:4700:100::/48 |
| Default port | UDP 2408 |
| Fallback ports | UDP 500  UDP 1701  UDP 4500 |

### MASQUE

|  |  |
| --- | --- |
| IPv4 address | 162.159.197.0/24 |
| IPv6 address | 2606:4700:102::/48 |
| Default port | UDP 443 |
| Fallback ports | UDP 500  UDP 1701  UDP 4500  UDP 4443  UDP 8443  UDP 8095  TCP 443 1 |

Note

Before you log in to your Zero Trust organization, you may see the IPv4 range 162.159.192.0/24. This IP is used for consumer WARP services (1.1.1.1 w/ WARP) and is not required for Zero Trust deployments.

## Captive portal

The following domains are used as part of our captive portal check:

- cloudflareportal.com
- cloudflareok.com
- cloudflarecp.com
- www.msftconnecttest.com
- captive.apple.com
- connectivitycheck.gstatic.com

## Connectivity checks

As part of establishing the WARP connection, the client runs connectivity checks inside and outside of the WARP tunnel.

### Outside tunnel

The client connects to the following destinations to verify general Internet connectivity outside of the WARP tunnel. Make sure that these IPs and domains are on your firewall allowlist.

- engage.cloudflareclient.com: The client will always send requests directly to an IP in the WARP ingress IPv4 or IPv6 range (or to your override_warp_endpoint if set). Requests will not use a proxy server, even if one is configured for the system.
- 162.159.197.3
- 2606:4700:102::3

If your firewall allows traffic only by domain, you may need to explicitly allow engage.cloudflareclient.com. Even though engage.cloudflareclient.com may resolve to different IP addresses, WARP overrides the resolved IPs with the IPs listed above. To avoid connectivity issues, ensure that the above IPs are permitted through your firewall.

### Inside tunnel

The WARP client connects to the following IPs to verify connectivity inside of the WARP tunnel:

- 162.159.197.4
- 2606:4700:102::4

Because this check happens inside of the tunnel, you do not need to add these IPs to your firewall allowlist. However, since the requests go through Gateway, ensure that they are not blocked by a Gateway HTTP or Network policy.

If your firewall allows traffic only by domain, you may need to explicitly allow connectivity.cloudflareclient.com. Even though connectivity.cloudflareclient.com may resolve to different IP addresses, WARP overrides the resolved IPs with the IPs listed above. To avoid connectivity issues, ensure that the above IPs are permitted through your firewall.

## NEL reporting (optional)

The WARP client reports connectivity issues to our NEL endpoint via a.nel.cloudflare.com. This is not technically required to operate but will result in errors in our logs if not excluded properly.

## Latency statistics (optional)

The WARP client generates ICMP traffic to the WARP ingress IPs when running tunnel latency tests. This is not technically required to operate but will result in errors in our logs if not excluded properly.

## Time synchronization (optional)

The WARP client attempts to synchronize the exact time by NTP (UDP 123) to Cloudflare's Time Service via time.cloudflare.com. This is not technically required to operate but will result in errors in our logs if not excluded properly.

## Scope of firewall rules

### Required scopes

If your organization does not currently allow inbound/outbound communication over the IP addresses, ports, and domains described above, you must manually add an exception. The rule at a minimum needs to be scoped to the following process based on your platform:

- Windows: C:\Program Files\Cloudflare\Cloudflare WARP\warp-svc.exe
- macOS: You must explicitly allow both the core networking daemon and GUI component as shown in the following instructions.


Core networking daemon: /Applications/Cloudflare WARP.app/Contents/Resources/CloudflareWARP
This binary does not have a Bundle ID and must be allowed via full path.


GUI component, choose one of the following three identifiers depending on your MDM or firewall vendor's preferred format:
/Applications/Cloudflare WARP.app (Path)
/Applications/Cloudflare WARP.app/Contents/MacOS/Cloudflare WARP (Path)
com.cloudflare.1dot1dot1dot1dot1.macos (Bundle ID)


WarningDue to changes in macOS Sequoia version 15.0 and 15.0.1., you must update your macOS firewall settings to allow the WARP client to manage your device's firewall.To ensure proper functionality, disable the Block all incoming connections ‚Üó option in your macOS firewall settings.
- Core networking daemon: /Applications/Cloudflare WARP.app/Contents/Resources/CloudflareWARP
This binary does not have a Bundle ID and must be allowed via full path.
- GUI component, choose one of the following three identifiers depending on your MDM or firewall vendor's preferred format:
/Applications/Cloudflare WARP.app (Path)
/Applications/Cloudflare WARP.app/Contents/MacOS/Cloudflare WARP (Path)
com.cloudflare.1dot1dot1dot1dot1.macos (Bundle ID)

### Optional scopes

#### DEX tests

To run Digital Experience Monitoring tests, you will need to allow the warp-dex process to generate network traffic to your target destinations:

- Windows: C:\Program Files\Cloudflare\Cloudflare WARP\warp-dex.exe
- macOS: /Applications/Cloudflare WARP.app/Contents/Resources/warp-dex

#### WARP network statistics

To use the network connectivity tests built into the WARP GUI, you will need to allow the GUI application to generate network traffic:

- Windows: C:\Program Files\Cloudflare\Cloudflare WARP\Cloudflare WARP.exe
- macOS: /Applications/Cloudflare WARP.app

## Related resources

- Local Domain Fallback - Resolve selected domains via local DNS instead of Cloudflare Gateway.
- Split Tunnels - Control which traffic goes through WARP by including or excluding specific IPs or domains.

## Footnotes

1. Required for HTTP/2 fallback ‚Ü©

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## WARP with legacy VPN

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/vpn/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/vpn/)

Page options # WARP with legacy VPN

The Cloudflare WARP client can run alongside most legacy third-party VPNs. Because the WARP client and third-party VPN client both enforce firewall, routing, and DNS rules on your local device, the two products will compete with each other for control over IP and DNS traffic. To ensure compatibility make sure that:

- IP traffic is split tunneled between WARP and the VPN. All VPN traffic must bypass WARP and vice versa.
- The VPN bypasses/allows/excludes all domains, IPs, and ports listed in WARP with firewall.
- DNS resolution is handled by either WARP or the VPN. You must disable DNS filtering in one of the two products.

For the most stable and consistent connection, we recommend connecting your private network or individual applications to Cloudflare instead of using a legacy VPN. However, until you can migrate, the following guidelines will help get your Zero Trust deployment up and running.

## Gateway with WARP

In Gateway with WARP mode, WARP must be allowed to capture and route all DNS traffic on the device. You can use Local Domain Fallback to send DNS requests to a server behind your third-party VPN or firewall, but the request must first go through WARP's local DNS proxy. Refer to WARP architecture for more information about this requirement.

If you cannot disable DNS on your VPN, switch to Secure Web Gateway without DNS filtering mode to disable DNS in WARP.

### 1. Configure the VPN

Perform these steps in your third-party VPN software. Refer to your VPN's documentation for specific instructions on how to configure these settings.

1. Enable split tunneling in the third-party VPN.
2. Disable DNS configuration in the third-party VPN.

### 2. Configure WARP

Perform these steps in Zero Trust ‚Üó.

1. Set your Split Tunnels mode to Exclude IPs and domains.
2. Add the following entries to your Split Tunnel Exclude list:

Private IP address range exposed by your third-party VPN client. For example,

















SelectorValueIP Address172.16.0.0/12

Server that your third-party VPN client connects to. For example,













SelectorValueDomain*.cvpn-endpoint-xxxxx.prod.clientvpn.us-west-2.amazonaws.com
3. Private IP address range exposed by your third-party VPN client. For example,

















SelectorValueIP Address172.16.0.0/12
4. Server that your third-party VPN client connects to. For example,













SelectorValueDomain*.cvpn-endpoint-xxxxx.prod.clientvpn.us-west-2.amazonaws.com

1. (Optional) In Local Domain Fallback, add the domains that you want to resolve using your VPN's private DNS servers. For example,













DomainDNS Serversinternal.wiki.intranet172.31.26.130, 172.31.23.120

You can now test if WARP runs alongside the VPN.

## Secure Web Gateway without DNS filtering

In Secure Web Gateway without DNS filtering mode, WARP does not perform any DNS functions on the device. Therefore, all you need to do is split tunnel your IP traffic.

### 1. Configure the VPN

Enable split tunneling in your third-party VPN software. Refer to your VPN's documentation for specific instructions on how to configure this setting.

### 2. Configure WARP

Perform these steps in Zero Trust ‚Üó.

1. Set your Split Tunnels mode to Exclude IPs and domains.
2. Add the following entries to your Split Tunnel Exclude list:

Private IP address range exposed by your third-party VPN client. For example,

















SelectorValueIP Address172.16.0.0/12

Server that your third-party VPN client connects to. For example,













SelectorValueDomain*.cvpn-endpoint-xxxxx.prod.clientvpn.us-west-2.amazonaws.com
3. Private IP address range exposed by your third-party VPN client. For example,

















SelectorValueIP Address172.16.0.0/12
4. Server that your third-party VPN client connects to. For example,













SelectorValueDomain*.cvpn-endpoint-xxxxx.prod.clientvpn.us-west-2.amazonaws.com

1. In your device profile, verify that Service mode is set to Secure Web Gateway without DNS filtering.

## Test the configuration

We recommend enabling the WARP client before enabling your third-party VPN. Some third-party VPNs must be the last to edit a network's configuration or they will fail.

1. Connect the WARP client.
2. Connect the third-party VPN client.
3. To test your Split Tunnel configuration, connect to a private IP address that is behind the VPN. For example, you can open a terminal and run ping <SERVER-IP>.
4. To test your DNS configuration, connect to an internal domain that is behind the VPN. For example, you can open a browser and go to internal.wiki.intranet.

Test before updates

Once you have a configuration in place and working, make sure to thoroughly test compatibility before updating your VPN software. Compatibility testing with what are essentially competing software will need to be done with each new version.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Configure WARP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/)

Page options # Configure WARP

You can configure WARP client settings to work alongside existing infrastructure and provide users with differential access to resources.

Managed deployments

If you are deploying WARP with device management software, we recommend only supplying organization in your deployment parameters and managing all other settings via the dashboard. Any settings you configure on the dashboard will be overridden by the local policy deployed by your management software. To ensure dashboard settings are applied as intended, remove the corresponding parameters from your managed deployment configuration.

- Device profiles
- WARP modes
- WARP settings
- Managed networks
- Route traffic
- WARP sessions

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Device profiles

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/device-profiles/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/device-profiles/)

Page options # Device profiles

A device profile defines WARP client settings for a specific set of devices in your organization. You can create multiple profiles and apply different settings based on the user's identity, the device's location, and other criteria.

For example, users in one identity provider group (signifying a specific office location) might have different routes that need to be excluded from their WARP tunnel, or some device types (like Linux) might need different DNS settings to accommodate local development services.

## Create a new profile

- Dashboard
- API
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. In the Profile settings card, select Create profile. This will make a copy of the Default profile.
3. Enter any name for the profile.
4. Create rules to define the devices that will use this profile. Learn more about the available Selectors, Operators, and Values.
5. Configure WARP settings for these devices.

Note

At this time, Split Tunnels and Local Domain Fallback can only be modified after you save the profile.

1. Select Create profile.

Your profile will appear in the Profile settings list. You can rearrange the profiles in the list according to your desired order of precedence.

Send a POST request to the Devices API:

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a device settings profile ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/devices/policy" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "allow_mode_switch": false,    "allow_updates": false,    "allowed_to_leave": false,    "auto_connect": 600,    "captive_portal": 180,    "description": "Example device profile recommended in the implementation documentation. For details, refer to https://developers.cloudflare.com/learning-paths/replace-vpn/configure-device-agent/device-profiles/",    "disable_auto_fallback": true,    "enabled": true,    "exclude_office_ips": false,    "match": "identity.email in {\"jdoe@example.com\"} or any(identity.groups.name[*] in {\"developers\" \"admin\"}) and os.name == \"windows\"",    "name": "Example device profile",    "precedence": 101,    "service_mode_v2": {        "mode": "warp"    },    "support_url": "https://support.example.com",    "switch_locked": true  }'
```

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Create a new profile using the cloudflare_zero_trust_device_custom_profile ‚Üó resource:
resource "cloudflare_zero_trust_device_custom_profile" "example" {  account_id            = var.cloudflare_account_id  name                  = "Example device profile"  description           = "Example device profile recommended in the implementation documentation. For details, refer to https://developers.cloudflare.com/learning-paths/replace-vpn/configure-device-agent/device-profiles/"  allow_mode_switch     = false  allow_updates         = false  allowed_to_leave      = false  auto_connect          = 600  captive_portal        = 180  disable_auto_fallback = true  enabled               = true  exclude_office_ips    = false  precedence            = 101  service_mode_v2       = {mode = "warp"}  support_url           = "https://support.example.com"  switch_locked         = true  tunnel_protocol       = "wireguard"
  match = trimspace(replace(<<-EOT    identity.email in {"jdoe@example.com"}    or any(identity.groups.name[*] in {"developers" "admin"})    and os.name == "windows"  EOT  , "\n", " "))}

## Edit profile settings

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. In the Profile settings card, find the profile you want to update and select Configure.
3. Use selectors to add or adjust match rules, and modify WARP settings for this profile as needed.
NoteChanging any of the settings below will cause the WARP connection to restart. The user may experience a brief period of connectivity loss while the new settings are being applied.
Service mode
Local Domain Fallback
Split Tunnels
4. Service mode
5. Local Domain Fallback
6. Split Tunnels
7. Select Save profile.

It may take up to 10 minutes for newly updated settings to propagate to devices.

## Verify device profile

To check which device profile and profile settings are currently on a device, open a terminal and run:

Terminal window ```
warp-cli settings
```

The device profile UUID is shown in the Profile ID field.

Alternatively, if you do not have access to the CLI, you can use DEX remote captures to collect WARP diagnostic logs from the Zero Trust dashboard. The device profile UUID is shown in your detection report under Profile ID.

## Selectors

You can configure device profiles to match against the following selectors, or criteria. Identity-based selectors are only available if the user enrolled the device by logging in to an identity provider (IdP).

### User email

Apply a device profile based on the user's email.

| UI name | API example value |
| --- | --- |
| User email | identity.email == "user-name@company.com" |

### User group emails

Apply a device profile based on an IdP group email address of which the user is configured as a member in the IdP.

| UI name | API example |
| --- | --- |
| User group emails | identity.groups.email == "contractors@company.com" |

### User group IDs

Apply a device profile based on an IdP group ID of which the user is configured as a member in the IdP.

| UI name | API example |
| --- | --- |
| User group IDs | identity.groups.id == "12jf495bhjd7893ml09o" |

### User group names

Apply a device profile based on an IdP group name of which the user is configured as a member in the IdP.

| UI name | API example |
| --- | --- |
| User group names | identity.groups.name == "\"finance\"" |

### Operating system

Apply a device profile based on the operating system of the device.

| UI name | API example |
| --- | --- |
| Operating system | os.name in {\"windows\" \"mac\"} |

### Operating system version

Apply a device profile based on the OS version of the device.

| UI name | API example |
| --- | --- |
| Operating system version | os.version == \"1.2.0\" |

Note

The OS version must be specified as a valid Semver ‚Üó. For example, if your device is running OS version 1.2, you must enter 1.2.0.

### Managed network

Apply a device profile based on the managed network that the device is connected to.

| UI name | API example |
| --- | --- |
| Managed network | network == \"Austin office\" |

### SAML attributes

Apply a device profile based on an attribute name and value from a SAML IdP.

| UI name | API example |
| --- | --- |
| SAML Attributes | identity.saml_attributes == "\"group=finance\"" |

### Service token

Apply a device profile based on the service token used to enroll the device.

| UI name | API example |
| --- | --- |
| Service Token | identity.service_token_uuid == \"f174e90a-fafe-4643-bbbc-4a0ed4fc8415\" |

## Comparison operators

Comparison operators determine how device profiles match a selector.

| Operator | Meaning |
| --- | --- |
| is | equals the defined value |
| in | matches at least one of the defined values |

## Logical operators

To evaluate multiple conditions in an expression, select a logical operator:

| Operator | Meaning |
| --- | --- |
| And | match all of the conditions in the expression |
| Or | match any of the conditions in the expression |

## Order of precedence

Cloudflare WARP evaluates device profiles dynamically based on a hierarchy. When a device connects, WARP checks the profiles from top to bottom as they appear in the dashboard. WARP follows the first match principle ‚Äî once a device matches a profile, WARP stops evaluating and no subsequent profiles can override the decision.

The Default profile is always at the bottom of the list. It will only be applied if the device does not meet the criteria of any profile listed above it. If you make another custom profile the default, all settings will be copied over into the Default profile.

Administrators can create multiple profiles to apply different settings based on specific criteria such as user identity, location, or operating system. Understanding this top-to-bottom evaluation order is crucial for ensuring that the correct policies are applied to devices.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## WARP modes

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-modes/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-modes/)

Page options # WARP modes

You can deploy the WARP client in different modes to control the types of traffic sent to Cloudflare Gateway. The WARP mode determines which Zero Trust features are available on the device.

## Gateway with WARP (default)

This mode is best suited for organizations that want to use advanced firewall/proxy functionalities and enforce device posture rules.

| DNS filtering | Network filtering | HTTP filtering | Features enabled |
| --- | --- | --- | --- |
| Yes | Yes | Yes | DNS policies, network policies, HTTP policies, Browser Isolation, identity-based policies, device posture checks, AV scanning, and Data Loss Prevention |

## Gateway with DoH

Gateway with DNS-over-HTTPS (DoH) is best suited for organizations that only want to apply DNS filtering to outbound traffic from their company devices. Network and HTTP traffic is handled by the default mechanisms on your devices.

| DNS filtering | Network filtering | HTTP filtering | Features enabled |
| --- | --- | --- | --- |
| Yes | No | No | DNS policies |

## Secure Web Gateway without DNS filtering

Secure Web Gateway without DNS filtering mode (sometimes referred to as tunnel-only mode) is best suited for organizations that want to proxy network and HTTP traffic but keep their existing DNS filtering software. DNS traffic is handled by the default mechanism on your device.

| DNS filtering | Network filtering | HTTP filtering | Features enabled |
| --- | --- | --- | --- |
| No | Yes | Yes | Network policies, HTTP policies, Browser Isolation, identity-based policies, device posture checks, AV scanning, and Data Loss Prevention |

Note

- Secure Web Gateway without DNS filtering mode disables all features that rely on WARP for DNS resolution, including domain-based split tunneling and Local Domain Fallback.
- Only available on Windows, Linux, and macOS.
- Secure Web Gateway without DNS filtering mode has a known limitation concerning DNS servers with IPv6 addresses.

## Proxy mode

Proxy mode is best suited for organizations that want to filter traffic directed to specific applications.

| DNS filtering | Network filtering | HTTP filtering | Features enabled |
| --- | --- | --- | --- |
| No | No | Yes | HTTP policies, Browser Isolation, identity-based policies, AV scanning, and Data Loss Prevention for traffic sent through localhost proxy |

Note

- Proxy mode can only be used by applications/operating systems that support SOCKS5/HTTPS proxy communication.
- Only available on Windows, Linux, and macOS.
- Proxy mode has a timeout limit of 10 seconds for requests. If a request goes above the 10 second limit, Cloudflare will drop the connection.

## Device Information Only

This mode is best suited for organizations that only want to enforce WARP client device posture checks for zones in your account. DNS, Network and HTTP traffic is handled by the default mechanisms on your devices. To setup Device Information Only mode, refer to the dedicated page.

| DNS filtering | Network filtering | HTTP filtering | Features enabled |
| --- | --- | --- | --- |
| No | No | No | Device posture rules in Access policies |

## WARP modes comparison

Each WARP mode offers a different set of Zero Trust features.

| WARP Mode | DNS Filtering | Network Filtering | HTTP Filtering | Service mode (displayed in warp-cli settings) |
| --- | --- | --- | --- | --- |
| Gateway with WARP (default) | ‚úÖ | ‚úÖ | ‚úÖ | WarpWithDnsOverHttps |
| Gateway with DoH | ‚úÖ | ‚ùå | ‚ùå | DnsOverHttps |
| Secure Web Gateway without DNS filtering | ‚ùå | ‚úÖ | ‚úÖ | TunnelOnly |
| Proxy mode | ‚ùå | ‚ùå | ‚úÖ | WarpProxy on port 40000 |
| Device Information Only | ‚ùå | ‚ùå | ‚ùå | PostureOnly |

## Related resources

- Connectivity status - Learn about the status messages displayed by the WARP client during its connection process, and understand each stage as WARP establishes a secure tunnel to Cloudflare.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Enable Device Information Only

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-modes/device-information-only/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-modes/device-information-only/)

Page options # Enable Device Information Only

Feature availability

| System | Availability |
| --- | --- |
| Windows | ‚úÖ |
| macOS | ‚úÖ |
| Linux | ‚úÖ |
| iOS | ‚úÖ |
| Android | ‚úÖ |
| ChromeOS | ‚úÖ |

Device Information Only mode allows you to enforce device posture rules when a user connects to your self-hosted Access application. This mode relies on a client certificate generated from your account to establish trust between the Access application and the device.

## 1. Turn on account settings

Using the API, enable client certificate provisioning for your zone:

Required API token permissions

At least one of the following token permissions is required: - SSL and Certificates Write

Update device certificate provisioning status ```
curl "https://api.cloudflare.com/client/v4/zones/$ZONE_ID/devices/policy/certificates" \  --request PATCH \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "enabled": true  }'
```

## 2. Configure the WARP client

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Under  Profile settings card, choose a device profile and select Configure.
3. For Service mode, select Device Information Only.
4. Enroll your device into your Zero Trust organization.
When enrolled in Device Information Only mode, the WARP client will automatically generate a client certificate and install the certificate on the device. This certificate is necessary to confirm the source of outgoing traffic.

## 3. (Optional) Verify the client certificate

1. To view the client certificates installed on the device:
      Windows     macOS     Linux     iOS     Android     ChromeOS      
Open the Start menu and select Run.
Enter certlm.msc.
Go to Personal > Certificates.
  
Open Keychain Access.
Go to System > My Certificates.
  Open a terminal window and run the following command:Terminal window$ certutil -L -d sql:/etc/pki/nssdb  Go to Settings > General > About > Certificate Trust Settings.  The location of the client certificate may vary depending on the Android device.
Samsung: Go to Settings > Security > Other security settings > View security certificates.
Google Pixel: Go to Security > Advanced settings > Encryption & credentials > Credential storage.
  Go to Settings > Apps > Google Play Store > Manage Android Preferences > Security > Credentials.     
The client certificate name should match the Device ID in your WARP client Preferences.
2. Windows
3. macOS
4. Linux
5. iOS
6. Android
7. ChromeOS
8. Open the Start menu and select Run.
9. Enter certlm.msc.
10. Go to Personal > Certificates.
11. Open Keychain Access.
12. Go to System > My Certificates.
13. Samsung: Go to Settings > Security > Other security settings > View security certificates.
14. Google Pixel: Go to Security > Advanced settings > Encryption & credentials > Credential storage.
15. To verify the client certificate in your Cloudflare account:

In the Cloudflare dashboard ‚Üó, select the zone for which you enabled client certificates.
Go to SSL/TLS > Client Certificates.

The certificate name is the WARP enrollment Device ID.
16. In the Cloudflare dashboard ‚Üó, select the zone for which you enabled client certificates.
17. Go to SSL/TLS > Client Certificates.

## 4. Enforce the client certificate

To block traffic from devices that do not have a valid client certificate:

1. In the Cloudflare dashboard ‚Üó, go to SSL/TLS > Client Certificates.
2. Under Hosts, select Edit and enter the hostname of your Access application (for example, app.mycompany.com). This enables mTLS authentication for the application.
3. Select Create mTLS rule.
4. Create a WAF custom rule that checks all requests to your application for a valid client certificate:


























FieldOperatorValueLogicActionClient CertificateequalsOffAndBlockHostnameequalsapp.mycompany.com
5. Select Deploy.

Device Information Only mode is now enabled on the device. To start enforcing device posture, set up a WARP client check and add a Require device posture rule to your Access policy. When the device connects to the Access application for the first time, the browser will ask to use the client certificate installed by WARP.

## Limitations

Device Information mode is not compatible with the Windows pre-login feature. The user must be logged into Windows because WARP needs to install a certificate in the user store.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## WARP settings

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-settings/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-settings/)

Page options # WARP settings

WARP settings define the WARP client modes and permissions available to end users.

- Global settings apply to all devices enrolled in your Zero Trust organization.
- Device settings may vary across devices depending on which device profile is applied.

Note

It may take up to 10 minutes for newly updated settings to propagate to devices.

## Global settings

### Admin override

Feature availability

| Operating Systems | WARP mode required | Zero Trust plans ‚Üó |
| --- | --- | --- |
| All systems | Any mode | All plans |

Note

To use Admin override, you must first have enabled Lock WARP switch.

When Lock WARP switch is enabled, users cannot toggle the WARP client on and off on their device. Enabling Admin override gives users the ability to temporarily turn on or off the WARP client using an override code provided by an admin. Admin override is only needed in a configuration where Lock WARP switch is enabled.

Example use cases for Admin override include:

- Allowing users to momentarily turn off WARP to work around a temporary network issue such as an incompatible public Wi-Fi, or a firewall at a customer site blocking the connection.
- Allowing test users to turn on WARP when Global WARP override is in effect.

As admin, you can set a Timeout to define how long a user can toggle the WARP switch on or off after entering the override code. Cloudflare generates a new override code every hour that an admin can send to end users. The override code's validity adheres to fixed-hour time blocks and aims to be generous to the end user.

Troubleshooting

To learn more about override code timeouts and how Cloudflare calculates an override code's valid duration, refer to Troubleshooting.

If Auto connect is enabled, WARP will automatically reconnect, according to the value set for the auto connect timeout, even when using Admin override. Refer to Troubleshooting for more information.

#### Retrieve the override code

To retrieve the one-time code for a user:

1. Enable Admin override.
2. Go to My Team > Devices.
3. Select View details for a connected device.
4. Scroll down to User details and select the user's name.
5. Copy the 7-digit Override code shown in the side panel.
6. Share this code with the user for them to enter on their device.

The user will have an unlimited amount of time to activate their code.

#### Enter the override code

To activate the override code on a user device:

1. In the WARP client, go to Settings > Preferences > Advanced.
2. Select Enter code.
3. Enter the override code.

The user can now toggle the WARP switch or use the warp-cli connect command. The client will automatically reconnect after the Auto connect period, but the user can continue to turn on or off WARP until the override expires.

### Install CA to system certificate store

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP, Proxy mode | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.12.554.0 |
| macOS | ‚úÖ | 2024.12.554.0 |
| Linux | ‚úÖ | 2024.12.554.0 |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

When Enabled, the WARP client will automatically install your organization's root certificate on the device.

### Override local interface IP

Feature availability

| Operating Systems | WARP modes | Zero Trust plans ‚Üó |
| --- | --- | --- |
| Windows, macOS, Linux | Gateway with WARP, Secure Web Gateway without DNS Filtering | All plans |

Overrides the default IP address of WARP's virtual network interface such that each device has its own unique local interface IP.

This setting is primarily used as a prerequisite for WARP Connector and MASQUE. You can also use it when the default IP conflicts with other local services on your network.

Value:

- Disabled: (default) Sets the local interface IP to 172.16.0.2 on all devices. This configuration is only respected by devices using WireGuard and does not affect devices using MASQUE.
- Enabled: Sets the local interface IP on each device to its CGNAT IP.

The CGNAT IP assigned to a WARP device is permanent until the device unregisters from your Zero Trust organization. Disconnects and reconnects do not change the IP address assignment.

### Global WARP override

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| All modes | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2025.2.600.0 |
| macOS | ‚úÖ | 2025.2.600.0 |
| Linux | ‚úÖ | 2025.2.600.0 |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

Note

Requires the Super Administrator role.

Global WARP override allows administrators to fail open WARP in case of an incident occurring in your environment, independent from incidents or outages affecting Cloudflare's services. When you turn on Global WARP override, Cloudflare will disconnect all Windows, macOS, and Linux WARP clients that are connected to your Zero Trust organization. This includes end user devices, WARP Connector hosts, and WARP-to-WARP devices. End users will receive a notification on their device and the WARP client will display Admin directed disconnect.

Auto connect and Lock WARP switch will not apply while the global override is on. Additionally, the global override will clear any existing Admin override codes. The only way for users to reconnect during a global override is by using a new Admin override code. For example, you may want to provide IT staff with a code so that they can test resolution of the incident that led to the global disconnect.

To resume normal operations, turn off Global WARP override. The WARP client will automatically reconnect.

## Device settings

### Captive portal detection

Feature availability

| Operating Systems | WARP mode required | Zero Trust plans ‚Üó |
| --- | --- | --- |
| All systems | Any mode | All plans |

When Enabled, the WARP client will automatically turn off when it detects a captive portal, and it will automatically turn back on after the Timeout duration.

Since captive portal implementations vary, WARP may not detect all captive portals. For more information, refer to Captive portal detection.

### Mode switch

Feature availability

| Operating Systems | WARP modes | Zero Trust plans ‚Üó |
| --- | --- | --- |
| All systems | Any mode | All plans |

When Enabled, users have the option to switch between Gateway with WARP mode and Gateway with DoH mode. This feature does not support switching between any other modes.

### Device tunnel protocol

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP Secure Web Gateway without DNS filtering | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.11.309.0 |
| macOS | ‚úÖ | 2024.11.309.0 |
| Linux | ‚úÖ | 2024.11.309.0 |
| iOS | ‚úÖ | 1.7 |
| Android | ‚úÖ | 2.0 |
| ChromeOS | ‚úÖ | 2.0 |

Configures the protocol used to route IP traffic from the device to Cloudflare Gateway. To check the active protocol on a device, open a terminal and run warp-cli settings | grep protocol.

Value:

- WireGuard: (default) Establishes a WireGuard ‚Üó connection to Cloudflare. The WARP client will encrypt traffic using a non-FIPs compliant cipher suite, TLS_CHACHA20_POLY1305_SHA256. When switching from MASQUE to WireGuard, users may lose Internet connectivity if their Wi-Fi network blocks the ports and IPs required for WireGuard to function.
- MASQUE: Establishes an HTTP/3 connection to Cloudflare. The WARP client will encrypt traffic using TLS 1.3 and a FIPS 140-2 ‚Üó compliant cipher suite, TLS_AES_256_GCM_SHA384. Override local interface IP is enabled by default for devices with MASQUE enabled.

For more details on WireGuard versus MASQUE, refer to our blog post ‚Üó.

### Lock WARP switch

Feature availability

| Operating Systems | WARP modes | Zero Trust plans ‚Üó |
| --- | --- | --- |
| All systems | Any mode | All plans |

Allows the user to turn off the WARP switch and disconnect the client.

Value:

- Disabled: (default) The user is able to turn the WARP switch on or off at their discretion. When the WARP switch is off, the user will not have the ability to reach sites protected by Access that leverage certain device posture checks.
- Enabled: The user is prevented from turning off the WARP switch. The WARP client will always start in the connected state.

On MDM deployments, you must also include the auto_connect parameter with at least a value of 0. This will prevent clients from being deployed in the off state without a way for users to manually enable them.

### Allow device to leave organization

Feature availability

| Operating Systems | WARP mode required | Zero Trust plans ‚Üó |
| --- | --- | --- |
| All systems | Any mode | All plans |

When Enabled, users can log out from your Zero Trust organization by selecting Logout from Zero Trust in the WARP client UI. The Logout from Zero Trust button is only available for devices that were enrolled manually. Devices that enrolled using an MDM file are always prevented from leaving your Zero Trust organization.

### Allow updates

Feature availability

| Operating Systems | WARP modes | Zero Trust plans ‚Üó |
| --- | --- | --- |
| macOS, Windows, Linux | Any mode | All plans |

When Enabled, users will receive update notifications when a new version of the client is available. Only turn this on if your users are local administrators with the ability to add or remove software from their device.

### Auto connect

Feature availability

| Operating Systems | WARP mode required | Zero Trust plans ‚Üó |
| --- | --- | --- |
| All systems | Any mode | All plans |

When Enabled, the client will automatically reconnect if it has been disabled for the specified Timeout value. This setting is best used in conjunction with Lock WARP Switch above.

We recommend keeping this set to a very low value ‚Äî usually just enough time for a user to log in to hotel or airport Wi-Fi. If any value is specified, the client defaults to the Connected state (for example, after a reboot or the initial install).

Value:

- 0: Allow the switch to stay in the off position indefinitely until the user turns it back on.
- 1 to 1440: Turn switch back on automatically after the specified number of minutes.

### Support URL

Feature availability

| Operating Systems | WARP mode required | Zero Trust plans ‚Üó |
| --- | --- | --- |
| All systems | Any mode | All plans |

When Enabled, the Send Feedback button in the WARP client appears and will launch the URL specified. Example Support URL values are:

- https://support.example.com: Use an https:// link to open your companies internal help site.
- mailto:yoursupport@example.com: Use a mailto: link to open your default mail client.

### Service mode

Feature availability

| Operating Systems | WARP mode required | Zero Trust plans ‚Üó |
| --- | --- | --- |
| All systems | Any mode | All plans |

Allows you to choose the operational mode of the client. Refer to WARP Modes for a detailed description of each mode.

### Local Domain Fallback

Feature availability

| Operating Systems | WARP modes | Zero Trust plans ‚Üó |
| --- | --- | --- |
| All systems | Gateway with WARP, Gateway with DoH | All plans |

Configures the WARP client to redirect DNS requests to a private DNS resolver. For more information, refer to our Local Domain Fallback documentation.

### Split Tunnels

Feature availability

| Operating Systems | WARP mode required | Zero Trust plans ‚Üó |
| --- | --- | --- |
| All systems | Any mode | All plans |

Configures the WARP client to exclude or include traffic to specific IP addresses or domains. For more information, refer to our Split Tunnel documentation.

### Directly route Microsoft 365 traffic

Feature availability

| Operating Systems | WARP mode required | Zero Trust plans ‚Üó |
| --- | --- | --- |
| All systems | Any mode | All plans |

Creates Split Tunnel Exclude entries for all Microsoft 365 IP addresses specified by Microsoft ‚Üó. To use this setting, Split Tunnels must be set to Exclude IPs and domains. Once enabled, all Microsoft 365 network traffic will bypass WARP and Gateway.

Note

Microsoft has recently made changes to the IPs used by their applications (such as Microsoft Teams). Until Microsoft updates their IP address and URL web service ‚Üó, you will need to manually add the following IPs to your Split Tunnels Exclude list:

- 24.24.24.24/32
- 52.120.0.0/14

### Allow users to enable local network exclusion

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP Secure Web Gateway without DNS filtering | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.1.159.0 |
| macOS | ‚úÖ | 2024.1.160.0 |
| Linux | ‚úÖ | 2024.2.62.0 |
| iOS | ‚ùå | N/A1 |
| Android | ‚úÖ | 1.4 |
| ChromeOS | ‚úÖ | 1.4 |

This setting is intended as a workaround for users whose home network uses the same set of IP addresses as your corporate private network. To use this setting, Split Tunnels must be set to Exclude IPs and domains.

When Enabled, users have the option to access local network resources (such as printers and storage devices) while connected to WARP. When the user turns on Access Local Network, WARP will detect the local IP range advertised by the user's home network (for example, 10.0.0.0/24) and temporarily exclude this range from the WARP tunnel. The user will need to re-request access after the Timeout expires. Setting Timeout to 0 minutes will allow LAN access until the next WARP reconnection, such as a reboot or a laptop waking from sleep.

Warning

Enabling this setting comes with two major consequences:

- Device is exposed to security threats. The user may be unaware that traffic to what used to be their company's private network is now actually being routed to their local network. This leaves the device vulnerable to on-path attackers ‚Üó and other security vulnerabilities. For example, imagine that a user's typical workflow involves logging into a remote desktop on the corporate network at 10.0.0.30. A bad actor could set up a fake server on the local network at 10.0.0.30. If the user goes to 10.0.0.30 while Access local network is enabled, the attacker can now steal their credentials.
- User loses access to corporate resources. ‚Äî While accessing their local network, the user will be unable to connect to corporate resources that fall within the same IP/CIDR range.

#### Access local network as a user

To turn on local network access in the WARP client:

- Windows and macOS
- Linux
- Android and ChromeOS

1. Select the Cloudflare logo in the menu bar.
2. Select the gear icon.
3. Select Access Local Network.

1. Open a terminal window.
2. Run warp-cli override local-network start.

1. Open the Cloudflare One Agent app.
2. Go to Settings > Advanced > Connection Options.
3. Select Access Local Network.

#### Limitations

- WARP will only exclude local networks in the RFC 1918 ‚Üó address space. Other IP addresses such as CGNAT are not supported.
- The maximum excluded subnet size is /24.
- If a device has multiple network interfaces with distinct local IP ranges, WARP will only exclude one of those networks. To access a specific local network, disable the other interfaces and disconnect/reconnect WARP.

### WARP interface IP DNS registration

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP Secure Web Gateway without DNS filtering | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2025.2.600.0 |
| macOS | ‚ùå |  |
| Linux | ‚ùå |  |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

When Enabled, the operating system will register WARP's local interface IP (CGNAT IP or 172.16.0.2) with your on-premise DNS server when the DNS server is reachable.

If you use on-premise DNS infrastructure (such as Active Directory), we recommend turning this setting on for remote device profiles and turning it off for managed network device profiles. In this configuration, remote devices will register their WARP interface IP, while on-premise devices will only register their local DHCP address. This allows the on-premise DNS server to resolve device hostnames no matter where the device is located.

### SCCM VPN boundary support

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP Secure Web Gateway without DNS filtering | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2025.5.735.1 |
| macOS | ‚ùå |  |
| Linux | ‚ùå |  |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

Microsoft's System Center Configuration Manager ‚Üó (SCCM) is used to manage software on Windows devices based on the boundary group ‚Üó, or network location, to which they belong. You can assign WARP clients to a SCCM boundary group based on their managed network and other device profile attributes. When SCCM VPN Boundary Support is turned on, the WARP client will modify the description field on its virtual network interface. This allows you to define a VPN boundary group that matches on the network interface description.

Value:

- Disabled: (default) WARP network interface description is Cloudflare WARP Interface Tunnel.
- Enabled: WARP network interface description is (SCCM) Cloudflare WARP Interface Tunnel for devices which have the SCCM client ‚Üó installed. Devices without the SCCM client will still use the default Cloudflare WARP Interface Tunnel description. WARP checks if the SCCM client is installed by looking for the SMS Agent Host (ccmexec.exe) Windows service.

#### Example SCCM configuration

Assume you want to push software updates from a cloud based distribution point ‚Üó if the device is remote, but use on-prem servers if the device is on the office network. To set up these boundary groups:

1. In Zero Trust:
a. Turn on SCCM VPN Boundary Support for remote device profiles.
b. Turn off SCCM VPN Boundary Support for on-prem device profiles.
c. (Optional) Verify device settings:
 Verify SCCM VPN Boundary Support
 To check if SCCM VPN Boundary Support is active on a device, run the following command:Terminal windowwarp-cli settings | findstr "SCCM VPN Boundary"(network policy) SCCM VPN Boundary Support: trueYou can also verify network interface details for the CloudflareWARP adapter:Terminal windowipconfig /allWindows IP Configuration
...
Unknown adapter CloudflareWARP:
  Connection-specific DNS Suffix  . :  Description . . . . . . . . . . . : (SCCM) Cloudflare WARP Interface Tunnel  Physical Address. . . . . . . . . :  DHCP Enabled. . . . . . . . . . . : No  Autoconfiguration Enabled . . . . : Yes  IPv6 Address. . . . . . . . . . . : 2606:4700:110:8f79:145:f180:fc4:8106(Preferred)  Link-local IPv6 Address . . . . . : fe80::83b:d647:4bed:d388%49(Preferred)  IPv4 Address. . . . . . . . . . . : 172.16.0.2(Preferred)  Subnet Mask . . . . . . . . . . . : 255.255.255.255  Default Gateway . . . . . . . . . :  DNS Servers . . . . . . . . . . . : 127.0.2.2                                      127.0.2.3  NetBIOS over Tcpip. . . . . . . . : Enabled
2. In Microsoft SCCM:
a. Create a boundary ‚Üó with the following settings:

Description: Remote WARP clients
Type: VPN
Connection description: (SCCM) Cloudflare WARP Interface Tunnel

b. Assign this boundary to one or more boundary groups.
3. Description: Remote WARP clients
4. Type: VPN
5. Connection description: (SCCM) Cloudflare WARP Interface Tunnel

When the device is remote, the WARP interface description changes to (SCCM) Cloudflare WARP Interface Tunnel and the SCCM server will determine that the device belongs to the VPN boundary group. The device can now download updates from the distribution point assigned to this boundary group. When a network change occurs and WARP detects a managed network, it will revert the interface description to Cloudflare WARP Interface Tunnel and the boundary condition will no longer be satisfied. The device will match your local IP range and be considered as on-prem.

## Footnotes

1. Current versions of iOS do not allow LAN traffic to route through the WARP tunnel. Therefore, this feature is not needed on iOS. ‚Ü©

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Captive portal detection

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-settings/captive-portals/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-settings/captive-portals/)

Page options # Captive portal detection

Captive portals are used by public Wi-Fi networks (such as airports, coffee shops, and hotels) to make a user agree to their Terms of Service or provide payment before allowing access to the Internet. When a user connects to the Wi-Fi, the captive portal blocks all HTTPS traffic until the user completes a captive portal login flow in their browser. This prevents the WARP client from connecting to Cloudflare. At the same time, WARP creates firewall rules on the device to send all traffic to Cloudflare. The user is therefore unable to access the captive portal login screen unless they temporarily disable WARP.

## Allow users to connect to captive portals

To allow users to connect through a captive portal, administrators can configure the following WARP settings:

### No user interaction required

- Enable Captive portal detection. This allows WARP to temporarily turn off when it detects a captive portal on the network. For more details, refer to how captive portal detection works and its limitations.
- Set Device tunnel protocol to MASQUE. When using MASQUE, WARP traffic will look like standard HTTPS traffic and is therefore less likely to be blocked by captive portals.

### User interaction required

- Enable Lock WARP switch and enable Admin override. Users can contact the IT administrator for a one-time code that allows them to manually turn off WARP and connect to a portal.
- For employees who travel, disable Lock WARP switch and set an Auto connect duration. This allows the user to manually turn off WARP without contacting IT.

## How captive portal detection works

If WARP cannot establish a connection to Cloudflare, it will:

1. Start the captive portal timer.
2. Send a series of requests to the Cloudflare captive portal URLs and other OS and browser-specific captive portal URLs. These requests are sent outside of the WARP tunnel.
3. If a request is intercepted, WARP assumes the network is behind a captive portal and fully opens the system firewall. While the firewall is open, all device traffic will bypass WARP.
4. Re-enable the firewall after the user successfully connects to the portal or after the timeout period expires.

## Limitations

- Due to how captive portal detection works, it may be possible for an employee to spoof a captive portal in order to turn off WARP.
- Some captive portals, particularly those on airlines, may be slow to respond and exceed the captive portal detection timeout. Users will likely see a CF_CAPTIVE_PORTAL_TIMED_OUT error when they try to connect. For context on the steps leading up to these errors, refer to Connectivity status.
- WARP may not be able to detect multi-stage captive portals, which redirect the user to different networks during the login process. Users will need to manually turn off WARP to get through the captive portal.
- Some public Wi-Fi networks are incompatible with running WARP:

Captive portals that intercept all DNS traffic will block WARP's DoH connection. Users will likely see a CF_NO_NETWORK error after they login to the captive portal.
Captive portals that only allow HTTPS traffic will block WARP's Wireguard UDP connection. Users will likely see a CF_HAPPY_EYEBALLS_MITM_FAILURE error after they login to the captive portal.
- Captive portals that intercept all DNS traffic will block WARP's DoH connection. Users will likely see a CF_NO_NETWORK error after they login to the captive portal.
- Captive portals that only allow HTTPS traffic will block WARP's Wireguard UDP connection. Users will likely see a CF_HAPPY_EYEBALLS_MITM_FAILURE error after they login to the captive portal.

## Get captive portal logs Beta

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| All modes | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2025.4.589.1 |
| macOS | ‚úÖ | 2025.4.589.1 |
| Linux | ‚ùå |  |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

Captive portal logs are used by Cloudflare Support to troubleshoot WARP captive portal issues. When an end user reports an issue with a captive portal, the IT administrator can ask the user to collect captive portal logs on their device. The administrator can then attach the logs to a Cloudflare Support ticket.

To get captive portal logs:

1. Open the WARP client.
2. Go to Settings (gear icon) > Preferences > Advanced.
3. Select Collect Captive Portal Diag.
4. The WARP client will ask if the device is connected (or attempting to connect) to the Wi-Fi network that is causing issues. Select Yes to confirm.

Once the diagnostic finishes running, WARP will place a warp-captive-portal-diag-<date>-<time>.zip file on the user's desktop. The end user can now share this file with their IT administrator.

## Related resources

- Connectivity status - Learn about the status messages displayed by the WARP client during its connection process, and understand each stage as WARP establishes a secure tunnel to Cloudflare.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Managed networks

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/managed-networks/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/managed-networks/)

Page options # Managed networks

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| All modes | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2025.1.861.0 |
| macOS | ‚úÖ | 2025.1.861.0 |
| Linux | ‚úÖ | 2025.1.861.0 |
| iOS | ‚úÖ | 1.0 |
| Android | ‚úÖ | 1.0 |
| ChromeOS | ‚úÖ | 1.0 |

Cloudflare WARP allows you to selectively apply specific device profiles and WARP client settings when a device connects to a secure network location, such as an office. WARP identifies these managed networks by detecting a TLS endpoint you set up on the network.

On this page, you will learn how to:

- Create a TLS endpoint on your trusted network.
- Configure the TLS endpoint in Zero Trust to set up a managed network.
- Apply the appropriate device profile to a device when the WARP client detects it is on your managed network.

## Requirements

- The WARP client scans all managed networks every time it detects a network change event from the operating system. To minimize performance impact, reuse the same TLS endpoint across multiple locations unless you require distinct settings profiles for each location.
- Ensure that the device can only reach one managed network at any given time. If multiple managed networks are configured and reachable, there is no way to determine which settings profile the device will receive.

## WARP client managed network detection

When you configure a managed network, the WARP client uses the TLS endpoint to determine whether the device is on that network.

The time it takes to apply the correct device profile depends on how quickly the TLS endpoint responds.

If the TLS endpoint times out after 5 seconds, the WARP client will determine that the device is not on a managed network and will apply the default device profile. The WARP client only retries detection if a non-timeout error occurs. A timeout triggers fallback to the default device profile without further retries.

## 1. Choose a TLS endpoint

A TLS endpoint is a host on your network that serves a TLS certificate. The TLS endpoint acts like a network location beacon ‚Äî when a device connects to a network, the WARP client on the device detects the TLS endpoint and validates the TLS certificate against the SHA-256 fingerprint (if specified) or against the local certificate store to check that it is signed by a public certificate authority.

The TLS certificate can be hosted by any device on your network. However, the endpoint must be inaccessible to users outside of the network location. WARP will automatically exclude the managed network endpoint from all device profiles to ensure that users cannot connect to this endpoint over Cloudflare Tunnel. We recommend choosing a host that is physically in the office which remote users do not need to access, such as a printer.

### Create a new TLS endpoint

If you do not already have a TLS endpoint on your network, you can set one up as follows:

1. Generate a TLS certificate:
Terminal windowopenssl req -x509 -newkey rsa:4096 -sha256 -days 3650 -nodes -keyout example.key -out example.pem -subj "/CN=example.com" -addext "subjectAltName=DNS:example.com"
The command will output a certificate in PEM format and its private key. Store these files in a secure place.
NoteThe WARP client requires certificates to include CN and subjectAltName metadata. You can use example.com or any other domain.
2. Configure an HTTPS server on your network to use this certificate and key. The example below demonstrates how to serve the TLS certificate from an nginx container in Docker:
a. Create an nginx configuration file called nginx.conf:
events {worker_connections  1024;}
http {    server {      listen              443 ssl;      ssl_certificate     /certs/example.pem;      ssl_certificate_key /certs/example.key;      location / {            return 200;      }    }}
If needed, replace /certs/example.pem and /certs/example.key with the locations of your certificate and key.
b. Add the nginx image to your Docker compose file:
version: "3.3"services:nginx:  image: nginx:latest  ports:    - 3333:443  volumes:    - ./nginx.conf:/etc/nginx/nginx.conf:ro    - ./certs:/certs:ro
If needed, replace ./nginx.conf and ./certs with the locations of your nginx configuration file and certificate.
c. Start the server:
Terminal windowdocker-compose up -d
3. To test that the TLS server is working, run a curl command from the end user's device:
Terminal windowcurl --verbose --insecure https://<private-server-IP>:3333/
You need to pass the --insecure option because we are using a self-signed certificate. If the device is connected to the network, the request should return a 200 status code.

Windows IIS

To create a TLS endpoint using Windows Internet Information Services (IIS) Manager:

1. Run Powershell as administrator.
2. Generate a self-signed certificate:
PowerShellNew-SelfSignedCertificate -CertStoreLocation Cert:\LocalMachine\My -DnsName "office-name.example.internal" -FriendlyName "Cloudflare Managed Network Certificate" -NotAfter (Get-Date).AddYears(10)
  PSParentPath: Microsoft.PowerShell.Security\Certificate::LocalMachine\My
Thumbprint                                Subject----------                                -------0660C4FCD15F69C49BD080FEEA4136B3D302B41B  CN=office-name.example.internal
3. Extract the certificate's SHA-256 fingerprint:
PowerShell[System.BitConverter]::ToString([System.Security.Cryptography.SHA256]::Create().ComputeHash((Get-ChildItem Cert:\LocalMachine\My | Where-Object { $_.FriendlyName -eq "Cloudflare Managed Network Certificate" }).RawData)) -replace "-", ""
DD4F4806C57A5BBAF1AA5B080F0541DA75DB468D0A1FE731310149500CCD8662
You will need the SHA-256 fingerprint to configure the managed network in Zero Trust. Do not use the default SHA-1 thumbprint generated by the New-SelfSignedCertificate command.
4. Open IIS Manager.
5. In the Connections pane, right-click the Sites node and select Add Website.
6. In Site name, enter any name for the TLS server (for example, Managed Network Server).
7. In Physical path, enter any directory that contains a .htm or html file, such as C:\inetpub\wwwroot. Cloudflare does not validate the content within the directory.
8. Under Binding, configure the following fields:

Type: https
IP address: All Unassigned
Port: 443
Host name: Enter the certificate's Common Name (CN). The CN of our example certificate is office-name.example.internal.
Require Server Name Indication: Enabled
SSL certificate: Select the name of your TLS certificate. Our example certificate is called Cloudflare Managed Network Certificate.
9. Type: https
10. IP address: All Unassigned
11. Port: 443
12. Host name: Enter the certificate's Common Name (CN). The CN of our example certificate is office-name.example.internal.
13. Require Server Name Indication: Enabled
14. SSL certificate: Select the name of your TLS certificate. Our example certificate is called Cloudflare Managed Network Certificate.
15. To test that the TLS server is working, run a curl command from the end user's device:
Terminal windowcurl --verbose --insecure --resolve office-name.example.internal:443:<private-server-IP> https://office-name.example.internal
You need to pass the --insecure option because we are using a self-signed certificate. The --resolve option allows you to connect to the server's private IP but also pass the hostname to the server for SNI and certificate validation. If the device is connected to the network, the request should return your directory's default homepage (C:\inetpub\wwwroot\iisstart.htm).

### Supported cipher suites

The WARP client establishes a TLS connection using Rustls ‚Üó. Make sure your TLS endpoint accepts one of the cipher suites supported by Rustls ‚Üó.

## 2. Extract the SHA-256 fingerprint

The SHA-256 fingerprint is only required if your TLS endpoint uses a self-signed certificate.

- Local certificate
- Remote server

To obtain the SHA-256 fingerprint of a local certificate:

Terminal window ```
openssl x509 -noout -fingerprint -sha256 -inform pem -in example.pem | tr -d :
```

The output will look something like:

```
SHA256 Fingerprint=DD4F4806C57A5BBAF1AA5B080F0541DA75DB468D0A1FE731310149500CCD8662
```

To test connectivity and obtain the SHA-256 fingerprint of a remote server:

Terminal window ```
openssl s_client -connect <private-server-IP>:443 < /dev/null 2> /dev/null | openssl x509 -noout -fingerprint -sha256 | tr -d :
```

The output will look something like:

```
SHA256 Fingerprint=DD4F4806C57A5BBAF1AA5B080F0541DA75DB468D0A1FE731310149500CCD8662
```

## 3. Add managed network to Zero Trust

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to Network locations and select Add new.
3. Name your network location.
4. In Host and Port, enter the private IP address and port number of your TLS endpoint (for example, 192.168.185.198:3333).
NoteWe recommend using the private IP of your managed network endpoint and not a hostname to prevent issues related to DNS lookups resolving the incorrect IP.
5. (Optional) In TLS Cert SHA-256, enter the SHA-256 fingerprint of the TLS certificate. This field is only needed for self-signed certificates. If a TLS fingerprint is not supplied, WARP validates the certificate against the local certificate store and checks that it is signed by a public certificate authority.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Add a managed network using the cloudflare_zero_trust_device_managed_network ‚Üó resource:
resource "cloudflare_zero_trust_device_managed_networks" "office" {  account_id = var.cloudflare_account_id  name       = "Office managed network"  type       = "tls"  config = {    tls_sockaddr = "192.168.185.198:3333"    sha256       = "DD4F4806C57A5BBAF1AA5B080F0541DA75DB468D0A1FE731310149500CCD8662"  }}

WARP will automatically exclude the TLS endpoint from all device profiles if it is specified as a private IP address. This exclusion prevents remote users from accessing the endpoint through the WARP tunnel on any port. If the TLS endpoint is specified as a hostname instead of a private IP, WARP will not automatically exclude it.

If a device profile uses Split Tunnels in Include mode, ensure that the Split Tunnel entries do not contain the TLS endpoint IP address; otherwise, the entire IP range will be excluded from the WARP tunnel.

## 4. Configure device profile

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Under Profile settings, create a new settings profile or edit an existing profile.
3. To apply this profile whenever a device connects to your network, add the following rule:















SelectorOperatorValueManaged networkis<NETWORK-NAME>
4. Save the profile.

In cloudflare_zero_trust_device_custom_profile ‚Üó, configure a match expression using the network selector. For example, the following device profile will match all devices connected a specific managed network:

```
resource "cloudflare_zero_trust_device_custom_profile" "office" {  account_id            = var.cloudflare_account_id  name                  = "Office"  description           = "Devices connected to the office network"  precedence            = 1  service_mode_v2       = {mode = "warp"}
  match = trimspace(replace(<<-EOT    network == "${cloudflare_zero_trust_device_managed_networks.office.name}"  EOT  , "\n", " "))}
```

Managed networks are now enabled. Every time a device in your organization connects to a network (for example, when waking up the device or changing Wi-Fi networks), the WARP client will determine its network location and apply the corresponding settings profile.

## 5. Verify managed network

To check if the WARP client detects the network location:

1. Turn on WARP.
2. Disconnect and reconnect to the network.
3. Open a terminal and run warp-cli debug alternate-network.

## Related resources

- Device profiles - How to create and manage the device profiles you apply via managed networks.
- WARP settings - Defines how WARP behaves and what users can do.
- WARP troubleshooting guide - Troubleshoot common WARP issues.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Route traffic

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/route-traffic/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/route-traffic/)

Page options # Route traffic

When the WARP client is deployed on a device, Cloudflare will process all DNS queries and network traffic by default. However, under certain circumstances, you may need to exclude specific DNS queries or network traffic from WARP. For example, you may need to resolve an internal hostname with a private DNS resolver instead of Cloudflare's public DNS resolver.

Cloudflare recommends Enterprise users configure Gateway resolver policies to resolve traffic with custom resolvers. WARP will send private DNS queries to Gateway, then Gateway will send the queries to custom resolvers based on matching policies.

Additionally, there are three options you can configure to exclude traffic from WARP:

- Local Domain Fallback: Use Local Domain Fallback to instruct the WARP client to proxy DNS requests for a specified domain to a resolver that is not Cloudflare Gateway. This is useful when you have private hostnames that would not otherwise resolve on the public Internet.
WarningGateway will not encrypt, monitor, or apply DNS policies to DNS queries to domain names entered in Local Domain Fallback.
- Split Tunnels Exclude mode: Use Exclude mode to instruct the WARP client to ignore traffic to a specified set of IP addresses or domains. Any traffic that is destined to an IP address or domain defined in the Split Tunnels Exclude configuration will be ignored by the WARP client and handled by the local machine. Use this mode when you want the majority of your traffic encrypted and processed by Gateway, but need to exclude certain routes due to app compatibility, or if you need WARP to run alongside a VPN.
- Split Tunnels Include mode: Use Include mode to instruct the WARP client to only handle traffic to a specified set of IP addresses or domains. Any traffic that is not included by an IP address or domain defined in the Split Tunnel Include configuration will be ignored by the WARP client and handled by the local machine. Use this mode when you only want specific traffic processed by Gateway, such as when using Tunnels for a specific resource.
WarningGateway will not encrypt, manage, or monitor traffic excluded from WARP by a Split Tunnel configuration.

## How the WARP client handles DNS requests

When you use the WARP client together with cloudflared Tunnels or third-party VPNs, Cloudflare evaluates each request and routes it according to the following traffic flow:

```
flowchart TD
    A["WARP user requests resource"] --> B["WARP client proxies all DNS traffic"]
    B -- WARP checks if domain is listed in Local Domain Fallback policies --> C["Local Domain Fallback"]

    %% Left branch (LDF exists)
    C -- Domain exists in Local Domain Fallback policies --> ST["Split Tunnel processing"]

    ST -- Resolver IP included in WARP Tunnel per Split Tunnel configuration --> QW["Query sent via WARP Tunnel to be resolved"]
    ST -- Resolver IP not included in WARP Tunnel per Split Tunnel configuration --> QO["Query sent to resolver IP outside WARP Tunnel"]

    QW -- Allowed by Gateway --> OR["Evaluated by Cloudflare on-ramp routes"]
    OR -- Onramp routes do not include resolver IP --> GP["Gateway proxies query to resolver IP via normal WARP egress route"]
    OR -- Onramp routes include, resolver IP --> ADV["Cloudflare onramps advertises route that includes Resolver IP"]
    ADV --> PR["Private resolver returns IP address to WARP client"]

    %% Right branch (no LDF match)
    C -- Domain does not exist in Local Domain Fallback policies --> GWR["Gateway checks Resolver Policies (Enterprise only)"]

    GWR -- Resolver policy is not matched --> C1111a["1.1.1.1"]

    GWR -- Resolver policy is matched --> IDNS["Internal DNS"]
    GWR -- Resolver policy is matched --> C1111b["1.1.1.1"]
    GWR -- Resolver policy is matched --> CUST["Custom resolver"]
    CUST --> PNS["Private network services<br>(Cloudflare Tunnel, Magic WAN, WARP Connector)"]
```

#### Terms mentioned

#### On-ramps (how traffic gets onto Cloudflare)

- On-ramp
- Cloudflare Tunnel
- WARP Connector
- Magic WAN

#### Routing features (how queries are handled)

- Local Domain Fallback
- Split Tunnels
- Gateway Resolver Policies

#### Resolvers (where queries are resolved)

- Internal DNS
- 1.1.1.1

## Add a DNS suffix

Support for DNS suffix search lists in WARP is currently in development. You can manually configure DNS suffixes at the device level using the following instructions.

### macOS

To manually configure a DNS suffix on macOS:

1. Open System Settings (or System Preferences on older macOS versions).
2. Go to Network and select your active connection (Wi-Fi or Ethernet).
3. Select Details (or Advanced).
4. Go to the DNS tab.
5. Under Search Domains, select the + button and add your DNS suffix.
6. Select OK, then Apply.

### Windows

To manually configure a DNS suffix on Windows:

1. Open the Search bar in Windows, type View network connections, and select Open.
2. Right-click the network adapter (Wi-Fi or Ethernet) you want to modify and select Properties. (Admin privileges required.)
3. Double-click Internet Protocol Version 4 (TCP/IPv4).
4. In the Internet Protocol (TCP/IP) Properties window, select Advanced.
5. Go to the DNS tab.
6. Select Append these DNS suffixes (in order).
7. Select Add, enter your DNS suffix and select Add.
8. Select OK on all windows to apply changes.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Local Domain Fallback

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/route-traffic/local-domains/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/route-traffic/local-domains/)

Page options # Local Domain Fallback

By default, Cloudflare Zero Trust excludes common top-level domains, used for local resolution, from being sent to Gateway for processing. These top-level domains are resolved by the local DNS resolver configured for the device on its primary interface.

You can add additional domains to the Local Domain Fallback list and specify a DNS server to use in place of the Gateway resolver. The WARP client proxies these requests directly to the configured fallback servers.

## Limitations

Local Domain Fallback only applies to devices running the WARP client.

Because DNS requests subject to Local Domain Fallback bypass the Gateway resolver, they are not subject to Gateway DNS policies or DNS logging. If you want to route DNS queries to custom resolvers and apply Gateway filtering, use resolver policies. If both Local Domain Fallback and resolver policies are configured for the same device, Cloudflare will apply client-side Local Domain Fallback rules first.

Local Domain Fallback or Gateway Resolver policies?

If your DNS server can be configured to connect to a Cloudflare on-ramp, Cloudflare recommends using Gateway Resolver policies rather than Local Domain Fallback. Gateway Resolver policies provide more visibility by allowing you to log and review DNS traffic.

### AWS

Avoid configuring your Local Domain Fallback or Resolver Policy to direct all *.amazonaws.com DNS resolution via AWS Route 53 Resolver.

Some AWS endpoints (such as ssm.us-east-1.amazonaws.com) are public AWS endpoints that are not resolvable via internal VPC resolution. This can break AWS Console features for users on WARP.

Only route specific Route 53 zones, or VPC Endpoints (such as vpce.amazonaws.com), through the internal VPC resolver.

## Manage local domains

### View domains

To view the domains subject to Local Domain Fallback:

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Under Device settings, locate the device profile you would like to view or modify and select Configure.
3. Scroll down to Local Domain Fallback and select Manage.

On this page, you will see a list of domains excluded from Gateway. You can add or remove domains from the list at any time.

Warning

Local Domain Fallback configuration only impacts where DNS requests get resolved, not the flow of traffic destined to those domains. If you want to prevent traffic from being sent to a specific domain or IP address, you must add those domains or IPs to your Split Tunnel configuration.

### Add a domain

To add a domain to the Local Domain Fallback list:

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Under Device settings, locate the device profile you would like to view or modify and select Configure.
3. Scroll down to Local Domain Fallback and select Manage.

1. In Domain, enter the apex domain (example.com) that you want to resolve using your private DNS server. All prefixes under the apex domain are subject to Local Domain Fallback (in other words, example.com is interpreted as *.example.com).
2. In DNS Servers, enter the IP address of the DNS servers that should resolve that domain name.
3. Enter an optional description and select Save domain.

A Local Domain Fallback list is scoped to a specific device profile. If a device profile does not have a corresponding Local Domain Fallback resource, those devices will use the default local domains shown in Step 2.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. (Optional) Create a list of domains that you can reuse across multiple device profiles. For example, you can declare a local value in the same module as your device profiles:
local-domains.local.tflocals {  default_local_domains = [    # Default Local Domain Fallback entries recommended by Cloudflare    {  suffix = "corp"},{  suffix = "domain"},{  suffix = "home"},{  suffix = "home.arpa"},{  suffix = "host"},{  suffix = "internal"},{  suffix = "intranet"},{  suffix = "invalid"},{  suffix = "lan"},{  suffix = "local"},{  suffix = "localdomain"},{  suffix = "localhost"},{  suffix = "private"},{  suffix = "test"}  ]}
4. To configure Local Domain Fallback for the default device profile, use the cloudflare_zero_trust_device_default_profile_local_domain_fallback ‚Üó resource. To configure Local Domain Fallback for a custom device profile, usecloudflare_zero_trust_device_custom_profile_local_domain_fallback ‚Üó. For example:
device-profiles.tfresource "cloudflare_zero_trust_device_custom_profile_local_domain_fallback" "example" {  account_id = var.cloudflare_account_id  policy_id  = cloudflare_zero_trust_device_custom_profile.example.id  domains = concat(    # Global entries    local.default_local_domains,
    # Profile-specific entries    [      {      suffix = "example.com"      description = "Domain for local development"      dns_server = ["1.1.1.1", "192.168.0.1"]      }    ]  )}

For suffix, specify the apex domain (example.com) that you want to resolve using your private DNS server. All prefixes under the apex domain are subject to Local Domain Fallback (in other words, example.com is interpreted as *.example.com). For dns_server, enter the IP address of the DNS servers that should resolve that domain name.

WARP tries all servers and always uses the fastest response, even if that response is no records found. We recommend specifying at least one DNS server for each domain. If a value is not specified, the WARP client will try to identify the DNS server (or servers) used on the device before it started, and use that server for each domain in the Local Domain Fallback list.

### Route traffic to fallback server

The WARP client routes DNS traffic to your Local Domain Fallback server according to your Split Tunnel configuration. To ensure that queries can reach your private DNS server:

- If your DNS server is only reachable inside of the WARP tunnel (for example, via cloudflared or Magic WAN):


Go to Networks > Routes and verify that the DNS server is connected to Cloudflare. To connect a DNS server, refer to Private networks.


In your Split Tunnel configuration, verify that the DNS server IP routes through the WARP tunnel.
- Go to Networks > Routes and verify that the DNS server is connected to Cloudflare. To connect a DNS server, refer to Private networks.
- In your Split Tunnel configuration, verify that the DNS server IP routes through the WARP tunnel.
- If your DNS server is only reachable outside of the WARP tunnel (for example, via a third-party VPN), verify that the DNS server IP is excluded from the WARP tunnel.

For more information, refer to How the WARP client handles DNS requests.

### Delete a domain

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Under Device settings, locate the device profile you would like to view or modify and select Configure.
3. Scroll down to Local Domain Fallback and select Manage.

1. Find the domain in the list and select Delete.

The domain will no longer be excluded from Gateway DNS policies, effective immediately.

## Related resources

- Split Tunnels - Control which traffic goes through WARP by including or excluding specific IPs or domains.
- WARP with firewall - Learn which IPs, domains, and ports to allow so users can deploy and connect WARP successfully behind a firewall.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Split Tunnels

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/route-traffic/split-tunnels/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/route-traffic/split-tunnels/)

Page options # Split Tunnels

Split Tunnels can be configured to exclude or include IP addresses or domains from going through WARP. This feature is commonly used to run WARP alongside a VPN (in Exclude mode) or to provide access to a specific private network (in Include mode).

Warning

Split Tunnels only impacts the flow of IP traffic. DNS requests are still resolved by Gateway and subject to DNS policies unless you add the domains to your Local Domain Fallback configuration.

Because Split Tunnels controls what Gateway has visibility on at the network level, we recommend testing all changes before rolling out updates to end users.

## Change Split Tunnels mode

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Under Device settings, locate the device profile you would like to modify and select Configure.
3. Scroll down to Split Tunnels.
4. (Optional) To view your existing Split Tunnel configuration, select Manage. You will see a list of the IPs and domains Cloudflare Zero Trust excludes or includes, depending on the mode you have selected. We recommend making a copy of your Split Tunnel entries, as they will revert to the default upon switching modes.
5. Under Split Tunnels, choose a mode:

Exclude IPs and domains ‚Äî (Default) All traffic will be sent to Cloudflare Gateway except for the IPs and domains you specify.
Include IPs and Domains ‚Äî Only traffic destined to the IPs or domains you specify will be sent to Cloudflare Gateway. All other traffic will bypass Gateway and will no longer be filtered by your network or HTTP policies. In order to use certain features, you will need to manually add Zero Trust domains.
6. Exclude IPs and domains ‚Äî (Default) All traffic will be sent to Cloudflare Gateway except for the IPs and domains you specify.
7. Include IPs and Domains ‚Äî Only traffic destined to the IPs or domains you specify will be sent to Cloudflare Gateway. All other traffic will bypass Gateway and will no longer be filtered by your network or HTTP policies. In order to use certain features, you will need to manually add Zero Trust domains.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Choose a cloudflare_zero_trust_device_default_profile ‚Üó or cloudflare_zero_trust_device_custom_profile ‚Üó resource to modify, or create a new device profile.
4. In your device profile, configure either the exclude or include argument. You cannot set both exclude and include in a given device profile.
a. To manage Split Tunnel routes in Exclude mode, use the exclude argument:
resource "cloudflare_zero_trust_device_custom_profile" "exclude_example" {  account_id            = var.cloudflare_account_id  name                  = "Custom profile in Split Tunnels Exclude mode"  enabled               = true  precedence            = 101  service_mode_v2       = {mode = "warp"}  match                 =  "identity.email == \"test@cloudflare.com\""
  exclude = [{      address = "10.0.0.0/8"      description = "Example route to exclude from WARP tunnel"  }]}
In this example, all traffic will be sent to Cloudflare Gateway except for traffic destined to 10.0.0.0/8. To exclude the default IPs and domains recommended by Cloudflare, refer to Add a route.
b. To manage Split Tunnel routes in Include mode, use the include argument:
resource "cloudflare_zero_trust_device_custom_profile" "include_example" {  account_id            = var.cloudflare_account_id  name                  = "Custom profile in Split Tunnels Include mode"  enabled               = true  precedence            = 101  service_mode_v2       = {mode = "warp"}  match                 =  "identity.email == \"test@cloudflare.com\""
  include = [{      address = "10.0.0.0/8"      description = "Example route to include in WARP tunnel"  }]}
In this example, only traffic destined to 10.0.0.0/8 will be sent to Cloudflare Gateway.

All clients with this device profile will now switch to the new mode and its default route configuration. Next, add or remove routes from your Split Tunnel configuration.

## Add a route

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Under Device settings, locate the device profile you would like to modify and select Configure.
3. Under Split Tunnels, check whether your Split Tunnels mode is set to Exclude or Include.
4. Select Manage.
5. You can exclude or include routes based on either their IP address or domain. When possible we recommend adding an IP address instead of a domain. To learn about the consequences of adding a domain, refer to Domain-based Split Tunnels.
      Add an IP     Add a domain      To add an IP address to Split Tunnels:
Select IP Address.
Enter the IP address or CIDR you want to exclude or include.
Select Save destination.
Traffic to this IP address is now excluded or included from the WARP tunnel.  To add a domain to Split Tunnels:
Select Domain.
Enter a valid domain to exclude or include.
Select Save destination.
(Optional) If your domain does not have a public DNS record, create a Local Domain Fallback entry to allow a private DNS server to handle domain resolution.
When a user goes to the domain, the domain gets resolved according to your Local Domain Fallback configuration (either by Gateway or by your private DNS server). WARP Split Tunnels will then dynamically include or exclude the IP address returned in the DNS lookup.
6. Add an IP
7. Add a domain
8. Select IP Address.
9. Enter the IP address or CIDR you want to exclude or include.
10. Select Save destination.
11. Select Domain.
12. Enter a valid domain to exclude or include.
13. Select Save destination.
14. (Optional) If your domain does not have a public DNS record, create a Local Domain Fallback entry to allow a private DNS server to handle domain resolution.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Choose a cloudflare_zero_trust_device_default_profile ‚Üó or cloudflare_zero_trust_device_custom_profile ‚Üó resource to modify, or create a new device profile.
4. (Optional) Create a list of split tunnel routes that you can reuse across multiple device profiles. For example, you can declare a local value in the same module as your device profiles:
split-tunnels.local.tflocals {  global_exclude_list = [    # Default Split Tunnel entries recommended by Cloudflare    {      address     = "ff05::/16"    },    {      address     = "ff04::/16"    },    {      address     = "ff03::/16"    },    {      address     = "ff02::/16"    },    {      address     = "ff01::/16"    },    {      address     = "fe80::/10"      description = "IPv6 Link Local"    },    {      address     = "fd00::/8"    },    {      address     = "255.255.255.255/32"      description = "DHCP Broadcast"    },    {      address     = "240.0.0.0/4"    },    {      address     = "224.0.0.0/24"    },    {      address     = "192.168.0.0/16"    },    {      address     = "192.0.0.0/24"    },    {      address     = "172.16.0.0/12"    },    {      address     = "169.254.0.0/16"      description = "DHCP Unspecified"    },    {      address     = "100.64.0.0/10"    },    {      address     = "10.0.0.0/8"    }  ]}
5. In the device profile, exclude or include routes based on either their IP address or domain:
device-profiles.tfresource "cloudflare_zero_trust_device_custom_profile" "example" {  account_id            = var.cloudflare_account_id  name                  = "Example custom profile with split tunnels"  enabled               = true  precedence            = 101  service_mode_v2       = {mode = "warp"}  match                 =  "identity.email == \"test@cloudflare.com\""
  exclude = concat(    # Global entries    local.global_exclude_list,
    # Profile-specific entries    [      {        address = "192.0.2.0/24"        description = "Example IP to exclude from WARP"      },      {        host = "example.com"        description = "Example domain to exclude from WARP"      }    ]  )}
When possible we recommend adding an IP address instead of a domain. To learn about the consequences of adding a domain, refer to Domain-based Split Tunnels.

It may take up to 10 minutes for newly updated settings to propagate to devices.

We recommend keeping the Split Tunnels list short, as each entry takes time for the client to parse. In particular, domains are slower to action than IP addresses because they require on-the-fly IP lookups and routing table / local firewall changes. A shorter list will also make it easier to understand and debug your configuration. For information on device profile limits, refer to Account limits.

### When to use Split Tunnels

Use Split Tunnels when you need to bypass Gateway entirely for a site or allow traffic through the firewall that WARP creates. Common scenarios include:

- Connect to a third-party application which requires the actual IP address of the end-user device (for example, Microsoft 365).
- Optimize voice and video.
- Connect to a third-party VPN endpoint.

### When not to use Split Tunnels

Do not exclude a site from Split Tunnels if you want to see the traffic in your Gateway logs. In particular, we do not recommend using Split Tunnels to:

- Solve connectivity issues with a specific website. For configuration guidance, refer to our troubleshooting guide.
- Solve performance issues with a specific website. Since Cloudflare operates within 50 milliseconds of 95% of the Internet-connected population, it is usually faster to send traffic through us. If you are encountering a performance-related issue, it is best to first explore your Gateway policies or reach out to Support.

## Routes for Split Tunnels Include mode

Many Cloudflare Zero Trust services rely on traffic going through WARP, such as device posture checks and WARP session durations. If you are using Split Tunnels in Include mode, you will need to manually add Cloudflare Zero Trust domains and IPs in order for these features to function.

### Cloudflare Zero Trust domains

If you are using Split Tunnels in Include mode, you must include the following domains:

- The IdP used to authenticate to Cloudflare Zero Trust
- <your-team-name>.cloudflareaccess.com
- The application protected by the Access or Gateway policy
- edge.browser.run if using Browser Isolation

### Cloudflare Zero Trust IP addresses

#### Block page

If you are using Split Tunnels in Include mode and have DNS policies with the block page enabled, you must include the IPs that blocked domains will resolve to. Unless you are using a dedicated or BYOIP resolver IP the block page will resolve to:

- 162.159.36.12
- 162.159.46.12

#### Team domain

In Secure Web Gateway without DNS filtering WARP mode, you cannot add domains to Split Tunnels. If you are using Split Tunnels in Include mode, you must include the IPs that resolve to <your-team-name>.cloudflareaccess.com instead:

- 104.19.194.29
- 104.19.195.29

## Domain-based Split Tunnels

Domain-based split tunneling has a few ramifications you should be aware of before deploying in your organization:.

- Routes excluded or included from WARP and Gateway visibility may change day to day, and may be different for each user depending on where they are.
- You may inadvertently exclude or include additional hostnames that happen to share an IP address. This commonly occurs if you add a domain hosted by a CDN or large Internet provider such as Cloudflare, AWS, or Azure. For example, if you wanted to exclude a VPN hosted on AWS, do not add *.amazonaws.com as that will open up your devices to all traffic on AWS. Instead, add the specific VPN endpoint (*.cvpn-endpoint-<UUID>.prod.clientvpn.us-west-2.amazonaws.com).
- Most services are a collection of hostnames. Until Split Tunnels mode supports App Types, you will need to manually add all domains used by a particular app or service.
- WARP must handle the DNS lookup request for the domain. If a DNS result has been previously cached by the operating system or otherwise intercepted (for example, via your browser's secure DNS settings), the IP address will not be dynamically added to your Split Tunnel.

### Valid domains

| Split tunnel domain | Matches | Does not match |
| --- | --- | --- |
| example.com | exact match of example.com | subdomains such as www.example.com |
| example.example.com | exact match of example.example.com | example.com or subdomains such as www.example.example.com |
| *.example.com | subdomains such as www.example.com and sub2.sub1.example.com | example.com |

### Platform differences

Domain-based Split Tunnels work differently on mobile clients than on desktop clients. If both mobile and desktop clients will connect to your organization, it is recommended to use Split Tunnels based on IP addresses or CIDR, which work the same across all platforms.

#### Windows, Linux and macOS

Clients on these platforms work by dynamically inserting the IP address of the domain immediately after it is resolved into the routing table for split tunneling. This allows the desktop clients to support wildcard domain prefixes (for example, *.example.com), not just a singular domain (like example.com or www.example.com).

#### iOS, Android and ChromeOS

Due to platform differences, mobile clients can only apply Split Tunnels rules when the tunnel is initially started. This means:

- Domain-based Split Tunnels rules are created when the tunnel is established based on the IP address for that domain at that time. The route is refreshed each time the tunnel is established.
- Wildcard domain prefixes (for example, *.example.com) are supported only if they have valid wildcard DNS records. Other wildcard domains are not supported because the client is unable to match wildcard domains to hostnames when starting up the tunnel. Unsupported wildcard domain prefixes can still exist in your configuration, but they will be ignored on mobile platforms.

## Remove a route

Warning

Removing default Split Tunnel entries may cause users to lose Internet connectivity or block their access to local resources.

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Under Device settings, locate the device profile you would like to modify and select Configure.
3. Under Split Tunnels, select Manage.
4. Find the IP address or hostname in the list and select Delete.

It may take up to 10 minutes for newly updated settings to propagate to devices.

If you need to revert to the default Split Tunnel entries recommended by Cloudflare, select Restore default entries.

## Related resources

- Local Domain Fallback - Resolve selected domains via local DNS instead of Cloudflare Gateway.
- WARP with firewall - Learn which IPs, domains, and ports to allow so users can deploy and connect WARP successfully behind a firewall.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## WARP architecture

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/route-traffic/warp-architecture/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/route-traffic/warp-architecture/)

Page options # WARP architecture

This guide explains how the Cloudflare WARP client interacts with a device's operating system to route traffic in Gateway with WARP mode.

In Gateway with DoH mode, the IP traffic information does not apply. In Secure Web Gateway without DNS filtering mode, the DNS traffic information does not apply.

## WARP traffic flow

The WARP client allows organizations to have granular control over the applications an end user device can access. The client forwards DNS and network traffic from the device to Cloudflare's global network, where Zero Trust policies are applied in the cloud. On all operating systems, the WARP daemon maintains three connections between the device and Cloudflare:

| Connection | Protocol | Purpose |
| --- | --- | --- |
| WARP tunnel (via WireGuard or MASQUE) | UDP | Send IP packets to Gateway for network policy enforcement, HTTP policy enforcement, and private network access. |
| DoH ‚Üó | HTTPS | Send DNS requests to Gateway for DNS policy enforcement. The DoH connection is maintained inside of the WARP tunnel. |
| Device orchestration | HTTPS | Perform user registration, check device posture, apply WARP profile settings. |

```
flowchart LR
subgraph Device
W[WARP client] -.-> D
D[DNS proxy]
W -.-> V[Virtual interface]
end
subgraph Cloudflare
A[Zero Trust account]
subgraph Gateway
N[L3/L4 firewall]
G[DNS resolver]
end
end
W<--"Device
orchestration"-->A
subgraph tunnel["WARP tunnel"]
 ip@{ shape: text, label: "Network traffic" }
  dns@{ shape: text, label: "DNS traffic" }
end
V --- ip-->N
D --- dns-->G
N --> O[(Application)]
```

Your Split Tunnel configuration determines what IP traffic is sent down the WARP tunnel. Your Local Domain Fallback configuration determines which DNS requests are sent to Gateway via DoH. Traffic to the device orchestration API endpoint does not obey Split Tunnel rules since the connection always operates outside of the WARP tunnel.

Next, you will learn how WARP configures your operating system to apply your Local Domain Fallback and Split Tunnel routing rules. Implementation details differ between desktop and mobile clients.

## Windows, macOS, and Linux

The desktop client consists of two components: a service/daemon that handles all WARP functionality on your device, and a GUI wrapper that makes it easier for a user to interact with the daemon.

### DNS traffic

When you turn on WARP, WARP creates a local DNS proxy on the device and binds it to these IP addresses on port 53 (the port designated for DNS traffic):

- IPv4: 127.0.2.2 and 127.0.2.3
- IPv6:

macOS and Linux: fd01:db8:1111::2 and fd01:db8:1111::3
Windows: ::ffff:127.0.2.2
- macOS and Linux: fd01:db8:1111::2 and fd01:db8:1111::3
- Windows: ::ffff:127.0.2.2

WARP then configures the operating system to send all DNS requests to these IP addresses. All network interfaces on the device will now use this local DNS proxy for DNS resolution. In other words, all DNS traffic will now be handled by the WARP client.

Note

Browsers with DoH configured will bypass the local DNS proxy. You may need to disable DoH settings in the browser.

Based on your Local Domain Fallback configuration, WARP will either forward the request to Gateway for DNS policy enforcement or forward the request to your private DNS resolver.

- Requests to Gateway are sent over our DoH connection inside the WARP tunnel.
- Requests to your private DNS resolver are sent either inside or outside of the tunnel depending on your Split Tunnel configuration. For more information, refer to How the WARP client handles DNS requests.

```
flowchart LR
D{{DNS request}}-->L["Local DNS proxy <br> (127.0.2.2 and 127.0.2.3)"]-->R{In local domain fallback?}
R -- Yes --> F[Private DNS resolver]
R -- No --> G[Cloudflare Gateway]
```

You can verify that the operating system is using WARP's local DNS proxy:

- macOS
- Windows
- Linux

On macOS, open a terminal window and run scutil --dns. The DNS servers should be set to WARP's local DNS proxy IPs.

Terminal window ```
scutil --dns
```

```
DNS configuration (for scoped queries)resolver #1  search domain[0] : <DNS-SEARCH-DOMAIN>  nameserver[0] : 127.0.2.2  nameserver[1] : 127.0.2.3  if_index : 15 (en0)  flags    : Scoped, Request A records  reach    : 0x00030002 (Reachable,Local Address,Directly Reachable Address)resolver #2  nameserver[0] : 127.0.2.2  nameserver[1] : 127.0.2.3  nameserver[2] : fd01:db8:1111::2  nameserver[3] : fd01:db8:1111::3  if_index : 23 (utun3)  flags    : Scoped, Request A records, Request AAAA records  reach    : 0x00030002 (Reachable,Local Address,Directly Reachable Address)
```

On Windows, open a PowerShell window and run ipconfig. The DNS servers should be set to WARP's local DNS proxy IPs.

PowerShell ```
ipconfig
```

```
Windows IP Configuration
Unknown adapter CloudflareWARP:
   Connection-specific DNS Suffix  . :   Description . . . . . . . . . . . : Cloudflare WARP Interface Tunnel   Physical Address. . . . . . . . . :   DHCP Enabled. . . . . . . . . . . : No   Autoconfiguration Enabled . . . . : Yes   IPv6 Address. . . . . . . . . . . : 2606:4700:110:8f79:145:f180:fc4:8106(Preferred)   Link-local IPv6 Address . . . . . : fe80::83b:d647:4bed:d388%49(Preferred)   IPv4 Address. . . . . . . . . . . : 172.16.0.2(Preferred)   Subnet Mask . . . . . . . . . . . : 255.255.255.255   Default Gateway . . . . . . . . . :   DNS Servers . . . . . . . . . . . : 127.0.2.2                                       127.0.2.3   NetBIOS over Tcpip. . . . . . . . : Enabled
```

On Linux, check the /etc/resolv.conf file. The DNS servers should be set to WARP's local DNS proxy IPs.

Terminal window ```
cat /etc/resolv.conf
```

```
# This file was generated by cloudflare-warp.nameserver 127.0.2.2nameserver 127.0.2.3nameserver fd01:db8:1111::2nameserver fd01:db8:1111::3search <DNS-SEARCH-DOMAIN>options edns0options trust-ad
```

### IP traffic

When you turn on WARP, WARP makes three changes on the device to control if traffic is sent inside or outside of the WARP tunnel:

- Creates a virtual network interface.
- Modifies the operating system routing table according to your Split Tunnel rules.
- Modifies the operating system firewall according to your Split Tunnel rules.

```
flowchart LR
P{{IP packet}}-->R["OS routing table"]-->F["OS firewall"] --> S{Excluded from Split Tunnels?}
S -- Yes --> A[(Application)]
S -- No --> U["Virtual interface<br> (172.16.0.2)"] --> G[Cloudflare Gateway]
```

#### Virtual interface

Virtual interfaces allow the operating system to logically subdivide a physical interface, such as a network interface controller (NIC), into separate interfaces for the purposes of routing IP traffic. WARP's virtual interface is what maintains the WireGuard/MASQUE connection between the device and Cloudflare. By default, its IP address is hardcoded as 172.16.0.2. You can use Override local interface IP to assign unique IPs per device.

To view a list of all network interfaces on the operating system:

- macOS
- Windows
- Linux

On macOS, run ifconfig. When WARP is turned on, you will see a utun interface with IP address 172.16.0.2.

Terminal window ```
ifconfig
```

```
<redacted>utun3: flags=8051<UP,POINTOPOINT,RUNNING,MULTICAST> mtu 1280  inet 172.16.0.2 --> 172.16.0.2 netmask 0xffffffff  inet6 fe80::f6d4:88ff:fe82:6d9e%utun3 prefixlen 64 scopeid 0x17  inet6 2606:4700:110:8c7d:7369:7526:a59b:5636 prefixlen 128  nd6 options=201<PERFORMNUD,DAD>
```

On Windows, run ipconfig. When WARP is turned on, you will see an adapter called CloudflareWARP with IP address 172.16.0.2.

PowerShell ```
ipconfig
```

```
Windows IP Configuration
Unknown adapter CloudflareWARP:
   Connection-specific DNS Suffix  . :   Description . . . . . . . . . . . : Cloudflare WARP Interface Tunnel   Physical Address. . . . . . . . . :   DHCP Enabled. . . . . . . . . . . : No   Autoconfiguration Enabled . . . . : Yes   IPv6 Address. . . . . . . . . . . : 2606:4700:110:8f79:145:f180:fc4:8106(Preferred)   Link-local IPv6 Address . . . . . : fe80::83b:d647:4bed:d388%49(Preferred)   IPv4 Address. . . . . . . . . . . : 172.16.0.2(Preferred)   Subnet Mask . . . . . . . . . . . : 255.255.255.255   Default Gateway . . . . . . . . . :   DNS Servers . . . . . . . . . . . : 127.0.2.2                                       127.0.2.3   NetBIOS over Tcpip. . . . . . . . : Enabled
```

On Linux, run ifconfig or ip addr. When WARP is turned on, you will see a utun interface with IP address 172.16.0.2.

Terminal window ```
ip addr
```

```
<redacted>3: CloudflareWARP: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1280 qdisc mq state UNKNOWN group default qlen 500    link/none    inet 172.16.0.2/32 scope global CloudflareWARP       valid_lft forever preferred_lft forever    inet6 2606:4700:110:8a2e:a5f7:a8de:a1f9:919/128 scope global       valid_lft forever preferred_lft forever    inet6 fe80::117e:276b:8a79:c498/64 scope link stable-privacy       valid_lft forever preferred_lft forever
```

#### Routing table

WARP edits the system routing table to control what IP traffic goes to Gateway. The routing table indicates which network interface should handle packets to a particular IP address. By default, all traffic routes through WARP's virtual interface except for the IPs and domains on your Split Tunnel exclude list (which use the default interface on your device).

You can verify that the routing table matches your Split Tunnel rules:

- macOS
- Windows
- Linux

To view the entire routing table on macOS, run netstat -r.

You can also search the routing table for a domain or IP address. In this example, we see that traffic to google.com is sent through utun3, which is the WARP virtual interface on this device:

Terminal window ```
route get google.com
```

```
route to: lga25s81-in-f14.1e100.netdestination: 136.0.0.0       mask: 248.0.0.0  interface: utun3      flags: <UP,DONE,PRCLONING> recvpipe  sendpipe  ssthresh  rtt,msec    rttvar  hopcount      mtu     expire       0         0         0         0         0         0      1280         0
```

In contrast, this DHCP address is excluded from WARP and uses the default interface:

Terminal window ```
route get 169.254.0.0
```

```
route to: 169.254.0.0destination: 169.254.0.0       mask: 255.255.0.0  interface: en0      flags: <UP,DONE,CLONING,STATIC> recvpipe  sendpipe  ssthresh  rtt,msec    rttvar  hopcount      mtu     expire       0         0         0         0         0         0      1500   -210842
```

To view the entire routing table on Windows, run netstat -r.

You can also search the routing table for an IP address. In this example, we see that traffic to 1.1.1.1 is sent through the WARP virtual interface:

PowerShell ```
Find-NetRoute -RemoteIPAddress "1.1.1.1" | Select-Object InterfaceAlias -Last 1
```

```
InterfaceAlias--------------CloudflareWARP
```

In contrast, this DHCP address is excluded from WARP and uses the default interface:

PowerShell ```
Find-NetRoute -RemoteIPAddress "169.254.0.0" | Select-Object InterfaceAlias -Last 1
```

```
InterfaceAlias--------------Wi-Fi
```

To view the entire routing table on Linux, run ip -6 route show table all or ip -4 route show table all.

You can also search the routing table for an IP address. In this example, we see that traffic to 1.1.1.1 is sent through the WARP virtual interface:

Terminal window ```
ip route get 1.1.1.1
```

```
1.1.1.1 dev CloudflareWARP table 65743 src 172.16.0.2 uid 1000    cache
```

In contrast, this DHCP address is excluded from WARP and uses the default interface:

Terminal window ```
ip route get 169.254.0.0
```

```
169.254.0.0 dev ens18 src 172.24.8.6 uid 1000    cache
```

#### System firewall

WARP modifies the operating system firewall to enforce your Split Tunnel rules. This adds a layer of protection in case a service bypasses the routing table and tries to send traffic directly through another interface. For example, if traffic to 203.0.113.0 is supposed to be inspected by Gateway, we create a firewall rule that blocks 203.0.113.0 on all interfaces except for utun.

## iOS, Android, and ChromeOS

On iOS and Android/ChromeOS, the Cloudflare One Agent installs itself as a VPN client to capture and route all traffic. The app is built on the official VPN framework for iOS and Android. For more information, refer to Apple's NetworkExtension documentation ‚Üó and Google's Android developer documentation ‚Üó.

Note that ChromeOS runs the Android app in a virtual machine, rather than running a native Chrome app.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## WARP sessions

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-sessions/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-sessions/)

Page options # WARP sessions

Cloudflare Zero Trust enforces WARP client reauthentication on a per-application basis, unlike legacy VPNs which treat it as a global setting. You can configure WARP session timeouts for your Access applications or as part of your Gateway policies.

When a user goes to a protected application or website, Cloudflare checks their WARP session duration against the configured session timeout. If the session has expired, the user will be prompted to re-authenticate with the identity provider (IdP) used to enroll in the WARP client.

A user's WARP session duration resets to zero whenever they re-authenticate with the IdP, regardless of what triggered the authentication event.

## Prerequisites

Ensure that traffic can reach your IdP and <your-team-name>.cloudflareaccess.com through WARP.

## Configure WARP sessions in Gateway

You can enforce WARP session timeouts on any Gateway Network and HTTP policy that has an Allow action. If you do not specify a session timeout, the WARP session will be unlimited by default.

Session timeouts have no impact on Gateway DNS policies. DNS policies remain active even when a user needs to re-authenticate.

To configure a session timeout for a Gateway policy:

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to either Gateway > Firewall Policies. Choose either Network or HTTP.
2. Add a policy and select the Allow action. Alternatively, choose any existing Allow policy.
3. Under Step 4 - Configure policy settings, select Edit next to Enforce WARP client session duration.
4. Enter a session expiration time in 1h30m0s format and save.
5. Save the policy.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Choose a Network (l4) or HTTP (http) policy with an Allow action.
4. In the policy's rule_settings ‚Üó, use the check_session argument to enable and configure a session timeout:
resource "cloudflare_zero_trust_gateway_policy" "network_allow_wiki_IPs" {  name        = "Company Wiki Network policy"  enabled     = true  account_id  = var.cloudflare_account_id  description = "Managed by Terraform - Allow employees to access company wiki IPs."  precedence  = 103  action      = "allow"  filters     = ["l4"]  traffic     = "net.dst.ip in ${"$"}${cloudflare_zero_trust_list.wiki_IPs.id}"  identity    = "identity.email matches \".*@example.com\""
  rule_settings = {    check_session = {      enforce = true      duration = "1h30m0s"    }  }}

Session checks are now enabled for the application protected by this policy. Users can continue to reach applications outside of the policy definition.

Enforce a global timeout

To enforce a global reauthentication event, set each of your Network or HTTP policies to the same WARP session duration.

## Configure WARP sessions in Access Beta

You can allow users to log in to Access applications using their WARP session. WARP authentication is only supported for Access applications protected by Allow or Block policies.

To configure WARP sessions for Access applications:

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. In Device enrollment permissions, select Manage.
3. Go to the Login methods tab and enable WARP authentication identity.
4. Under Session duration, choose a session timeout value. This timeout will apply to all Access applications that have WARP authentication enabled.

Note

This timeout value does not apply to WARP session checks in Gateway policies.

1. (Optional) To enable WARP authentication by default for all existing and new applications, select Apply to all Access applications. You can override this default setting on a per-application basis when you create or modify an Access application.
2. Select Save.

Users can now authenticate once with WARP and have access to your Access applications for the configured period of time. The session timer resets when the user re-authenticates with the IdP used to enroll in WARP.

## Force user interaction with IdP

If the user has an active browser session with the IdP, WARP will use the existing browser cookies to re-authenticate and the user will not be prompted to re-enter their credentials. You can override this behavior to require explicit user interaction in the IdP.

### Supported IdPs

- Microsoft Entra ID

## Manually reauthenticate

To manually refresh your Cloudflare Access session and update your group information from your identity provider (IdP), go to the following URL in your browser and fill in your team name:

https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/refresh-identity

Reauthenticating resets your session duration and fetches the latest group information from the organization's IdP.

## Limitations

- Only one user per device ‚Äî If a device is already registered with User A, User B will not be able to log in on that device through the re-authentication flow. To switch the device registration to a different user, User A must first log out from Zero Trust (if Allow device to leave organization is enabled), or an admin can revoke the registration from My Team > Devices. User B can then properly enroll.
- Active connections are not terminated ‚Äî Active sessions such as SSH and RDP will remain connected beyond the timeout limit.
- Binding Cookie is not supported - WARP authentication will not work for Access applications that have the Binding Cookie enabled.

## Related resources

- Connectivity status - Learn about the status messages displayed by the WARP client during its connection process, and understand each stage as WARP establishes a secure tunnel to Cloudflare.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Troubleshoot WARP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/)

Page options # Troubleshoot WARP

- WARP troubleshooting guide
- Common issues
- Client errors
- WARP diagnostic logs
- Known limitations
- Connectivity status

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## WARP troubleshooting guide

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/troubleshooting-guide/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/troubleshooting-guide/)

Page options # WARP troubleshooting guide

This guide helps you diagnose and resolve common issues with the Cloudflare WARP client. It covers how to troubleshoot the WARP client on desktop operating systems, including Windows, macOS, and Linux.

1. Before you start: Prerequisites, permissions, version control, and WARP basics.
2. Collect logs: Through the dashboard (with DEX remote capture) or the command-line interface (CLI) (warp-diag).
3. Review logs: Status, settings, profile ID, split tunnel configuration, and other settings.
4. Fix common misconfigurations: Profile mismatch, split tunnel issues, managed network issues, user group mismatch.
5. File a support ticket: How to file a ticket after you have exhausted your troubleshooting options.

## 1. Before you start

### Prerequisites

- You must have completed the Zero Trust onboarding flow with a Zero Trust organization created.
- You must have the WARP client installed on an end user device.
- You must have a role that gives admin permission to access logs on the Cloudflare dashboard.

### Check your WARP version

Many troubleshooting issues are caused by outdated client versions. For the best performance and compatibility, administrators should check for new releases and update the WARP client before attempting to troubleshoot other issues.

After updating the WARP client, monitor the issue to see if it recurs. If the issue persists, continue with the troubleshooting guide.

Check the device's WARP version

Via the device:

1. Open the WARP GUI on the desktop.
2. Select the gear icon.
3. Select About WARP.

Via the Zero Trust dashboard:

1. Log into Zero Trust ‚Üó > go to My Team > Devices.
2. Select the device you want to investigate.
3. Find the device's WARP version under Client version in the side menu.

### WARP basics

Understand the WARP client‚Äôs architecture, installation paths, and modes to help you diagnose issues with greater accuracy.

Chapters

- Introduction and WARP GUI Basics  0s
- Consumer vs. Corporate WARP  57s
- Device Profiles Explained  1m35s
- WARP Operating Modes  2m12s
- Split Tunneling  3m44s
- Conclusion  4m56s

#### WARP architecture

The WARP client consists of:

- Graphical User Interface (GUI): Control panel that allows end users to view WARP's status and perform actions such as turning WARP on or off.
- WARP daemon (or service): Core background component responsible for establishing secure tunnels (using WireGuard or MASQUE) and handling all WARP functionality on your device.

Refer to WARP architecture for more information on how the WARP client interacts with a device's operating system to route traffic.

#### WARP installation details

The GUI and daemon (or service) have different names and are stored in the following locations:

Windows |  | Windows |
| --- | --- |
| Service / Daemon | C:\Program Files\Cloudflare\Cloudflare WARP\warp-svc.exe |
| GUI application | C:\Program Files\Cloudflare\Cloudflare WARP\Cloudflare WARP.exe |
| Logs Location | DaemonC:\ProgramData\Cloudflare\GUI LogsC:\Users\<USER>.WARP\AppData\Localor%LOCALAPPDATA%\Cloudflare |

macOS |  | macOS |
| --- | --- |
| Service / Daemon | /Applications/Cloudflare WARP.app/Contents/Resources/CloudflareWARP |
| GUI application | /Applications/Cloudflare WARP.app/Contents/MacOS/Cloudflare WARP |
| Logs Location | Daemon/Library/Application Support/Cloudflare/GUI Logs~/Library/Logs/Cloudflare/ |

Linux |  | Linux |
| --- | --- |
| Service / Daemon | /bin/warp-svc |
| GUI application | /bin/warp-taskbar |
| Logs Location | /var/log/cloudflare-warp//var/lib/cloudflare-warp |

Along with the WARP GUI and daemon, warp-cli and warp-diag are also installed on the machine and added to the system path for use from any terminal session.

warp-diag is a command-line diagnostics tool that collects logs, configuration details, and connectivity data from the WARP client to help troubleshoot issues.

warp-cli is the command-line interface (CLI) for managing and configuring the Cloudflare WARP client, allowing users to connect, disconnect, and adjust settings programmatically.

#### WARP modes

WARP operates in several modes, each with different traffic handling capabilities:

Each WARP mode offers a different set of Zero Trust features.

| WARP Mode | DNS Filtering | Network Filtering | HTTP Filtering | Service mode (displayed in warp-cli settings) |
| --- | --- | --- | --- | --- |
| Gateway with WARP (default) | ‚úÖ | ‚úÖ | ‚úÖ | WarpWithDnsOverHttps |
| Gateway with DoH | ‚úÖ | ‚ùå | ‚ùå | DnsOverHttps |
| Secure Web Gateway without DNS filtering | ‚ùå | ‚úÖ | ‚úÖ | TunnelOnly |
| Proxy mode | ‚ùå | ‚ùå | ‚úÖ | WarpProxy |
| Device Information Only | ‚ùå | ‚ùå | ‚ùå | PostureOnly |

## 2. Collect diagnostic logs

You can collect diagnostic logs in two ways: the Cloudflare dashboard or the warp-diag command-line interface (CLI).

### Option A: Collect logs via the Cloudflare dashboard

Collect WARP diagnostic logs remotely from the Zero Trust dashboard by using Digital Experience Monitoring's (DEX) remote captures.

#### Start a remote capture

Best practice

To troubleshoot effectively, Cloudflare recommends reproducing the issue and noting your timestamps immediately before collecting logs. Though recreating the issue may not be possible in all cases, reproducing the issue right before WARP diag collection or during the window that a packet capture (PCAP) is running will help you troubleshoot with greater visibility.

Refer to WARP log retention window to learn more.

Devices must be actively connected to the Internet for remote captures to run.

To capture data from a remote device:

1. In Zero Trust ‚Üó, go to DEX > Remote captures.
2. Select up to 10 devices that you want to run a capture on. Devices must be registered in your Zero Trust organization.
3. Configure the types of captures to run.

Packet captures (PCAP): Performs packet captures for traffic outside of the WARP tunnel (default network interface) and traffic inside of the WARP tunnel (WARP virtual interface).
WARP Diagnostics Logs: Generates a WARP diagnostic log of the past 96 hours. To include a routing test for all IPs and domains in your Split Tunnel configuration, select Test all routes.
NoteTest all routes will extend the time for diagnostics to run and may temporarily impact device performance during the test.
You must select WARP Diagnostic Logs. You can also choose to run a PCAP and reproduce the issue in the window the PCAP is running to gain further network insight. The scope of this troubleshooting covers only WARP diagnostic logs. If not choosing PCAPs, reproduce the issue right before running diagnostics.
4. Packet captures (PCAP): Performs packet captures for traffic outside of the WARP tunnel (default network interface) and traffic inside of the WARP tunnel (WARP virtual interface).
5. WARP Diagnostics Logs: Generates a WARP diagnostic log of the past 96 hours. To include a routing test for all IPs and domains in your Split Tunnel configuration, select Test all routes.
NoteTest all routes will extend the time for diagnostics to run and may temporarily impact device performance during the test.
You must select WARP Diagnostic Logs. You can also choose to run a PCAP and reproduce the issue in the window the PCAP is running to gain further network insight. The scope of this troubleshooting covers only WARP diagnostic logs. If not choosing PCAPs, reproduce the issue right before running diagnostics.
6. Select Run diagnostics.

DEX will now send capture requests to the configured devices. If the WARP client is disconnected, the capture will time out after 10 minutes.

#### Check remote capture status

To view a list of captures, go to DEX > Remote captures. The Status column displays one of the following options:

- Success: The capture is complete and ready for download. Any partially successful captures will still upload to Cloudflare. For example, there could be a scenario where the PCAP succeeds on the primary network interface but fails on the WARP tunnel interface. You can review PCAP results to determine which PCAPs succeeded or failed.
- Running: The capture is in progress on the device.
- Pending Upload: The capture is complete but not yet ready for download.
- Failed: The capture has either timed out or encountered an error. To retry the capture, check the WARP client version and connectivity status, then start a new capture.

#### Download remote captures

1. In Zero Trust ‚Üó, go to DEX > Remote captures.
2. Find a successful capture.
3. Select the three-dot menu and select Download.

This will download a ZIP file to your local machine called <capture-id>.zip. DEX will store capture data according to our log retention policy.

After you have your diagnostic files, go to Review key files to continue troubleshooting.

### Option B: Collect logs via the CLI

Collect WARP diagnostic logs on your desktop using the warp-diag CLI.

To view WARP logs on desktop devices:

- macOS
- Windows
- Linux

1. Open a Terminal window.
2. Run the warp-diag tool:
Terminal windowwarp-diag

This will place a warp-debugging-info-<date>-<time>.zip on your desktop.

1. Open a Command Prompt or PowerShell window.
2. Run the warp-diag tool:
Terminal windowC:\Users\JohnDoe>warp-diag

This will place a warp-debugging-info-<date>-<time>.zip on your desktop.

1. Open a Terminal window.
2. Run the warp-diag tool:
Terminal windowwarp-diag

This will place a warp-debugging-info-<date>-<time>.zip in the same folder you ran the command from.

Best practice

To troubleshoot effectively, Cloudflare recommends that you recreate the steps that cause the issue before running warp-diag and keep timestamps of your steps for review within the logs.

After you have your diagnostic files, go to Review key files to continue troubleshooting.

## 3. Review key files

WARP diagnostic logs capture the final WARP configuration and status on a device after all MDM policies and other software settings have been applied. Reviewing these logs can help you identify misconfigurations or unexpected behavior.

Chapters

- Introduction  0s
- What are warp-diag files?  44s
- How to download and navigate warp-diag files  1m16s
- warp-status.txt  2m06s
- warp-settings.txt  2m29s
- daemon.log  3m37s
- Addition tips  8m07s
- Conclusion  8m43s

### Check WARP status

Open the warp-status.txt file to review the status of the WARP connection when the warp-diag was collected. A connected WARP client will appear as:

```
Ok(Connected)
```

If the WARP client is experiencing issues, the error will display in the WARP GUI on the device. Use the Client errors documentation to identify your error, its cause, and the solution.

### Check WARP settings

After you have checked WARP status, review WARP's settings on the device to check if the expected configuration has been applied. Open the warp-settings.txt file to review the WARP client settings. You will check the device's applied device profile and split tunnel configuration.

#### Example warp-settings.txt file

Find the WARP diagnostic logs on your desktop, and open the warp-settings.txt file. Review the following example warp-settings.txt file and the descriptions of its content below.

```
Merged configuration:(derived)   Always On: true(network policy)    Switch Locked: false # If false, does not allow the user to turn off the WARP toggle and disconnect the WARP client(network policy)    Mode: WarpWithDnsOverHttps # The device's WARP mode, this mode is WARP with Gateway mode(network policy)    WARP tunnel protocol: WireGuard(default)   Disabled for Wifi: false(default)   Disabled for Ethernet: false(reg defaults)  Resolve via: 1xx0x1011xx000000000f0x00000x11.cloudflare-gateway.com @ [1xx.1xx.1x.1, 1x01:1x00:1x00::1xx1] # The SNI Cloudflare will use and the IP address for DNS-over-HTTPS (DoH) requests(user set)  qlog logging: Enabled(default)   Onboarding: true # If true, the user sees an onboarding prompt when they first install the WARP client(network policy)    Exclude mode, with hosts/ips: # Split tunnel configuration  1xx.1xx.1xx.1xx/25 (zoom)...  cname.user.net
(network policy)    Fallback domains: # Local domain fallback configuration  intranet...  test(not set)   Daemon Teams Auth: false(network policy)    Disable Auto Fallback: false(network policy)    Captive Portal: 180(network policy)    Support URL: my-organizations-support-portal.com # Your organization's support portal or IT help desk(user set)  Organization: Organization-Name(network policy)    Allow Mode Switch: true  # The user is allowed to switch between WARP modes(network policy)    Allow Updates: false # WARP client will not perform update checks(network policy)    Allowed to Leave Org: true(api defaults)  Known apple connectivity check IPs: xx.xxx.0.0/16;(network policy)    LAN Access Settings: Allowed until reconnect on a /24 subnet # The maximum size of network that will be allowed when Access Lan is clicked.(network policy)    Profile ID: 000000x1-00x1-1xx0-1xx1-11101x1axx11
```

Quick debugging

The command warp-cli settings in a terminal will generate the same information that is present in the warp-settings.txt file.

#### Contents of warp-settings.txt file

Review the meanings of the fields in warp-settings.txt that are relevant to troubleshooting.

##### Always On

Refers to the current state of the WARP toggle in the GUI. In the example file, the WARP toggle is switched on.

```
Always On: true
```

##### Switch Locked

Refers to the Lock WARP Switch which allows the user to turn off the WARP switch and disconnect the client. In the example file, the value is false meaning the user is able to turn the WARP switch on or off at their discretion.

```
Switch Locked: false
```

When the Lock WARP switch is enabled (true), users will need an Admin override code to temporarily turn off WARP on their device.

##### Mode

Refers to the WARP mode the device is using. In the example file, the WARP mode is WarpWithDnsOverHttps which is Gateway with WARP mode. Refer to the WARP modes comparison matrix to match your warp-settings.txt file's value with the mode name.

```
Mode: WarpWithDnsOverHttps
```

##### Exclude mode, with hosts/ips

Refers to your split tunnel settings. In the example file, WARP is running in Exclude mode, meaning all traffic except for the traffic destined for these hosts and IPs will be sent through the WARP tunnel. The host cname.user.net and the IP 1xx.1xx.1xx.1xx/25  are both excluded from the WARP tunnel.

```
Exclude mode, with hosts/ips:  1xx.1xx.1xx.1xx/25 (zoom)...  cname.user.net
```

Exclude mode versus Include mode

Exclude mode means all traffic will be sent through the WARP tunnel except for the IPs and domains you specify.

Include mode means only traffic destined to the IPs or domains you specify will be sent through the WARP tunnel.

##### Fallback domains

Refers to your Local Domain Fallback settings. In the example file, WARP lists intranet as a domain that will not be sent to Gateway for processing and will instead be sent directly to the configured fallback servers.

```
(network policy)    Fallback domains:  intranet...
```

##### Allow Mode Switch

Refers to the Mode switch setting. In the example file, the mode switch is enabled (true) which means the user has the option to switch between Gateway with WARP mode and Gateway with DNS-over-HTTPS (DoH) mode.

```
Allow Mode Switch: true
```

##### Allow Updates

Refers to the Allow updates setting. In the example file, the allow updates setting is set to false meaning that the user will not receive update notifications when a new version of the WARP client is available and cannot update WARP without administrator approval.

```
Allow Updates: false
```

##### Allowed to Leave Org

Refers to the Allow device to leave organization setting. In the example file, the value is set to true meaning the user can log out from your Zero Trust organization.

```
Allowed to Leave Org: true
```

##### LAN Access Settings

Refers to the Allow users to enable local network exclusion setting. When enabled, it allows users to temporarily access local devices (like printers) by excluding the detected local subnet from the WARP tunnel. This example indicates access is allowed until the next WARP reconnection, and only for subnets up to /24.

```
LAN Access Settings: Allowed until reconnect on a /24 subnet
```

##### Profile ID

Refers to the Device profile a device is using. In this example, the ID is 000000x1-00x1-1xx0-1xx1-11101x1axx11.

```
Profile ID: 000000x1-00x1-1xx0-1xx1-11101x1axx11
```

## 4. Fix common misconfigurations

To verify that WARP is configured and working properly, review the following:

1. Is the wrong profile ID applied to the device?
2. Is the wrong split tunnel configuration active on the device?

### Wrong profile ID

A profile ID is a unique identifier assigned to each device profile in the Zero Trust dashboard, used to determine which configuration settings apply to a device.

If your organization has multiple device profiles defined in the Zero Trust dashboard, a device may be matched to an unexpected profile because:

1. How profile precedence is configured.

WARP evaluates profile IDs in the order they appear in the dashboard

Cloudflare WARP evaluates device profiles dynamically based on a hierarchy. When a device connects, WARP checks the profiles from top to bottom as they appear in the dashboard. WARP follows the first match principle ‚Äî once a device matches a profile, WARP stops evaluating and no subsequent profiles can override the decision.

The Default profile is always at the bottom of the list. It will only be applied if the device does not meet the criteria of any profile listed above it. If you make another custom profile the default, all settings will be copied over into the Default profile.

Administrators can create multiple profiles to apply different settings based on specific criteria such as user identity, location, or operating system. Understanding this top-to-bottom evaluation order is crucial for ensuring that the correct policies are applied to devices.

1. Managed network issues.
2. User group mismatch.
3. Lack of precise match rules.

#### Check the applied device profile

To check that the applied device profile is the intended device profile:

1. Go to Zero Trust ‚Üó > Settings > WARP Client.
2. Find and select the device profile intended for the device.
3. Under Profile details, compare the displayed Profile ID with the Profile ID in the warp-settings.txt file.

If the profile ID displayed in the warp-settings.txt file does not match the intended device profile's ID shown in the dashboard:

1. If you are using a managed network, review your managed network settings for common errors.
2. Edit your device profile's match rules in the intended profile to make them more specific (for example, by adding identity-based selectors like email, or group name.)

Warning

Avoid reordering profiles unless you are confident it will not affect other users.

Note

Identity-based selectors are only available if the user enrolled the device by logging in to an identity provider (IdP).

#### Review your managed network settings

A managed network is a network location that you define with a TLS endpoint, like a physical office. The WARP client checks for this TLS endpoint to determine its location and apply the corresponding device profile.

If the managed network is misconfigured or the TLS endpoint is unreachable, the device may fall back to an unintended profile.

When troubleshooting WARP for managed network issues:

1. Verify the endpoint is reachable.
The WARP client connects to the TLS endpoint to identify the network. If the endpoint is down or unreachable, the WARP client will fail to detect the network and apply the wrong profile.
To test connectivity and obtain the SHA-256 fingerprint of a remote server:
Terminal windowopenssl s_client -connect <private-server-IP>:443 < /dev/null 2> /dev/null | openssl x509 -noout -fingerprint -sha256 | tr -d :
The output will look something like:
SHA256 Fingerprint=DD4F4806C57A5BBAF1AA5B080F0541DA75DB468D0A1FE731310149500CCD8662
If the endpoint is down, you will receive a Could not find certificate from <stdin> response.
If you received a returned SHA-256 fingerprint:

Log into Zero Trust ‚Üó, go to Settings > WARP Client.
Go to Manage Networks > Edit.
Compare the TLS Cert SHA-256 in the dashboard with the returned fingerprint in your terminal to ensure they match.
2. Log into Zero Trust ‚Üó, go to Settings > WARP Client.
3. Go to Manage Networks > Edit.
4. Compare the TLS Cert SHA-256 in the dashboard with the returned fingerprint in your terminal to ensure they match.
5. Use a single profile for a single location.
To simplify management and prevent errors, avoid creating multiple managed network profiles for the same location. For example, if you have multiple TLS endpoints in one office, link them all to a single device profile. This reduces the risk of a device matching an unintended profile due to a configuration error.

#### Check a user's group membership

If a user is having issues with a device profile, it may be because they are not part of the correct user group. This can happen when an organization is not using SCIM for automatic identity provider (IdP) updates.

To check that the user belongs to the intended group:

1. Log into Zero Trust ‚Üó > go to My Team > Users.
2. Select the user.
3. Under User Registry Identity, select the user's name.
4. The Get-identity endpoint lists all the groups the user belongs to.

If the user was recently added to a group, they will need to update their group membership with Cloudflare Zero Trust. This can be accomplished by logging into the reauthenticate endpoint.

To manually refresh your Cloudflare Access session and update your group information from your identity provider (IdP), go to the following URL in your browser and fill in your team name:

https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/refresh-identity

Reauthenticating resets your session duration and fetches the latest group information from the organization's IdP.

#### Edit your device profile match rules

To modify the match rules of a device profile, you will need to edit the device profile. To edit the device profile:

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. In the Profile settings card, find the profile you want to update and select Configure.
3. Use selectors to add or adjust match rules, and modify WARP settings for this profile as needed.
NoteChanging any of the settings below will cause the WARP connection to restart. The user may experience a brief period of connectivity loss while the new settings are being applied.
Service mode
Local Domain Fallback
Split Tunnels
4. Service mode
5. Local Domain Fallback
6. Split Tunnels
7. Select Save profile.

It may take up to 10 minutes for newly updated settings to propagate to devices.

### Wrong split tunnel configuration

Split Tunnels can be configured to exclude or include IP addresses or domains from going through WARP. This feature is commonly used to run WARP alongside a VPN (in Exclude mode) or to provide access to a specific private network (in Include mode).

Warning

Split Tunnels only impacts the flow of IP traffic. DNS requests are still resolved by Gateway and subject to DNS policies unless you add the domains to your Local Domain Fallback configuration.

Because Split Tunnels controls what Gateway has visibility on at the network level, we recommend testing all changes before rolling out updates to end users.

A misconfigured split tunnel can cause connectivity issues.

For example, if you set your mode to Exclude IPs and domains and accidentally exclude an IP address needed by an application, that application may not work correctly. Similarly, in Include IPs and domains mode, forgetting to include a necessary IP or domain will cause traffic to bypass WARP, and you will lose access to your Zero Trust security features.

#### 1. Check the applied split tunnel configuration

After downloading the WARP diagnostic logs, review that your configuration is working as intended:

1. Open the warp-settings.txt file and find Exclude mode, with hosts/ips: or Include mode, with hosts/ips:.
Exclude mode versus Include modeExclude mode means all traffic will be sent through the WARP tunnel except for the IPs and domains you specify.Include mode means only traffic destined to the IPs or domains you specify will be sent through the WARP tunnel.
2. Log into Zero Trust ‚Üó, go to Settings > WARP client.
3. Find and select the device profile intended for the device.
4. Select Edit.
5. Find Split Tunnels and note the mode you have selected > select Manage.
6. Cross-reference the IPs/hosts you have configured in the Zero Trust dashboard with the IPs/hosts listed in warp-settings.txt.

If your dashboard split tunnel configuration does not match your warp-settings.txt file configuration, you may need to force the WARP client to update its settings.

#### 2. Update the WARP client's settings

If the split tunnel configuration in warp-settings.txt does not match the dashboard, you can force the WARP client to fetch the latest settings.

This can be done by instructing the end user to toggle WARP off and on, or reset their encryption keys.

Both methods update the client with the latest configuration.

##### Option A: Toggle WARP off and back on

On the end user device, open the WARP GUI and toggle WARP on and off.

What if the end user cannot turn off WARP?

If the end user's WARP switch is locked, they will need an admin override code to be able to toggle the WARP switch.

Resetting the encryption keys may be a faster solution.

After you toggle WARP back on, the WARP client will fetch new settings when it reconnects.

##### Option B: Reset the encryption keys

To reset the encryption keys on an end user's desktop:

1. Open the WARP GUI.
2. Select the gear icon.
3. Select Preferences > Connection > Reset encryption keys.

Resetting the encryption keys forces the WARP client to reestablish its tunnel and retrieve the latest configuration.

## 5. File a support ticket

Effective troubleshooting depends on clear, detailed support tickets. The more context you provide, the faster support can identify and resolve the issue.

To ensure efficient resolution when contacting support, include as much relevant detail as possible in your ticket:

- Context: Briefly describe the scenario or use case (for example, where the user was, what they were trying to do).
- Reproduction steps: Describe the steps you took to reproduce the issue during troubleshhooting.
- Timestamps: Be specific and include the exact time and time zone when the issue occurred.
- Troubleshooting attempts: Outline any troubleshooting steps or changes already attempted to resolve the issue.
- WARP diagnostics logs: Include the WARP diag you downloaded from the dashboard or through the CLI.

Avoid vague ticket descriptions

Refer to the following example of a vague ticket description:

Ken was on the train and had captive portal issues. warp-diag is attached.

Include scenario, timestamps, and steps taken to troubleshoot the issue

Refer to the following example of an ideal ticket description:

Karen was on a train on July 17, 2025, at approximately 1:00 PM Central Time. She attempted to connect to a captive portal but received the following error message in Chrome: ERR_CONNECTION_RESET. A warp diag was collected immediately after and is attached.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Common issues

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/common-issues/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/common-issues/)

Page options # Common issues

This section covers the most common issues you might encounter as you deploy the WARP client in your organization, or turn on new features that interact with the client. If you do not see your issue listed below, refer to the troubleshooting FAQ or contact Cloudflare Support.

## Unable to connect WARP

If WARP is stuck in the Disconnected state or frequently changes between Connected and Disconnected, this indicates that the client cannot establish a connection to Cloudflare's global network.

In your WARP debug logs, daemon.log will typically show one or more of the following errors:

- Happy Eyeball checks failing:
ERROR main_loop: warp::warp::happy_eyeballs: Happy eyeballs error Custom { kind: NotConnected, error: "All Happy Eyeballs checks failed" }
- Many other checks timing out:
ERROR warp::warp::connectivity_check: DNS check failed error=ResolveError { kind: Timeout }WARN warp::warp::connectivity_check: Tunnel trace failed request::Error { kind: Request, url: Url { scheme: "https", cannot_be_a_base: false, username: "", password: None, host: Some(Domain("connectivity.cloudflareclient.com")), port: None, path: "/cdn-cgi/trace", query: None, fragment: None }, source: TimedOut }

Here are the most common reasons why this issue occurs:

### A third-party service is blocking WARP

A third-party service (such as a hardware or software firewall, router, MDM/group policy configuration, or other networking interface) may have a security policy in place which blocks WARP from connecting.

#### Solution

Configure the third-party service to exempt the IP addresses required by WARP.

### A third-party VPN is interfering with WARP

The most common places we see interference with WARP from VPNs are:

- Control of traffic routing: In daemon.log, you will see a large number of routing table changes. For example,
DEBUG warp::warp_service: Routes changed:    Added; Interface: 8; Destination: 10.133.27.201/32; Next hop: 100.64.0.2;    Added; Interface: 8; Destination: 10.133.27.202/32; Next hop: 100.64.0.2;DEBUG warp::warp_service: Routes changed:    Added; Interface: 8; Destination: 10.133.27.203/32; Next hop: 100.64.0.2;    Added; Interface: 8; Destination: 10.133.27.204/32; Next hop: 100.64.0.2;DEBUG warp::warp_service: Routes changed:    Added; Interface: 8; Destination: 10.133.27.205/32; Next hop: 100.64.0.2;
This indicates that a third-party VPN is fighting WARP for control over the routing table.
- Control of DNS: In daemon.log, you will see a large number of DNS changes followed by this warning:
WARN main_loop: warp::warp_service: Reinforcing DNS settings. Is something else fighting us?
The daemon may also note that some other process has already bound to the UDP and TCP sockets:
WARN warp::warp: Unable to bind local UDP socket error=Os { code: 48, kind: AddrInUse, message: "Address already in use" } sockaddr=127.0.2.2:53WARN warp::warp: Unable to bind local TCP socket error=Os { code: 48, kind: AddrInUse, message: "Address already in use" } sockaddr=127.0.2.2:53

To confirm that the VPN is the source of the issue, temporarily uninstall (not disable or disconnect) the VPN.

#### Solution

1. Disable all DNS enforcement on the VPN. WARP must be the last client to touch the primary and secondary DNS server on the default interface.
2. In Zero Trust ‚Üó, create a Split Tunnel rule to exclude the VPN server you are connecting to (for example, vpnserver.3rdpartyvpn.example.com).
3. Configure your VPN to only include routes to your internal resources. Make sure that the VPN routes do not overlap with the routes included in the WARP tunnel.

For more information, refer to our guide for running VPNs alongside the WARP client.

### Your ISP or country is blocking WARP

Some countries explicitly block the use of VPN or VPN-like software that intentionally encrypts traffic. These blocks are often inconsistently enforced and you may sometimes see successful connections.

If you suspect your country may be blocking WARP traffic, contact your ISP to verify.

### (Mac/Linux) The device's /etc/resolv.conf file has an invalid character

WARP cannot parse resolv.conf files which contain an invalid hostname. In daemon.log, you will see an unrecognized char warning:

```
WARN main_loop: warp::warp_service: Tunnel connection experienced error error=Custom { kind: Other, error: ProtoError { kind: Msg("unrecognized char:  ") } }
```

#### Solution

1. Open the /etc/resolv.conf file on your device.
2. In the search directives, check for invalid URL characters such as !@#$%^&*()<>?.
3. Remove the invalid lines and rely on WARP and Gateway for DNS services.

## Turned on WARP and can no longer browse the Internet

If WARP shows as Connected but you cannot reach any websites or internal resources, this is likely due to one of the following configuration issues.

### A Gateway firewall policy is blocking traffic

A misconfigured Gateway firewall policy can result in traffic to some or all sites being restricted.

#### Solution

1. In Zero Trust ‚Üó, go to Gateway > Firewall Policies.
2. Disable all DNS, Network, and HTTP policies and see if the issue persists. It may take up to two minutes for the change to take effect. Note that all policy enforcement happens on the Cloudflare global network, not on your local device.
3. Slowly re-enable your policies. Once you have narrowed down the issue, modify the policies or their order of enforcement.

### The device does not have a root certificate installed

Installing and trusting a root CA is a necessary step to enable advanced security features such as Browser Isolation, TLS decryption, AV scanning, and device posture.

If the root CA is not installed on the device, you will see untrusted certificate warnings on every website. Example warnings include Certificate not trusted, Not trusted identity or SSL Error.

#### Solution

Install a Cloudflare certificate on all of your devices, or upload your own certificate to Cloudflare.

Note

More and more applications (including browsers) are relying on their own certificate stores. In addition to ensuring a root certificate is trusted at the device level, you may also need to add the certificate to individual applications. For example, to use Firefox on Linux, you must install the certificate on both the system and on Firefox.

### A third-party security product is interfering with Gateway

WARP does not allow third-party DLP or proxy services to perform TLS decryption on traffic sent to Gateway.

To diagnose the issue, go to https://zero-trust-client.cloudflareclient.com/v0/client_config and verify the certificate the HTTPS traffic is signed with. If the certificate is issued by your organization or a third-party service, the third-party service is performing TLS decryption on WARP traffic and re-signing with a certificate that we do not trust.

#### Solution

In the third-party security product, disable HTTPS inspection and TLS decryption for the WARP IP addresses.

### Docker container is failing DNS resolution

If you are using WARP and running a CI/CD pipeline inside a Docker container on Microsoft hardware to provide GitHub Actions with an egress IP, your container's /etc/resolv.conf file might be injecting a custom nameserver with the IP address 168.63.129.16 ‚Üó (specific to Azure infrastructure.)
The 168.63.129.16 IP address is only accessible to Azure VMs and causes the container's traffic to fail when routed through the Cloudflare WARP tunnel.

#### Solution

To fix this issue, you must exclude the Azure-specific nameserver IP (168.63.129.16) from being routed through WARP tunnel. Refer to Split Tunnels and follow the instructions to exclude the Azure-specific IP.

## Cannot connect to a specific app or website

Below are the most common reasons why turning on WARP blocks a specific application from loading.

### TLS Decryption is enabled and the app or site does certificate pinning

Some applications do not support SSL inspection or are otherwise incompatible with TLS decryption. Gateway provides a list of applications known to perform certificate pinning.

#### Solution (if the app has a private certificate store)

Applications such as Firefox, Docker, Python, and npm rely on their own certificate store and the Cloudflare root certificate must be trusted in each.

Refer to our instructions for adding a root certificate to common applications. For applications not on our list, try searching the Internet for <app-name> proxy support or <app-name> proxy certificate.

#### Solution (last resort)

If you cannot install the certificate on the application, create a Do Not Inspect policy to exclude the application from Gateway inspection.

### A Gateway firewall policy is blocking the app or site

You may have a Gateway DNS, Network, or HTTP in place that accidentally blocks a port, IP, or domain that the app or site relies on.

#### Solution

1. In Zero Trust ‚Üó, go to Gateway > Firewall Policies.
2. Disable all DNS, Network, and HTTP policies and see if the issue persists. It may take up to two minutes for the change to take effect. Note that all policy enforcement happens on the Cloudflare global network, not on your local device.
3. Slowly re-enable your policies. Once you have narrowed down the issue, modify the policies or their order of enforcement.

### Split Tunnel settings are misconfigured for the app or site

Some applications require traffic to flow either all inside or all outside of the WARP tunnel. For instance, in order to use AirDrop or communicate with a local printer, traffic must be outside the tunnel. For applications like Microsoft Teams to function properly, all Microsoft Teams traffic must be either fully inside the tunnel or fully outside the tunnel.

#### Solution

1. Determine the IP addresses and/or domains required for your application to function. Common Internet search terms include <app-name> split tunnel list, <app-name> allow list, or <app-name> firewall ips.
2. In Zero Trust ‚Üó, go to your Split Tunnel settings.
3. Depending on the application, either include or exclude all of the necessary IPs and/or domains. For Microsoft applications, we provide a one-click action to exclude all Microsoft 365 IPs.

## Troubleshooting

- Troubleshooting - Browse other Cloudflare One-related troubleshooting errors and solutions.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Client errors

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/client-errors/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/client-errors/)

Page options # Client errors

This page lists the error codes that can appear in the WARP client GUI. If you do not see your error below, refer to common issues or contact Cloudflare Support.

## CF_CAPTIVE_PORTAL_TIMED_OUT

### Symptoms

- Unable to login to a captive portal network
- No Internet connectivity

### Cause

Captive portal detection is turned on and one of the following issues occurred:

- The user did not complete the captive portal login process within the time limit set by WARP.
- The captive portal redirected the user to a flow that is not yet supported by the captive portal detection feature.

### Resolution

1. Increase the captive portal timeout to allow users more time to login.
2. If this does not resolve the issue, allow users to manually turn off WARP. We recommend setting an auto connect value so that the client turns itself back on after a few minutes.

## CF_CONNECTIVITY_FAILURE_UNKNOWN

### Symptoms

- Unable to connect WARP
- No Internet connectivity
- User may be behind a captive portal

### Cause

The initial connectivity check failed for an unknown reason. Refer to Unable to connect WARP for the most common reasons why this error occurs.

### Resolution

1. Retrieve WARP debug logs for the device.
2. Follow the troubleshooting steps in Unable to connect WARP.

## CF_DNS_LOOKUP_FAILURE

### Symptoms

- Unable to connect WARP
- Unable to browse the Internet
- nslookup and dig commands fail on the device

### Cause

WARP was unable to resolve hostnames via its local DNS proxy.

### Resolution

1. Verify that the network the user is on has DNS connectivity.
2. Verify that DNS resolution works when WARP is disabled.
3. Ensure that no third-party tools are interfering with WARP for control of DNS.
4. Ensure that no third-party tools are performing TLS decryption on traffic to the WARP IP addresses.

## CF_DNS_PROXY_FAILURE

### Symptoms

- Unable to connect WARP in a mode that enables DNS filtering.

### Cause

A third-party process (usually a third-party DNS software) is bound to port 53, which is used by WARP's local DNS proxy to perform DNS resolution. The name of third-party process will appear in the GUI error message.

On macOS, you may see mDNSResponder instead of the specific application name -- mDNSResponder is a macOS system process that handles DNS requests on behalf of other processes. There is no known way to determine which process caused mDNSResponder to bind to port 53, but the most common culprits are virtual machine software (for example, Docker and VMware Workstation) and the macOS Internet Sharing feature.

### Resolution

1. Remove or disable DNS interception in the third-party process.

mDNSResponder

Below is a non-exhaustive list of third-party software that are known to cause mDNSResponder to bind to port 53. Rather than try to stop mDNSResponder, you should either configure the third-party software so that they no longer use port 53, or temporarily disable them before connecting to WARP.

- Docker: Turn off kernel networking for UDP ‚Üó in Docker.
- Internet Sharing feature: To disable Internet Sharing:

On macOS, go to System Settings > General > Sharing.
Turn off Internet Sharing.
- On macOS, go to System Settings > General > Sharing.
- Turn off Internet Sharing.
- Certain VM software (such as VMware Workstation or Parallels): The presence of VM software does not guarantee that it is the offending program, since compatibility with WARP is highly dependent on the VM's configuration. To work around the issue, connect to WARP before running any VMs:

Stop/quit all VMs.
Connect to WARP.
Start the VMs again.
- Stop/quit all VMs.
- Connect to WARP.
- Start the VMs again.

1. Alternatively, switch WARP to Secure Web Gateway without DNS filtering mode.

## CF_FAILED_READ_SYSTEM_DNS_CONFIG

### Symptoms

- Unable to connect WARP
- Unable to browse the Internet

### Cause

WARP could not read the system DNS configuration, most likely because it contains an invalid nameserver or search domain.

### Resolution

On macOS and Linux, validate that /etc/resolv.conf is formatted correctly ‚Üó and check for invalid characters.

On Windows, validate that the registry entry HKLM\System\CurrentControlSet\Services\TCPIP\Parameters\SearchList contains only valid search domains. Examples of invalid entries include IP addresses and domains that start with a period (such as .local).

## CF_FAILED_TO_SET_MTLS

### Symptoms

- Unable to connect WARP

### Cause

The device failed to present a valid mTLS certificate during device enrollment.

### Resolution

1. Ensure that there are no admin restrictions on certificate installation.
2. Re-install the client certificate on the device.

## CF_HAPPY_EYEBALLS_MITM_FAILURE

### Symptoms

- Unable to connect WARP

### Cause

A router, firewall, antivirus software, or other third-party security product is blocking UDP on the WARP ports.

### Resolution

1. Configure the third-party security product to allow the WARP ingress IPs and ports.
2. Ensure that your Internet router is working properly and try rebooting the router.
3. Check that the device is not revoked by going to My team > Devices.

## CF_HOST_UNREACHABLE_CHECK

### Symptoms

- Unable to connect WARP
- No Internet connectivity
- User may be behind a captive portal

### Cause

The connectivity check inside of the WARP tunnel has failed.

### Resolution

1. Check for the presence of third-party HTTP filtering software (AV, DLP, or firewall) that could be intercepting traffic to the WARP IPs.
2. In the third-party software, bypass inspection for all IP traffic going through WARP. To find out what traffic routes through the WARP tunnel, refer to Split Tunnels.

## CF_INSUFFICIENT_DISK

### Symptoms

- Unable to connect WARP
- OS warns that the disk is full

### Cause

The hard drive is full or has incorrect permissions for WARP to write data.

### Resolution

1. Ensure that your device meets the HD space requirements for WARP.
2. Check for disk permissions that may prevent WARP from using disk space.
3. Empty trash or remove large files.

## CF_INSUFFICIENT_FILE_DESCRIPTORS

### Symptoms

- Unable to connect WARP
- Unable to open files on the device

### Cause

The device does not have sufficient file descriptors to create network sockets or open files.

### Resolution

Increase the file descriptor limit in your system settings.

## CF_INSUFFICIENT_MEMORY

### Symptoms

- Unable to connect WARP
- Device is very slow

### Cause

The device does not have enough memory to run WARP.

### Resolution

1. Ensure that your device meets the minimum memory requirements for WARP.
2. List all running processes to check memory usage.

## CF_LOCAL_POLICY_FILE_FAILED_TO_PARSE

### Symptoms

- Unable to connect WARP

### Cause

The WARP client was deployed on the device using an invalid MDM configuration file.

### Resolution

1. Review the managed deployment guide for your operating system.
2. Locate the MDM configuration file on your device.
3. Ensure that the file is formatted correctly and only contains accepted arguments.

## CF_NO_NETWORK

### Symptoms

- Unable to connect WARP
- No Internet connectivity

### Cause

The device is not connected to a Wi-Fi network or LAN that has connectivity to the Internet.

### Resolution

1. Launch the network settings panel on your device.
2. Ensure that you are connected to a valid network.
3. Check that your device is retrieving a valid IP address.
4. If this does not resolve the error, try rebooting your device or running your system's network diagnostics tool.

## CF_REGISTRATION_MISSING

### Symptoms

- Unable to connect WARP

### Cause

The device is not authenticated to a Zero Trust organization because:

- The device was revoked in Zero Trust.
- The registration was corrupted or deleted for an unknown reason.

### Resolution

1. Launch the WARP client.
2. Select the gear icon and go to Preferences > Account.
3. Select Re-Authenticate Session.
4. Complete the authentication steps required by your organization.
5. If this does not resolve the error, select Logout from Cloudflare Zero Trust and then log back in. Logging out is only possible if Allow device to leave organization is enabled for your device.

## CF_TLS_INTERCEPTION_BLOCKING_DOH

### Symptoms

- DNS requests fail to resolve when WARP is turned on.

### Cause

A third-party application or service is intercepting DNS over HTTPS traffic from WARP.

### Resolution

Configure the third-party application to exempt the WARP DoH IPs.

## CF_TLS_INTERCEPTION_CHECK

### Symptoms

- Unable to connect WARP

### Cause

A third-party security product on the device or network is performing TLS decryption on HTTPS traffic. For more information, refer to the Troubleshooting guide.

### Resolution

In the third-party security product, disable HTTPS inspection and TLS decryption for the WARP IP addresses.

## Admin directed disconnect

### Symptoms

- Unable to connect WARP

### Cause

The account administrator has disconnected WARP for all devices registered to the account.

### Resolution

The account administrator must turn the Global WARP override feature off.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## WARP diagnostic logs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/warp-logs/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/warp-logs/)

Page options # WARP diagnostic logs

The WARP client provides diagnostic logs that you can use to troubleshoot connectivity issues on a device.

Chapters

- Introduction  0s
- What are warp-diag files?  44s
- How to download and navigate warp-diag files  1m16s
- warp-status.txt  2m06s
- warp-settings.txt  2m29s
- daemon.log  3m37s
- Addition tips  8m07s
- Conclusion  8m43s

## macOS/Windows/Linux

### Collect logs via the CLI

To view WARP logs on desktop devices:

- macOS
- Windows
- Linux

1. Open a Terminal window.
2. Run the warp-diag tool:
Terminal windowwarp-diag

This will place a warp-debugging-info-<date>-<time>.zip on your desktop.

1. Open a Command Prompt or PowerShell window.
2. Run the warp-diag tool:
Terminal windowC:\Users\JohnDoe>warp-diag

This will place a warp-debugging-info-<date>-<time>.zip on your desktop.

1. Open a Terminal window.
2. Run the warp-diag tool:
Terminal windowwarp-diag

This will place a warp-debugging-info-<date>-<time>.zip in the same folder you ran the command from.

### Collect logs via the dashboard

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP   Secure Web Gateway without DNS Filtering | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.12.492.0 |
| macOS | ‚úÖ | 2024.12.492.0 |
| Linux | ‚úÖ | 2024.12.492.0 |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

You can collect WARP diagnostic logs remotely from the Zero Trust dashboard by using Digital Experience Monitoring (DEX) remote captures.

Devices must be actively connected to the Internet for remote captures to run.

To capture data from a remote device:

1. In Zero Trust ‚Üó, go to DEX > Remote captures.
2. Select up to 10 devices that you want to run a capture on. Devices must be registered in your Zero Trust organization.
3. Configure the types of captures to run.

Packet captures (PCAP): Performs packet captures for traffic outside of the WARP tunnel (default network interface) and traffic inside of the WARP tunnel (WARP virtual interface).
WARP Diagnostics Logs: Generates a WARP diagnostic log of the past 96 hours. To include a routing test for all IPs and domains in your Split Tunnel configuration, select Test all routes.
NoteTest all routes will extend the time for diagnostics to run and may temporarily impact device performance during the test.
4. Packet captures (PCAP): Performs packet captures for traffic outside of the WARP tunnel (default network interface) and traffic inside of the WARP tunnel (WARP virtual interface).
5. WARP Diagnostics Logs: Generates a WARP diagnostic log of the past 96 hours. To include a routing test for all IPs and domains in your Split Tunnel configuration, select Test all routes.
NoteTest all routes will extend the time for diagnostics to run and may temporarily impact device performance during the test.
6. Select Run diagnostics.

DEX will now send capture requests to the configured devices. If the WARP client is disconnected, the capture will time out after 10 minutes.

#### Download remote captures

1. In Zero Trust ‚Üó, go to DEX > Remote captures.
2. Find a successful capture.
3. Select the three-dot menu and select Download.

This will download a ZIP file to your local machine called <capture-id>.zip. DEX will store capture data according to our log retention policy.

#### WARP diagnostics analyzer (beta)

The WARP diagnostics analyzer highlights what Cloudflare determines to be the most important detection events in a warp-diag log. You can use the detection report to help parse your log files and identify the root cause of client issues. The WARP diagnostic analyzer is only available for logs collected via the dashboard.

To access the WARP diagnostic analyzer:

1. In Zero Trust ‚Üó, go to DEX > Remote captures.
2. Locate an existing warp-diag log from the list or select Run diagnostics to generate a new warp-diag log.
3. Select the three dots for the warp-diag log that you want to analyze, then select View WARP Diag.
The Overview tab will display an AI-generated summary of the results, a list of detection events, and basic device information.
NoteTo view Cloudy AI summaries, account members must have the Administrator or Super Administrator role.
 Explanation of the fields
 












































FieldDescriptionDetection typeA common WARP issue that can appear in the diagnostic logs.OccurencesNumber of times an issue was detected in the logs.Severity levelIndicates the impact of the issue on WARP client functionality. The severity levels are:   Critical: Issue causes complete loss of functionality.   Warning: Issue causes degraded functionality but core features should still work.   No detection: Issue was not detected in the logs.  Operating systemOS and OS version of the device.WARP versionWARP release versionProfile IDWARP device profile UUIDService modeWARP modeConfiguration nameName of the Zero Trust organization that WARP is connected to.Device IDID generated by the WARP client.
4. Critical: Issue causes complete loss of functionality.
5. Warning: Issue causes degraded functionality but core features should still work.
6. No detection: Issue was not detected in the logs.
7. Select a detection type for more information about the event and recommended next steps.

Cloudflare will store the warp-diag log and its detection report per our log retention policy. To save a copy onto your local machine, download the log file and go to the JSON file tab to copy the report in JSON format.

### warp-diag logs

The warp-debugging-info-<date>-<time>.zip archive contains the following files:

| File name | Description |
| --- | --- |
| .qlog | QLog files used to debug MASQUE connection issues. |
| .pcap | Packet capture (PCAP) files that were manually generated using warp-cli debug pcap commands. |
| alternate-networks-check.txt | Connectivity status for each managed network. |
| boringtun.log | Log for the WARP tunnel that serves traffic from the device to Cloudflare's global network. |
| bound-dns-ports.txt | Active processes on port 53. |
| captive-portal-hotspot-detect.txt | HTTP response of captive.apple.com |
| connectivity.txt | DNS resolution and HTTP trace requests to validate a successful connection. Can be used to determine whether traffic is routing through the WARP tunnel. |
| daemon_dns.log | Contains detailed DNS logs if Log DNS queries is enabled in the WARP client. |
| daemon.log | Detailed log of all actions performed by the WARP client, including all communication between the device and Cloudflare's global network. Note: This is the most useful debug log. |
| date.txt | Date and time (UTC) when you ran the warp-diag command. |
| dex.log | Logs related to DEX test execution. |
| dhcp-lease-plists.txt | DHCP lease information from /var/db/dhcpclient/leases/ for each interface that has a DHCP lease. |
| dhcp-lease.txt | DHCP lease information from ipconfig (macOS) or nmcli (Linux). |
| dig.txt | DNS lookup query output for cloudflare.com and apple.com. |
| dns_stats.log | Statistics on the DNS queries received and resolved by WARP, generated every two minutes. |
| dns-check.txt | Verifies that the WARP DNS servers are set as system default. For operating modes where DNS filtering is enabled, this file contains the IPs of the local WARP DNS proxy (127.0.2.2:0, 127.0.2.3:0, [fd01:db8:1111::2]:0, and [fd01:db8:1111::3]:0). |
| dynamic.log | Reserved for use by Cloudflare Support. |
| etc-hosts.txt | Static DNS config of device. |
| firewall-pfctl-all.txt | Packet filter (pf) firewall configuration (macOS only). |
| firewall-rules.txt | The system firewall rules configured by WARP. |
| gui-launcher.log | macOS console log showing application launch. |
| gui-log.log | Log file for the GUI app that users interact with. |
| hostname.txt | Name of the device. |
| ifconfig.txt  ipconfig.txt | IP configuration of each network interface. |
| installed_applications.txt | List of installed applications. |
| installed_cert.pem | Root certificate installed on the system. |
| installer.log  msi-installer.log | MSI or PKG installation log. |
| InstallHistory.plist  macos_installer.log | macOS software installation logs. |
| ipc.log | Logs IPC communication between the GUI and daemon. Useful for situations where the GUI crashes or is unable to communicate with the daemon. |
| kernel-modules.txt | List of loaded kernel modules (macOS and Linux) or drivers (Windows). |
| launchd-dumpstate.txt | Current state of the macOS launchd system including the loaded jobs, their status, and dependencies. |
| local_policy.redacted.txt mdm.plist  mdm.xml | Managed deployment parameters on the device. |
| lsb-release.txt | Output from the lsb_release command (Linux only). |
| netstat.txt  routetable.txt | Routing table used by the device. |
| netstat-v6.txt | IPv6 routing table (Linux only). |
| platform.txt | Operating system of the device. |
| ps.txt  processes.txt | List of all active processes on the device when warp-diag was run. |
| resolv.conf | The contents of the /etc/resolv.conf file on Mac/Linux, where system DNS servers are configured. |
| route.txt | Output from the ip route get command, used to verify that network traffic is going over the correct interface. You can optionally use the warp-diag --enable-all-routes flag to include tests for all IPs and domains in your Split Tunnel configuration. |
| scutil-dns.txt | DNS configuration on macOS/Linux (available in ipconfig.txt on Windows). |
| scutil-networkinfo.txt | IPv4 and IPv6 network interface configuration on macOS (available in interfaces-config.txt on Windows). |
| scutil-proxy.txt | Proxy configuration on macOS/Linux (available in ipconfig.txt on Windows). |
| snapshots-collection.log | Logs generated when collecting snapshots/*.log. Used to debug why WARP failed to collect a snapshot. |
| snapshots/*.log | Diagnostics generated when an error occurs. |
| stats.log | Uptime and throughput stats for the WARP tunnel, generated every two minutes. |
| sw-vers.txt | Operating system of the device. |
| sysinfo.json | CPU and memory usage when warp-diag was run. This information is useful for determining whether slow speeds are due to heavy system load. |
| system-extension-diagnostics.txt | Status and health of loaded system extensions (macOS only). |
| systeminfo.txt  system-profile.txt | System software overview. |
| System.evtx | Windows system event log. |
| taskdump.log | If the daemon hangs, this file will contain a dump of the currently running processes. This is helpful in debugging hangs, deadlocks, and tasks. |
| timezone.txt | Local timezone of the device specified as a UTC offset. |
| traceroute.txt | Traceroute to the WARP ingress IPs showing the path from the device to Cloudflare's global network. |
| uname.txt | Linux-only system information including kernel version. |
| v4interfaces.txt  v4subinterfaces.txt  v6interfaces.txt  v6subinterfaces.txt | IPv4 and IPv6 network configuration on Windows. |
| version.txt | WARP client version installed on the device. |
| warp-account.txt | WARP client device enrollment information. |
| warp-bus-metrics.txt | Metrics for the internal message bus framework used by the WARP client. |
| warp-device-posture.txt | Current device posture status. |
| warp-dex-data.txt | Currently configured DEX tests and their most recent statuses. |
| warp-dns-fallbacks.txt | List of default DNS fallbacks used by the WARP DNS proxy. |
| warp-dns-lock.json | Default DNS providers and network interface information. |
| warp-dns-stats.txt | Summary of recent DNS queries on the device since dns-stats.log was generated. |
| warp-network.txt | Network settings on the device detected by WARP. |
| warp-settings.txt | WARP client settings applied to the device. |
| warp-stats.txt | Uptime and throughput of the WARP tunnel since stats.log was generated. |
| warp-status.txt | Status of WARP switch (Connected or Disconnected). |
| wdutil-info.txt | Wi-Fi diagnostics (macOS only). |
| xpc-launchd.log | Most recent log file for the launchd process on macOS. |

#### Multiple versions of the same log

The warp-debugging-info folder may contain multiple versions of the same log, such as daemon.log, daemon.1.log, and daemon.2.log. Since logs can get very long, they are rotated either daily or when they exceed a certain size.

- <logfile>.log is the most current log. This is almost always the log you should be looking at, as it shows events that occurred on the day you ran the warp-diag command.
- <logfile>.1.log shows events from the previous day.
- <logfile>.2.log shows events from two days before.

Note

In timestamped logs such as daemon.log, the most recent events will appear at the end of the file.

#### Log retention window

Each WARP log file (such as connection_stats.log, dns_stats.log, daemon.log, boringtun.log, daemon_dns.log, dex.log and captive-portal.log) is limited by size and age:

- Maximum file size: 10 MB
- Maximum file age: 24 hours
- Maximum number of retained versions per log: 4 (for example, daemon.log, daemon.1.log, daemon.2.log, and daemon.3.log)

Log files may include data from up to 96 hours (four days) prior to when warp-diag was run, but only if log activity is minimal. In environments with high logging volume (for example, repeated errors), logs may rotate more frequently, and the captured window could be much shorter (only a few hours).

Always check the timestamps at the end of each log file to verify the time range covered by the diagnostic archive.

## iOS/Android/ChromeOS

### Collect logs

To view WARP logs on mobile devices:

1. Open the 1.1.1.1 app.
2. Go to Settings > Advanced > Diagnostics.
3. Scroll down to Debug logs and choose from the available logs.

### Mobile app logs

Mobile app logs contain a subset of the information available for desktop clients. To learn more about these files, refer to their equivalent warp-diag logs.

#### iOS

| Name | Equivalent warp-diag log |
| --- | --- |
| DNS logs | daemon_dns.log |
| Console logs > Extension logs | daemon.log |
| Console logs > Application logs | connectivity.txt and gui-log.log |
| Routing table | netstat.txt |

#### Android/ChromeOS

| Name | Equivalent warp-diag log |
| --- | --- |
| DNS logs | daemon_dns.log |
| Console logs | connectivity.txt, netstat.log, and gui-log.log |
| Native logs | daemon.log |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Known limitations

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/known-limitations/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/known-limitations/)

Page options # Known limitations

Below, you will find information on devices, software, and configurations that are incompatible with Cloudflare WARP.

## Windows Server

The WARP client does not run on Windows Server. Refer to the downloads page for a list of supported operating systems.

## Managed network on legacy Windows Server

Managed network detection will not work when the TLS certificate is served from IIS 8.5 on Windows Server 2012 R2. To work around the limitation, move the certificate to a different host.

## Split Tunnels for Microsoft 365 traffic

Microsoft has recently made changes to the IP addresses used by Microsoft 365 applications (such as Microsoft Teams). Customers using the Directly route Microsoft 365 traffic feature will need to manually add the following IPs to their Split Tunnels Exclude list:

- 24.24.24.24/32
- 52.120.0.0/14

## nslookup on Windows in DoH mode

On Windows devices in Gateway with DoH mode, nslookup by default sends DNS requests to the WARP local DNS proxy over IPv6. However, because WARP uses an IPv4-mapped IPv6 address (instead of a real IPv6 address), nslookup will not recognize this address type and the query will fail:

```
C:\Users\JohnDoe>nslookup google.comServer:  UnKnownAddress:  ::ffff:127.0.2.2
*** UnKnown can't find google.com: No response from server
```

To work around the issue, specify the IPv4 address of the WARP local DNS proxy in your query:

Terminal window ```
C:\Users\JohnDoe>nslookup google.com 127.0.2.2
```

Alternatively, use PowerShell:

PowerShell ```
Resolve-DnsName -Name google.com
```

## 4G/5G embedded modules

Because of how the WARP client instantiates the local DNS Proxy, it is incompatible with 4G/5G cellular adapters which have IPv6 enabled. To run WARP on these devices, you will need to disable IPv6 on the system.

Note

This limitation does not apply to mobile phones, only desktop machines with cellular connectivity.

## Comcast DNS servers

Comcast DNS traffic (to the IPs below) cannot be proxied through WARP. This is because Comcast rejects DNS traffic that is not sent directly from the user's device.

- IPv4 Addresses: 75.75.75.75 and 75.75.76.76
- IPv6 Addresses: 2001:558:feed::1 and 2001:558:feed::2

To work around the issue, you can either:

- Create a Split Tunnel rule that excludes the above IPs from WARP.
- Configure your device or router to use a public DNS server such as 1.1.1.1 ‚Üó.

## Cox DNS servers

Similar to the Comcast DNS servers limitation listed above, Cox DNS servers will not respond to traffic from the WARP egress IPs (or any IP that is not a Cox IP). The workaround is nearly identical, except that Cox DNS servers may be specific to the individual end user. You can either:

- Create a Split Tunnel rule that excludes all Cox DNS servers. For business customers, refer to the COX documentation ‚Üó for the DNS server IPs. For residential customers, check your local DNS servers. The residential DNS servers typically fall under 68.105.28.0/24 and 68.105.29.0/24.
- Configure your device or router to use a public DNS server such as 1.1.1.1 ‚Üó.

## HP Velocity

The HP Velocity driver has a bug which will cause a blue screen error on devices running WARP. HP recommends uninstalling this driver ‚Üó.

## Cisco Meraki

Cisco Meraki devices have a bug where WARP traffic can sometimes be identified as Statistical-P2P ‚Üó and de-prioritised or dropped entirely. To resolve the issue, disable Statistical-P2P on the Cisco Meraki device.

## Windows Teredo

The Windows Teredo ‚Üó interface conflicts with the WARP client. Since Teredo and WARP will fight for control over IPv6 traffic routing, you must disable Teredo on your Windows device. This allows the WARP client to provide IPv6 connectivity on the device.

## Docker on Linux with bridged networking

Docker ‚Üó on Linux does not perform the underlying network tunnel MTU changes required by WARP. This can cause connectivity issues inside of a Docker container when WARP is enabled on the host machine. For example, curl -v https://cloudflare.com > /dev/null will fail if run from a Docker container that is using the default bridge network driver.

To work around this issue, users of WARP with Docker on Linux can manually reconfigure the MTU on Docker's network interface. You can either modify /etc/docker/daemon.json to include:

```
{  "mtu": 1420}
```

or create a Docker network with a working MTU value:

Terminal window ```
docker network create -o "com.docker.network.driver.mtu=1420" my-docker-network
```

The MTU value should be set to the MTU of your host's default interface minus 80 bytes for the WARP protocol overhead. Most MTUs are 1500, so 1420 should work for most users.

## Access WARP DNS from Docker

WARP runs a local DNS proxy on 127.0.2.2 and 127.0.2.3. You may need access to these addresses from within Docker containers to resolve internal-only or fallback domains. The default Docker bridge network ‚Üó copies the DNS settings from the host, but filters out loopback DNS addresses like 127.0.2.2 and 127.0.2.3, so containers cannot use them.

To enable WARP DNS resolution with containers:

- Use a custom Docker network ‚Üó (recommended): Allows the Docker container to still use the bridge network driver that maintains network isolation from the host. If you are creating your own bridge network, you should also adjust the MTU accordingly.
- Use host networking ‚Üó (not recommended): Removes the security benefits of network isolation and may lead to port conflicts.

The following example uses a special host (connectivity-check.warp-svc) that is only resolvable by the local DNS proxy to show the supported Docker networking modes.

```
# This host is not resolvable by default‚ùØ docker run --rm alpine nslookup connectivity-check.warp-svc.Server:         8.8.8.8Address:        8.8.8.8:53
** server can't find connectivity-check.warp-svc.: NXDOMAIN** server can't find connectivity-check.warp-svc.: NXDOMAIN
# Create a bridge network called demo‚ùØ docker network create demoe1e1943a6995a7e8c115a1c60357fe64f87a3ae90074ce6e4c3f0d2bba3fa892
# The host is resolvable by running a container under this custom network‚ùØ docker run --rm --net demo alpine nslookup connectivity-check.warp-svc.Server:         127.0.0.11Address:        127.0.0.11:53Non-authoritative answer:Name:   connectivity-check.warp-svcAddress: ::ffff:127.0.2.2Name:   connectivity-check.warp-svcAddress: ::ffff:127.0.2.3Non-authoritative answer:Name:   connectivity-check.warp-svcAddress: 127.0.2.2Name:   connectivity-check.warp-svcAddress: 127.0.2.3
# The host is also resolvable by running a container using a host network‚ùØ docker run --rm --net host alpine nslookup connectivity-check.warp-svc.Server:         127.0.0.11Address:        127.0.0.11:53Non-authoritative answer:Name:   connectivity-check.warp-svcAddress: ::ffff:127.0.2.2Name:   connectivity-check.warp-svcAddress: ::ffff:127.0.2.3Non-authoritative answer:Name:   connectivity-check.warp-svcAddress: 127.0.2.2Name:   connectivity-check.warp-svcAddress: 127.0.2.3
```

## Windows 10 in Microsoft 365 Cloud PC is not supported

Use of the WARP client in a Microsoft 365 Windows 10 Cloud PC is not supported. To work around this limitation, use Windows 11.

## IPv6 DNS resolution in Secure Web Gateway without DNS filtering mode

In Secure Web Gateway without DNS filtering mode, devices using IPv6 DNS servers may experience connectivity issues if these servers are not manually excluded from the WARP tunnel.

Unlike common IPv4 DHCP configurations where DNS servers often fall within automatically excluded private address ranges, IPv6 environments typically require manual exclusion of DNS server addresses via split tunnel settings for proper operation.

If your DNS server uses an IPv6 address, you must manually exclude it using split tunnel settings for Secure Web Gateway without DNS filtering mode to work properly.

## Troubleshooting

- Troubleshooting - Review Troubleshooting for other WARP-related troubleshooting errors and solutions.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connectivity status

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/connectivity-status/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/troubleshooting/connectivity-status/)

Page options # Connectivity status

The WARP client GUI displays the following status messages when transitioning from a Disconnected to Connected state. These messages indicate the connectivity stage of the WARP daemon as it establishes a connection from the device to Cloudflare. The WARP mode determines which messages are displayed during the connection process. If WARP encounters an error while connecting, the status message will change to an error code.

To print status messages to the console, run the warp-cli -l status command before turning on the WARP switch.

| Status message | Description |
| --- | --- |
| Verifying connection settings | Initializes connection components based on your WARP settings. |
| Validating network | Validates Ethernet and/or Wi-Fi network connectivity. |
| Initializing IP connection | Checks for IPv4 and IPv6 connectivity to Cloudflare using the Happy Eyeballs algorithm ‚Üó. |
| Establishing a connection | Connects to the endpoint discovered by Happy Eyeballs. |
| Building a Tunnel | Creates a virtual network interface on the operating system for the WARP tunnel. |
| Configuring the firewall | Configures the system firewall to allow WARP tunnel traffic. |
| Setting up your routing table | Updates the system routing table based on your Split Tunnel rules. |
| Configuring your firewall rules | Configures the system firewall based on your Split Tunnel rules. |
| Checking connectivity to DNS | Checks connectivity to the DNS endpoint (<account-id>.cloudflare-gateway.com). |
| Setting local endpoint communication | Configures local DNS proxy sockets. |
| Configuring local DNS proxy | Creates a local DNS proxy for DNS resolution. |
| Applying DNS settings | Sets the local DNS proxy as the default DNS server on the device. |
| Configuring forward proxy | (Only in Proxy mode) Configures the SOCKS proxy. |
| Confirming Tunnel connection | Checks connectivity to destinations inside and outside of the WARP tunnel. |
| Validating DNS configuration | Verifies that DNS requests are answered by WARP's local DNS proxy. |
| Verifying SOCKS proxy configuration | (Only in Proxy mode) Verifies the SOCKS proxy configuration. |
| Ensuring MTLS identity | (Only in Device Information Only mode) Installs a client certificate for mTLS authentication. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Remove WARP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/remove-warp/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/remove-warp/)

Page options # Remove WARP

The following procedures will uninstall the WARP client from your device. If you used the WARP client to deploy a root certificate, the certificate will also be removed.

## Windows

1. Go to Windows Settings (Windows Key + I).
2. Select Apps.
3. Select App & Features.
4. Scroll to find the Cloudflare WARP application and select Uninstall.

## macOS

We include an uninstall script as part of the macOS package that you originally used.

1. To find and run the uninstall script, run the following commands:

Terminal window ```
cd /Applications/Cloudflare\ WARP.app/Contents/Resources./uninstall.sh
```

1. If prompted, enter your admin credentials to proceed with the uninstall.

Note

You can bypass the Are you sure prompt by passing -f as a parameter to the macOS uninstall command.

## Linux

On CentOS 8, RHEL 8:

Terminal window ```
sudo yum remove cloudflare-warp
```

On Ubuntu 18.04, Ubuntu 20.04, Ubuntu 22.04, Debian 9, Debian 10, Debian 11:

Terminal window ```
sudo apt remove cloudflare-warp
```

## iOS and Android

1. Find the Cloudflare One Agent application (or the legacy 1.1.1.1 application) on the home screen.
2. Select and hold the application tile, and then select Remove App.
3. Select Delete App.

Note

If you manually deployed a Cloudflare certificate, remember to manually delete the certificate from the device.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Agentless options

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/)

Page options # Agentless options

If you are unable to install the WARP client on your devices (for example, Windows Server does not support the WARP client), you can use agentless options to enable a subset of Zero Trust features.

- Gateway DNS policies
- Gateway HTTP policies without user identity and device posture
- Access policies without device posture for web applications and for browser-rendered SSH, RDP, and VNC connections
- Remote Browser Isolation via an Access policy, prefixed URLs, or a non-identity on-ramp
- Cloud Access Security Broker (CASB)
- Data Loss Prevention (DLP) for SaaS applications integrated with Cloudflare CASB

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Locations

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/dns/locations/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/dns/locations/)

Page options # Locations

DNS locations are a collection of DNS endpoints which can be mapped to physical entities such as offices, homes, or data centers.

The fastest way to start filtering DNS queries from a location is by changing the DNS resolvers at the router.

## Add a DNS location

To add a DNS location to Gateway:

1. In Zero Trust ‚Üó, go to Gateway > DNS Locations.
2. Select Add a location.
3. Choose a name for your DNS location.
4. Choose at least one DNS endpoint to resolve your organization's DNS queries.
5. (Optional) Toggle the following settings:

Enable EDNS client subnet sends a user's IP geolocation to authoritative DNS nameservers. EDNS Client Subnet (ECS) helps reduce latency by routing the user to the closest origin server. Cloudflare enables EDNS in a privacy preserving way by not sending the user's exact IP address but rather the first /24 range of the larger range that contains their IP address. This /24 range will share the same geographic location as the user's exact IP address.
Set as Default DNS Location sets this location as the default DoH endpoint for DNS queries.
6. Enable EDNS client subnet sends a user's IP geolocation to authoritative DNS nameservers. EDNS Client Subnet (ECS) helps reduce latency by routing the user to the closest origin server. Cloudflare enables EDNS in a privacy preserving way by not sending the user's exact IP address but rather the first /24 range of the larger range that contains their IP address. This /24 range will share the same geographic location as the user's exact IP address.
7. Set as Default DNS Location sets this location as the default DoH endpoint for DNS queries.
8. Select Continue.
9. (Optional) Turn on source IP filtering for your configured endpoints, then add any source IPv4/IPv6 addresses to validate.

Endpoint authentication is required for standard IPv4 addresses and optional for dedicated IPv4 addresses.
DoH endpoint filtering & authentication lets you restrict DNS resolution to only valid identities or user tokens in addition to IPv4/IPv6 addresses.
10. Endpoint authentication is required for standard IPv4 addresses and optional for dedicated IPv4 addresses.
11. DoH endpoint filtering & authentication lets you restrict DNS resolution to only valid identities or user tokens in addition to IPv4/IPv6 addresses.
12. Select Continue.
13. Review the settings for your DNS location, then choose Done.

1. Change the DNS resolvers on your router, browser, or OS by following the setup instructions in the UI.
2. Select Go to DNS Location. Your location will appear in your list of locations.

You can now apply DNS policies to your location using the Location selector.

## DNS endpoints

### IPv4 and IPv6 DNS

Cloudflare will prefill the Source IPv4 Address based on the network you are on. Additionally, Enterprise users can use dedicated DNS resolver IP addresses assigned to their account or resolver IP addresses they provide (BYOIP).

You do not need to configure the IPv4 DNS endpoint if:

- Your network only uses IPv6.
- Your users will send all DNS requests from this location using DNS over HTTPS via a browser.
- You will deploy the WARP client.

Your IPv4 address is taken error

When you try to configure a DNS location over IPv4, Gateway may display a Your source IPv4 address is taken error. This may mean someone else in the same network configured Gateway before you did. If your network supports IPv6, you can still use Gateway's DNS filtering by sending DNS queries over IPv6. You can also use the DNS over HTTPS hostname to send queries using a DNS over HTTPS client.

If you think someone else is wrongfully using this IPv4 address, contact Cloudflare support.

### DNS over TLS (DoT)

DNS over TLS (DoT) is a standard for encrypting DNS traffic using its own port (853) and TLS encryption.

For more information, refer to DNS over TLS.

### DNS over HTTPS (DoH)

DNS over HTTPS (DoH) is a standard for encrypting DNS traffic via the HTTPS protocol, preventing tracking and spoofing of DNS queries.

Gateway requires a DoH endpoint for default DNS locations. For more information, refer to DNS over HTTPS.

## Secure DNS locations

Secure DNS locations provide additional protection against malicious domains for use in services such as protective DNS (PDNS). For a DNS location to be considered secure, Gateway requires that:

- Your IPv4 and IPv6 endpoints use your BYOIP addresses (if any).
- Source network filtering is configured for your IPv4, IPv6, and DoT endpoints.
- Source network filtering or token authentication are configured for your DoH endpoints.
- Any enabled endpoints for a DNS location meet security permissions.

You can assign users the Cloudflare Zero Trust DNS Locations Write role to grant them the permission to create and edit secure DNS locations. To allow users to view locations, you must also assign the Cloudflare Zero Trust Read Only role. Users with these roles can view any DNS location, but can only create or edit secure locations.

Roles that supersede Cloudflare Zero Trust DNS Locations Write include:

- Cloudflare Gateway
- Cloudflare Zero Trust
- Super Administrator

## Limitations

### Captive portals

Deploying Gateway DNS filtering using static IP addresses may prevent users from connecting to public Wi-Fi networks through captive portals. If users are experiencing connectivity issues related to captive portals, they should:

1. Remove the static IP addresses from the device.
2. Connect to the Wi-Fi network.
3. Once the connection has been established, add the static IP addresses back.

To avoid this issue, use the WARP client to connect your devices to Cloudflare Zero Trust.

### Third-party filtering

Gateway will not properly filter traffic sent through third-party VPNs or other Internet filtering software, such as iCloud Private Relay ‚Üó or Google Chrome IP Protection ‚Üó. To ensure your DNS policies apply to your traffic, Cloudflare recommends turning off software that may interfere with Gateway.

To turn off iCloud Private Relay, refer to the Apple user guides for macOS ‚Üó or iOS ‚Üó.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## DNS resolver IPs and hostnames

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/dns/locations/dns-resolver-ips/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/dns/locations/dns-resolver-ips/)

Page options # DNS resolver IPs and hostnames

When you create a DNS location, Gateway assigns IPv4/IPv6 addresses and DoT/DoH hostnames to that location. These are the IP addresses and hostnames you send your DNS queries to for Gateway to resolve.

To view the resolver endpoint IP addresses and hostnames for a DNS location:

1. In Zero Trust ‚Üó, go to Gateway > DNS locations.
2. Locate the DNS location, then select Configure.
3. Go to Setup instructions. The addresses and hostnames will appear in Your configuration.

## DNS query location matching

Gateway uses different methods to match a DNS query to DNS locations depending on the type of request and network:

```
flowchart TB
    %% Accessibility
    accTitle: How Gateway matches queries to DNS locations
    accDescr: Flowchart describing the order of checks Cloudflare Gateway performs to determine the DNS location of a DNS query.

    %% Flowchart
    router(["Router"])-->gateway["Cloudflare Gateway"]

    gateway-->query{{"Is the DNS query sent over HTTPS?"}}

    query--"Yes"-->hostname["Look up location by<br />unique hostname"]
    query--"No"-->ipv4{{"Is it over IPv4?"}}

    ipv4--"Yes"-->source["Look up location by<br />source IPv4 address"]
    ipv4--"No"-->destination["Look up location by<br />destination IPv6 address"]
```

1. First, Gateway checks whether the query was sent using DNS over HTTPS. If yes, Gateway looks up the DNS location by its unique hostname.
2. Next, if the query was not sent with DNS over HTTPS, Gateway checks whether it was sent over IPv4. If yes, it looks up the DNS location by the source IPv4 address.
3. Last, if the query was not sent over IPv4, it means it was sent over IPv6. Gateway will look up the DNS location associated with the query based on the unique DNS resolver IPv6 address.

## IPv4/IPv6 address

### Source IP

Gateway uses the public source IPv4 address of your network to identify your DNS location, apply policies, and log DNS requests. Unless you have purchased a dedicated IPv4 resolver IP, you must provide source IP addresses for the IPv4 traffic you want to filter with DNS policies. Otherwise, Gateway will not be able to attribute the traffic to your account.

If you are on an Enterprise plan, you have the option of manually entering one or more source IP addresses of your choice. This enables you to create Gateway DNS locations even if you are not connecting from any of those networks' IP addresses.

### DNS resolver IP

When you create a DNS location, Gateway will resolve queries over IPv4 with the default DNS resolver IP addresses. These addresses are anycast IP addresses shared across every Cloudflare Zero Trust account. To resolve queries over IPv6, your location will receive and use a unique DNS resolver IPv6 address. These IP addresses are how Gateway will match DNS queries to locations and apply the appropriate filtering rules.

#### Dedicated DNS resolver IP

Enterprise users can request a dedicated DNS resolver IPv4 address to be provisioned for a DNS location instead of the default anycast addresses. Queries forwarded to that address will be identified using the dedicated DNS resolver IPv4 address.

Cloudflare will only assign resolver IP addresses to the Zero Trust account you request. For more information on requesting dedicated DNS resolver IPv4 addresses, contact your account team.

#### Bring your own DNS resolver IP

Enterprise users can use their own authority-provided IPv4 and IPv6 addresses as DNS endpoints for a location. Gateway can resolve UDP, TCP, DoT, and DoH queries through the IPv4 addresses provided, as well as UDP and TCP queries through the IPv6 addresses provided.

After you onboard your IP addresses, the IP addresses will appear under the associated endpoint when you create a new DNS location. If you did not provide IP addresses for a specific endpoint type, you can use the default Cloudflare resolver IPs or dedicated resolver IPs alongside your own resolver IPs. For example, if you want to use the IPv6 endpoint but only provided IPv4 addresses, you can use your own resolver IPs for IPv4 and the default Cloudflare IPs for IPv6.

For more information, refer to Cloudflare BYOIP or contact your account team.

## DNS over TLS (DoT)

Each DNS location is assigned a unique hostname for DNS over TLS (DoT). Gateway will identify your location based on its DoT hostname.

## DNS over HTTPS (DoH)

Each DNS location is assigned a unique hostname for DNS over HTTPS (DoH). Gateway will identify your location based on its DoH hostname.

### DoH subdomain

Each DNS location in Cloudflare Zero Trust has a unique DoH subdomain (previously known as unique ID). If your organization uses DNS policies, you can enter your location's DoH subdomain as part of the WARP client settings.

For example, for the DoH hostname https://65y9p2vm1u.cloudflare-gateway.com/dns-query, the DoH subdomain is 65y9p2vm1u.

## Send specific queries to Gateway

By default, all queries from a configured DNS location will be sent to its DNS resolver IP address to be inspected by Gateway. You can configure Gateway to only filter queries originating from specific networks within a location:

1. Create an IP list with the IPv4 and/or IPv6 addresses that your organization will source queries from.
2. Add a Source IP condition to your DNS policies.

For example, to block security threats for specific networks, you could create the following policy:

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Security Categories | in | Select all categories that apply | And | Block |
| Source IP | in list | The name of the IP list containing your organization's networks |  |  |

DNS queries made from IP addresses that are not in your IP list will not be filtered or populate your organization's Gateway activity logs.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## DNS over TLS (DoT)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/dns/dns-over-tls/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/dns/dns-over-tls/)

Page options # DNS over TLS (DoT)

By default, DNS is sent over a plaintext connection. DNS over TLS (DoT) is a standard for encrypting DNS queries to keep them secure and private. DoT uses the same security protocol, TLS, that HTTPS websites use to encrypt and authenticate communications.

Cloudflare supports DoT on standard port 853 over TLS 1.2 and TLS 1.3 in compliance with RFC7858 ‚Üó.

## Configure DoT queries

### 1. Obtain your DoT hostname

Each Gateway DNS location has a unique DoT hostname. DNS locations and corresponding DoT hostnames have policies associated with them.

1. In Zero Trust ‚Üó, go to Gateway > DNS locations.
2. Add a new location or select an existing location from the list.
3. Under DoT endpoint, copy the value in DoT addresses.

The DoT hostname contains your unique location name. For example, if the DoT hostname is 9y65g5srsm.cloudflare-gateway.com, the location name is 9y65g5srsm.

### 2. Configure your DoT client

To configure a DoT client such as dig, specify the IP address and the DoT hostname for your location in your query. For example:

```
Hostname: 9y65g5srsm.cloudflare-gateway.comIP address: 162.159.36.5
```

Alternatively, you can use the generic DoT endpoint (dns.cloudflare-gateway.com) and include an OPT record with code 65011. You can select a specific location for the value of the OPT record. For example:

```
Hostname: dns.cloudflare-gateway.comIP address: 162.159.36.5OPT Record:  - Code: 65011  - Value: 9y65g5srsm
```

Some stub resolvers support DoT natively. For example, you can configure Unbound to send a DoT query:

```
# Unbound TLS Configtls-cert-bundle: "/etc/ssl/cert.pem"# Forwarding Configforward-zone: name: "." forward-tls-upstream: yes forward-addr: 162.159.36.5@853#9y65g5srsm.cloudflare-gateway.com forward-addr: 2001:db8:abcd::1234#9y65g5srsm.cloudflare-gateway.com
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## DNS over HTTPS (DoH)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/dns/dns-over-https/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/dns/dns-over-https/)

Page options # DNS over HTTPS (DoH)

With Cloudflare Gateway, you can filter DNS over HTTPS (DoH) requests by DNS location or by user without needing to install the WARP client on your devices.

Location-based policies require that you send DNS requests to a location-specific DoH endpoint, while identity-based policies require that requests include a user-specific DoH token.

## Filter DoH requests by location

Location-based policies require that you send DNS queries to a unique DoH endpoint assigned to the location:

```
https://<YOUR_DOH_SUBDOMAIN>.cloudflare-gateway.com/dns-query
```

### Prerequisites

Obtain your location's DoH subdomain.

### Configure browser for DoH

Browsers can be configured to use any DNS over HTTPS (DoH) endpoint. If you choose to configure DoH directly in your browser, you must choose a Gateway DNS location as your DoH endpoint, otherwise DNS filtering will not occur in that browser.

Mozilla Firefox

1. In Firefox, go to Settings.
2. In Privacy & Security, go to DNS over HTTPS.
3. Under Enable secure DNS using, select Max Protection.
4. In Choose provider, choose Custom.
5. In the field, enter https://<YOUR_DOH_SUBDOMAIN>.cloudflare-gateway.com/dns-query.

Firefox is now configured to use your DoH endpoint. For more information on configuring DoH settings in Firefox, refer to Mozilla's documentation ‚Üó.

Note

If you want to enforce DNS policies through WARP instead of over DoH, you can disable DoH for your organization by blocking the Firefox DoH canary domain ‚Üó.

Google Chrome

1. In Chrome, go to Settings > Privacy and security > Security.
2. Scroll down and turn on Use secure DNS.
3. Select With Custom.
4. In the Enter custom provider field, enter https://<YOUR_DOH_SUBDOMAIN>.cloudflare-gateway.com/dns-query.

Read more about enabling DNS over HTTPS ‚Üó on Chrome.

Microsoft Edge

1. In Microsoft Edge, go to Settings.
2. Select Privacy, Search, and Services, and scroll down to Security.
3. Turn on Use secure DNS.
4. Select Choose a service provider.
5. In the Enter custom provider field, enter https://<YOUR_DOH_SUBDOMAIN>.cloudflare-gateway.com/dns-query.

Brave

1. In Brave, go to Settings > Security and Privacy > Security.
2. Turn on Use secure DNS.
3. Select With Custom.
4. In the Enter custom provider field, enter https://<YOUR_DOH_SUBDOMAIN>.cloudflare-gateway.com/dns-query.

Safari

Currently, Safari does not support DNS over HTTPS.

Your DNS queries will now be sent to Gateway for filtering. To filter these requests, build a DNS policy using the DNS Location selector.

### Configure operating system for DoH

Windows 11

1. Obtain the A and AAAA record values associated with your location's DoH endpoint.

Run the following command to obtain your A record values:

PowerShellnslookup -type=A <your-subdomain>.cloudflare-gateway.com

Obtain your AAAA record values.

PowerShellnslookup -type=AAAA <your-subdomain>.cloudflare-gateway.com

Copy the resulting IP addresses.
2. Run the following command to obtain your A record values:
3. Obtain your AAAA record values.
4. Copy the resulting IP addresses.
5. Add the addresses to your list of known DoH servers.

Run the following command for each address:

PowerShellAdd-DnsClientDohServerAddress -ServerAddress <IP-address> -DohTemplate https://<your-subdomain>.cloudflare-gateway.com/dns-query -AllowFallbackToUdp $False -AutoUpgrade $False

Confirm the addresses were added.

PowerShellGet-DnsClientDohServerAddress
6. Run the following command for each address:
7. Confirm the addresses were added.
8. In Windows, go to Settings > Network & internet > your active Internet connection. This option may be either Ethernet or Wi-Fi.
9. Under DNS server assignment, select Edit.
10. In the drop-down menu, choose Manual.
11. Enable IPv4.
12. In Preferred DNS and Alternate DNS, enter the IPv4 addresses from your A record command. Set DNS over HTTPS to On (automatic template).
13. Enable IPv6.
14. In Preferred DNS and Alternate DNS, enter the IPv6 addresses from your AAAA record command. Set DNS over HTTPS to On (automatic template).

Windows Server 2022

Obtain the A and AAAA record values associated with your location's DoH endpoint.

1. Run the following command to obtain your A record values:

PowerShell ```
nslookup -type=A <your-subdomain>.cloudflare-gateway.com
```

1. Obtain your AAAA record values.

PowerShell ```
nslookup -type=AAAA <your-subdomain>.cloudflare-gateway.com
```

1. Copy the resulting IP addresses.
2. Add the addresses ‚Üó to your list of known DoH servers.
3. Configure the Windows Server client ‚Üó or set up a Group Policy ‚Üó to use DoH.

For more information, refer to Microsoft's DoH guide ‚Üó for Windows Server 2022 and newer.

### Use generic DoH endpoint

You can send DoH requests to the generic Cloudflare DoH endpoint, dns.cloudflare-gateway.com. To specify a location in your request, include a header named cf-dns-location with a value of your location's DoH subdomain. For example:

```
GET /dns-query?name=example.com&type=A HTTP/2Host: dns.cloudflare-gateway.comcf-dns-location: 9y65g5srsmAccept: application/dns-message
```

## Filter DoH requests by user

In order to filter DoH queries based on user identity, each query must include a user-specific authentication token. If you have several devices per user and want to apply device-specific policies, you will need to map each device to a different email.

Currently, authentication tokens can only be generated through the API. You can run this interactive Python script which automates the setup procedure, or follow the steps described below.

### 1. Create a service token for the account

Each Cloudflare account can only have one active Access service token authorized for DNS over HTTPS (DoH) at a time.

Terminal window ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/service_tokens" \--header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \--header "Content-Type: application/json" \--data '{"name":"ACME Corporation service token"}'
```

Save the service token's client_id, client_secret, and id.

Example response

```
{  "result": {    "client_id": "88bf3b6d86161464f6509f7219099e57.access",    "client_secret": "bdd31cbc4dec990953e39163fbbb194c93313ca9f0a6e420346af9d326b1d2a5",    "created_at": "2022-06-09T01:59:17Z",    "expires_at": "2023-06-09T01:59:17Z",    "id": "f174e90a-fafe-4643-bbbc-4a0ed4fc8415",    "name": "ACME Corporation service token",    "updated_at": "2022-06-09T01:59:17Z"  },  "success": true,  "errors": [],  "messages": []}
```

### 2. Enable DoH functionality for the service token

Terminal window ```
curl --request PUT \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/organizations/doh/$SERVICE_TOKEN_ID" \--header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
```

If you get an access.api.error.service_token_not_found error, check that $SERVICE_TOKEN_ID is the value of id and not client_id.

Note

Although you can create multiple valid service tokens, only one service token can be designated for issuing DoH tokens. Calling the API to enable DoH on a new service token replaces the previously active service token. If a new token overrides an active service token, the API call will fail.

Example response

```
{  "result": {    "client_id": "88bf3b6d86161464f6509f7219099e57.access",    "created_at": "2022-06-09T01:59:17Z",    "expires_at": "2023-06-09T01:59:17Z",    "id": "f174e90a-fafe-4643-bbbc-4a0ed4fc8415",    "name": "ACME Corporation service token",    "updated_at": "2022-06-09T01:59:17Z",    "duration": "8760h"  },  "success": true,  "errors": [],  "messages": []}
```

### 3. Create a user

Create a new user and optionally add them to a group.

Terminal window ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/users" \--header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \--header "Content-Type: application/json" \--data '{  "name": "John Doe",  "email": "jdoe@acme.com",  "custom": {"groups":[{"id": "02fk6b3p3majl10", "email": "finance@acme.com", "name": "Finance"}]}}'
```

Save the user's id returned in the response.

Example response

```
{  "result": {    "id": "54d425de-7a78-4186-9975-d43c88ee7899",    "created_at": "2022-03-16T21:18:39.93598Z",    "updated_at": "2022-05-17T23:50:39.598345Z",    "uid": "54d425de-7a78-4186-9975-d43c88ee7899",    "name": "John Doe",    "email": "jdoe@acme.com",    "custom": {      "groups": [        {          "email": "finance@acme.com",          "id": "02fk6b3p3majl10",          "name": "Finance"        }      ]    }  },  "success": true,  "errors": [],  "messages": []}
```

Note

Steps 1-3 above only need to be completed once, while Steps 4-5 below would occur during normal operation.

### 4. Generate a DoH token for the user

Request a DoH token for the user, using your service token to authenticate into your team domain.

Terminal window ```
curl "https://<TEAM_NAME>.cloudflareaccess.com/cdn-cgi/access/doh-token?account-id=<ACCOUNT_ID>&user-id=<USER_ID>&auth-domain=<TEAM_NAME>.cloudflareaccess.com" \--header "Cf-Access-Client-Id: <CLIENT_ID>" \--header "Cf-Access-Client-Secret: <CLIENT_SECRET>"
```

The response contains a unique DoH token associated with the user. This token expires in 24 hours. We recommend setting up a refresh flow for the DoH token instead of generating a new one for every DoH query.

Example response

```
{  "token": "y2khbGciOiJSUzI1NiIsImtpZCI6ImJlZjVkYjg4ZTEwMjk3ZDEwNzhkMmEyYjE0MjMxZTljYTQwMjQ2NjAwOTQzNmJhOTQwOGJkODY3ZmI4OWFiOGQifQ.eyJ0eXBlIjoiZG9oIiwiYXVkIjoiY2xvdWRmbGFyZS1nYXRld2F5LmNvbSIsImlhdCI6MTY1NDc1MTg3NSwiZXhwIjoxNjU0ODM4Mjc1LCJhY2NvdW50LWlkIjoiMTA4MDM0OGIyZGYzYmQwN2QxZmI1MjM3Y2Q1ZDU5M2EiLCJ1c2VyLWlkIjoiNTRkNDI1ZGUtN2E3OC00MTg2LTk5NzUtZDQzYzg4ZWU3ODk5In0.I5p4WsH2dPhQ8vwy84zF05PsoBHCsUSXAaMpNhEH36oFZ3tXcs9ksLz7OzpZ_x3HxUfO3n57LlpAF1VehaBt2i94XCkvSgtHpYcwd_qZydLp-BGtcyfU1LbdXQC3m6zxKcIWu5VySi8I-J25UYlpyJhYgZ4DQUZIpqbSSt6WcVRKvA7OBa7xjkTux4OcqWAViO_ZS-GLwl-fqhvolmiwk37seBD3YuV1zG06VeWXfrMkZ5MbhooHD1DZDBHOZpTtmN8MbeKeI4tlY1mb_O3-jE-um6F9Hrl4NQm89MKFzsum-_Rywi5m4PTSlDza7fjdJs7RzFgJd3VWgzG-jgyQKw"}
```

### 5. Send an authenticated DoH query

Send DoH queries to the resolver at https://<ACCOUNT_ID>.cloudflare-gateway.com/dns-query, making sure to include the user's DoH token in the CF-Authorization header.

Terminal window ```
curl --silent "https://<ACCOUNT_ID>.cloudflare-gateway.com/dns-query?name=example.com" \--header "accept: application/dns-json" \--header "CF-Authorization: <USER_DOH_TOKEN>" | jq
```

If the site is blocked and you have turned on the block page for the policy, the query will return 162.159.36.12 (the IP address of the Gateway block page). If the block page is disabled, the response will be 0.0.0.0.

Example response

```
{  "Status": 0,  "TC": false,  "RD": true,  "RA": true,  "AD": false,  "CD": false,  "Question": [    {      "name": "example.com",      "type": 1    }  ],  "Answer": [    {      "name": "example.com",      "type": 1,      "TTL": 60,      "data": "162.159.36.12"    }  ]}
```

You can verify that the request was associated with the correct user email by checking your Gateway DNS logs. To filter these requests, build a DNS policy using any of the Gateway identity-based selectors.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## PAC files

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/pac-files/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/pac-files/)

Page options # PAC files

Note

Only available on Enterprise plans.

You can apply Gateway HTTP and DNS policies at the browser level by configuring a Proxy Auto-Configuration (PAC) file to connect to a proxy endpoint.

A PAC file is a file containing a JavaScript function which can instruct a browser to forward traffic to a proxy server instead of directly to the destination server.

When end users visit a website, their browser will send the request to a Cloudflare proxy server associated with your account to be filtered by Gateway. Note that Gateway cannot filter every type of HTTP traffic proxied using PAC files.

## Prerequisites

Install a Cloudflare certificate on your device.

## 1. Generate a proxy endpoint

You can generate a proxy endpoint on the Zero Trust dashboard or through the Cloudflare API.

Warning

All devices you add to the proxy endpoint will be able to access your Cloudflare Tunnel applications and services. If you only want to proxy web traffic, you can build a network policy that blocks those source IPs from connecting to your internal resources.

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Gateway > Proxy endpoints.
2. Select Create endpoint.
3. Give your endpoint any name.
4. Enter the public source IP address of your device(s) in CIDR notation. For example:

IPv4: 192.0.2.0/8
IPv6: 2001:0db8:0000:0000:0000:1234:5678:0000/109

NoteGateway limits the prefix length of source networks for proxy endpoints to /8 for IPv4 networks and /32 for IPv6 networks.
5. IPv4: 192.0.2.0/8
6. IPv6: 2001:0db8:0000:0000:0000:1234:5678:0000/109
7. Select Save endpoint and confirm the endpoint creation.

Your Cloudflare proxy server domain is of the form:

```
https://<SUBDOMAIN>.proxy.cloudflare-gateway.com
```

1. Create a proxy endpoint with the following call:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Zero Trust Write Create a proxy endpointcurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/proxy_endpoints" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "any_name",    "ips": [        "<PUBLIC_IP>",        "<PUBLIC_IP2>",        "<PUBLIC_IP3>"    ]  }'
Replace <PUBLIC_IP> with the source IP address of your device in CIDR notation. For example:

IPv4: 192.0.2.0/8
IPv6: 2001:0db8:0000:0000:0000:1234:5678:0000/32

NoteGateway limits the prefix length of source networks for proxy endpoints to /8 for IPv4 networks and /32 for IPv6 networks.
2. Zero Trust Write
3. IPv4: 192.0.2.0/8
4. IPv6: 2001:0db8:0000:0000:0000:1234:5678:0000/32
5. After running the call, you should see an output similar to
{  "result": {    "id": "d969d7bf-ec28-4291-9af0-86825f472c21",    "name": "test",    "created_at": "2022-03-02T10:57:18.094789Z",    "updated_at": "2022-03-02T10:57:18.094789Z",    "ips": ["90.90.241.229/8"],    "subdomain": "3ele0ss56t"  },  "success": true,  "errors": [],  "messages": []}
Note the subdomain value returned by the API. Your Cloudflare proxy server domain is of the form:
<SUBDOMAIN>.proxy.cloudflare-gateway.com
In the example above, the subdomain is 3ele0ss56t and the proxy server domain is 3ele0ss56t.proxy.cloudflare-gateway.com.

## 2. Test your proxy server

1. In Zero Trust ‚Üó, create an HTTP policy for testing purposes. For example:

















SelectorOperatorValueActionDomaininexample.comBlock
2. Verify that nothing is returned by a curl command:
Terminal windowcurl --ipv4 --proxytunnel --proxy https://3ele0ss56t.proxy.cloudflare-gateway.com https://example.com

If curl returns a 403 code, it means the public IP of your device does not match the one used to generate the proxy server. Make sure that WARP is turned off on your device and double-check that curl is not using IPv6 (use the -4 option to force IPv4).

## 3. Create a PAC file

A PAC file is a text file that specifies which traffic should redirect to the proxy server.

Below is the default PAC file. You can customize the file ‚Üó and host it somewhere your browser can access, such as on an internal web server or on Cloudflare Workers.

```
function FindProxyForURL(url, host) {  // No proxy for private (RFC 1918) IP addresses (intranet sites)  if (    isInNet(dnsResolve(host), "10.0.0.0", "255.0.0.0") ||    isInNet(dnsResolve(host), "172.16.0.0", "255.240.0.0") ||    isInNet(dnsResolve(host), "192.168.0.0", "255.255.0.0")  ) {    return "DIRECT";  }
  // No proxy for localhost  if (isInNet(dnsResolve(host), "127.0.0.0", "255.0.0.0")) {    return "DIRECT";  }
  // Proxy all  return "HTTPS 3ele0ss56t.proxy.cloudflare-gateway.com:443";}
```

Note

- Make sure the directive used for the endpoint is HTTPS and not PROXY.
- You must use a PAC file instead of configuring the endpoint directly in the proxy configuration of the browser. This is because modern browsers still do not support HTTPS proxies without PAC files.
- Use a proper text editor such as VS Code to avoid added characters.

## 4. Configure your devices

All major browsers support PAC files. You can configure individual browsers, or you can configure system settings that apply to all browsers on the device. Multiple devices can call the same PAC file as long as their source IP addresses were included in the proxy endpoint configuration.

Chromium-based browsers

Chromium-based browsers (such as Google Chrome, Microsoft Edge, and Brave) rely on your operating system's proxy server settings. To configure your browser to use Gateway with PAC files, refer to the macOS ‚Üó or Windows ‚Üó documentation.

Mozilla Firefox

1. In Firefox, go to Settings and scroll down to Network Settings.
2. Select Settings.
3. Select Automatic proxy configuration URL.
4. Enter the URL where your PAC file is hosted, for example https://proxy-pac.cflr.workers.dev/3ele0ss56t.pac.
5. Select OK. HTTP traffic from Firefox is now being filtered by Gateway.

Safari

Safari relies on your operating system's proxy server settings. To configure your browser to use Gateway with PAC files, refer to the macOS documentation ‚Üó.

## 5. Test your HTTP policy

To test your configuration, you can test any supported HTTP policy, such as the example policy created in Step 2. When you go to https://example.com in your browser, you should see the Gateway block page.

You can now use the Proxy Endpoint selector in network and HTTP policies to filter traffic proxied via PAC files.

## Configure firewall

You may need to configure your organization's firewall to allow your users to connect to a proxy endpoint. Depending on your firewall, you will need to create a rule using either your proxy endpoint's domain or IP addresses.

To get the domain of a proxy endpoint:

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Gateway > Proxy endpoints.
2. Choose the proxy endpoint. Select Edit.
3. In Proxy Endpoint, copy the domain.

1. Use the List proxy endpoints operation to get a list of your proxy endpoints and their details. For example:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Zero Trust ReadZero Trust Write List proxy endpointscurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/proxy_endpoints" \  --request GET \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
{  "success": true,  "result": {    "id": "ed35569b41ce4d1facfe683550f54086",    "created_at": "2014-01-01T05:20:00.12345Z",    "ips": ["192.0.2.1/32"],    "name": "DevOps team",    "subdomain": "oli3n9zkz5.proxy.cloudflare-gateway.com",    "updated_at": "2014-01-01T05:20:00.12345Z"  }}
2. Zero Trust Read
3. Zero Trust Write
4. Find the proxy endpoint you want to use.
5. Copy the value of the subdomain key.

Using your proxy endpoint's domain, you can get the IP addresses assigned to the proxy endpoint:

- macOS and Linux
- Windows

1. Open a terminal.
2. Run dig on your proxy endpoint's A records to get its IPv4 addresses. For example:
Terminal windowdig A example.cloudflare-gateway.com +short
162.159.36.5162.159.36.20
3. Run dig on your proxy endpoint's AAAA records to get its IPv6 addresses. For example:
Terminal windowdig AAAA example.cloudflare-gateway.com +short
2606:4700:54::a29f:24072606:4700:5c::a29f:2e07

1. Open a PowerShell terminal.
2. Run Resolve-DnsName on your proxy endpoint's A records. Your proxy endpoint's IPv4 addresses will appear under IPAddress. For example:
PowerShellResolve-DnsName -Name example.cloudflare-gateway.com -Type A
Name                                           Type   TTL   Section    IPAddress----                                           ----   ---   -------    ---------example.cloudflare-gateway.com                 A      300   Answer     162.159.36.5example.cloudflare-gateway.com                 A      300   Answer     162.159.36.20
3. Run Resolve-DnsName on your proxy endpoint's AAAA records. Your proxy endpoint's IPv6 addresses will appear under IPAddress. For example:
PowerShellResolve-DnsName -Name example.cloudflare-gateway.com -Type AAAA
Name                                           Type   TTL   Section    IPAddress----                                           ----   ---   -------    ---------example.cloudflare-gateway.com                 AAAA   300   Answer     2606:4700:5c::a29f:2e07example.cloudflare-gateway.com                 AAAA   300   Answer     2606:4700:54::a29f:2407

To ensure responses are allowed through your firewall, add an inbound rule to allow the static IPv4 address for Cloudflare proxy endpoints, 162.159.193.21.

## Limitations

### Traffic limitations

The agentless HTTP proxy does not support identity-based policies or mTLS authentication.

To enforce HTTP policies for UDP traffic, you must turn on the Gateway proxy for UDP.

### Gateway DNS and resolver policies

Gateway DNS and resolver policies will always apply to traffic proxied via PAC files, regardless of device configuration.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## User-side certificates

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/user-side-certificates/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/user-side-certificates/)

Page options # User-side certificates

Advanced security features such as HTTPS traffic inspection, Data Loss Prevention, anti-virus scanning, Access for Infrastructure, and Browser Isolation require users to install and trust a root certificate on their device. You can either install the certificate provided by Cloudflare (default option), or generate your own custom certificate and upload it to Cloudflare.

Zero Trust generates a unique root CA for each account and deploys it across the Cloudflare global network. Alternatively, Enterprise users can upload and deploy their own custom certificate.

Default certificate expired on 2025-02-02

The default Cloudflare certificate expired on 2025-02-02 at 16:05 UTC.

Review how this change impacts certificate propagation to your end-user devices and how to address browser issues in Troubleshooting.

## Certificate status

Zero Trust will indicate if a certificate is ready for use in inspection based on its deployment status:

| Deployment status | Description |
| --- | --- |
| Inactive | The certificate has been generated by or uploaded to Cloudflare but is not deployed across the global network. |
| Pending | The certificate is being activated or deactivated for use. |
| Available | The certificate is deployed across the Cloudflare global network and ready to be turned on. The WARP client will install the certificate on your users' devices. |
| Available and In-Use | The certificate is turned on. Gateway will use the certificate for inspection. |

## Generate a Cloudflare root certificate

To generate a new Cloudflare root certificate for your Zero Trust organization:

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Settings > Resources.
2. In Certificates, select Manage.
3. Select Generate certificate.
4. Choose a duration of time before the certificate expires. Cloudflare recommends expiration after five years. Alternatively, choose Custom and enter a custom amount in days.
5. Select Generate certificate.

Send a POST request to the Create Zero Trust certificate endpoint.

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create Zero Trust certificate ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/certificates" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
```

The API will respond with the ID and contents of the new certificate.

The certificate will appear in your list of certificates as Inactive. To download a generated certificate, select it, then choose Download .pem and/or Download .crt. To deploy your certificate and turn it on for inspection, you need to activate the certificate.

Each Zero Trust account can generate a new root certificate a maximum of three times per day.

## Activate a root certificate

Note

Zero Trust accounts using the default Cloudflare certificate prior to 2024-10-17 will need to redeploy and activate the newly generated certificate. Zero Trust accounts created during or after 2024-10-17 will use an available certificate by default.

Once a certificate is generated in or uploaded to Zero Trust, you need to activate it. Activating a certificate deploys it across the Cloudflare network and sets its status to Available. You can have up to 10 available certificates at once.

To activate your root certificate:

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Settings > Resources.
2. In Certificates, select Manage.
3. Select the certificate you want to activate.
4. Select Activate.

Send a POST request to the Activate a Zero Trust certificate endpoint.

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Activate a Zero Trust certificate ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/certificates/$CERTIFICATE_ID/activate" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
```

The status of the certificate will change to Pending while it deploys. Once the status of your certificate is Available, you can install it on your user's devices either with WARP or manually.

Once you deploy and install your certificate, you can turn it on for use in inspection:

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Settings > Resources.
2. In Certificates, select Manage.
3. Select the certificate you want to turn on.
4. In Basic information, select Confirm and turn on certificate.

Send a PUT request to the Update Zero Trust account configuration endpoint. For example:

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Update Zero Trust account configuration ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/configuration" \  --request PUT \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "settings": {        "certificate": {            "id": "{certificate_id}",            "in_use": true        }    }  }'
```

You can set multiple certificates to Available, but you can only turn on one certificate for use in inspection at a time. Setting a certificate as In-Use will set any other in-use certificates as Available only and prevent them from being used for inspection until turned on again.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Install certificate using WARP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/user-side-certificates/automated-deployment/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/user-side-certificates/automated-deployment/)

Page options # Install certificate using WARP

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| All modes | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.12.554.0 |
| macOS | ‚úÖ | 2024.12.554.0 |
| Linux * | ‚úÖ | 2024.12.554.0 |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

* Only supported on Debian-based systems.

The WARP client can automatically install a Cloudflare certificate or custom root certificate on Windows, macOS, and Debian/Ubuntu Linux devices. On mobile devices and Red Hat-based systems, you will need to install the certificate manually.

The certificate is required if you want to apply HTTP policies to encrypted websites, display custom block pages, and more.

## Install a certificate using WARP

Out of date certificates

WARP versions prior to 2024.12.554.0 will only install the certificate set to In-Use and automatically remove any other WARP-installed certificates from your users' devices. To ensure your users' devices have all of your available certificates installed, update WARP.

To configure WARP to install a root certificate on your organization's devices:

1. (Optional) Upload a custom root certificate to Cloudflare.
2. In Zero Trust ‚Üó, go to Settings > WARP Client.
3. Turn on Install CA to system certificate store.
4. Install the WARP client on the device.
5. Enroll the device in your Zero Trust organization.
6. (Optional) If the device is running macOS Big Sur or newer, manually trust the certificate.

WARP will now download any certificates set to Available. After download, WARP will add the certificates to the device's system certificate store in installed_certs/<certificate_id>.pem and append the contents to the installed_cert.pem file. If you have any scripts using installed_cert.pem, Cloudflare recommends you set them to use the individual files in the installed_certs/ directory instead. installed_certs.pem will be deprecated by 2025-06-31.

Note

It may take up to 10 minutes for newly updated settings to propagate to devices.

WARP does not install certificates to individual applications. You will need to manually add certificates to applications that rely on their own certificate store instead of the system certificate store.

## Access the installed certificate

After installing the certificate using WARP, you can verify successful installation by accessing the device's system certificate store.

### macOS

To access the installed certificate in macOS:

1. Open Keychain Access.
2. In System Keychains, go to System > Certificates.
3. Open your certificate. The default Cloudflare certificate name is Gateway CA - Cloudflare Managed G1.
4. If the certificate is trusted by all users, Keychain Access will display This certificate is marked as trusted for all users.

The WARP client will also place the certificate in /Library/Application Support/Cloudflare/installed_cert.pem for reference by scripts or tools.

#### Manually trust the certificate

macOS Big Sur and newer do not allow WARP to automatically trust the certificate. To manually trust the certificate:

1. In Keychain Access, find and open the certificate.
2. Open Trust.
3. Set When using this certificate to Always Trust.
4. (Optional) Restart the device to reset connections to Zero Trust.

Alternatively, you can configure your mobile device management (MDM) to automatically trust the certificate on all of your organization's devices.

### Windows

To access the installed certificate in Windows:

1. Open the Start menu and select Run.
2. Enter certlm.msc.
3. Go to Trusted Root Certification Authority > Certificates. The default Cloudflare certificate name is Gateway CA - Cloudflare Managed G1.

The WARP client will also place the certificate in %PROGRAMDATA%\Cloudflare\installed_cert.pem for reference by scripts or tools.

### Debian-based Linux distributions

On Debian-based Linux distributions, the certificate is stored in /usr/local/share/ca-certificates. The default installed Cloudflare certificate name is managed-warp.pem. The WARP client will create a symbolic link named managed-warp.crt to use as its root certificate. If your system is not using managed-warp.crt, run the following commands to update the system store:

1. Update your list of custom CA certificates.
Terminal windowsudo update-ca-certificates
2. Go to the system certificate store.
Terminal windowcd /usr/local/share/ca-certificates
3. Verify your system has both the managed-warp.pem file and the managed-warp.crt symbolic link. For example:
Terminal windowls -l
lrwxrwxrwx 1 root root   49 Jan  3 21:46 managed-warp.crt -> /usr/local/share/ca-certificates/managed-warp.pem-rw-r--r-- 1 root root 1139 Jan  3 21:46 managed-warp.pem

The WARP client will also place the certificate in /var/lib/cloudflare-warp/installed_cert.pem for reference by scripts or tools.

## Uninstall the certificate

If the certificate was installed by the WARP client, it is automatically removed when you turn on another certificate for inspection in Zero Trust, turn off Install CA to system certificate store, or uninstall WARP. WARP does not remove certificates that were installed manually (for example, certificates added to third-party applications).

To manually remove the certificate, refer to the instructions supplied by your operating system or the third-party application.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Install certificate manually

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/user-side-certificates/manual-deployment/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/user-side-certificates/manual-deployment/)

Page options # Install certificate manually

Note

This procedure is only required to enable specific Cloudflare Zero Trust features, and should only be done at the direction of your IT department. This procedure is not required to enable the WARP client for consumers.

If your device does not support certificate installation via WARP, you can manually install a Cloudflare certificate. You must add the certificate to both the system keychain and to individual application stores. These steps must be performed on each new device that is to be subject to HTTP filtering.

Zero Trust will only inspect traffic using installed certificates set to Available and In-Use.

## Download the Cloudflare root certificate

Download limitation

You can only download Cloudflare-generated certificates from the Zero Trust dashboard or with WARP.

First, generate and download a Cloudflare certificate. The certificate is available in both .pem and .crt file format. Certain applications require the certificate to be in a specific file type, so ensure you download the most appropriate file for your use case.

1. In Zero Trust ‚Üó, go to Settings > Resources.
2. In Certificates, select Manage.
3. Select the certificate you want to download.
4. Depending on which format you want, choose Download .pem and/or Download .crt.

Alternatively, you can download and install a certificate using WARP. WARP will add the certificates to the device's system certificate store in installed_certs/<certificate_id>.pem.

### Verify the downloaded certificate

To verify your download, use a terminal to check that the downloaded certificate's hash matches the thumbprint listed under Certificate thumbprint. For example:

#### SHA1

SHA1 .crt example ```
openssl x509 -noout -fingerprint -sha1 -inform der -in <certificate.crt>
```

```
SHA1 Fingerprint=BB:2D:B6:3D:6B:DE:DA:06:4E:CA:CB:40:F6:F2:61:40:B7:10:F0:6C
```

SHA1 .pem example ```
openssl x509 -noout -fingerprint -sha1 -inform pem -in <certificate.pem>
```

```
SHA1 Fingerprint=BB:2D:B6:3D:6B:DE:DA:06:4E:CA:CB:40:F6:F2:61:40:B7:10:F0:6C
```

#### SHA256

SHA256 .crt example ```
openssl x509 -noout -fingerprint -sha256 -inform der -in <certificate.crt>
```

```
sha256 Fingerprint=F5:E1:56:C4:89:78:77:AD:79:3A:1E:83:FA:77:83:F1:9C:B0:C6:1B:58:2C:2F:50:11:B3:37:72:7C:62:3D:EF
```

SHA256 .pem example ```
openssl x509 -noout -fingerprint -sha256 -inform pem -in <certificate.pem>
```

```
sha256 Fingerprint=F5:E1:56:C4:89:78:77:AD:79:3A:1E:83:FA:77:83:F1:9C:B0:C6:1B:58:2C:2F:50:11:B3:37:72:7C:62:3D:EF
```

### Convert the certificate

Some applications require a certificate formatted in the .cer file type. You can convert your downloaded certificate using OpenSSL ‚Üó:

- macOS and Linux
- Windows

1. Install OpenSSL ‚Üó.
2. Download a Cloudflare certificate in .pem format.
3. In a terminal, convert the certificate to DER format with the .cer file type:
Terminal windowopenssl x509 -inform PEM -in ~/Downloads/certificate.pem -outform DER -out ~/Downloads/certificate.cer

1. Install OpenSSL for Windows ‚Üó.
2. Download a Cloudflare certificate in .pem format.
3. In a PowerShell terminal, convert the certificate to DER format with the .cer file type:
PowerShellopenssl x509 -inform PEM -in "$HOME\Downloads\certificate.pem" -outform DER -out "$HOME\Downloads\certificate.cer"

## Add the certificate to operating systems

### macOS

In macOS, you can choose the keychain in which you want to install the certificate. Each keychain impacts which users will be affected by trusting the root certificate.

| Keychain | Access scope |
| --- | --- |
| login | The logged in user |
| Local Items | Users with access to cached iCloud passwords |
| System | All users on the system |

To install a Cloudflare certificate in macOS, you can use either the Keychain Access application or a terminal. Both methods require you to download a certificate in .crt format.

- Keychain Access
- Terminal

1. Download a Cloudflare certificate.

Open the .crt file in Keychain Access. If prompted, enter your local password.
In Keychain, choose the access option that suits your needs and select Add.
In the list of certificates, locate the newly installed certificate. Keychain Access will mark this certificate as not trusted. Right-click the certificate and select Get Info.
Select Trust. Under When using this certificate, select Always Trust.
2. Open the .crt file in Keychain Access. If prompted, enter your local password.
3. In Keychain, choose the access option that suits your needs and select Add.
4. In the list of certificates, locate the newly installed certificate. Keychain Access will mark this certificate as not trusted. Right-click the certificate and select Get Info.
5. Select Trust. Under When using this certificate, select Always Trust.

The root certificate is now installed and ready to be used.

1. Download a Cloudflare certificate.
2. Open Terminal.
3. Add the certificate to your keychain:

Terminal window ```
sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain <path-to-certificate.crt>
```

This keychain will allow all users on the system access to the certificate. If you want to install the certificate to a different keychain, replace System.keychain with the name of that keychain.

1. Update the OpenSSL CA Store to include the Cloudflare certificate:

Terminal window ```
echo | sudo tee -a /etc/ssl/cert.pem < certificate.pem
```

The root certificate is now installed and ready to be used.

Change certificate access scope

If you want to change user access to the Cloudflare certificate, you can open Keychain Access and move the certificate to a different keychain on the left sidebar.

### Windows

Windows offers two locations to install the certificate, each impacting which users will be affected by trusting the root certificate.

| Store location | Access scope |
| --- | --- |
| Current User Store | The logged in user |
| Local Machine Store | All users on the system |

1. Download a Cloudflare certificate.
2. Right-click the certificate file.
3. Select Open. If a security warning appears, choose Open to proceed.
4. The Certificate window will appear. Select Install Certificate.
5. Now choose a Store Location. If a security warning appears, choose Yes to proceed.
6. On the next screen, select Browse.
7. In the list, choose the Trusted Root Certification Authorities store.
8. Select OK, then select Finish.

The root certificate is now installed and ready to be used.

Warning

If your certificate is installed in the Local Machine Store, the device posture check looking for a certificate will fail. Install the certificate in the Current User Store to ensure a successful posture device check.

### Linux

The location where the root certificate should be installed is different depending on your Linux distribution. Follow the specific instructions for your distribution.

#### Debian-based distributions

The following procedure applies to Debian-based systems, such as Debian, Ubuntu, and Kali Linux.

1. Download a Cloudflare certificate in .pem format.
2. Install the ca-certificates package.
Terminal windowsudo apt-get install ca-certificates
3. Copy the certificate to the system, changing the file extension to .crt.
Terminal windowsudo cp certificate.pem /usr/share/ca-certificates/certificate.crt
4. Import the certificate.
Terminal windowsudo dpkg-reconfigure ca-certificates

#### Red Hat-based distributions

The following procedure applies to Red Hat-based systems, such as CentOS and Red Hat Enterprise Linux (RHEL).

1. Download a Cloudflare certificate in both .crt and .pem format.
2. Install the ca-certificates package.
Terminal windowsudo dnf install ca-certificates
3. Copy both certificates to the trust store.
Terminal windowsudo cp certificate.crt certificate.pem /etc/pki/ca-trust/source/anchors
4. Import the certificate.
Terminal windowsudo update-ca-trust

#### NixOS

NixOS does not use the system certificate store for self updating and instead relies on the certificates found in ~/.nix-profile/etc/ssl/certs or provided by NIX_SSL_CERT_FILE at runtime.

### iOS

1. In Safari, download a Cloudflare certificate in .pem format.
2. Open Files and go to Recents.
3. Find and open the downloaded certificate file. A message will appear confirming the profile was downloaded. Select Close.
4. Open Settings. Select the Profile Downloaded section beneath your Apple Account info. Alternatively, go to General > VPN & Device Management and select the Gateway CA - Cloudflare Managed G1 profile.
5. Select Install. If the iOS device is passcode-protected, you will be prompted to enter the passcode.
6. A certificate warning will appear. Select Install. If a second prompt appears, select Install again.
7. The Profile Installed screen will appear. Select Done. The certificate is now installed. However, before it can be used, it must be trusted by the device.
8. In Settings, go to General > About > Certificate Trust Settings. The installed root certificates will be displayed under Enable full trust for root certificates.
9. Turn on the Cloudflare certificate.
10. A security warning message will appear. Choose Continue.

The root certificate is now installed and ready to be used.

### Android

1. Download a Cloudflare certificate.
2. In Settings, go to Security > Advanced > Encryption & credentials > Install a certificate.
3. Select CA certificate.
4. Select Install anyway.
5. Verify your identity.
6. Choose the certificate file you want to install.

The root certificate is now installed and ready to be used.

### ChromeOS

ChromeOS devices use different methods to store and deploy root certificates. Certificates may fall under the VPN and apps or CA certificate settings. Follow the procedure that corresponds with your device.

- VPN and apps
- CA certificate

1. Download a Cloudflare certificate in .crt format.
2. Go to Settings > Apps > Google Play Store.
3. Select Manage Android preferences.
4. Go to Security & location > Credentials > Install from SD card.

1. In the file open dialog, choose the certificate.crt file you downloaded. Select Open.
2. Enter a name to identify the certificate. Ensure Credential use is set to VPN and apps.
3. Select OK.

1. Download a Cloudflare certificate in .crt format.
2. Go to Settings > Apps > Google Play Store.
3. Select Manage Android preferences.
4. Go to Security & location > Credentials > Install a certificate > CA certificate.

1. When prompted with a privacy warning, select Install anyway.
2. In the file open dialog, choose the certificate.crt file you downloaded. Select Open.
3. To verify the certificate is installed and trusted, go to Settings > Apps > Google Play Store > Manage Android Preferences > Security > Credentials > Trusted credentials > User.

After adding the Cloudflare certificate to ChromeOS, you may also have to install the certificate in your browser.

## Add the certificate to applications

Some packages, development tools, and other applications provide options to trust root certificates that will allow for the traffic inspection features of Gateway to work without breaking the application.

All of the applications below first require downloading a Cloudflare certificate with the instructions above. On macOS, the default path to the system keychain database file is /Library/Keychains/System.keychain. On Windows, the default path is \Cert:\CurrentUser\Root.

Note

Some applications require the use of a publicly trusted certificate ‚Äî they do not trust the system certificate, nor do they have a configurable private store. For these applications to function, you must add a Do Not Inspect policy for the domains or IPs that the application relies on.

### Browsers

#### Chrome

Versions of Chrome before Chrome 113 use the operating system root store ‚Üó on macOS and Windows. Chrome 113 and newer on macOS and Windows -- and all versions on Linux and ChromeOS -- use the Chrome internal trust store ‚Üó.

To install a Cloudflare certificate to Chrome manually:

1. Download a Cloudflare certificate in .pem format.
2. In Chrome, go to Settings > Privacy and security > Security.
3. Select Manage certificates.
4. Go to Authorities. Select Import.
5. In the file open dialog, choose the certificate.pem file you downloaded.
6. In the dialog box, turn on Trust this certificate for identifying websites, Trust this certificate for identifying email users, and Trust this certificate for identifying software makers. Select OK.
7. To verify the certificate was installed and trusted, locate it in Authorities.

For information on installing a Cloudflare certificate for organizations, refer to Google's Chrome Enterprise and Education documentation ‚Üó.

#### Firefox

To install a Cloudflare certificate to Firefox manually:

1. Download a Cloudflare certificate in .pem format.
2. In Firefox, go to Settings > Privacy & Security.
3. In Security, select Certificates > View Certificates.
4. In Authorities, select Import.
5. In the file open dialog, choose the certificate.pem file you downloaded.
6. In the dialog box, turn on Trust this CA to identify websites and Trust this CA to identify email users. Select OK.
7. To verify the certificate was installed and trusted, locate it in the table under Cloudflare.

For information on installing a Cloudflare certificate for organizations, refer to this Mozilla support article ‚Üó.

### Mobile device management (MDM) software

Zero Trust integrates with several mobile device management (MDM) software partners to deploy WARP across devices.

#### Microsoft Intune

To upload and deploy a Cloudflare certificate in Microsoft Intune:

1. Download and convert a Cloudflare certificate to DER format with the .cer file type.
2. In Microsoft Intune, create a trusted certificate profile ‚Üó with your converted certificate.

For more information, refer to the Microsoft documentation ‚Üó.

#### Jamf Pro

To upload and deploy a Cloudflare certificate in Jamf Pro:

1. Download and convert a Cloudflare certificate to DER format with the .cer file type.
2. In Jamf Pro, go to Computers > Configuration Profiles to create a computer configuration profile, or go to Devices > Configuration Profiles to create a mobile device configuration profile. Select New.
3. Add a name and description for the profile.
4. Choose whether you would like Jamf to install the certificate automatically or with self-service, and whether you would like to install the certificate for a single user or all users on the device.
5. Select Add > Certificate. Choose the certificate file.
6. Uncheck Allow export from keychain.
7. Select Scope, then choose which devices or groups to deploy the certificate to.
8. Select Save.

For more information, refer to the Jamf Pro documentation ‚Üó.

#### Kandji

To upload and deploy a Cloudflare certificate in Kandji:

1. Download a Cloudflare certificate in .crt format.
2. In Kandji, upload the certificate ‚Üó as a PKCS #1-formatted certificate.

#### Hexnode

To upload and deploy a Cloudflare certificate in Hexnode:

1. Download a Cloudflare certificate in .pem format.
2. In Hexnode, follow the directions for adding the certificate to macOS ‚Üó, iOS ‚Üó, and/or Android ‚Üó devices.

#### JumpCloud

To upload and deploy a Cloudflare certificate in JumpCloud:

1. Download a Cloudflare certificate in .pem format.
2. In JumpCloud, upload the certificate ‚Üó.
3. Configure a conditional access policy ‚Üó to deploy the certificate across devices.

### Python

Depending on which version of Python you have installed and your configuration, you may need to use either the python or python3 command. If you use virtual environments ‚Üó, you will need to repeat the following steps within each virtual environment.

#### Python on Windows

The command to install the certificate with Python on Windows automatically includes pip and certifi (the default certificate bundle for certificate validation).

1. Download a Cloudflare certificate in .crt format.
2. In a PowerShell terminal, install the certifi package:
PowerShellpython -m pip install certifi
3. Identify the Python CA store:
PowerShell$CERT_PATH = python -c "import certifi; print(certifi.where())"
4. Update the bundle to include the Cloudflare certificate:
PowerShellgc "$env:USERPROFILE\Downloads\certificate.crt" | ac $CERT_PATH
5. (Optional) Configure your system variables to point to the CA store by adding them to PowerShell's configuration file:
PowerShell[System.Environment]::SetEnvironmentVariable('CERT_PATH', $CERT_PATH, 'Machine')[System.Environment]::SetEnvironmentVariable('SSL_CERT_FILE', $CERT_PATH, 'Machine')[System.Environment]::SetEnvironmentVariable('REQUESTS_CA_BUNDLE', $CERT_PATH, 'Machine')
6. Restart your terminal.

#### Python on Mac and Linux

1. Download a Cloudflare certificate in .pem format.
2. In a terminal, install the certifi package:
Terminal windowpython -m pip install certifi
3. Append the Cloudflare certificate to this CA store by running:
Terminal windowecho | cat - certificate.pem >> $(python -m certifi)
4. (Optional) Configure your system variables to point to the CA store by adding them to your shell's configuration file (such as ~/.zshrc or ~/.bash_profile). For example:
Terminal windowecho 'export CERT_PATH=$(python -c "import certifi; print(certifi.where())")export SSL_CERT_FILE=${CERT_PATH}export REQUESTS_CA_BUNDLE=${CERT_PATH}' >> ~/.zshrc
5. Restart your terminal.

### Git

#### Git on Windows

1. Open PowerShell.
2. Run the following command:
PowerShellgit config -l
This command will output:
core.symlinks=falsecore.autocrlf=truecore.fscache=truecolor.diff=autocolor.status=autocolor.branch=autocolor.interactive=truehelp.format=htmlrebase.autosquash=truehttp.sslcainfo=C:/Program Files/Git/mingw64/ssl/certs/ca-bundle.crthttp.sslbackend=openssldiff.astextplain.textconv=astextplainfilter.lfs.clean=git-lfs clean -- %ffilter.lfs.smudge=git-lfs smudge -- %ffilter.lfs.process=git-lfs filter-processfilter.lfs.required=truecredential.helper=manager
3. The http.sslcainfo defines the CA Certificate store. To append the Cloudflare certificate to the CA bundle, update http.sslcainfo.
PowerShellgc .\certificate.pem | ac $(git config --get http.sslcainfo)

#### Git on Mac and Linux

To configure Git to trust a Cloudflare certificate, run the following command:

Terminal window ```
git config --global http.sslcainfo [PATH_TO_CLOUDFLARE_CERT]
```

### npm

1. Download a Cloudflare certificate in .pem format.
2. Set the cafile configuration to use the Cloudflare certificate:
Terminal windownpm config set cafile [PATH_TO_CLOUDFLARE_CERT.pem]

On some systems you may need to set the following in your path/export list:

Terminal window ```
export NODE_EXTRA_CA_CERTS='[PATH_TO_CLOUDFLARE_CERT.pem]'
```

### Docker

To install a certificate for use in a Docker container:

1. Download a Cloudflare certificate in .pem format.
2. Create a directory for certificates in your Docker project:
Terminal windowcd docker-projectmkdir certsmv /path/to/downloaded/certificate.pem certs/
3. Verify the certificate was moved to the directory correctly. Your project should have the following structure:
Terminal windowdocker-project/‚îú‚îÄ‚îÄ Dockerfile‚îî‚îÄ‚îÄ certs/    ‚îî‚îÄ‚îÄ certificate.pem
4. Add the certificate to your Docker image:
      During build process     During runtime      To add the certificate to your Dockerfile to install it during the build process:

Add the certificate install directions to your Dockerfile. For example:
Red Hat-based imagesFROM registry.access.redhat.com/ubi9/ubi:latest# Or FROM centos:7 or FROM fedora:38
# Install necessary certificates packageRUN dnf install -y ca-certificates
# Copy and add Cloudflare root certificateCOPY certs/certificate.pem /etc/pki/ca-trust/source/anchors/certificate.crtRUN update-ca-trust extract
Debian-based imagesFROM debian:12# Or FROM ubuntu:22.04
# Install necessary certificates packageRUN apt-get update && apt-get install -y ca-certificates
# Copy and add Cloudflare root certificateCOPY certs/certificate.pem /usr/local/share/ca-certificates/certificate.crtRUN update-ca-certificates
Alpine-based imagesFROM alpine:3.18
# Install necessary certificates packageRUN apk add --no-cache ca-certificates
# Copy and add Cloudflare root certificateCOPY certs/certificate.pem /usr/local/share/ca-certificates/certificate.crtRUN update-ca-certificates


Build the Docker image:
Terminal windowdocker build -t <your-container-name> .


Verify the certificate was installed:
Red Hat-based imagesdocker run --rm your-image-name sh -c "cat /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem | grep Cloudflare"
Debian and Alpine-based imagesdocker run --rm your-image-name sh -c "cat /etc/ssl/certs/certificate.pem"

  To add the certificate to your Docker Compose file to install it during runtime:

Add the certificate install directions to your docker-compose.yml file. For example:
Red Hat-based containersversion: '3'services:  redhat-app:    image: registry.access.redhat.com/ubi9/ubi:latest     volumes:       - certs/certificate.pem:/etc/pki/ca-trust/source/anchors/certificate.pem     entrypoint: /bin/sh -c "dnf install -y ca-certificates && update-ca-trust extract && app start"
Debian-based containersversion: '3'services:  debian-app:    image: debian:12     volumes:       - certs/certificate.pem:/usr/local/share/ca-certificates/certificate.crt     entrypoint: /bin/sh -c "apt-get update && apt-get install -y ca-certificates && update-ca-certificates && app start"
Alpine-based containersversion: '3'services:  alpine-app:    image: alpine:3.18     volumes:       - certs/certificate.pem:/usr/local/share/ca-certificates/certificate.pem     entrypoint: /bin/sh -c "apk add --no-cache ca-certificates && update-ca-certificates && app start"


Run the container:
Terminal windowdocker-compose up


Verify the certificate was installed:
Red Hat-based containersdocker exec -it <container-name> sh -c "cat /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem | grep Cloudflare"
Debian and Alpine-based containersdocker exec -it <container-name> sh -c "cat /etc/ssl/certs/ca-certificates.crt | grep Cloudflare"
5. During build process
6. During runtime
7. Add the certificate install directions to your Dockerfile. For example:
Red Hat-based imagesFROM registry.access.redhat.com/ubi9/ubi:latest# Or FROM centos:7 or FROM fedora:38
# Install necessary certificates packageRUN dnf install -y ca-certificates
# Copy and add Cloudflare root certificateCOPY certs/certificate.pem /etc/pki/ca-trust/source/anchors/certificate.crtRUN update-ca-trust extract
Debian-based imagesFROM debian:12# Or FROM ubuntu:22.04
# Install necessary certificates packageRUN apt-get update && apt-get install -y ca-certificates
# Copy and add Cloudflare root certificateCOPY certs/certificate.pem /usr/local/share/ca-certificates/certificate.crtRUN update-ca-certificates
Alpine-based imagesFROM alpine:3.18
# Install necessary certificates packageRUN apk add --no-cache ca-certificates
# Copy and add Cloudflare root certificateCOPY certs/certificate.pem /usr/local/share/ca-certificates/certificate.crtRUN update-ca-certificates
8. Build the Docker image:
Terminal windowdocker build -t <your-container-name> .
9. Verify the certificate was installed:
Red Hat-based imagesdocker run --rm your-image-name sh -c "cat /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem | grep Cloudflare"
Debian and Alpine-based imagesdocker run --rm your-image-name sh -c "cat /etc/ssl/certs/certificate.pem"
10. Add the certificate install directions to your docker-compose.yml file. For example:
Red Hat-based containersversion: '3'services:  redhat-app:    image: registry.access.redhat.com/ubi9/ubi:latest     volumes:       - certs/certificate.pem:/etc/pki/ca-trust/source/anchors/certificate.pem     entrypoint: /bin/sh -c "dnf install -y ca-certificates && update-ca-trust extract && app start"
Debian-based containersversion: '3'services:  debian-app:    image: debian:12     volumes:       - certs/certificate.pem:/usr/local/share/ca-certificates/certificate.crt     entrypoint: /bin/sh -c "apt-get update && apt-get install -y ca-certificates && update-ca-certificates && app start"
Alpine-based containersversion: '3'services:  alpine-app:    image: alpine:3.18     volumes:       - certs/certificate.pem:/usr/local/share/ca-certificates/certificate.pem     entrypoint: /bin/sh -c "apk add --no-cache ca-certificates && update-ca-certificates && app start"
11. Run the container:
Terminal windowdocker-compose up
12. Verify the certificate was installed:
Red Hat-based containersdocker exec -it <container-name> sh -c "cat /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem | grep Cloudflare"
Debian and Alpine-based containersdocker exec -it <container-name> sh -c "cat /etc/ssl/certs/ca-certificates.crt | grep Cloudflare"

### Java

Java may have multiple certificate keystore locations depending on different installations or applications that include Java. Depending on your Java Virtual Machine (JVM) installation, you may need to install the certificate for each instance. You may also need to manually configure each Java application to use and trust the certificate.

To install a Cloudflare root certificate in the system JVM, follow the procedure for your operating system. These steps require you to download a .pem certificate.

- macOS and Linux
- Windows

1. Install OpenSSL ‚Üó.
2. In a terminal, format the Cloudflare certificate for Java.
Terminal windowopenssl x509 -in Cloudflare_CA.pem -inform pem -out Cloudflare_CA.der -outform der
3. Import the converted certificate into the Java keystore.
Terminal windowsudo $JAVA_HOME/bin/keytool -import -trustcacerts -alias 'Cloudflare Root CA' -file Cloudflare_CA.der -keystore $JAVA_HOME/jre/lib/security/cacerts -storepass changeit -noprompt 2>&1
4. Restart any instances of Java.

1. Install OpenSSL for Windows ‚Üó.
2. In an administrator PowerShell terminal, format the Cloudflare certificate for Java.
PowerShellopenssl x509 -in Cloudflare_CA.pem -inform pem -out Cloudflare_CA.der -outform der
3. Import the converted certificate into the Java keystore.
PowerShell"%JAVA_HOME%\bin\keytool" -import -trustcacerts -alias "Cloudflare Root CA" -file Cloudflare_CA.der -keystore "%JAVA_HOME%\jre\lib\security\cacerts" -storepass changeit -noprompt
4. Restart any instances of Java.

### Google Cloud

#### Google Cloud SDK

The commands below will set the Google Cloud SDK to use a Cloudflare certificate. For more information on configuring the Google Cloud SDK, refer to the Google Cloud documentation ‚Üó.

1. Get curl's cacert bundle.
Terminal windowcurl --remote-name https://curl.se/ca/cacert.pem
2. Download a Cloudflare certificate in .pem format.
3. Combine the certs into a single .pem file.
Terminal windowcat cacert.pem certificate.pem > ~/ca.pem
4. Configure Google Cloud to use the combined .pem.
Terminal windowgcloud config set core/custom_ca_certs_file ~/ca.pem

Note

The file at ~/ca.pem needs to remain in place in order for the gcloud utility to leverage it. If the file is moved, then you must re-run step 3 to point gcloud to the file's new location.

##### Kaniko

If you use Kaniko with Google Cloud SDK, you must install a Cloudflare certificate in the Kaniko CA store ‚Üó. For more information, refer to the gcloud documentation ‚Üó.

#### Google Apps Manager (GAM)

Google Apps Manager (GAM) uses its own certificate store. To add a Cloudflare certificate to GAM, refer to the GAM documentation ‚Üó.

### Google Drive

To trust a Cloudflare root certificate in the Google Drive desktop application, follow the procedure for your operating system. These steps require you to download a .pem certificate.

- macOS
- Windows

1. In a terminal, copy the contents of the Google Drive certificate file to a new certificate file in a permanent location, such as your Documents folder. For example:
Terminal windowcat /Applications/"Google Drive.app"/Contents/Resources/roots.pem > ~/Documents/gdrivecerts.pem
2. Append the contents of the downloaded certificate to the end of the new file. For example:
Terminal windowcat ~/Downloads/certificate.pem >> ~/Documents/gdrivecerts.pem
3. Apply the newly created root certificate to your Google Drive application. For example:
Terminal windowsudo defaults write /Library/Preferences/com.google.drivefs.settings TrustedRootCertsFile "/Users/$(whoami)/Documents/gdrivecerts.pem"

You can verify the update with the following command.

Terminal window ```
defaults read /Library/Preferences/com.google.drivefs.settings
```

1. In an administrator PowerShell terminal, copy the contents of the Google Drive certificate file to a new certificate file in a permanent location, such as your Documents folder. For example:
PowerShellGet-Content "C:\Program Files\Google\Drive File Stream\roots.pem" | Set-Content "$HOME\Documents\gdrivecerts.pem"
2. Append the contents of the downloaded certificate to the end of the new file. For example:
PowerShellGet-Content "$HOME\Downloads\certificate.pem" | Add-Content "$HOME\Documents\gdrivecerts.pem"
3. Apply the newly created root certificate to your Google Drive application. For example:
PowerShellSet-ItemProperty -Path "HKLM:\SOFTWARE\Google\DriveFS" -Name "TrustedRootCertsFile" -Value "$HOME\Documents\gdrivecerts.pem"

You can verify the update with the following command.

PowerShell ```
Get-ItemProperty -Path "HKLM:\SOFTWARE\Google\DriveFS" | Select-Object TrustedRootCertsFile
```

For more information, refer to the Google documentation ‚Üó for the TrustedRootCertsFile setting.

### AWS CLI

To use a Cloudflare root certificate with AWS CLI, configure it in your AWS configuration files:

- Global config
- Environment variable

To persistently set the location of the certificate:

1. Download a Cloudflare certificate in .pem format.
2. Locate and open your AWS configuration file ‚Üó.
3. Configure the ca_bundle setting ‚Üó with the location of your certificate. For example:
.aws\config[default]region = us-west-1
ca_bundle = C:\certificate.pem
4. Restart your terminal.

To set the location of the certificate for use as an environment variable:

1. Download a Cloudflare certificate in .pem format.
2. In a terminal, set the AWS_CA_BUNDLE environment variable ‚Üó to the location of your certificate depending on your operating system.
3. Restart your terminal.

### PHP Composer

The command below will set the cafile ‚Üó configuration inside of composer.json to use the Cloudflare root certificate. Make sure to download a certificate in the .pem file type.

Terminal window ```
composer config cafile [PATH_TO_CLOUDFLARE_CERT.pem]
```

Alternatively, you can add this manually to your composer.json file under the config key.

### JetBrains

To install a Cloudflare root certificate on JetBrains products, refer to the links below:

- AppCode ‚Üó
- CLion ‚Üó
- DataGrip ‚Üó
- DataSpell ‚Üó
- GoLand ‚Üó
- IntelliJ IDEA ‚Üó
- PhpStorm ‚Üó
- PyCharm ‚Üó
- Rider ‚Üó
- WebStorm ‚Üó

### Eclipse

To install a Cloudflare root certificate on Eclipse IDE for Java Developers, you must add the certificate to the Java virtual machine (JVM) used by Eclipse.

1. Download a Cloudflare certificate.
2. Find the java.home value for your Eclipse installation.

In Eclipse, go to Eclipse > About Eclipse (or Help > About Eclipse IDE on Windows and Linux)
Select Installation Details, then go to Configuration.
Search for java.home, then locate the value. For example:

*** System properties:java.home=/Users/<username>/.p2/pool/plugins/org.eclipse.justj.openjdk.hotspot.jre.full.macosx.aarch64_17.0.8.v20230831-1047/jre

Copy the full path after java.home=.
3. In Eclipse, go to Eclipse > About Eclipse (or Help > About Eclipse IDE on Windows and Linux)
4. Select Installation Details, then go to Configuration.
5. Search for java.home, then locate the value. For example:
6. Copy the full path after java.home=.
7. Add the Cloudflare certificate to Eclipse's JVM:

- macOS and Linux
- Windows

1. In a terminal, add the java.home value you copied as an environment variable.
Terminal windowexport JAVA_HOME=$(echo /path/to/java.home)
2. Run keytool to install and trust the Cloudflare certificate.
Terminal window"$JAVA_HOME/bin/keytool" -import -file ~/Downloads/certificate.crt -alias CloudflareRootCA -keystore "$JAVA_HOME/lib/security/cacerts" -storepass changeit -trustcacerts -noprompt
3. Restart Eclipse.

1. In a terminal, add the java.home value you copied as an environment variable.
PowerShellset JAVA_HOME="\path\to\java.home"
2. Run keytool to install and trust the Cloudflare certificate.
PowerShell"%JAVA_HOME%\bin\keytool.exe" -import -file "%UserProfile%\Downloads\Cloudflare_CA.crt" -alias CloudflareRootCA -keystore "%JAVA_HOME%\lib\security\cacerts" -storepass changeit -trustcacerts -noprompt
3. Restart Eclipse.

For more information on adding certificates to Eclipse with keytool, refer to IBM's documentation ‚Üó.

### RubyGems

To trust a Cloudflare root certificate in RubyGems, follow the procedure for your operating system. These steps require you to download a .pem certificate.

- macOS and Linux
- Windows

1. Install OpenSSL ‚Üó.
2. In a terminal, format the Cloudflare certificate for Ruby.
Terminal windowopenssl x509 -in ~/Downloads/certificate.pem -out ~/Downloads/ruby-root-ca.crt
3. Create a RubyGems certificate directory in your home folder.
Terminal windowmkdir -p ~/.gem/ssl
4. Copy the Cloudflare certificate to your RubyGems certificate store.
Terminal windowcp ~/Downloads/ruby-root-ca.crt ~/.gem/ssl/rubygems.org.pem
5. Configure RubyGems to use the certificate.
Terminal windowgem sources --add-trusted-cert ~/.gem/ssl/rubygems.org.pem
Alternatively, add the following line to your RubyGems configuration file located in ~/.gemrc file to globally trust the certificate:
:ssl_cert: ~/.gem/ssl/rubygems.org.pem
6. Restart any terminal sessions.

1. Install OpenSSL for Windows ‚Üó.
2. In a PowerShell terminal, format the Cloudflare certificate for Ruby.
PowerShellopenssl x509 -in %UserProfile%\Downloads\certificate.pem -out %UserProfile%\Downloads\ruby-root-ca.crt
3. Create a RubyGems certificate directory in your home folder.
PowerShellmkdir -Force "$env:USERPROFILE\.gem\ssl"
4. Copy the Cloudflare certificate to your RubyGems certificate store.
PowerShellCopy-Item "$env:USERPROFILE\Downloads\ruby-root-ca.crt" "$env:USERPROFILE\.gem\ssl\rubygems.org.pem"
5. Configure RubyGems to use the certificate.
PowerShellgem sources --add-trusted-cert "$env:USERPROFILE\.gem\ssl\rubygems.org.pem"
Alternatively, add the following line to your RubyGems configuration file located in $HOME\.gemrc to globally trust the certificate:
:ssl_cert: C:/Users/<username>/.gem/ssl/rubygems.org.pem
6. Restart any terminal sessions.

### Minikube

To trust a Cloudflare root certificate in Minikube, refer to x509: certificate signed by unknown authority ‚Üó.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Deploy custom certificate

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/user-side-certificates/custom-certificate/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/user-side-certificates/custom-certificate/)

Page options # Deploy custom certificate

Note

Only available on Enterprise plans.

Enterprise customers who do not wish to install a Cloudflare certificate have the option to upload their own root certificate to Cloudflare. This feature is sometimes referred to as Bring Your Own Public Key Infrastructure (BYOPKI). Gateway will use your uploaded certificate to encrypt all sessions between the end user and Gateway, enabling all HTTPS inspection features that previously required a Cloudflare certificate. You can upload multiple certificates to your account, but only one can be active at any given time. You also need to upload a private key to intercept domains with JIT certificates and to enable the block page.

You can upload up to five custom root certificates. If your organization requires more than five certificates, contact your account team.

Warning

Custom certificates are limited to use between your users and the Gateway proxy. Gateway connects to origin servers using publicly trusted certificates, similar to how a browser validates secure websites.

If your users need to connect to self-signed origin servers, create an HTTP Allow policy for the origin server with the untrusted certificate action set to Pass through.

## Generate a custom root CA

Before you generate a custom root CA, make sure you have OpenSSL ‚Üó installed.

1. Open a terminal.
2. Create a directory for the root CA and change into it.
Terminal windowmkdir -p /root/customcacd /root/customca
3. Generate a private key for the root CA.
Terminal windowopenssl genrsa -out <CUSTOM-ROOT-PRIVATE-KEY>.pem 2048
4. Generate a self-signed root certificate.
Terminal windowopenssl req -x509 -sha256 -new -nodes -key <CUSTOM-ROOT-PRIVATE-KEY>.pem -days 365 -out <CUSTOM-ROOT-CERT>.pem

When preparing your certificate and private key for upload, be sure to remove any unwanted characters, such as mismatching subdomains in the certificate's common name. To review the private key, run the following command:

Terminal window ```
openssl rsa -in <CUSTOM-ROOT-PRIVATE-KEY>.pem -text
```

To review the certificate, run the following command:

Terminal window ```
openssl x509 -in <CUSTOM-ROOT-CERT>.pem -text
```

## Deploy a custom root certificate

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Settings > Resources.
2. In Certificates, select Manage.
3. Select Upload certificate.
4. Enter the private key and SSL certificate you generated or select Paste certificate from file to upload them from a file.
5. Select Generate certificate.
You can now use the generated custom root certificate for inspection.

1. Use the Upload mTLS certificate endpoint to upload the certificate and private key to Cloudflare. The certificate must be a root CA, formatted as a single string with \n replacing the line breaks.  
 Required API token permissions
 
At least one of the following token permissions 
is required:
Account: SSL and Certificates Write Upload mTLS certificatecurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/mtls_certificates" \  --request POST \  --header "X-Auth-Email: $CLOUDFLARE_EMAIL" \  --header "X-Auth-Key: $CLOUDFLARE_API_KEY" \  --json '{    "name": "example_ca_cert",    "certificates": "-----BEGIN CERTIFICATE-----\nXXXXX\n-----END CERTIFICATE-----",    "private_key": "-----BEGIN PRIVATE KEY-----\nXXXXX\n-----END PRIVATE KEY-----",    "ca": true  }'
The response will return a UUID for the certificate. For example:
{  "success": true,  "errors": [],  "messages": [],  "result": {    "id": "2458ce5a-0c35-4c7f-82c7-8e9487d3ff60",    "name": "example_ca_cert",    "issuer": "O=Example Inc.,L=California,ST=San Francisco,C=US",    "signature": "SHA256WithRSA",    ...  }}
2. Account: SSL and Certificates Write
3. Set the certificate as available for use in inspection with the Activate a Zero Trust certificate endpoint. This will deploy the certificate across the Cloudflare global network.
 Required API token permissions
 
At least one of the following token permissions 
is required:
Zero Trust Write Activate a Zero Trust certificatecurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/certificates/$CERTIFICATE_ID/activate" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
The response will return the certificate and a pending_deployment binding status. For example:
{  "errors": [],  "messages": [],  "success": true,  "result": {    "in_use": false,    "id": "f174e90a-fafe-4643-bbbc-4a0ed4fc8415",    "certificate": "-----BEGIN CERTIFICATE-----\\n ... \\n-----END CERTIFICATE-----\\n",    "issuer_org": "Example Inc.",    "issuer_raw": "O=Example Inc.,L=California,ST=San Francisco,C=US",    "fingerprint": "E9:19:49:AA:DD:D8:1E:C1:20:2A:D8:22:BF:A5:F8:FC:1A:F7:10:9F:C7:5B:69:AB:0:31:91:8B:61:B4:BF:1C",    "binding_status": "pending_deployment",    "type": "custom",    "updated_at": "2014-01-01T05:20:00.12345Z",    "uploaded_on": "2014-01-01T05:20:00.12345Z",    "created_at": "2014-01-01T05:20:00.12345Z",    "expires_on": "2014-01-01T05:20:00.12345Z"  }}
4. Zero Trust Write
5. Use the Get Zero Trust certificate details endpoint to verify the certificate's binding status is set to available.
 Required API token permissions
 
At least one of the following token permissions 
is required:
Zero Trust ReadZero Trust Write Get Zero Trust certificate detailscurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/certificates/$CERTIFICATE_ID" \  --request GET \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
{  "errors": [],  "messages": [],  "success": true,  "result": {    "in_use": false,    "id": "f174e90a-fafe-4643-bbbc-4a0ed4fc8415",    "certificate": "-----BEGIN CERTIFICATE-----\\n ... \\n-----END CERTIFICATE-----\\n",    "issuer_org": "Example Inc.",    "issuer_raw": "O=Example Inc.,L=California,ST=San Francisco,C=US",    "fingerprint": "E9:19:49:AA:DD:D8:1E:C1:20:2A:D8:22:BF:A5:F8:FC:1A:F7:10:9F:C7:5B:69:AB:0:31:91:8B:61:B4:BF:1C",    "binding_status": "available",    "type": "custom",    "updated_at": "2014-01-01T05:20:00.12345Z",    "uploaded_on": "2014-01-01T05:20:00.12345Z",    "created_at": "2014-01-01T05:20:00.12345Z",    "expires_on": "2014-01-01T05:20:00.12345Z"  }}
6. Zero Trust Read
7. Zero Trust Write
8. (Optional) Verify the certificate is installed on your user's devices either with WARP or manually.
9. Use the Patch Zero Trust account configuration endpoint to turn on the certificate for use in inspection. For example:

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Patch Zero Trust account configuration ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/configuration" \  --request PATCH \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "settings": {        "certificate": {            "id": "{certificate_id}",            "in_use": true        }    }  }'
```

Once in-use is set to true, Gateway will sign your traffic using the custom root certificate and private key. If you turn off or deactivate the custom certificate, Gateway will revert to the next available Cloudflare certificate generated for your Zero Trust account.

Private key visibility

When you upload a private key to Zero Trust, Cloudflare encrypts the key and stores it at rest. Only your delegated apps have the necessary decryption keys to decrypt the private key. You will not be able to retrieve the private key after upload.

## Use a custom root certificate

To use a custom root certificate you generated and uploaded to Cloudflare, refer to Activate a root certificate.

## Troubleshoot HTTP errors

If Gateway returns an HTTP Response Code: 526 after deploying a custom certificate, you can troubleshoot errors with our FAQ.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Applications

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/](https://developers.cloudflare.com/cloudflare-one/applications/)

Page options # Applications

Cloudflare Zero Trust can secure self-hosted and SaaS applications with Zero Trust rules.

Learn how to secure your applications, and how to configure one dashboard for your users to reach all the applications you've secured behind Cloudflare Zero Trust:

- Add web applications
- Non-HTTP applications
- Cloud Access Security Broker
- Application Library
- Login page
- Block page
- Add bookmarks
- App Launcher

Refer to our reference architecture for an understanding on how to architect a Zero Trust and SASE solution.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Add web applications

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/)

Page options # Add web applications

Cloudflare Access allows you to secure your web applications by acting as an identity aggregator, or proxy. You can use signals from your existing identity providers (IdPs), device posture providers, and other rules to control who can log in to the application.

You can protect the following types of web applications:

- SaaS applications consist of applications your team relies on that are not hosted by your organization. Examples include Salesforce and Workday. To secure SaaS applications, you must integrate Cloudflare Access with the SaaS application's SSO configuration.
- Self-hosted applications consist of internal applications that you host in your own environment. These can be the data center versions of tools like the Atlassian suite or applications created by your own team. Setup requirements for a self-hosted application depend on whether the application is publicly accessible on the Internet or restricted to users on a private network.

Public hostname applications are web applications that have public DNS records. Anyone on the Internet can access the application by entering the URL in their browser and authenticating through Cloudflare Access. Securing access to a public website requires a Cloudflare DNS full setup or partial CNAME setup.
Private network applications do not have public DNS records, meaning they are not reachable from the public Internet. To connect using a private IP or private hostname, the user's traffic must route through Cloudflare Gateway. The preferred method is to install the WARP client on the user's device, but you could also forward device traffic from a network location or use an agentless option such as PAC files or Clientless Web Isolation.
- Public hostname applications are web applications that have public DNS records. Anyone on the Internet can access the application by entering the URL in their browser and authenticating through Cloudflare Access. Securing access to a public website requires a Cloudflare DNS full setup or partial CNAME setup.
- Private network applications do not have public DNS records, meaning they are not reachable from the public Internet. To connect using a private IP or private hostname, the user's traffic must route through Cloudflare Gateway. The preferred method is to install the WARP client on the user's device, but you could also forward device traffic from a network location or use an agentless option such as PAC files or Clientless Web Isolation.
- Model Context Protocol (MCP) servers are web applications that enable generative AI tools to read and write data within your business applications. For example, Salesforce provides an MCP server ‚Üó for developers to interact with resources in their Salesforce tenant using GitHub Copilot or other AI code editors.
- Cloudflare Dashboard SSO is a special type of SaaS application that manages SSO settings for the Cloudflare dashboard and has limited permissions for administrator edits.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SaaS applications

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/)

Page options # SaaS applications

Cloudflare Access allows you to add an additional authentication layer to your SaaS applications. When you integrate a SaaS application with Access, users log in to the application with Cloudflare as the Single Sign-On provider. The user is then redirected to the configured identity providers for that application and are only granted access if they pass your Access policies.

Cloudflare integrates with the majority of SaaS applications that support the SAML or OIDC authentication protocol. If you do not see your application listed below, refer to our generic SAML or generic OIDC guide and consult your SaaS application's documentation.

- Generic OIDC application
- Generic SAML application
- Adobe Acrobat Sign
- Area 1
- Asana
- Atlassian Cloud
- AWS
- Braintree
- Coupa
- Digicert
- DocuSign
- Dropbox
- GitHub Enterprise Cloud
- Google Cloud
- Google Workspace
- Grafana
- Grafana Cloud
- Greenhouse Recruiting
- Hubspot
- Ironclad
- Jamf Pro
- Miro
- PagerDuty
- Pingboard
- Salesforce (OIDC)
- Salesforce (SAML)
- ServiceNow (OIDC)
- ServiceNow (SAML)
- Slack
- Smartsheet
- SparkPost
- Tableau Cloud
- Workday
- Zendesk
- Zoom

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Generic OIDC application

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/generic-oidc-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/generic-oidc-saas/)

Page options # Generic OIDC application

This page provides generic instructions for setting up a SaaS application in Cloudflare Access using the OpenID Connect (OIDC) authentication protocol.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to the account of the SaaS application

## 1. Get SaaS application URL

In your SaaS application account, obtain the Redirect URL (also known as the callback URL). This is the SaaS endpoint where users are redirected to after they authenticate with Cloudflare Access.

Some SaaS applications provide the Redirect URL after you configure the SSO provider.

## 2. Add your application to Access

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Select SaaS.
4. Select your Application from the drop-down menu. If your application is not listed, enter a custom name in the Application field and select the textbox that appears below.
5. Select OIDC.
6. Select Add application.
7. In Scopes, select the user attributes that you want Access to send in the ID token. For more information about configuring OIDC scopes and claims, refer to OIDC claims.
8. In Redirect URLs, enter the callback URL obtained from the SaaS application.
9. (Optional) Enable Proof of Key Exchange (PKCE) ‚Üó if the protocol is supported by your IdP. PKCE will be performed on all login attempts.
10. Copy the following values to input into your SaaS application. Different SaaS applications may require different sets of input values.









































FieldDescriptionClient secretCredential used to authorize Access as an SSO providerClient IDUnique identifier for this Access applicationConfiguration endpointIf supported by your SaaS application, you can configure OIDC using this endpoint instead of manually entering the URLs listed below.  https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/sso/oidc/<client-id>/.well-known/openid-configurationIssuerBase URL for this OIDC integration  https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/sso/oidc/<client-id>Token endpointReturns the user's ID token  https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/sso/oidc/<client-id>/tokenAuthorization endpointURL where users authenticate with Access  https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/sso/oidc/<client-id>/authorizationKey endpointReturns the current public keys used to verify the Access JWT  https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/sso/oidc/<client-id>/jwksUser info endpointReturns all user claims in JSON format  https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/sso/oidc/<client-id>/userinfo
11. Add Access policies to control who can connect to your application. All Access applications are deny by default -- a user must match an Allow policy before they are granted access.
12. Configure how users will authenticate:
Select the Identity providers you want to enable for your application.(Recommended) If you plan to only allow access via a single IdP, turn on Instant Auth. End users will not be shown the Cloudflare Access login page. Instead, Cloudflare will redirect users directly to your SSO login event.  (Optional) Under WARP authentication identity, allow users to authenticate to the application using their  WARP session identity.
13. Select the Identity providers you want to enable for your application.
14. (Recommended) If you plan to only allow access via a single IdP, turn on Instant Auth. End users will not be shown the Cloudflare Access login page. Instead, Cloudflare will redirect users directly to your SSO login event.
15. (Optional) Under WARP authentication identity, allow users to authenticate to the application using their  WARP session identity.
16. Select Next.
17. (Optional) Configure App Launcher settings for the application.
18. Under Block page, choose what end users will see when they are denied access to the application:

Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
Redirect URL: Redirect to the specified website.
Custom page template: Display a custom block page hosted in Zero Trust.
19. Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
20. Redirect URL: Redirect to the specified website.
21. Custom page template: Display a custom block page hosted in Zero Trust.
22. Select Save application.

## 3. Configure SSO in your SaaS application

Next, configure your SaaS application to require users to log in through Cloudflare Access. Refer to your SaaS application documentation for instructions on how to configure a third-party OIDC SSO provider.

## 4. Test the integration

Open an incognito browser window and go to the SaaS application's login URL. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.

## OIDC claims

OIDC claims refer to the user identity characteristics that Cloudflare Access shares with your OIDC SaaS application upon successful authentication. An OIDC scope defines a set of OIDC claims. By default, Cloudflare Access passes all standard claims ‚Üó that are included in the openid, email, profile, and groups scopes (if available).

| Scope | Description |
| --- | --- |
| openid | Includes a unique identifier for the user (required). |
| email | Includes the user's email address. |
| profile | Includes the user's name and all custom OIDC claims from the IdP. |
| groups | Include the user's IdP group membership. |

In your Access application, you can configure the OIDC scopes and claims that Access sends to the SaaS provider. For example, you can remove the groups scope if your SaaS application does not need to receive user group information.

### Filter groups

In Group filter regex, you can enter a regular expression to define the identity provider groups that you want to include in the groups scope. For example, if you enter the expression (^TEAM-Engineering-.$)|(^TEAM-Product-.$), only groups with names like TEAM-Engineering-A or TEAM-Product-B would get passed to the SaaS application.

### Add claims

To add additional OIDC claims onto the ID token sent to your SaaS application, configure the following fields for each claim:

- Name: OIDC claim name
- Scope: Select the OIDC scope where this claim should be included. In most cases, we recommend selecting profile since it already includes other custom claims from the IdP.
- IdP claim: The identity provider value that should map to this OIDC claim. You can select any SAML attribute or OIDC claim that was configured in a Zero Trust IdP integration.
- Required: If a claim is marked as required but is not provided by an IdP, Cloudflare will fail the authentication request and show an error page.
- Add per IdP claim: (Optional) If you turned on multiple identity providers for the SaaS application, you can choose different attribute mappings for each IdP. These values will override the parent IdP claim.

## Advanced settings

### Access token lifetime

The OIDC Access token authorizes users to connect to the SaaS application through Cloudflare Access. You can set an Access token lifetime to determine the window in which the token can be used to establish authentication with the SaaS application ‚Äî if it expires, the user must re-authenticate through Cloudflare Access. To balance security and user convenience, Cloudflare recommends configuring a short Access token lifetime in conjunction with a longer Refresh token lifetime (if supported by your application). When the access token expires, Cloudflare will use the refresh token to obtain a new access token after checking the user's identity against your Access policies. When the refresh token expires, the user will need to log back in to the identity provider. The refresh token lifetime should be less than your global session duration, otherwise the global session would take precedence.

Note

OIDC Access tokens only control the front door to a SaaS app; Access does not control how long the user can stay in the SaaS app itself. For example, if the user logs out of the SaaS app and then comes back to it, a valid Access token allows them to re-authenticate without another login. The SaaS app issues its own authorization cookie that manages the user's session within the app.

### OIDC flows

Some SaaS applications require SSO providers to provide tokens to the browser without backend authentication. Access for SaaS supports the following OIDC flows:

- No additional OIDC flows: (Default) Recommended unless your application requires additional flows.
- Hybrid flows: Used by applications that require information from the ID token before authenticating the user.
- Implicit flows: (Not recommended) Typically used by frontend applications that cannot store secrets and which do not support PKCE without client secret.

Cloudflare allows various response_type values in the authorization request depending on the selected flow. For example, the implicit flow allows Cloudflare to return the ID token, Access token, or both the ID token and Access token from the Authorization endpoint.

| response_type values | Default flow | Hybrid flow | Implicit flow |
| --- | --- | --- | --- |
| code | ‚úÖ | ‚úÖ | ‚ùå |
| id_token | ‚ùå | ‚úÖ | ‚úÖ |
| token | ‚ùå | ‚úÖ | ‚úÖ |

To include id_token in the authorization request, turn on Return ID Token from Authorization Endpoint. To include token, turn on Return Access Token from Authorization Endpoint

Note

Refresh tokens are not supported with Hybrid or Implicit flows.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Generic SAML application

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/generic-saml-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/generic-saml-saas/)

Page options # Generic SAML application

This page provides generic instructions for setting up a SaaS application in Cloudflare Access using the SAML authentication protocol.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to the account of the SaaS application

## 1. Get SaaS application URLs

Obtain the following URLs from your SaaS application account:

- Entity ID: A unique URL issued for your SaaS application, for example https://<your-domain>.my.salesforce.com.
- Assertion Consumer Service URL: The service provider's endpoint for receiving and parsing SAML assertions.

## 2. Add your application to Access

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Select SaaS.
4. Select your Application from the drop-down menu. If your application is not listed, enter a custom name in the Application field and select the textbox that appears below.
5. Select SAML.
6. Select Add application.
7. Enter the Entity ID and Assertion Consumer Service URL obtained from your SaaS application account.
8. Select the Name ID Format expected by your SaaS application (usually Email).
9. (Optional) Configure any additional SAML attribute statements required by your SaaS application.
10. Copy the SSO endpoint, Access Entity ID or Issuer, and Public key.

IdP groups

If you are using Okta, Microsoft Entra ID (formerly Azure AD), Google Workspace, or GitHub as your IdP, Access will automatically send a SAML attribute titled groups with all of the user's associated groups as attribute values.

1. Add Access policies to control who can connect to your application. All Access applications are deny by default -- a user must match an Allow policy before they are granted access.
2. Configure how users will authenticate:
Select the Identity providers you want to enable for your application.(Recommended) If you plan to only allow access via a single IdP, turn on Instant Auth. End users will not be shown the Cloudflare Access login page. Instead, Cloudflare will redirect users directly to your SSO login event.  (Optional) Under WARP authentication identity, allow users to authenticate to the application using their  WARP session identity.
3. Select the Identity providers you want to enable for your application.
4. (Recommended) If you plan to only allow access via a single IdP, turn on Instant Auth. End users will not be shown the Cloudflare Access login page. Instead, Cloudflare will redirect users directly to your SSO login event.
5. (Optional) Under WARP authentication identity, allow users to authenticate to the application using their  WARP session identity.
6. Select Next.
7. (Optional) Configure App Launcher settings for the application.
8. Under Block page, choose what end users will see when they are denied access to the application:

Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
Redirect URL: Redirect to the specified website.
Custom page template: Display a custom block page hosted in Zero Trust.
9. Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
10. Redirect URL: Redirect to the specified website.
11. Custom page template: Display a custom block page hosted in Zero Trust.
12. Select Save application.

## 3. Configure SSO in your SaaS application

Next, configure your SaaS application to require users to log in through Cloudflare Access. Refer to your SaaS application documentation for instructions on how to configure a third-party SAML SSO provider. You will need the following values from the Zero Trust dashboard:

- SSO endpoint
- Access Entity ID or Issuer
- Public key

You can either manually enter this data into your SaaS application or upload a metadata XML file. The metadata is available at the URL: <SSO endpoint>/saml-metadata.

### Validate SAML Response

When acting as a SAML identity provider, Cloudflare will sign both the SAML Response and the SAML Assertion using the SHA-256 algorithm. The SaaS application can validate this signature using the Public key that you upload to the SaaS application.

## 4. Test the integration

Open an incognito browser window and go to the SaaS application's login URL. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.

## SAML attributes

SAML attributes refer to the user identity characteristics that Cloudflare Access shares with your SAML SaaS application upon successful authentication. By default, Cloudflare Access passes the following attributes (if available) to the SaaS application:

- id - UUID of the user's Access identity
- name - Full name of the user (for example, John Doe)
- email - User's email address
- groups - Identity provider group membership

In Access for SaaS, you can add additional SAML attributes or customize the SAML statement sent to the SaaS application. This allows you to integrate SaaS applications which have specific SAML attribute requirements.

### SAML attribute statements

To send additional SAML attributes to your SaaS application, configure the following fields for each attribute:

- Name: SAML attribute name
- SAML friendly name: (Optional) A human readable name for the SAML attribute
- Name format: Specify the Name format expected by the SaaS application:

Unspecified: (default) No specific format required.
URI: Name is in a format such as urn:ietf:params:scim:schemas:core:2.0:User:userName or urn:oid:2.5.4.42.
Basic: Name is a normal string such as userName.
- Unspecified: (default) No specific format required.
- URI: Name is in a format such as urn:ietf:params:scim:schemas:core:2.0:User:userName or urn:oid:2.5.4.42.
- Basic: Name is a normal string such as userName.
- IdP claim: The identity provider value that should map to this SAML attribute. You can select any SAML attribute or OIDC claim that was configured in a Zero Trust IdP integration.
- Required: If an attribute is marked as required but is not provided by an IdP, Cloudflare will fail the authentication request and show an error page.
- Add per IdP claim: (Optional) If you turned on multiple identity providers for the SaaS application, you can choose different attribute mappings for each IdP. These values will override the parent IdP claim.

### JSONata transforms

In Advanced settings > Transformation, you can enter a JSONata ‚Üó script that modifies a copy of the User Registry identity. This is useful for setting default values, excluding email addresses, or ensuring usernames meet arbitrary criteria. Access will send the modified user identity to the SaaS application as SAML attributes.

Note

JSONata transformations are not compatible with SAML attribute statements. JSONata transformations will override any specified SAML attributes.

For example, the following JSONata script merges group names into a list and adds an eduPersonPrincipalName field which maps to the user email.

JSONata expression ```
$merge([$, {"groups": groups.name, 'eduPersonPrincipalName': email}])
```

Here is an example of a user identity before applying the JSONata transform:

User identity before JSONata transform ```
{  "account_id": "699d98642c564d2e855e9661899b7252",  "amr": [    "pwd"  ],  "auth_status": "NONE",  "common_name": "",  "device_id": "c1744f8b-faa1-48a4-9e5c-02ac921467fa",  "device_sessions": {    "49e653db-991e-11ee-af26-2243bf8c3428": {      "last_authenticated": 1703004275    }  },  "devicePosture": {    "8534a230-e85e-4183-8964-a4b7dcf72986": {      "rule_name": "Warp",      "success": true,      "type": "warp"    }  },  "email": "jdoe@company.com",  "gateway_account_id": "bTSquyUGwLQjYJn8cI8S1h6M6wU",  "geo": {    "country": "US"  },  "groups": [    {      "id": "12fdf91a-fb23-41b3-995a-de2f72c61d0e",      "name": "IdentityProtection-RiskyUser-RiskLevel-low"    },    {      "id": "12348f47-8234-4860-a03f-c2a1513f267b",      "name": "Global Administrator"    },    {      "id": "11235980-87d7-4917-b0aa-74c01914c40e",      "name": "Application Administrator"    }  ],  "iat": 1659474397,  "id": "OidHvkPt-I-13IBSnd77UJ8cHgsrUpjs3W6_4t6ES7M",  "idp": {    "id": "b08e8c0c-a75d-4b3f-8e7b-cd427b7c7b47",    "type": "azureAD"  }}
```

Result after applying the example JSONata script:

```
{  "account_id": "699d98642c564d2e855e9661899b7252",  "amr": [    "pwd"  ],  "auth_status": "NONE",  "common_name": "",  "device_id": "c1744f8b-faa1-48a4-9e5c-02ac921467fa",  "device_sessions": {    "49e653db-991e-11ee-af26-2243bf8c3428": {      "last_authenticated": 1703004275    }  },  "devicePosture": {    "8534a230-e85e-4183-8964-a4b7dcf72986": {      "rule_name": "Warp",      "success": true,      "type": "warp"    }  },  "email": "jdoe@company.com",  "gateway_account_id": "bTSquyUGwLQjYJn8cI8S1h6M6wU",  "geo": {    "country": "US"  },  "groups": [    "IdentityProtection-RiskyUser-RiskLevel-low",    "Global Administrator",    "Application Administrator"  ],  "iat": 1659474397,  "id": "OidHvkPt-I-13IBSnd77UJ8cHgsrUpjs3W6_4t6ES7M",  "idp": {    "id": "b08e8c0c-a75d-4b3f-8e7b-cd427b7c7b47",    "type": "azureAD"  },  "eduPersonPrincipalName": "jdoe@company.com"}
```

For more JSONata transform use cases, refer to the following examples.

Remove groups attribute

The following JSONata script removes the groups SAML attribute. This can be useful if your SaaS application does not need to receive user group information.

JSONata expression ```
$ ~> |$|{}, ['groups']|
```

Result after applying the JSONata transform:

```
{  "account_id": "699d98642c564d2e855e9661899b7252",  "amr": [    "pwd"  ],  "auth_status": "NONE",  "common_name": "",  "device_id": "c1744f8b-faa1-48a4-9e5c-02ac921467fa",  "device_sessions": {    "49e653db-991e-11ee-af26-2243bf8c3428": {      "last_authenticated": 1703004275    }  },  "devicePosture": {    "8534a230-e85e-4183-8964-a4b7dcf72986": {      "rule_name": "Warp",      "success": true,      "type": "warp"    }  },  "email": "jdoe@company.com",  "gateway_account_id": "bTSquyUGwLQjYJn8cI8S1h6M6wU",  "geo": {    "country": "US"  },  "iat": 1659474397,  "id": "OidHvkPt-I-13IBSnd77UJ8cHgsrUpjs3W6_4t6ES7M",  "idp": {    "id": "b08e8c0c-a75d-4b3f-8e7b-cd427b7c7b47",    "type": "azureAD"  }}
```

Rename groups field and remove group ID

The following JSONata script changes the groups.name field from name to group_name and removes the groups.id field:

JSONata expression ```
{  "account_id": account_id,  "amr": amr,  "auth_status": auth_status,  "common_name": common_name,  "devicePosture": devicePosture,  "device_id": device_id,  "device_sessions": device_sessions,  "email": email,  "gateway_account_id": gateway_account_id,  "geo": geo,  "groups": $map($.groups, function($group) {    {"group_name": $group.name}}),  "iat": iat,  "id": id,  "idp": idp}
```

Result after applying the JSONata transform:

```
{  "account_id": "699d98642c564d2e855e9661899b7252",  "amr": [    "pwd"  ],  "auth_status": "NONE",  "common_name": "",  "devicePosture": {    "8534a230-e85e-4183-8964-a4b7dcf72986": {      "rule_name": "Warp",      "success": true,      "type": "warp"    }  },  "device_id": "c1744f8b-faa1-48a4-9e5c-02ac921467fa",  "device_sessions": {    "49e653db-991e-11ee-af26-2210bf8c3428": {      "last_authenticated": 1703004275    }  },  "email": "jdoe@company.com",  "gateway_account_id": "bTSquyUGwLQjYJn8cI8S1h6M6wU",  "geo": {    "country": "US"  },  "groups": [    {      "group_name": "IdentityProtection-RiskyUser-RiskLevel-low"    },    {      "group_name": "Global Administrator"    },    {      "group_name": "Application Administrator"    }  ],  "iat": 1659474397,  "id": "OidHvkPt-I-13IBSnd77UJ8cHgsrUpjs3W6_4t6ES7M",  "idp": {    "id": "b08e8c0c-a75d-4b3f-8e7b-cd427b7c7b47",    "type": "azureAD"  }}
```

Filter groups by name

The following JSONata script filters groups to those that match a regular expression.

JSONata expression ```
$merge([$, { "groups": $filter(groups, function($v) { $contains($v.name, /Administrator/) }) }])
```

Result after applying the JSONata transform:

```
{  "account_id": "699d98642c564d2e855e9661899b7252",  "amr": [    "pwd"  ],  "auth_status": "NONE",  "common_name": "",  "device_id": "c1744f8b-faa1-48a4-9e5c-02ac921467fa",  "device_sessions": {    "49e653db-991e-11ee-af26-2243bf8c3428": {      "last_authenticated": 1703004275    }  },  "devicePosture": {    "8534a230-e85e-4183-8964-a4b7dcf72986": {      "rule_name": "Warp",      "success": true,      "type": "warp"    }  },  "email": "jdoe@company.com",  "gateway_account_id": "bTSquyUGwLQjYJn8cI8S1h6M6wU",  "geo": {    "country": "US"  },  "groups": [    {      "id": "12348f47-8234-4860-a03f-c2a1513f267b",      "name": "Global Administrator"    },    {      "id": "11235980-87d7-4917-b0aa-74c01914c40e",      "name": "Application Administrator"    }  ],  "iat": 1659474397,  "id": "OidHvkPt-I-13IBSnd77UJ8cHgsrUpjs3W6_4t6ES7M",  "idp": {    "id": "b08e8c0c-a75d-4b3f-8e7b-cd427b7c7b47",    "type": "azureAD"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Adobe Acrobat Sign

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/adobe-sign-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/adobe-sign-saas/)

Page options # Adobe Acrobat Sign

Last reviewed: about 1 year ago This guide covers how to configure Adobe Acrobat Sign ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Adobe Acrobat Sign account
- A claimed domain ‚Üó in Adobe Acrobat Sign

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS.
3. For Application, enter Adobe Sign and select the corresponding textbox that appears.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Copy the Access Entity ID or Issuer, Public key, and SSO endpoint.
7. Keep this window open without selecting Select configuration. You will finish this configuration in step 3. Finish adding a SaaS application to Cloudflare Zero Trust.

## 2. Add a SAML SSO provider to Adobe Sign

1. In Adobe Acrobat Sign, select your profile picture > your name > Account Settings > SAML Settings.
2. Turn SAML Allowed on.
3. Enter a hostname (for example, yourcompanyname). Users can use this URL or https://secure.adobesign.com/public/login to sign in via SSO.
4. (Optional) For Single Sign On Login Message, enter a custom message (for example, Log in via SSO). The default message is Sign in using your corporate credentials.
5. Fill in the following fields:

Entity ID/Issuer URL: Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
Login URL/SSO Endpoint: SSO endpoint from application configuration in Cloudflare Zero Trust.
IdP Certificate: Public key from application configuration in Cloudflare Zero Trust. Wrap the certificate in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.
6. Entity ID/Issuer URL: Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
7. Login URL/SSO Endpoint: SSO endpoint from application configuration in Cloudflare Zero Trust.
8. IdP Certificate: Public key from application configuration in Cloudflare Zero Trust. Wrap the certificate in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.
9. Copy the Entity ID/SAML Audience and Assertion Consumer URL.
10. Select Save.

## 3. Finish adding a SaaS application to Cloudflare Zero Trust

1. In your open Zero Trust window, fill in the following fields:

Entity ID: Entity ID/SAML Audience from Adobe Acrobat Sign SAML SSO configuration.
Assertion Consumer Service URL: Assertion Consumer URL from Adobe Acrobat Sign SAML SSO configuration.
Name ID format: Email
2. Entity ID: Entity ID/SAML Audience from Adobe Acrobat Sign SAML SSO configuration.
3. Assertion Consumer Service URL: Assertion Consumer URL from Adobe Acrobat Sign SAML SSO configuration.
4. Name ID format: Email
5. Configure Access policies for the application.
6. Save the application.

## 4. Test the integration and finalize configuration

1. Open an incognito browser window and go to your Adobe Sign hostname URL or https://secure.adobesign.com/public/login. Select the option to sign in via SSO (Sign in using your corporate credentials if you have not configured a custom message). You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.

Note

If you receive an error while testing SSO integration, go to your profile picture > your name > Account Settings > SAML Errors for more information.

1. Once this is successful, you can make sign in via SSO mandatory. Select your profile picture > your name > Account Settings > SAML Settings, and then turn on SAML Mandatory. Keeping Allow Acrobat Sign Account Administrators to log in using their Acrobat Sign Credentials turned on will allow administrators to log in even if your account experiences SSO issues.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Area 1

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/area-1/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/area-1/)

Page options # Area 1

Last reviewed: about 1 year ago Access to Area 1

Beginning October 1, 2025, access and support for Email Security (formerly Area 1) will only be available through the Cloudflare dashboard. Your Email Security protection will not change, but you will no longer be able to access the Area 1 dashboard or send support requests to @area1security.com email addresses. For help accessing the Cloudflare dashboard, reach out to successteam@cloudflare.com.

Cloudflare Area 1 ‚Üó is an email security platform that protects your organization's inbox from phishing, spam, and other malicious messages. This guide covers how to configure Area 1 as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to your Area 1 account
- Your user's email in Area 1 matches their email in Zero Trust

## 1. Add Area 1 to Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Select SaaS.
4. In the Application field, enter Area 1 and select Area 1. (Area 1 is not currently listed in the default drop-down menu.)
5. Enter the following values for your application configuration:





















Entity IDhttps://horizon.area1security.comAssertion Consumer Service URLhttps://horizon.area1security.com/api/users/samlName ID FormatEmail
6. Configure Access policies for the application.
7. Save the application.

## 2. Configure SSO for Area 1

Finally, you will need to configure Area 1 to allow users to log in through Cloudflare Access.

1. In your Area 1 portal ‚Üó, go to Settings > SSO.
2. Turn on Single Sign On.
3. (Optional) To require users to sign in through Access, set SSO Enforcement to All. When SSO is enforced, users will no longer be able to sign in with their Area 1 credentials.
4. In SAML SSO Domain, enter <your-team-name>.cloudflareaccess.com.
5. Get your Metadata XML file:


In Zero Trust, copy the SSO Endpoint for your application.



In a new browser tab, paste the SSO Endpoint and append /saml-metadata to the end of the URL. For example, https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/sso/saml/<app-id>/saml-metadata.


Copy the resulting metadata.
6. In Zero Trust, copy the SSO Endpoint for your application.
7. In a new browser tab, paste the SSO Endpoint and append /saml-metadata to the end of the URL. For example, https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/sso/saml/<app-id>/saml-metadata.
8. Copy the resulting metadata.
9. Return to the Area 1 portal and paste the metadata into Metadata XML.
10. Select Update Settings.

If you added the application to your App Launcher, you can test the integration by going to <your-team-name>.cloudflareaccess.com.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Asana

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/asana-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/asana-saas/)

Page options # Asana

Last reviewed: about 1 year ago This guide covers how to configure Asana ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Super admin access to an Asana Enterprise, Enterprise+, or Legacy Enterprise account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, select Asana.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: https://app.asana.com/
Assertion Consumer Service URL: https://app.asana.com/-/saml/consume
Name ID format: Email
7. Entity ID: https://app.asana.com/
8. Assertion Consumer Service URL: https://app.asana.com/-/saml/consume
9. Name ID format: Email
10. Copy the SSO endpoint and Public key.
11. Configure Access policies for the application.
12. Save the application.

## 2. Add a SAML SSO provider to Asana

1. In Asana, select your profile picture > Admin console > Security > SAML authentication.
2. Under SAML options, select Optional.
3. Fill in the following fields:

Sign-in page URL: SSO endpoint from application configuration in Cloudflare Zero Trust.
X.509 certificate: Public key from application configuration in Cloudflare Zero Trust. Wrap the public key in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.
4. Sign-in page URL: SSO endpoint from application configuration in Cloudflare Zero Trust.
5. X.509 certificate: Public key from application configuration in Cloudflare Zero Trust. Wrap the public key in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.
6. Select Save changes.

## 3. Test the integration and require SSO

1. Open an incognito browser window and go to your Asana URL. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
2. After this is successful, you may want to require users to log in via SSO. In Asana, select your profile picture > Admin console > Security > SAML authentication. Under SAML options, select Required for all members, except guest accounts.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Atlassian Cloud

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/atlassian-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/atlassian-saas/)

Page options # Atlassian Cloud

Last reviewed: about 1 year ago This guide covers how to configure Atlassian Cloud ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to an Atlassian Cloud account
- Atlassian Guard Standard subscription
- A domain ‚Üó verified in Atlassian Cloud

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS.
3. For Application, select Atlassian.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Copy the Access Entity ID or Issuer, Public key, and SSO endpoint.
7. Keep this window open. You will finish this configuration in step 4. Finish adding a SaaS application to Cloudflare Zero Trust.

## 2. Create a x.509 certificate

1. Paste the Public key in a text editor.
2. Wrap the certificate in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.

## 3. Configure an identity provider and SAML SSO in Atlassian Cloud

1. In Atlassian Cloud, go to Security > Identity providers.
2. Select Other provider > Choose.
3. For Directory name, enter your desired name. For example, you could enter Cloudflare Access.
4. Select Add > Set up SAML single sign-on > Next.
NoteThis screen will advise you to create an authentication policy before proceeding. You will do this in step 5. Create an application policy to test integration.
5. Fill in the following fields:

Identity provider Entity ID: Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
Identity provider SSO URL: SSO endpoint from application configuration in Cloudflare Zero Trust.
Public x509 certificate: Paste the entire x.509 certificate from step 2. Create a x.509 certificate.
6. Identity provider Entity ID: Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
7. Identity provider SSO URL: SSO endpoint from application configuration in Cloudflare Zero Trust.
8. Public x509 certificate: Paste the entire x.509 certificate from step 2. Create a x.509 certificate.
9. Select Next.
10. Copy the Service provider entity URL and Service provider assertion consumer service URL.
11. Select Next.
12. Under Link domain, select the domain you want to use with SAML SSO.
13. Select Next > Stop and save SAML.

## 4. Finish adding a SaaS application to Cloudflare Zero Trust

1. In your open Zero Trust window, fill in the following fields:

Entity ID: Service provider entity URL from Atlassian Cloud SAML SSO set-up.
Assertion Consumer Service URL: Service provider assertion consumer service URL from Atlassian Cloud SAML SSO set-up.
Name ID format: Email
2. Entity ID: Service provider entity URL from Atlassian Cloud SAML SSO set-up.
3. Assertion Consumer Service URL: Service provider assertion consumer service URL from Atlassian Cloud SAML SSO set-up.
4. Name ID format: Email
5. Configure Access policies for the application.
6. Save the application.

## 5. Create an authentication policy to test integration

To enable SSO for users in Atlassian Cloud, create an Atlassian authentication policy ‚Üó:

1. In Atlassian Cloud, go to Security > Authentication policies.
2. Select Add policy.
3. Under Directory, select the identity provider you used to configure SAML SSO.
4. For Policy name, enter your desired name.
5. Select Add.
6. In Settings, turn on Enforce single sign-on.
7. In Members, select Add members.
8. In Individual Users, select your desired test user(s) in the dropdown, and select Add members.
9. In Settings, select Update > Update.

## 6. Test the integration

Open an incognito browser window and log in with the credentials of the test user you added to the test authentication policy. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider. When this is successful, turn on Enforce single sign-on in your desired authentication policy, or add the desired users to the application policy created in step 5. Create an Application Policy to test Integration.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## AWS

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/aws-sso-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/aws-sso-saas/)

Page options # AWS

Last reviewed: over 1 year ago This guide covers how to configure AWS ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to an AWS account

## 1. Get AWS URLs

1. In the AWS admin panel, search for IAM Identity Center.
2. Go to IAM Identity Center > Settings.
3. In the Identity source tab, select the Actions dropdown and select Change identity source.
4. Change the identity source to External identity provider.
5. Copy the values shown in Service provider metadata. You will need these values when configuring the SaaS application in Zero Trust.

Next, we will obtain Identity provider metadata from Zero Trust.

## 2. Add a SaaS application to Cloudflare Zero Trust

1. In a separate tab or window, open Zero Trust ‚Üó and go to Access > Applications.
2. Select SaaS.
3. For Application, select Amazon AWS.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: IAM Identity Center issuer URL
Assertion Consumer Service URL: IAM Identity Center Assertion Consumer Service (ACS) URL
Name ID format: Email
7. Entity ID: IAM Identity Center issuer URL
8. Assertion Consumer Service URL: IAM Identity Center Assertion Consumer Service (ACS) URL
9. Name ID format: Email
10. (Optional) Additional SAML attribute statements can be passed from your IdP to AWS SSO. To learn more about AWS Attribute mapping, refer to Attribute mappings - AWS Single Sign-On ‚Üó.
11. AWS supports uploading a metadata XML file. To download your SAML metadata from Access:

Copy the SAML Metadata endpoint.
In a separate browser window, go to the SAML Metadata endpoint (https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/sso/saml/xxx/saml-metadata).
Save the page as access_saml_metadata.xml.
12. Copy the SAML Metadata endpoint.
13. In a separate browser window, go to the SAML Metadata endpoint (https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/sso/saml/xxx/saml-metadata).
14. Save the page as access_saml_metadata.xml.
15. Configure Access policies for the application.
16. Save the application.

## 3. Complete AWS configuration

1. Return to the IAM Identity Center > Settings > Change identity source tab.
2. Under IdP SAML metadata, upload your access_saml_metadata.xml file.
3. Select Next to review settings, type ACCEPT and select Change identity source to confirm changes.
4. Confirm that Provisioning is set to Manual.

Important

Access for SaaS does not currently support SCIM provisioning. Make sure that:

1. Users are created in both your identity provider and AWS.
2. Users have matching usernames in your identity provider and AWS.
3. Usernames are email addresses. This is the only format AWS supports with third-party SSO providers.

## 4. Test the integration

To test the connection, go to your AWS access portal URL. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Braintree

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/braintree-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/braintree-saas/)

Page options # Braintree

Last reviewed: about 1 year ago This guide covers how to configure Braintree ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Braintree production or sandbox account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, enter Braintree and select the textbox that appears below.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields with temporary values:

Entity ID: placeholder
Assertion Consumer Service URL: https://www.placeholder.com
Name ID format: Email
7. Entity ID: placeholder
8. Assertion Consumer Service URL: https://www.placeholder.com
9. Name ID format: Email
10. Copy the SSO endpoint and Public key.
11. Configure Access policies for the application.
12. Save the application.

## 2. Enable SSO Configuration in Braintree

1. In Braintree, create a support ticket ‚Üó.
2. In Search Issues, enter Login and password issues and select the corresponding value.
3. In Issue Details, fill in the following:

Merchant ID: Your Braintree Merchant ID. This is the 16-digit value that follows /merchants/in your Braintree Control Panel URL.
Email domain(s) to be used in user IDs: The email domain(s) that should be allowed to sign in to your account via SSO.
Single Sign-on HTTP POST Binding URL: SSO endpoint from application configuration in Cloudflare Zero Trust
Certificate for validation: Public key from application configuration in Cloudflare Zero Trust.
4. Merchant ID: Your Braintree Merchant ID. This is the 16-digit value that follows /merchants/in your Braintree Control Panel URL.
5. Email domain(s) to be used in user IDs: The email domain(s) that should be allowed to sign in to your account via SSO.
6. Single Sign-on HTTP POST Binding URL: SSO endpoint from application configuration in Cloudflare Zero Trust
7. Certificate for validation: Public key from application configuration in Cloudflare Zero Trust.
8. Select whether you are using a Production or Sandbox account.
9. Fill out the Your contact information fields and select Submit a help request.
10. When you receive an email stating SSO has been successfully configured for your account, you can proceed to the next step.

## 3. Finish adding a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Braintree > Edit > Overview.
3. Replace the temporary values for Entity ID and Assertion Consumer Service URL with the link provided in the successful SSO configuration email from Braintree support. You will use the same link for both values.
4. Select Save Application.

## 4. Test the integration and add SSO users

1. In your Braintree Control Panel, select the settings icon > Team.
2. Select your desired test user.
3. Under Single Sign-On, select Enable.
4. Open an incognito browser window. In the address bar, paste https://id.sandbox.braintreegateway.com for a sandbox account or
https://id.braintreegateway.com for a production account.
5. In Your corporate email address field, type your test user's email. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
6. Upon successful sign-in, you can enable SSO for other users using steps 4.1 - 4.3.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Coupa

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/coupa-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/coupa-saas/)

Page options # Coupa

Last reviewed: about 1 year ago This guide covers how to configure Coupa ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Coupa Stage or Production account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, enter Coupa and select the corresponding textbox that appears.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID:
sso-stg1.coupahost.com for a stage account or sso-prd1.coupahost.com for a production account
Assertion Consumer Service URL: https://sso-stg1.coupahost.com/sp/ACS.saml2 for a stage account or https://sso-prd1.coupahost.com/sp/ACS.saml2 for a production account
Name ID format: Email
7. Entity ID:
sso-stg1.coupahost.com for a stage account or sso-prd1.coupahost.com for a production account
8. Assertion Consumer Service URL: https://sso-stg1.coupahost.com/sp/ACS.saml2 for a stage account or https://sso-prd1.coupahost.com/sp/ACS.saml2 for a production account
9. Name ID format: Email
10. Copy the Access Entity ID or Issuer and SAML Metadata Endpoint.
11. In Default relay state, enter https://<your-subdomain>.coupahost.com/sessions/saml_post.
12. Configure Access policies for the application.
13. Save the application.

## 2. Download the metadata file

1. Paste the SAML metadata endpoint from application configuration in Cloudflare Zero Trust in a web browser.
2. Follow your browser-specific steps to download the URL's contents as an .xml file.

## 3. Add a SAML SSO provider in Coupa

1. In Coupa, go to Setup > Company Setup > Security Controls.
2. Under Sign in using SAML, turn on Sign in using SAML.
3. In Upload IdP metadata, select Choose File, and upload the .xml file you downloaded in step 2. Download the metadata file.
4. Turn on Advanced Options.
5. For Sign in page URL and Timeout URL, enter https://sso-stg1.coupahost.com/sp/startSSO.ping?PartnerIdpId=<access-entity-id-or-issuer>&TARGET=https://<your-subdomain>.coupahost.com/sessions/saml_post using the Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
6. Select Save.

## 3. Create a test user and test the integration

1. In Coupa, go to Setup > Company Setup > Users.
2. Select Create, then enter the user details for your test user. For Login and Single Sign-On ID, enter the user's email address.
3. Select Save.
4. Open an incognito browser window and go to your Coupa URL. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
5. Once the login is successful, you can configure other users for SSO by adding their email to the Single Sign-On ID field in Setup > Company Setup > Users > user's name.

Note

You can use the following URL to bypass SSO and login via a username and password: https://<your-subdomain>.coupahost.com/sessions/support_login.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Digicert

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/digicert-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/digicert-saas/)

Page options # Digicert

Last reviewed: about 1 year ago This guide covers how to configure Digicert ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Digicert account
- SAML ‚Üó enabled in your Digicert account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, enter Digicert and select the corresponding textbox that appears.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: https://www.digicert.com/account/sso/metadata
Assertion Consumer Service URL: https://www.digicert.com/account/sso/
Name ID format: Email
7. Entity ID: https://www.digicert.com/account/sso/metadata
8. Assertion Consumer Service URL: https://www.digicert.com/account/sso/
9. Name ID format: Email
10. Copy the SAML Metadata endpoint.
11. Configure Access policies for the application.
12. Save the application.

## 2. Add a SAML SSO provider in Digicert

1. In Digicert, select Settings > Single Sign-On > Set up SAML.
2. Under How will you send data from your IDP?, turn on Use a dynamic URL.
3. Under Use a dynamic URL, paste the SAML Metadata endpoint from application configuration in Cloudflare Zero Trust.
4. Under How will you identify a user?, turn on NameID.
5. Under Federation Name, enter a name (for example, Cloudflare Access). Your users will select this name when signing in.
6. Select Save SAML Settings.

## 3. Test and Enable SSO in Digicert

1. In Digicert, select Settings > Single Sign-On.
2. Copy the SP Initiated Custom SSO URL.
3. Paste the URL into an incognito browser window and sign in. Upon successful sign in, SAML SSO is fully enabled.
4. (Optional)  By default, users can choose to sign in directly or with SSO. To require SSO sign in, go to Account > Users. Turn on  Only allow this user to log in through SAML/OIDC SSO in the user details of the desired user.

Note

Users can sign in using service provider initiated SSO by using the SP Initiated Custom SSO URL. Alternatively, users can go to www.digicert.com/account, select Sign in with SSO, and enter the name of the identity provider configured in step 2. Add a SAML SSO provider in Digicert.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## DocuSign

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/docusign-access/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/docusign-access/)

Page options # DocuSign

Last reviewed: about 1 year ago This guide covers how to configure Docusign ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Docusign account that has Single Sign-On available
- A domain ‚Üó verified in Docusign

## 1. Create the Access for SaaS application

1. In Zero Trust, go to Access > Applications.
2. Select Add an Application.
3. Select SaaS.
4. Use the following configuration:

Set the Application to DocuSign.
Put placeholder values in EntityID and Assertion Consumer Service URL (for example, https://example.com). We'll come back and update these.
Set Name ID Format to: Unique ID.
5. Set the Application to DocuSign.
6. Put placeholder values in EntityID and Assertion Consumer Service URL (for example, https://example.com). We'll come back and update these.
7. Set Name ID Format to: Unique ID.
8. DocuSign requires SAML attributes to do Just In Time user provisioning. Ensure you are collecting SAML attributes from your IdP:

Group
username
department
firstName
lastName
phone
9. Group
10. username
11. department
12. firstName
13. lastName
14. phone
15. These IdP SAML values can then be mapped to the following DocuSign SAML attributes:

Email
Surname
Givenname
16. Email
17. Surname
18. Givenname
19. Set an Access policy (for example, create a policy based on Emails ending in @example.com).
20. Copy and save the SSO Endpoint, Entity ID and Public Key.
21. Transform the Public Key into a fingerprint:


Copy the Public Key Value.


Paste the Public Key into VIM or another code editor.


Wrap the value in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.


Set the file extension to .crt and save.
22. Copy the Public Key Value.
23. Paste the Public Key into VIM or another code editor.
24. Wrap the value in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.
25. Set the file extension to .crt and save.

## 2. Configure your DocuSign SSO instance

1. Ensure you have a domain claimed in DocuSign.
2. From the DocuSign Admin dashboard, select Identity Providers.
3. On the Identity Providers page, select ADD IDENTITY PROVIDER. Use the following mappings from the saved Access Application values:

Name: Pick your desired name.
Identity Provider Issuer: Entity ID.
Identity Provider Login URL: Assertion Consumer Service URL.
4. Name: Pick your desired name.
5. Identity Provider Issuer: Entity ID.
6. Identity Provider Login URL: Assertion Consumer Service URL.
7. Save the Identity Provider.
8. Upload your certificate to the DocuSign Identity Provider menu.
9. Configure your SAML Attribute mappings. The Attribute Names should match the values in IdP Value in your Access application.
10. Go back to the Identity Provider's screen and select Actions > Endpoints. Copy and save the following:

Service Provider Issuer URL.
Service Provider Assertion Consumer Service URL.
11. Service Provider Issuer URL.
12. Service Provider Assertion Consumer Service URL.

## 3. Finalize your Cloudflare configuration

1. Go back to your DocuSign application under Access > Applications.
2. Select Edit.
3. Use the following mappings:

EntityID->Service Provider Issuer URL.
Assertion Consumer Service URL -> Service Provider Assertion Consumer Service URL.
4. EntityID->Service Provider Issuer URL.
5. Assertion Consumer Service URL -> Service Provider Assertion Consumer Service URL.
6. Save the application.

When ready, enable the SSO for your DocuSign account and you will be able to login to DocuSign via Cloudflare SSO and your Identity Provider.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Dropbox

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/dropbox-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/dropbox-saas/)

Page options # Dropbox

Last reviewed: about 1 year ago This guide covers how to configure Dropbox ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Dropbox  Advanced, Business Plus, or Enterprise account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, select Dropbox.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: Dropbox
Assertion Consumer Service URL: https://www.dropbox.com/saml_login
Name ID format: Email
7. Entity ID: Dropbox
8. Assertion Consumer Service URL: https://www.dropbox.com/saml_login
9. Name ID format: Email
10. Copy the SSO endpoint and Public key.
11. Configure Access policies for the application.
12. Save the application.

## 2. Create a certificate file

1. Paste the Public key in a text editor.
2. Wrap the certificate in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.
3. Set the file extension as .pem and save.

## 3. Add a SAML SSO provider to Dropbox

1. In Dropbox, go to your profile picture > Settings > Admin Console > Security > Single sign-on.
2. For Single sign-on, select Optional.
3. Select Add Identity provider sign-in URL.
4. Paste the SSO endpoint from application configuration in Cloudflare Zero Trust and select Done.
5. Select Add X.509 certificate and upload the .pem file from step 2. Create a certificate file.
6. Copy SSO sign-in URL. This is your custom Dropbox SSO URL.
7. Select Save.

## 3. Test the integration and require SSO

1. Open an incognito browser window and go to your custom Dropbox SSO URL. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
2. After this is successful, you may want to require users to log in via SSO. Go to your profile picture > Settings > Admin Console > Security > Single sign-on. For Single sign-on, select Required. Dropbox will send an email to your users notifying them of the change.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## GitHub Enterprise Cloud

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/github-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/github-saas/)

Page options # GitHub Enterprise Cloud

Last reviewed: about 1 year ago This guide covers how to configure GitHub Enterprise Cloud ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- A GitHub Enterprise Cloud subscription
- Access to a GitHub account as an organization owner

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, select GitHub.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: https://github.com/orgs/<your-organization>
Assertion Consumer Service URL: https://github.com/orgs/<your-organization>/saml/consume
Name ID format: Email
7. Entity ID: https://github.com/orgs/<your-organization>
8. Assertion Consumer Service URL: https://github.com/orgs/<your-organization>/saml/consume
9. Name ID format: Email
10. Copy the SSO endpoint, Access Entity ID or Issuer, and Public key.
11. Configure Access policies for the application.
12. Save the application.

## 2. Create an X.509 certificate

1. Paste the Public key in a text editor.
2. Wrap the certificate in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.

## 3. Configure an identity provider and SAML SSO in GitHub Enterprise Cloud

1. In your GitHub organization page, go to Settings > Authentication security.
2. Under SAML single sign-on, turn on Enable SAML authentication.
3. Fill in the following fields:

Sign on URL:  SSO endpoint from application configuration in Cloudflare Zero Trust.
Issuer: Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
Public certificate: Paste the entire x.509 certificate from step 2. Create a x.509 certificate.
4. Sign on URL:  SSO endpoint from application configuration in Cloudflare Zero Trust.
5. Issuer: Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
6. Public certificate: Paste the entire x.509 certificate from step 2. Create a x.509 certificate.

## 4. Test the integration

Select Test SAML configuration. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
When this is successful, select Save.

You can also turn on Require SAML SSO authentication for all members of your organization if you want to enforce SSO login with Cloudflare Access.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Cloud

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/google-cloud-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/google-cloud-saas/)

Page options # Google Cloud

Last reviewed: about 1 year ago This guide covers how to configure Google Cloud ‚Üó as a SAML application in Cloudflare Zero Trust.

Warning

When configuring Google Cloud with Access, the following limitations apply:

- Users will not be able to log in using Google or Google Workspace as an identity provider after Google Cloud is configured with Access.
- The integration of Access as a single sign-on provider for your Google Cloud account does not work for Google super admins. It will work for other users.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Google Workspace account
- Cloud Identity Free or Premium ‚Üó set up in your organization's Google Cloud account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, select Google Cloud.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: google.com
Assertion Consumer Service URL: https://www.google.com/a/<your_domain.com>/acs
Name ID format: Email
7. Entity ID: google.com
8. Assertion Consumer Service URL: https://www.google.com/a/<your_domain.com>/acs
9. Name ID format: Email
10. Copy the SSO endpoint, Access Entity ID or Issuer, and Public key.
11. Configure Access policies for the application.
12. Save the application.

## 2. Create a x.509 certificate

1. Paste the Public key from application configuration in Cloudflare Zero Trust into a text editor.
2. Wrap the certificate in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.
3. Set the file extension as .crt and save.

## 3. Create an SSO provider in Google Cloud

1. In your Google Admin console ‚Üó, go to Security > Authentication > SSO with third party IdP.
2. Select Third-party SSO profile for your organization > Add SSO Profile.
3. Turn on Set up SSO with third-party identity provider.
4. Fill in the following information:

Sign-in page URL: SSO endpoint from application configuration in Cloudflare Zero Trust.
Sign-out page URL: https://<team-name>.cloudflareaccess.com/cdn-cgi/access/logout, where <team-name> is your Zero Trust team name.
Verification certificate: Upload the .crt certificate file from step 2. Create a x.509 certificate.
5. Sign-in page URL: SSO endpoint from application configuration in Cloudflare Zero Trust.
6. Sign-out page URL: https://<team-name>.cloudflareaccess.com/cdn-cgi/access/logout, where <team-name> is your Zero Trust team name.
7. Verification certificate: Upload the .crt certificate file from step 2. Create a x.509 certificate.
8. (Optional) Turn on Use a domain specific issuer. If you select this option, Google will send an issuer specific to your Google Cloud domain (google.com/a/<your_domain.com> instead of the standard google.com).

## 4. Test the integration

Open an incognito browser window and go to your Google Cloud URL (https://console.cloud.google.com/a/<your_domain.com>). Sign in using credentials that do not belong to a super admin account.

## Troubleshooting

Error: "G Suite - This account cannot be accessed because the login credentials could not be verified."

If you see this error, it is likely that the public key and private key do not match. Confirm that your certificate file includes the correct public key.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Workspace

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/google-workspace-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/google-workspace-saas/)

Page options # Google Workspace

Last reviewed: over 1 year ago This guide covers how to configure Google Workspace ‚Üó as a SAML application in Cloudflare Zero Trust.

Note

The integration of Access as a single sign-on provider for your Google Workspace account does not work for Google super admins. It will work for other users.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Google Workspace account

## 1. Create an application in Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select SaaS application.
3. Fill in the following information:

Application: Google.
Entity ID: Use the value provided to you by Google when configuring your SAML SSO provider ‚Üó.
Assertion Consumer Service URL: https://www.google.com/a/<your_domain.com>/acs, where <your_domain.com> is your Google Workspace domain.
Name ID Format: Email.
4. Application: Google.
5. Entity ID: Use the value provided to you by Google when configuring your SAML SSO provider ‚Üó.
6. Assertion Consumer Service URL: https://www.google.com/a/<your_domain.com>/acs, where <your_domain.com> is your Google Workspace domain.
7. Name ID Format: Email.

Warning

When you put your Google Workspace behind Access, users will not be able to log in using Google or Google Workspace as an identity provider. To secure Google Workspace behind Access and avoid an authentication loop, you must configure a different identity provider (not Google or Google Workspace) for authentication.

1. Create an Access policy for your application. For example, you could allow users with an @your_domain.com email address.
2. Copy the SSO endpoint, Access Entity ID or Issuer, and Public key. These values will be used to configure Google Workspace.
3. Save the application.

## 2. Create a certificate from your public key

1. Copy and then paste your Public key into a text editor.
2. Wrap the certificate in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----. For example,
-----BEGIN CERTIFICATE-----<PUBLIC_KEY>-----END CERTIFICATE-----
3. Set the file extension as .crt and save.

## 3. Create an SSO provider in Google Workspace

1. Log in to your Google Admin console ‚Üó.
2. Go to Security > Authentication > SSO with third party IdP.
3. Select Third-party SSO profile for your organization.
4. Enable Set up SSO with third-party identity provider.
5. Fill in the following information:

Sign-in page URL: Copy and then paste your SSO endpoint from Zero Trust.
Sign-out page URL: https://<team-name>.cloudflareaccess.com/cdn-cgi/access/logout, where <team-name> is your Zero Trust team name.
Verification certificate: Upload the certificate file containing your public key.
6. Sign-in page URL: Copy and then paste your SSO endpoint from Zero Trust.
7. Sign-out page URL: https://<team-name>.cloudflareaccess.com/cdn-cgi/access/logout, where <team-name> is your Zero Trust team name.
8. Verification certificate: Upload the certificate file containing your public key.
9. (Optional) Enable Use a domain specific issuer. If you select this option, Google will send an issuer specific to your Google Workspace domain (google.com/a/<your_domain.com> instead of the standard google.com).

## 4. Test the integration

1. In your Google Admin console ‚Üó, go to Apps > Google Workspace > Gmail > Setup.
2. Copy your Gmail Web address.
3. Open an incognito browser window and go to your Gmail web address (for example, https://mail.google.com/a/<your_domain.com>).

An Access login screen should appear.

## Troubleshooting

Error: "G Suite - This account cannot be accessed because the login credentials could not be verified."

If you see this error, it is likely that the public key and private key do not match. Confirm that your certificate file includes the correct public key.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Grafana

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/grafana-saas-oidc/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/grafana-saas-oidc/)

Page options # Grafana

Last reviewed: about 1 year ago This guide covers how to configure Grafana ‚Üó as an OIDC application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Grafana account

Note

You can also configure OIDC SSO for Grafana using a configuration file ‚Üó instead of using Grafana's user interface (UI), as documented in this guide.

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select SaaS.
3. For Application, select Grafana.
4. For the authentication protocol, select OIDC.
5. Select Add application.
6. In Scopes, select the attributes that you want Access to send in the ID token.
7. In Redirect URLs, enter https://<your-grafana-domain>/login/generic_oauth.
8. (Optional) Enable Proof of Key Exchange (PKCE) ‚Üó if the protocol is supported by your IdP. PKCE will be performed on all login attempts.
9. Copy the Client secret, Client ID, Token endpoint, and Authorization endpoint.
10. Configure Access policies for the application.
11. (Optional) In Experience settings, configure App Launcher settings by turning on Enable App in App Launcher and, in App Launcher URL, entering https://<your-grafana-domain>/login.
12. Save the application.

## 2. Add a SSO provider to Grafana

1. In Grafana, select the menu icon > Administration > Authentication > Generic OAuth.
2. (Optional) For Display name, enter a new display name (for example, Cloudflare Access). Users will select Sign in with (display name) when signing in via SSO.
3. Fill in the following fields:

Client Id: Client ID from application configuration in Cloudflare Zero Trust
Client secret: Client secret from application configuration in Cloudflare Zero Trust
Scopes: Delete user:email and enter the scopes configured in Cloudflare Zero Trust
Auth URL: Authorization endpoint from application configuration in Cloudflare Zero Trust
Token URL: Token endpoint from application configuration in Cloudflare Zero Trust
4. Client Id: Client ID from application configuration in Cloudflare Zero Trust
5. Client secret: Client secret from application configuration in Cloudflare Zero Trust
6. Scopes: Delete user:email and enter the scopes configured in Cloudflare Zero Trust
7. Auth URL: Authorization endpoint from application configuration in Cloudflare Zero Trust
8. Token URL: Token endpoint from application configuration in Cloudflare Zero Trust
9. Select Save.

## 3. Test the integration

Log out, then select Sign in with (display name). You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Grafana Cloud

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/grafana-cloud-saas-oidc/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/grafana-cloud-saas-oidc/)

Page options # Grafana Cloud

Last reviewed: about 1 year ago This guide covers how to configure Grafana Cloud ‚Üó as an OIDC application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Grafana Cloud account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select SaaS.
3. For Application, enter Grafana Cloud and select the corresponding textbox that appears.
4. For the authentication protocol, select OIDC.
5. Select Add application.
6. In Scopes, select the attributes that you want Access to send in the ID token.
7. In Redirect URLs, enter https://<your-grafana-domain>/login/generic_oauth.
8. (Optional) Enable Proof of Key Exchange (PKCE) ‚Üó if the protocol is supported by your IdP. PKCE will be performed on all login attempts.
9. Copy the Client secret, Client ID, Token endpoint, and Authorization endpoint.
10. Configure Access policies for the application.
11. (Optional) In Experience settings, configure App Launcher settings by turning on Enable App in App Launcher and, in App Launcher URL, entering https://<your-grafana-domain>/login.
12. Save the application.

## 2. Add a SSO provider to Grafana Cloud

1. In Grafana Cloud, select the menu icon > Administration > Authentication > Generic OAuth.
2. (Optional) For Display name, enter a new display name (for example, Cloudflare Access). Users will select Sign in with (display name) when signing in via SSO.
3. Fill in the following fields:

Client Id: Client ID from application configuration in Cloudflare Zero Trust
Client secret: Client secret from application configuration in Cloudflare Zero Trust
Scopes: Delete user:email and enter the scopes configured in Cloudflare Zero Trust
Auth URL: Authorization endpoint from application configuration in Cloudflare Zero Trust
Token URL: Token endpoint from application configuration in Cloudflare Zero Trust
4. Client Id: Client ID from application configuration in Cloudflare Zero Trust
5. Client secret: Client secret from application configuration in Cloudflare Zero Trust
6. Scopes: Delete user:email and enter the scopes configured in Cloudflare Zero Trust
7. Auth URL: Authorization endpoint from application configuration in Cloudflare Zero Trust
8. Token URL: Token endpoint from application configuration in Cloudflare Zero Trust
9. Select Save.

## 3. Test the integration

Open an incognito browser window and go to your Grafana domain (https://<your-grafana-domain>/login). Select Sign in with (display name). You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Greenhouse Recruiting

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/greenhouse-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/greenhouse-saas/)

Page options # Greenhouse Recruiting

Last reviewed: about 1 year ago This guide covers how to configure Greenhouse Recruiting ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to an Advanced or Expert Greenhouse Recruiting site

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS.
3. For Application, enter Greenhouse and select the corresponding textbox that appears.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Copy the SAML Metadata endpoint.
7. Keep this window open. You will finish this configuration in step 4. Finish adding a SaaS application to Cloudflare Zero Trust.

## 2. Download the metadata file

1. Paste the SAML Metadata endpoint from application configuration in Cloudflare Zero Trust in a web browser.
2. Follow your browser-specific steps to download the URL's contents as an .xml file.

## 3. Add a SAML SSO provider to Greenhouse

1. In Greenhouse Recruiting, go to the Configure icon > Dev Center > Single sign-on.
2. Copy the SSO Assertion Consumer URL.
3. Under Upload XML file, select Choose a file, and upload the .xml file created in step 2. Download the metadata file.
4. Change the Entity ID to greenhouse.io.
5. Keep this window open without selecting Begin testing. You will finish this configuration in step 5. Test the integration and finalize configuration.

## 4. Finish adding a SaaS application to Cloudflare Zero Trust

1. In your open Zero Trust window, fill in the following fields:

Entity ID: greenhouse.io
Assertion Consumer Service URL: SSO Assertion Consumer URL from SSO configuration in Greenhouse Recruiting.
Name ID format: Email
2. Entity ID: greenhouse.io
3. Assertion Consumer Service URL: SSO Assertion Consumer URL from SSO configuration in Greenhouse Recruiting.
4. Name ID format: Email
5. Configure Access policies for the application.
6. Save the application.

## 5. Test the integration and finalize configuration

1. In your open Greenhouse Recruiting window, select Begin Testing > Proceed.
2. Open an incognito browser window and go to your Greenhouse Recruiting URL. Choose the SSO login option. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
3. Once SSO sign in is successful, go to the Configure icon > Dev Center > Single sign-on.
4. Select Finalize Configuration.
5. In the text field, enter CONFIGURE.
6. Select Finalize. Now, users will only be able to sign in with SSO.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Hubspot

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/hubspot-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/hubspot-saas/)

Page options # Hubspot

Last reviewed: about 1 year ago This guide covers how to configure Hubspot ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Hubspot Enterprise plan account

## 1. Configure Hubspot

1. Go to Settings > Account, then go to Defaults > Security.
2. Select Single Sign-on.
3. Copy the values for Audience URI and Sign on URL.

## 2. Configure Cloudflare Access

1. In Zero Trust, go to Access > Applications and create a SaaS application.
2. Set the Application type to Hubspot.
3. Use the following Hubspot field mappings:

















Hubspot valuesCloudflare valuesAudience URIEntity IDSign On URLAssertion Consumer Service URL
4. Set NameID to Email.
5. Add any desired Access policies to your application.
6. Copy the SSO endpoint and Access Entity ID.
7. Save the application.

## 3. Create a x.509 certificate

1. Paste the Public key in a text editor.
2. Wrap the certificate in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.

## 4. Finalize Hubspot configuration

1. Use the following field mappings:





















Cloudflare valueHubspot valueSSO endpointIdentity Provider Single Sign-on URLEntity IDIdentity Provider IdentifierPublic keyCertificate
2. Select Verify to validate the integration.

Your configuration is now complete. Hubspot SSO can be switched on for specific users or the entire account.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Ironclad

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/ironclad-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/ironclad-saas/)

Page options # Ironclad

Last reviewed: about 1 year ago This guide covers how to configure Ironclad ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Ironclad site

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS.
3. For Application, enter Ironclad and select the corresponding textbox that appears.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Copy the SSO Endpoint and Public key.
7. Keep this window open. You will finish this configuration in step 3. Finish adding a SaaS application to Cloudflare Zero Trust.

## 2. Add a SAML SSO provider to Ironclad

1. In Ironclad, select your profile picture > Company settings > Integrations > SAML.
2. Select Add SAML Configuration > Show Additional IdP Settings.
3. Copy the Callback value.
4. Fill in the following fields:

Entry Point: SSO endpoint from application configuration in Cloudflare Zero Trust.
Identity Provider Certificate: Public key from application configuration in Cloudflare Zero Trust.  The key will automatically be wrapped in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.
5. Entry Point: SSO endpoint from application configuration in Cloudflare Zero Trust.
6. Identity Provider Certificate: Public key from application configuration in Cloudflare Zero Trust.  The key will automatically be wrapped in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.
7. Select Save.

## 3. Finish adding a SaaS application to Cloudflare Zero Trust

1. In your open Zero Trust window, fill in the following fields:

Entity ID: ironcladapp.com
Assertion Consumer Service URL: Callback from Ironclad SAML SSO set-up.
Name ID format: Email
2. Entity ID: ironcladapp.com
3. Assertion Consumer Service URL: Callback from Ironclad SAML SSO set-up.
4. Name ID format: Email
5. Configure Access policies for the application.
6. Save the application.

## 4. Add a test user to Ironclad and test the integration

1. In Ironclad, select your profile picture > Company settings > Users & Groups.
2. Select Invite User.
3. For Email addresses, add your desired email address for your test user.
4. For Sign-in Method, ensure Sign in with (your-team-domain.cloudflareaccess.com) is selected
5. Select Invite.
6. In the invitation email sent to the test user, select Join now. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
7. Once this is successful, you can contact your account team or support@ironcladapp.com to migrate existing users to SSO login.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Jamf Pro

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/jamf-pro-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/jamf-pro-saas/)

Page options # Jamf Pro

Last reviewed: about 1 year ago This guide covers how to configure Jamf Pro ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Jamf Pro account

## 1. Collect Jamf Pro information

1. In Jamf Pro, go to Settings > Systems > Single Sign-On > Edit.
2. Copy the pre-populated URL in Entity ID.
3. Paste the URL in a web browser to download the Jamf metadata file.
4. Open the metadata.xml file in a text editor, and copy the values for Entity ID and Assertion Consumer Service.

## 2. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS.
3. For Application, enter Jamf  or Jamf Pro and select the corresponding textbox that appears.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: Entity ID value from Jamf Pro metadata file.
Assertion Consumer Service URL: Assertion Consumer Service value from Jamf Pro metadata file.
Name ID format: Email
7. Entity ID: Entity ID value from Jamf Pro metadata file.
8. Assertion Consumer Service URL: Assertion Consumer Service value from Jamf Pro metadata file.
9. Name ID format: Email
10. Copy the SAML Metadata endpoint.
11. Configure Access policies for the application.
12. Save the application.

## 3. Edit Access SAML Metadata

1. Paste the SAML Metadata endpoint from application configuration in Cloudflare Zero Trust into a browser.
2. Copy the file and paste it into a text editor.
3. Change WantAuthnRequestsSigned="true" to WantAuthnRequestsSigned="false".
4. Set the file extension as .xml and save.

## 4. Add a SAML SSO provider to Jamf Pro

1. In Jamf Pro, go to Settings > Single Sign-On > Edit.
2. In Identity Provider menu, select Other.
3. Label Other provider as Cloudflare.
4. Fill in the following fields:

Entity ID: Entity ID from Jamf Pro metadata file.
Identity Provider Metadata Source: Select Metadata File and upload the .xml file from step 2. Edit Access SAML Metadata.
Identity Provider User Mapping: Name ID
Jamf Pro User Mapping: Email
5. Entity ID: Entity ID from Jamf Pro metadata file.
6. Identity Provider Metadata Source: Select Metadata File and upload the .xml file from step 2. Edit Access SAML Metadata.
7. Identity Provider User Mapping: Name ID
8. Jamf Pro User Mapping: Email
9. Turn on Single Sign On.

Note

The Failover Login URL located on this page can be used to log in if your SSO does not work.

## 5. Test the Integration

Log out of Jamf Pro and open an incognito browser window. Go to your Jamf Pro URL. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Miro

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/miro-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/miro-saas/)

Page options # Miro

Last reviewed: about 1 year ago This guide covers how to configure Miro ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Miro Business or Enterprise plan account
- A verified domain ‚Üó added to your Miro account (Enterprise plan), or be prepared to do so during SSO configuration (Business or Enterprise plan)

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS.
3. For Application, enter Miro and select the corresponding textbox that appears.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: https://miro.com/
Assertion Consumer Service URL: https://miro.com/sso/saml
Name ID format: Email
7. Entity ID: https://miro.com/
8. Assertion Consumer Service URL: https://miro.com/sso/saml
9. Name ID format: Email
10. Copy the SSO endpoint and Public key.
11. Configure Access policies for the application.
12. Save the application.

## 2. Add a SAML SSO provider to Miro

- business plan
- enterprise plan

1. In Miro, select your profile picture > Settings > **Security**.
2. Turn on SSO/SAML.
3. Fill in the following fields:

SAML Sign-in URL: SSO endpoint from application configuration in Cloudflare Zero Trust
Key x509 Certificate: Public key from application configuration in Cloudflare Zero Trust
4. SAML Sign-in URL: SSO endpoint from application configuration in Cloudflare Zero Trust
5. Key x509 Certificate: Public key from application configuration in Cloudflare Zero Trust
6. In Domain, enter the domain you want to configure SSO for and select Enter.
7. Enter an email address from that domain and select send verification.
8. Once you receive a verification email, select the link in the email, then select Save. When the domain is successfully configured, the VERIFY EMAIL label next to the domain in the SSO/SAML configuration page will disappear.
9. If you have additional domains you want to configure SSO for, repeat steps 4-6 for each domain.

1. In Miro, select your profile picture > Settings > **Security and Compliance** > **Authentication** > **Single sign-on**.
2. Turn on SSO/SAML.
3. Fill in the following fields:

SAML Sign-in URL: SSO endpoint from application configuration in Cloudflare Zero Trust
Key x509 Certificate: Public key from application configuration in Cloudflare Zero Trust
4. SAML Sign-in URL: SSO endpoint from application configuration in Cloudflare Zero Trust
5. Key x509 Certificate: Public key from application configuration in Cloudflare Zero Trust
6. In Domain, enter the domain you want to configure SSO for and select Enter.
7. If you have not previously [verified the domain](https://help.miro.com/hc/articles/360034831793-Domain-control), enter an email address from that domain and select send verification.
8. Once you receive a verification email, select the link in the email, then select Save. When the domain is successfully configured, the VERIFY EMAIL label next to the domain in the SSO/SAML configuration page will disappear.
9. If you have additional domains you want to configure SSO for, repeat steps 4-6 for each domain.

## 3. Test the integration

In the Miro SAML/SSO configuration page, select Test SSO Configuration. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider. If the login is successful, you will receive a SSO configuration test was successful message.

Note

When testing the integration, you do not have to use an email from a domain you have configured for SSO or a user configured in Miro. The only requirement is that the user is already configured in your identity provider.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## PagerDuty

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/pagerduty-saml-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/pagerduty-saml-saas/)

Page options # PagerDuty

Last reviewed: about 1 year ago This guide covers how to configure PagerDuty ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a PagerDuty site

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS.
3. For Application, select PagerDuty.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: https://<your-subdomain>.pagerduty.com
Assertion Consumer Service URL:  https://<your-subdomain>.pagerduty.com/sso/saml/consume
Name ID format: Email
7. Entity ID: https://<your-subdomain>.pagerduty.com
8. Assertion Consumer Service URL:  https://<your-subdomain>.pagerduty.com/sso/saml/consume
9. Name ID format: Email
10. Copy the SSO endpoint and Public key.
11. Configure Access policies for the application.
12. Save the application.

## 2. Create a x.509 certificate

1. Paste the Public key in a text editor.
2. Amend the public key so each row is a maximum of 64 characters long. Originally, each full row of the public key is 65 characters long.
3. Wrap the certificate in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.

## 3. Add a SAML SSO provider to PagerDuty

1. In PagerDuty, select your profile picture and go to Account Settings > Single Sign-on.
2. Turn on SAML.
3. In X.509 Certificate, paste the entire x.509 certificate from step 2. Create a x.509 certificate.
4. In Login URL, paste the SSO endpoint from application configuration in Cloudflare Zero Trust.
5. Select Save Changes.

## 4. Test the integration and finalize SSO configuration

1. Open an incognito window and paste your PagerDuty URL into the address bar. Select Sign In With Single Sign-On. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
2. In an incognito window, paste your PagerDuty URL and select Sign In With Single Sign-On. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
3. Once SSO sign in is successful, select your profile picture and go to Account Settings > Single Sign-on.
4. Turn off Allow username/password login and select Save Changes. Now, users will only be able to sign in with SSO.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Pingboard

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/pingboard-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/pingboard-saas/)

Page options # Pingboard

Last reviewed: about 1 year ago This guide covers how to configure Pingboard ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Pingboard account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, enter Pingboard and select the corresponding textbox that appears.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: http://app.pingboard.com/sp
Assertion Consumer Service URL: https://sso-demo.pingboard.com/auth/saml/consume
Name ID format: Email
7. Entity ID: http://app.pingboard.com/sp
8. Assertion Consumer Service URL: https://sso-demo.pingboard.com/auth/saml/consume
9. Name ID format: Email
10. Copy the SAML Metadata endpoint.
11. Configure Access policies for the application.
12. Save the application.

## 2. Add a SAML SSO provider to Pingboard

1. In Pingboard, go to Account > Add-Ons.
2. Under Third-Party Integrations, select Custom SSO.
3. In a web browser, paste the SAML Metadata endpoint you copied from the application configuration in Cloudflare Zero Trust. Next, copy the contents of the displayed page.
4. In Pingboard, under IdP Metadata, paste the contents from the SAML Metadata endpoint.
5. (Optional) Under Sign in with, enter a name (for example, Cloudflare Access). Your users will select this name when signing in.

## 3. Test the integration

Open an incognito browser window and go to your Pingboard URL. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Salesforce (OIDC)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/salesforce-saas-oidc/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/salesforce-saas-oidc/)

Page options # Salesforce (OIDC)

Last reviewed: about 1 year ago This guide covers how to configure Salesforce ‚Üó as an OpenID Connect (OIDC) application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Salesforce account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select SaaS.
3. For Application, select Salesforce.
4. For the authentication protocol, select OIDC.
5. Select Add application.
6. In Scopes, select the attributes that you want Access to send in the ID token.
7. In Redirect URLs, enter the callback URL obtained from Salesforce (https://<your-domain>.my.salesforce.com/services/authcallback/<URL Suffix>). Refer to Add a SSO provider to Salesforce for instructions on obtaining this value.
8. (Optional) Enable Proof of Key Exchange (PKCE) ‚Üó if the protocol is supported by your IdP. PKCE will be performed on all login attempts.
9. Copy the following values:

Client ID
Client Secret
Authorization endpoint
Token endpoint
User info endpoint
10. Client ID
11. Client Secret
12. Authorization endpoint
13. Token endpoint
14. User info endpoint
15. Configure Access policies for the application.
16. (Optional) In Experience settings, configure App Launcher settings by turning on Enable App in App Launcher and, in App Launcher URL, entering https://<your-domain>.my.salesforce.com.
17. Save the application.

## 2. Add a SSO provider to Salesforce

1. In Salesforce, go to Setup.
2. In the Quick Find box, enter auth and select Auth providers.
3. Select New.
4. For the provider type, select OpenID Connect.
5. Enter a name for the SSO provider (for example, Cloudflare Access).
6. Fill in the following fields with values obtained from Cloudflare Access:

Consumer Key: Client ID
Consumer Secret: Client Secret
Authorize Endpoint URL: Authorization endpoint
Token endpoint URL: Token endpoint
User Info Endpoint URL: User info endpoint
Token Issuer: Issuer
7. Consumer Key: Client ID
8. Consumer Secret: Client Secret
9. Authorize Endpoint URL: Authorization endpoint
10. Token endpoint URL: Token endpoint
11. User Info Endpoint URL: User info endpoint
12. Token Issuer: Issuer
13. (Optional) Enable Use Proof Key for Code Exchange if you enabled it in Access.
14. In Default Scopes, enter a space-separated list of the scopes you configured in Access (for example, openid email profile groups).
15. Select Save.
16. Copy the Callback URL:
https://<your-domain>.my.salesforce.com/services/authcallback/<URL Suffix>
17. In Zero Trust, paste the Callback URL into the Redirect URL field.

To test the integration, open an incognito browser window and go to the Test-Only Initialization URL ( https://<your-domain>.my.salesforce.com/services/auth/test/<URL Suffix>)

## 3. Enable Single Sign-On in Salesforce

1. Enable Cloudflare Access as an identity provider on your Salesforce domain:

In the Quick Find box, enter domain and select My Domain.
In Authentication Configuration, select Edit.
In Authentication Service, turn on the Cloudflare Access provider.
2. In the Quick Find box, enter domain and select My Domain.
3. In Authentication Configuration, select Edit.
4. In Authentication Service, turn on the Cloudflare Access provider.
5. (Optional) To require users to login with Cloudflare Access:

In the Quick Find box, enter single sign-on and select Single Sign-On Settings.
Turn on Disable login with Salesforce credentials.
6. In the Quick Find box, enter single sign-on and select Single Sign-On Settings.
7. Turn on Disable login with Salesforce credentials.

To test, open an incognito browser window and go to your Salesforce domain (https://<your-domain>.my.salesforce.com).

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Salesforce (SAML)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/salesforce-saas-saml/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/salesforce-saas-saml/)

Page options # Salesforce (SAML)

Last reviewed: about 1 year ago This guide covers how to configure Salesforce ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Salesforce account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select SaaS.
3. For Application, select Salesforce.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: https://<your-domain>.my.salesforce.com or https://<your-domain>.my.salesforce.com?so=<your-salesforce-org-id>, if your account was created before summer 2019 or does not have a My Domain subdomain.
Assertion Consumer Service URL: https://<your-domain>.my.salesforce.com or https://<your-domain>.my.salesforce.com?so=<your-salesforce-org-id>, if your account was created before summer 2019 or does not have a My Domain subdomain.
Name ID format: Email
7. Entity ID: https://<your-domain>.my.salesforce.com or https://<your-domain>.my.salesforce.com?so=<your-salesforce-org-id>, if your account was created before summer 2019 or does not have a My Domain subdomain.
8. Assertion Consumer Service URL: https://<your-domain>.my.salesforce.com or https://<your-domain>.my.salesforce.com?so=<your-salesforce-org-id>, if your account was created before summer 2019 or does not have a My Domain subdomain.
9. Name ID format: Email

Note

If you are unsure of which URL to use in the Entity ID and Assertion Consumer Service URL fields, you can check your Salesforce account's metadata. In Salesforce, go to the Single Sign-On Settings page and select Download Metadata. In this file, you will find the correct URLs to use.

1. Copy the SSO endpoint, Public key, and Access Entity ID or Issuer.
2. Configure Access policies for the application.
3. Save the application.

## 2. Create a certificate file

1. Paste the Public key in a text editor.
2. Wrap the certificate in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.
3. Set the file extension as .crt and save.

## 3. Add a SAML SSO provider to Salesforce

1. In Salesforce, go to Setup.
2. In the Quick Find box, enter single sign-on and select Single Sign-On Settings.
3. In SAML Single Sign-On Settings, select New.
4. Fill in the following fields:

Name: Name of the SSO provider (for example, Cloudflare Access). Users will select this name when signing in to Salesforce.
API name: (this will pre-populate)
Issuer: Paste the Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
Identity Provider Certificate: Upload the .crt certificate file from 2. Create a certificate file.
Entity ID: https://<your-domain>.my.salesforce.com
SAML Identity type: If the user's Salesforce username is their email address, select Assertion contains the User's Salesforce username. Otherwise, select Assertion contains the Federation ID from the User object and make sure the user's Federation ID matches their email address.

 Configure Federation IDs
 
In the Quick Find box, enter users and select Users. 2. Select
the user. 3. Verify that the user's Federation ID matches the email
address used to authenticate to Cloudflare Access.
 

Identity Provider Login URL: SSO endpoint provided in Cloudflare Zero
Trust for this application.
5. Name: Name of the SSO provider (for example, Cloudflare Access). Users will select this name when signing in to Salesforce.
6. API name: (this will pre-populate)
7. Issuer: Paste the Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
8. Identity Provider Certificate: Upload the .crt certificate file from 2. Create a certificate file.
9. Entity ID: https://<your-domain>.my.salesforce.com
10. SAML Identity type: If the user's Salesforce username is their email address, select Assertion contains the User's Salesforce username. Otherwise, select Assertion contains the Federation ID from the User object and make sure the user's Federation ID matches their email address.
11. In the Quick Find box, enter users and select Users. 2. Select
the user. 3. Verify that the user's Federation ID matches the email
address used to authenticate to Cloudflare Access.
12. Identity Provider Login URL: SSO endpoint provided in Cloudflare Zero
Trust for this application.
13. Select Save.

## 4. Enable Single Sign-On in Salesforce

1. Configure Single Sign-On settings:

In the Quick Find box, enter single sign-on and select Single Sign-On Settings.
(Optional) To require users to login with Cloudflare Access, turn on Disable login with Salesforce credentials.
Turn on SAML Enabled.
Turn on Make federation ID case-insensitive.
2. In the Quick Find box, enter single sign-on and select Single Sign-On Settings.
3. (Optional) To require users to login with Cloudflare Access, turn on Disable login with Salesforce credentials.
4. Turn on SAML Enabled.
5. Turn on Make federation ID case-insensitive.
6. Enable Cloudflare Access as an identity provider on your Salesforce domain:

In the Quick Find box, enter domain and select My Domain.
In Authentication Configuration, select Edit.
In Authentication Service, turn on the Cloudflare Access provider.
7. In the Quick Find box, enter domain and select My Domain.
8. In Authentication Configuration, select Edit.
9. In Authentication Service, turn on the Cloudflare Access provider.

To test, open an incognito browser window and go to your Salesforce domain (https://<your-domain>.my.salesforce.com).

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## ServiceNow (OIDC)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/servicenow-saas-oidc/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/servicenow-saas-oidc/)

Page options # ServiceNow (OIDC)

Last reviewed: about 1 year ago This guide covers how to configure ServiceNow ‚Üó as an OIDC application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a ServiceNow account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select SaaS.
3. For Application, enter ServiceNow and select the corresponding textbox that appears.
4. For the authentication protocol, select OIDC.
5. Select Add application.
6. In Scopes, select the attributes that you want Access to send in the ID token.
7. In Redirect URLs, enter https://<INSTANCE-NAME>.service-now.com/navpage.do.
8. (Optional) Enable Proof of Key Exchange (PKCE) ‚Üó if the protocol is supported by your IdP. PKCE will be performed on all login attempts.
9. Copy the Client secret and Client ID.
10. Configure Access policies for the application.
11. (Optional) In Experience settings, configure App Launcher settings by turning on Enable App in App Launcher and, in App Launcher URL, entering https://<INSTANCE-NAME>.service-now.com.
12. Save the application.

## 2. Add the Multiple Provider Single Sign-On Installer Plugin to ServiceNow

1. In ServiceNow, select All.
2. In the search bar, enter System Applications, and under All Available Applications, select All.
3. In the search bar, enter Integration - Multiple Provider Single Sign-On Installer.
4. Select Install.
5. Ensure that Install now is selected, and select Install.

## 3. Add and Test an OIDC SSO provider in ServiceNow

1. Select All.
2. In the search bar enter Multi-Provider SSO, and select Identity Providers.
3. Select New > OpenID Connect.
4. In the pop-up, fill in the following fields:

Name: Name of the SSO (for example, Cloudflare Access). Unless otherwise configured, users will select this name when signing in to ServiceNow.
Client ID: Client ID from application configuration in Cloudflare Zero Trust.
Client Secret: Client Secret from application configuration in Cloudflare Zero Trust.
Well Known Configuration URL: https://<TEAM-DOMAIN>.cloudflareaccess.com/cdn-cgi/access/sso/oidc/<CLIENT-ID>/.well-known/openid-configuration.
5. Name: Name of the SSO (for example, Cloudflare Access). Unless otherwise configured, users will select this name when signing in to ServiceNow.
6. Client ID: Client ID from application configuration in Cloudflare Zero Trust.
7. Client Secret: Client Secret from application configuration in Cloudflare Zero Trust.
8. Well Known Configuration URL: https://<TEAM-DOMAIN>.cloudflareaccess.com/cdn-cgi/access/sso/oidc/<CLIENT-ID>/.well-known/openid-configuration.
9. Select Import.
10. Ensure Active is turned on
11. Turn on Show as Login option, and for SSO label enter a label for the user login screen, if desired.
12. Select Update.

## 4. Test the integration

For SSO to appear on the login screen, you must have account recovery ‚Üó enabled and configured for at least one admin account. After account recovery is configured, log out of ServiceNow and open an incognito browser window. Go to your ServiceNow URL. Select the SSO name you just configured, which will prompt you to sign in with your identity provider. When the integration is successful, you can go back to the OIDC configuration screen to turn on Default and/or Auto Redirect IDP.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## ServiceNow (SAML)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/servicenow-saas-saml/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/servicenow-saas-saml/)

Page options # ServiceNow (SAML)

Last reviewed: about 1 year ago This guide covers how to configure ServiceNow ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a ServiceNow account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, enter ServiceNow and select the corresponding textbox that appears.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: https://<INSTANCE-NAME>.service-now.com
Assertion Consumer Service URL: https://<INSTANCE-NAME>.service-now.com/navpage.do
Name ID format: Email
7. Entity ID: https://<INSTANCE-NAME>.service-now.com
8. Assertion Consumer Service URL: https://<INSTANCE-NAME>.service-now.com/navpage.do
9. Name ID format: Email
10. Copy the SAML Metadata endpoint.
11. Configure Access policies for the application.
12. Save the application.

## 2. Add the Multiple Provider Single Sign-On Installer Plugin to ServiceNow

1. In ServiceNow, select All.
2. In the search bar, enter System Applications, and under All Available Applications, select All.
3. In the search bar, enter Integration - Multiple Provider Single Sign-On Installer.
4. Select Install.
5. Ensure that Install now is selected, and select Install.

## 3. Add and Test a SAML SSO provider in ServiceNow

1. Select All.
2. In the search bar enter Multi-Provider SSO, and select Identity Providers.
3. Select New > SAML.
4. In the pop-up, ensure that URL is selected.
5. Paste the SAML Metadata endpoint from application configuration in Cloudflare Zero Trust in the empty field.
6. Select Import.
7. (Optional) Change the Name field to a more recognizable name.
8. Turn off Sign AuthnRequest.
9. Select Update.
10. In the pop-up, select Cancel and then >.
11. Select the Name of the configuration you just completed.
12. Select Test Connection.
13. If the test succeeds, select Activate.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Slack

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/slack-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/slack-saas/)

Page options # Slack

Last reviewed: about 1 year ago This guide covers how to configure Slack ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Slack Business+ or Enterprise Grid plan account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS.
3. For Application, select Slack.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: https://slack.com
Assertion Consumer Service URL: https://<YOUR_DOMAIN>.slack.com/sso/saml
Name ID format: The format expected by Slack, usually Email
7. Entity ID: https://slack.com
8. Assertion Consumer Service URL: https://<YOUR_DOMAIN>.slack.com/sso/saml
9. Name ID format: The format expected by Slack, usually Email
10. Copy the SSO endpoint, Access Entity ID or Issuer, and Public key.
11. Configure Access policies for the application.
12. Save the application.

## 2. Create a x.509 certificate

1. Paste the Public key in a text editor.
2. Wrap the certificate in -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.

## 3. Add a SAML SSO provider to Slack

- business+ plan
- enterprise grid plan

1. In Slack, go to Settings & administrations > Workspace settings > Authentication.
2. Select Configure.
3. Turn on Test. Configuration changes will not apply until Configure is turned on.
4. Fill in the following fields:

Service Provider Issuer URL: Ensure set to https://slack.com.
SAML SSO URL: SSO endpoint from application configuration in Cloudflare Zero Trust.
Identity Provider Issuer: Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
Public Certificate: Paste the entire x.509 certificate from step 2. Create a x.509 certificate.
5. Service Provider Issuer URL: Ensure set to https://slack.com.
6. SAML SSO URL: SSO endpoint from application configuration in Cloudflare Zero Trust.
7. Identity Provider Issuer: Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
8. Public Certificate: Paste the entire x.509 certificate from step 2. Create a x.509 certificate.
9. Under Advanced Options, select Expand.
10. For AuthnContextClassRef, ensure urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport is selected.
11. Ensure Sign the AuthnRequest is turned off.
12. For SAML Response Signing, turn on Sign the Response and Sign the Assertion.
13. In the main configuration page under Settings, choose whether SSO is required, partially required, or optional for workspace members.
14. (Optional) Under Customize, enter a Sign in Button Label.
15. Test your set-up. If all works well, turn Test to Configure.

1. In Slack, go to Settings & administration > Organization settings > Security > SSO Settings.
2. For SSO name, enter your desired name.
3. Fill in the following fields:

SAML 2.0 Endpoint URL: SSO endpoint from application configuration in Cloudflare Zero Trust.
Identity Provider Issuer URL: Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
Service Provider Issuer URL: Ensure set to https://slack.com.
x.509 Certificate: Paste the entire x.509 certificate from step 2. Create a x.509 certificate.
4. SAML 2.0 Endpoint URL: SSO endpoint from application configuration in Cloudflare Zero Trust.
5. Identity Provider Issuer URL: Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust.
6. Service Provider Issuer URL: Ensure set to https://slack.com.
7. x.509 Certificate: Paste the entire x.509 certificate from step 2. Create a x.509 certificate.
8. For AuthnContextClassRef, ensure urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport is selected.
9. Ensure Sign the AuthnRequest is turned off.
10. For SAML Response Signing, turn on Sign the Response and Sign the Assertion.
11. Select Test Configuration.
12. If all works well, select Turn on SSO or Add SSO.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Smartsheet

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/smartsheet-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/smartsheet-saas/)

Page options # Smartsheet

Last reviewed: about 1 year ago This guide covers how to configure Smartsheet ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Smartsheet Enterprise account
- A domain ‚Üó verified in Smartsheet

Note

In Smartsheet, SSO is configured for a domain. If you have multiple plans using the same domain, the SSO configuration will apply to all Smartsheet users in that domain, regardless of their plan type.

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, enter Smartsheet and select the corresponding textbox that appears.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: urn:amazon:cognito:sp:us-east-1_xww1cbP43
Assertion Consumer Service URL: https://saml.authn.smartsheet.com/saml2/idpresponse
Name ID format: Unique ID
7. Entity ID: urn:amazon:cognito:sp:us-east-1_xww1cbP43
8. Assertion Consumer Service URL: https://saml.authn.smartsheet.com/saml2/idpresponse
9. Name ID format: Unique ID
10. Copy the SAML Metadata endpoint.
11. Configure Access policies for the application.
12. Save the application.

## 2. Create and test a SAML SSO provider in Smartsheet

1. In your Smartsheet Admin Center, go to Settings > Authentication > Add a SAML IdP.
2. In Other IdP (Customize), select Configure.
3. Select Next.
4. Under XML URL, paste the SAML Metadata endpoint from application configuration in Cloudflare Zero Trust.
5. Under Name SAML IdP, enter a name (for example, Cloudflare Access).
6. Select Save & Next.
7. Select Verify connection and sign in via Access. If validation is successful, you will see a SAML IdP Successfully Connected! message. Close the configuration verification page.
8. Turn on I have successfully verified the connection.
9. Select Save & Next.
10. Under Assign domains to SAML IdP, select your desired domain.
11. Select Save and Next and then Finish.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SparkPost

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/sparkpost-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/sparkpost-saas/)

Page options # SparkPost

Last reviewed: over 1 year ago This guide covers how to configure SparkPost or SparkPost EU ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a SparkPost or SparkPost EU account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, enter SparkPost and select the corresponding textbox that appears.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID:

https://api.sparkpost.com for SparkPost accounts
https://api.eu.sparkpost.com for SparkPost EU accounts
https://<api-host> for SparkPost accounts with dedicated tenants


Assertion Consumer Service URL:

https://api.sparkpost.com/api/v1/users/saml/consume for SparkPost accounts
https://api.eu.sparkpost.com/api/v1/users/saml/consume for SparkPost EU accounts
https://<api-host>/api/v1/users/saml/consume for SparkPost accounts with dedicated tenants


Name ID format: Email
7. Entity ID:

https://api.sparkpost.com for SparkPost accounts
https://api.eu.sparkpost.com for SparkPost EU accounts
https://<api-host> for SparkPost accounts with dedicated tenants
8. https://api.sparkpost.com for SparkPost accounts
9. https://api.eu.sparkpost.com for SparkPost EU accounts
10. https://<api-host> for SparkPost accounts with dedicated tenants
11. Assertion Consumer Service URL:

https://api.sparkpost.com/api/v1/users/saml/consume for SparkPost accounts
https://api.eu.sparkpost.com/api/v1/users/saml/consume for SparkPost EU accounts
https://<api-host>/api/v1/users/saml/consume for SparkPost accounts with dedicated tenants
12. https://api.sparkpost.com/api/v1/users/saml/consume for SparkPost accounts
13. https://api.eu.sparkpost.com/api/v1/users/saml/consume for SparkPost EU accounts
14. https://<api-host>/api/v1/users/saml/consume for SparkPost accounts with dedicated tenants
15. Name ID format: Email
16. Copy the SAML Metadata endpoint.
17. Configure Access policies for the application.
18. Save the application.

## 2. Download the metadata file

1. Paste the SAML metadata endpoint from application configuration in Cloudflare Zero Trust in a web browser.
2. Follow your browser-specific steps to download the URL's contents as an .xml file.

## 3. Add a SAML SSO provider to SparkPost

1. In SparkPost, select your profile picture > Account Settings.
2. Under Single Sign-On, select Provision SSO.
3. Under Upload your Security Assertion Markup Language (SAML), select select a file and upload the .xml file you created in step 2. Download the metadata file.
4. Select Provision SSO.
5. Select Enable SSO.

## 4. Add a test user and test the integration

1. In SparkPost, current users must be deleted and re-invited to use SSO. To create a test user, select your profile picture > Users > name of the user > Delete User. Then, select Invite User and fill in the necessary information. Alternatively, invite a new user. An invitation email will be sent.
2. Go to the link sent in the invitation email. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
3. Once SSO is successful, you can turn on SSO for the rest of your current users by deleting and then re-inviting them.

Note

The SparkPost SSO login link is https://app.sparkpost.com/auth/sso. Alternatively, you can go to the usual sign in page and select Log in with Single Sign-On.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tableau Cloud

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/tableau-saml-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/tableau-saml-saas/)

Page options # Tableau Cloud

Last reviewed: about 1 year ago This guide covers how to configure Tableau Cloud ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Tableau Cloud site

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS.
3. For Application, select Tableau.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Copy the SAML Metadata endpoint.
7. Keep this window open. You will finish this configuration in step 4. Finish adding a SaaS application to Cloudflare Zero Trust.

## 2. Download the metadata file

1. Paste the SAML Metadata endpoint from application configuration in Cloudflare Zero Trust in a web browser.
2. Follow your browser-specific steps to download the URL's contents as an .xml file.

## 3. Add a SAML SSO provider to Tableau Cloud

1. In Tableau Cloud, go to Settings > Authentication.
2. Turn on Enable an additional authentication method. For select authentication type, select SAML.
3. Under 1. Get Tableau Cloud metadata, copy the Tableau Cloud entity ID and Tableau Cloud ACS URL.
4. Under 4. Upload metadata to Tableau, select Choose a file, and upload the .xml file created in step 2. Download the metadata file
5. Under 5. Map attributes, turn on Full name. For Name (full name), enter name.
6. (Optional) Choose whether users who are accessing embedded views will Authenticate in a separate pop-up window or Authenticate using an inline frame.
7. Select Save Changes.

## 4. Finish adding a SaaS application to Cloudflare Zero Trust

1. In your open Zero Trust window, fill in the following fields:

Entity ID: Tableau Cloud entity ID from Tableau Cloud SAML SSO set-up.
Assertion Consumer Service URL: Tableau Cloud ACS URL from Tableau Cloud SAML SSO set-up.
Name ID format: Email
2. Entity ID: Tableau Cloud entity ID from Tableau Cloud SAML SSO set-up.
3. Assertion Consumer Service URL: Tableau Cloud ACS URL from Tableau Cloud SAML SSO set-up.
4. Name ID format: Email
5. Configure Access policies for the application.
6. Save the application.

## 5. Test the integration and set default authentication type

1. In Tableau Cloud, go to Settings > Authentication.
2. Under 7. Test Configuration, select Test Configuration.
3. Sign in. If your sign-in is successful, You are now signed in as (username) will appear at the top of the page.
4. Close the pop-up window.
5. (Optional) Under Default Authentication Type for Embedded Views, turn on cloudflareaccess.com (SAML). You can also configure the default authentication type for individual users under Users > Actions > Authentication.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Workday

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/workday-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/workday-saas/)

Page options # Workday

Last reviewed: about 1 year ago This guide covers how to configure Workday ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Workday account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, enter Workday and select the corresponding textbox that appears.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID: http://www.workday.com
Assertion Consumer Service URL: https://<your-environment>.myworkday.com/<your-tenant>/login-saml.flex for a production account or https://<your-environment>-impl.myworkday.com/<your-tenant>/login-saml.flex for a preview sandbox account
Name ID format: Email
7. Entity ID: http://www.workday.com
8. Assertion Consumer Service URL: https://<your-environment>.myworkday.com/<your-tenant>/login-saml.flex for a production account or https://<your-environment>-impl.myworkday.com/<your-tenant>/login-saml.flex for a preview sandbox account
9. Name ID format: Email
10. Copy the SSO endpoint, Access Entity ID or Issuer, and Public key.
11. Configure Access policies for the application.
12. Save the application.

## 2. Download the metadata file

1. Paste the SAML Metadata endpoint from application configuration in Cloudflare Zero Trust in a web browser.
2. Follow your browser-specific steps to download the URL's contents as an .xml file.

## 3. Add a SAML SSO provider to Workday

1. In Workday, go to Account Administration > Actions > Edit Tenant Setup - Security.
2. Under SAML Setup, turn on Enable SAML Authentication.
3. In the SAML Identity Providers table, select +.
4. Fill in the following fields:

Identity Provider Name: Your desired name for the identity provider (for example, Cloudflare Access)
Issuer: Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust
IdP SSO Service URL: SSO endpoint from application configuration in Cloudflare Zero Trust
5. Identity Provider Name: Your desired name for the identity provider (for example, Cloudflare Access)
6. Issuer: Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust
7. IdP SSO Service URL: SSO endpoint from application configuration in Cloudflare Zero Trust
8. Under x509 Certificate, select the menu icon > Create x509 Public Key.
9. Under Name, enter a unique name (for example, access).
10. Under Certificate, paste the Public key from application configuration in Cloudflare Zero Trust.
11. Select OK.
12. If you want to enable SP-initiated login (login initiated by going to your Workday URL), fill in the following fields:

SP Initiated: Turn on.
Service Provider ID: http://www.workday.com
Sign SP-initiated request: Turn off.
13. SP Initiated: Turn on.
14. Service Provider ID: http://www.workday.com
15. Sign SP-initiated request: Turn off.
16. Under Single Sign-On, add one or both of the following entries to the Redirection URLs grid. For each entry, if your user groups will use the same authentication option to sign in, select Single URL. If they will use different authentication options, select Authentication selector.

IdP-initiated SSO: Under Login Redirect URL, enter <your-team-name>.cloudflareaccess.com.
SP-initiated SSO: Under Login Redirect URL, enter https://<your-environment>/<your-tenant/login-saml2.htmld.
17. IdP-initiated SSO: Under Login Redirect URL, enter <your-team-name>.cloudflareaccess.com.
18. SP-initiated SSO: Under Login Redirect URL, enter https://<your-environment>/<your-tenant/login-saml2.htmld.

## 4. Test the integration

Note

If you encounter a situation where one or more users get locked out of Workday, the user can use this backup URL provided by Workday to sign in with their username and password: https://<your-workday-url>/login.flex?redirect=n.

1. In Workday, create an authentication rule ‚Üó.
2. Under Authentication Conditions, add conditions that will apply only to your test user.
3. Under Allowed Authentication Types, select Specific, then SAML.
4. Select Done.
5. Complete the following step:

If you have enabled SP-initiated login: Open an incognito browser window, go to your Workday URL, and enter your test user's email. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
If you have not enabled SP-initiated login: Go to your App Launcher at https://<cloudflare-team-name>.cloudflareaccess.com. Select the Workday tile. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
6. If you have enabled SP-initiated login: Open an incognito browser window, go to your Workday URL, and enter your test user's email. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
7. If you have not enabled SP-initiated login: Go to your App Launcher at https://<cloudflare-team-name>.cloudflareaccess.com. Select the Workday tile. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.
8. Once login is successful, you can configure your security settings further, such as adding user groups ‚Üó or authentication rules ‚Üó to configure different login rules for different groups of users.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Zendesk

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/zendesk-sso-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/zendesk-sso-saas/)

Page options # Zendesk

Last reviewed: over 1 year ago This guide covers how to configure Zendesk ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to your Zendesk account

## Configure Zendesk and Cloudflare

1. Go to your Zendesk administrator dashboard, typically available at <yourdomain>.zendesk.com/admin/security/sso.
2. In a separate tab or window, open Zero Trust ‚Üó, select your account, and go to Access > Applications.
3. Select Add an application, then choose SaaS.
4. Input the following values in the Zero Trust application configuration:





















Zero Trust fieldValueEntity IDhttps://<yoursubdomain>.zendesk.comAssertion Consumer Service URLcontents of SAML SSO URL in Zendesk accountName ID FormatEmail
5. (Optional) Configure these Attribute Statements to include a user's first and last name:

















Cloudflare attribute nameIdP attribute value<first name>http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname<last name>http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname
Zendesk will use the user's email address as their name ‚Üó if the name is not provided.
6. To determine who can access Zendesk, create an Access policy.
7. Copy the SSO Endpoint and Public Key.
8. Transform the public key into a fingerprint:


Open a fingerprint calculator ‚Üó.


Paste the Public Key into X.509 cert.


Wrap the value with -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.


Set Algorithm to SHA256 and select Calculate Fingerprint.


Copy the Formatted FingerPrint value.
9. Open a fingerprint calculator ‚Üó.
10. Paste the Public Key into X.509 cert.
11. Wrap the value with -----BEGIN CERTIFICATE----- and -----END CERTIFICATE-----.
12. Set Algorithm to SHA256 and select Calculate Fingerprint.
13. Copy the Formatted FingerPrint value.
14. Add the Cloudflare values to the following Zendesk fields:

















Cloudflare IdP fieldZendesk fieldSSO EndpointSAML SSO URLPublic Key (transformed to fingerprint)Certificate Fingerprint
15. Go to https://<yourdomain>.zendesk.com/admin/security/staff_members and enable External Authentication > Single Sign On.

Users should now be able to log in to Zendesk if their Email address exists in the Zendesk user list.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Zoom

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/zoom-saas/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/saas-apps/zoom-saas/)

Page options # Zoom

Last reviewed: about 1 year ago This guide covers how to configure Zoom ‚Üó as a SAML application in Cloudflare Zero Trust.

## Prerequisites

- An identity provider configured in Cloudflare Zero Trust
- Admin access to a Zoom Business, Education, or Enterprise account
- An associated domain ‚Üó configured in your Zoom account
- A vanity URL ‚Üó configured in your Zoom account

## 1. Add a SaaS application to Cloudflare Zero Trust

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > SaaS > Select.
3. For Application, select Zoom.
4. For the authentication protocol, select SAML.
5. Select Add application.
6. Fill in the following fields:

Entity ID:  https://<your-vanity-url>.zoom.us
Assertion Consumer Service URL: https://<your-vanity-url>.zoom.us/saml/SSO
Name ID format: Email
7. Entity ID:  https://<your-vanity-url>.zoom.us
8. Assertion Consumer Service URL: https://<your-vanity-url>.zoom.us/saml/SSO
9. Name ID format: Email
10. Copy the Access Entity ID or Issuer, Public key, and SSO endpoint.
11. Configure Access policies for the application.
12. Save the application.

## 2. Add a SAML SSO provider in Zoom

1. In Zoom, go to Advanced > Single Sign-On.
2. For Vanity URL, select the vanity URL you want to configure SSO for.
3. Fill out the following fields:

Sign in page URL: SSO endpoint from application configuration in Cloudflare Zero Trust
Identity Provider Certificate: Public key from application configuration in Cloudflare Zero Trust
Service Provider (SP) Entity ID: yourvanityurl.zoom.us (no https://)
Issuer (DP Entity ID): Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust
4. Sign in page URL: SSO endpoint from application configuration in Cloudflare Zero Trust
5. Identity Provider Certificate: Public key from application configuration in Cloudflare Zero Trust
6. Service Provider (SP) Entity ID: yourvanityurl.zoom.us (no https://)
7. Issuer (DP Entity ID): Access Entity ID or Issuer from application configuration in Cloudflare Zero Trust
8. For Binding, select http-redirect.
9. For Signature Hash Algorithm, ensure SHA-256 is selected.
10. Under Security, turn off Sign SAML request and Sign SAML logout request.
11. Select Save Changes.
12. Go to Advanced > Security.
13. Under Sign-in Methods, ensure Allow users to sign in with Single Sign-On (SSO) is turned on.

## 3. Test the integration

Open an incognito browser window, go to your Zoom vanity URL, and select Sign in. You will be redirected to the Cloudflare Access login screen and prompted to sign in with your identity provider.

Once this is successful, you can require SSO for users in your associated domain(s) by completing the following steps:

1. In Zoom, go to Advanced > Security.
2. Under Sign-in Methods, turn on Require users to sign in with SSO if their e-mail address belongs to one of the domains below.
3. Under Select Domains, turn on the domains that you want to require SSO for.
4. (Optional) Under Specify users who can bypass SSO sign-in, add your desired users.
5. Select Save.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Publish a self-hosted application to the Internet

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/self-hosted-public-app/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/self-hosted-public-app/)

Page options # Publish a self-hosted application to the Internet

You can securely publish internal tools and applications by adding Cloudflare Access as an authentication layer between the end user and your origin server.

## Prerequisites

- An active domain on Cloudflare
- Domain uses either a full setup or a partial (CNAME) setup

## 1. Add your application to Access

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Select Self-hosted.
4. Enter any name for the application.
5. In Session Duration, choose how often the user's application token should expire.
Cloudflare checks every HTTP request to your application for a valid application token. If the user's application token (and global token) has expired, they will be prompted to reauthenticate with the IdP. For more information, refer to Session management.

1. Select Add public hostname.
2. In the Domain dropdown, select the domain that will represent the application. Domains must belong to an active zone in your Cloudflare account. You can use wildcards to protect multiple parts of an application that share a root path.
Alternatively, to use a Cloudflare for SaaS custom hostname, set Input method to Custom and enter your custom hostname.
3. (Optional) Configure Browser rendering settings:

Automatic cloudflared authentication
Browser rendering for SSH, VNC, or RDP
4. Automatic cloudflared authentication
5. Browser rendering for SSH, VNC, or RDP
6. Add Access policies to control who can connect to your application. All Access applications are deny by default -- a user must match an Allow policy before they are granted access.
7. Configure how users will authenticate:
Select the Identity providers you want to enable for your application.(Recommended) If you plan to only allow access via a single IdP, turn on Instant Auth. End users will not be shown the Cloudflare Access login page. Instead, Cloudflare will redirect users directly to your SSO login event.  (Optional) Under WARP authentication identity, allow users to authenticate to the application using their  WARP session identity.
8. Select the Identity providers you want to enable for your application.
9. (Recommended) If you plan to only allow access via a single IdP, turn on Instant Auth. End users will not be shown the Cloudflare Access login page. Instead, Cloudflare will redirect users directly to your SSO login event.
10. (Optional) Under WARP authentication identity, allow users to authenticate to the application using their  WARP session identity.
11. Select Next.
12. (Optional) Configure App Launcher settings for the application.
13. Under Block page, choose what end users will see when they are denied access to the application:

Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
Redirect URL: Redirect to the specified website.
Custom page template: Display a custom block page hosted in Zero Trust.
14. Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
15. Redirect URL: Redirect to the specified website.
16. Custom page template: Display a custom block page hosted in Zero Trust.
17. Select Next.
18. (Optional) Configure advanced settings:

Cross-Origin Resource Sharing (CORS) settings
Cookie settings
401 Response for Service Auth policies: Return a 401 response code when a user (or machine) makes a request to the application without the correct service token.
19. Cross-Origin Resource Sharing (CORS) settings
20. Cookie settings
21. 401 Response for Service Auth policies: Return a 401 response code when a user (or machine) makes a request to the application without the correct service token.
22. Select Save.

## 2. Connect your origin to Cloudflare

Set up a Cloudflare Tunnel to publish your internal application. Only users who match your Access policies will be granted access.

Note

We recommend creating an Access application before setting up the tunnel route. If you do not have an Access application in place, public hostname routes in Tunnel are available to anyone on the Internet.

If your application is already publicly routable, a Tunnel is not strictly required. However, you will then need to protect your origin IP using other methods.

## 3. Validate the Access token

To secure your origin, you must validate the application token issued by Cloudflare Access. Token validation ensures that any requests which bypass Cloudflare Access (for example, due to a network misconfiguration) are rejected.

One option is to configure the Cloudflare Tunnel daemon, cloudflared, to validate the token on your behalf. This is done by enabling Protect with Access in your Cloudflare Tunnel settings. Alternatively, if you do not wish to perform automatic validation with Cloudflare Tunnel, you can instead manually configure your origin to check all requests for a valid token.

Users can now connect to your self-hosted application after authenticating with Cloudflare Access.

## Product compatibility

When using Access self-hosted applications, the majority of Cloudflare products will be compatible with your application.

However, the following products are not supported:

- Automatic Signed Exchanges
- Automatic Platform Optimization
- Zaraz

You can disable Automatic Signed Exchanges and Zaraz for a specific application - instead of across your entire zone - using a Configuration Rule scoped to the application domain.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## MCP server portals

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/mcp-servers/mcp-portals/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/mcp-servers/mcp-portals/)

Page options # MCP server portals

An MCP server portal centralizes multiple Model Context Protocol (MCP) servers ‚Üó onto a single HTTP endpoint. Key benefits include:

- Streamlined access to multiple MCP servers: MCP server portals support both unauthenticated MCP servers (such as the Cloudflare Documentation MCP server ‚Üó) as well as MCP servers secured using any third-party or custom OAuth provider. Users log in to the portal URL through Cloudflare Access and are prompted to authenticate separately to each server that requires OAuth.
- Customized tools per portal: Admins can tailor an MCP portal to a particular use case by choosing the specific tools and prompt templates that they want to make available to users through the portal. This allows users to access a curated set of tools and prompts ‚Äî the less external context exposed to the AI model, the better the AI responses tend to be.
- Observability: Once the user's AI agent is connected to the portal, Cloudflare Access logs the individual requests made using the tools in the portal.

## Prerequisites

- An active domain on Cloudflare
- Domain uses either a full setup or a partial (CNAME) setup
- An identity provider configured on Cloudflare Zero Trust

## Add an MCP server

Add individual MCP servers to Cloudflare Access to bring them under centralized management.

To add an MCP server:

1. In Zero Trust ‚Üó, go to Access > Applications > AI controls.
2. Select the MCP servers tab.
3. Select Add an MCP server.
4. Enter any name for the server.
5. (Optional) Enter a custom string for the Server ID.
6. In HTTP URL, enter the full URL of your MCP server. For example, if you want to add the Cloudflare Documentation MCP server ‚Üó, enter https://docs.mcp.cloudflare.com/sse.
7. Add Access policies to show or hide the server in an MCP server portal. The MCP server link will only appear in the portal for users who match an Allow policy. Users who do not pass an Allow policy will not see this server through any portals.
WarningBlocked users can still connect to the server (and bypass your Access policies) by using its direct URL. If you want to enforce authentication through Cloudflare Access, configure Access as the server's OAuth provider.
8. Select Save and connect server.
9. If the MCP server supports OAuth, you will be redirected to log in to your OAuth provider. You can log in to any account on the MCP server. The account used to authenticate will serve as the admin credential for that MCP server. You can configure an MCP portal to use this admin credential to make requests.

Cloudflare Access will validate the server connection and fetch a list of tools and prompts. Once the server is successfully connected, the server status will change to Ready. You can now add the MCP server to an MCP server portal.

### Server status

The MCP server status indicates the synchronization status of the MCP server to Cloudflare Access.

| Status | Description |
| --- | --- |
| Error | The server's authentication failed due to expired or incorrect credentials. To fix the issue, reauthenticate the server. |
| Waiting | The server's tools, prompts, and resources are being synchronized. |
| Ready | The server was successfully synchronized and all tools, prompts, and resources are available. |

### Reauthenticate the MCP server

To reauthenticate an MCP server in Cloudflare Access:

1. In Zero Trust ‚Üó, go to Access > Applications > AI controls.
2. Select the MCP servers tab.
3. Select the server that you want to reauthenticate, then select Edit.
4. Select Authenticate server.

You will be redirected to log in to your OAuth provider. The account used to authenticate will serve as the new admin credential for this MCP server.

### Synchronize the MCP server

Cloudflare Access automatically synchronizes with your MCP server every 24 hours. To manually refresh the MCP server in Zero Trust:

1. In Zero Trust ‚Üó, go to Access > Applications > AI controls.
2. Select the MCP servers tab and find the server that you want to refresh.
3. Select the three dots > Sync capabilities.

The MCP server page will show the updated list of tools and prompts. New tools and prompts are automatically enabled in the MCP server portal.

## Create a portal

To create an MCP server portal:

1. In Zero Trust ‚Üó, go to Access > Applications > AI controls.
2. Select Add an MCP server portal.
3. Enter any name for the portal.
4. Under Custom domain, select a domain for the portal URL. Domains must belong to an active zone in your Cloudflare account. You can optionally specify a subdomain.
5. Add MCP servers to the portal.
6. (Optional) Under MCP servers, configure the tools and prompts available through the portal.
7. (Optional) Configure Require user auth for servers that support OAuth:

Enabled: (default) User will be prompted to utilize their own login credentials to establish a connection with the MCP server.
Disabled: Users who are connected to the portal will automatically have access to the MCP server via its admin credential.
8. Enabled: (default) User will be prompted to utilize their own login credentials to establish a connection with the MCP server.
9. Disabled: Users who are connected to the portal will automatically have access to the MCP server via its admin credential.
10. Add Access policies to define the users who can connect to the portal URL.
11. Select Add an MCP server portal.
12. (Optional) Customize the login experience for the portal.

Users can now connect to the portal at https://<subdomain>.<domain>/mcp using an MCP client.

### Customize login settings

Cloudflare Access automatically creates an Access application for each MCP server portal. You can customize the portal login experience by updating Access application settings:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Find the portal that you want to configure, then select the three dots > Edit.
3. To configure identity providers for the portal:

Select the Login methods tab.
Select the identity providers that you want to enable for your application.
(Recommended) If you plan to only allow access via a single identity provider, turn on Instant Auth. End users will not be shown the Cloudflare Access login page. Instead, Cloudflare will redirect users directly to your SSO login event.
4. Select the Login methods tab.
5. Select the identity providers that you want to enable for your application.
6. (Recommended) If you plan to only allow access via a single identity provider, turn on Instant Auth. End users will not be shown the Cloudflare Access login page. Instead, Cloudflare will redirect users directly to your SSO login event.
7. To customize the block page:

Select the Experience settings tab.

Under Block page, choose what end users will see when they are denied access to the application:

Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
Redirect URL: Redirect to the specified website.
Custom page template: Display a custom block page hosted in Zero Trust.
8. Select the Experience settings tab.
9. Under Block page, choose what end users will see when they are denied access to the application:

Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
Redirect URL: Redirect to the specified website.
Custom page template: Display a custom block page hosted in Zero Trust.
10. Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
11. Redirect URL: Redirect to the specified website.
12. Custom page template: Display a custom block page hosted in Zero Trust.
13. Select Save application.

## Connect to a portal

Users can connect to your MCP server running at https://<subdomain>.<domain>/mcp using Workers AI Playground ‚Üó, MCP inspector ‚Üó, or other MCP clients that support remote MCP servers.

To test in Workers AI Playground:

1. Go to Workers AI Playground ‚Üó.
2. Under MCP Servers, enter https://<subdomain>.<domain>/mcp for the portal URL.
3. Select Connect.
4. In the popup window, log in to your Cloudflare Access identity provider.
5. The popup window will list the MCP servers in the portal that require authentication. For each of these MCP servers, select Connect and follow the login prompts.
6. Select Done to complete the portal authentication process.

Workers AI Playground will show a Connected status and list the available tools. You can now ask the AI model to complete a task using an available tool. Requests made to an MCP server will appear in your portal logs.

## View portal logs

Portal logs allow you to monitor user activity through an MCP server portal. You can view logs on a per-portal or per-server basis.

1. In Zero Trust ‚Üó, go to Access > Applications > AI controls.
2. Find the portal or server that you want to view logs for, then select the three dots > Edit.
3. Select Logs.

### Log fields

| Field | Description |
| --- | --- |
| Time | Date and time of the request |
| Status | Whether the server successfully returned a response |
| Server | Name of the MCP server that handled the request |
| Capability | The tool used to process the request |
| Duration | Processing time for the request in milliseconds |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Secure MCP servers with Access for SaaS

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/mcp-servers/saas-mcp/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/mcp-servers/saas-mcp/)

Page options # Secure MCP servers with Access for SaaS

You can secure Model Context Protocol (MCP) servers ‚Üó by using Cloudflare Access as an OAuth Single Sign-On (SSO) provider.

This guide walks through how to deploy a remote MCP server on Cloudflare Workers that requires Cloudflare Access for authentication. When users connect to the MCP server using an MCP client, they will be prompted to log in to your identity provider and are only granted access if they pass your Access policies.

## Prerequisites

- Add an identity provider to Cloudflare Zero Trust
- Install npm ‚Üó
- Install Node.js ‚Üó

## 1. Deploy an example MCP server

To deploy our example MCP server ‚Üó on Workers:

1. Open a terminal and clone our example project:
Terminal windownpm create cloudflare@latest -- mcp-server-cf-access --template=cloudflare/ai/demos/remote-mcp-cf-access
When asked if you want to deploy to Cloudflare, select No.
2. Go to the project directory:
Terminal windowcd mcp-server-cf-access
3. Create a Workers KV namespace to store the key. The binding name should be OAUTH_KV if you want to run the example as written.
Terminal windownpx wrangler kv namespace create "OAUTH_KV"
The command will output the binding name and KV namespace ID:
{  "kv_namespaces": [    {      "binding": "OAUTH_KV",      "id": "<YOUR_KV_NAMESPACE_ID>"    }  ]}
4. Open wrangler.jsonc in an editor and insert your OAUTH_KV namespace ID:
"kv_namespaces": [  {    "binding": "OAUTH_KV",    "id": "<YOUR_KV_NAMESPACE_ID>"  }],
5. You can now deploy the Worker to Cloudflare's global network:
Terminal windownpx wrangler deploy

The Worker will be deployed to your *.workers.dev subdomain at mcp-server-cf-access.<YOUR_SUBDOMAIN>.workers.dev.

## 2. Create an Access for SaaS app

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select SaaS.
3. In Application, enter a custom name (for example, MCP server) and select the textbox that appears below.
4. Select OIDC as the authentication protocol.
5. Select Add application.
6. In Redirect URLs, enter the authorization callback URL for your MCP server. The callback URL for our example MCP server is
https://mcp-server-cf-access.<YOUR_SUBDOMAIN>.workers.dev/callback
7. Copy the following values to input into our example MCP server. Other MCP servers may require different sets of input values.

Client secret
Client ID
Token endpoint
Authorization endpoint
Key endpoint
8. Client secret
9. Client ID
10. Token endpoint
11. Authorization endpoint
12. Key endpoint
13. (Optional) Under Advanced settings, turn on Refresh tokens if you want to reduce the number of times a user needs to log in to the identity provider.
14. Configure Access policies to define the users who can access the MCP server.
15. Save the application.

1. Make a POST request to the Access applications endpoint:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Access: Apps and Policies Write Add an Access applicationcurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/apps" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "MCP server",    "type": "saas",    "saas_app": {        "auth_type": "oidc",        "redirect_uris": [            "https://mcp-server-cf-access.<YOUR_SUBDOMAIN>.workers.dev/callback"        ],        "grant_type": [            "authorization_code",            "refresh_tokens"        ],        "refresh_token_options": {            "lifetime": "90d"        }    },    "policies": [        "f174e90a-fafe-4643-bbbc-4a0ed4fc8415"    ],    "allowed_idps": []  }'
2. Access: Apps and Policies Write
3. Copy the client_id and client_secret returned in the response.
4. To determine the OAuth endpoint URLs for the SaaS application, refer to the generic OIDC documentation.

## 3. Configure your MCP server

Your MCP server needs to perform an OAuth 2.0 authorization flow to get an access_token from the SaaS app created in Step 1. When setting up the OAuth client on your MCP server, you will need to paste in the OAuth endpoints and credentials from the SaaS app.

To add OAuth endpoints and credentials to our example MCP server:

1. Create the following Workers secrets:
Terminal windowwrangler secret put ACCESS_CLIENT_IDwrangler secret put ACCESS_CLIENT_SECRETwrangler secret put ACCESS_TOKEN_URLwrangler secret put ACCESS_AUTHORIZATION_URLwrangler secret put ACCESS_JWKS_URL
2. When prompted to enter a secret value, paste the corresponding values from your SaaS app:





























Workers secretSaaS app fieldACCESS_CLIENT_IDClient IDACCESS_CLIENT_SECRETClient secretACCESS_TOKEN_URLToken endpointACCESS_AUTHORIZATION_URLAuthorization endpointACCESS_JWKS_URLKey endpoint
3. Configure a cookie encryption key:
a. Generate a random string:
Terminal windowopenssl rand -hex 32
b. Store the string in a Workers secret:
Terminal windowwrangler secret put COOKIE_ENCRYPTION_KEY

## 4. Test the connection

You should now be able to connect to your MCP server running at https://mcp-server-cf-access.<YOUR_SUBDOMAIN>.workers.dev/sse using Workers AI Playground ‚Üó, MCP inspector ‚Üó, or other MCP clients that support remote MCP servers.

To test in Workers AI Playground:

1. Go to Workers AI Playground ‚Üó.
2. Under MCP Servers, enter https://mcp-server-cf-access.<YOUR_SUBDOMAIN>.workers.dev/sse  for the MCP server URL.
3. Select Connect.
4. A popup window will appear requesting access to the MCP server. Select Approve.
5. Follow the prompts to log in to your identity provider.

Workers AI Playground will show a Connected status. The MCP server should successfully obtain an access_token from Cloudflare Access.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Authenticate MCP server to self-hosted apps

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/mcp-servers/linked-apps/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/mcp-servers/linked-apps/)

Page options # Authenticate MCP server to self-hosted apps

Cloudflare Access can delegate access from any self-hosted application to an Access for SaaS MCP server via OAuth ‚Üó. The OAuth access token authorizes the MCP server to make requests to your self-hosted applications on behalf of the user, using the user's specific permissions and scopes.

For example, your organization may wish to deploy an MCP server that helps employees interact with internal applications. You can configure Access policies to ensure that only authorized users can access those applications, either directly or by using an MCP client.

```
flowchart LR
accTitle: Link MCP servers and self-hosted applications in Access
    subgraph SaaS["Access for SaaS <br> OIDC app"]
        mcp["MCP server <br> for internal apps"]
    end

    subgraph "Access self-hosted app"
        app1[Admin dashboard]
    end

    subgraph "Access self-hosted app"
        app2[Company wiki]
    end

		User --> client["MCP client"]
    client --> mcp
    mcp -- Access token --> app1
		mcp -- Access token --> app2
		idp[Identity provider] <--> SaaS
```

This guide covers how to use the Cloudflare API to link a self-hosted application to a remote MCP server. The core of this feature is the linked_app_token rule type, which allows an Access policy on one application to accept OAuth access tokens generated for another.

## Prerequisites

- A self-hosted Access application

## 1. Secure the MCP server with Access for SaaS

The first step is to add the MCP server to Cloudflare Access as an OIDC-based SaaS application. For step-by-step instructions on how to add an MCP server, refer to Secure MCP servers with Access for SaaS.

## 2. Get the SaaS application ID

Get the id of the MCP server SaaS application:

Required API token permissions

At least one of the following token permissions is required: - Access: Apps and Policies Revoke
- Access: Apps and Policies Write
- Access: Apps and Policies Read

List Access applications ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/apps" \  --request GET \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
```

Response ```
{  "id": "3537a672-e4d8-4d89-aab9-26cb622918a1",  "uid": "3537a672-e4d8-4d89-aab9-26cb622918a1",  "type": "saas",  "name": "mcp-server-cf-access",  ...}
```

## 3. Create an Access policy

1. Create the following Access policy, replacing the app_uid value with the id of your SaaS application:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Access: Apps and Policies Write Create an Access reusable policycurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/policies" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Allow MCP server",    "decision": "non_identity",    "include": [        {            "linked_app_token": {                "app_uid": "3537a672-e4d8-4d89-aab9-26cb622918a1"            }        }    ]  }'
NoteThe linked_app_token rule type only works with non_identity decisions, similar to service token rules.
2. Access: Apps and Policies Write
3. Copy the Access policy id returned in the response:
Response{    "created_at": "2025-08-06T20:06:23Z",    "decision": "non_identity",    "exclude": [],    "id": "a38ab4d4-336d-4f49-9e97-eff8550c13fa",    "include": [      {        "linked_app_token": {          "app_uid": "6cdc3892-f9f1-4813-a5ce-38c2753e1208"        }      }    ],    "name": "Allow MCP server",    ...}

This policy will allow requests if they present a valid OAuth access token that was issued for the specified SaaS application.

## 4. Update the self-hosted application

You can add the linked_app_token policy to any self_hosted application in your Zero Trust account. Other app types (such as saas) are not currently supported.

1. Get your existing self-hosted application configuration:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Access: Apps and Policies WriteAccess: Apps and Policies Read Get an Access applicationcurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/apps/$APP_ID" \  --request GET \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
2. Access: Apps and Policies Write
3. Access: Apps and Policies Read
4. Add the Access policy to the self-hosted application. To avoid overwriting your existing configuration, the PUT request body should contain all fields returned by the previous GET request.
 Required API token permissions
 
At least one of the following token permissions 
is required:
Access: Apps and Policies Write Update an Access applicationcurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/apps/$APP_ID" \  --request PUT \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "policies": [        "a38ab4d4-336d-4f49-9e97-eff8550c13fa"    ]  }'
5. Access: Apps and Policies Write

## 5. Configure the MCP server

With the policy in place, every API request to the self-hosted application must now include a valid access_token from Cloudflare Access. You will need to configure the MCP server to forward the access_token in an HTTP request header:

```
Authorization: Bearer ACCESS_TOKEN
```

The end-to-end authorization flow is as follows:

1. The MCP server authenticates against the Access for SaaS app via OAuth.
2. Upon success, the MCP server receives an access_token.
3. The MCP server makes an API request to the self-hosted application with the token in the request headers.
4. Cloudflare Access intercepts the request to the self-hosted app, inspects the token, and validates it against the linked_app_token rule in the policy.
5. If the token is valid and was issued for the linked SaaS app, the request is allowed. Otherwise, it is blocked.

## Known limitations

The MCP OAuth feature only works with self-hosted applications that rely on the Cloudflare Access JWT to authenticate and identify the user. If the application implements its own layer of authentication after Cloudflare Access, then this feature is at best a partial solution. Requests that are successfully authenticated by Access may still be blocked by the application itself, resulting in an HTTP 401 or 403 error.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Cloudflare dashboard SSO application

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/dash-sso-apps/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/dash-sso-apps/)

Page options # Cloudflare dashboard SSO application

By adding a Cloudflare Dashboard SSO application to your Cloudflare Zero Trust account, you can enforce single sign-on (SSO) to the Cloudflare dashboard with the identity provider (IdP) of your choice. SSO will be enforced for every user in your email domain.

## Availability

|  | Free | Pro | Business | Enterprise |
| --- | --- | --- | --- | --- |
| Availability | No | No | No | Yes (with Standard or Premium Success plans) |

## Prerequisites

All users in your email domain must exist as a member in your Cloudflare account and IdP. To add users to your Cloudflare account, refer to Manage Cloudflare account access.

## 1. Set up an IdP

Add an IdP to Cloudflare Zero Trust by following our detailed instructions.

Once you configure your IdP, make sure you also test your IdP.

## 2. Contact your account team

Ask your account team to approve and create your SSO domain. An SSO domain is the email domain associated with the members in your Cloudflare account. For example, if your SSO domain is configured for emails ending in @yourcompany.com, a member with email @test.com would not see the Log in with SSO option and would have to enter their username and password.

Once your SSO domain is approved, a new SSO App application will appear under Access > Applications. The application is pre-configured with allow email domain as the default rule and your IdP as the authentication providers.

### SSO domain requirements

- The email domain must belong to your organization. Public email providers such as @gmail.com are not allowed.
- Every user with that email domain must be an employee in your organization. For example, university domains such as @harvard.edu are not allowed because they include student emails.
- Your SSO domain can include multiple email domains.

Warning

Enabling Cloudflare Dashboard SSO for an email domain (for example, @mycompany.com) will apply globally across all Cloudflare accounts where users log in with that domain. All users will be required to authenticate via the specified identity provider (IdP), including users on pre-existing Cloudflare accounts.

## 3. Enable dashboard SSO

Note

Cloudflare recommends carefully storing your Global API key to access when necessary. You will need your Global API key when you disable SSO.

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. In the Cloudflare dashboard SSO card, set your email domain to Enabled. This action can only be performed by Super Administrators.
3. Do not log out or close your browser window. Instead, open a different browser or an incognito window.
4. In the Cloudflare dashboard ‚Üó, log in with your email address from your SSO domain.
5. If you can log in successfully, you have successfully set up your dashboard SSO application.
6. If you cannot log in successfully:

Return to Zero Trust and go to Settings > Authentication.
For Cloudflare dashboard SSO, set your email domain to Disabled.
Re-configure your IdP.
7. Return to Zero Trust and go to Settings > Authentication.
8. For Cloudflare dashboard SSO, set your email domain to Disabled.
9. Re-configure your IdP.

## Limitations

Cloudflare dashboard SSO does not support:

- Users with plus-addressed emails, such as example+2@domain.com. If you have users like this added to your Cloudflare organization, they will be unable to login with SSO.
- Adding a separate email-based policy to the SSO application that does not match your SSO domain policy. As your account team must approve and create your SSO domain based on the SSO domain requirements, adding a new domain policy on your own will not work.
- Deleting the auto-generated allow email domain policy. If this policy was deleted, your organization's administrators would not be able to access the Cloudflare dashboard.

## IdP-initiated SSO

IdP-initiated login is supported for Cloudflare dashboard SSO, with configuration available via your identity provider (IdP).

A step-by-step guide is currently available for Okta, and similar configurations are possible with other identity providers that support custom SSO endpoints.

### Okta

Configure an identity provider (IdP)-initiated single sign-on (SSO) session using Cloudflare Zero Trust and Okta.

#### Prerequisites

1. In Zero Trust ‚Üó, go to Access > Applications > select your SSO App.
2. Select Configure to access the application settings.
3. In the Basic Information section, copy the SSO Endpoint URL and Access Entity ID or Issuer. You will need these values for your IdP setup.

#### Configure Okta as the IdP

1. Log in to your Okta Admin Dashboard ‚Üó and go to Applications > Applications.
2. Select Create App Integration to start a new SAML integration to handle the IdP-initated SSO flow.
3. In the pop-up, select SAML 2.0 and select Next.
4. Enter a name for the app and select Next.
5. In the Single Sign-On URL field, paste the SSO Endpoint URL you copied earlier.
6. In the Audience URI (SP Entity ID) field, paste the Access Entity ID or Issuer you copied earlier.
7. Set the Name ID Format to EmailAddress.
8. Set the Application Username to Email.
9. Select Next > Finish to save the integration.
10. Test the integration by going to your Okta User Dashboard, locating the new app tile, and selecting it to verify the SSO flow.

(Optional) Enforce single IdP login with Instant Auth

If you use only one IdP (for example, Okta) for Cloudflare SSO and want users to skip the identity provider selection prompt:

1. In Zero Trust ‚Üó, go to Access > Applications > select your SSO App.
2. Go to Login methods.
3. Disable Accept all available identity providers and ensure only Okta is selected as the login method.
4. Enable Instant Auth to allow users to skip identity provider selection.

## Bypass dashboard SSO

This section describes how to restore access to the Cloudflare dashboard in case you are unable to login with SSO.

### Option 1: Add a backup IdP

If there is an issue with your SSO IdP provider, you can add an alternate IdP using the API. The following example shows how to add Cloudflare One-time PIN as a login method:

1. Add one-time PIN login:

Required API token permissions

At least one of the following token permissions is required: - Access: Organizations, Identity Providers, and Groups Write

Add an Access identity provider ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/identity_providers" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "type": "onetimepin",    "config": {}  }'
```

1. Get the id of the dash_sso Access application. You can use jq ‚Üó to quickly find the correct application:

cURL command ```
curl 'https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/apps' \--header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \| jq '.result[] | select(.type == "dash_sso")'
```

Response ```
{  "id": "3537a672-e4d8-4d89-aab9-26cb622918a1",  "uid": "3537a672-e4d8-4d89-aab9-26cb622918a1",  "type": "dash_sso",  "name": "SSO App"  ...}
```

1. Using the id obtained above, update SSO App to accept all identity providers. To avoid overwriting your existing configuration, the PUT request body should contain all fields returned by the previous GET request.

Required API token permissions

At least one of the following token permissions is required: - Access: Apps and Policies Write

Update an Access application ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/apps/3537a672-e4d8-4d89-aab9-26cb622918a1" \  --request PUT \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "id": "3537a672-e4d8-4d89-aab9-26cb622918a1",    "uid": "3537a672-e4d8-4d89-aab9-26cb622918a1",    "type": "dash_sso",    "name": "SSO App",    "allowed_idps": []  }'
```

Users will now have the option to log in using a one-time PIN.

### Option 2: Disable dashboard SSO

The following API calls will disable SSO enforcement for an account. This action can only be performed by Super Administrators.

1. Get your SSO connector_id:

cURL command ```
curl https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/sso/v2/connectors \--header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
```

Response ```
{  "result": [    {      "connector_id": "2828",      "connector_tag": "d616ac82cc7f87153112d75a711c5c3c",      "email_domain": "yourdomain.com",      "connector_status": "V",      ...    }  ],  "success": true,  "errors": [],  "messages": []}
```

1. Disable the SSO connector:

cURL command ```
curl --request PATCH \'https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/sso/v2/connectors/2828' \--header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \--header "Content-Type: application/json" \--data '{  "sso_connector_status": "DIS"}'
```

Response ```
{  "result": {    "id": "2828"  },  "success": true,  "errors": [],  "messages": []}
```

Users can now log in using their Cloudflare account email and password. To re-enable SSO, send a PATCH request with "sso_connector_status" : "V".

## Change your team name

Cloudflare does not allow you to change your team name while dashboard SSO is enabled. To change your team name, you must first disable dashboard SSO.

Warning

Before disabling SSO, make sure you have access to your Cloudflare account email. This will allow you to reset your password in case you get logged out of the Cloudflare dashboard.

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. If SSO is enabled, turn off Cloudflare dashboard SSO. This action can only be performed by Super Administrators.
3. Go to Settings > Custom Pages.
4. Under Team domain, select Edit to enter the new team name. Select Save.
5. In your identity provider, update your Cloudflare integration with the new team name. For example, if you are using a SAML IdP, you will need to update the Single Sign-on URL and Entity ID to https://<new-team-name>.cloudflareaccess.com/cdn-cgi/access/callback.
6. In Zero Trust, go to Settings > Authentication.
7. Turn on Cloudflare dashboard SSO to re-enable SSO.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Non-HTTP applications

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/non-http/](https://developers.cloudflare.com/cloudflare-one/applications/non-http/)

Page options # Non-HTTP applications

Cloudflare offers both client-based and clientless ways to grant secure access to non-HTTP applications.

Note

Non-HTTP applications require connecting your private network to Cloudflare. For more details, refer to our Replace your VPN implementation guide.

## WARP client

Users can connect by installing the Cloudflare WARP client on their device and enrolling in your Zero Trust organization. Remote devices connect to your applications as if they were on your private network. By default, all devices enrolled in your organization can access any private route unless they are protected by an Access policy or Gateway firewall rule. To secure the application, you can create a self-hosted application for a private IP range, port range, and/or hostname and build Access policies that allow or block specific users.

If you would like to define how users access specific infrastructure servers within your network, create an infrastructure application in Access for Infrastructure. Access for Infrastructure provides an additional layer of control and visibility over how users access non-HTTP applications, including:

- Define fine-grained policies to govern who has access to specific servers and exactly how a user may access that server.
- Eliminate SSH keys by using short-lived certificates to authenticate users.
- Export SSH command logs to a storage service or SIEM solution using Logpush.

## Clientless access

Clientless access methods are suited for organizations that cannot deploy the WARP client or need to support third-party contractors where installing a client is not possible. Clientless access requires onboarding a domain to Cloudflare and configuring a public hostname in order to make the server reachable. Command logging is not supported.

### Browser-rendered terminal

Cloudflare's browser-based terminal allows users to connect over SSH, RDP, and VNC without any configuration. When users visit the public hostname URL (for example, https://ssh.example.com) and log in with their Access credentials, Cloudflare will render a terminal in their browser. For RDP connections, users must authenticate to the Windows server using their Windows username and password in addition to being authenticated by Cloudflare Access.

### Client-side cloudflared (legacy)

Note

Not recommended for new deployments.

Users can log in to the application by installing cloudflared on their device and running a hostname-specific command in their terminal. For more information, refer to cloudflared authentication.

## Related resources

To connect to an application over a specific protocol, refer to these tutorials:

- SSH
- SMB
- RDP

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Add an infrastructure application

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/non-http/infrastructure-apps/](https://developers.cloudflare.com/cloudflare-one/applications/non-http/infrastructure-apps/)

Page options # Add an infrastructure application

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP Secure Web Gateway without DNS filtering | All plans |

| System | Availability |
| --- | --- |
| Windows | ‚úÖ |
| macOS | ‚úÖ |
| Linux | ‚úÖ |
| iOS | ‚úÖ |
| Android | ‚úÖ |
| ChromeOS | ‚úÖ |

Access for Infrastructure allows you to have granular control over how users access individual servers, clusters, or databases. By adding an infrastructure application to Cloudflare Access, you can configure how users authenticate to the resource as well as control and authorize the ports, protocols, and usernames that they can connect with. Access and command logs ensure regulatory compliance and allow for auditing of user activity in case of a security breach.

Note

Access for Infrastructure currently only supports SSH. To connect using other protocols, add a self-hosted private application. For browser-based SSH, RDP, or VNC, refer to browser-rendered terminal.

## Prerequisites

- Connect your infrastructure to Cloudflare using cloudflared or WARP Connector.
- Deploy the WARP client on user devices in Gateway with WARP mode.

## 1. Add a target

A target represents a single resource in your infrastructure (such as a server, Kubernetes cluster, database, or container) that users will connect to through Cloudflare.

Targets are protocol-agnostic, meaning that you do not need to define a new target for each protocol that runs on the server. To create a new target:

- Dashboard
- API
- Terraform

1. In Zero Trust ‚Üó, go to Networks > Targets.
2. Select Add a target.
3. In Target hostname, enter a user-friendly name for the target. We recommend using the server hostname, for example production-server. The target hostname does not need to be unique and can be reused for multiple targets. Hostnames are used to define the targets secured by an Access application; they are not used for DNS address resolution.
 Format restrictions
 
Case insensitive
Contain no more than 253 characters
Contain only alphanumeric characters, -, or . (no spaces allowed)
Start and end with an alphanumeric character
4. Case insensitive
5. Contain no more than 253 characters
6. Contain only alphanumeric characters, -, or . (no spaces allowed)
7. Start and end with an alphanumeric character
8. In IP addresses, enter the IPv4 and/or IPv6 address of the target resource. The dropdown menu will not populate until you type in the full IP address.

Note

If the target IP does not appear in the dropdown, go to Networks > Routes and confirm that the IP routes through Cloudflare Tunnel.

1. In the dropdown menu, select the IP address and virtual network where the resource is located. This IP address and virtual network pairing is now assigned to this target and cannot be reused in another target by design.
2. Select Add target.

Make a POST request to the Infrastructure Access Targets endpoint:

Create new target ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/infrastructure/targets" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "hostname": "infra-access-target",    "ip": {        "ipv4": {            "ip_addr": "187.26.29.249",            "virtual_network_id": "c77b744e-acc8-428f-9257-6878c046ed55"        },        "ipv6": {            "ip_addr": "64c0:64e8:f0b4:8dbf:7104:72b0:ec8f:f5e0",            "virtual_network_id": "c77b744e-acc8-428f-9257-6878c046ed55"        }    }  }'
```

Provider versions

The following example requires Cloudflare provider version >=4.45.0.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Configure the cloudflare_zero_trust_infrastructure_access_target ‚Üó resource:
resource "cloudflare_zero_trust_infrastructure_access_target" "infra-ssh-target" {  account_id = var.cloudflare_account_id    hostname   = "infra-access-target"    ip = {      ipv4 = {        ip_addr = "187.26.29.249"        virtual_network_id = "c77b744e-acc8-428f-9257-6878c046ed55"      }      ipv6 = {        ip_addr = "64c0:64e8:f0b4:8dbf:7104:72b0:ec8f:f5e0"        virtual_network_id = "c77b744e-acc8-428f-9257-6878c046ed55"      }    }}

Next, create an Access application to secure the target.

## 2. Add an infrastructure application

- Dashboard
- API
- Terraform (v4)

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Select Infrastructure.
4. Enter any name for the application.
5. In Target criteria, select the target hostname(s) that you want to secure. This application definition will apply to all targets that share the selected hostname, including any targets added in the future. Similarly, if you later decide to change the hostname for a target, the renamed target will no longer be covered by this application.
6. Enter the Protocol and Port that will be used to connect to the server.
7. (Optional) If a protocol runs on more than one port, select Add new target criteria and reconfigure the same target hostname and protocol with a different port number.
NoteAccess for Infrastructure only supports assigning one protocol per port. You can reuse a port/protocol pairing across infrastructure applications, but the port cannot be reassigned to another protocol.
8. Select Next.
9. To secure your targets, configure a policy that defines who can connect and how they can connect:


Enter any name for your policy.


Create a rule that matches the users who are allowed to reach the targets. For more information, refer to Access policies and review the list of infrastructure policy selectors.


In Connection context, configure the following settings:

SSH user: Enter the UNIX usernames that users can log in as (for example, root or ec2-user).
Allow users to log in as their email alias: (Optional) When selected, users who match your policy definition will be able to access the target using their lowercased email address prefix. For example, Jdoe@company.com could log in as jdoe.

NoteCloudflare will not create new users on the target. UNIX users must already be present on the server.
10. Enter any name for your policy.
11. Create a rule that matches the users who are allowed to reach the targets. For more information, refer to Access policies and review the list of infrastructure policy selectors.
12. In Connection context, configure the following settings:

SSH user: Enter the UNIX usernames that users can log in as (for example, root or ec2-user).
Allow users to log in as their email alias: (Optional) When selected, users who match your policy definition will be able to access the target using their lowercased email address prefix. For example, Jdoe@company.com could log in as jdoe.

NoteCloudflare will not create new users on the target. UNIX users must already be present on the server.
13. SSH user: Enter the UNIX usernames that users can log in as (for example, root or ec2-user).
14. Allow users to log in as their email alias: (Optional) When selected, users who match your policy definition will be able to access the target using their lowercased email address prefix. For example, Jdoe@company.com could log in as jdoe.
15. Select Add application.

Make a POST request to the Access applications endpoint:

Required API token permissions

At least one of the following token permissions is required: - Access: Apps and Policies Write

Add an Access application ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/apps" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Example infrastructure app",    "type": "infrastructure",    "target_criteria": [        {            "target_attributes": {                "hostname": [                    "infra-access-target"                ]            },            "port": 22,            "protocol": "SSH"        }    ],    "policies": [        {            "name": "Allow a specific email",            "decision": "allow",            "include": [                {                    "email": {                        "email": "jdoe@company.com"                    }                }            ],            "connection_rules": {                "ssh": {                    "usernames": [                        "root",                        "ec2-user"                    ]                }            }        }    ]  }'
```

Provider versions

The following example requires Cloudflare provider version >=4.45.0.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Access: Apps and Policies Write
2. Access: Apps and Policies Write
3. Use the cloudflare_zero_trust_access_application ‚Üó resource to create an infrastructure application:
resource "cloudflare_zero_trust_access_application" "infra-app" {  account_id = var.cloudflare_account_id  name       = "Example infrastructure app"  type       = "infrastructure"
  target_criteria {    port     = 22    protocol = "SSH"    target_attributes {      name = "hostname"      values = ["infra-access-target"]    }  }}
4. Use the cloudflare_zero_trust_access_policy ‚Üó resource to add an infrastructure policy to the application:
resource "cloudflare_zero_trust_access_policy" "infra-app-policy" {  application_id = cloudflare_zero_trust_access_application.infra-app.id  account_id = var.cloudflare_account_id  name       = "Allow a specific email"  decision   = "allow"  precedence = 1
  include {    email = ["jdoe@company.com"]  }
  connection_rules {    ssh {      usernames = ["root", "ec2-user"]    }  }}

The targets in this application are now secured by your infrastructure policies.

## 3. (Recommended) Modify order of precedence in Gateway

By default, Cloudflare will evaluate Access application policies after evaluating all Gateway network policies. To evaluate Access applications before or after specific Gateway policies:

1. Create the following Gateway network policy:
















SelectorOperatorValueActionAccess Infrastructure TargetisPresentAllow
2. Update the policy's order of precedence using the dashboard or API.

This Gateway policy will apply to all Access for Infrastructure targets, including RDP and SSH.

Note

Users must pass the policies in your Access application before they are granted access. The Gateway Allow policy is strictly for routing and connectivity purposes.

## 4. Configure the server

Certain protocols require configuring the server to trust connections through Access for Infrastructure. For more information, refer to the protocol-specific tutorial:

- SSH

## 5. Connect as a user

Users connect to the target's IP address using their preferred client software. The user must be logged into WARP on their device, but no other system configuration is required. You can optionally configure a private DNS resolver to allow connections to the target's private hostname.

### Connect to different VNET

To connect to targets that are in different VNETS, users will need to switch their connected virtual network in the WARP client.

Note

If a user is connected to a target in VNET-A and needs to connect to a target in VNET-B, switching their VNET will not break any existing connections to targets within VNET-A. At present, connections are maintained between VNETs.

### Display available targets

Feature availability

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.9.346.0 |
| macOS | ‚úÖ | 2024.9.346.0 |
| Linux | ‚úÖ | 2024.9.346.0 |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

Users can use warp-cli to display a list of targets they can access. On the WARP device, open a terminal and run the following command:

Terminal window ```
warp-cli target list
```

```
‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ‚îÇ Target ID                            ‚îÇ Protocol ‚îÇ Port  ‚îÇ Attributes            ‚îÇ IP (Virtual Network) ‚îÇ Usernames  ‚îÇ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ 0193f22a-9df3-78e3-b5bb-7ab631903306 ‚îÇ SSH      ‚îÇ 22    ‚îÇ hostname: do-target   ‚îÇ 10.116.0.3 (a1net)   ‚îÇ alice      ‚îÇ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ 0193f22a-9df3-78e3-b5bb-7ab631903306 ‚îÇ SSH      ‚îÇ 23    ‚îÇ hostname: do-target   ‚îÇ 10.116.0.3 (a1net)   ‚îÇ root       ‚îÇ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ 01943cff-6130-7989-8bff-cbc02b59a2b1 ‚îÇ SSH      ‚îÇ 80    ‚îÇ hostname: az-target   ‚îÇ 172.16.0.0 (b1net)   ‚îÇ alice, bob ‚îÇ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
```

You can optionally add flags to filter the output. For example:

Terminal window ```
warp-cli target list --attribute hostname=do-target --username root
```

To view all available filters, type warp-cli target list --help.

## Revoke a user's session

To revoke a user's access to all infrastructure targets, you can either revoke the user from Zero Trust or revoke their device. Cloudflare does not currently support revoking a user's session for a specific target.

## Infrastructure policy selectors

The following Access policy selectors are available for securing infrastructure applications:

- Email
- Emails ending in
- SAML group
- Country
- Authentication method
- Device posture
- Entra group, GitHub organization, Google Workspace group, Okta group

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Secure a private IP or hostname

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/non-http/self-hosted-private-app/](https://developers.cloudflare.com/cloudflare-one/applications/non-http/self-hosted-private-app/)

Page options # Secure a private IP or hostname

You can configure a self-hosted Access application to manage access to specific IPs or hostnames on your private network.

Note

This feature replaces the legacy private network app type.

## Prerequisites

- Private IPs and hostnames are reachable over Cloudflare WARP, Magic WAN or Browser Isolation. For more details, refer to Connect a private network.
- Private hostnames route to your custom DNS resolver through Local Domain Fallback or Gateway resolver policies.
- (Optional) Turn on Gateway TLS decryption if you want to use Access JWTs to manage HTTPS application sessions.

## Add your application to Access

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Select Self-hosted.
4. Enter any name for the application.
5. In Session Duration, choose how often the user's application token should expire.
Cloudflare checks every HTTP request to your application for a valid application token. If the user's application token (and global token) has expired, they will be prompted to reauthenticate with the IdP. For more information, refer to Session management.
    If the application is non-HTTPS or you do not have TLS decryption turned on, the session is tracked by the WARP client per application.

1. Add the private IP and/or private hostname that represents the application. You can use wildcards with private hostnames to protect multiple parts of an application that share a root path.
NotePrivate hostnames are currently only available over port 443 over HTTPS and the application must have a valid Server Name Indicator (SNI). If you are configuring a private IP on any port other than 443 and plan to use Browser Isolation, note that this will result in a Gateway block page.
2. Add Access policies to control who can connect to your application. All Access applications are deny by default -- a user must match an Allow policy before they are granted access.
3. Configure how users will authenticate:

Select the Identity providers you want to enable for your application.
(Recommended) If you plan to only allow access via a single IdP, turn on Instant Auth. End users will not be shown the Cloudflare Access login page. Instead, Cloudflare will redirect users directly to your SSO login event.
(Recommended) Turn on WARP authentication identity to allow users to authenticate to the application using their WARP session identity. We recommend turning this on if your application is not in the browser and cannot handle a 302 redirect.
4. Select the Identity providers you want to enable for your application.
5. (Recommended) If you plan to only allow access via a single IdP, turn on Instant Auth. End users will not be shown the Cloudflare Access login page. Instead, Cloudflare will redirect users directly to your SSO login event.
6. (Recommended) Turn on WARP authentication identity to allow users to authenticate to the application using their WARP session identity. We recommend turning this on if your application is not in the browser and cannot handle a 302 redirect.
7. Select Next.
8. (Optional) Configure App Launcher settings for the application.
9. Under Block page, choose what end users will see when they are denied access to the application:

Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
Redirect URL: Redirect to the specified website.
Custom page template: Display a custom block page hosted in Zero Trust.
10. Cloudflare default: Reload the login page and display a block message below the Cloudflare Access logo. The default message is That account does not have access, or you can enter a custom message.
11. Redirect URL: Redirect to the specified website.
12. Custom page template: Display a custom block page hosted in Zero Trust.
13. Select Next.
14. (Optional) Configure advanced settings:

Cross-Origin Resource Sharing (CORS) settings
Cookie settings
401 Response for Service Auth policies: Return a 401 response code when a user (or machine) makes a request to the application without the correct service token.

These settings only apply to private hostnames and require Gateway TLS decryption.
15. Cross-Origin Resource Sharing (CORS) settings
16. Cookie settings
17. 401 Response for Service Auth policies: Return a 401 response code when a user (or machine) makes a request to the application without the correct service token.
18. Select Save.

Users can now connect to your private application after authenticating with Cloudflare Access.

## Authentication flow

### HTTPS applications

If Gateway TLS decryption is turned on and a user is accessing an HTTPS application on port 443, Cloudflare Access will present a login page in the browser and issue an application token to your origin. This is the same cookie-based authentication flow used by self-hosted public apps.

If Gateway TLS decryption is turned off, session management is handled in the WARP client instead of in the browser.

### Non-HTTPS applications

The WARP client manages sessions for all non-HTTPS applications. Users will receive an Authentication required pop-up notification from the WARP client. When the user selects the notification, WARP will open a browser window with your Access login page.

Ensure that your operating system allows notifications for WARP. Your device may not display notifications if focus, do not disturb, or screen sharing settings are turned on. To turn on client notifications on macOS devices running DisplayLink software, you may have to allow system notifications when mirroring your display. For more information, refer to the macOS documentation ‚Üó.

## Modify order of precedence in Gateway

By default, Cloudflare will evaluate Access application policies after evaluating all Gateway network policies. To evaluate Access applications before or after specific Gateway policies:

1. Create the following Gateway network policy:
















SelectorOperatorValueActionAccess Private AppisPresentAllow
2. Update the policy's order of precedence using the dashboard or API.

Note

Users must pass the policies in your Access application before they are granted access. The Gateway Allow policy is strictly for routing and connectivity purposes.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Browser-rendered terminal

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/non-http/browser-rendering/](https://developers.cloudflare.com/cloudflare-one/applications/non-http/browser-rendering/)

Page options # Browser-rendered terminal

Cloudflare can render SSH, VNC, and RDP applications in a browser without the need for client software or end-user configuration changes. For SSH and VNC, user email prefixes must match their username on the server. RDP leverages your existing Windows usernames and passwords for authenticating to the Windows server; Cloudflare does not manage any credentials on the Windows server.

## Limitations

- Browser rendering is only supported for self-hosted public applications, not private IPs or hostnames.
- You can only render a browser-rendered terminal on domains and subdomains, not on specific paths.
- Cloudflare does not control the length of an active SSH, VNC, or RDP session. Application session durations determine the window in which a user can initiate a new connection or refresh an existing one.
- Cloudflare uses TLS to secure the egress RDP connection to your Windows server. We do not currently validate the chain of trust.

## Turn on browser rendering

### SSH and VNC

To turn on browser rendering for an SSH or VNC application:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Locate the SSH or VNC application you created when connecting the server to Cloudflare. Select Configure.
3. In the Policies tab, ensure that only Allow or Block policies are present. Bypass and Service Auth are not supported for browser-rendered applications.
4. Go to Advanced settings > Browser rendering settings.
5. For Browser rendering, choose SSH or VNC.
6. Select Save application.

When users authenticate and visit the URL of the application, Cloudflare will render a terminal in their browser.

### RDP

To set up browser-rendering for RDP, refer to our browser-based RDP guide.

### SSH key exchange algorithms

Cloudflare's browser-rendered SSH terminal supports the following Key Exchange (KEX) algorithms:

- curve25519-sha256@libssh.org
- curve25519-sha256
- ecdh-sha2-nistp256
- ecdh-sha2-nistp384
- ecdh-sha2-nistp521

For browser-rendered SSH connections to work, you may need to update the sshd_config file on your server to accept these algorithms.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Client-side cloudflared

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/non-http/cloudflared-authentication/](https://developers.cloudflare.com/cloudflare-one/applications/non-http/cloudflared-authentication/)

Page options # Client-side cloudflared

With Cloudflare Zero Trust, users can connect to non-HTTP applications via a public hostname without installing the WARP client. This method requires you to onboard a domain to Cloudflare and install cloudflared on both the server and the user's device.

Users log in to the application by running a cloudflared access command in their terminal. cloudflared will launch a browser window and prompt the user to authenticate with your identity provider.

Note

Automated services should only authenticate with cloudflared if they cannot use a service token. Cloudflared authentication relies on WebSockets to establish a connection. WebSockets have a known limitation where persistent connections may close unexpectedly. We recommend either a Service Auth policy or using Warp to Tunnel routing in these instances.

For examples of how to connect to Access applications with client-side cloudflared, refer to these tutorials:

- Connect through Access using a CLI
- Connect through Access using kubectl
- Connect over SSH with cloudflared (legacy) -- SSH connections are now managed through Access for Infrastructure.
- Connect over RDP with cloudflared
- Connect over SMB with cloudflared
- Connect over arbitrary TCP with cloudflared

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Enable automatic cloudflared authentication

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/non-http/cloudflared-authentication/automatic-cloudflared-authentication/](https://developers.cloudflare.com/cloudflare-one/applications/non-http/cloudflared-authentication/automatic-cloudflared-authentication/)

Page options # Enable automatic cloudflared authentication

When users connect to an Access application through cloudflared, the browser prompts them to allow access by displaying this page:

Automatic cloudflared authentication allows users to skip this login page if they already have an active IdP session.

To enable automatic cloudflared authentication:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Locate your application and select Configure.
3. Go to Advanced settings > Browser rendering settings.
4. Turn on Enable automatic cloudflared authentication.
5. Select Save application.

This option will still prompt a browser window in the background, but authentication will now happen automatically.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Arbitrary TCP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/non-http/cloudflared-authentication/arbitrary-tcp/](https://developers.cloudflare.com/cloudflare-one/applications/non-http/cloudflared-authentication/arbitrary-tcp/)

Page options # Arbitrary TCP

Cloudflare Access provides a mechanism for end users to authenticate with their single sign-on (SSO) provider and connect to resources over arbitrary TCP without being on a virtual private network (VPN).

## Requirements

- A Cloudflare account
- A site active on Cloudflare
- The cloudflared daemon installed on the host and client machines

> Cloudflare Access requires you to first add a site ‚Üó to Cloudflare. You can use any site you have registered; the site does not need to be the same one you use for customer traffic and it does not need to match sites in your internal DNS.
> Adding the site to Cloudflare requires changing your domain's authoritative DNS to point to Cloudflare's nameservers. Once configured, all requests to that hostname will be sent to Cloudflare's network first, where Access policies can be applied.

## Connect the host to Cloudflare

### 1. Install the Cloudflare daemon on the host machine

The Cloudflare daemon, cloudflared, will maintain a secure, persistent, outbound-only connection from the machine to Cloudflare. Arbitrary TCP traffic will be proxied over this connection using Cloudflare Tunnel ‚Üó.

Follow these instructions to download and install cloudflared on the machine hosting the resource.

### 2. Authenticate the Cloudflare daemon

Run the following command to authenticate cloudflared into your Cloudflare account.

Terminal window ```
cloudflared tunnel login
```

cloudflared will open a browser window and prompt you to login to your Cloudflare account. If you are working on a machine that does not have a browser, or a browser window does not launch, you can copy the URL from the command-line output and visit the URL in a browser on any machine.

Once you login, Cloudflare will display the sites that you added to your account. Select the site where you will create a subdomain to represent the resource. For example, if you plan to share the service at tcp.site.com select site.com from the list.

Once selected, cloudflared will download a wildcard certificate for the site. This certificate will allow cloudflared to create a DNS record for a subdomain of the site.

### 3. Secure the subdomain with Cloudflare Access

Next, protect the subdomain you plan to register with a Cloudflare Access policy. Follow these instructions to build a new policy to control who can connect to the resource.

For example, if you share the resource at tcp.site.com, build a policy to only allow your team members to connect to that subdomain.

### 4. Connect the resource to Cloudflare

cloudflared can proxy connections to nonstandard ports.

Run the following command to connect the resource to Cloudflare, replacing the tcp.site.com and 7870 values with your site and port.

Terminal window ```
cloudflared tunnel --hostname tcp.site.com --url tcp://localhost:7870
```

cloudflared will confirm that the connection has been established. The process needs to be configured to stay alive and autostart. If the process is terminated, end users will not be able to connect.

## Connect from a client machine

### 1. Install the Cloudflare daemon on the client machine

Follow the same steps above to download and install cloudflared on the client desktop that will connect to the resource. cloudflared will need to be installed on each user device that will connect.

### 2. Connect to the resource

Run the following command to create a connection from the device to Cloudflare. Any available port can be specified.

Terminal window ```
cloudflared access tcp --hostname tcp.site.com --url localhost:9210
```

This command can be wrapped as a desktop shortcut so that end users do not need to use the command line.

Point the client application to the selected port.

When the client launches, cloudflared will launch a browser window and prompt the user to authenticate with your SSO provider.

Common issues

- Ensure that the machine's firewall permits egress on ports 80 and 443, otherwise cloudflared will return an error.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Private network applications (legacy)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/non-http/legacy-private-network-app/](https://developers.cloudflare.com/cloudflare-one/applications/non-http/legacy-private-network-app/)

Page options # Private network applications (legacy)

Note

Not recommended for new deployments. We recommend using a self-hosted application to secure a private IP address.

You can configure a Private Network application to manage access to specific applications on your private network.

To create a private network application:

1. In Zero Trust ‚Üó, go to Access > Applications > Add an application.
2. Select Private Network.
3. Name your application.
4. For Application type, select Destination IP.
5. For Value, enter the IP address for your application (for example, 10.128.0.7).
NoteIf you would like to create a policy for an IP/CIDR range instead of a specific IP address, you can build a Gateway Network policy using the Destination IP selector.
6. Configure your App Launcher visibility and logo.
7. Select Next. You will see two auto-generated Gateway Network policies: one that allows access to the destination IP and another that blocks access.
8. Modify the policies to include additional identity-based conditions. For example:


Policy 1


























SelectorOperatorValueLogicActionDestination IPin10.128.0.7AndAllowUser Emailmatches regex.*@example.com


Policy 2

















SelectorOperatorValueActionDestination IPin10.128.0.7Block


Policies are evaluated in numerical order, so a user with an email ending in @example.com will be able to access 10.128.0.7 while all others will be blocked. For more information on building network policies, refer to our dedicated documentation.
9. Policy 1


























SelectorOperatorValueLogicActionDestination IPin10.128.0.7AndAllowUser Emailmatches regex.*@example.com
10. Policy 2

















SelectorOperatorValueActionDestination IPin10.128.0.7Block
11. Select Add application.

Your application will appear on the Applications page.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Short-lived certificates (legacy)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/non-http/short-lived-certificates-legacy/](https://developers.cloudflare.com/cloudflare-one/applications/non-http/short-lived-certificates-legacy/)

Page options # Short-lived certificates (legacy)

Note

Not recommended for new deployments. We recommend using Access for Infrastructure to configure short-lived certificates for SSH.

Cloudflare Access can replace traditional SSH keys with short-lived certificates issued to your users based on the token generated by their Access login. In traditional models, users generate an SSH keypair and administrators grant access to individual SSH servers by deploying their users' public keys to those servers. These SSH keys can remain unchanged on these servers for months or years. Cloudflare Access removes the burden of managing SSH keys, while also improving security by replacing long-lived SSH keys with ephemeral SSH certificates.

## 1. Secure the server behind Cloudflare Access

Cloudflare Access short-lived certificates can work with any modern SSH server, whether it is behind Access or not. However, we recommend putting your server behind Access for added security and features, such as auditability and browser-based terminals.

To secure your server behind Cloudflare Access:

1. Connect the server to Cloudflare as a public hostname route.
2. Create a self-hosted Access application for the server.

Note

If you do not wish to use Access, refer instead to our SSH proxy instructions.

## 2. Ensure Unix usernames match user SSO identities

Cloudflare Access will take the identity from a token and, using short-lived certificates, authorize the user on the target infrastructure.

The simplest setup is one where a user's Unix username matches their email address prefix. Issued short-lived certificates will be valid for the user's email address prefix. For example, if a user in your Okta or GSuite organization is registered as jdoe@example.com, they would log in to the SSH server as jdoe.

For testing purposes, you can run the following command to generate a Unix user on the machine:

Terminal window ```
sudo adduser jdoe
```

Advanced setup: Differing usernames

SSH certificates include one or more principals in their signature which indicate the Unix usernames the certificate is allowed to log in as. Cloudflare Access will always set the principal to the user's email address prefix. For example, when jdoe@example.com tries to connect, Access issues a short-lived certificate authorized for the principal jdoe.

By default, SSH servers authenticate the Unix username against the principals listed in the user's certificate. You can configure your SSH server to accept principals that do not match the Unix username.

Note

If you would like to use short-lived certificates with the browser-based terminal, the user's email address prefix needs to matches their Unix username.

Username matches a different email

To allow jdoe@example.com to log in as the user johndoe, add the following to the server's /etc/ssh/sshd_config:

```
Match user johndoe  AuthorizedPrincipalsCommand /bin/echo 'jdoe'  AuthorizedPrincipalsCommandUser nobody
```

This tells the SSH server that, when someone tries to authenticate as the user johndoe, check their certificate for the principal jdoe. This would allow the user jdoe@example.com to sign into the server with a command such as:

Terminal window ```
ssh johndoe@server
```

Username matches multiple emails

To allow multiple email addresses to log in as vmuser, add the following to the server's /etc/ssh/sshd_config:

```
Match user vmuser  AuthorizedPrincipalsFile /etc/ssh/vmusers-list.txt
```

This tells the SSH server to load a list of principles from a file. Then, in /etc/ssh/vmusers-list.txt, list the email prefixes that can log in as vmuser, one per line:

```
jdoebwaynerobin
```

Username matches all users

To allow any Access user to log in as vmuser, add the following command to the server's /etc/ssh/sshd_config:

```
Match user vmuser  AuthorizedPrincipalsCommand /bin/bash -c "echo '%t %k' | ssh-keygen -L -f - | grep -A1 Principals"  AuthorizedPrincipalsCommandUser nobody
```

This command takes the certificate presented by the user and authorizes whatever principal is listed on it.

Allow all users

To allow any Access user to log in with any username, add the following to the server's /etc/ssh/sshd_config:

```
AuthorizedPrincipalsCommand /bin/bash -c "echo '%t %k' | ssh-keygen -L -f - | grep -A1 Principals"AuthorizedPrincipalsCommandUser nobody
```

Since this will put the security of your server entirely dependent on your Access configuration, make sure your Access policies are correctly configured.

## 3. Generate a short-lived certificate public key

1. In Zero Trust, go to Access > Service auth > SSH.
2. In the Application dropdown, choose the Access application that represents your SSH server.
3. Select Generate certificate. A row will appear with a public key scoped to your application.
4. Save the key or keep it somewhere convenient for configuring your server.
You can return to copy this public key any time in the Service Auth dashboard.

## 4. Save your public key

1. Copy the public key generated from the dashboard in Step 3.

1. Use the following command to change directories to the SSH configuration directory on the remote target machine:
Terminal windowcd /etc/ssh
2. Once there, you can use the following command to both generate the file and open a text editor to input/paste the public key.
Terminal windowvim ca.pub
3. In the ca.pub file, paste the public key without any modifications.
ca.pubecdsa-sha2-nistp256 <redacted> open-ssh-ca@cloudflareaccess.org
The ca.pub file can hold multiple keys, listed one per line. Empty lines and comments starting with # are also allowed.
4. Save the ca.pub file. In some systems, you may need to use the following command to force the file to save depending on your permissions:
Terminal window:w !sudo tee %:q!

## 5. Modify your sshd_config file

Configure your SSH server to trust the Cloudflare SSH CA by updating the sshd_config file on the remote target machine.

1. While in the /etc/ssh directory on the remote machine, open the sshd_config file.
Terminal window sudo vim /etc/ssh/sshd_config
2. Press i to enter insert mode, then add the following lines at the top of the file, above all other directives:
PubkeyAuthentication yesTrustedUserCAKeys /etc/ssh/ca.pub
Be aware of your include statementsIf there are any include statements below these lines, the configurations in those files will not take precedence.
3. Press esc and then type :x and press Enter to save and exit.

## 6. Restart your SSH server

Once you have modified your SSHD configuration, reload the SSH service on the remote machine for the changes to take effect.

- Debian/Ubuntu
- CentOS/RHEL

For Debian/Ubuntu:

Terminal window ```
sudo systemctl reload ssh
```

For CentOS/RHEL 7 and newer:

Terminal window ```
sudo systemctl reload sshd
```

## 7. Connect as a user

### Configure your client SSH config

On the client side, configure your device to use Cloudflare Access to reach the protected machine. To use short-lived certificates, you must include the following settings in your SSH config file (~/.ssh/config).

To save time, you can use the following cloudflared command to print the required configuration command:

Terminal window ```
cloudflared access ssh-config --hostname vm.example.com --short-lived-cert
```

If you prefer to configure manually, this is an example of the generated SSH config:

```
Match host vm.example.com exec "/usr/local/bin/cloudflared access ssh-gen --hostname %h"    HostName vm.example.com    ProxyCommand /usr/local/bin/cloudflared access ssh --hostname %h    IdentityFile ~/.cloudflared/vm.example.com-cf_key    CertificateFile ~/.cloudflared/vm.example.com-cf_key-cert.pub
```

### Connect through a browser-based terminal

End users can connect to the SSH session without any configuration by using Cloudflare's browser-based terminal. To enable, refer to Browser-rendered terminal.

By default, the browser-based terminal prompts the user for a username/password login. If you would like to use certificate based authentication, make sure you have created a short-lived certificate for the specific Access application configured for browser-rendered SSH.

Your SSH server is now protected behind Cloudflare Access ‚Äî users will be prompted to authenticate with your identity provider before they can connect. You can also enable SSH command logging by configuring a Gateway Audit SSH policy.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Cloud Access Security Broker

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/](https://developers.cloudflare.com/cloudflare-one/applications/casb/)

Page options # Cloud Access Security Broker

Availability

Available for all Zero Trust users.

Free users can configure up to two CASB integrations. You must upgrade to an Enterprise plan to view the details of a finding instance.

Cloudflare's API-driven Cloud Access Security Broker ‚Üó (CASB) integrates with SaaS applications and cloud environments to scan for misconfigurations, unauthorized user activity, shadow IT, and other data security issues that can occur after a user has successfully logged in.

## Manage CASB integrations

When you integrate a third-party SaaS application or cloud environment with Cloudflare CASB, you allow CASB to make API calls to its endpoint and read relevant data on your behalf. The CASB integration permissions are read-only and follow the least privileged model. In other words, only the minimum access required to perform a scan is granted.

### Prerequisites

Before you can integrate a SaaS application or cloud environment with CASB, your account with that integration must meet certain requirements. Refer to the SaaS application or cloud environment's integration guide to learn more about the prerequisites and permissions.

### Add an integration

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Select Connect an integration or Add integration.
3. Browse the available integrations and select the application you would like to add.
4. Follow the step-by-step integration instructions in the UI.
5. To run your first scan, select Save integration.

After the first scan, CASB will automatically scan your SaaS application or cloud environment on a frequent basis to keep up with any changes. Scan intervals will vary due to each application having their own set of requirements, but the frequency is typically between every 1 hour and every 24 hours.

Once CASB detects at least one finding, you can view and manage your findings.

### Pause an integration

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Find the integration you would like to pause and select Configure.
3. To stop scanning the application, turn off Scan for findings.
4. Select Save integration.

You can resume CASB scanning at any time by turning on Scan for findings.

### Delete an integration

Warning

When you delete an integration, all keys and OAuth data will be deleted. This means you cannot restore a deleted integration or its scanned data.

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Find the integration you would like to delete and select Configure.
3. Select Disenroll.

To resume scanning the integration for findings, you will need to add the integration again.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Manage findings

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/manage-findings/](https://developers.cloudflare.com/cloudflare-one/applications/casb/manage-findings/)

Page options # Manage findings

Findings are security issues detected within SaaS and cloud applications that involve users, data at rest, and other configuration settings. With Cloudflare CASB, you can review a comprehensive list of findings in Zero Trust and immediately start taking action on the issues found.

## Prerequisites

- You have added a CASB integration.
- Your scan has surfaced at least one security finding.

## Posture findings

Posture findings include misconfigurations, unauthorized user activity, and other data security issues.

To view details about the posture findings that CASB found:

1. In Zero Trust ‚Üó, go to CASB > Posture.
2. Choose SaaS or Cloud.
3. To view details about a finding, select the finding's name

CASB will display details about your posture finding, including the finding type, severity level, number of instances, associated integration, current status, and date detected. For more information on each instance of the finding, select Manage.

To manage the finding's visibility, you can update the finding's severity level or hide the finding from view. Additionally, some findings provide a remediation guide to resolve the issue or support creating a Gateway HTTP policy to block the traffic.

### Severity levels

Cloudflare CASB labels each finding with one of the following severity levels:

| Severity level | Urgency |
| --- | --- |
| Critical | Suggests the finding is something your team should act on today. |
| High | Suggests the finding is something your team should act on this week. |
| Medium | Suggests the finding should be reviewed sometime this month. |
| Low | Suggests the finding is informational or part of a scheduled review process. |

#### Change the severity level

You can change the severity level for a finding at any time in case the default assignment does not suit your environment:

1. In Zero Trust ‚Üó, go to CASB > Posture.
2. Locate the finding you want to modify and select Manage.
3. In the severity level drop-down menu, choose your desired setting (Critical, High, Medium, or Low).

The new severity level will only apply to the posture finding within this specific integration. If you added multiple integrations of the same application, the other integrations will not be impacted by this change.

## Content findings

Content findings include instances of potential data exposure as identified by DLP.

To view details about the content findings that CASB found:

1. In Zero Trust ‚Üó, go to CASB > Content.
2. Choose SaaS or Cloud.
3. To view details about a finding, select the finding's name.

CASB will display details about your content finding, including the file name, a link to the file, matching DLP profiles, associated integration, and date detected.

AWS users can configure a compute account to scan for data security resources within their S3 resources.

## View shared files

File findings for some integrations (such as Microsoft 365 and Box) may link to an inaccessible file. To access the actual shared file:

- Posture finding
- Content finding

1. In Zero Trust ‚Üó, go to CASB > Posture.
2. Choose SaaS or Cloud.
3. Locate the individual finding, then select Manage.
4. In Active Instances, select the file name.
5. In Shared Links, select the linked file instance.

1. In Zero Trust ‚Üó, go to CASB > Content.
2. Choose SaaS or Cloud.
3. Select the file name of the detected asset.
4. In Sharing details, select the linked file instance.

## Hide findings

After reviewing your findings, you may decide that certain posture findings are not applicable to your organization. Cloudflare CASB allows you to remove findings or individual instances of findings from your list of active issues. CASB will continue to scan for these issues, but any detections will appear in a separate tab.

### Ignore a finding

1. In Zero Trust ‚Üó, go to CASB > Posture.
2. Locate the active finding you want to hide.
3. In the three-dot menu, select Move to ignore.

The finding's status will change from Active to Ignored. CASB will continue to scan for these findings and report detections. You can change ignored findings back to Active with the same process at any time.

### Hide an instance of a finding

1. In Zero Trust ‚Üó, go to CASB > Posture.
2. Choose the active finding you want to hide, then select Manage.
3. In Active, find the instance you want to hide.
4. In the three-dot menu, select Move to hidden.

The instance will be moved from Active to Hidden within the finding. If the finding occurs again for the same user, CASB will report the new instance quietly in the Hidden tab. You can move hidden instances back to the Active tab at any time.

## Remediate findings

In addition to detecting and surfacing misconfigurations or issues with SaaS and cloud applications, CASB can also remediate findings directly in applications.

CASB supports remediation for findings from the Microsoft 365 integration:

Supported CASB findings for remediation

- Microsoft: File publicly accessible with edit access
- Microsoft: File publicly accessible with view access
- Microsoft: File publicly accessible with edit access with DLP Profile match
- Microsoft: File publicly accessible with view access with DLP Profile match

### Configure remediation permissions

Before you can remediate findings, add a new integration and choose Read-Write mode during setup. Alternatively, you can update an existing integration:

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Choose your integration, then select Configure.
3. In Integration permissions, choose Read-Write mode.
4. Select Update integration. CASB will redirect you to your Microsoft 365 configuration.
5. Sign in to your organization, then select Accept.

CASB can now remediate supported findings directly.

### Remediate a finding

To remediate a supported finding:

1. In Zero Trust ‚Üó, go to CASB > Posture Findings.
2. Choose a supported finding type, then select Manage.
3. In Active Instances, select an instance.
4. In Remediation details, choose a remediation action to take.

CASB will begin remediating the instance.

### Manage remediated findings

Remediated findings will appear in CASB > Posture Findings > Remediated findings. The status of the finding will change depending on what action CASB has taken:

| Status | Description |
| --- | --- |
| Pending | CASB has set the finding to be remediated. |
| Queued | CASB has queued the finding for remediation. |
| Processing | CASB is currently remediating the finding. |
| Validating | CASB successfully completed the remediation and is waiting for confirmation that the finding has been resolved. |
| Completed | CASB successfully remediated the finding and validated that the finding has been resolved. |
| Failed | CASB unsuccessfully remediated the finding. |
| Rejected | CASB does not have the correct permissions to remediate the finding. |

If the status is Completed, remediation succeeded. If the status is Failed or Rejected, remediation failed, and you can select the finding to take action again.

CASB will log remediation actions in Logs > Admin. For more information, refer to Zero Trust Logs.

## Resolve finding with a Gateway policy

Using the security findings from CASB allows for fine-grained Gateway policies which prevent future unwanted behavior while still allowing usage that aligns to your organization's security policy. You can view a CASB finding, like the use of an unapproved application, then immediately prevent or control access with Gateway.

CASB supports creating a Gateway policy for findings from the Google Workspace integration:

Supported CASB findings for Gateway policies

- Google Workspace: File publicly accessible with edit access
- Google Workspace: File publicly accessible with view access
- Google Workspace: File shared outside company with edit access
- Google Workspace: File shared outside company with view access

Before you begin

Ensure that you have enabled HTTP filtering for your organization.

To create a Gateway policy directly from a CASB finding:

1. In Zero Trust ‚Üó, go to CASB > Posture or CASB > Content.
2. Choose SaaS or Cloud.
3. Choose the finding you want to modify, then select Manage.
4. Find the instance you want to block and select its three-dot menu.
5. Select Block with Gateway HTTP policy. A new browser tab will open with a pre-filled HTTP policy.
NoteNot all CASB findings will have the Block with Gateway HTTP policy option. Unsupported findings can only be resolved from your application dashboard or through your domain provider.
6. (Optional) Configure the HTTP policy. For example, if the policy blocks an unsanctioned third-party app, you can apply the policy to some or all users, or only block uploads or downloads.
7. Select Save.

Your HTTP policy will now prevent future instances of the security finding.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Available integrations

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/)

Page options # Available integrations

You can integrate the following SaaS applications and cloud environments with Cloudflare CASB:

- Amazon Web Services (AWS) S3
- Anthropic
- Atlassian Confluence
- Atlassian Jira
- Bitbucket Cloud
- Box
- Dropbox
- GitHub
- Google Cloud Platform (GCP) Cloud Storage
- Google Workspace      Gemini for Google Workspace      Gmail      Google Admin      Google Calendar      Google Drive      Gmail (FedRAMP)      Google Admin (FedRAMP)      Google Calendar (FedRAMP)      Google Drive (FedRAMP)
- Gemini for Google Workspace
- Gmail
- Google Admin
- Google Calendar
- Google Drive
- Gmail (FedRAMP)
- Google Admin (FedRAMP)
- Google Calendar (FedRAMP)
- Google Drive (FedRAMP)
- Microsoft 365      Admin Center      OneDrive      Outlook      SharePoint      Admin Center (FedRAMP)      OneDrive (FedRAMP)      Outlook (FedRAMP)      SharePoint (FedRAMP)
- Admin Center
- OneDrive
- Outlook
- SharePoint
- Admin Center (FedRAMP)
- OneDrive (FedRAMP)
- Outlook (FedRAMP)
- SharePoint (FedRAMP)
- OpenAI
- Salesforce
- Salesforce (FedRAMP)
- ServiceNow
- ServiceNow (FedRAMP)
- Slack

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Amazon Web Services (AWS) S3

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/aws-s3/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/aws-s3/)

Page options # Amazon Web Services (AWS) S3

The Amazon Web Services (AWS) S3 integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated AWS account that could leave you and your organization vulnerable.

## Integration prerequisites

- An AWS account using AWS S3 (Simple Storage Service)
- For initial setup, access to the AWS account with permission to create a new IAM Role with the scopes listed below.

## Integration permissions

For the AWS S3 integration to function, Cloudflare CASB requires the following access scopes via an IAM Role with cross-account access:

- s3:PutBucketNotification
- s3:GetObject
- s3:ListBucket

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission scope, refer to the AWS S3 Permissions documentation ‚Üó.

## Compute account

You can connect an AWS compute account to your CASB integration to perform Data Loss Prevention scans within your S3 bucket and avoid data egress. CASB will scan any objects that exist in the bucket at the time of configuration.

### Add a compute account

To connect a compute account to your AWS integration:

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Find and select your AWS integration.
3. Select Open connection instructions.
4. Follow the instructions provided to connect a new compute account.
5. Select Refresh.

You can only connect one computer account to an integration. To remove a compute account, select Manage compute accounts.

### Configure compute account scanning

Once your AWS compute account has successfully connected to your CASB integration, you can configure where and how to scan for sensitive data:

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Find and select your AWS integration.
3. Select Create new configuration.
4. In Resources, choose the buckets you want to scan. Select Continue.
5. Choose the file types, sampling percentage, and DLP profiles to scan for.
6. (Optional) Configure additional settings, such as the limit of API calls over time for CASB to adhere to.
7. Select Continue.
8. Review the details of the scan, then select Start scan.

CASB will take up to an hour to begin scanning. To view the scan results, go to CASB > Content > Cloud.

To manage your resources, go to CASB > Integrations, then find and select your AWS integration. From here, you can pause all or individual scans, add or remove resources, and change scan settings.

For more information, refer to Content findings.

## Security findings

The AWS S3 integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### S3 Bucket security

Flag security issues in S3 Buckets, including overpermissioning, access policies, and user security best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| S3 Bucket ACL Allows Any Authenticated User to Write | 09bc7d1f-e682-43bc-a4ce-e6e03b408244 | Critical |
| S3 Bucket ACL Allows Any Authenticated User to Write ACP | 9392a460-c566-4e0d-b06b-01d87dc84d7c | Critical |
| S3 Bucket ACL Allows Public ACP Write | 5b792c7f-2546-4fcd-96dc-a58a53fea7e0 | Critical |
| S3 Bucket ACL Allows Public Write | f50ae197-fa0a-4caa-be95-79aed91eed63 | Critical |
| S3 Bucket Policy Allows Any Authenticated User to Write | 70fe0596-28bc-41dd-a2c3-1486fb0fb1dd | Critical |
| S3 Bucket Policy Allows Public Write | 5e2aac4b-d8be-43dc-b324-84fdf63f760e | Critical |
| S3 Bucket Publicly Accessible | 6b1276e3-88e8-4150-a4d5-1b8273f11078 | Critical |
| S3 Bucket ACL Allows Any Authenticated User to Read | fda31c4d-24dc-43d4-8a84-a1a9e1df01a1 | High |
| S3 Bucket ACL Allows Any Authenticated User to Read ACP | 7232e46b-3539-4080-b905-022f1091556c | High |
| S3 Bucket ACL Allows Public ACP Read | e324242c-5feb-41a3-8d91-f70611471fad | High |
| S3 Bucket ACL Allows Public Read | f8c9f979-29f0-4ada-b09e-a149937a55d4 | High |
| S3 Bucket Policy Allows Any Authenticated User to Read | c6b3a745-b535-45ea-b2c0-ba8a139ca634 | High |
| S3 Bucket Policy Allows Public Read | f3915412-eef9-47d9-8448-e04462de8ba2 | High |
| S3 Bucket Without MFA Delete Enabled | f108bd28-9870-453f-a439-01818e85bdc7 | High |
| S3 Bucket Without Server-Side Encryption (SSE) | 7817b383-79c3-44ca-8d5d-e01748afe75b | High |
| S3 Bucket Encryption in Transit Disabled | 0b3227dd-63d3-46bc-97b3-e62d9c11567a | Medium |
| S3 Bucket MFA Delete Disabled | 518697ff-3f7e-463e-acf3-79d106599f0e | Medium |
| S3 Bucket ACL Allows Public List | e3c8a170-7817-4151-bd01-55442f4416ea | Medium |
| S3 Bucket Objects Can Be Public | 0ff170dc-be6b-46fa-a1cf-95ca7d067f4b | Medium |
| S3 Bucket Policy Allows Any Authenticated AWS User | 264be783-7fe1-4f50-aee7-d8df370b7b77 | Medium |
| S3 Bucket Policy Allows Any Authenticated User to Delete | 4431eaeb-63e3-43c1-a4bc-029f09da66fd | Medium |
| S3 Bucket Policy Allows Any Authenticated User to List | 319c9715-b86d-4215-bdfa-c5d9b3a5cc83 | Medium |
| S3 Bucket Policy Allows Public Delete | bbbeacbc-6692-4121-a785-d634da1e5c56 | Medium |
| S3 Bucket Policy Allows Public List | f7ae03e3-1303-4404-b6f5-a7f97e52105e | Medium |
| S3 Bucket Server Side Encryption Disabled | d69ab398-fba8-4e71-bf49-60af48d00cbc | Medium |
| S3 Bucket Without Access Logging | 67d0995d-7b4a-40c5-a43f-7a98d20faac6 | Medium |
| S3 Bucket Without AWS CloudTrail Logging | 89366ebe-ca0b-45fc-a9cb-135674e0a49b | Medium |
| S3 Bucket Without Cross-Region Replication | d4e5c815-33e3-4a01-b852-fe040d51ee55 | Medium |
| S3 Bucket Without Default Encryption | fb7a41af-294c-4e9b-a6ca-a1fed35542d6 | Medium |
| S3 Bucket Without Lifecycle Policies | 2df6f1b8-e41c-4ab5-a466-992ce485a367 | Medium |
| S3 Bucket Without Object-Level Logging | 9af2594c-3999-49c9-bd3d-2f4b091f99c0 | Medium |
| S3 Bucket Without Replication Enabled | cb61ef18-a498-456c-985c-78a45e19f4fe | Medium |
| S3 Bucket Without Versioning Enabled | 95e1284f-a514-4396-bf64-cd003818790c | Medium |
| S3 Bucket Access Logging Disabled | 84ba76fa-4703-490e-ab75-1b554993c054 | Low |
| S3 Bucket Lifecycle Disabled | 970d2ca8-e189-42a8-8e86-9f674fcb1aea | Low |
| S3 Bucket Policy Not Existent | 3e1d0535-d82f-4ed1-9664-d2c50905db17 | Low |
| S3 Bucket Versioning Disabled | 4e976e0d-b545-4c4a-99c5-a2f5d9a6f3d8 | Low |

### IAM Policies

Identify AWS IAM-related security issues that could affect S3 Bucket and Object security.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| IAM Account Password Policy Does Not Exist | e39ee4da-eed5-49d0-95f7-b423884b858c | Critical |
| IAM Account Password Policy Doesn't Require Lowercase Letters | 9278444b-0c38-4ed0-8127-f3f25444811c | High |
| IAM Account Password Policy Doesn't Require Passwords to Expire | 5be79a96-4570-45cf-8ba3-1abe62802d16 | High |
| IAM Account Password Policy Doesn't Require Symbols | dd17afa3-4d4c-49e4-84c3-e829af9fff97 | High |
| IAM Account Password Policy Doesn't Require Uppercase Letters | e4976e53-bab5-4276-a1d3-1d85ebfd4d57 | High |
| IAM Account Password Policy Max Age is greater than 90 days | 4e1092a0-7092-405f-a991-537d8c371440 | High |
| IAM Account Password Policy Minimum Length is less than 8 | 2a2fa181-7beb-48ba-bc8d-8f1170c6062c | High |
| IAM Account Password Policy Re-use Prevention is less than 5 | a4791a20-373f-44d3-9f6e-e61f1685fe05 | High |
| IAM Role with Cross-Account Access | 8de72710-b23a-4d94-915e-26ef7249d21e | High |
| IAM Access Key Inactive over 90 Days | 37d1adb1-8e37-4708-a849-e06945c60802 | Medium |
| IAM Access Key Not Rotated over 90 Days | d2caf571-4c99-4da7-a21c-4384f8cb4e5c | Medium |
| IAM User Console Login Inactive Over 90 Days | 82b50a4d-8582-4766-9bad-f41b441bf336 | Medium |
| IAM User MFA Disabled | 4679563f-5975-4c68-9dbf-896810ec8de9 | Medium |
| IAM User Password Older Than 90 Days | c5376384-e4e4-4b2c-af84-12d6740939f0 | Medium |
| IAM Account Password Policy Doesn't Require Numbers | 15c65813-c7e6-4b22-95b3-b3942c8b8924 | Low |

### Root User Management

Detect security issues related to the use of an IAM Root User, which has the ability to access and configure important settings.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| AWS Root User Access Key Used within Last 90 Days | 9d23c002-aece-42b5-b082-2b51fab8d7c1 | Critical |
| AWS Root User has Access Keys | 1b788d31-ed56-4008-b136-6993f38e4d1c | Critical |
| AWS Root User Logged in within Last 90 Days | e9959d6e-edc9-4ea3-9113-3c30b02a811e | Critical |
| AWS Root User MFA Disabled | 19abe0ee-e8bd-4e3b-9ee9-ea5c64fe769c | Critical |

### Certificates

Catch certificate-related issues and risks to prevent malicious compromise of internal resources.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| ACM Certificate Expired | 30ce0a22-eb3d-457d-bc59-6468f9bb4c4f | Critical |
| ACM Certificate Has Domain Wildcard | d313bc0c-a2fb-41d8-b5a8-ef2704bb5570 | High |
| ACM Certificate Expires within 30 days | cd93f2c1-9b07-4e6c-964c-79f3a64d56ac | Medium |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Anthropic

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/anthropic/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/anthropic/)

Page options # Anthropic

The Anthropic integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Anthropic account that could leave you and your organization vulnerable.

This integration covers the following Anthropic products:

- Claude Console (organizations, workspaces/projects, users, invites)
- Anthropic API Platform (organization and project API keys)

## Integration prerequisites

- An Anthropic Team or Enterprise organization ‚Üó
- Organization-level admin (or equivalent) privileges in Anthropic ‚Üó to view organization metadata and manage API keys

## Integration permissions

For the Anthropic integration to function, Cloudflare CASB requires authorization via API keys:

- Organization API key (organization-level): Grants read-only access to organization/workspace metadata, members and invites, and key metadata used for findings.
- (Optional) Project API key (project-level): Grants read-only access to project metadata and keys when you include project scopes in the scan.

These credentials follow the principle of least privilege so that only the minimum required access is granted.

## Security findings

The Anthropic integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### API key hygiene

Detect API keys that may be unused or overdue for rotation.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Anthropic: Unused API key | f343cd22-21f0-45a6-b6f7-39b1539a0f2b | Medium |

### Access security

Flag organization access issues to help enforce best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Anthropic: High-privilege invite | a435d091-3bb1-42e1-bc98-32d80c6340a5 | High |
| Anthropic: Stale pending invite | 5667f7fa-4215-4a8e-80d7-4694ea33335b | Low |

### Data Loss Prevention (optional)

These findings will only appear if you added DLP profiles to your CASB integration.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Anthropic: Downloadable File with DLP Profile match | 74ec2a38-0e69-48d4-80ed-a8faad5f40ef | High |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Atlassian Confluence

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/atlassian-confluence/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/atlassian-confluence/)

Page options # Atlassian Confluence

The Atlassian Confluence integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Atlassian Confluence Cloud account that could leave you and your organization vulnerable.

Note

At this time, the CASB integration for Confluence is only compatible with Confluence Cloud accounts. Support for Confluence Data Center will come at a future date.

## Integration prerequisites

- A Confluence Cloud plan (Free, Standard, Premium, Enterprise)
- Access to a Confluence Cloud account with Site admin and/or Organization admin permissions

## Integration permissions

For the Confluence Cloud integration to function, Cloudflare CASB requires the following permissions via an OAuth 2.0 app:

- read:confluence-space.summary
- read:confluence-props
- read:confluence-content.all
- read:confluence-content.summary
- read:confluence-content.permission
- read:confluence-user
- read:confluence-groups

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission, refer to the Atlassian scopes documentation ‚Üó.

## Security findings

The Atlassian Confluence integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Access security

Flag user and third-party app access issues, including account misuse, sharing security, and users not following best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Confluence: Unknown or anonymous user with edit access to content | d5ad6f5e-3e7a-4409-a9dc-9707caca047e | Critical |
| Confluence: Unknown or anonymous user with edit access to space | a531c40f-76f5-404e-9c9b-3b21a6da7b98 | High |
| Confluence: Third-party app with edit access to space | aac0ac18-25ad-442a-9a24-01ecd85b0b2b | Medium |
| Confluence: Third-party app with edit access to content | 8214431e-b708-49c9-b28b-3214f1b491d8 | Medium |
| Confluence: Unknown or anonymous user with access | a1d0d098-2602-4312-85a8-a62d3bc56aca | Low |
| Confluence: Third-party app with content access | 5ccf7326-386d-4afb-867a-fbf25978c33a | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Atlassian Jira

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/atlassian-jira/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/atlassian-jira/)

Page options # Atlassian Jira

The Atlassian Jira integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Atlassian Jira Cloud account that could leave you and your organization vulnerable.

Note

At this time, the CASB integration for Jira is only compatible with Jira Cloud accounts. Support for Jira Data Center will come at a future date.

## Integration prerequisites

- A Jira Cloud plan (Free, Standard, Premium, Enterprise)
- Access to a Jira Cloud account with Site admin and/or Organization admin permissions

## Integration permissions

For the Jira Cloud integration to function, Cloudflare CASB requires the following permissions via an OAuth 2.0 app:

- read:jira-work
- read:jira-user

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission, refer to the Atlassian scopes documentation ‚Üó.

## Security findings

The Jira Cloud integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Access security

Flag user and third-party app access issues, including account misuse and users not following best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Jira: Active user with unknown account type | 8dfd390d-911e-47bb-9ded-cb75fd91e793 | Low |
| Jira: Active third-party app with access | 01118135-a4ab-4b8f-887d-c814358da217 | Low |
| Jira: Inactive third-party app with access | 36f7de49-2938-4a54-b212-b4da74145a58 | Low |
| Jira: Inactive user | 1e1a085c-1ef3-4199-bea5-ff52ccbd6d2d | Low |

### File security

Identify files that could be potentially problematic and worth deeper investigation.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Jira: Issue attachment larger than 512 MB | 1e5473b7-588e-4954-b97d-a5a20b4f8c5a | Medium |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Bitbucket Cloud

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/bitbucket-cloud/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/bitbucket-cloud/)

Page options # Bitbucket Cloud

The Bitbucket Cloud integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Bitbucket Cloud Cloud account that could leave you and your organization vulnerable.

Note

Currently, the CASB integration for Bitbucket is only compatible with Bitbucket Cloud accounts. Support for Bitbucket Data Center will come at a future date.

## Integration prerequisites

- A Bitbucket Cloud plan (Free, Standard, Premium, Enterprise)
- Access to a Bitbucket Cloud account with Site admin and/or Organization admin permissions

## Integration permissions

For the Bitbucket Cloud integration to function, Cloudflare CASB requires the following permission scopes via an OAuth 2.0 app:

- account
- email
- issue
- pipeline
- project
- project:admin
- pullrequest
- repository
- repository:admin
- runner
- snippet
- webhook
- wiki

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission scope, refer to the Atlassian scopes documentation ‚Üó.

## Security findings

The Bitbucket Cloud integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Repository security

Flag repository issues, including branch protection, access, and update frequency.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Bitbucket Cloud: Repository is publicly accessible | be273f0a-678e-49af-b9f8-8f3913acef97 | Critical |
| Bitbucket Cloud: Repository Default Branch Protection does not have PR Review Required | 6ad95c13-0d13-4595-bc76-bd86f4eba4b9 | High |
| Bitbucket Cloud: Repository has no Default Branch Protection | 324f2014-4d4b-4aa6-89a8-72a6c7da09d7 | Medium |
| Bitbucket Cloud: Repository not updated in 12+ months | a1bd3076-a68d-492e-9947-a01e15a4d1b3 | Medium |
| Bitbucket Cloud: Repository Default Branch Protection does not disable direct pushes for all users/groups | c60a7b00-1592-429a-8a32-d58101e4551f | Medium |
| Bitbucket Cloud: Repository Default Branch Protection does not have Stale PR Approvals Disabled | 738c9839-5e1e-4048-85a3-7935ec4c647a | Medium |
| Bitbucket Cloud: Repository Default Branch Protection does not have Force Pushes Disabled | 4c52f441-0c24-4dbd-8f5e-0e5b829ee8e2 | Medium |
| Bitbucket Cloud: Repository Default Branch Protection does not require passing builds to merge | afe4a27e-ee01-4ebe-914c-d480ac49a5c2 | Low |
| Bitbucket Cloud: Repository Default Branch Protection allows branch deletion | 86411562-4b85-4677-b048-7887cc5b1567 | Low |
| Bitbucket Cloud: Repository Default Branch Protection does not enforce merge checks | 64440d40-91de-4d13-9280-d5afa418ccf0 | Low |
| Bitbucket Cloud: Key is older than 180 days | 0a135600-a109-434f-877c-1a6594dcd76d | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Box

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/box/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/box/)

Page options # Box

The Box integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Box account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Box account on a Business plan (Business, Business Plus, Enterprise, Enterprise Plus)
- Access to a Box Business account with Admin permission

## Integration permissions

For the Box integration to function, Cloudflare CASB requires the following Box permissions via an OAuth 2.0 app:

- Read all files and folders stored in Box

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about the permission, refer to the Box Scopes documentation ‚Üó.

## Security findings

The Box integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### File sharing

Identify files and folders that have been shared in a potentially insecure fashion.

To access some file findings, you may need to review shared links. For more information, refer to View shared files.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Box: File publicly accessible with edit access | fa0532dd-9d13-4c21-8227-62b8bd8be275 | Critical |
| Box: File publicly accessible with high download count | 97c0845a-754b-4269-b548-85026867da64 | High |
| Box: Folder publicly accessible with edit access | 154eabed-19a7-4a07-9dfd-d08f5e839aed | High |
| Box: File shared company-wide with edit access | 8df801de-327b-4d71-9f36-fc6f3e2c18da | High |
| Box: File publicly accessible with view access | ecca7eeb-3c04-46b2-a509-40393ada32ec | High |
| Box: Folder shared company-wide with high download count | 21bed8a9-b587-4a8b-b38f-8c9492b1d132 | Medium |
| Box: File publicly accessible with high view count | 540ab1db-5a9e-4968-b669-100e2b97fa85 | Medium |
| Box: Folder that can be shared by anyone | c56757c6-72e4-456c-8cb9-a5b0fd6ceb4a | Medium |
| Box: Folder shared company-wide with edit access | 61082e41-3205-44a0-bb7e-34c02abd5137 | Medium |
| Box: File shared company-wide with view access | 5afdbe74-0311-4da8-a64e-6f25c3d4a2b7 | Medium |
| Box: File shared company-wide with high download count | 3cd0d8dd-d92b-4a46-b88f-076a17e11837 | Medium |
| Box: Folder publicly accessible with view access | 2e9d5774-3a22-4d45-9307-bb24207af3d7 | Medium |
| Box: Folder shared company-wide with high view count | fd303606-a513-4bb5-9a87-b1c836f6e993 | Low |
| Box: File larger than 2 GB | ef889ceb-4cad-4d25-8845-d350a599825e | Low |
| Box: Folder with external email upload access | 90f9b277-0846-4918-aac2-2e63fed576b5 | Low |
| Box: Folder shared company-wide with view access | 1bb68e90-9c1d-44ef-91a9-2ed4eb2eb5b2 | Low |
| Box: File shared company-wide with high view count | 22bf3a7b-1fd1-4eb6-b8f5-1b2e772b3484 | Low |

### Data Loss Prevention (optional)

These findings will only appear if you added DLP profiles to your CASB integration.

| Finding type | Severity | Description |
| --- | --- | --- |
| Box: File Publicly Accessible Read and Write with DLP Profile match | Critical | A Box file contains sensitive data that anyone on the Internet can read or write. |
| Box: File Publicly Accessible Read Only with DLP Profile match | Critical | A Box file contains sensitive data that anyone on the Internet can read. |
| Box: File Shared Company Wide Read and Write with DLP Profile match | Medium | A Box file is shared with the entire company with read and write permissions. |
| Box: File Shared Company Wide Read Only with DLP Profile match | Medium | A Box file is shared with the entire company with read permissions. |

### User access

Flag user access issues, including account misuse and users not following best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Box: Admin not required to use two-factor authentication | 40f33ef2-3eab-4855-b171-a71463f8fc96 | High |
| Box: User not required to use two-factor authentication | a8f9e55a-cb7c-4e35-8dc0-fdf569919a97 | Medium |
| Box: Inactive admin user | e6b82aa9-7d0d-4c85-a582-a377684ace47 | Medium |
| Box: User with unconfirmed notification email | 15b70c97-68f6-4ef0-afd1-891971162114 | Low |
| Box: User with email alias configured | 085164ed-c555-40ed-9374-358a892e49ef | Low |
| Box: User allowed to collaborate with external users | 01ed4b90-c470-4ea1-961a-7e64c2fec525 | Low |
| Box: Inactive user | d709ccb3-9b9d-4a3c-a3af-a1def54c9a2e | Low |

### Account misconfigurations

Discover account and admin-level settings that have been configured in a potentially insecure way.

| Finding type | Severity |
| --- | --- |
| Box: Active Webhook | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Dropbox

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/dropbox/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/dropbox/)

Page options # Dropbox

The Dropbox integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Dropbox account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Dropbox Business plan (Standard, Advanced, Enterprise, or Education)
- Access to a Dropbox Business account with Team admin permissions

## Integration permissions

For the Dropbox integration to function, Cloudflare CASB requires the following Dropbox permissions via an OAuth 2.0 app:

- account_info.read
- files.metadata.read
- files.content.read
- sharing.read
- team_info.read
- team_data.member
- team_data.governance.write
- team_data.governance.read
- files.team_metadata.read
- members.read
- groups.read
- sessions.list

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission, refer to the Dropbox API Permissions documentation ‚Üó.

## Security findings

The Dropbox integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### File and folder sharing

Identify files and folders that have been shared in a potentially insecure fashion.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Dropbox: File publicly accessible with edit access | 7fefad57-371b-4f27-b1f0-7d500c863bd0 | Critical |
| Dropbox: File shared company-wide with edit access | 265ed167-435c-4626-99ba-2fafd766c096 | High |
| Dropbox: File publicly accessible with view access | e8c057e4-d6ce-431b-9d03-d9aadff610d4 | High |
| Dropbox: Shared link create policy set to default 'Public' | 0afabc9a-3a98-4a67-941a-d1f0ce0cfbfe | High |
| Dropbox: File shared company-wide with view access | 02a14d67-27fa-4621-a280-1a25925d506f | Medium |
| Dropbox: Folder shared company-wide with edit access | ac4da5b9-ddb0-4285-ba52-2ba4de43b530 | Medium |
| Dropbox: Shared folder policy set to default 'Anyone' | 5d479ad5-d0f1-4c8f-b439-a39b399fe6c5 | Medium |
| Dropbox: Group creation policy set to 'Admins and Members' | 6f54b5eb-6867-490e-b823-08e91878eb40 | Medium |
| Dropbox: Folder join policy set to 'Can join folders shared by Anyone' | e5ffaecc-f61a-4019-a54f-2e5ac882d3f3 | Medium |
| Dropbox: Folder member policy set to 'Can share folders with Anyone' | 99d4a2af-12ec-43a1-9630-27ac4adf625c | Medium |
| Dropbox: Shared link create policy set to default 'Team-wide' | a3d02f04-4372-4ae3-99f9-e2caccee6e76 | Low |

### Data Loss Prevention (optional)

These findings will only appear if you added DLP profiles to your CASB integration.

| Finding type | Severity | Description |
| --- | --- | --- |
| File Publicly Accessible Read and Write with DLP Profile match | Critical | A Dropbox file contains sensitive data that anyone on the Internet can read or write. |
| File Publicly Accessible Read Only with DLP Profile match | Critical | A Dropbox file contains sensitive data that anyone on the Internet can read. |
| File Shared Company Wide Read and Write with DLP Profile match | Medium | A Dropbox file is shared with the entire company with read and write permissions. |
| File Shared Company Wide Read Only with DLP Profile match | Medium | A Dropbox file is shared with the entire company with read permissions. |

### Suspicious applications

Detect when suspicious Dropbox applications are linked by members.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Dropbox: Suspicious application linked by member | 8384c58c-1fc2-4caa-9836-c8ede7ca440d | High |

### User access and account misconfigurations

Flag user access issues, including users misusing accounts or not following best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Dropbox: Admin user with unverified secondary email | cebb4104-1235-4049-a664-9fcd003ece71 | Medium |
| Dropbox: Admin user with restricted directory access | 19378bb3-a3b7-4ee5-8ea7-39eec0a2ca7c | Medium |
| Dropbox: User with unverified email | 2b5804f7-4888-4872-a85a-a64805d10654 | Medium |
| Dropbox: Invited user | 44d34aab-82fb-4a60-8e35-d7a75cfc789c | Low |
| Dropbox: Suspended user | e356cfe6-97e6-4e30-9cb9-4a42a387844e | Low |
| Dropbox: User with secondary email configured | 4bbb795a-cd34-41ba-865d-9bf9de61a592 | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## GitHub

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/github/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/github/)

Page options # GitHub

The GitHub integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated GitHub Organization that could leave you and your organization vulnerable.

## Integration prerequisites

- A GitHub account with a Free, Pro, or Enterprise plan
- Membership to a GitHub Organization with Owner or GitHub App manager permissions

## Integration permissions

For the GitHub integration to function, Cloudflare CASB requires the following GitHub API permissions:

| Permission | Access | Description |
| --- | --- | --- |
| Administration | Read-only | View basic administrative information from the account. |
| Members | Read-only | View metadata on organization members |
| Metadata | Read-only | View metadata surrounding an organization's assets, excluding sensitive private repository information. |
| Organization administration | Read-only | View information on organization settings |

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission, refer to the GitHub App permissions reference ‚Üó.

## Security findings

The GitHub integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Branches and merges

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| GitHub: Repository has no Default Branch Protection | 5a0428fa-5c13-44b8-a028-9351c1d10a91 | Medium | A repository's default branch does not have any branch protection rules enabled. |
| GitHub: Repository Default Branch Protection does not have PR Review Required | edd3f193-af01-421d-9a50-cb1d147bf3a6 | Medium | A repository's default branch does not have a Require pull request reviews before merging rule. |
| GitHub: Repository Default Branch Protection does not have Force Pushes Disabled | efc3e582-ef39-4316-b1f3-d4717ef30867 | Medium | A repository's default branch has enabled Allow force pushes. |
| GitHub: Repository Default Branch Protection does not have Stale PR Approvals Disabled | 7dc170d7-b1ef-4138-95fb-403d16e7ed43 | Medium | A repository's default branch does not have a Dismiss stale pull request approvals when new commits are pushed rule. |
| GitHub: Repository Default Branch Protection does not have Admin Restrictions | 4e4aec5b-e763-41ac-9099-af874606959b | Medium | A repository's default branch does not have a Do not allow bypassing the above settings rule for administrators. |
| GitHub: Repository Default Branch Protection does not have Status Checks | 1eba1aeb-9827-4a03-9c47-8290bd3a83d5 | Medium | A repository's default branch does not have a Require status checks to pass before merging rule. |
| GitHub: Organization repository has default WRITE permission | fc074da0-1e1c-4982-8673-0852d70bf80c | Medium | A repository's default write protection settings were not changed. |
| GitHub: Repository not updated in 12+ months | 68b6ef6d-7e00-4761-b3f1-fcf323dc9c26 | Medium | No changes were made to a repository in at least a year. |

Learn more about GitHub branch protection rules ‚Üó.

### User accounts

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| GitHub: Organization two-factor authentication disabled | 47d01030-0ed8-496d-9484-f77899b21d59 | High | An organization does not have its organization-wide two-factor authentication (2FA) requirement enabled. |
| GitHub: Organization user two-factor authentication disabled | dfed92b2-a45e-46ed-a86b-8c7e3db01f3c | High | A member of the organization does not have two-factor authentication (2FA) enabled. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Cloud Platform (GCP) Cloud Storage

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/gcp-cloud-storage/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/gcp-cloud-storage/)

Page options # Google Cloud Platform (GCP) Cloud Storage

The Google Cloud Platform (GCP) Cloud Storage integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated GCP account that could leave you and your organization vulnerable.

## Integration prerequisites

- A GCP account using Cloud Storage.
- For initial setup, access to the GCP account with permission to create a new Service Account with the scopes listed below.

## Integration permissions

For the GCP Cloud Storage integration to function, Cloudflare CASB requires the following access scopes via a Service Account:

- roles/viewer
- roles/storage.admin

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission scope, refer to the GCP IAM roles for Cloud Storage documentation ‚Üó.

## Compute account

You can connect a GCP compute account to your CASB integration to perform Data Loss Prevention scans within your Cloud Storage bucket and avoid data egress. CASB will scan any objects that exist in the bucket at the time of configuration.

### Add a compute account

To connect a compute account to your GCP integration:

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Find and select your GCP integration.
3. Select Open connection instructions.
4. Follow the instructions provided to connect a new compute account.
5. Select Refresh.

You can only connect one compute account to an integration. To remove a compute account, select Manage compute accounts.

### Configure compute account scanning

Once your GCP compute account has successfully connected to your CASB integration, you can configure where and how to scan for sensitive data:

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Find and select your GCP integration.
3. Select Create new configuration.
4. In Resources, choose the buckets you want to scan. Select Continue.
5. Choose the file types, sampling percentage, and DLP profiles to scan for.
6. (Optional) Configure additional settings, such as the limit of API calls over time for CASB to adhere to.
7. Select Continue.
8. Review the details of the scan, then select Start scan.

CASB will take up to one hour to begin scanning. To view the scan results, go to CASB > Content > Cloud.

To manage your resources, go to CASB > Integrations, then find and select your GCP integration. From here, you can pause all or individual scans, add or remove resources, and change scan settings.

For more information, refer to Content findings.

## Security findings

The GCP Cloud Storage integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Cloud Storage Bucket security

Flag security issues in Cloud Storage Buckets, including overpermissioning, access policies, and user security best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Google Cloud Platform: GCS Bucket Allows Public Write | 4583f5a9-a343-4e2f-a8b3-9237a911f337 | Critical |
| Google Cloud Platform: GCS Bucket IAM Policy Allows Public Access | 032c1e88-0cff-47f6-8d75-046e0a7330de | Critical |
| Google Cloud Platform: GCS Bucket Publicly Accessible | cc028a95-46d4-4156-ac11-bc5713529824 | Critical |
| Google Cloud Platform: Public Access Prevention Enabled But Policy Grants Public | cc02680e-9cc3-49d1-99d5-29d425bf142f | Critical |
| Google Cloud Platform: GCS Bucket ACL Grants All Authenticated Users Access | e1a588af-0500-482e-b59d-fd2693ce7fc0 | Critical |
| Google Cloud Platform: GCS Bucket ACL Grants All Users Public Access | 1904c004-8d4f-470e-9460-e77db23d6a86 | Critical |
| Google Cloud Platform: Public Access Prevention but ACL Grants allUsers | fcf2e27e-673f-4cd2-9b76-ec89c4c5872c | Critical |
| Google Cloud Platform: GCS Bucket Versioning Disabled | bd66e214-f205-4e00-bd68-121dad0a7988 | High |
| Google Cloud Platform: GCS Bucket Without KMS Encryption | 0105d9c4-1a01-4b65-b33e-df6c55905147 | High |
| Google Cloud Platform: GCS Uniform Bucket-Level Access Disabled | 6960b459-aa9e-4b41-84f6-26cdb75a1995 | High |
| Google Cloud Platform: GCS Bucket IAM Policy Allows Public Read | 10420f34-8fdd-49cb-8d38-096a2de5824f | High |
| Google Cloud Platform: GCS Bucket Lacks Lifecycle Rules | edcd5a8b-b128-404b-8207-23a80f669b65 | Medium |
| Google Cloud Platform: GCS Bucket Logging Disabled | d26f43c8-9406-481c-8c8b-1a7f05f3cc27 | Medium |
| Google Cloud Platform: GCS Bucket Not Using 'Soft Delete' | 5542ed8e-77a6-43c1-8b9e-935e66009d34 | Medium |
| Google Cloud Platform: GCS Bucket Retention Policy Disabled | 2d4a247c-8adb-4f2b-ae58-3568d633cb81 | Medium |
| Google Cloud Platform: GCS Bucket IAM Policy Not Version 3 | ade2ede6-08c7-4962-b084-f6a29ee4a5b8 | Low |
| Google Cloud Platform: GCS Bucket IAM Policy Using Legacy Roles | 11a592b9-4f51-4a1a-9925-a48a5ed01521 | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Workspace

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/)

Page options # Google Workspace

The Google Workspace integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Google Workspace account that could leave you and your organization vulnerable.

This integration covers the following Google Workspace products:

- Gemini for Google Workspace
- Gmail
- Google Admin
- Google Calendar
- Google Drive
- Gmail (FedRAMP)
- Google Admin (FedRAMP)
- Google Calendar (FedRAMP)
- Google Drive (FedRAMP)

## Integration prerequisites

- A Google Workspace account with a Business Starter, Business Standard, Business Plus or Enterprise plan
- A Google Workspace user with Super Admin privileges ‚Üó and Owner permissions ‚Üó in the Google Cloud Platform (GCP) project used

## Integration permissions

For the Google Workspace integration to function, Cloudflare CASB requires the following Google API permissions:

- https://www.googleapis.com/auth/admin.directory.domain.readonly
- https://www.googleapis.com/auth/admin.directory.user.readonly
- https://www.googleapis.com/auth/admin.directory.user.security
- https://www.googleapis.com/auth/calendar
- https://www.googleapis.com/auth/cloud-platform.read-only
- https://www.googleapis.com/auth/drive.readonly
- https://www.googleapis.com/auth/gmail.settings.basic

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission, refer to the Google Workspace Admin SDK Directory API ‚Üó.

## Security findings

The Google Workspace integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### User account settings

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Admin user with two-factor authentication disabled | 5f7c1f62-0ac6-4422-b3d3-d0566dd4e3f2 | Critical | An administrator in Google Workspace does not have two-factor authentication enabled. |
| Google Workspace: User with two-factor authentication disabled | 739e1965-2ab4-4946-8a56-73fd75154efa | High | A user in Google Workspace does not have two-factor authentication enabled. |
| Google Workspace: Admin user with Gemini license with two-factor authentication disabled | 27a0a9a0-13c6-4d8f-a67c-b455dd213cb9 | High | An administrator with a Gemini for Google Workspace license does not have two-factor authentication enabled. |
| Google Workspace: User with Gemini license with two-factor authentication disabled | c82024dc-b836-4b86-8c90-ab07971474e4 | Medium | A user with a Gemini for Google Workspace license does not have two-factor authentication enabled. |
| Google Workspace: User without recovery email | 2e2383bb-51e8-47fc-8ba7-2dd255c2545f | Low | A user in Google Workspace does not have a recovery email set. |
| Google Workspace: User without recovery phone number | ec326c68-f331-4597-9ec4-43dc197c86f4 | Low | A user in Google Workspace does not have a recovery phone number set. |

### Inactive or suspended users

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Inactive admin user | 391ee66d-10e0-4b26-91b3-741a2a4c39d0 | Medium | An administrator account in Google Workspace has not logged in for 30 days. |
| Google Workspace: Suspended admin user | 31e02a11-aa3b-4278-97d3-9c0f7e8fd2c7 | Medium | An administrator account in Google Workspace is suspended. |
| Google Workspace: Inactive user | 7c098546-2e67-4f01-9fb7-bd48412bd178 | Low | A user account in Google Workspace has not logged in for 30 days. |
| Google Workspace: Suspended user | 84f514e3-f12d-49e5-bdfe-9073e336d89e | Low | A user account in Google Workspace is suspended. |
| Google Workspace: Admin user suspended with AI Ultra license | ee7d4ed6-479f-404f-8dbd-f82dce2a0f66 | Low | An administrator account in Google Workspace with an AI Ultra (Gemini for Workspace) license is suspended. |
| Google Workspace: User suspended with AI Ultra license | cf20e808-29ad-4026-a8f9-6ec3e069376c | Low | A user account in Google Workspace with an AI Ultra (Gemini for Workspace) license is suspended. |

### Gemini licensing

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Admin user with AI Ultra license | 62fa682a-c2b5-4d5a-a086-8e60bed804d3 | Low | An administrator in Google Workspace is assigned an AI Ultra (Gemini for Workspace) license. |
| Google Workspace: User with AI Ultra license | 5b847ed3-6c02-4963-a1ab-82a4aa2b6c64 | Low | A user in Google Workspace is assigned an AI Ultra (Gemini for Workspace) license. |

### File sharing

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: File publicly accessible with edit access | 29b01269-025f-4249-b5c1-0b9ec39823e0 | Critical | A Google Drive file is publicly accessible on the Internet that anyone can read or write. |
| Google Workspace: File publicly accessible with view access | d5132bc7-4c41-4824-b879-3918bf7f6ee7 | High | A Google Drive file is publicly accessible on the Internet that anyone can read. |
| Google Workspace: File shared outside company with edit access | 71ec135e-3d4c-4d35-a2b7-4fd1e5b65b99 | High | A Google Drive file is shared with another organization or outside party with read and write permissions. |
| Google Workspace: File shared outside company with view access | d4b231ad-9a8c-40d3-8654-5bd5bb86bf1a | Medium | A Google Drive file is shared with another organization or outside party with read permissions. |
| Google Workspace: File shared company-wide with edit access | 0ed79f27-32fd-415a-a919-ea4af3bd25fd | Medium | A Google Drive file is shared with the entire company with read and write permissions. |
| Google Workspace: File shared company-wide with view access | a34753f3-aec7-4134-a30b-2ebb1d7e47de | Medium | A Google Drive file is shared with the entire company with read permissions. |

### Calendar sharing

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Calendar is publicly accessible | ec68bf68-b0c0-47b3-ad48-fcb3d7eaf8b6 | Medium | A user's Google Calendar is publicly accessible on the Internet that anyone can read. |

### Data Loss Prevention (optional)

These findings will only appear if you added DLP profiles to your CASB integration.

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: File publicly accessible with edit access with DLP Profile match | 868a21e9-62b2-4e4a-8150-92cf9eb0c2e3 | Critical | A Google Drive file contains sensitive data that anyone on the Internet can read or write. |
| Google Workspace: File publicly accessible with view access with DLP Profile match | bfe54b22-5ee5-4ccc-b62b-ea822b34c164 | High | A Google Drive file contains sensitive data that anyone on the Internet can read. |
| Google Workspace: File shared outside company with edit access with DLP Profile match | 124cfac5-12c6-4b55-8691-9c11776b365a | High | A Google Drive file contains sensitive data that anyone the file is shared to can read. |
| Google Workspace: File shared company-wide with edit access with DLP Profile match | 5b2ad0d2-f35f-47a3-96cb-6e8fbb1fcb36 | Medium | A Google Drive file contains sensitive data that anyone in your organization can read or write. |
| Google Workspace: File shared company-wide with view access with DLP Profile match | b9fa5fef-c1d0-44da-8364-2c0887be0820 | Medium | A Google Drive file contains sensitive data that anyone in your organization can read. |
| Google Workspace: File shared outside company with view access with DLP Profile match | aebdda6d-ab48-4408-9941-881683972d83 | Medium | A Google Drive file contains sensitive data that anyone the file is shared to can read. |

### Third-party apps

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Installed 3rd-party app with Drive access | 191f0751-7087-4588-9e99-93c5dd834b5b | High | A third-party application has been granted permissions to a user's Google Drive. |
| Google Workspace: Installed 3rd-party app with Gmail access | 431aecad-20e5-4a20-80ba-4b66eaaa1be4 | High | A third-party application has been granted permissions to a user's Gmail. |
| Google Workspace: Installed 3rd-party app with Google Docs access | fe41d53b-3bc3-45ef-95d2-75ba159ce60d | Medium | A third-party application has been granted permissions to a user's Google Documents. |
| Google Workspace: Installed 3rd-party app with Google Calendar access | 80102f46-43d4-437e-b694-e8ee2c077ade | Medium | A third-party application has been granted permissions to a user's Google Calendar. |
| Google Workspace: Installed 3rd-party app with Google Slides access | d88e106c-1f2e-4b63-acae-5cee19ded9ec | Medium | A third-party application has been granted permissions to a user's Google Slides. |
| Google Workspace: Installed 3rd-party app with Google Sheets access | ece9a2fd-4248-4f11-bc45-8b4189eedb54 | Medium | A third-party application has been granted permissions to a user's Google Sheets. |
| Google Workspace: Installed 3rd-party app with Google Sign In access | 26b938ea-8d24-4ea5-8e81-2eae26830061 | Low | A user has used their Google Workspace account to sign up for a third party service. |

### Gmail administrator settings

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Domain SPF record allows any IP address | f28dcc8d-1f0c-4b5a-b254-4169095c16e5 | High | A Google Workspace Domain SPF record allows any email to be sent from any IP address on your behalf. |
| Google Workspace: Domain SPF record not present | 2e13e5dd-88ed-4d65-8d0a-d3fdff9ee7bb | Medium | An SPF record does not exist for a Google Workspace Domain. |
| Google Workspace: Domain DMARC record not present | ec39eabf-3536-4005-940b-22d815c628ec | Medium | A DMARC record does not exist for a Google Workspace Domain. |
| Google Workspace: Domain DMARC not enforced | 8971666d-c049-436d-b4d1-6816a70650ef | Medium | A DMARC record for a Google Workspace Domain is not enforced. |
| Google Workspace: Domain DMARC not enforced for subdomains | fe485f42-b158-4187-85fe-79acdd92055b | Medium | A DMARC record for a Google Workspace Subdomain is not configured to quarantine or reject messages that fail authentication. |
| Google Workspace: Domain DMARC only partially enforced | b682c603-9bc6-485e-be8c-a6e58a989407 | Medium | A DMARC record for a Google Workspace Domain is not configured to quarantine or reject messages that fail authentication. |

### Email forwarding

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: User delegates email access | 66897c22-29a5-4f55-b39a-1bfcdd3c12c5 | High | A user has delegated access to their inbox to another party. Delegates can read, send, and delete messages on the user's behalf. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Gmail

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/gmail/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/gmail/)

Page options # Gmail

The Gmail integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Google Workspace account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Google Workspace account with a Business Starter, Business Standard, Business Plus or Enterprise plan
- A Google Workspace user with Super Admin privileges ‚Üó and Owner permissions ‚Üó in the Google Cloud Platform (GCP) project used

## Integration permissions

Refer to Google Workspace integration permissions for information on which API permissions to enable.

## Security findings

The Gmail integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Gmail administrator settings

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Domain SPF record allows any IP address | f28dcc8d-1f0c-4b5a-b254-4169095c16e5 | High | A Google Workspace Domain SPF record allows any email to be sent from any IP address on your behalf. |
| Google Workspace: Domain SPF record not present | 2e13e5dd-88ed-4d65-8d0a-d3fdff9ee7bb | Medium | An SPF record does not exist for a Google Workspace Domain. |
| Google Workspace: Domain DMARC record not present | ec39eabf-3536-4005-940b-22d815c628ec | Medium | A DMARC record does not exist for a Google Workspace Domain. |
| Google Workspace: Domain DMARC not enforced | 8971666d-c049-436d-b4d1-6816a70650ef | Medium | A DMARC record for a Google Workspace Domain is not enforced. |
| Google Workspace: Domain DMARC not enforced for subdomains | fe485f42-b158-4187-85fe-79acdd92055b | Medium | A DMARC record for a Google Workspace Subdomain is not configured to quarantine or reject messages that fail authentication. |
| Google Workspace: Domain DMARC only partially enforced | b682c603-9bc6-485e-be8c-a6e58a989407 | Medium | A DMARC record for a Google Workspace Domain is not configured to quarantine or reject messages that fail authentication. |

### Email forwarding

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: User delegates email access | 66897c22-29a5-4f55-b39a-1bfcdd3c12c5 | High | A user has delegated access to their inbox to another party. Delegates can read, send, and delete messages on the user's behalf. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Admin

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/google-admin/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/google-admin/)

Page options # Google Admin

The Google Admin integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Google Workspace account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Google Workspace account with a Business Starter, Business Standard, Business Plus or Enterprise plan
- A Google Workspace user with Super Admin privileges ‚Üó and Owner permissions ‚Üó in the Google Cloud Platform (GCP) project used

## Integration permissions

Refer to Google Workspace integration permissions for information on which API permissions to enable.

## Security findings

The Google Admin integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### User account settings

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Admin user with two-factor authentication disabled | 5f7c1f62-0ac6-4422-b3d3-d0566dd4e3f2 | Critical | An administrator in Google Workspace does not have two-factor authentication enabled. |
| Google Workspace: User with two-factor authentication disabled | 739e1965-2ab4-4946-8a56-73fd75154efa | High | A user in Google Workspace does not have two-factor authentication enabled. |
| Google Workspace: Admin user with Gemini license with two-factor authentication disabled | 27a0a9a0-13c6-4d8f-a67c-b455dd213cb9 | High | An administrator with a Gemini for Google Workspace license does not have two-factor authentication enabled. |
| Google Workspace: User with Gemini license with two-factor authentication disabled | c82024dc-b836-4b86-8c90-ab07971474e4 | Medium | A user with a Gemini for Google Workspace license does not have two-factor authentication enabled. |
| Google Workspace: User without recovery email | 2e2383bb-51e8-47fc-8ba7-2dd255c2545f | Low | A user in Google Workspace does not have a recovery email set. |
| Google Workspace: User without recovery phone number | ec326c68-f331-4597-9ec4-43dc197c86f4 | Low | A user in Google Workspace does not have a recovery phone number set. |

### Inactive or suspended users

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Inactive admin user | 391ee66d-10e0-4b26-91b3-741a2a4c39d0 | Medium | An administrator account in Google Workspace has not logged in for 30 days. |
| Google Workspace: Suspended admin user | 31e02a11-aa3b-4278-97d3-9c0f7e8fd2c7 | Medium | An administrator account in Google Workspace is suspended. |
| Google Workspace: Inactive user | 7c098546-2e67-4f01-9fb7-bd48412bd178 | Low | A user account in Google Workspace has not logged in for 30 days. |
| Google Workspace: Suspended user | 84f514e3-f12d-49e5-bdfe-9073e336d89e | Low | A user account in Google Workspace is suspended. |
| Google Workspace: Admin user suspended with AI Ultra license | ee7d4ed6-479f-404f-8dbd-f82dce2a0f66 | Low | An administrator account in Google Workspace with an AI Ultra (Gemini for Workspace) license is suspended. |
| Google Workspace: User suspended with AI Ultra license | cf20e808-29ad-4026-a8f9-6ec3e069376c | Low | A user account in Google Workspace with an AI Ultra (Gemini for Workspace) license is suspended. |

### Third-party apps

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Installed 3rd-party app with Drive access | 191f0751-7087-4588-9e99-93c5dd834b5b | High | A third-party application has been granted permissions to a user's Google Drive. |
| Google Workspace: Installed 3rd-party app with Gmail access | 431aecad-20e5-4a20-80ba-4b66eaaa1be4 | High | A third-party application has been granted permissions to a user's Gmail. |
| Google Workspace: Installed 3rd-party app with Google Docs access | fe41d53b-3bc3-45ef-95d2-75ba159ce60d | Medium | A third-party application has been granted permissions to a user's Google Documents. |
| Google Workspace: Installed 3rd-party app with Google Calendar access | 80102f46-43d4-437e-b694-e8ee2c077ade | Medium | A third-party application has been granted permissions to a user's Google Calendar. |
| Google Workspace: Installed 3rd-party app with Google Slides access | d88e106c-1f2e-4b63-acae-5cee19ded9ec | Medium | A third-party application has been granted permissions to a user's Google Slides. |
| Google Workspace: Installed 3rd-party app with Google Sheets access | ece9a2fd-4248-4f11-bc45-8b4189eedb54 | Medium | A third-party application has been granted permissions to a user's Google Sheets. |
| Google Workspace: Installed 3rd-party app with Google Sign In access | 26b938ea-8d24-4ea5-8e81-2eae26830061 | Low | A user has used their Google Workspace account to sign up for a third party service. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Calendar

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/google-calendar/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/google-calendar/)

Page options # Google Calendar

The Google Calendar integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Google Workspace account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Google Workspace account with a Business Starter, Business Standard, Business Plus or Enterprise plan
- A Google Workspace user with Super Admin privileges ‚Üó and Owner permissions ‚Üó in the Google Cloud Platform (GCP) project used

## Integration permissions

Refer to Google Workspace integration permissions for information on which API permissions to enable.

## Security findings

The Google Calendar integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Calendar sharing

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Calendar is publicly accessible | ec68bf68-b0c0-47b3-ad48-fcb3d7eaf8b6 | Medium | A user's Google Calendar is publicly accessible on the Internet that anyone can read. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Drive

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/google-drive/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/google-drive/)

Page options # Google Drive

The Google Drive integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Google Workspace account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Google Workspace account with a Business Starter, Business Standard, Business Plus or Enterprise plan
- A Google Workspace user with Super Admin privileges ‚Üó and Owner permissions ‚Üó in the Google Cloud Platform (GCP) project used

## Integration permissions

Refer to Google Workspace integration permissions for information on which API permissions to enable.

## Security findings

The Google Drive integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### File sharing

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: File publicly accessible with edit access | 29b01269-025f-4249-b5c1-0b9ec39823e0 | Critical | A Google Drive file is publicly accessible on the Internet that anyone can read or write. |
| Google Workspace: File publicly accessible with view access | d5132bc7-4c41-4824-b879-3918bf7f6ee7 | High | A Google Drive file is publicly accessible on the Internet that anyone can read. |
| Google Workspace: File shared outside company with edit access | 71ec135e-3d4c-4d35-a2b7-4fd1e5b65b99 | High | A Google Drive file is shared with another organization or outside party with read and write permissions. |
| Google Workspace: File shared outside company with view access | d4b231ad-9a8c-40d3-8654-5bd5bb86bf1a | Medium | A Google Drive file is shared with another organization or outside party with read permissions. |
| Google Workspace: File shared company-wide with edit access | 0ed79f27-32fd-415a-a919-ea4af3bd25fd | Medium | A Google Drive file is shared with the entire company with read and write permissions. |
| Google Workspace: File shared company-wide with view access | a34753f3-aec7-4134-a30b-2ebb1d7e47de | Medium | A Google Drive file is shared with the entire company with read permissions. |

### Data Loss Prevention (optional)

These findings will only appear if you added DLP profiles to your CASB integration.

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: File publicly accessible with edit access with DLP Profile match | 868a21e9-62b2-4e4a-8150-92cf9eb0c2e3 | Critical | A Google Drive file contains sensitive data that anyone on the Internet can read or write. |
| Google Workspace: File publicly accessible with view access with DLP Profile match | bfe54b22-5ee5-4ccc-b62b-ea822b34c164 | High | A Google Drive file contains sensitive data that anyone on the Internet can read. |
| Google Workspace: File shared outside company with edit access with DLP Profile match | 124cfac5-12c6-4b55-8691-9c11776b365a | High | A Google Drive file contains sensitive data that anyone the file is shared to can read. |
| Google Workspace: File shared company-wide with edit access with DLP Profile match | 5b2ad0d2-f35f-47a3-96cb-6e8fbb1fcb36 | Medium | A Google Drive file contains sensitive data that anyone in your organization can read or write. |
| Google Workspace: File shared company-wide with view access with DLP Profile match | b9fa5fef-c1d0-44da-8364-2c0887be0820 | Medium | A Google Drive file contains sensitive data that anyone in your organization can read. |
| Google Workspace: File shared outside company with view access with DLP Profile match | aebdda6d-ab48-4408-9941-881683972d83 | Medium | A Google Drive file contains sensitive data that anyone the file is shared to can read. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Gmail (FedRAMP)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/gmail-fedramp/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/gmail-fedramp/)

Page options # Gmail (FedRAMP)

Availability

The Gmail (FedRAMP) CASB integration requires a special entitlement on your account. To request access, contact your account team.

The Gmail (FedRAMP) integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Google Workspace account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Google Workspace account with a Business Starter, Business Standard, Business Plus or Enterprise plan
- A Google Workspace user with Super Admin privileges ‚Üó and Owner permissions ‚Üó in the Google Cloud Platform (GCP) project used

## Integration permissions

Refer to Google Workspace integration permissions for information on which API permissions to enable.

## Security findings

The Gmail (FedRAMP) integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Gmail administrator settings

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Domain SPF record allows any IP address | f28dcc8d-1f0c-4b5a-b254-4169095c16e5 | High | A Google Workspace Domain SPF record allows any email to be sent from any IP address on your behalf. |
| Google Workspace: Domain SPF record not present | 2e13e5dd-88ed-4d65-8d0a-d3fdff9ee7bb | Medium | An SPF record does not exist for a Google Workspace Domain. |
| Google Workspace: Domain DMARC record not present | ec39eabf-3536-4005-940b-22d815c628ec | Medium | A DMARC record does not exist for a Google Workspace Domain. |
| Google Workspace: Domain DMARC not enforced | 8971666d-c049-436d-b4d1-6816a70650ef | Medium | A DMARC record for a Google Workspace Domain is not enforced. |
| Google Workspace: Domain DMARC not enforced for subdomains | fe485f42-b158-4187-85fe-79acdd92055b | Medium | A DMARC record for a Google Workspace Subdomain is not configured to quarantine or reject messages that fail authentication. |
| Google Workspace: Domain DMARC only partially enforced | b682c603-9bc6-485e-be8c-a6e58a989407 | Medium | A DMARC record for a Google Workspace Domain is not configured to quarantine or reject messages that fail authentication. |

### Email forwarding

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: User delegates email access | 66897c22-29a5-4f55-b39a-1bfcdd3c12c5 | High | A user has delegated access to their inbox to another party. Delegates can read, send, and delete messages on the user's behalf. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Admin (FedRAMP)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/google-admin-fedramp/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/google-admin-fedramp/)

Page options # Google Admin (FedRAMP)

Availability

The Google Admin (FedRAMP) CASB integration requires a special entitlement on your account. To request access, contact your account team.

The Google Admin (FedRAMP) integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Google Workspace account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Google Workspace account with a Business Starter, Business Standard, Business Plus or Enterprise plan
- A Google Workspace user with Super Admin privileges ‚Üó and Owner permissions ‚Üó in the Google Cloud Platform (GCP) project used

## Integration permissions

Refer to Google Workspace integration permissions for information on which API permissions to enable.

## Security findings

The Google Admin (FedRAMP) integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### User account settings

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Admin user with two-factor authentication disabled | 5f7c1f62-0ac6-4422-b3d3-d0566dd4e3f2 | Critical | An administrator in Google Workspace does not have two-factor authentication enabled. |
| Google Workspace: User with two-factor authentication disabled | 739e1965-2ab4-4946-8a56-73fd75154efa | High | A user in Google Workspace does not have two-factor authentication enabled. |
| Google Workspace: Admin user with Gemini license with two-factor authentication disabled | 27a0a9a0-13c6-4d8f-a67c-b455dd213cb9 | High | An administrator with a Gemini for Google Workspace license does not have two-factor authentication enabled. |
| Google Workspace: User with Gemini license with two-factor authentication disabled | c82024dc-b836-4b86-8c90-ab07971474e4 | Medium | A user with a Gemini for Google Workspace license does not have two-factor authentication enabled. |
| Google Workspace: User without recovery email | 2e2383bb-51e8-47fc-8ba7-2dd255c2545f | Low | A user in Google Workspace does not have a recovery email set. |
| Google Workspace: User without recovery phone number | ec326c68-f331-4597-9ec4-43dc197c86f4 | Low | A user in Google Workspace does not have a recovery phone number set. |

### Inactive or suspended users

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Inactive admin user | 391ee66d-10e0-4b26-91b3-741a2a4c39d0 | Medium | An administrator account in Google Workspace has not logged in for 30 days. |
| Google Workspace: Suspended admin user | 31e02a11-aa3b-4278-97d3-9c0f7e8fd2c7 | Medium | An administrator account in Google Workspace is suspended. |
| Google Workspace: Inactive user | 7c098546-2e67-4f01-9fb7-bd48412bd178 | Low | A user account in Google Workspace has not logged in for 30 days. |
| Google Workspace: Suspended user | 84f514e3-f12d-49e5-bdfe-9073e336d89e | Low | A user account in Google Workspace is suspended. |
| Google Workspace: Admin user suspended with AI Ultra license | ee7d4ed6-479f-404f-8dbd-f82dce2a0f66 | Low | An administrator account in Google Workspace with an AI Ultra (Gemini for Workspace) license is suspended. |
| Google Workspace: User suspended with AI Ultra license | cf20e808-29ad-4026-a8f9-6ec3e069376c | Low | A user account in Google Workspace with an AI Ultra (Gemini for Workspace) license is suspended. |

### Third-party apps

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Installed 3rd-party app with Drive access | 191f0751-7087-4588-9e99-93c5dd834b5b | High | A third-party application has been granted permissions to a user's Google Drive. |
| Google Workspace: Installed 3rd-party app with Gmail access | 431aecad-20e5-4a20-80ba-4b66eaaa1be4 | High | A third-party application has been granted permissions to a user's Gmail. |
| Google Workspace: Installed 3rd-party app with Google Docs access | fe41d53b-3bc3-45ef-95d2-75ba159ce60d | Medium | A third-party application has been granted permissions to a user's Google Documents. |
| Google Workspace: Installed 3rd-party app with Google Calendar access | 80102f46-43d4-437e-b694-e8ee2c077ade | Medium | A third-party application has been granted permissions to a user's Google Calendar. |
| Google Workspace: Installed 3rd-party app with Google Slides access | d88e106c-1f2e-4b63-acae-5cee19ded9ec | Medium | A third-party application has been granted permissions to a user's Google Slides. |
| Google Workspace: Installed 3rd-party app with Google Sheets access | ece9a2fd-4248-4f11-bc45-8b4189eedb54 | Medium | A third-party application has been granted permissions to a user's Google Sheets. |
| Google Workspace: Installed 3rd-party app with Google Sign In access | 26b938ea-8d24-4ea5-8e81-2eae26830061 | Low | A user has used their Google Workspace account to sign up for a third party service. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Calendar (FedRAMP)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/google-calendar-fedramp/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/google-calendar-fedramp/)

Page options # Google Calendar (FedRAMP)

Availability

The Google Calendar (FedRAMP) CASB integration requires a special entitlement on your account. To request access, contact your account team.

The Google Calendar (FedRAMP) integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Google Workspace account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Google Workspace account with a Business Starter, Business Standard, Business Plus or Enterprise plan
- A Google Workspace user with Super Admin privileges ‚Üó and Owner permissions ‚Üó in the Google Cloud Platform (GCP) project used

## Integration permissions

Refer to Google Workspace integration permissions for information on which API permissions to enable.

## Security findings

The Google Calendar (FedRAMP) integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Calendar sharing

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Calendar is publicly accessible | ec68bf68-b0c0-47b3-ad48-fcb3d7eaf8b6 | Medium | A user's Google Calendar is publicly accessible on the Internet that anyone can read. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Drive (FedRAMP)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/google-drive-fedramp/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/google-drive-fedramp/)

Page options # Google Drive (FedRAMP)

Availability

The Google Drive (FedRAMP) CASB integration requires a special entitlement on your account. To request access, contact your account team.

The Google Drive (FedRAMP) integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Google Workspace account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Google Workspace account with a Business Starter, Business Standard, Business Plus or Enterprise plan
- A Google Workspace user with Super Admin privileges ‚Üó and Owner permissions ‚Üó in the Google Cloud Platform (GCP) project used

## Integration permissions

Refer to Google Workspace integration permissions for information on which API permissions to enable.

## Security findings

The Google Drive (FedRAMP) integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### File sharing

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: File publicly accessible with edit access | 29b01269-025f-4249-b5c1-0b9ec39823e0 | Critical | A Google Drive file is publicly accessible on the Internet that anyone can read or write. |
| Google Workspace: File publicly accessible with view access | d5132bc7-4c41-4824-b879-3918bf7f6ee7 | High | A Google Drive file is publicly accessible on the Internet that anyone can read. |
| Google Workspace: File shared outside company with edit access | 71ec135e-3d4c-4d35-a2b7-4fd1e5b65b99 | High | A Google Drive file is shared with another organization or outside party with read and write permissions. |
| Google Workspace: File shared outside company with view access | d4b231ad-9a8c-40d3-8654-5bd5bb86bf1a | Medium | A Google Drive file is shared with another organization or outside party with read permissions. |
| Google Workspace: File shared company-wide with edit access | 0ed79f27-32fd-415a-a919-ea4af3bd25fd | Medium | A Google Drive file is shared with the entire company with read and write permissions. |
| Google Workspace: File shared company-wide with view access | a34753f3-aec7-4134-a30b-2ebb1d7e47de | Medium | A Google Drive file is shared with the entire company with read permissions. |

### Data Loss Prevention (optional)

These findings will only appear if you added DLP profiles to your CASB integration.

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: File publicly accessible with edit access with DLP Profile match | 868a21e9-62b2-4e4a-8150-92cf9eb0c2e3 | Critical | A Google Drive file contains sensitive data that anyone on the Internet can read or write. |
| Google Workspace: File publicly accessible with view access with DLP Profile match | bfe54b22-5ee5-4ccc-b62b-ea822b34c164 | High | A Google Drive file contains sensitive data that anyone on the Internet can read. |
| Google Workspace: File shared outside company with edit access with DLP Profile match | 124cfac5-12c6-4b55-8691-9c11776b365a | High | A Google Drive file contains sensitive data that anyone the file is shared to can read. |
| Google Workspace: File shared company-wide with edit access with DLP Profile match | 5b2ad0d2-f35f-47a3-96cb-6e8fbb1fcb36 | Medium | A Google Drive file contains sensitive data that anyone in your organization can read or write. |
| Google Workspace: File shared company-wide with view access with DLP Profile match | b9fa5fef-c1d0-44da-8364-2c0887be0820 | Medium | A Google Drive file contains sensitive data that anyone in your organization can read. |
| Google Workspace: File shared outside company with view access with DLP Profile match | aebdda6d-ab48-4408-9941-881683972d83 | Medium | A Google Drive file contains sensitive data that anyone the file is shared to can read. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Gemini for Google Workspace

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/gemini/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/google-workspace/gemini/)

Page options # Gemini for Google Workspace

The Gemini for Google Workspace integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Google Workspace account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Google Workspace account with a Business Starter, Business Standard, Business Plus or Enterprise plan
- A Google Workspace user with Super Admin privileges ‚Üó and Owner permissions ‚Üó in the Google Cloud Platform (GCP) project used

## Integration permissions

Refer to Google Workspace integration permissions for information on which API permissions to enable.

## Security findings

The Gemini for Google Workspace integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### User account settings

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Admin user with Gemini license with two-factor authentication disabled | 27a0a9a0-13c6-4d8f-a67c-b455dd213cb9 | High | An administrator with a Gemini for Google Workspace license does not have two-factor authentication enabled. |
| Google Workspace: User with Gemini license with two-factor authentication disabled | c82024dc-b836-4b86-8c90-ab07971474e4 | Medium | A user with a Gemini for Google Workspace license does not have two-factor authentication enabled. |

### Inactive or suspended users

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Admin user suspended with AI Ultra license | ee7d4ed6-479f-404f-8dbd-f82dce2a0f66 | Low | An administrator account with an AI Ultra (Gemini for Workspace) license is suspended. |
| Google Workspace: User suspended with AI Ultra license | cf20e808-29ad-4026-a8f9-6ec3e069376c | Low | A user account with an AI Ultra (Gemini for Workspace) license is suspended. |

### Gemini licensing

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Google Workspace: Admin user with AI Ultra license | 62fa682a-c2b5-4d5a-a086-8e60bed804d3 | Low | An administrator in Google Workspace is assigned an AI Ultra (Gemini for Workspace) license. |
| Google Workspace: User with AI Ultra license | 5b847ed3-6c02-4963-a1ab-82a4aa2b6c64 | Low | A user in Google Workspace is assigned an AI Ultra (Gemini for Workspace) license. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Microsoft 365

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/)

Page options # Microsoft 365

The Microsoft 365 (M365) integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Microsoft 365 account that could leave you and your organization vulnerable.

This integration covers the following Microsoft 365 products:

- Admin Center
- OneDrive
- Outlook
- SharePoint
- Admin Center (FedRAMP)
- OneDrive (FedRAMP)
- Outlook (FedRAMP)
- SharePoint (FedRAMP)

## Integration prerequisites

- A Microsoft 365 account with an active Microsoft Business Basic, Microsoft Business Standard, Microsoft 365 E3, Microsoft 365 E5, or Microsoft 365 F3 subscription
- Global admin role ‚Üó or equivalent permissions in Microsoft 365

## Integration permissions

For the Microsoft 365 integration to function, Cloudflare CASB requires the following delegated Microsoft Graph API permissions:

- Application.Read.All
- Calendars.Read
- Domain.Read.All
- Group.Read.All
- InformationProtectionPolicy.Read.All
- MailboxSettings.Read
- offline_access
- RoleManagement.Read.All
- User.Read.All
- UserAuthenticationMethod.Read.All
- Files.Read.All
- AuditLog.Read.All

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted.

Additionally, to remediate findings, CASB requires the following permissions:

- Application.ReadWrite.All
- AuditLog.Read.All
- Calendars.ReadWrite
- Domain.ReadWrite.All
- Files.ReadWrite.All
- Group.ReadWrite.All
- InformationProtectionPolicy.Read.All
- MailboxSettings.ReadWrite
- IdentityRiskyUser.ReadWrite.All
- RoleManagement.ReadWrite.Directory
- User.ReadWrite.All
- UserAuthenticationMethod.ReadWrite.All
- Directory.ReadWrite.All
- GroupMember.ReadWrite.All
- Organization.ReadWrite.All
- Mail.ReadWrite

To learn more about each permission, refer to the Microsoft Graph permissions documentation ‚Üó.

## Security findings

The Microsoft 365 integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### User account settings

Keep user accounts safe by ensuring the following settings are maintained. Review password configurations and password strengths to ensure alignment to your organization's security policies and best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: FIDO2 authentication method unattested | 5a9fd288-c04f-4f7a-8976-bfd5464c6cf1 | Low |
| Microsoft: Provisioning error for on-prem user | 3123d99e-a83c-4d9d-9a10-80da5af6dee5 | Low |
| Microsoft: Password expiration disabled for user | ce8cc363-7cbb-445e-8385-79ae7348e430 | Low |
| Microsoft: Password not changed for 90+ days | 93be1fd1-b6c6-4b98-a04c-121d5ea66745 | Low |
| Microsoft: Strong password disabled for user | aecfdcb2-ec1f-4571-be3c-4ae46c93125e | Low |
| Microsoft: Cloud sync disabled for on-prem user | 8370628b-73f1-41a5-bbff-4d5adee7bf33 | Low |
| Microsoft: Weak Windows Hello for Business key strength | 6fae390f-07a3-4577-9821-034a7b29e18e | Low |
| Microsoft: On-prem user not synced in 7+ days | 1eefc5a1-e665-431a-b939-cfbb76a309f5 | Low |
| Microsoft: User is not a legal adult | 329030a3-db43-4959-9d92-2616a42f1731 | Low |
| Microsoft: User configured proxy addresses | 61406f68-feea-43c5-bda8-b7c4ef9b83cf | Low |
| Microsoft: User account disabled | 0a8bd094-9138-4e7f-8ce8-bebdf5c27c4e | Low |
| Microsoft: Reusable temporary access pass | 98571e6b-c323-48bc-8c60-f0425c7f9342 | Low |
| Microsoft: Long-lived temporary access pass | 45cdbd9c-1594-488b-973e-7c62c6e7234e | Low |

### File sharing

Get alerted when files in your Microsoft 365 account have their permissions changed to a less secure setting. Additionally, you can automatically remediate certain finding types directly from CASB. For more information, refer to Remediate findings.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: File publicly accessible with edit access | 85241e6b-205f-4de6-a1d1-325656130995 | Critical |
| Microsoft: Folder publicly accessible with edit access | c9662c5c-c3d6-453b-9367-281e024f7e7a | Critical |
| Microsoft: File publicly accessible with view access | a2b40dc9-b96a-4ace-b8f8-739c2be37dbd | High |
| Microsoft: Folder publicly accessible with view access | 7c673785-8b70-41bc-b7d4-d0f346487ff6 | High |
| Microsoft: File shared company-wide with edit access | a81a79c8-a0bf-4c60-aa46-7547b4d34266 | Medium |
| Microsoft: File shared company-wide with view access | 364c9c0e-684b-4a83-bf28-fdbb1430bb59 | Medium |
| Microsoft: Folder shared company-wide with edit access | 80f73d47-7dcf-4997-8ed3-6564c8388bd1 | Medium |
| Microsoft: Folder shared company-wide with view access | f3fc8ae6-815e-4d5f-a57e-b00d5413f98c | Medium |

To access some file findings, you may need to review shared links. For more information, refer to View shared files.

### Data Loss Prevention (optional)

These findings will only appear if you added DLP profiles to your CASB integration.

Additionally, you can automatically remediate certain finding types directly from CASB. For more information, refer to Remediate findings.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: File publicly accessible with edit access with DLP Profile match | 7b6ecb52-852f-4184-bf19-175fe59202b7 | Critical |
| Microsoft: File publicly accessible with view access with DLP Profile match | 8150f237-576d-4b48-8839-0c257f612171 | High |
| Microsoft: File shared company-wide with edit access with DLP Profile match | f838ec6b-7d7a-4c1c-9c61-958ac24c27fa | Medium |
| Microsoft: File shared company-wide with view access with DLP Profile match | 0b882cf3-7e33-4c58-b425-0202206a2c10 | Medium |

### Third-party apps

Identify and get alerted about the third-party apps that have access to at least one service in your Microsoft 365 domain. Additionally, receive information about which services are being accessed and by whom to get full visibility into shadow IT.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: App not certified by Microsoft | 3f049bb1-3709-4d8f-8591-59dd034cf396 | Low |
| Microsoft: App not attested by publisher | d7390d6b-f466-4293-8528-6218e29b1179 | Low |
| Microsoft: App disabled by Microsoft | b5156b76-caaa-4ca8-bdb7-ea282da62356 | Low |

### Calendar sharing

Get alerted when calendars in your Microsoft 365 account have their permissions changed to a less secure setting.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: Calendar shared externally | 7d2d9b00-3871-4abf-9e65-f29cf00c428b | Low |

### Email administrator settings

Discover suspicious or insecure email configurations in your Microsoft domain. Missing SPF and DMARC records make it easier for bad actors to spoof email, while SPF records configured to another domain can be a potential warning sign of malicious activity.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: Domain SPF record allows any IP address | 27893e48-663e-43f9-83d4-c158c50259d0 | High |
| Microsoft: Domain SPF record not present | 009093d9-43df-45a2-bdc6-2f35fc3a0c71 | Medium |
| Microsoft: Domain DMARC record not present | bb3d3760-2c4e-4161-9164-cff92e809f9c | Medium |
| Microsoft: Domain DMARC not enforced | a020d87d-332b-49d1-acc3-16c19d72fba4 | Medium |
| Microsoft: Domain DMARC not enforced for subdomains | 1837a549-4d4e-4101-917c-e9a4036e0c08 | Medium |
| Microsoft: Domain DMARC only partially enforced | 943414ed-7c79-4d17-a253-8d73f34dcc1d | Medium |
| Microsoft: Domain not verified | dd1e9aba-57ee-4cf1-a895-dd2f1fc166a7 | Medium |
| Microsoft: App certification expires within 90 Days | d5ede282-0339-4983-88f3-849ac59ba840 | Low |

### Email forwarding

Get alerted when users set their email to be forwarded externally. This can either be a sign of unauthorized activity, or an employee unknowingly sending potentially sensitive information to a personal email.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: Active message rule forwards externally as attachment | 9efca21a-aba2-452f-bb17-e66d34b58765 | Low |
| Microsoft: Active message rule forwards externally | 42fa3fe6-da72-4bf0-9bc9-5faa4a118ec4 | Low |
| Microsoft: Active message rule redirects externally | b75ba81e-c98d-4b78-b5a1-47a2f54499e8 | Low |

## Microsoft Information Protection (MIP) sensitivity labels

Note

Requires Cloudflare DLP.

Microsoft provides MIP sensitivity labels ‚Üó to classify and protect sensitive data. When you add the CASB Microsoft 365 integration, Cloudflare will automatically retrieve the labels from your Microsoft account and populate them in a DLP Profile.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Admin Center

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/admin-center/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/admin-center/)

Page options # Admin Center

The Admin Center integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Microsoft 365 account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Microsoft 365 account with an active Microsoft Business Basic, Microsoft Business Standard, Microsoft 365 E3, Microsoft 365 E5, or Microsoft 365 F3 subscription
- Global admin role ‚Üó or equivalent permissions in Microsoft 365

## Integration permissions

Refer to Microsoft 365 integration permissions for information on which API permissions to enable.

## Security findings

The Admin Center integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### User account settings

Keep user accounts safe by ensuring the following settings are maintained. Review password configurations and password strengths to ensure alignment to your organization's security policies and best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: FIDO2 authentication method unattested | 5a9fd288-c04f-4f7a-8976-bfd5464c6cf1 | Low |
| Microsoft: Provisioning error for on-prem user | 3123d99e-a83c-4d9d-9a10-80da5af6dee5 | Low |
| Microsoft: Password expiration disabled for user | ce8cc363-7cbb-445e-8385-79ae7348e430 | Low |
| Microsoft: Password not changed for 90+ days | 93be1fd1-b6c6-4b98-a04c-121d5ea66745 | Low |
| Microsoft: Strong password disabled for user | aecfdcb2-ec1f-4571-be3c-4ae46c93125e | Low |
| Microsoft: Cloud sync disabled for on-prem user | 8370628b-73f1-41a5-bbff-4d5adee7bf33 | Low |
| Microsoft: Weak Windows Hello for Business key strength | 6fae390f-07a3-4577-9821-034a7b29e18e | Low |
| Microsoft: On-prem user not synced in 7+ days | 1eefc5a1-e665-431a-b939-cfbb76a309f5 | Low |
| Microsoft: User is not a legal adult | 329030a3-db43-4959-9d92-2616a42f1731 | Low |
| Microsoft: User configured proxy addresses | 61406f68-feea-43c5-bda8-b7c4ef9b83cf | Low |
| Microsoft: User account disabled | 0a8bd094-9138-4e7f-8ce8-bebdf5c27c4e | Low |
| Microsoft: Reusable temporary access pass | 98571e6b-c323-48bc-8c60-f0425c7f9342 | Low |
| Microsoft: Long-lived temporary access pass | 45cdbd9c-1594-488b-973e-7c62c6e7234e | Low |

### Third-party apps

Identify and get alerted about the third-party apps that have access to at least one service in your Microsoft 365 domain. Additionally, receive information about which services are being accessed and by whom to get full visibility into shadow IT.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: App not certified by Microsoft | 3f049bb1-3709-4d8f-8591-59dd034cf396 | Low |
| Microsoft: App not attested by publisher | d7390d6b-f466-4293-8528-6218e29b1179 | Low |
| Microsoft: App disabled by Microsoft | b5156b76-caaa-4ca8-bdb7-ea282da62356 | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## OneDrive

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/onedrive/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/onedrive/)

Page options # OneDrive

The OneDrive integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Microsoft 365 account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Microsoft 365 account with an active Microsoft Business Basic, Microsoft Business Standard, Microsoft 365 E3, Microsoft 365 E5, or Microsoft 365 F3 subscription
- Global admin role ‚Üó or equivalent permissions in Microsoft 365

## Integration permissions

Refer to Microsoft 365 integration permissions for information on which API permissions to enable.

## Security findings

The OneDrive integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### File sharing

Get alerted when files in your Microsoft 365 account have their permissions changed to a less secure setting. Additionally, you can automatically remediate certain finding types directly from CASB. For more information, refer to Remediate findings.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: File publicly accessible with edit access | 85241e6b-205f-4de6-a1d1-325656130995 | Critical |
| Microsoft: Folder publicly accessible with edit access | c9662c5c-c3d6-453b-9367-281e024f7e7a | Critical |
| Microsoft: File publicly accessible with view access | a2b40dc9-b96a-4ace-b8f8-739c2be37dbd | High |
| Microsoft: Folder publicly accessible with view access | 7c673785-8b70-41bc-b7d4-d0f346487ff6 | High |
| Microsoft: File shared company-wide with edit access | a81a79c8-a0bf-4c60-aa46-7547b4d34266 | Medium |
| Microsoft: File shared company-wide with view access | 364c9c0e-684b-4a83-bf28-fdbb1430bb59 | Medium |
| Microsoft: Folder shared company-wide with edit access | 80f73d47-7dcf-4997-8ed3-6564c8388bd1 | Medium |
| Microsoft: Folder shared company-wide with view access | f3fc8ae6-815e-4d5f-a57e-b00d5413f98c | Medium |

### Data Loss Prevention (optional)

These findings will only appear if you added DLP profiles to your CASB integration.

Additionally, you can automatically remediate certain finding types directly from CASB. For more information, refer to Remediate findings.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: File publicly accessible with edit access with DLP Profile match | 7b6ecb52-852f-4184-bf19-175fe59202b7 | Critical |
| Microsoft: File publicly accessible with view access with DLP Profile match | 8150f237-576d-4b48-8839-0c257f612171 | High |
| Microsoft: File shared company-wide with edit access with DLP Profile match | f838ec6b-7d7a-4c1c-9c61-958ac24c27fa | Medium |
| Microsoft: File shared company-wide with view access with DLP Profile match | 0b882cf3-7e33-4c58-b425-0202206a2c10 | Medium |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Outlook

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/outlook/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/outlook/)

Page options # Outlook

The Outlook integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Microsoft 365 account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Microsoft 365 account with an active Microsoft Business Basic, Microsoft Business Standard, Microsoft 365 E3, Microsoft 365 E5, or Microsoft 365 F3 subscription
- Global admin role ‚Üó or equivalent permissions in Microsoft 365

## Integration permissions

Refer to Microsoft 365 integration permissions for information on which API permissions to enable.

## Security findings

The Outlook integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Calendar sharing

Get alerted when calendars in your Microsoft 365 account have their permissions changed to a less secure setting.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: Calendar shared externally | 7d2d9b00-3871-4abf-9e65-f29cf00c428b | Low |

### Email administrator settings

Discover suspicious or insecure email configurations in your Microsoft domain. Missing SPF and DMARC records make it easier for bad actors to spoof email, while SPF records configured to another domain can be a potential warning sign of malicious activity.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: Domain SPF record allows any IP address | 27893e48-663e-43f9-83d4-c158c50259d0 | High |
| Microsoft: Domain SPF record not present | 009093d9-43df-45a2-bdc6-2f35fc3a0c71 | Medium |
| Microsoft: Domain DMARC record not present | bb3d3760-2c4e-4161-9164-cff92e809f9c | Medium |
| Microsoft: Domain DMARC not enforced | a020d87d-332b-49d1-acc3-16c19d72fba4 | Medium |
| Microsoft: Domain DMARC not enforced for subdomains | 1837a549-4d4e-4101-917c-e9a4036e0c08 | Medium |
| Microsoft: Domain DMARC only partially enforced | 943414ed-7c79-4d17-a253-8d73f34dcc1d | Medium |
| Microsoft: Domain not verified | dd1e9aba-57ee-4cf1-a895-dd2f1fc166a7 | Medium |
| Microsoft: App certification expires within 90 Days | d5ede282-0339-4983-88f3-849ac59ba840 | Low |

### Email forwarding

Get alerted when users set their email to be forwarded externally. This can either be a sign of unauthorized activity, or an employee unknowingly sending potentially sensitive information to a personal email.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: Active message rule forwards externally as attachment | 9efca21a-aba2-452f-bb17-e66d34b58765 | Low |
| Microsoft: Active message rule forwards externally | 42fa3fe6-da72-4bf0-9bc9-5faa4a118ec4 | Low |
| Microsoft: Active message rule redirects externally | b75ba81e-c98d-4b78-b5a1-47a2f54499e8 | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SharePoint

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/sharepoint/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/sharepoint/)

Page options # SharePoint

The SharePoint integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Microsoft 365 account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Microsoft 365 account with an active Microsoft Business Basic, Microsoft Business Standard, Microsoft 365 E3, Microsoft 365 E5, or Microsoft 365 F3 subscription
- Global admin role ‚Üó or equivalent permissions in Microsoft 365

## Integration permissions

Refer to Microsoft 365 integration permissions for information on which API permissions to enable.

## Security findings

The SharePoint integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### File sharing

Get alerted when files in your Microsoft 365 account have their permissions changed to a less secure setting. Additionally, you can automatically remediate certain finding types directly from CASB. For more information, refer to Remediate findings.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: File publicly accessible with edit access | 85241e6b-205f-4de6-a1d1-325656130995 | Critical |
| Microsoft: Folder publicly accessible with edit access | c9662c5c-c3d6-453b-9367-281e024f7e7a | Critical |
| Microsoft: File publicly accessible with view access | a2b40dc9-b96a-4ace-b8f8-739c2be37dbd | High |
| Microsoft: Folder publicly accessible with view access | 7c673785-8b70-41bc-b7d4-d0f346487ff6 | High |
| Microsoft: File shared company-wide with edit access | a81a79c8-a0bf-4c60-aa46-7547b4d34266 | Medium |
| Microsoft: File shared company-wide with view access | 364c9c0e-684b-4a83-bf28-fdbb1430bb59 | Medium |
| Microsoft: Folder shared company-wide with edit access | 80f73d47-7dcf-4997-8ed3-6564c8388bd1 | Medium |
| Microsoft: Folder shared company-wide with view access | f3fc8ae6-815e-4d5f-a57e-b00d5413f98c | Medium |

### Data Loss Prevention (optional)

These findings will only appear if you added DLP profiles to your CASB integration.

Additionally, you can automatically remediate certain finding types directly from CASB. For more information, refer to Remediate findings.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: File publicly accessible with edit access with DLP Profile match | 7b6ecb52-852f-4184-bf19-175fe59202b7 | Critical |
| Microsoft: File publicly accessible with view access with DLP Profile match | 8150f237-576d-4b48-8839-0c257f612171 | High |
| Microsoft: File shared company-wide with edit access with DLP Profile match | f838ec6b-7d7a-4c1c-9c61-958ac24c27fa | Medium |
| Microsoft: File shared company-wide with view access with DLP Profile match | 0b882cf3-7e33-4c58-b425-0202206a2c10 | Medium |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Admin Center (FedRAMP)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/admin-center-fedramp/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/admin-center-fedramp/)

Page options # Admin Center (FedRAMP)

Availability

The Admin Center (FedRAMP) CASB integration requires a special entitlement on your account. To request access, contact your account team.

The Admin Center (FedRAMP) integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Microsoft 365 account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Microsoft 365 account with an active Microsoft Business Basic, Microsoft Business Standard, Microsoft 365 E3, Microsoft 365 E5, or Microsoft 365 F3 subscription
- Global admin role ‚Üó or equivalent permissions in Microsoft 365

## Integration permissions

Refer to Microsoft 365 integration permissions for information on which API permissions to enable.

## Security findings

The Admin Center (FedRAMP) integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### User account settings

Keep user accounts safe by ensuring the following settings are maintained. Review password configurations and password strengths to ensure alignment to your organization's security policies and best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: FIDO2 authentication method unattested | 5a9fd288-c04f-4f7a-8976-bfd5464c6cf1 | Low |
| Microsoft: Provisioning error for on-prem user | 3123d99e-a83c-4d9d-9a10-80da5af6dee5 | Low |
| Microsoft: Password expiration disabled for user | ce8cc363-7cbb-445e-8385-79ae7348e430 | Low |
| Microsoft: Password not changed for 90+ days | 93be1fd1-b6c6-4b98-a04c-121d5ea66745 | Low |
| Microsoft: Strong password disabled for user | aecfdcb2-ec1f-4571-be3c-4ae46c93125e | Low |
| Microsoft: Cloud sync disabled for on-prem user | 8370628b-73f1-41a5-bbff-4d5adee7bf33 | Low |
| Microsoft: Weak Windows Hello for Business key strength | 6fae390f-07a3-4577-9821-034a7b29e18e | Low |
| Microsoft: On-prem user not synced in 7+ days | 1eefc5a1-e665-431a-b939-cfbb76a309f5 | Low |
| Microsoft: User is not a legal adult | 329030a3-db43-4959-9d92-2616a42f1731 | Low |
| Microsoft: User configured proxy addresses | 61406f68-feea-43c5-bda8-b7c4ef9b83cf | Low |
| Microsoft: User account disabled | 0a8bd094-9138-4e7f-8ce8-bebdf5c27c4e | Low |
| Microsoft: Reusable temporary access pass | 98571e6b-c323-48bc-8c60-f0425c7f9342 | Low |
| Microsoft: Long-lived temporary access pass | 45cdbd9c-1594-488b-973e-7c62c6e7234e | Low |

### Third-party apps

Identify and get alerted about the third-party apps that have access to at least one service in your Microsoft 365 domain. Additionally, receive information about which services are being accessed and by whom to get full visibility into shadow IT.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: App not certified by Microsoft | 3f049bb1-3709-4d8f-8591-59dd034cf396 | Low |
| Microsoft: App not attested by publisher | d7390d6b-f466-4293-8528-6218e29b1179 | Low |
| Microsoft: App disabled by Microsoft | b5156b76-caaa-4ca8-bdb7-ea282da62356 | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## OneDrive (FedRAMP)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/onedrive-fedramp/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/onedrive-fedramp/)

Page options # OneDrive (FedRAMP)

Availability

The OneDrive (FedRAMP) CASB integration requires a special entitlement on your account. To request access, contact your account team.

The OneDrive (FedRAMP) integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Microsoft 365 account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Microsoft 365 account with an active Microsoft Business Basic, Microsoft Business Standard, Microsoft 365 E3, Microsoft 365 E5, or Microsoft 365 F3 subscription
- Global admin role ‚Üó or equivalent permissions in Microsoft 365

## Integration permissions

Refer to Microsoft 365 integration permissions for information on which API permissions to enable.

## Security findings

The OneDrive (FedRAMP) integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### File sharing

Get alerted when files in your Microsoft 365 account have their permissions changed to a less secure setting. Additionally, you can automatically remediate certain finding types directly from CASB. For more information, refer to Remediate findings.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: File publicly accessible with edit access | 85241e6b-205f-4de6-a1d1-325656130995 | Critical |
| Microsoft: Folder publicly accessible with edit access | c9662c5c-c3d6-453b-9367-281e024f7e7a | Critical |
| Microsoft: File publicly accessible with view access | a2b40dc9-b96a-4ace-b8f8-739c2be37dbd | High |
| Microsoft: Folder publicly accessible with view access | 7c673785-8b70-41bc-b7d4-d0f346487ff6 | High |
| Microsoft: File shared company-wide with edit access | a81a79c8-a0bf-4c60-aa46-7547b4d34266 | Medium |
| Microsoft: File shared company-wide with view access | 364c9c0e-684b-4a83-bf28-fdbb1430bb59 | Medium |
| Microsoft: Folder shared company-wide with edit access | 80f73d47-7dcf-4997-8ed3-6564c8388bd1 | Medium |
| Microsoft: Folder shared company-wide with view access | f3fc8ae6-815e-4d5f-a57e-b00d5413f98c | Medium |

### Data Loss Prevention (optional)

These findings will only appear if you added DLP profiles to your CASB integration.

Additionally, you can automatically remediate certain finding types directly from CASB. For more information, refer to Remediate findings.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: File publicly accessible with edit access with DLP Profile match | 7b6ecb52-852f-4184-bf19-175fe59202b7 | Critical |
| Microsoft: File publicly accessible with view access with DLP Profile match | 8150f237-576d-4b48-8839-0c257f612171 | High |
| Microsoft: File shared company-wide with edit access with DLP Profile match | f838ec6b-7d7a-4c1c-9c61-958ac24c27fa | Medium |
| Microsoft: File shared company-wide with view access with DLP Profile match | 0b882cf3-7e33-4c58-b425-0202206a2c10 | Medium |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Outlook (FedRAMP)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/outlook-fedramp/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/outlook-fedramp/)

Page options # Outlook (FedRAMP)

Availability

The Outlook (FedRAMP) CASB integration requires a special entitlement on your account. To request access, contact your account team.

The Outlook (FedRAMP) integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Microsoft 365 account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Microsoft 365 account with an active Microsoft Business Basic, Microsoft Business Standard, Microsoft 365 E3, Microsoft 365 E5, or Microsoft 365 F3 subscription
- Global admin role ‚Üó or equivalent permissions in Microsoft 365

## Integration permissions

Refer to Microsoft 365 integration permissions for information on which API permissions to enable.

## Security findings

The Outlook (FedRAMP) integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Calendar sharing

Get alerted when calendars in your Microsoft 365 account have their permissions changed to a less secure setting.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: Calendar shared externally | 7d2d9b00-3871-4abf-9e65-f29cf00c428b | Low |

### Email administrator settings

Discover suspicious or insecure email configurations in your Microsoft domain. Missing SPF and DMARC records make it easier for bad actors to spoof email, while SPF records configured to another domain can be a potential warning sign of malicious activity.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: Domain SPF record allows any IP address | 27893e48-663e-43f9-83d4-c158c50259d0 | High |
| Microsoft: Domain SPF record not present | 009093d9-43df-45a2-bdc6-2f35fc3a0c71 | Medium |
| Microsoft: Domain DMARC record not present | bb3d3760-2c4e-4161-9164-cff92e809f9c | Medium |
| Microsoft: Domain DMARC not enforced | a020d87d-332b-49d1-acc3-16c19d72fba4 | Medium |
| Microsoft: Domain DMARC not enforced for subdomains | 1837a549-4d4e-4101-917c-e9a4036e0c08 | Medium |
| Microsoft: Domain DMARC only partially enforced | 943414ed-7c79-4d17-a253-8d73f34dcc1d | Medium |
| Microsoft: Domain not verified | dd1e9aba-57ee-4cf1-a895-dd2f1fc166a7 | Medium |
| Microsoft: App certification expires within 90 Days | d5ede282-0339-4983-88f3-849ac59ba840 | Low |

### Email forwarding

Get alerted when users set their email to be forwarded externally. This can either be a sign of unauthorized activity, or an employee unknowingly sending potentially sensitive information to a personal email.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: Active message rule forwards externally as attachment | 9efca21a-aba2-452f-bb17-e66d34b58765 | Low |
| Microsoft: Active message rule forwards externally | 42fa3fe6-da72-4bf0-9bc9-5faa4a118ec4 | Low |
| Microsoft: Active message rule redirects externally | b75ba81e-c98d-4b78-b5a1-47a2f54499e8 | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SharePoint (FedRAMP)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/sharepoint-fedramp/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/microsoft-365/sharepoint-fedramp/)

Page options # SharePoint (FedRAMP)

Availability

The SharePoint (FedRAMP) CASB integration requires a special entitlement on your account. To request access, contact your account team.

The SharePoint (FedRAMP) integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Microsoft 365 account that could leave you and your organization vulnerable.

## Integration prerequisites

- A Microsoft 365 account with an active Microsoft Business Basic, Microsoft Business Standard, Microsoft 365 E3, Microsoft 365 E5, or Microsoft 365 F3 subscription
- Global admin role ‚Üó or equivalent permissions in Microsoft 365

## Integration permissions

Refer to Microsoft 365 integration permissions for information on which API permissions to enable.

## Security findings

The SharePoint (FedRAMP) integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### File sharing

Get alerted when files in your Microsoft 365 account have their permissions changed to a less secure setting. Additionally, you can automatically remediate certain finding types directly from CASB. For more information, refer to Remediate findings.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: File publicly accessible with edit access | 85241e6b-205f-4de6-a1d1-325656130995 | Critical |
| Microsoft: Folder publicly accessible with edit access | c9662c5c-c3d6-453b-9367-281e024f7e7a | Critical |
| Microsoft: File publicly accessible with view access | a2b40dc9-b96a-4ace-b8f8-739c2be37dbd | High |
| Microsoft: Folder publicly accessible with view access | 7c673785-8b70-41bc-b7d4-d0f346487ff6 | High |
| Microsoft: File shared company-wide with edit access | a81a79c8-a0bf-4c60-aa46-7547b4d34266 | Medium |
| Microsoft: File shared company-wide with view access | 364c9c0e-684b-4a83-bf28-fdbb1430bb59 | Medium |
| Microsoft: Folder shared company-wide with edit access | 80f73d47-7dcf-4997-8ed3-6564c8388bd1 | Medium |
| Microsoft: Folder shared company-wide with view access | f3fc8ae6-815e-4d5f-a57e-b00d5413f98c | Medium |

### Data Loss Prevention (optional)

These findings will only appear if you added DLP profiles to your CASB integration.

Additionally, you can automatically remediate certain finding types directly from CASB. For more information, refer to Remediate findings.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Microsoft: File publicly accessible with edit access with DLP Profile match | 7b6ecb52-852f-4184-bf19-175fe59202b7 | Critical |
| Microsoft: File publicly accessible with view access with DLP Profile match | 8150f237-576d-4b48-8839-0c257f612171 | High |
| Microsoft: File shared company-wide with edit access with DLP Profile match | f838ec6b-7d7a-4c1c-9c61-958ac24c27fa | Medium |
| Microsoft: File shared company-wide with view access with DLP Profile match | 0b882cf3-7e33-4c58-b425-0202206a2c10 | Medium |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## OpenAI

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/openai/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/openai/)

Page options # OpenAI

The OpenAI integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated OpenAI account that could leave you and your organization vulnerable.

This integration covers the following OpenAI products:

- ChatGPT Enterprise (Workspaces)
- OpenAI Platform Projects (API keys)
- GPTs (custom GPTs)

Note

Before you begin, ensure that OpenAI has enabled ChatGPT Enterprise Compliance API access for your organization. You will need a Project API key issued for your organization, your Organization ID, and your Workspace ID. These are available in your OpenAI Project API Keys ‚Üó.

If Compliance API access is not yet turned on for your organization, refer to Enable Compliance API access.

## Integration prerequisites

- An OpenAI organization with a ChatGPT Enterprise workspace
- Organization-level admin privileges to create and manage Admin API keys
- (Optional) A Project API key and the corresponding Project ID if you plan to include OpenAI Platform Projects in the scan scope

### Enable Compliance API access

Compliance API access is required to use the OpenAI CASB integration. To enable Compliance API access:

1. Contact support@openai.com to request access to the Compliance API for your organization and for the API key you will use with Cloudflare CASB. In your request, include:

The last four characters of the API key
The name of the API key
The name of the user who created the key
The requested scope (read, write, or both)
2. The last four characters of the API key
3. The name of the API key
4. The name of the user who created the key
5. The requested scope (read, write, or both)
6. OpenAI will verify the key and grant the requested Compliance API scopes.
7. After the scopes are granted, add the OpenAI integration to CASB. When prompted, enter your Open AI Admin API key, Organization ID, and Workspace ID (available at https://chatgpt.com/admin/settings).

For more information, refer to the OpenAI Help Center ‚Üó.

## Integration permissions

For the OpenAI integration to function, Cloudflare CASB requires the following authorization via API keys:

- Admin API key (organization-level): Grants read-only access to organization/workspace metadata, GPTs, users, invites, and audit/compliance objects exposed by the ChatGPT Enterprise Compliance API.
- (Optional) Project API key (project-level): Grants read-only access to OpenAI Platform project metadata and keys.

These credentials follow the principle of least privilege so that only the minimum required access is granted.

## Security findings

The OpenAI integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Model and tool governance

Flag risky tool and capability settings on custom GPTs.

| Finding type | FindingTypeID | Severity | ChatGPT Enterprise required |
| --- | --- | --- | --- |
| OpenAI: GPT with Custom Actions enabled | 5a2995f5-0cc1-4af3-9045-cdf7e6601f7b | High | ‚úÖ |
| OpenAI: GPT with Code Interpreter enabled | d368036a-be90-49f0-b7da-5092a3f8beb4 | Medium | ‚úÖ |
| OpenAI: GPT with web browsing enabled | 3af14358-5ff2-4502-921e-7ffd9a310093 | Medium | ‚úÖ |

### Publishing and sharing

Identify GPTs that are externally visible beyond your organization.

| Finding type | FindingTypeID | Severity | ChatGPT Enterprise required |
| --- | --- | --- | --- |
| OpenAI: GPT publicly accessible via GPT Store | c69adfa6-2362-4939-86ec-49ff34093cfd | High | ‚úÖ |
| OpenAI: GPT publicly accessible via public link | de460c9f-55c0-4131-9cdf-e4c3b84f9549 | High | ‚úÖ |

### API key hygiene

Detect API keys that may be stale, unused, or overdue for rotation.

| Finding type | FindingTypeID | Severity | ChatGPT Enterprise required |
| --- | --- | --- | --- |
| OpenAI: Admin API key not rotated | b72e971d-f5b9-4cf3-96f4-ef82bdf38453 | High | ‚ùå |
| OpenAI: Project API key not rotated | 2c079fe8-6188-43e1-a2e5-d0e2dd8c7686 | High | ‚ùå |
| OpenAI: Unused admin API key | 49c75a36-1e64-437b-98a1-e54ec35d0a64 | Medium | ‚ùå |
| OpenAI: Unused project API key | c8fd231b-de51-43cc-8c3f-e1e57114c5f5 | Medium | ‚ùå |

### Access security

Flag user/invite issues to help enforce best practices.

| Finding type | FindingTypeID | Severity | ChatGPT Enterprise required |
| --- | --- | --- | --- |
| OpenAI: High-privilege invite | 776ceb93-fa9a-4ca0-83db-668a67c09936 | High | ‚ùå |
| OpenAI: Inactive user | 20ab9ddb-fd48-46a8-9fdf-9bb9b9061f21 | Medium | ‚ùå |
| OpenAI: Stale pending invite | 18fd5b21-8489-485e-9c93-0bd4a696e724 | Low | ‚ùå |

### Data Loss Prevention (optional)

These findings will only appear if you added DLP profiles to your CASB integration.

| Finding type | FindingTypeID | Severity | ChatGPT Enterprise required |
| --- | --- | --- | --- |
| OpenAI: File in ChatGPT Conversation with DLP Profile match | 9aca654d-b331-4052-a5b4-2ceecced8676 | High | ‚úÖ |
| OpenAI: File in ChatGPT GPT with DLP Profile match | 520200f5-7dcc-42c9-bc3c-423019159d45 | High | ‚úÖ |
| OpenAI: File in ChatGPT Project with DLP Profile match | 8e46ec69-e5c1-4f53-ab00-a92f2050ec33 | High | ‚ùå |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Salesforce

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/salesforce/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/salesforce/)

Page options # Salesforce

The Salesforce integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Salesforce environment that could leave you and your organization vulnerable.

## Integration prerequisites

- A Salesforce environment (most editions are compatible)
- Permissions to a Salesforce organization with either:

System Administrator permission
Permissions for View Setup and Configuration, Customize Applications, and Modify All Data
- System Administrator permission
- Permissions for View Setup and Configuration, Customize Applications, and Modify All Data

## Integration permissions

For the Salesforce integration to function, Cloudflare CASB requires the following Salesforce permissions via a Connected App:

- Manage user data via APIs (api)
- Manage user data via Web browsers (web)
- Perform requests at any time (refresh_token, offline_access)
- Access unique user identifiers (openid)

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission, refer to the Salesforce OAuth Tokens and Scopes documentation ‚Üó.

## Security findings

The Salesforce integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### File sharing

Identify uploaded content, files, and attachments that have been shared in a potentially insecure fashion.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Salesforce: Content Document publicly accessible without a password | 4cde56ed-19db-4cdb-a6c6-3aede5e17785 | Critical |
| Salesforce: Content Document publicly accessible with weak password | 68c43ab8-733d-4798-b25f-202f6fcf435f | High |
| Salesforce: Content Document publicly accessible and password protected | 75194f6b-5a95-48fa-b485-37181d2d19c8 | Medium |
| Salesforce: Content Document shared and not viewed in 12+ months (stale permission) | 7125e209-234a-4f10-89d2-1af0601c277f | Medium |
| Salesforce: Content Document larger than 2 GB | 3d21de13-4b9f-483c-921a-44cdef7a58c5 | Medium |

### Account misconfigurations

Discover account and admin-level settings that have been configured in an insecure way.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Salesforce: Domain without HTTPS | 20916e32-442e-4622-9e54-e1f37eb7d79f | High |
| Salesforce: Default Account record access allows edit | 316f1d9a-447e-432c-add7-7adde67c4f19 | Medium |
| Salesforce: Default Case record access allows edit | a7c8eb3e-b5be-4bfc-969a-358186bf927a | Medium |
| Salesforce: Default Contact record access allows edit | e7be14f0-24d6-4d6c-9e12-ca3f23d34ba9 | Medium |
| Salesforce: Default Lead record access allows edit | 12fde974-45e8-4449-8bf4-dc319370d5ca | Medium |
| Salesforce: Default Opportunity record access allows edit | 2ab78d14-e804-4334-9d46-213d8798dd2a | Medium |
| Salesforce: Organization with active compliance BCC email | 43e5fd20-1cba-4f1d-aa39-90c7ce2e088a | Low |

### User access

Flag user access issues, including account misuse and users not following best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Salesforce: User sending email with different email address | a2790c4f-03f5-449f-b209-5f4447f417af | Medium |
| Salesforce: Inactive user | 57e44995-c7ad-46fe-9c55-59706e663adf | Low |
| Salesforce: User has never logged in | a0bf74df-c796-4574-ac1c-0f239ea8c9ac | Low |
| Salesforce: User has not logged in for 90+ days | 8395c824-bc44-4c12-b300-40f2477384d4 | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Salesforce (FedRAMP)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/salesforce-fedramp/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/salesforce-fedramp/)

Page options # Salesforce (FedRAMP)

Availability

The Salesforce (FedRAMP) CASB integration requires a special entitlement on your account. To request access, contact your account team.

The Salesforce (FedRAMP) integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated FedRAMP-compliant Salesforce environment that could leave you and your organization vulnerable.

## Integration prerequisites

- A FedRAMP-compliant Salesforce environment (most editions are compatible)
- Permissions to a Salesforce organization with either:

System Administrator permission
Permissions for View Setup and Configuration, Customize Applications, and Modify All Data
- System Administrator permission
- Permissions for View Setup and Configuration, Customize Applications, and Modify All Data

## Integration permissions

For the Salesforce (FedRAMP) integration to function, Cloudflare CASB requires the following Salesforce permissions via a Connected App:

- Manage user data via APIs (api)
- Manage user data via Web browsers (web)
- Perform requests at any time (refresh_token, offline_access)
- Access unique user identifiers (openid)

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission, refer to the Salesforce OAuth Tokens and Scopes documentation ‚Üó.

## Security findings

The Salesforce (FedRAMP) integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### File sharing

Identify uploaded content, files, and attachments that have been shared in a potentially insecure fashion.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Salesforce (FedRAMP): Content Document publicly accessible without a password | 4cde56ed-19db-4cdb-a6c6-3aede5e17785 | Critical |
| Salesforce (FedRAMP): Content Document publicly accessible with weak password | 68c43ab8-733d-4798-b25f-202f6fcf435f | High |
| Salesforce (FedRAMP): Content Document publicly accessible and password protected | 75194f6b-5a95-48fa-b485-37181d2d19c8 | Medium |
| Salesforce (FedRAMP): Content Document shared and not viewed in 12+ months (stale permission) | 7125e209-234a-4f10-89d2-1af0601c277f | Medium |
| Salesforce (FedRAMP): Content Document larger than 2 GB | 3d21de13-4b9f-483c-921a-44cdef7a58c5 | Medium |

### Account misconfigurations

Discover account and admin-level settings that have been configured in an insecure way.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Salesforce (FedRAMP): Domain without HTTPS | 20916e32-442e-4622-9e54-e1f37eb7d79f | High |
| Salesforce (FedRAMP): Default Account record access allows edit | 316f1d9a-447e-432c-add7-7adde67c4f19 | Medium |
| Salesforce (FedRAMP): Default Case record access allows edit | a7c8eb3e-b5be-4bfc-969a-358186bf927a | Medium |
| Salesforce (FedRAMP): Default Contact record access allows edit | e7be14f0-24d6-4d6c-9e12-ca3f23d34ba9 | Medium |
| Salesforce (FedRAMP): Default Lead record access allows edit | 12fde974-45e8-4449-8bf4-dc319370d5ca | Medium |
| Salesforce (FedRAMP): Default Opportunity record access allows edit | 2ab78d14-e804-4334-9d46-213d8798dd2a | Medium |
| Salesforce (FedRAMP): Organization with active compliance BCC email | 43e5fd20-1cba-4f1d-aa39-90c7ce2e088a | Low |

### User access

Flag user access issues, including account misuse and users not following best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Salesforce (FedRAMP): User sending email with different email address | a2790c4f-03f5-449f-b209-5f4447f417af | Medium |
| Salesforce (FedRAMP): Inactive user | 57e44995-c7ad-46fe-9c55-59706e663adf | Low |
| Salesforce (FedRAMP): User has never logged in | a0bf74df-c796-4574-ac1c-0f239ea8c9ac | Low |
| Salesforce (FedRAMP): User has not logged in for 90+ days | 8395c824-bc44-4c12-b300-40f2477384d4 | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## ServiceNow

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/servicenow/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/servicenow/)

Page options # ServiceNow

The ServiceNow integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated ServiceNow instance that could leave you and your organization vulnerable.

## Integration prerequisites

- admin access to a ServiceNow instance
- Ability to create an OAuth API endpoint for external clients ‚Üó

## Integration permissions

For the ServiceNow integration to function, Cloudflare CASB requires the following permissions:

- Global application scope

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission, refer to the ServiceNow Application scope documentation ‚Üó.

## Security findings

The ServiceNow integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Instance security

Identify security risks related to the ServiceNow instance itself.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| ServiceNow: Production instance with exposed admin credentials | 6c75c56f-df42-454d-85ee-c919bba70191 | Critical |
| ServiceNow: Production instance with exposed database user credentials | 37652a12-93d3-453f-961b-de32f419ed33 | High |
| ServiceNow: Instance with exposed admin credentials | 8235e0a2-6a53-4596-adff-632203c60ab2 | High |
| ServiceNow: Instance with exposed database user credentials | 4f8bf0e4-fa79-44fc-b171-84926cbc73c7 | Medium |

### User security

Flag user-related security risks and misconfigurations.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| ServiceNow: User with pending password reset | 42097604-73db-46b3-9a5c-c3e0d2629531 | High |
| ServiceNow: User with 3+ failed login attempts | 49079a4b-5280-4c9c-bf61-a45b53c2fd9f | Medium |
| ServiceNow: User with locked account | 344f5a37-7df5-4a26-a0fe-4d3c4215df61 | Low |
| ServiceNow: User without multi-factor authentication enabled | 4efbe128-608d-4b19-b7c8-10c312e4cd9f | Low |
| ServiceNow: User with no assigned roles | 8b5ca10d-951c-46d8-b786-223756b39165 | Low |
| ServiceNow: Inactive user | a3ee8ec7-85de-480c-bd98-6bc9581bacf9 | Low |
| ServiceNow: User with no recent activity | 2477faf4-1887-44bc-b663-94373afb03d7 | Low |

### Incident management

Identify issues related to ServiceNow incidents.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| ServiceNow: High priority incident with no assigned user | 8bd04e4e-4f2f-4b44-9c6c-df6341822521 | High |
| ServiceNow: Incident with no assigned user | 0ea6e2dc-4748-436f-9407-bf24997ae574 | Medium |

### Knowledge management

Highlight potential misconfigurations in ServiceNow knowledge articles.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| ServiceNow: Knowledge article without expiration date | 0bd59519-a5ec-4327-92ec-c74f26184a5c | Low |
| ServiceNow: Knowledge article without any roles | 3caf029c-9840-43e4-a024-6d4af9f3d57e | Low |
| ServiceNow: Knowledge article with flagged status | 12bd46d5-e627-4bba-8644-59e01cca6646 | Low |

### Integration and access

Detect issues related to ServiceNow integrations and access controls.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| ServiceNow: Internal Integration user | fa63799a-24ce-4f5f-8e88-09dbf87a6fb9 | Low |
| ServiceNow: Web Service Access only user | 3523fbb4-8725-4ffc-b200-9aef44bbbe98 | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## ServiceNow (FedRAMP)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/servicenow-fedramp/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/servicenow-fedramp/)

Page options # ServiceNow (FedRAMP)

Availability

The ServiceNow (FedRAMP) CASB integration requires a special entitlement on your account. To request access, contact your account team.

The ServiceNow (FedRAMP) integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated ServiceNow (FedRAMP) instance that could leave you and your organization vulnerable.

## Integration prerequisites

- admin access to a ServiceNow (FedRAMP) instance
- Ability to create an OAuth API endpoint for external clients ‚Üó

## Integration permissions

For the ServiceNow (FedRAMP) integration to function, Cloudflare CASB requires the following permissions:

- Global application scope

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission, refer to the ServiceNow Application scope documentation ‚Üó.

## Security findings

The ServiceNow (FedRAMP) integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Instance security

Identify security risks related to the ServiceNow instance itself.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| ServiceNow: Production instance with exposed admin credentials | 6c75c56f-df42-454d-85ee-c919bba70191 | Critical |
| ServiceNow: Production instance with exposed database user credentials | 37652a12-93d3-453f-961b-de32f419ed33 | High |
| ServiceNow: Instance with exposed admin credentials | 8235e0a2-6a53-4596-adff-632203c60ab2 | High |
| ServiceNow: Instance with exposed database user credentials | 4f8bf0e4-fa79-44fc-b171-84926cbc73c7 | Medium |

### User security

Flag user-related security risks and misconfigurations.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| ServiceNow: User with pending password reset | 42097604-73db-46b3-9a5c-c3e0d2629531 | High |
| ServiceNow: User with 3+ failed login attempts | 49079a4b-5280-4c9c-bf61-a45b53c2fd9f | Medium |
| ServiceNow: User with locked account | 344f5a37-7df5-4a26-a0fe-4d3c4215df61 | Low |
| ServiceNow: User without multi-factor authentication enabled | 4efbe128-608d-4b19-b7c8-10c312e4cd9f | Low |
| ServiceNow: User with no assigned roles | 8b5ca10d-951c-46d8-b786-223756b39165 | Low |
| ServiceNow: Inactive user | a3ee8ec7-85de-480c-bd98-6bc9581bacf9 | Low |
| ServiceNow: User with no recent activity | 2477faf4-1887-44bc-b663-94373afb03d7 | Low |

### Incident management

Identify issues related to ServiceNow incidents.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| ServiceNow: High priority incident with no assigned user | 8bd04e4e-4f2f-4b44-9c6c-df6341822521 | High |
| ServiceNow: Incident with no assigned user | 0ea6e2dc-4748-436f-9407-bf24997ae574 | Medium |

### Knowledge management

Highlight potential misconfigurations in ServiceNow knowledge articles.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| ServiceNow: Knowledge article without expiration date | 0bd59519-a5ec-4327-92ec-c74f26184a5c | Low |
| ServiceNow: Knowledge article without any roles | 3caf029c-9840-43e4-a024-6d4af9f3d57e | Low |
| ServiceNow: Knowledge article with flagged status | 12bd46d5-e627-4bba-8644-59e01cca6646 | Low |

### Integration and access

Detect issues related to ServiceNow integrations and access controls.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| ServiceNow: Internal Integration user | fa63799a-24ce-4f5f-8e88-09dbf87a6fb9 | Low |
| ServiceNow: Web Service Access only user | 3523fbb4-8725-4ffc-b200-9aef44bbbe98 | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Slack

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/slack/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/slack/)

Page options # Slack

The Slack integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated Slack Workspace that could leave you and your organization vulnerable.

## Integration prerequisites

- A Slack user account
- Membership in a Slack Workspace (Free, Pro, Business+, or Enterprise Grid)
- If you are not the Workspace Owner and the Require App Approval setting is enabled for the Workspace, request permission ‚Üó to install apps.

## Integration permissions

For the Slack integration to function, Cloudflare CASB requires the following Slack API permissions:

- channels:read
- files:read
- groups:read
- users:read

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission, refer to the Slack Permission scopes reference ‚Üó.

## Security findings

The Slack integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### User account settings

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Slack: User with two-factor authentication disabled | d1cc8596-d22c-435c-9f94-3ba068f019cd | Critical | A user in the Slack Workspace does not have two-factor authentication (2FA) enabled for their account. |
| Slack: User with unverified email | 9fa4ae7c-07f0-453a-b232-e734b0f8877c | High | A user in the Slack Workspace has not verified the email they use to sign in. |

### Channel sharing

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Slack: Channel shared externally | d298ba64-f013-4e28-b68a-63f758380355 | High | A channel in the Slack Workspace has been shared with users who are not members of the Workspace. |

### File sharing

| Finding type | FindingTypeID | Severity | Description |
| --- | --- | --- | --- |
| Slack: File publicly accessible with view access | 9d96d3a2-696b-4802-98aa-c6c8572e806e | Medium | An external link has been created for a file uploaded to the Slack Workspace. |
| Slack: File larger than 2 GB | c16d64a8-9f78-4f24-99ff-de7fcdc6871b | Low | A file ‚â• 2 GB has been uploaded to the Slack Workspace. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Scan for sensitive data

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-dlp/](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-dlp/)

Page options # Scan for sensitive data

Note

Requires Cloudflare CASB and Cloudflare DLP.

You can use Cloudflare Data Loss Prevention (DLP) to discover if files stored in a SaaS application contains sensitive data. To perform DLP scans in a SaaS app, first configure a DLP profile with the data patterns you want to detect, then add the profile to a CASB integration.

## Supported integrations

- Amazon Web Services (AWS) S3
- Box
- Dropbox
- Google Cloud Platform (GCP) Cloud Storage
- Google Drive
- Microsoft OneDrive
- Microsoft SharePoint

## Configure a DLP profile

You may either use DLP profiles predefined by Cloudflare, or create your own custom profiles based on regex, predefined detection entries, datasets, and document fingerprints.

### Configure a predefined profile

1. In Zero Trust ‚Üó, go to Data loss prevention > DLP profiles.
2. Choose a predefined profile and select Configure.
3. Enable one or more Detection entries according to your preferences. The DLP Profile matches using the OR logical operator ‚Äî if multiple entries are enabled, your data needs to match only one of the entries.
4. Select Save profile.

Your DLP profile is now ready to use with CASB.

### Build a custom profile

1. In Zero Trust ‚Üó, go to Data loss prevention > DLP profiles.
2. Select Create profile.
3. Enter a name and optional description for the profile.
4. Add custom or existing detection entries.
 Add a custom entry
 

Select Add custom entry and give it a name.


In Value, enter a regular expression (or regex) that defines the text pattern you want to detect. For example, test\d\d will detect the word test followed by two digits.

Regular expressions are written in Rust. We recommend validating your regex with Rustexp ‚Üó.
DLP detects UTF-8 characters, which can be up to 4 bytes each. Custom text pattern detections are limited to 1024 bytes in length.
DLP does not support regular expressions with + or * operators because they are prone to exceeding the length limit. For example, the regex pattern a+ can detect an infinite number of a characters. We recommend using a{min,max} instead, such as a{1,1024}.



To save the detection entry, select Done.

 
 Add existing entries
 Existing entries include predefined and user-defined detection entries.
Select Add existing entries.
Choose which entries you want to add, then select Confirm.
To save the detection entry, select Done.
5. Select Add custom entry and give it a name.
6. In Value, enter a regular expression (or regex) that defines the text pattern you want to detect. For example, test\d\d will detect the word test followed by two digits.

Regular expressions are written in Rust. We recommend validating your regex with Rustexp ‚Üó.
DLP detects UTF-8 characters, which can be up to 4 bytes each. Custom text pattern detections are limited to 1024 bytes in length.
DLP does not support regular expressions with + or * operators because they are prone to exceeding the length limit. For example, the regex pattern a+ can detect an infinite number of a characters. We recommend using a{min,max} instead, such as a{1,1024}.
7. Regular expressions are written in Rust. We recommend validating your regex with Rustexp ‚Üó.
8. DLP detects UTF-8 characters, which can be up to 4 bytes each. Custom text pattern detections are limited to 1024 bytes in length.
9. DLP does not support regular expressions with + or * operators because they are prone to exceeding the length limit. For example, the regex pattern a+ can detect an infinite number of a characters. We recommend using a{min,max} instead, such as a{1,1024}.
10. To save the detection entry, select Done.
11. Select Add existing entries.
12. Choose which entries you want to add, then select Confirm.
13. To save the detection entry, select Done.
14. (Optional) Configure profile settings for the profile.
15. Select Save profile.

Your DLP profile is now ready to use with CASB.

For more information, refer to Configure a DLP profile.

## Enable DLP scans in CASB

### Add a new integration

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Select Add integration and choose a supported integration.
3. During the setup process, you will be prompted to select DLP profiles for the integration.
4. Select Save integration.

CASB will scan every publicly accessible file in the integration for text that matches the DLP profile. The initial scan may take up to a few hours to complete.

### Modify an existing integration

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Choose a supported integration and select Configure.
3. Under DLP profiles, select the profiles that you want the integration to scan for.
4. Select Save integration.

If you enable a DLP profile from the Manage integrations page, CASB will only scan publicly accessible files that have had a modification event since enabling the DLP profile. Modification events include changes to the following attributes:

- Contents of the file
- Name of the file
- Visibility of the file (only if changed to publicly accessible)
- Owner of the file
- Location of the file (for example, moved to a different folder)

In order to scan historical data, you must enable the DLP profile during the integration setup flow.

## Limitations

DLP in CASB will only scan:

- Text-based files such as documents, spreadsheets, and PDFs. Images are not supported.
- Files less than or equal 100 MB in size.
- Source code with a minimum size of 5 KB for Java and R.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Troubleshoot integrations

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/troubleshooting/troubleshoot-integrations/](https://developers.cloudflare.com/cloudflare-one/applications/casb/troubleshooting/troubleshoot-integrations/)

Page options # Troubleshoot integrations

Cloudflare CASB detects when integrations are unhealthy or outdated.

Common integration issues include changes to SaaS app or cloud environment configurations, user access, or permission scope. Integrations may need to be updated to support new features or permissions.

## Identify unhealthy or outdated integrations

To identify unhealthy CASB integrations, go to CASB > Integrations. If an integration is unhealthy, CASB will set its status to Broken. If an integration is outdated, CASB will set its status to Upgrade.

## Repair an unhealthy integration

Repair limitation

If CASB does not support self-service repairs for an integration, you will need to delete and recreate the integration to continue scanning.

You can repair unhealthy CASB integrations through your list of integrations or findings.

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Choose your unhealthy integration.
3. Select Reauthorize.
4. In your SaaS app or cloud environment, reauthorize your account.

## Upgrade an integration

Upgrading an outdated integration will allow the integration to access new features and permissions.

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Choose your outdated integration.
3. Select Upgrade integration.
4. In your SaaS app or cloud environment, upgrade your app and reauthorize your account.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Troubleshoot compute accounts

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/troubleshooting/troubleshoot-compute-accounts/](https://developers.cloudflare.com/cloudflare-one/applications/casb/troubleshooting/troubleshoot-compute-accounts/)

Page options # Troubleshoot compute accounts

Cloudflare CASB detects when compute accounts are unhealthy or outdated. Common compute account issues include security or functionality updates and API token misconfigurations.

## Identify unhealthy compute accounts

To identify unhealthy compute accounts:

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Choose the integration you created for cloud scanning.
3. Select Manage compute accounts.

CASB will display the status of each compute account next to its name. If a compute account is broken or outdated, CASB will set its status to Unhealthy. If the status is Healthy, no action is required.

## Repair an unhealthy compute account

When CASB marks a compute account as Unhealthy, CASB will not use new scan configuration changes and new scan results will not appear in the dashboard.

To repair a compute account marked as Unhealthy, first upgrade the compute account. If the compute account is still unhealthy, roll your API token.

## Upgrade a compute account

Upgrading a compute account applies the latest software features, bug fixes, and infrastructure changes to a cloud compute account. You should run upgrades periodically to keep the compute account software up to date or when recommended by Cloudflare to address an issue. CASB deploys compute account upgrades through Terraform updates.

To upgrade a compute account:

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Choose the integration you created for cloud scanning.
3. Select Open connection instructions.
4. Follow the instructions provided to validate your local Terraform and CLI configuration.
5. Under Step 2: Deploy Terraform Configuration, copy the template to your local configuration. This template will be the most up to date version of the integration's Terraform configuration.
6. In a local terminal, update the cached version of the CDS Terraform modules:
Terminal windowterraform init --upgrade
7. Apply the upgraded Terraform configuration to your compute account:
Terminal windowterraform apply

## Roll API tokens

Warning

If you roll your API token in CASB but do not update it in your compute account, CASB will set your compute account's status as Broken and stop reporting scan results.

You may need to roll the Cloudflare API token used for your compute account if a security or operational issue appears, your API token is compromised, or your API token is removed from your compute account.

If your token is lost or compromised, you can either create a new token or roll your token to generate a new secret. Rolling your API token into a new one will invalidate the previous token, but the access and permissions will be the same as the previous API token.

To roll your API token:

1. Log in to the Cloudflare dashboard ‚Üó and go to My Profile > API Tokens.
2. Next to the API token you want to roll, select the three dot icon >¬†Roll.
3. Select Confirm to generate a new API token.

1. Copy your API token.

Once you roll your API token in Cloudflare, you can update the API token value in your secrets manager for Amazon Web Services (AWS) ‚Üó or Google Cloud Platform (GCP) ‚Üó.

### Common token issues

#### cloudflare-cds-secrets does not exist in the compute account's secrets manager

To recreate the secret in your compute account:

1. Validate that you selected the correct region.
2. Upgrade the compute account to recreate the secret.
3. Update the secret value in your compute account.

#### I no longer have access to the Cloudflare API token I created

Roll your Cloudflare API token and add it to your compute account. If the status of the compute account is set to Healthy, the issue has been solved.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Application Library

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/app-library/](https://developers.cloudflare.com/cloudflare-one/applications/app-library/)

Page options # Application Library

The Application Library allows users to manage their SaaS applications in Cloudflare Zero Trust by consolidating views across all relevant products: Gateway, Access, and Cloud Access Security Broker (CASB). The App Library provides visibility and control for available applications, as well as the ability to view categorized hostnames and manage configuration for Access for SaaS and Gateway policies. For example, you can use the App Library to review how Gateway uses specific hostnames to match against application traffic.

To access the App Library in Zero Trust ‚Üó, go to My team > App Library. Each application card will list the number of hostnames associated with the application, the supported Zero Trust product usage, and the app type.

The App Library groups Do Not Inspect applications within the corresponding application. For example, the App Library will group Google Drive (Do Not Inspect) under Google Drive. Traffic that does not match a known application will not be included in the App Library.

## View application details

Select an application card to view details about the application.

### Overview

The Overview tab shows details about an application, including:

- Name
- Shadow IT review status
- Number of hostnames
- App type
- Supported Zero Trust applications
- Application ID for use with the API and Terraform

### Findings

The Findings tab shows any connected CASB integrations for the selected application, as well as instances of any detected posture findings and content findings for each integration.

### Policies

The Policies tab shows any Gateway and Access for SaaS policies related to the selected application.

### Usage

The Usage tab shows any logs for Gateway traffic requests, Access authentication events, Shadow IT Discovery user sessions, and generative AI prompt logs sent to the selected application. This section requires logs to be turned on for each feature.

The Shadow IT Discovery dashboard will provide more details for discovered applications. To access Shadow IT Discovery in Zero Trust ‚Üó, go to Analytics, then select Shadow IT Discovery.

## Review applications

The App Library synchronizes application review statuses with approval statuses from the Shadow IT Discovery SaaS analytics dashboard.

To organize applications into their approval status for your organization, you can mark them as Unreviewed (default), In review, Approved, and Unapproved.

| Status | API value | Description |
| --- | --- | --- |
| Approved | approved | Applications that have been marked as sanctioned by your organization. |
| Unapproved | unapproved | Applications that have been marked as unsanctioned by your organization. |
| In review | in review | Applications in the process of being reviewed by your organization. |
| Unreviewed | unreviewed | Unknown applications that are neither sanctioned nor being reviewed by your organization at this time. |

To set the status of an application:

1. In Zero Trust ‚Üó, go to My team > App Library.
2. Locate the card for the application.
3. In the three-dot menu, select the option to mark your desired status.

Once you mark the status of an application, its badge will change. You can filter applications by their status to review each application in the list for your organization. The review status for an application in the App Library and Shadow IT Discovery will update within one hour.

Note

Approval status does not impact a user's ability to access an application. Users are allowed or blocked according to your Access and Gateway policies. To filter traffic based on approval status, use the Application Status selector.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Login page

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/login-page/](https://developers.cloudflare.com/cloudflare-one/applications/login-page/)

Page options # Login page

You can customize the login page that is displayed to end users when they go to an Access application.

To change the appearance of your login page:

1. In Zero Trust ‚Üó, go to Settings > Custom Pages.
2. Find the Login page setting and select Customize.
3. Give the login page the look and feel of your organization by adding:

Your organization's name
A logo
A custom header and footer
A preferred background color

Any changes you make will be reflected in real time in the Preview card.
4. Your organization's name
5. A logo
6. A custom header and footer
7. A preferred background color
8. Once you are satisfied with your customization, select Save.

The login page is now updated for all of your Access applications.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Block page

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/block-page/](https://developers.cloudflare.com/cloudflare-one/applications/block-page/)

Page options # Block page

You can customize the block page that displays when users fail to authenticate to an Access application. Each application can have a different block page.

Gateway block page

To customize the page that users see when they are blocked by a Gateway firewall policy, refer to Gateway block page.

## Types of block pages

Cloudflare Access offers three different block page options:

- Default: Displays a Cloudflare branded block page.
- Custom Redirect URL - Redirects blocked requests to the specified URL. For example, you could redirect the user to a dynamic Access Denied page ‚Üó that fetches their identity and shows the exact reason they were blocked.
- Custom Page Template - (Only available on Pay-as-you-go and Enterprise plans) Displays a custom HTML page hosted by Cloudflare.

### Identity versus non-identity

You can display a different type of block page to users who fail an identity-based policy versus a non-identity policy.

- Identity failure block page: Displays when the user is blocked by an identity-based Access policy (such as email, user group, or external evaluation rule), after logging in to their identity provider.
- Non-identity failure block page: Displays when the user is blocked by a non-identity Access policy (such as country, IP, or device posture). Cloudflare checks non-identity attributes before prompting the user to login.

## Create a custom block page

Note

Only available on Pay-as-you-go and Enterprise plans.

To create a custom block page for Access:

1. In Zero Trust ‚Üó, go to Settings > Custom Pages.
2. Find the Access Custom Pages setting and select Manage.
3. Select Add a page template.
4. Enter a unique name for the block page.
5. In Type, select whether this is an identity or non-identity block page.
6. In Custom HTML, enter the HTML code for your custom page. For example,
<!doctype html><html>  <body>    <h1>Access denied.</h1>
    <p>To obtain access, contact your IT administrator.</p>  </body></html>
7. To check the appearance of your custom page, select Download and open the HTML file in a browser.
8. Once you are satisfied with your custom page, select Save.

You can now select this block page when you configure an Access application.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Add bookmarks

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/bookmarks/](https://developers.cloudflare.com/cloudflare-one/applications/bookmarks/)

Page options # Add bookmarks

With Cloudflare Zero Trust, you can show applications on the App Launcher even if those applications are not secured behind Access. This way, users can access all the applications they need to work, all in one place ‚Äî¬†regardless of whether those applications are protected by Access.

Links to applications not protected by Access can be added as bookmarks. To add a bookmark:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application > Bookmark.
3. Name your application.
4. Enter your Application URL, for example https://mybookmark.com.
5. Turn on App Launcher visibility if you want the application to be visible in the App Launcher. The toggle does not impact the ability for users to reach the application.
6. (Optional) To add a custom logo for your application, select Custom and enter the image URL.
NoteIf you are having issues specifying a custom logo, check that the image is served from an HTTPS endpoint. For example, http://www.example.com/upload/logo.png will not work. However, https://www.example.com/upload/logo.png will.
7. Select Add application to save and exit.

The application will show up on the Applications page labeled as BOOKMARK. You can always edit or delete your bookmarks, as you would any other application.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## App Launcher

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/app-launcher/](https://developers.cloudflare.com/cloudflare-one/applications/app-launcher/)

Page options # App Launcher

With the Access App Launcher, users can open all applications that they have access to from a single dashboard.

The App Launcher is available at a team domain unique to your Cloudflare Zero Trust account, for example mycompany.cloudflareaccess.com.

Users log in using one of the identity providers configured for the account. Once Access authenticates the user, the App Launcher displays applications they are authorized to use, in the form of application tiles. Selecting an application tile launches the application's hostname, sending the user to that tool as part of their SSO flow.

## Enable the App Launcher

By default, the App Launcher is disabled. To enable it, you must configure a policy that defines which users can access the App Launcher.

To enable the App Launcher:

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Under the App Launcher card, select Manage.
3. On the Rules tab, build a rule to define who can access your App Launcher portal. These rules do not impact permissions for the applications secured behind Access.
4. On the Authentication tab, choose the identity providers users can authenticate with.
5. Select Save.

The App Launcher is now available at <your-team-name>.cloudflareaccess.com. You can always edit your App Launcher rules by going to Settings > Authentication.

## Add a tile to the App Launcher

Tiles have a one-to-one relationship with each application you create in Access. The tile names displayed in the Access App Launcher portal correspond to the application names listed under Access > Applications. For example, if you create one application for general access to your Jira deployment and a separate application that restricts requests to a particular Jira path, a user authorized for both will see separate tiles for each. If you add multiple hostnames to a single application, the user will only see the domain selected in the application's App Launcher settings.

To show an Access application in the App Launcher:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select an application and select Configure.
3. Go to Experience settings.
4. Select Show application in App Launcher. The App Launcher link will only appear for users who are allowed by your Access policies. Blocked users will not see the app in their App Launcher.
NoteThis toggle does not impact the user's ability to reach the application. Allowed users can always reach the application via a direct link, regardless of whether the toggle is enabled. Blocked users will never have access to the application.
5. (Optional) To use a custom logo for the application tile, select Use custom logo and enter a link to your desired image.
NoteIf you are having issues specifying a custom logo, check that the image is served from an HTTPS endpoint. For example, http://www.example.com/upload/logo.png will not work. However, https://www.example.com/upload/logo.png will.
6. In Application domains, choose a domain to use for the App Launcher link.

## Customize App Launcher appearance

Note

Only available on Pay-as-you-go and Enterprise plans.

You can display your own branding, messages, and links to users when they open the App Launcher.

To customize the App Launcher appearance:

1. In Zero Trust ‚Üó, go to Settings > Custom Pages.
2. Find the Customize App Launcher setting and select Customize.
3. Give the App Launcher the look and feel of your organization by adding:

Your organization's name
A logo
A preferred background color for the header
A preferred background color for the page
A custom footer with links to your organization's help desk or other internal resources.
4. Your organization's name
5. A logo
6. A preferred background color for the header
7. A preferred background color for the page
8. A custom footer with links to your organization's help desk or other internal resources.

Note

We recommend lighter background colors because the font defaults to black.

1. Next, customize the landing page that users will see when they login to the App Launcher. Available properties include:

A custom title
A custom subtitle
An image
A preferred color for the Log in button
A preferred color for the Log in button text

All of the properties configured in Step 3 will also apply to the landing page.
2. A custom title
3. A custom subtitle
4. An image
5. A preferred color for the Log in button
6. A preferred color for the Log in button text
7. Once you are satisfied with your customization, select Save.

The App Launcher screens are now updated. To view your changes, select Preview.

## Tags

You can label an Access application with up to 25 custom tags. End users can then filter the applications in their App Launcher by their tags.

### Create a tag

To create a new tag:

1. In Zero Trust ‚Üó, go to Access > Tags.
2. Select Add tags.
3. Enter up to 35 alphanumeric characters for the tag (for example, Human Resources) and select it in the dropdown menu.
4. Select Save.

You can now add this tag to an Access application.

### Tag an Access application

To add a tag to an existing Access application:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select an application and select Configure.
3. Go to Experience settings.
4. In the Tags dropdown, select the tags that you would like to assign to this application. The tag must be created before you can select it in the dropdown.
5. Select Save application.

The tag will now appear on the application's App Launcher tile.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/](https://developers.cloudflare.com/cloudflare-one/policies/)

Page options # Policies

With Cloudflare Zero Trust, you can create:

- Secure Web Gateway policies to inspect outbound traffic to the Internet with Cloudflare Gateway.
- Access policies to secure inbound traffic to your applications with Cloudflare Access.
- Browser Isolation policies to protect your organization's devices from threats on the Internet and prevent data loss by loading requests in an isolated browser.
- Data Loss Prevention policies to detect and secure your organization's sensitive data in web traffic and SaaS applications.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Secure Web Gateway

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/)

Page options # Secure Web Gateway

Cloudflare Gateway, our comprehensive Secure Web Gateway ‚Üó, allows you to set up policies to inspect DNS, Network, HTTP, and Egress traffic.

- DNS policies inspect DNS queries. You can block domains and IP addresses from resolving on your devices. For more information on DNS filtering, refer to our Learning Center article ‚Üó.
- Network policies inspect individual TCP/UDP/GRE packets. You can block access to specific ports on your origin server, including non-HTTP resources.
- HTTP policies inspect HTTP requests. You can block specific URLs from loading, not just the domain itself. For more information on URL filtering, refer to our Learning Center article ‚Üó.
- Egress policies inspect traffic to assign egress IP addresses unique to your organization.
- Resolver policies inspect DNS queries to enable resolution by custom authoritative nameservers.

Note

When creating or editing policies, it may take up to 60 seconds for that policy to be updated across all of Cloudflare's data centers.

## Best practices

For each type of policy, we recommend the following workflow:

1. Connect the devices and/or networks that you want to apply policies to.
2. Verify that Gateway is successfully proxying traffic from your devices.
3. Set up basic security and compatibility policies (recommended for most use cases).
4. Customize your configuration to the unique needs of your organization.

To get started with specific Gateway filtering types, refer to the initial setup for DNS, Network, and HTTP policies.

### Select a policy type

The recommended policy type depends on what kind of traffic you are trying to filter. For example:

- To block websites, create an HTTP policy.
- To block non-HTTP traffic such as SSH and RDP, create a network policy.
- To block malware and other security threats, create both DNS and HTTP policies.
- To assign static IP addresses to your organization's egress traffic, create an egress policy.

Refer to the DNS, network, HTTP, and egress configuration pages to see the available filtering options within each policy builder.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## DNS filtering

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/initial-setup/dns/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/initial-setup/dns/)

Page options # DNS filtering

Secure Web Gateway allows you to inspect DNS traffic and control which websites users can visit.

Note

For a more detailed guide to filtering DNS queries and other traffic for your organization, refer to the Secure your Internet traffic and SaaS apps implementation guide.

## 1. Connect to Gateway

### Connect devices

To filter DNS requests from an individual device such as a laptop or phone:

1. Install the WARP client on your device.
2. In the WARP client Settings, log in to your organization's Zero Trust instance.
3. (Optional) If you want to display a custom block page, install a Cloudflare root certificate on your device.

### Connect DNS locations

To filter DNS requests from a location such as an office or data center:

1. Add the location to your Zero Trust settings.
2. On your router, browser, or OS, forward DNS queries to the address shown in the location setup UI.

Note

Gateway identifies locations differently depending on the DNS query protocol:

- IPv4 queries match to the source IP address. Under Gateway > DNS locations, ensure that the Source IPv4 Address parameter is correct for the location you want to apply policies to.
- IPv6, DOT, or DOH queries match to the unique DNS forwarding address assigned to the DNS location. Ensure that your DNS resolver is configured for the location you want to apply policies to.

## 2. Verify device connectivity

To verify your device is connected to Zero Trust:

1. In Zero Trust ‚Üó, go to Settings > Network.
2. Under Gateway logging, enable activity logging for all DNS logs.
3. On your device, open a browser and go to any website.
4. In Zero Trust, go to Logs > Gateway > DNS.
5. Make sure DNS queries from your device appear.

## 3. Create your first DNS policy

To create a new DNS policy:

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies.
2. In the DNS tab, select Add a policy.
3. Name the policy.
4. Under Traffic, build a logical expression that defines the traffic you want to allow or block.
5. Choose an Action to take when traffic matches the logical expression. For example, we recommend adding a policy to block all security categories:
SelectorOperatorValueActionSecurity CategoriesinAll security risksBlock
6. Select Create policy.

1. Create an API token with the following permissions:















TypeItemPermissionAccountZero TrustEdit
2. (Optional) Configure your API environment variables to include your account ID and API token.
3. Send a POST request to the Create a Zero Trust Gateway rule endpoint. For example, we recommend adding a policy to block all security categories:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Zero Trust Write Create a Zero Trust Gateway rulecurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block security threats",    "description": "Block all default Cloudflare DNS security categories",    "precedence": 0,    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.security_category[*] in {68 178 80 83 176 175 117 131 134 151 153})",    "identity": ""  }'
{   "success": true,   "errors": [],   "messages": []}
The API will respond with a summary of the policy and the result of your request.
4. Zero Trust Write

For more information, refer to DNS policies.

## 4. Add optional policies

Refer to our list of common DNS policies for other policies you may want to create.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Network filtering

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/initial-setup/network/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/initial-setup/network/)

Page options # Network filtering

Secure Web Gateway allows you to apply policies at the network level (Layers 3 and 4) to control which websites and non-HTTP applications users can access.

Note

For a more detailed guide to filtering network traffic and more for your organization, refer to the Secure your Internet traffic and SaaS apps implementation guide.

## 1. Connect to Gateway

### Connect devices

To filter network traffic from a device such as a laptop or phone:

1. Install the WARP client on your device.
2. In the WARP client Settings, log in to your organization's Zero Trust instance.
3. (Optional) If you want to display a custom block page, install the Cloudflare root certificate on your device .
4. Enable the Gateway proxy for TCP. Optionally, you can enable the UDP proxy to inspect all port 443 UDP traffic.

### Connect private networks

To filter traffic from private networks, refer to the Cloudflare Tunnel guide.

## 2. Verify device connectivity

To verify your device is connected to Zero Trust:

1. In Zero Trust ‚Üó, go to Settings > Network.
2. Under Gateway logging, enable activity logging for all Network logs.
3. On your WARP-enabled device, open a browser and visit any website.
4. Determine the Source IP for your device:

Open the WARP client settings.
Go to Preferences > General.
Note the Public IP.
5. Open the WARP client settings.
6. Go to Preferences > General.
7. Note the Public IP.
8. In Zero Trust, go to Logs > Gateway > Network. Before building Network policies, make sure you see Network logs from the Source IP assigned to your device.

## 3. Create your first network policy

To create a new network policy:

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies.
2. In the Network tab, select Add a policy.
3. Name the policy.
4. Under Traffic, build a logical expression that defines the traffic you want to allow or block.
5. Choose an Action to take when traffic matches the logical expression. For example, you can use a list of device serial numbers to ensure users can only access an application if they connect with the WARP client from a company device:
SelectorOperatorValueLogicActionSNI Domainisinternalapp.comAndBlockPassed Device Posture Checksnot inDevice serial numbers
6. Select Create policy.

1. Create an API token with the following permissions:















TypeItemPermissionAccountZero TrustEdit
2. (Optional) Configure your API environment variables to include your account ID and API token.
3. Send a POST request to the Create a Zero Trust Gateway rule endpoint. For example, you can use a list of device serial numbers to ensure users can only access an application if they connect with the WARP client from a company device:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Zero Trust Write Create a Zero Trust Gateway rulecurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Enforce device posture",    "description": "Ensure only devices in Zero Trust organization can connect to application",    "precedence": 0,    "enabled": true,    "action": "block",    "filters": [        "l4"    ],    "traffic": "any(net.sni.domains[*] == \"internalapp.com\")",    "identity": "",    "device_posture": "not(any(device_posture.checks.passed[*] in {\"LIST_UUID\"}))"  }'
4. Zero Trust Write

```
{   "success": true,   "errors": [],   "messages": []}
```

The API will respond with a summary of the policy and the result of your request.

For more information, refer to network policies.

## 4. Add optional policies

Refer to our list of common network policies for policies you may want to create.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## HTTP filtering

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/initial-setup/http/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/initial-setup/http/)

Page options # HTTP filtering

Secure Web Gateway allows you to inspect HTTP traffic and control which websites users can visit.

Note

For a more detailed guide to filtering HTTP requests and other traffic for your organization, refer to the Secure your Internet traffic and SaaS apps implementation guide.

## 1. Connect to Gateway

To filter HTTP requests from a device:

1. Install the Cloudflare root certificate on your device.
2. Install the WARP client on your device.
3. In the WARP client Settings, log in to your organization's Zero Trust instance.
4. Enable the Gateway proxy for TCP. Optionally, you can enable the UDP proxy to inspect all port 443 UDP traffic.
5. To inspect HTTPS traffic, enable TLS decryption.
6. (Optional) To scan file uploads and downloads for malware, enable anti-virus scanning.

## 2. Verify device connectivity

To verify your device is connected to Zero Trust:

1. In Zero Trust ‚Üó, go to Settings > Network.
2. Under Gateway logging, enable activity logging for all HTTP logs.
3. On your device, open a browser and go to any website.
4. In Zero Trust, go to Logs > Gateway > HTTP.
5. Make sure HTTP requests from your device appear.

## 3. Create your first HTTP policy

To create a new HTTP policy:

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies.
2. In the HTTP tab, select Add a policy.
3. Name the policy.
4. Under Traffic, build a logical expression that defines the traffic you want to allow or block.
5. Choose an Action to take when traffic matches the logical expression. For example, if you have configured TLS decryption, some applications that use embedded certificates may not support HTTP inspection, such as some Google products. You can create a policy to bypass inspection for these applications:
SelectorOperatorValueActionApplicationinDo Not InspectDo Not Inspect
Cloudflare also recommends adding a policy to block known threats such as Command & Control, Botnet and Malware based on Cloudflare's threat intelligence:
SelectorOperatorValueActionSecurity CategoriesinAll security risksBlock
6. Select Create policy.

1. Create an API token with the following permissions:















TypeItemPermissionAccountZero TrustEdit
2. (Optional) Configure your API environment variables to include your account ID and API token.
3. Send a POST request to the Create a Zero Trust Gateway rule endpoint. For example, if you have configured TLS decryption, some applications that use embedded certificates may not support HTTP inspection, such as some Google products. You can create a policy to bypass inspection for these applications:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Zero Trust Write Create a Zero Trust Gateway rulecurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Do not inspect applications",    "description": "Bypass TLS decryption for unsupported applications",    "precedence": 0,    "enabled": true,    "action": "off",    "filters": [        "http"    ],    "traffic": "any(app.type.ids[*] in {16})",    "identity": "",    "device_posture": ""  }'
{   "success": true,   "errors": [],   "messages": []}
The API will respond with a summary of the policy and the result of your request.
Cloudflare also recommends adding a policy to block known threats such as Command & Control, Botnet and Malware based on Cloudflare's threat intelligence:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Zero Trust Write Create a Zero Trust Gateway rulecurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block known risks",    "description": "Block all default Cloudflare HTTP security categories",    "precedence": 0,    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(http.request.uri.security_category[*] in {68 178 80 83 176 175 117 131 134 151 153})",    "identity": "",    "device_posture": ""  }'
4. Zero Trust Write
5. Zero Trust Write

For more information, refer to HTTP policies.

## 4. Add optional policies

Refer to our list of common HTTP policies for other policies you may want to create.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## DNS policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/dns-policies/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/dns-policies/)

Page options # DNS policies

When a user makes a DNS request to Gateway, Gateway matches the request against the DNS policies you have set up for your organization. If the domain does not belong to any blocked categories, or if it matches an Override policy, the user's client receives the DNS resolution and initiates an HTTP connection.

A DNS policy consists of an Action as well as a logical expression that determines the scope of the action. To build an expression, you need to choose a Selector and an Operator, and enter a value or range of values in the Value field. You can use And and Or logical operators to evaluate multiple conditions.

- Actions
- Selectors
- Comparison operators
- Value
- Logical operators

When creating a DNS policy, you can select as many security risk categories and content categories as needed to fully secure your network. Unless a more specific selector is configured in a policy (for example, User Email or Source IP), then the policy will be evaluated against all DNS queries that reach Gateway from your organization.

If a condition in an expression joins a query attribute (such as Source IP) and a response attribute (such as Resolved IP), then the condition will be evaluated when the response is received.

Terraform provider v4 precedence limitation

To avoid conflicts, version 4 of the Terraform Cloudflare provider applies a hash calculation to policy precedence. For example, a precedence of 1000 may become 1000901. This can cause errors when reordering policies. To avoid this issue, manually set the precedence of policies created with Terraform using the Update a Zero Trust Gateway rule endpoint.

To ensure your precedence is set correctly, Cloudflare recommends upgrading your Terraform provider to version 5 ‚Üó.

## Actions

Just like actions in HTTP policies, actions in DNS policies allow you to choose what to do with a given set of elements. You can assign one action per policy.

These are the action types you can choose from:

- Allow
- Block
- Override
- Safe Search
- YouTube Restricted Mode

### Allow

API value: allow

Available selectors

Traffic

- Application
- Authoritative Nameserver IP
- Content Categories
- DNS CNAME Response Value
- DNS MX Response Value
- DNS PTR Response Value
- DNS Resolver IP
- DNS TXT Response Value
- DOH Subdomain
- Domain
- Host
- Indicator Feeds
- Location
- Query Record Type
- Resolved Continent IP Geolocation
- Resolved Country IP Geolocation
- Resolved IP
- Request Context Categories
- Security Categories
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source IP

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Policies with Allow actions allow DNS queries to reach destinations you specify within the Selector and Value fields. For example, the following configuration allows DNS queries to reach domains we categorize as belonging to the Education content category:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | Education | Allow |

#### Disable DNSSEC validation

When you select Disable DNSSEC validation, Gateway will resolve DNS queries even if the cryptographic signature for the DNS record cannot be validated. We do not recommend disabling DNSSEC validation unless you know that the validation failure is due to DNSSEC configuration issues and not malicious attacks.

### Block

API value: block

Available selectors

Traffic

- Application
- Authoritative Nameserver IP
- Content Categories
- DNS CNAME Response Value
- DNS MX Response Value
- DNS PTR Response Value
- DNS Resolver IP
- DNS TXT Response Value
- DOH Subdomain
- Domain
- Host
- Indicator Feeds
- Location
- Query Record Type
- Resolved Continent IP Geolocation
- Resolved Country IP Geolocation
- Resolved IP
- Request Context Categories
- Security Categories
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source IP

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Policies with Block actions block DNS queries to reach destinations you specify within the Selector and Value fields. For example, the following configuration blocks DNS queries from reaching domains we categorize as belonging to the Adult Themes content category:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | Adult Themes | Block |

#### Custom block page

When choosing the Block action, turn on Modify Gateway block behavior to respond to queries with a block page to display to users who go to blocked websites. Optionally, you can override your global block page setting with a URL redirect for the specific DNS policy. For more information, refer to Block page.

If the block page is turned off for a policy, Gateway will respond to queries blocked at the DNS level with an A record of 0.0.0.0 for IPv4 destinations, or with an AAAA record of :: for IPv6 destinations. The browser will display its default connection error page.

To block the resolution of queries for DNS records with types other than A or AAAA, Gateway will respond with the REFUSED (RCODE:5) DNS return code. Gateway will block the request but will not display a block page.

#### WARP client block notifications

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP Secure Web Gateway without DNS filtering | Enterprise |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.1.159.0 |
| macOS | ‚úÖ | 2024.1.160.0 |
| Linux | ‚ùå |  |
| iOS | ‚úÖ | 1.7 |
| Android | ‚úÖ | 1.4 |
| ChromeOS | ‚úÖ | 1.4 |

Turn on Display block notification for WARP Client to display notifications for Gateway block events. Blocked users will receive an operating system notification from the WARP client with a custom message you set. If you do not set a custom message, the WARP client will display a default message. Custom messages must be 100 characters or less. WARP will only display one notification per minute.

Upon selecting the notification, WARP will direct your users to the Gateway block page you have configured. Optionally, you can direct users to a custom URL, such as an internal support form.

When you turn on Send policy context, Gateway will append details of the matching request to the redirected URL as a query string. Not every context field will be included. Potential policy context fields include:

Policy context fields

| Field | Definition | Example |
| --- | --- | --- |
| User email | Email of the user that made the query. | &cf_user_email=user@example.com |
| Site URL | Full URL of the original HTTP request or domain name in DNS query. | &cf_site_uri=https%3A%2F%2Fmalware.testcategory.com%2F |
| URL category | Domain categories of the URL to be redirected. | &cf_request_categories=New%20Domains,Newly%20Seen%20Domains |
| Original HTTP referer | For HTTP traffic, the original HTTP referer header of the HTTP request. | &cf_referer=https%3A%2F%2Fexample.com%2F |
| Rule ID | ID of the Gateway policy that matched the request. | &cf_rule_id=6d48997c-a1ec-4b16-b42e-d43ab4d071d1 |
| Source IP | Source IP address of the device that matched the policy. | &cf_source_ip=203.0.113.5 |
| Device ID | UUID of the device that matched the policy. | &cf_device_id=6d48997c-a1ec-4b16-b42e-d43ab4d071d1 |
| Application names | Name of the application the redirected domain corresponds to, if any. | &cf_application_name=Salesforce |
| Filter | The traffic type filter that triggered the block. | &cf_filter=http, &cf_filter=dns, &cf_filter=av, or &cf_filter=l4 |
| Account ID | Cloudflare account ID of the associated Zero Trust account. | &cf_account_id=d57c3de47a013c03ca7e237dd3e61d7d |
| Query ID | ID of the DNS query for which the redirect took effect. | &cf_query_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |
| Connection ID | ID of the proxy connection for which the redirect took effect. | &cf_connection_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |
| Request ID | ID of the HTTP request for which the redirect took effect. | &cf_request_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |

Ensure that your operating system allows notifications for WARP. Your device may not display notifications if focus, do not disturb, or screen sharing settings are turned on. To turn on client notifications on macOS devices running DisplayLink software, you may have to allow system notifications when mirroring your display. For more information, refer to the macOS documentation ‚Üó.

### Override

API value: override

Available selectors

The Override action cannot be used with selectors evaluated during or after DNS resolution.

Traffic

- Application
- Content Categories
- DNS Resolver IP
- DOH Subdomain
- Domain
- Host
- Location
- Query Record Type
- Resolved Continent IP Geolocation
- Resolved Country IP Geolocation
- Security Categories
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source IP

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Policies with Override actions allow you to respond to all DNS queries for a given domain to another destination. For example, you can provide a custom response IP of 1.2.3.4 for all queries to www.example.com with the following policy:

| Selector | Operator | Value | Action | Override Hostname |
| --- | --- | --- | --- | --- |
| Hostname | is | www.example.com | Override | 1.2.3.4 |

### Safe Search

API value: safesearch

Available selectors

Traffic

- Application
- Content Categories
- DNS Resolver IP
- DOH Subdomain
- Domain
- Host
- Location
- Query Record Type
- Resolved Continent IP Geolocation
- Resolved Country IP Geolocation
- Security Categories
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source IP

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

SafeSearch is a feature of search engines that helps you filter explicit or offensive content. When you enable SafeSearch, the search engine filters explicit or offensive content and returns search results that are safe for children or at work.

You can use Cloudflare Gateway to enable SafeSearch on search engines like Google, Bing, Yandex, YouTube and DuckDuckGo. For example, to enable SafeSearch for Google, you can create the following policy:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Domain | is | google.com | Safe Search |

### YouTube Restricted Mode

API value: ytrestricted

Available selectors

Traffic

- Application
- Content Categories
- DNS Resolver IP
- DOH Subdomain
- Domain
- Host
- Location
- Query Record Type
- Resolved Continent IP Geolocation
- Resolved Country IP Geolocation
- Security Categories
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source IP

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Similarly, you can enforce YouTube Restricted mode by choosing the YouTube Restricted action. YouTube Restricted Mode is an automated filter for adult and offensive content built into YouTube. To enable YouTube Restricted Mode, you could set up a policy like the following:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| DNS Domain | is | youtube.com | YouTube Restricted |

This setup ensures users will be blocked from accessing offensive sites using DNS.

## Selectors

Gateway matches DNS queries against the following selectors, or criteria:

### Application

You can apply DNS policies to a growing list of popular web applications. Refer to Application and app types for more information.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Application | any(app.ids[*] in {505}) | Before DNS resolution |

### Authoritative Nameserver IP

Use this selector to match against the IP address of the authoritative nameserver IP address.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Authoritative Nameserver IP | dns.authoritative_ns_ips == 198.51.100.0 | During DNS resolution |

### Content Categories

Use this selector to filter domains belonging to specific content categories.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Content Categories | any(dns.content_category[*] in {1}) | Before DNS resolution |

When using an Allow or Block action, you can optionally block IP addresses or filter categories for CNAME records.

### DNS CNAME Record

Use this selector to filter DNS responses by their CNAME records.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| DNS CNAME Response Value | any(dns.response.cname[*] in {"www.apple.com.edgekey.net"}) | After DNS resolution |

Note

If one CNAME record points to another CNAME record, each record in the chain will be evaluated. For example, if abc.example.com points to xyz.example.com, then your DNS policy will evaluate both abc.example.com and xyz.example.com.

### DNS MX Record

Use this selector to filter DNS responses by their MX records.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| DNS MX Response Value | any(dns.response.mx[*] in {"gmail-smtp-in.l.google.com"}) | After DNS resolution |

### DNS PTR Record

Use this selector to filter DNS responses by their PTR records.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| DNS PTR Response Value | any(dns.response.ptr[*] in {"255.2.0.192.in-addr.arpa"}) | After DNS resolution |

### DNS Resolver IP

Use this selector to apply policies to DNS queries that arrived to your Gateway Resolver IP address aligned with a registered DNS location. For most Gateway customers, this is an IPv4 anycast address and policies created using this IPv4 address will apply to all DNS locations. However, each DNS location has a dedicated IPv6 address and some Gateway customers have been supplied with a dedicated IPv4 address ‚Äî these both can be used to apply policies to specific registered DNS locations.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| DNS Resolver IP | any(dns.resolved_ip[*] == 198.51.100.0) | Before DNS resolution |

### DNS TXT Record

Use this selector to filter DNS responses by their TXT records.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| DNS TXT Response Value | any(dns.response.txt[*] in {"your_text"}) | After DNS resolution |

### DoH Subdomain

Use this selector to match against DNS queries that arrive via DNS-over-HTTPS (DoH) destined for the DoH endpoint configured for each DNS location. For example, you can use a DNS location with a DoH endpoint of abcdefg.cloudflare-gateway.com by choosing the DoH Subdomain selector and inputting a value of abcdefg.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| DOH Subdomain | dns.doh_subdomain == "abcdefg" | Before DNS resolution |

### Domain

Use this selector to match against a domain and all subdomains. For example, you can match example.com and its subdomains, such as www.example.com.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Domain | any(dns.domains[*] == "example.com") | Before DNS resolution |

Gateway policies do not support domains with non-Latin characters directly. To use a domain with non-Latin characters, add it to a list.

### Host

Use this selector to match against only the hostname specified. For example, you can match test.example.com but not example.com or www.test.example.com.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Host | dns.fqdn == "example.com" | Before DNS resolution |

Gateway policies do not support hostnames with non-Latin characters directly. To use a hostname with non-Latin characters, add it to a list.

Note

Some hostnames (example.com) will invisibly redirect to the www subdomain (www.example.com). To match this type of website, use the Domain selector instead of the Host selector.

### Indicator Feeds

Use this selector to match against custom indicator feeds.

You can use a publicly available indicator feed or a custom indicator feed assigned to your account by a designated third-party vendor. For more information on indicator feeds, refer to Custom Indicator Feeds.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Indicator Feeds | dns.indicator_feed | Before DNS resolution |

When using an Allow or Block action, you can optionally block IP addresses or filter categories for CNAME records.

### Location

Use this selector to apply policies to a specific Gateway DNS location or set of locations.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Location | dns.location in {"location_uuid_1" "location_uuid_2"} | Before DNS resolution |

### Query Record Type

Use this selector to choose the DNS resource record type that you would like to apply policies against. For example, you can match A records for a domain but not MX records.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Query Record Type | dns.query_rtype == "TXT" | Before DNS resolution |

### Resolved Continent

Use this selector to filter based on the continent that the query resolves to. Geolocation is determined from the IP address in the response. To specify a continent, enter its two-letter code into the Value field:

- AF - Africa
- AN - Antarctica
- AS - Asia
- EU - Europe
- NA - North America
- OC - Oceania
- SA - South America
- T1 - Tor network

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Resolved Continent IP Geolocation | dns.dst.geo.continent == "EU" | After DNS resolution |

### Resolved Country

Use this selector to filter based on the country that the query resolves to. Geolocation is determined from the IP address in the response. To specify a country, enter its ISO 3166-1 Alpha 2 code ‚Üó in the Value field.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Resolved Country IP Geolocation | dns.dst.geo.country == "RU" | After DNS resolution |

### Resolved IP

Use this selector to filter based on the IP addresses that the query resolves to.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Resolved IP | any(dns.resolved_ips[*] == 198.51.100.0) | After DNS resolution |

### Request Context Categories

Use this selector to match a dynamic list of category IDs sent in the EDNS ‚Üó portion of a DNS query. Gateway includes request context with the OPT code 65050.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Request Context Categories | dns.categories_in_request_context_matches | Before DNS resolution |

### Security Categories

Use this selector to match domains (and optionally, IP addresses) belonging to specific security categories.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Security Categories | any(dns.security_category[*] in {1}) | Before DNS resolution |

When using an Allow or Block action, you can optionally block IP addresses or filter categories for CNAME records.

### Source Continent

Use this selector to filter based on the continent where the query arrived to Gateway from.

Geolocation is determined from the device's public IP address (typically assigned by the user's ISP). To specify a continent, enter its two-letter code into the Value field:

| Continent | Code |
| --- | --- |
| Africa | AF |
| Antarctica | AN |
| Asia | AS |
| Europe | EU |
| North America | NA |
| Oceania | OC |
| South America | SA |
| Tor network | T1 |

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Source Continent IP Geolocation | dns.src.geo.continent == "North America" | Before DNS resolution |

### Source Country

Use this selector to filter based on the country where the query arrived to Gateway from.

Geolocation is determined from the device's public IP address (typically assigned by the user's ISP). To specify a country, enter its ISO 3166-1 Alpha-2 code ‚Üó in the Value field.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Source Country IP Geolocation | dns.src.geo.country == "RU" | Before DNS resolution |

### Source IP

Use this selector to apply policies to the source IP address of DNS queries. For example, this could be the WAN IP address of the stub resolver used by your organization to send queries to Gateway.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Source IP | dns.src_ip == 198.51.100.0 | Before DNS resolution |

### Users

Identity-based selectors include:

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

To use identity-based selectors, enable Gateway with WARP in the Zero Trust WARP client and enroll your user in your organization. For more information, refer to Identity-based policies.

## Comparison operators

Comparison operators are the way Gateway matches traffic to a selector. When you choose a Selector in the dashboard policy builder, the Operator dropdown menu will display the available options for that selector.

| Operator | Meaning |
| --- | --- |
| is | equals the defined value |
| is not | does not equal the defined value |
| in | matches at least one of the defined values |
| not in | does not match any of the defined values |
| in list | in a pre-defined list of values |
| not in list | not in a pre-defined list of values |
| matches regex | regex evaluates to true |
| does not match regex | regex evaluates to false |
| greater than | exceeds the defined number |
| greater than or equal to | exceeds or equals the defined number |
| less than | below the defined number |
| less than or equal to | below or equals the defined number |

## Value

In the Value field, you can input a single value when using an equality comparison operator (such as is) or multiple values when using a containment comparison operator (such as in). Additionally, you can use regular expressions (or regex) to specify a range of values for supported selectors.

### Regular expressions

Gateway uses Rust to evaluate regular expressions. The Rust implementation is slightly different than regex libraries used elsewhere. For more information, refer to our guide for Wildcards. To evaluate if your regex matches, you can use Rustexp ‚Üó.

If you want to match multiple values, you can use the pipe symbol (|) as an OR operator. In Gateway, you do not need to use an escape character (\) before the pipe symbol. For example, the following policy blocks requests to two hostnames if either appears in a request header:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Host | matches regex | .\*whispersystems.org|.\*signal.org | Block |

In addition to regular expressions, you can use logical operators to match multiple values.

## Logical operators

To evaluate multiple conditions in an expression, select the And logical operator. These expressions can be compared further with the Or logical operator.

| Operator | Meaning |
| --- | --- |
| And | match all of the conditions in the expression |
| Or | match any of the conditions in the expression |

The Or operator will only work with conditions in the same expression group. For example, you cannot compare conditions in Traffic with conditions in Identity.

## Limitations

### Third-party filtering conflict

Gateway will not properly filter traffic sent through third-party VPNs or other Internet filtering software, such as iCloud Private Relay ‚Üó or Google Chrome IP Protection ‚Üó. To ensure your DNS policies apply to your traffic, Cloudflare recommends turning off software that may interfere with Gateway.

To turn off iCloud Private Relay, refer to the Apple user guides for macOS ‚Üó or iOS ‚Üó.

### Magic WAN forwarding

To apply DNS policies to queries forwarded through Magic WAN, you can either point your organization's DNS resolver to an IPv6, DoH, or DoT endpoint or request a dedicated resolver IPv4 address. For more information, refer to DNS resolver IPs and hostnames.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Common policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/dns-policies/common-policies/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/dns-policies/common-policies/)

Page options # Common policies

The following policies are commonly used to secure DNS traffic.

Refer to the DNS policies page for a comprehensive list of other selectors, operators, and actions.

## Allow corporate domains

This policy allows users to access official corporate domains. By deploying the policy with high order of precedence, you ensure that employees can access trusted domains even if they fall under a blocked category like Newly seen domains or Login pages.

- Dashboard
- API

| Selector | Operator | Value | Action | Precedence |
| --- | --- | --- | --- | --- |
| Domain | in list | Allowed domains | Allow | 1 |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Allow corporate domains",    "description": "Allow any internal corporate domains added to a list",    "precedence": 0,    "enabled": true,    "action": "allow",    "filters": [        "dns"    ],    "traffic": "any(dns.domains[*] in $<LIST_UUID>)",    "identity": ""  }'
```

To get the UUIDs of your lists, use the List Zero Trust lists endpoint.

## Block security threats

Block security categories such as Command & Control, Botnet and Malware based on Cloudflare's threat intelligence.

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Security Categories | in | All security risks | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-DNS-SecurityCategories-Blocklist",    "description": "Block security categories based on Cloudflare'\''s threat intelligence",    "precedence": 20,    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.security_category[*] in {68 178 80 83 176 175 117 131 134 151 153})",    "identity": ""  }'
```

```
resource "cloudflare_zero_trust_gateway_policy" "block_security_threats" {  account_id  = var.cloudflare_account_id  name        = "All-DNS-SecurityCategories-Blocklist"  description = "Block security categories based on Cloudflare's threat intelligence"  precedence  = 20  enabled     = true  action      = "block"  filters     = ["dns"]  traffic     = "any(dns.security_category[*] in {68 178 80 83 176 175 117 131 134 151 153})"}
```

## Block content categories

The categories included in this policy are not always a security threat, but blocking them can help minimize the risk that your organization is exposed to. For more information, refer to domain categories.

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | Questionable Content, Security Risks, Miscellaneous | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-DNS-ContentCategories-Blocklist",    "description": "Block common content categories that may pose a risk",    "precedence": 30,    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.content_category[*] in {17 85 87 102 157 135 138 180 162 32 169 177 128 15 115 119 124 141 161})",    "identity": ""  }'
```

```
resource "cloudflare_zero_trust_gateway_policy" "block_content_categories" {  account_id  = var.cloudflare_account_id  name        = "All-DNS-ContentCategories-Blocklist"  description = "Block common content categories that may pose a risk"  enabled     = true  action      = "block"  filters     = ["dns"]  traffic     = "any(dns.content_category[*] in {17 85 87 102 157 135 138 180 162 32 169 177 128 15 115 119 124 141 161})"  identity    = ""}
```

## Block a dynamic list of categories

You can add a list of category IDs to the EDNS header ‚Üó of a request sent to Gateway as a JSON object using OPT code 65050. For example:

```
{  "categories": [2, 67, 125, 133]}
```

With the Request Context Categories selector, you can block the category IDs sent with EDNS. This is useful to filter by categories not known at the time of creating a policy, or to enforce device-specific DNS content filtering without reaching your account limit. When Gateway uses this selector to block a DNS query, the request will return an Extended DNS Error (EDE) Code 15 - Blocked error, along with a field containing an array of the matched categories.

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Request Context Category | is | Present | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-DNS-Bock-Category-Matches-In-Request",    "description": "Block all category matches in the request EDNS context",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "dns.categories_in_request_context_matches",    "identity": ""  }'
```

```
resource "cloudflare_zero_trust_gateway_policy" "block_content_categories" {  account_id  = var.cloudflare_account_id  name        = "All-DNS-Bock-Category-Matches-In-Request"  description = "Block all category matches in the request EDNS context"  enabled     = true  action      = "block"  filters     = ["dns"]  traffic     = "dns.categories_in_request_context_matches"  identity    = ""}
```

## Block unauthorized applications

Note

After seven days, view your Shadow IT SaaS Analytics and block additional applications based on what your users are accessing.

To minimize the risk of shadow IT, some organizations choose to limit their users' access to certain web-based tools and applications. For example, the following policy blocks known AI tools:

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Application | in | Artificial Intelligence | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-DNS-Application-Blocklist",    "description": "Block access to unauthorized AI applications",    "precedence": 40,    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(app.type.ids[*] in {25})",    "identity": ""  }'
```

```
resource "cloudflare_zero_trust_gateway_policy" "block_unauthorized_apps" {  account_id  = var.cloudflare_account_id  name        = "All-DNS-Application-Blocklist"  description = "Block access to unauthorized AI applications"  enabled     = true  action      = "block"  filters     = ["dns"]  traffic     = "any(app.type.ids[*] in {25})"  identity    = ""}
```

## Block banned countries

You can implement policies to block websites hosted in countries categorized as high risk. The designation of such countries may result from your organization's customers or through the implementation of regulations including EAR ‚Üó, OFAC ‚Üó, and ITAR ‚Üó.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Resolved Country IP Geolocation | in | Afghanistan, Belarus, Congo (Kinshasa), Cuba, Iran, Iraq, Korea, North, Myanmar, Russian Federation, Sudan, Syria, Ukraine, Zimbabwe | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block banned countries",    "description": "Block access to banned countries",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.dst.geo.country[*] in {\"AF\" \"BY\" \"CD\" \"CU\" \"IR\" \"IQ\" \"KP\" \"MM\" \"RU\" \"SD\" \"SY\" \"UA\" \"ZW\"})",    "identity": ""  }'
```

## Block top-level domains

Blocking frequently misused ‚Üó top-level domains (TLDs) can reduce security risks, especially when there is no discernible advantage to be gained from allowing access. Similarly, restricting access to specific country-level TLDs may be necessary to comply with regulations like ITAR ‚Üó or OFAC ‚Üó.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Domain | matches regex | [.](cn|ru)$ | Or | Block |
| Domain | matches regex | [.](rest|hair|top|live|cfd|boats|beauty|mom|skin|okinawa)$ | Or |  |
| Domain | matches regex | [.](zip|mobi)$ |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block top-level domains",    "description": "Block top-level domains that are frequently used for malicious practices",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.domains[*] matches \"[.](cn|ru)$\") or any(dns.domains[*] matches \"[.](rest|hair|top|live|cfd|boats|beauty|mom|skin|okinawa)$\") or any(dns.domains[*] matches \"[.](zip|mobi)$\")",    "identity": ""  }'
```

## Block phishing attacks

To protect against sophisticated phishing attacks ‚Üó, you could prevent users from accessing phishing domains that are specifically targeting your organization. The following policy blocks specific keywords associated with an organization or its authentication services (such as okta, 2fa, cloudflare or sso), while still allowing access to official corporate domains.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Domain | not in list | Corporate Domains | And | Block |
| Domain | matches regex | .*okta.*|.*cloudflare.*|.*mfa.*|.sso.* |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block phishing attacks",    "description": "Block attempts to phish specific domains targeting your organization",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "not(any(dns.domains[*] in $<LIST_UUID>)) and any(dns.domains[*] matches \".*okta.*\\|.*cloudflare.*\\|.*mfa.*\\|.sso.*\")",    "identity": ""  }'
```

To get the UUIDs of your lists, use the List Zero Trust lists endpoint.

## Block online tracking

To safeguard user privacy, some organizations will block tracking domains such as dig.whatsapp.com as well as other tracking domains embedded at the OS level. This policy is implemented by creating a custom blocklist. Refer to this repository ‚Üó for a list of widespread tracking domains that you can add to your blocklist.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Domain | in list | Top tracking domains | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block online tracking",    "description": "Block domains used for tracking at an OS level",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.domains[*] in $<LIST_UUID>)",    "identity": ""  }'
```

To get the UUIDs of your lists, use the List Zero Trust lists endpoint.

## Block malicious IPs

Block specific IP addresses that are known to be malicious or pose a threat to your organization. This policy is usually implemented by creating custom blocklists or by using blocklists provided by threat intelligence partners or regional Computer Emergency and Response Teams (CERTs).

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Resolved IP | in list | DShield | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block malicious IPs",    "description": "Block specific IP addresses that are known to be malicious or pose a threat to your organization",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.resolved_ips[*] in $<LIST_UUID>)",    "identity": ""  }'
```

To get the UUIDs of your lists, use the List Zero Trust lists endpoint.

## Turn on CIPA filter

The CIPA (Children's Internet Protection Act) Filter is a collection of subcategories that encompass a wide range of topics that could be harmful or inappropriate for minors. It is used as a part of Project Cybersafe Schools to block access to unwanted or harmful online content. Upon creating this policy, your organization will have minimum CIPA compliance ‚Üó.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | CIPA Filter | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Turn on CIPA filter",    "description": "Block access to unwanted or harmful online content for children",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.content_category[*] in {182})",    "identity": ""  }'
```

## Hide explicit search results

SafeSearch is a feature of search engines that helps you filter explicit or offensive content. You can force SafeSearch on search engines like Google, Bing, Yandex, YouTube, and DuckDuckGo:

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | Search Engines | Safe Search |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Hide explicit search results",    "description": "Force SafeSearch on search engines to filter explicit or offensive content",    "enabled": true,    "action": "safesearch",    "filters": [        "dns"    ],    "traffic": "any(dns.content_category[*] in {145})",    "identity": ""  }'
```

## Check user identity

Configure access on a per user or group basis by adding identity-based conditions to your policies.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application | in | Salesforce | And | Block |
| User Group Names | in | Contractors |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Check user identity",    "description": "Filter traffic based on a user identity group name",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(app.ids[*] in {606})",    "identity": "any(identity.groups.name[*] in {\"Contractors\"})"  }'
```

## Restrict access to specific groups

Filter DNS queries to allow only specific users access.

The following example includes two policies. The first policy allows the specified group, while the second policy blocks all other users. To ensure the policies are evaluated properly, place the Allow policy above the Block policy. For more information, refer to the order of precedence.

### 1. Allow a group

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Content Categories | in | Social Networks | And | Allow |
| User Group Names | in | Marketing |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Allow social media for Marketing",    "description": "Allow access to social media sites for users in the Marketing group",    "precedence": 1,    "enabled": true,    "action": "allow",    "filters": [        "dns"    ],    "traffic": "any(dns.content_category[*] in {149})",    "identity": "any(identity.groups.name[*] in {\"Marketing\"})"  }'
```

### 2. Block all other users

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | Social Networks | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block social media",    "description": "Block social media for all other users",    "precedence": 2,    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.content_category[*] in {149})",    "identity": ""  }'
```

## Control IP version

Enterprise users can pair these policies with an egress policy to control which IP version is used to egress to the origin server.

Optionally, you can use the Domain selector to control the IP version for specific sites.

Note

To ensure traffic routes through your preferred IP version, turn off Modify Gateway block behavior.

### Force IPv4

Force users to connect with IPv4 by blocking IPv6 resolution.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Query Record Type | is | AAAA | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Force IPv4",    "description": "Force users to connect with IPv4 by blocking IPv6 resolution",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "dns.query_rtype == \"AAAA\"",    "identity": ""  }'
```

### Force IPv6

Force users to connect with IPv6 by blocking IPv4 resolution.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Query Record Type | is | A | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Force IPv6",    "description": "Force users to connect with IPv6 by blocking IPv4 resolution",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "dns.query_rtype == \"A\"",    "identity": ""  }'
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Test DNS filtering

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/dns-policies/test-dns-filtering/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/dns-policies/test-dns-filtering/)

Page options # Test DNS filtering

This section covers how to validate your Gateway DNS configuration.

## Prerequisites

Before you start, make sure you are connected to a network that is associated with the DNS location where the policy is applied.

## Test a DNS policy

Once you have created a DNS policy to block a domain, you can use either dig or nslookup to see if the policy is working as intended.

For example, if you created a policy to block example.com, you can do the following to see if Gateway is successfully blocking example.com:

1. Open your terminal.
2. Type dig example.com (nslookup example.com if you are using Windows) and press Enter.
3. If the block page is turned off for the policy, you should see REFUSED in the answer section:
Terminal windowdig example.com
; <<>> DiG 9.10.6 <<>> example.com;; global options: +cmd;; Got answer:;; ->>HEADER<<- opcode: QUERY, status: REFUSED, id: 6503;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 0
;; QUESTION SECTION:;example.com.                   IN      A
;; Query time: 46 msec;; SERVER: 172.64.36.1#53(172.64.36.1);; WHEN: Tue Mar 10 20:22:18 CDT 2020;; MSG SIZE  rcvd: 29
If the block page is enabled for the policy, you should see NOERROR in the answer section with 162.159.36.12 and 162.159.46.12 as the answers:
Terminal windowdig example.com
; <<>> DiG 9.10.6 <<>> example.com;; global options: +cmd;; Got answer:;; ->>HEADER<<- opcode: QUERY, status: NOERROR id: 14531;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1
;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 1452;; QUESTION SECTION:;example.com.                   IN      A
;;ANSWER SECTION:example.com.            60      IN      A                  162.159.36.12example.com.            60      IN      A                  162.159.46.12
;; Query time: 53 msec;; SERVER: 172.64.36.1#53(172.64.36.1);; WHEN: Tue Mar 10 20:19:52 CDT 2020;; MSG SIZE  rcvd: 83

### Test a security or content category

If you are blocking a security category or a content category, you can test that the policy is working by using the test domain associated with each category.

Once you have configured your Gateway policy to block the category, the test domain will show a block page when you attempt to visit the domain in your browser, or will return REFUSED when you perform dig using the command-line interface.

#### Test domain format

- One-word category ‚Äî For categories with one-word names (for example, Malware), the test domain uses the following format:
<NAME_OF_CATEGORY>.testcategory.com
- Multi-word category ‚Äî For categories with multiple words in the name (for example, Parked & For Sale Domains), the test domain uses the following format:

Remove any spaces between the words
Replace & with and
Lowercase all letters
- Remove any spaces between the words
- Replace & with and
- Lowercase all letters

#### Common test domains

| Category | Test domain |
| --- | --- |
| Anonymizer | anonymizer.testcategory.com |
| Command and Control & Botnet | commandandcontrolandbotnet.testcategory.com |
| compromised Domain | compromiseddomain.testcategory.com |
| Cryptomining | cryptomining.testcategory.com |
| Malware | malware.testcategory.com |
| New Domains | newdomains.testcategory.com |
| Parked & For Sale Domains | parkedandforsaledomains.testcategory.com |
| Phishing | phishing.testcategory.com |
| Potentially Unwanted Software | potentiallyunwantedsoftware.testcategory.com |
| Private IP Address | privateipaddress.testcategory.com |
| Spam | spam.testcategory.com |
| Spyware | spyware.testcategory.com |
| Unreachable | unreachable.testcategory.com |

## Test EDNS configuration

If you enabled EDNS client subnet for your DNS location, you can validate EDNS as follows:

1. Obtain your DNS location's DOH subdomain:

In Zero Trust ‚Üó, go to Gateway > DNS locations.
Select the DNS location you are testing.
Note the value of DNS over HTTPS.
2. In Zero Trust ‚Üó, go to Gateway > DNS locations.
3. Select the DNS location you are testing.
4. Note the value of DNS over HTTPS.
5. Open a terminal and run the following command:
Terminal windowcurl 'https://<DOH_SUBDOMAIN>.cloudflare-gateway.com/dns-query?type=TXT&name=o-o.myaddr.google.com' -H 'Accept: application/dns-json' | json_pp
The output should contain your EDNS client subnet:
{  "AD": false,  "Answer": [    {      "TTL": 60,      "data": "\"108.162.218.211\"",      "name": "o-o.myaddr.google.com",      "type": 16    },    {      "TTL": 60,      "data": "\"edns0-client-subnet 136.62.0.0/24\"",      "name": "o-o.myaddr.google.com",      "type": 16    }  ],  "CD": false,  "Question": [    {      "name": "o-o.myaddr.google.com",      "type": 16    }  ],  "RA": true,  "RD": true,  "Status": 0,  "TC": false}
6. To verify your EDNS client subnet, obtain your source IP address:
Terminal windowcurl ifconfig.me
136.62.12.156%
The source IP address should fall within the /24 range specified by your EDNS client subnet.

## Clear DNS cache

Modern web browsers and operating systems are designed to cache DNS records for a set amount of time. When a request is made for a DNS record, the browser cache is the first location checked for the requested record. A DNS policy may not appear to work if the response is already cached.

To clear your DNS cache:

ChromeOS

1. Go to chrome://net-internals/#dns.
2. Select Clear host cache.

Windows

1. Open the admin command prompt or PowerShell.
2. Run the following command:

Terminal window ```
ipconfig /flushdns
```

macOS

1. Open Terminal.
2. Run the following commands:

Terminal window ```
sudo killall -HUP mDNSRespondersudo killall mDNSResponderHelpersudo dscacheutil -flushcache
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Timed DNS policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/dns-policies/timed-policies/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/dns-policies/timed-policies/)

Page options # Timed DNS policies

By default, Cloudflare Gateway policies apply at all times when turned on. Gateway allows you to configure any DNS policy to activate for a specific amount of time, until an end time, or on a regular time interval.

## Time-based policy duration

You can use a time-based policy duration to set a specific time frame for the policy to turn on or configure an exact time for the policy to turn off.

To set a duration for a DNS policy:

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies > DNS.
2. Create a new DNS policy or choose an existing policy and select Edit.
3. In Configure policy settings, turn on Set a policy duration.
4. In Input method, choose Duration and enter a specific amount of time until the policy turns off or choose Exact end date and enter a specific date and time in your account's time zone for the policy to turn off.
5. Select Save policy.

When a policy turns off, it will remain off until you turn it back on.

Policies with a set duration will retain their duration when turned off or on. For example, you can create a policy at 12:00 PM and set it to turn off after six hours. If you turn the policy off at 3:00 PM and turn it back on 4:00 PM, the policy will still turn off at 6:00 PM, six hours after the original time.

### Reset a policy duration

When a policy's time duration expires, you can turn the policy back on for the duration you originally configured. To reset a policy's duration, select the policy and choose Reset policy duration.

For policies with an exact end time, you can change the time before the policy turns off. Once the policy reaches its exact end time, you will need to edit the policy and set a new end time. To set a new exact end time:

1. Select the policy.
2. Choose Edit.
3. Turn on Set a policy duration.
4. In Input method, choose Exact end date. In Date and time, enter a new date and time for the policy to turn off.
5. Select Save policy.

## Scheduled policies

You can use the Gateway API to create a new DNS policy with a schedule or add a schedule to an existing policy. To schedule a policy, use the Create a Zero Trust Gateway rule endpoint or Update a Zero Trust Gateway rule endpoint with the schedule parameter set to your desired days of the week, times of day, and an optional time zone. The schedule will appear in Zero Trust under Gateway > Firewall policies > DNS when you select the policy.

### How Gateway determines time zone

If you assign a time zone to your schedule, Gateway will always use the current time at that time zone regardless of the user's location. This allows you to enable a policy during a certain fixed time period.

If you do not specify a time zone, Gateway will enable the DNS policy based on the user's local time zone. The user's time zone is inferred from the IP geolocation of their source IP address. If Gateway is unable to determine the time zone from the source IP, we will fall back to the time zone of the data center where the query was received.

#### Example: Fixed time zone

The following command creates a DNS policy to block facebook.com only on weekdays from 8:00 AM - 12:30 PM and 1:30 PM - 5:00 PM in the Chicago, USA time zone.

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "office-no-facebook-policy",    "action": "block",    "traffic": "dns.fqdn == \"facebook.com\"",    "enabled": true,    "schedule": {        "time_zone": "America/Chicago",        "mon": "08:00-12:30,13:30-17:00",        "tue": "08:00-12:30,13:30-17:00",        "wed": "08:00-12:30,13:30-17:00",        "thu": "08:00-12:30,13:30-17:00",        "fri": "08:00-12:30,13:30-17:00"    }  }'
```

Refer to this table ‚Üó for a list of all time zone identifiers.

#### Example: User's time zone

The following command creates a DNS policy to block clockin.com only on weekends in the time zone where the user is currently located.

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "clock-in-policy",    "action": "block",    "traffic": "dns.fqdn == \"clockin.com\"",    "enabled": true,    "schedule": {        "sat": "00:00-24:00",        "sun": "00:00-24:00"    }  }'
```

Note

Gateway will not change the policy's enabled status when inside or outside of the time period specified. When enabled, Gateway activates or deactivates the policy according to its schedule. When disabled, the policy is always deactivated.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Network policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/network-policies/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/network-policies/)

Page options # Network policies

Note

To enable this feature, download and deploy the WARP client on your devices.

With Cloudflare Zero Trust, you can configure policies to control network-level traffic leaving your endpoints. Using network selectors like IP addresses and ports, your policies will control access to any network origin. Because Cloudflare Zero Trust integrates with your identity provider, it also gives you the ability to create identity-based network policies. This means you can now control access to non-HTTP resources on a per-user basis regardless of where they are or what device they access that resource from.

A network policy consists of an Action as well as a logical expression that determines the scope of the action. To build an expression, you need to choose a Selector and an Operator, and enter a value or range of values in the Value field. You can use And and Or logical operators to evaluate multiple conditions.

- Actions
- Selectors
- Comparison operators
- Value
- Logical operators

If a condition in an expression joins a query attribute (such as Source IP) and a response attribute (such as Resolved IP), then the condition will be evaluated when the response is received.

Terraform provider v4 precedence limitation

To avoid conflicts, version 4 of the Terraform Cloudflare provider applies a hash calculation to policy precedence. For example, a precedence of 1000 may become 1000901. This can cause errors when reordering policies. To avoid this issue, manually set the precedence of policies created with Terraform using the Update a Zero Trust Gateway rule endpoint.

To ensure your precedence is set correctly, Cloudflare recommends upgrading your Terraform provider to version 5 ‚Üó.

## Actions

Like actions in DNS and HTTP policies, actions in network policies define which decision you want to apply to a given set of elements. You can assign one action per policy.

### Allow

API value: allow

Available selectors

Traffic

- Access Infrastructure Target
- Access Private App
- Application
- Content Categories
- Destination Continent IP Geolocation
- Destination Country IP Geolocation
- Destination IP
- Destination Port
- Detected Protocol
- Protocol
- Proxy Endpoint
- Security Risks
- SNI
- SNI Domain
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source Internal IP
- Source IP
- Source Port
- Virtual Network

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Device Posture

- Passed Device Posture Checks

Policies with Allow actions allow network traffic to reach certain IPs or ports. For example, the following configuration allows specific users to reach a given IP address:

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Destination IP | in | 92.100.02.102 | And | Allow |
| Email | in | *@example.com |  |  |

### Audit SSH Deprecated

API value: audit_ssh

Available selectors

Traffic

- Application
- Destination Continent IP Geolocation
- Destination Country IP Geolocation
- Destination IP
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source Internal IP
- Source IP
- Source Port
- Virtual Network

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Device Posture

- Passed Device Posture Checks

Warning

Gateway no longer supports the Audit SSH action for new policies. To log your SSH traffic, Cloudflare recommends deploying Access for Infrastructure for your SSH server and configuring SSH command logs.

Policies with Audit SSH actions allow administrators to log SSH traffic. Gateway will detect SSH traffic over port 22. For example, the following configuration logs SSH commands sent to a given IP address:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Destination IP | in | 203.0.113.83 | Audit SSH |

Gateway only audits SSH traffic over port 22. Non-standard ports, including those specified with the Destination Port selector, are not supported.

For more information on SSH logging, refer to Configure SSH proxy and command logs.

### Block

API value: block

Available selectors

Traffic

- Access Infrastructure Target
- Access Private App
- Application
- Content Categories
- Destination Continent IP Geolocation
- Destination Country IP Geolocation
- Destination IP
- Destination Port
- Detected Protocol
- Protocol
- Proxy Endpoint
- Security Risks
- SNI
- SNI Domain
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source Internal IP
- Source IP
- Source Port
- Virtual Network

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Device Posture

- Passed Device Posture Checks

Policies with Block actions block network traffic from reaching certain IPs or ports. For example, the following configuration blocks all traffic directed to port 443:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Destination Port | in | 443 | Block |

#### WARP client block notifications

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP Secure Web Gateway without DNS filtering | Enterprise |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.1.159.0 |
| macOS | ‚úÖ | 2024.1.160.0 |
| Linux | ‚ùå |  |
| iOS | ‚úÖ | 1.7 |
| Android | ‚úÖ | 1.4 |
| ChromeOS | ‚úÖ | 1.4 |

Turn on Display block notification for WARP Client to display notifications for Gateway block events. Blocked users will receive an operating system notification from the WARP client with a custom message you set. If you do not set a custom message, the WARP client will display a default message. Custom messages must be 100 characters or less. WARP will only display one notification per minute.

Upon selecting the notification, WARP will direct your users to the Gateway block page you have configured. Optionally, you can direct users to a custom URL, such as an internal support form.

When you turn on Send policy context, Gateway will append details of the matching request to the redirected URL as a query string. Not every context field will be included. Potential policy context fields include:

Policy context fields

| Field | Definition | Example |
| --- | --- | --- |
| User email | Email of the user that made the query. | &cf_user_email=user@example.com |
| Site URL | Full URL of the original HTTP request or domain name in DNS query. | &cf_site_uri=https%3A%2F%2Fmalware.testcategory.com%2F |
| URL category | Domain categories of the URL to be redirected. | &cf_request_categories=New%20Domains,Newly%20Seen%20Domains |
| Original HTTP referer | For HTTP traffic, the original HTTP referer header of the HTTP request. | &cf_referer=https%3A%2F%2Fexample.com%2F |
| Rule ID | ID of the Gateway policy that matched the request. | &cf_rule_id=6d48997c-a1ec-4b16-b42e-d43ab4d071d1 |
| Source IP | Source IP address of the device that matched the policy. | &cf_source_ip=203.0.113.5 |
| Device ID | UUID of the device that matched the policy. | &cf_device_id=6d48997c-a1ec-4b16-b42e-d43ab4d071d1 |
| Application names | Name of the application the redirected domain corresponds to, if any. | &cf_application_name=Salesforce |
| Filter | The traffic type filter that triggered the block. | &cf_filter=http, &cf_filter=dns, &cf_filter=av, or &cf_filter=l4 |
| Account ID | Cloudflare account ID of the associated Zero Trust account. | &cf_account_id=d57c3de47a013c03ca7e237dd3e61d7d |
| Query ID | ID of the DNS query for which the redirect took effect. | &cf_query_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |
| Connection ID | ID of the proxy connection for which the redirect took effect. | &cf_connection_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |
| Request ID | ID of the HTTP request for which the redirect took effect. | &cf_request_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |

Ensure that your operating system allows notifications for WARP. Your device may not display notifications if focus, do not disturb, or screen sharing settings are turned on. To turn on client notifications on macOS devices running DisplayLink software, you may have to allow system notifications when mirroring your display. For more information, refer to the macOS documentation ‚Üó.

### Network Override

API value: l4_override

Available selectors

Traffic

- Destination Continent IP Geolocation
- Destination Country IP Geolocation
- Destination IP
- Destination Port
- Protocol
- SNI
- SNI Domain
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source Internal IP
- Source IP
- Source Port
- Virtual Network

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Device Posture

- Passed Device Posture Checks

Policies with Network Override actions override traffic directed to or coming from certain IPv4/IPv6 addresses or ports. Destination IPs can be public IPs or private IPs connected to your Zero Trust network. For example, the following configuration overrides traffic sent to a public IP with a private IP based on a user's identity:

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Destination IP | in | 95.92.143.151 | And | Network Override |
| User Email | in | *@example.com | And |  |
| Override IP |  | 10.0.0.1 |  |  |

Gateway will only log successful override connections in your network logs. If the override destination IP does not exist, Gateway will override the destination IP but will not log the override action.

## Selectors

Gateway matches network traffic against the following selectors, or criteria.

### Access Infrastructure Target

All targets secured by an Access infrastructure application.

| UI name | API example |
| --- | --- |
| Access Infrastructure Target | access.target |

### Access Private App

All destination IPs and hostnames secured by an Access self-hosted private application.

| UI name | API example |
| --- | --- |
| Access Private App | access.private_app |

### Application

You can apply network policies to a growing list of popular web applications. Refer to Application and app types for more information.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Application | any(app.ids[*] in {505}) | Before DNS resolution |

### Content Categories

Applications within a specific security category as categorized by Cloudflare Radar.

| UI name | API example |
| --- | --- |
| Content Categories | any(net.fqdn.content_category[*] in {1}) |

### Destination Continent

The continent where the request is destined. Geolocation is determined from the target IP address. To specify a continent, enter its two-letter code into the Value field:

| Continent | Code |
| --- | --- |
| Africa | AF |
| Antarctica | AN |
| Asia | AS |
| Europe | EU |
| North America | NA |
| Oceania | OC |
| South America | SA |
| Tor network | T1 |

| UI name | API example |
| --- | --- |
| Destination Continent IP Geolocation | net.dst.geo.continent == "EU" |

### Destination Country

The country that the request is destined for. Geolocation is determined from the target IP address. To specify a country, enter its ISO 3166-1 Alpha 2 code ‚Üó in the Value field.

| UI name | API example |
| --- | --- |
| Destination Country IP Geolocation | net.dst.geo.country == "RU" |

### Destination IP

The IP address of the request's target.

| UI name | API example |
| --- | --- |
| Destination IP | any(net.dst.ip[*] in {10.0.0.0/8}) |

### Destination Port

The port number of the request's target.

| UI name | API example |
| --- | --- |
| Destination Port | net.dst.port == 2222 |

### Detected Protocol

The inferred network protocol based on Cloudflare's protocol detection.

| UI name | API example |
| --- | --- |
| Detected Protocol | net.protocol.detection == "ssh" |

### Device Posture

With the Device Posture selector, admins can use signals from end-user devices to secure access to their internal and external resources. For example, a security admin can choose to limit all access to internal applications based on whether specific software is installed on a device and/or if the device or software are configured in a particular way.

For more information on device posture checks, refer to Device posture.

| UI name | API example |
| --- | --- |
| Passed Device Posture Checks | any(device_posture.checks.failed[*] in {"1308749e-fcfb-4ebc-b051-fe022b632644"}), any(device_posture.checks.passed[*] in {"1308749e-fcfb-4ebc-b051-fe022b632644"})" |

### Protocol

The protocol used to send the packet.

| UI name | API example |
| --- | --- |
| Protocol | net.protocol == "tcp" |

Note

To enable Gateway filtering on TCP and UDP, go to Settings > Network > Proxy. Network policies apply to all enabled protocols unless you use the Protocol selector within a policy.

### Proxy Endpoint

The proxy server where your browser forwards HTTP traffic.

| UI name | API example |
| --- | --- |
| Proxy Endpoint | proxy.endpoint == "3ele0ss56t.proxy.cloudflare-gateway.com" |

### Security Categories

Applications within a specific security category as categorized by Cloudflare Radar.

| UI name | API example |
| --- | --- |
| Security Risks | any(net.fqdn.security_category[*] in {1}) |

### SNI

The host whose Server Name Indication (SNI) header Gateway will filter traffic against. This will allow for an exact match.

By default, this selector only applies to HTTPS traffic on port 443. To inspect traffic on every port, turn on protocol detection and choose to inspect on all ports.

| UI name | API example |
| --- | --- |
| SNI | net.sni.host == "www.example.com" |

### SNI Domain

The domain whose Server Name Indication (SNI) header Gateway will filter traffic against. For example, a rule for example.com will match example.com, www.example.com, and my.test.example.com.

By default, this selector only applies to HTTPS traffic on port 443. To inspect traffic on every port, turn on protocol detection and choose to inspect on all ports.

| UI name | API example |
| --- | --- |
| SNI Domain | net.sni.domains == "example.com" |

### Source Continent

The continent of the user making the request.

Geolocation is determined from the device's public IP address (typically assigned by the user's ISP). To specify a continent, enter its two-letter code into the Value field:

| Continent | Code |
| --- | --- |
| Africa | AF |
| Antarctica | AN |
| Asia | AS |
| Europe | EU |
| North America | NA |
| Oceania | OC |
| South America | SA |
| Tor network | T1 |

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Source Continent IP Geolocation | net.src.geo.continent == "North America" | Before DNS resolution |

### Source Country

The country of the user making the request.

Geolocation is determined from the device's public IP address (typically assigned by the user's ISP). To specify a country, enter its ISO 3166-1 Alpha-2 code ‚Üó in the Value field.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Source Country IP Geolocation | net.src.geo.country == "RU" | Before DNS resolution |

### Source Internal IP

Use this selector to apply network policies to a private IP address, assigned by a user's local network, that requests arrive to Gateway from. This selector will only apply to users connected through a Magic GRE or IPSec tunnel.

| UI name | API example |
| --- | --- |
| Source Internal IP | net.src.internal_src_ip == "192.168.86.0/27" |

### Source IP

The originating IP address or addresses of a device proxied by Gateway.

| UI name | API example |
| --- | --- |
| Source IP | net.src.ip[*] in {10.0.0.0/8} |

### Source Port

The originating port of a device proxied by Gateway.

| UI name | API example |
| --- | --- |
| Source Port | net.src.port == "2222" |

### Users

Identity-based selectors include:

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

To use identity-based selectors, enable Gateway with WARP in the Zero Trust WARP client and enroll your user in your organization. For more information, refer to Identity-based policies.

### Virtual Network

Use this selector to match all traffic routed through a specific Tunnel Virtual Network via the WARP client.

| UI name | API example |
| --- | --- |
| Virtual Network | net.vnet_id == "957fc748-591a-e96s-a15d-1j90204a7923" |

## Comparison operators

Comparison operators are the way Gateway matches traffic to a selector. When you choose a Selector in the dashboard policy builder, the Operator dropdown menu will display the available options for that selector.

| Operator | Meaning |
| --- | --- |
| is | equals the defined value |
| is not | does not equal the defined value |
| in | matches at least one of the defined values |
| not in | does not match any of the defined values |
| in list | in a pre-defined list of values |
| not in list | not in a pre-defined list of values |
| matches regex | regex evaluates to true |
| does not match regex | regex evaluates to false |
| greater than | exceeds the defined number |
| greater than or equal to | exceeds or equals the defined number |
| less than | below the defined number |
| less than or equal to | below or equals the defined number |

Note

The in operator allows you to specify IP addresses or networks using CIDR notation.

## Value

In the Value field, you can input a single value when using an equality comparison operator (such as is) or multiple values when using a containment comparison operator (such as in). Additionally, you can use regular expressions (or regex) to specify a range of values for supported selectors.

### Regular expressions

Gateway uses Rust to evaluate regular expressions. The Rust implementation is slightly different than regex libraries used elsewhere. For more information, refer to our guide for Wildcards. To evaluate if your regex matches, you can use Rustexp ‚Üó.

If you want to match multiple values, you can use the pipe symbol (|) as an OR operator. In Gateway, you do not need to use an escape character (\) before the pipe symbol. For example, the following policy blocks requests to two SNI hosts if either appears in a request header:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| SNI | matches regex | .\*whispersystems.org|.\*signal.org | Block |

In addition to regular expressions, you can use logical operators to match multiple values.

## Logical operators

To evaluate multiple conditions in an expression, select the And logical operator. These expressions can be compared further with the Or logical operator.

| Operator | Meaning |
| --- | --- |
| And | match all of the conditions in the expression |
| Or | match any of the conditions in the expression |

The Or operator will only work with conditions in the same expression group. For example, you cannot compare conditions in Traffic with conditions in Identity or Device Posture.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Common policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/network-policies/common-policies/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/network-policies/common-policies/)

Page options # Common policies

The following policies are commonly used to secure network traffic.

Refer to the network policies page for a comprehensive list of other selectors, operators, and actions.

## Block unauthorized applications

Note

After seven days, view your Shadow IT SaaS Analytics and block additional applications based on what your users are accessing.

To minimize the risk of shadow IT, some organizations choose to limit their users' access to certain web-based tools and applications. For example, the following policy blocks known AI tools:

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Application | in | Artificial Intelligence | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block unauthorized applications",    "description": "Block access to unauthorized AI applications",    "enabled": true,    "action": "block",    "filters": [        "l4"    ],    "traffic": "any(app.type.ids[*] in {25})",    "identity": "",    "device_posture": ""  }'
```

## Check user identity

Configure access on a per user or group basis by adding identity-based conditions to your policies.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application | in | Salesforce | And | Block |
| User Group Names | in | Contractors |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Check user identity",    "description": "Block access to Salesforce by temporary employees and contractors",    "enabled": true,    "action": "block",    "filters": [        "l4"    ],    "traffic": "any(app.ids[*] in {606})",    "identity": "any(identity.groups.name[*] in {\"Contractors\"})",    "device_posture": ""  }'
```

## Enforce device posture

Require devices to have certain software installed or other configuration attributes. For instructions on enabling a device posture check, refer to the device posture section. For example, you can use a list of device serial numbers to ensure users can only access an application if they connect with the WARP client from a company device:

In the following example, you can use a list of device serial numbers to ensure users can only access an application if they connect with the WARP client from a company device:

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| SNI Domain | is | internalapp.com | And | Block |
| Passed Device Posture Checks | not in | Device serial numbers |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-NET-ApplicationAccess-Allow",    "description": "Ensure access to the application comes from authorized WARP clients",    "precedence": 70,    "enabled": false,    "action": "block",    "filters": [        "l4"    ],    "traffic": "any(net.sni.domains[*] == \"internalapp.com\")",    "device_posture": "not(any(device_posture.checks.passed[*] in {\"<DEVICE_SERIAL_NUMBERS_LIST_UUID>\"}))"  }'
```

To get the UUIDs of your device posture checks, use the List device posture rules endpoint.

```
resource "cloudflare_zero_trust_gateway_policy" "all_net_applicationaccess_allow" {  account_id  = var.cloudflare_account_id  name        = "All-NET-ApplicationAccess-Allow"  description = "Ensure access to the application comes from authorized WARP clients"  precedence  = 70  enabled     = false  action      = "block"  filters     = ["l4"]  traffic     = "any(net.sni.domains[*] == \"internalapp.com\")"  posture      =  "not(any(device_posture.checks.passed[*] in {\"${"$"}${cloudflare_zero_trust_list.allowed_devices_sn_list.id}\"}))"}
```

## Enforce session duration

To require users to re-authenticate after a certain amount of time has elapsed, configure WARP sessions.

## Allow only approved traffic

Restrict user access to only the specific sites or applications configured in your HTTP policies.

### 1. Allow HTTP and HTTPS traffic

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Detected Protocol | is | TLS | And | Allow |
| Destination Port | in | 80, 443 |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Allow HTTP and HTTPS traffic",    "description": "Restrict traffic to HTTP and HTTPS traffic",    "enabled": true,    "action": "allow",    "filters": [        "l4"    ],    "traffic": "net.detected_protocol == \"tls\" and net.dst.port in {80 443}",    "identity": "",    "device_posture": ""  }'
```

### 2. Block all other traffic

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Protocol | in | TCP, UDP | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block all other traffic",    "description": "Block all other traffic that is not HTTP or HTTPS",    "enabled": true,    "action": "block",    "filters": [        "l4"    ],    "traffic": "net.protocol in {\"tcp\" \"udp\"}",    "identity": "",    "device_posture": ""  }'
```

## Filter HTTPS traffic when inspecting on all ports

If your organization blocks traffic by default with a network policy and you want to inspect HTTP traffic on all ports, you need to explicitly allow HTTP and TLS traffic to filter it.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Detected Protocol | is | TLS | Or | Allow |
| Detected Protocol | is | HTTP |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Allow on inspect all ports",    "description": "Filter HTTPS traffic when using inspect all ports",    "enabled": true,    "action": "allow",    "filters": [        "l4"    ],    "traffic": "net.detected_protocol == \"tls\" or net.detected_protocol == \"http\"",    "identity": "",    "device_posture": ""  }'
```

## Restrict access to private networks

Restrict access to resources which you have connected through Cloudflare Tunnel.

The following example consists of two policies: the first allows specific users to reach your application, and the second blocks all other traffic.

### 1. Allow company employees

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Destination IP | in | 10.0.0.0/8 | And | Allow |
| User Email | matches regex | .*@example.com |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Allow company employees",    "description": "Allow any users with an organization email to reach the application",    "enabled": true,    "action": "allow",    "filters": [        "l4"    ],    "traffic": "net.dst.ip in {10.0.0.0/8}",    "identity": "identity.email matches \".*@example.com\"",    "device_posture": ""  }'
```

### 2. Block everyone else

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Destination IP | in | 10.0.0.0/8 | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block everyone else",    "description": "Block any other users from accessing the application",    "enabled": true,    "action": "block",    "filters": [        "l4"    ],    "traffic": "net.dst.ip in {10.0.0.0/8}",    "identity": "",    "device_posture": ""  }'
```

## Override IP address

Override traffic directed toward a specific IP address with a different IP address.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Destination IP | in | 203.0.113.17 | And | Network Override |
| Destination Port | is | 80 |  |  |

| Override IP | Override Port |
| --- | --- |
| 1.1.1.1 | 80 |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Override example.com with 1.1.1.1",    "description": "Override a site'\''s IP address with another IP",    "enabled": true,    "action": "l4_override",    "filters": [        "l4"    ],    "traffic": "net.dst.ip in {203.0.113.17} and net.dst.port == 80",    "identity": "",    "device_posture": "",    "rule_settings": {        "l4override": {            "ip": "1.1.1.1",            "port": 80        },        "override_host": "",        "override_ips": null    }  }'
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Protocol detection

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/network-policies/protocol-detection/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/network-policies/protocol-detection/)

Page options # Protocol detection

Gateway supports the detection, logging, and filtering of network protocols using packet attributes.

Protocol detection only applies to devices connected to Zero Trust via the WARP client in Gateway with WARP mode.

## Turn on protocol detection

To turn on protocol detection:

1. In Zero Trust ‚Üó, go to Settings > Network > Firewall.
2. Turn on Protocol Detection.

You can now use Detected Protocol as a selector in a Network policy.

### Inspect on all ports Beta

By default, Gateway will only inspect HTTP traffic through port 80. Additionally, if you turn on TLS decryption, Gateway will inspect HTTPS traffic through port 443.

To detect and inspect HTTP and HTTPS traffic on ports in addition to 80 and 443, under HTTP inspection ports, choose Inspect on all ports.

Inspecting traffic on all ports works best if you allow all traffic by default. If your organization uses a Network policy to block all traffic by default, Gateway will allow all non-HTTPS TLS traffic, and you will not be able to filter this traffic. To use HTTP policies to filter all TLS traffic on all ports when using a default Block Network policy, create a Network policy to explicitly allow HTTP and TLS traffic.

## Supported protocols

Gateway supports detection and filtering of the following protocols:

| Protocol | Notes |
| --- | --- |
| HTTP | The policy builder includes separate values for HTTP/1.1 and HTTP/2. |
| SSH |  |
| TLS | Gateway detects TLS versions 1.1 through 1.3 with the TLS value. |
| DCE/RPC |  |
| MQTT |  |
| TPKT | TPKT commonly initiates RDP sessions, so you can use it to identify and filter RDP traffic. |
| DNP3 |  |

## Example network policy

You can create network policies that filter traffic based on protocol detections rather than common ports. For example, you can block all SSH traffic on your network without blocking port 22 or any other non-default ports:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Detected Protocol | in | SSH | Block |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SSH proxy and command logs (legacy)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/network-policies/ssh-logging/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/network-policies/ssh-logging/)

Page options # SSH proxy and command logs (legacy)

Note

Not recommended for new deployments. We recommend using Access for Infrastructure to manage SSH sessions and log SSH commands.

Cloudflare Zero Trust supports SSH proxying and command logging using Secure Web Gateway and the WARP client.

You can create network policies to manage and monitor SSH access to your applications. When a device connects to your origin server over SSH, a session log will be generated showing which user connected, the session duration, and optionally a full replay of all commands run during the session.

## Prerequisites

- Install the WARP client on end-user devices.
- Install the Cloudflare root certificate on end-user devices.

## 1. Ensure Unix usernames match user SSO identities

Cloudflare Gateway will take the identity from a token and, using short-lived certificates, authorize the user on the target infrastructure.

The simplest setup is one where a user's Unix username matches their email address prefix. Issued short-lived certificates will be valid for the user's email address prefix. For example, if a user in your Okta or GSuite organization is registered as jdoe@example.com, they would log in to the SSH server as jdoe.

For testing purposes, you can run the following command to generate a Unix user on the machine:

Terminal window ```
sudo adduser jdoe
```

Advanced setup: Differing usernames

SSH certificates include one or more principals in their signature which indicate the Unix usernames the certificate is allowed to log in as. Cloudflare Access will always set the principal to the user's email address prefix. For example, when jdoe@example.com tries to connect, Access issues a short-lived certificate authorized for the principal jdoe.

By default, SSH servers authenticate the Unix username against the principals listed in the user's certificate. You can configure your SSH server to accept principals that do not match the Unix username.

Note

If you would like to use short-lived certificates with the browser-based terminal, the user's email address prefix needs to matches their Unix username.

Username matches a different email

To allow jdoe@example.com to log in as the user johndoe, add the following to the server's /etc/ssh/sshd_config:

```
Match user johndoe  AuthorizedPrincipalsCommand /bin/echo 'jdoe'  AuthorizedPrincipalsCommandUser nobody
```

This tells the SSH server that, when someone tries to authenticate as the user johndoe, check their certificate for the principal jdoe. This would allow the user jdoe@example.com to sign into the server with a command such as:

Terminal window ```
ssh johndoe@server
```

Username matches multiple emails

To allow multiple email addresses to log in as vmuser, add the following to the server's /etc/ssh/sshd_config:

```
Match user vmuser  AuthorizedPrincipalsFile /etc/ssh/vmusers-list.txt
```

This tells the SSH server to load a list of principles from a file. Then, in /etc/ssh/vmusers-list.txt, list the email prefixes that can log in as vmuser, one per line:

```
jdoebwaynerobin
```

Username matches all users

To allow any Access user to log in as vmuser, add the following command to the server's /etc/ssh/sshd_config:

```
Match user vmuser  AuthorizedPrincipalsCommand /bin/bash -c "echo '%t %k' | ssh-keygen -L -f - | grep -A1 Principals"  AuthorizedPrincipalsCommandUser nobody
```

This command takes the certificate presented by the user and authorizes whatever principal is listed on it.

Allow all users

To allow any Access user to log in with any username, add the following to the server's /etc/ssh/sshd_config:

```
AuthorizedPrincipalsCommand /bin/bash -c "echo '%t %k' | ssh-keygen -L -f - | grep -A1 Principals"AuthorizedPrincipalsCommandUser nobody
```

Since this will put the security of your server entirely dependent on your Access configuration, make sure your Access policies are correctly configured.

## 2. Generate a Gateway SSH proxy CA

Instead of traditional SSH keys, Gateway uses short-lived certificates to authenticate traffic between Cloudflare and your origin.

Note

Other short-lived CAs, such as those used to secure SSH servers behind Cloudflare Access, are incompatible with the Gateway SSH proxy. For SSH logging to work, you must create a new CA using the gateway_ca API endpoint.

To generate a Gateway SSH proxy CA and get its public key:

1. Create an API token with the following permissions:















TypeItemPermissionAccountAccess: SSH AuditingEdit
2. If you have not yet generated a Cloudflare SSH CA, make a POST request to the Cloudflare API:

Required API token permissions

At least one of the following token permissions is required: - Access: SSH Auditing Write

Add a new SSH Certificate Authority (CA) ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/gateway_ca" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
```

1. If you have already created a Cloudflare SSH CA or receive the error message access.api.error.gateway_ca_already_exists, make a GET request instead:

Required API token permissions

At least one of the following token permissions is required: - Access: SSH Auditing Write
- Access: SSH Auditing Read

List SSH Certificate Authorities (CA) ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/gateway_ca" \  --request GET \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
```

1. Copy the public_key value returned in the response.

## 3. Save the public key

1. Use the following command to change directories to the SSH configuration directory on the remote target machine:
Terminal windowcd /etc/ssh
2. Once there, you can use the following command to both generate the file and open a text editor to input/paste the public key.
Terminal windowvim ca.pub
3. In the ca.pub file, paste the public key without any modifications.
ca.pubecdsa-sha2-nistp256 <redacted> open-ssh-ca@cloudflareaccess.org
The ca.pub file can hold multiple keys, listed one per line. Empty lines and comments starting with # are also allowed.
4. Save the ca.pub file. In some systems, you may need to use the following command to force the file to save depending on your permissions:
Terminal window:w !sudo tee %:q!

## 4. Modify your sshd_config file

Configure your SSH server to trust the Cloudflare SSH CA by updating the sshd_config file on the remote target machine.

1. While in the /etc/ssh directory on the remote machine, open the sshd_config file.
Terminal window sudo vim /etc/ssh/sshd_config
2. Press i to enter insert mode, then add the following lines at the top of the file, above all other directives:
PubkeyAuthentication yesTrustedUserCAKeys /etc/ssh/ca.pub
Be aware of your include statementsIf there are any include statements below these lines, the configurations in those files will not take precedence.
3. Press esc and then type :x and press Enter to save and exit.

## 5. Check your SSH port number

Cloudflare's SSH proxy only works with servers running on the default port 22. Open the sshd_config file and verify that no other Port values are specified.

Terminal window ```
cat /etc/ssh/sshd_config
```

## 6. Restart your SSH server

Once you have modified your SSHD configuration, reload the SSH service on the remote machine for the changes to take effect.

- Debian/Ubuntu
- CentOS/RHEL

For Debian/Ubuntu:

Terminal window ```
sudo systemctl reload ssh
```

For CentOS/RHEL 7 and newer:

Terminal window ```
sudo systemctl reload sshd
```

## 7. Create an Audit SSH policy

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies.
2. In the Network tab, create a new network policy.
3. Name the policy and specify the Destination IP for your origin server.
You can enter either a public or private IP. To use a private IP, refer to Connect private networks.
4. Add any other conditions to your policy. If a user does not meet the criteria, they will be blocked by default.
5. In the Action dropdown, select Audit SSH.
6. (Optional) Enable SSH Command Logging. If you have not already uploaded an SSH encryption public key, follow the steps in Configure SSH Command Logging.
7. Save the policy.

## 8. Connect as a user

Users can use any SSH client to connect to the target resource, as long as they are logged into the WARP client on their device. Cloudflare Zero Trust will authenticate, proxy, and optionally encrypt and record all SSH traffic through Gateway.

Users must specify their desired username to connect with as part of the SSH command:

Terminal window ```
ssh <username>@<hostname>
```

Note

If the target resource is already in a user's .ssh/known_hosts file, the user must first remove existing SSH keys before attempting to connect:

Terminal window ```
ssh-keygen -R <targetIP or hostname>
```

## (Optional) Configure SSH Command Logging

To log SSH commands, you will need to generate an HPKE key pair and upload the public key to Cloudflare.

1. Download ‚Üó the Cloudflare ssh-log-cli utility.
2. Using the ssh-log-cli utility, generate a public and private key pair.
Terminal window./ssh-log-cli generate-key-pair -o sshkeyls
README.md    ssh-log-cli    sshkey    sshkey.pub
This command outputs two files, an sshkey.pub public key and a matching sshkey private key.
3. In Zero Trust ‚Üó, go to Settings > Network.
4. In SSH encryption public key, paste the contents of sshkey.pub and select Save. Note that this a different public key from the ca.pub file you used to configure the SSH server.

All proxied SSH commands are immediately encrypted using this public key. The matching private key is required to view logs.

## View SSH Logs

1. In Zero Trust ‚Üó, go to Logs > Gateway > SSH.
2. If you enabled the SSH Command Logging feature, you can Download a session's command log.
3. To decrypt the log, follow the instructions in the SSH Logging CLI repository ‚Üó. In the following example, sshkey is the private key that matches the public key uploaded to Cloudflare.
Terminal window./ssh-log-cli decrypt -i sshlog -k sshkey
This command outputs a sshlog-decrypted.zip file with the decrypted logs.

## Limitations

SSH Command Logging does not support SFTP since it cannot be inspected and logged.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## HTTP policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/)

Page options # HTTP policies

Note

To use HTTP policies, install a Cloudflare root certificate or a custom certificate.

HTTP policies allow you to intercept all HTTP and HTTPS requests and either block, allow, or override specific elements such as websites, IP addresses, and file types. HTTP policies operate on Layer 7 for all TCP (and optionally UDP) traffic sent over ports 80 and 443.

An HTTP policy consists of an Action as well as a logical expression that determines the scope of the policy. To build an expression, you need to choose a Selector and an Operator, and enter a value or range of values in the Value field. You can use And and Or logical operators to evaluate multiple conditions.

- Actions
- Selectors
- Comparison operators
- Value
- Logical operators

If a condition in an expression joins a query attribute (such as Source IP) and a response attribute (such as Resolved IP), then the condition will be evaluated when the response is received.

Terraform provider v4 precedence limitation

To avoid conflicts, version 4 of the Terraform Cloudflare provider applies a hash calculation to policy precedence. For example, a precedence of 1000 may become 1000901. This can cause errors when reordering policies. To avoid this issue, manually set the precedence of policies created with Terraform using the Update a Zero Trust Gateway rule endpoint.

To ensure your precedence is set correctly, Cloudflare recommends upgrading your Terraform provider to version 5 ‚Üó.

## Actions

Actions in HTTP policies allow you to choose what to do with a given set of elements (domains, IP addresses, file types, and so on). You can assign one action per policy.

### Allow

API value: allow

Available selectors

Traffic

- Access Infrastructure Target
- Access Private App
- Application
- Content Categories
- Destination Continent IP Geolocation
- Destination Country IP Geolocation
- Destination IP
- DLP Profile
- Domain
- Download File Types
- Download Mime Type
- Host
- HTTP Method
- HTTP Response
- Proxy Endpoint
- Security Risks
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source Internal IP
- Source IP
- Upload File Types
- Upload Mime Type
- URL
- URL Path
- URL Path & Query
- URL Query
- Virtual Network

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Device Posture

- Passed Device Posture Checks

The Allow action allows outbound traffic to reach destinations you specify within the Selectors and Value fields. For example, the following configuration allows traffic to reach all websites we categorize as belonging to the Education content category:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | Education | Allow |

#### Untrusted certificates

The Untrusted certificate action determines how to handle insecure requests.

| Option | Action |
| --- | --- |
| Error | Display Gateway error page. Matches the default behavior when no action is configured. |
| Block | Display block page as set in Zero Trust. |
| Pass through | Bypass insecure connection warnings and seamlessly connect to the upstream. For more information on what statuses are bypassed, refer to the troubleshooting FAQ. |

### Block

API value: block

Available selectors

Traffic

- Access Infrastructure Target
- Access Private App
- Application
- Content Categories
- Destination Continent IP Geolocation
- Destination Country IP Geolocation
- Destination IP
- DLP Profile
- Domain
- Download File Types
- Download Mime Type
- Host
- HTTP Method
- HTTP Response
- Proxy Endpoint
- Security Risks
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source Internal IP
- Source IP
- Upload File Types
- Upload Mime Type
- URL
- URL Path
- URL Path & Query
- URL Query
- Virtual Network

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Device Posture

- Passed Device Posture Checks

The Block action blocks outbound traffic from reaching destinations you specify within the Selectors and Value fields. For example, the following configuration blocks users from being able to upload any file type to Google Drive:

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application | in | Google Drive | And | Block |
| Upload Mime Type | matches regex | .* |  |  |

#### WARP client block notifications

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP Secure Web Gateway without DNS filtering | Enterprise |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.1.159.0 |
| macOS | ‚úÖ | 2024.1.160.0 |
| Linux | ‚ùå |  |
| iOS | ‚úÖ | 1.7 |
| Android | ‚úÖ | 1.4 |
| ChromeOS | ‚úÖ | 1.4 |

Turn on Display block notification for WARP Client to display notifications for Gateway block events. Blocked users will receive an operating system notification from the WARP client with a custom message you set. If you do not set a custom message, the WARP client will display a default message. Custom messages must be 100 characters or less. WARP will only display one notification per minute.

Upon selecting the notification, WARP will direct your users to the Gateway block page you have configured. Optionally, you can direct users to a custom URL, such as an internal support form.

When you turn on Send policy context, Gateway will append details of the matching request to the redirected URL as a query string. Not every context field will be included. Potential policy context fields include:

Policy context fields

| Field | Definition | Example |
| --- | --- | --- |
| User email | Email of the user that made the query. | &cf_user_email=user@example.com |
| Site URL | Full URL of the original HTTP request or domain name in DNS query. | &cf_site_uri=https%3A%2F%2Fmalware.testcategory.com%2F |
| URL category | Domain categories of the URL to be redirected. | &cf_request_categories=New%20Domains,Newly%20Seen%20Domains |
| Original HTTP referer | For HTTP traffic, the original HTTP referer header of the HTTP request. | &cf_referer=https%3A%2F%2Fexample.com%2F |
| Rule ID | ID of the Gateway policy that matched the request. | &cf_rule_id=6d48997c-a1ec-4b16-b42e-d43ab4d071d1 |
| Source IP | Source IP address of the device that matched the policy. | &cf_source_ip=203.0.113.5 |
| Device ID | UUID of the device that matched the policy. | &cf_device_id=6d48997c-a1ec-4b16-b42e-d43ab4d071d1 |
| Application names | Name of the application the redirected domain corresponds to, if any. | &cf_application_name=Salesforce |
| Filter | The traffic type filter that triggered the block. | &cf_filter=http, &cf_filter=dns, &cf_filter=av, or &cf_filter=l4 |
| Account ID | Cloudflare account ID of the associated Zero Trust account. | &cf_account_id=d57c3de47a013c03ca7e237dd3e61d7d |
| Query ID | ID of the DNS query for which the redirect took effect. | &cf_query_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |
| Connection ID | ID of the proxy connection for which the redirect took effect. | &cf_connection_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |
| Request ID | ID of the HTTP request for which the redirect took effect. | &cf_request_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |

Ensure that your operating system allows notifications for WARP. Your device may not display notifications if focus, do not disturb, or screen sharing settings are turned on. To turn on client notifications on macOS devices running DisplayLink software, you may have to allow system notifications when mirroring your display. For more information, refer to the macOS documentation ‚Üó.

### Redirect

API value: redirect

Available selectors

Traffic

- Access Infrastructure Target
- Application
- Content Categories
- Destination Continent IP Geolocation
- Destination Country IP Geolocation
- Destination IP
- Domain
- Host
- HTTP Method
- Proxy Endpoint
- Security Risks
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source Internal IP
- Source IP
- URL
- URL Path
- URL Path & Query
- URL Query
- Virtual Network

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Device Posture

- Passed Device Posture Checks

The Redirect action allows you to redirect matched HTTP requests to a different URL you specify. For example, if your users browse to the public web page of a SaaS app, you can redirect them to your own self-hosted instance, a single sign-on page, or an internal policy page.

To redirect URLs with a Block action and the block page, refer to Redirect to a block page.

#### Policy settings

In Policy URL redirect, you can define what URL to redirect matched requests to. The redirect URL can contain paths and queries. For example, you can redirect example.com to cloudflare.com/path/to/page?querystring=x.

When you turn on Send policy context, Gateway will append details of the matching request to the redirected URL as a query string. Not every context field will be included. Potential policy context fields include:

Policy context fields

| Field | Definition | Example |
| --- | --- | --- |
| User email | Email of the user that made the query. | &cf_user_email=user@example.com |
| Site URL | Full URL of the original HTTP request or domain name in DNS query. | &cf_site_uri=https%3A%2F%2Fmalware.testcategory.com%2F |
| URL category | Domain categories of the URL to be redirected. | &cf_request_categories=New%20Domains,Newly%20Seen%20Domains |
| Original HTTP referer | For HTTP traffic, the original HTTP referer header of the HTTP request. | &cf_referer=https%3A%2F%2Fexample.com%2F |
| Rule ID | ID of the Gateway policy that matched the request. | &cf_rule_id=6d48997c-a1ec-4b16-b42e-d43ab4d071d1 |
| Source IP | Source IP address of the device that matched the policy. | &cf_source_ip=203.0.113.5 |
| Device ID | UUID of the device that matched the policy. | &cf_device_id=6d48997c-a1ec-4b16-b42e-d43ab4d071d1 |
| Application names | Name of the application the redirected domain corresponds to, if any. | &cf_application_name=Salesforce |
| Filter | The traffic type filter that triggered the block. | &cf_filter=http, &cf_filter=dns, &cf_filter=av, or &cf_filter=l4 |
| Account ID | Cloudflare account ID of the associated Zero Trust account. | &cf_account_id=d57c3de47a013c03ca7e237dd3e61d7d |
| Query ID | ID of the DNS query for which the redirect took effect. | &cf_query_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |
| Connection ID | ID of the proxy connection for which the redirect took effect. | &cf_connection_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |
| Request ID | ID of the HTTP request for which the redirect took effect. | &cf_request_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |

When you turn on Preserve original path and query string, Gateway will append the original path and query string to the redirected URL. Paths and queries in the redirect URL take precedence over the original URL. For example, if the original URL is example.com/path/to/page?querystring=X and the redirect URL is cloudflare.com/redirect-path?querystring=Y, Gateway will redirect requests to:

```
cloudflare.com/redirect-path/path/to/page?querystring=Y
```

When you turn on both options, Gateway will preserve the original path and query string, then append policy context to the end of the redirect URL. For example, if the original URL is example.com/path/to/page?querystring=X&k=1 and the redirect URL is cloudflare.com/redirect-path?querystring=Y, Gateway will redirect requests to:

```
cloudflare.com/redirect-path/path/to/page?querystring=Y&k=1&cf_user_email=user@example.com
```

### Isolate

API value: isolate

Available selectors

Traffic

- Application
- Content Categories
- Domain
- Host
- HTTP Method
- Security Risks
- Source Continent IP Geolocation
- Source Country IP Geolocation
- URL
- URL Path
- URL Path & Query
- URL Query

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Device Posture

- Passed Device Posture Checks

The Isolate action serves matched traffic to users via Cloudflare Browser Isolation. For more information on this action, refer to Isolation policies.

### Do Not Inspect

API value: off

Available selectors

Traffic

- Application
- Content Categories
- Destination Continent IP Geolocation
- Destination Country IP Geolocation
- Destination IP
- Domain
- Host
- Proxy Endpoint
- Security Risks
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source Internal IP
- Source IP
- Virtual Network

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Device Posture

- Passed Device Posture Checks

Visibility limitation

When you create a Do Not Inspect policy for a given hostname, application, or app type, you will lose the ability to log or block HTTP requests, apply DLP policies, and perform AV scanning.

Information contained within HTTPS encryption, such as the full requested URL, will not be visible if it bypasses Gateway inspection. However, you can still apply network policies to this traffic. For more information, refer to TLS decryption.

Do Not Inspect lets you bypass certain elements from inspection. To prevent Gateway from decrypting and inspecting HTTPS traffic, your policy must match against the Server Name Indicator (SNI) in the TLS header. When accessing a Do Not Inspect site in the browser, your browser may display a Your connection is not private warning, which you can proceed through to connect. For more information about applications which may require a Do Not Inspect policy, refer to TLS decryption limitations.

All Do Not Inspect rules are evaluated first, before any Allow or Block rules, to determine if inspection should occur. For more information, refer to Order of enforcement.

### Do Not Isolate

API value: noisolate

Available selectors

Traffic

- Application
- Content Categories
- Domain
- Host
- HTTP Method
- Security Risks
- Source Continent IP Geolocation
- Source Country IP Geolocation
- URL
- URL Path
- URL Path & Query
- URL Query

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Device Posture

- Passed Device Posture Checks

The Do Not Isolate action turns off browser isolation for matched traffic. For more information on this action, refer to Isolation policies.

### Do Not Scan

API value: noscan

Available selectors

Traffic

- Application
- Content Categories
- Destination Continent IP Geolocation
- Destination Country IP Geolocation
- Destination IP
- Domain
- Host
- HTTP Method
- Proxy Endpoint
- Security Risks
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source Internal IP
- Source IP
- URL
- URL Path
- URL Path & Query
- URL Query
- Virtual Network

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Device Posture

- Passed Device Posture Checks

When an admin enables AV scanning for uploads and/or downloads, Gateway will scan every supported file. Admins can selectively choose to disable scanning by leveraging the HTTP rules. For example, to prevent AV scanning of files uploaded to or downloaded from example.com, an admin would configure the following rule:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Hostname | matches regex | .*example.com | Do Not Scan |

When a Do Not Scan rule matches, nothing is scanned, regardless of file size or whether the file type is supported or not.

### Quarantine

API value: quarantine

Available selectors

Traffic

- Application
- Content Categories
- Destination Continent IP Geolocation
- Destination Country IP Geolocation
- Destination IP
- Domain
- Host
- HTTP Method
- Proxy Endpoint
- Security Risks
- Source Continent IP Geolocation
- Source Country IP Geolocation
- Source Internal IP
- Source IP
- URL
- URL Path
- URL Path & Query
- URL Query
- Virtual Network

Identity

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

Device Posture

- Passed Device Posture Checks

The Quarantine action sends files in matching requests to a file sandbox to scan for malware. Gateway will only quarantine files not previously seen in the file sandbox. For more information on this action, refer to File sandboxing.

#### Sandbox file types

In Sandbox file types, you can select which file types to quarantine with your policy. You must select at least one file type.

File sandboxing supports scanning the following file types:

Supported sandboxing file types

- .exe
- .pdf
- .doc
- .docm
- .docx
- .rtf
- .ppt
- .pptx
- .xls
- .xlsm
- .xlsx
- .zip
- .rar

## Selectors

Note

Policies created using the URL selector are case-sensitive.

Gateway matches HTTP traffic against the following selectors, or criteria:

### Access Infrastructure Target

All targets secured by an Access infrastructure application.

| UI name | API example |
| --- | --- |
| Access Infrastructure Target | access.target |

### Access Private App

All destination IPs and hostnames secured by an Access self-hosted private application.

| UI name | API example |
| --- | --- |
| Access Private App | access.private_app |

### Application Approval Status

The review approval status of an application from Shadow IT Discovery or the Application Library. For more information, refer to Review applications.

| UI name | API example |
| --- | --- |
| Application Status | any(app.statuses[*] == "approved") |

### Application

You can apply HTTP policies to a growing list of popular web applications. Refer to Application and app types for more information.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Application | any(app.ids[*] in {505}) | Before DNS resolution |

Multiple API selectors required for Terraform

When using Terraform to create a policy with the Do Not Inspect action, you must use the app.hosts_ids and app.supports_ids selectors. For example, to create a Do Not Inspect policy for Google Cloud Platform traffic, create a policy with both any(app.hosts_ids[*] in {1245}) and any(app.supports_ids[*] in {1245}).

#### Application Granular Controls

When using the is operator with the Application selector, you can use Application Granular Controls to choose specific actions and operations to match application traffic. For example, you can block file uploads to ChatGPT without blocking all ChatGPT traffic:

| Selector | Operator | Value | Controls | Action |
| --- | --- | --- | --- | --- |
| Application | is | ChatGPT | Upload | Block |

You can match traffic based on Application Controls, which group multiple user actions together, or Operations, which allow for granular control of supported API-level actions for an application. For a list of supported granular controls, refer to Application controls.

### Content Categories

Applications within a specific security category as categorized by Cloudflare Radar.

| UI name | API example |
| --- | --- |
| Content Categories | any(http.conn.content_category[*] in {1}) |

### Destination Continent

Note

Only applies to traffic sent through the WARP client.

The continent where the request is destined. Geolocation is determined from the target IP address. To specify a continent, enter its two-letter code into the Value field:

| Continent | Code |
| --- | --- |
| Africa | AF |
| Antarctica | AN |
| Asia | AS |
| Europe | EU |
| North America | NA |
| Oceania | OC |
| South America | SA |
| Tor network | T1 |

| UI name | API example |
| --- | --- |
| Destination Continent IP Geolocation | http.dst_ip.geo.continent == "EU" |

### Destination Country

Note

Only applies to traffic sent through the WARP client.

The country that the request is destined for. Geolocation is determined from the target IP address. To specify a country, enter its ISO 3166-1 Alpha 2 code ‚Üó in the Value field.

| UI name | API example |
| --- | --- |
| Destination Country IP Geolocation | http.dst_ip.geo.country == "RU" |

### Destination IP

Note

Only applies to traffic sent through the WARP client.

The IP address of the request's target.

| UI name | API example |
| --- | --- |
| Destination IP | any(http.conn.dst_ip[*] in {10.0.0.0/8}) |

### Device Posture

With the Device Posture selector, admins can use signals from end-user devices to secure access to their internal and external resources. For example, a security admin can choose to limit all access to internal applications based on whether specific software is installed on a device and/or if the device or software are configured in a particular way.

For more information on device posture checks, refer to Device posture.

| UI name | API example |
| --- | --- |
| Passed Device Posture Checks | any(device_posture.checks.failed[*] in {"1308749e-fcfb-4ebc-b051-fe022b632644"}), any(device_posture.checks.passed[*] in {"1308749e-fcfb-4ebc-b051-fe022b632644"})" |

### Domain

Use this selector to match against a domain and all subdomains. For example, you can match example.com and its subdomains, such as www.example.com.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Domain | any(http.conn.domains[*] == "example.com") | Before DNS resolution |

Gateway policies do not support domains with non-Latin characters directly. To use a domain with non-Latin characters, add it to a list.

### Download and Upload File Size

Use these selectors to limit the file size of upload or download transactions. File sizes are measured in mebibytes (MiB).

| UI name | API example |
| --- | --- |
| Download File Size (MiB) | http.download.file.size >= 10 |

| UI name | API example |
| --- | --- |
| Upload File Size (MiB) | http.upload.file.size < 10 |

### Download and Upload File Types

Deprecated selectors

The Download File Types and Upload File Types selectors supersede the Download File Type and Upload File Type selectors. Gateway will still evaluate policies with the previous selectors. However, Cloudflare recommends migrating any policies with deprecated selectors to the new corresponding selectors.

These selectors will scan file signatures in the HTTP body. You can select from file categories or specific file types, such as executables, archives and compressed files, unscannable files, Microsoft 365/Office documents, and Adobe files:

Supported file types

Compressed

- 7-Zip archive (.7z)
- bzip2 archive (.bz2)
- GNU Gzip archive (.gz)
- Microsoft Cabinet file (.cab)
- Microsoft Compiled HTML Help file (.chm)
- RAR archive (.rar)
- xz archive (.xz)
- ZIP archive (.zip)

Documents

- Microsoft Office/365 files

Word document (.doc, .docx, .docm)
Excel spreadsheet (.xls, .xlsx, .xlsm)
PowerPoint presentation (.ppt, .pptx, .pptm)
- Word document (.doc, .docx, .docm)
- Excel spreadsheet (.xls, .xlsx, .xlsm)
- PowerPoint presentation (.ppt, .pptx, .pptm)
- PDF document (.pdf)

Executable

- Dynamic-link library (DLL) file (.dll)
- Executable and Linkable Format (ELF) file (.elf)
- Java archive (JAR) package (.jar)
- Java class file (.class)
- Mach object (Mach-O) file (.macho)
- Microsoft Windows installer (.msi)
- Microsoft Windows executable (.exe)

Image

- Adobe Photoshop document (.psd)
- Bitmap image (.bmp)
- GIF image (.gif)
- Icon file (.ico)
- JPEG image (.jpg, .jpeg)
- PNG image (.png)
- WebP image (.webp)

Other

- BitTorrent file (.torrent)

Unscannable

- Password-protected Microsoft Office document
- Password-protected PDF
- Password-protected ZIP archive
- Unscannable ZIP archive

| UI name | API example |
| --- | --- |
| Download File Types | any(http.download.file.types[*] in {"docx" "7z"}) |

| UI name | API example |
| --- | --- |
| Upload File Types | any(http.upload.file.types[*] in {"compressed"}) |

### Download and Upload Mime Type

These selectors depend on the Content-Type header being present in the request (for uploads) or response (for downloads).

| UI name | API example |
| --- | --- |
| Download Mime Type | http.download.mime == "image/png\" |

| UI name | API example |
| --- | --- |
| Upload Mime Type | http.upload.mime == "image/png\" |

### DLP Profile

Scans HTTP traffic for the presence of social security numbers and other PII. You must configure the DLP Profile before you can use this selector in your policy. For more information, refer to our DLP Profile documentation.

### Host

Use this selector to match against only the hostname specified. For example, you can match test.example.com but not example.com or www.test.example.com.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Host | http.conn.hostname == "example.com" | Before DNS resolution |

Gateway policies do not support hostnames with non-Latin characters directly. To use a hostname with non-Latin characters, add it to a list.

Note

Some hostnames (example.com) will invisibly redirect to the www subdomain (www.example.com). To match this type of website, use the Domain selector instead of the Host selector.

### HTTP Method

The HTTP request method used in the traffic.

| UI name | API example |
| --- | --- |
| HTTP Method | http.request.method == "GET" |

### HTTP Response

The HTTP response status code received by the traffic.

| UI name | API example |
| --- | --- |
| URL | http.response.status_code == "200" |

### Proxy Endpoint

The proxy server where your browser forwards HTTP traffic.

| UI name | API example |
| --- | --- |
| Proxy Endpoint | proxy.endpoint == "3ele0ss56t.proxy.cloudflare-gateway.com" |

### Security Risks

Applications within a specific security category as categorized by Cloudflare Radar.

| UI name | API example |
| --- | --- |
| Security Risks | any(http.conn.security_category[*] in {1}) |

### Source Continent

The continent of the user making the request.

Geolocation is determined from the device's public IP address (typically assigned by the user's ISP). To specify a continent, enter its two-letter code into the Value field:

| Continent | Code |
| --- | --- |
| Africa | AF |
| Antarctica | AN |
| Asia | AS |
| Europe | EU |
| North America | NA |
| Oceania | OC |
| South America | SA |
| Tor network | T1 |

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Source Continent IP Geolocation | http.src_ip.geo.continent == "North America" | Before DNS resolution |

### Source Country

The country of the user making the request.

Geolocation is determined from the device's public IP address (typically assigned by the user's ISP). To specify a country, enter its ISO 3166-1 Alpha-2 code ‚Üó in the Value field.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Source Country IP Geolocation | http.src_ip.geo.country == "RU" | Before DNS resolution |

### Source Internal IP

Use this selector to apply HTTP policies to a private IP address, assigned by a user's local network, that requests arrive to Gateway from. This selector will only apply to users connected through a Magic GRE or IPSec tunnel.

| UI name | API example |
| --- | --- |
| Source Internal IP | http.conn.internal_src_ip == "192.168.86.0/27" |

### Source IP

The originating IP address or addresses of a device proxied by Gateway.

| UI name | API example |
| --- | --- |
| Source IP | http.conn.src_ip[*] in {10.0.0.0/8} |

### URL

Gateway ignores trailing forward slashes (/) in URLs. For example, https://example.com and https://example.com/ will count as the same URL and may return a duplicate error.

| UI name | API example |
| --- | --- |
| URL | not(any(http.request.uri.content_category[*] in {1})) |

### URL Path

The pathname of a webpage's URL.

| UI name | API example |
| --- | --- |
| URL Path | http.request.uri.path == \"/foo/bar\" |

### URL Path and Query

The pathname and query of a webpage's URL.

| UI name | API example |
| --- | --- |
| URL Path and Query | http.request.uri.path_and_query == \"/foo/bar?ab%242=%2A342\" |

### URL Query

The query of a webpage's URL.

| UI name | API example |
| --- | --- |
| URL Query | http.request.uri.query == "ab%242=%2A342" |

### Users

Identity-based selectors include:

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

To use identity-based selectors, enable Gateway with WARP in the Zero Trust WARP client and enroll your user in your organization. For more information, refer to Identity-based policies.

### Virtual Network

Use this selector to match all traffic routed through a specific Tunnel Virtual Network via the WARP client.

| UI name | API example |
| --- | --- |
| Virtual Network | http.conn.vnet_id == "957fc748-591a-e96s-a15d-1j90204a7923" |

## Comparison operators

Comparison operators are the way Gateway matches traffic to a selector. When you choose a Selector in the dashboard policy builder, the Operator dropdown menu will display the available options for that selector.

| Operator | Meaning |
| --- | --- |
| is | equals the defined value |
| is not | does not equal the defined value |
| in | matches at least one of the defined values |
| not in | does not match any of the defined values |
| in list | in a pre-defined list of values |
| not in list | not in a pre-defined list of values |
| matches regex | regex evaluates to true |
| does not match regex | regex evaluates to false |
| greater than | exceeds the defined number |
| greater than or equal to | exceeds or equals the defined number |
| less than | below the defined number |
| less than or equal to | below or equals the defined number |

## Value

In the Value field, you can input a single value when using an equality comparison operator (such as is) or multiple values when using a containment comparison operator (such as in). Additionally, you can use regular expressions (or regex) to specify a range of values for supported selectors.

### Regular expressions

Gateway uses Rust to evaluate regular expressions. The Rust implementation is slightly different than regex libraries used elsewhere. For more information, refer to our guide for Wildcards. To evaluate if your regex matches, you can use Rustexp ‚Üó.

If you want to match multiple values, you can use the pipe symbol (|) as an OR operator. In Gateway, you do not need to use an escape character (\) before the pipe symbol. For example, the following policy blocks requests to two hostnames if either appears in a request header:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Host | matches regex | .\*whispersystems.org|.\*signal.org | Block |

In addition to regular expressions, you can use logical operators to match multiple values.

## Logical operators

To evaluate multiple conditions in an expression, select the And logical operator. These expressions can be compared further with the Or logical operator.

| Operator | Meaning |
| --- | --- |
| And | match all of the conditions in the expression |
| Or | match any of the conditions in the expression |

The Or operator will only work with conditions in the same expression group. For example, you cannot compare conditions in Traffic with conditions in Identity or Device Posture.

If a condition in an expression joins a request attribute (such as Source IP) and a response attribute (such as a DLP Profile), then the condition will be evaluated when the response is received.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Common policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/common-policies/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/common-policies/)

Page options # Common policies

The following policies are commonly used to secure HTTP traffic.

Refer to the HTTP policies page for a comprehensive list of other selectors, operators, and actions.

## Block sites

Block attempts to reach sites by hostname or URL paths. Different approaches may be required based on how a site is organized.

### Block sites by hostname

Block all subdomains that use a host.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Host | matches regex | .*example\.com | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block sites by hostname",    "description": "Block all subdomains that use a specific hostname",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "http.request.host matches \".*example.com\"",    "identity": "",    "device_posture": ""  }'
```

### Block sites by URL

Block a section of a site without blocking the entire site. For example, you can block a specific subreddit, such as reddit.com/r/gaming, without blocking reddit.com.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| URL | matches regex | /r/gaming | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block sites by URL",    "description": "Block specific parts of a site without blocking the hostname",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "http.request.uri matches \"/r/gaming\"",    "identity": "",    "device_posture": ""  }'
```

## Block content categories

Block content categories which go against your organization's acceptable use policy.

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | Questionable Content, Security Risks, Miscellaneous, Adult Themes, Gambling | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-HTTP-ContentCategories-Blocklist",    "description": "Block access to questionable content and potential security risks",    "precedence": 40,    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(http.request.uri.content_category[*] in {17 85 87 102 157 135 138 180 162 32 169 177 128 15 115 119 124 141 161 2 67 125 133 99})",    "identity": "",    "device_posture": ""  }'
```

```
resource "cloudflare_zero_trust_gateway_policy" "block_unauthorized_apps" {  account_id     = var.cloudflare_account_id  name           = "All-HTTP-ContentCategories-Blocklist"  description    = "Block access to questionable content and potential security risks"  precedence     = 40  enabled        = true  action         = "block"  filters        = ["dns"]  traffic        = "any(http.request.uri.content_category[*] in {17 85 87 102 157 135 138 180 162 32 169 177 128 15 115 119 124 141 161 2 67 125 133 99})""  identity       = ""  device_posture = ""}
```

## Block unauthorized applications

Note

After seven days, view your Shadow IT SaaS Analytics and block additional applications based on what your users are accessing.

To minimize the risk of shadow IT, some organizations choose to limit their users' access to certain web-based tools and applications. For example, the following policy blocks known AI tools:

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Application | in | Artificial Intelligence | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-HTTP-Application-Blocklist",    "description": "Limit access to shadow IT by blocking web-based tools and applications",    "precedence": 60,    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(app.type.ids[*] in {25})",    "identity": "",    "device_posture": ""  }'
```

```
resource "cloudflare_zero_trust_gateway_policy" "all_http_application_blocklist" {  account_id     = var.cloudflare_account_id  name           = "All-HTTP-Application-Blocklist"  description    = "Limit access to shadow IT by blocking web-based tools and applications"  precedence     = 60  enabled        = true  action         = "block"  filters        = ["http"]  traffic        = "any(app.type.ids[*] in {25})"  identity       = ""  device_posture = ""}
```

## Check user identity

Configure access on a per user or group basis by adding identity-based conditions to your policies.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application | in | Salesforce | And | Block |
| User Group Names | in | Contractors |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Check user identity",    "description": "Block access to Salesforce by temporary employees and contractors",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(app.ids[] in {606})",    "identity": "any(identity.groups.name[] in {\"Contractors\"})",    "device_posture": ""  }'
```

## Skip inspection for groups of applications

Certain client applications, such as Zoom or Apple services, rely on certificate pinning. The TLS decryption performed by Cloudflare Gateway will cause errors when users visit those applications. To avoid this behavior, you must add a Do Not Inspect HTTP policy.

Gateway evaluates Do Not Inspect policies first. We recommend moving your Do Not Inspect policies to the top of the list to reduce confusion.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Application | in | Do Not Inspect | Do Not Inspect |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Bypass incompatible applications",    "description": "Skip TLS decryption for applications that are incompatible with Gateway",    "enabled": true,    "action": "off",    "filters": [        "http"    ],    "traffic": "any(app.type.ids[*] in {16})",    "identity": "",    "device_posture": ""  }'
```

Note

You can select either individual applications or the entire Do Not Inspect set, which will update as new applications are added.

## Check device posture

Require devices to have certain software installed or other configuration attributes. For instructions on setting up a device posture check, refer to Enforce device posture.

### Enforce a minimum OS version

Perform an OS version check to ensure users are running at least a minimum version.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Passed Device Posture Checks | in | Minimum OS version | Allow |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Require OS version",    "description": "Perform an OS version check for minimum version",    "enabled": true,    "action": "allow",    "filters": [        "http"    ],    "traffic": "",    "identity": "",    "device_posture": "any(device_posture.checks.passed[*] in {\"<POSTURE_CHECK_UUID>\"})"  }'
```

To get the UUIDs of your device posture checks, use the List device posture rules endpoint.

### Check for a specific file

Perform a file check to ensure users have a certain file on their device.

Since the file path will be different for each operating system, you can configure a file check for each system and use the Or logical operator to only require one of the checks to pass.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Passed Device Posture Checks | in | macOS File Check | Or | Allow |
| Passed Device Posture Checks | in | Linux File Check |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Check for specific file",    "description": "Ensure users have a specific file on their device regardless of operating system",    "enabled": true,    "action": "allow",    "filters": [        "http"    ],    "traffic": "",    "identity": "",    "device_posture": "any(device_posture.checks.passed[] in {\"<POSTURE_CHECK_1_UUID>\"}) or any(device_posture.checks.passed[] in {\"<POSTURE_CHECK_2_UUID>\"})"  }'
```

To get the UUIDs of your device posture checks, use the List device posture rules endpoint.

## Enforce session duration

Require users to re-authenticate after a certain amount of time has elapsed.

## Isolate high risk sites in remote browser

If you are using the Browser Isolation add-on, refer to our list of common Isolate policies.

## Bypass inspection for self-signed certificates

When accessing origin servers with certificates not signed by a public certificate authority, you must bypass TLS decryption.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Domain | in | internal.example.com | Do Not Inspect |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Bypass internal site inspection",    "description": "Bypass TLS decryption for internal sites with self-signed certificates",    "enabled": true,    "action": "off",    "filters": [        "http"    ],    "traffic": "any(http.conn.domains[*] in {\"internal.example.com\"})",    "identity": "",    "device_posture": ""  }'
```

## Block file types

Block the upload or download of files based on their type.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Upload File Types | in | Microsoft Office Word Document (docx) | And | Block |
| Download File Types | in | PDF (pdf) |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block file types",    "description": "Block the upload or download of files based on their type",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(http.upload.file.types[*] in {\"docx\"}) and any(http.download.file.types[*] in {\"pdf\"})",    "identity": "",    "device_posture": ""  }'
```

For more information on supported file types, refer to Download and Upload File Types.

## Isolate or block shadow IT applications

Isolate shadow IT applications discovered by the Application Library that have not been reviewed yet or are currently under review, and block applications that are not approved by your organization.

For more information on reviewing shadow IT applications, refer to Review applications.

### 1. Isolate unreviewed or in review applications

Isolate applications if their approval status is Unreviewed or In review.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application Status | is | Unreviewed | Or | Isolate |
| Application Status | is | In review |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Isolate unreviewed or in review application status",    "description": "Isolate Shadow IT applications that have not been reviewed or are in review in the Application Library",    "enabled": true,    "action": "isolate",    "filters": [        "http"    ],    "traffic": "any(app.statuses[*] == \"unreviewed\") or any(app.statuses[*] == \"in review\")",    "identity": "",    "device_posture": ""  }'
```

### 2. Block unapproved applications

Block applications if their approval status is Unapproved.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Application Status | is | Unapproved | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block unapproved application status",    "description": "Block Shadow IT applications that have been marked as unapproved in the Application Library",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(app.statuses[*] == \"unapproved\")",    "identity": "",    "device_posture": ""  }'
```

## Block Google services

To enable Gateway inspection for Google Drive traffic, you must add a Cloudflare certificate to Google Drive.

### Block Google Drive downloads

Block file downloads from Google Drive.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application | in | Google Drive | And | Block |
| URL Path & Query | matches regex | .*(e=download|export).* |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block Google Drive downloads",    "description": "Block file downloads from Google Drive",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(app.ids[] in {554}) and http.request.uri.path_and_query matches \".(e=download|export).*\"",    "identity": "",    "device_posture": ""  }'
```

### Block Google Drive uploads

Block file uploads from Google Drive.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application | in | Google Drive | And | Block |
| Upload Mime Type | matches regex | .* | And |  |
| Host | is not | drivefrontend-pa.clients6.google.com |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block Google Drive uploads",    "description": "Block file uploads to Google Drive",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(app.ids[] in {554}) and http.upload.mime matches \".\" and not(http.request.host == \"drivefrontend-pa.clients6.google.com\")",    "identity": "",    "device_posture": ""  }'
```

### Block Gmail downloads

Block file downloads from Gmail.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Host | is | mail-attachment.googleusercontent.com | And | Block |
| URL Path & Query | is | /attachment/u/0 |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block Gmail downloads",    "description": "Block file downloads from Gmail",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "http.request.host == \"mail-attachment.googleusercontent.com\" and http.request.uri.path_and_query matches \"/attachment/u/0\"",    "identity": "",    "device_posture": ""  }'
```

## Filter WebSocket traffic

Gateway does not inspect or log WebSocket ‚Üó traffic. Instead, Gateway will only log the HTTP details used to make the WebSocket connection, as well as network session information. To filter your WebSocket traffic, create a policy with the 101 HTTP response code.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| HTTP Response | is | 101 SWITCHING_PROTOCOLS | Allow |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Filter WebSocket",    "description": "Filter WebSocket traffic with HTTP response code 101",    "enabled": true,    "action": "allow",    "filters": [        "http"    ],    "traffic": "http.response.status_code == 101",    "identity": "",    "device_posture": ""  }'
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## TLS decryption

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/tls-decryption/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/tls-decryption/)

Page options # TLS decryption

Cloudflare Gateway can perform SSL/TLS decryption ‚Üó in order to inspect HTTPS traffic for malware and other security risks.

When you turn on TLS decryption, Gateway will decrypt all traffic sent over HTTPS, apply your HTTP policies, and then re-encrypt the request with a user-side certificate.

Cloudflare prevents traffic interference by decrypting, inspecting, and re-encrypting HTTPS requests in its data centers in memory only. Gateway only stores eligible cache content at rest. All cache disks are encrypted at rest. You can configure where TLS decryption takes place with Regional Services in the Cloudflare Data Localization Suite (DLS). To further control what data centers traffic egresses from, you can use dedicated egress IPs.

Cloudflare supports connections from users to Gateway over TLS 1.1, 1.2, and 1.3.

## Turn on TLS decryption

Prerequisite

Before you turn on TLS decryption, ensure you have installed either a Cloudflare-generated certificate or custom certificate on your users' devices.

To turn on TLS decryption:

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > Network.
2. In Firewall, turn on TLS decryption.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Configure the tls_decrypt argument in cloudflare_zero_trust_gateway_settings ‚Üó:
resource "cloudflare_zero_trust_gateway_settings" "team_name" {  account_id = var.cloudflare_account_id  settings = {    tls_decrypt = {      enabled = true    }  }}

## Inspection limitations

Gateway does not support TLS decryption for applications which use:

- Certificate pinning
- Self-signed certificates
- Mutual TLS (mTLS) authentication
- ESNI and ECH handshake encryption
- Automatic HTTPS upgrades

### Inspect on all ports Beta

By default, Gateway will only inspect HTTP traffic through port 80. Additionally, if you turn on TLS decryption, Gateway will inspect HTTPS traffic through port 443.

To detect and inspect HTTP and HTTPS traffic on ports in addition to 80 and 443, you can turn on protocol detection and configure Gateway to inspect traffic on all ports.

Inspecting traffic on all ports works best if you allow all traffic by default. If your organization uses a Network policy to block all traffic by default, Gateway will allow all non-HTTPS TLS traffic, and you will not be able to filter this traffic. To use HTTP policies to filter all TLS traffic on all ports when using a default Block Network policy, create a Network policy to explicitly allow HTTP and TLS traffic.

### Incompatible certificates

Applications that use certificate pinning and mTLS authentication do not trust Cloudflare certificates. For example, most mobile applications use certificate pinning. Cloudflare does not trust applications that use self-signed certificates instead of certificates signed by a public CA.

If you try to perform TLS decryption on an application with an incompatible certificate configuration, the application may return an SSL or trust error and/or fail to load. To resolve this issue, you can:

- Add a Cloudflare certificate to supported applications.
- Create a Do Not Inspect policy to exempt applications from inspection. The Application selector provides a list of trusted applications that are known to use embedded certificates. Note that if you create a Do Not Inspect policy for an application or website, you will lose the ability to log or block HTTP requests, apply DLP policies, and perform AV scanning.
- Configure a Split Tunnel in Include mode to ensure Gateway will only inspect traffic destined for your IPs or domains. This is useful for organizations that deploy Zero Trust on users' personal devices or otherwise expect personal applications to be used.

Alternatively, to allow HTTP filtering while accessing a site with an insecure certificate, set your Untrusted certificate action to Pass through.

### Google Chrome automatic HTTPS upgrades

Google Chrome can automatically upgrade HTTP requests to HTTPS requests, even when you select a link that explicitly declares http://. When you use Gateway to proxy and filter your traffic, this upgrade can interrupt the connection between your Zero Trust users and Gateway.

You can turn off automatic HTTPS upgrades via a Gateway pass through policy, a Chrome browser flag, or a Chrome Enterprise policy.

- Pass through policy
- Chrome browser flag
- Chrome enterprise policy

To disable automatic HTTPS upgrades for a URL across your Zero Trust organization, create a Gateway pass through policy.

1. Deploy a custom root certificate.
2. Create an HTTP policy to match the domain of the URL being automatically upgraded. For example:

















SelectorOperatorValueActionURLinexample.comAllow
3. In Untrusted certificate action, choose Pass through.
4. Select Create policy.

The pass through policy will bypass insecure connection upgrades for any device connected to your Zero Trust organization. For more information, refer to Untrusted certificates.

To disable automatic HTTPS upgrades on a per-browser basis, go to Chrome flags and turn off HTTPS Upgrades.

Chrome Enterprise users can turn off automatic HTTPS upgrades for all URLs with a HttpsUpgradesEnabled management policy ‚Üó.

### Mutual TLS (mTLS)

When decrypting TLS to inspect traffic, connections that use mutual TLS (mTLS) will fail because Gateway cannot return the necessary client certificate. To prevent connection failures, create a Do Not Inspect policy for this traffic.

### ESNI and ECH

Websites that adhere to ESNI or Encrypted Client Hello (ECH) standards ‚Üó encrypt the Server Name Indicator (SNI) during the TLS handshake and are therefore incompatible with HTTP inspection. This is because Gateway relies on the SNI to match an HTTP request to a policy. If the ECH fails, browsers will retry the TLS handshake using the unencrypted SNI from the initial request. To avoid this behavior, you can disable ECH in your users' browsers.

You can still apply all network policy filters except for SNI and SNI Domain. To restrict ESNI and ECH traffic, an option is to filter out all port 80 and 443 traffic that does not include an SNI header.

## Post-quantum support

Gateway supports post-quantum cryptography using a hybrid key exchange with X25519 and MLKEM768 over TLS 1.3. Once the key exchange is complete, Gateway uses AES-128-GCM to encrypt traffic.

Refer to Post-quantum cryptography to learn more.

## FIPS compliance

By default, TLS decryption can use both TLS version 1.2 and 1.3. However, some environments such as FedRAMP may require cipher suites and TLS versions compliant with FIPS 140-2. FIPS compliance currently requires TLS version 1.2.

### Enable FIPS compliance

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > Network.
2. In Firewall, turn on TLS decryption.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Configure the tls_decrypt argument in cloudflare_zero_trust_gateway_settings ‚Üó:
resource "cloudflare_zero_trust_gateway_settings" "team_name" {  account_id = var.cloudflare_account_id  settings = {    tls_decrypt = {      enabled = true    }  }}

1. Select Enable only cipher suites and TLS versions compliant with FIPS 140-2.

### Limitations

When FIPS compliance is enabled, Gateway will only choose FIPS-compliant cipher suites when connecting to the origin. If the origin does not support FIPS-compliant ciphers, the request will fail.

FIPS-compliant traffic defaults to HTTP/3. To enforce HTTP policies for UDP traffic, you must turn on the Gateway proxy for UDP.

## FedRAMP compliance

When you use Cloudflare Regional Services in the United States and the WARP client to on-ramp TLS traffic to Gateway, traffic will egress from a Cloudflare data center within Cloudflare's FedRAMP boundary. If a user's closest data center is non-FedRAMP compliant, their traffic will still egress from a FedRAMP compliant data center, maintaining FedRAMP compliance for the traffic.

```
flowchart LR
 %% Accessibility
 accTitle: How Gateway routes FedRAMP compliant traffic with Regional Services
 accDescr: Flowchart describing how WARP with Gateway routes traffic to egress from a FedRAMP compliant data center when used with Regional Services in the United States.

 %% Flowchart
 subgraph s1["Non-FedRAMP data center"]
        n2["WARP TLS encryption terminated"]
  end
 subgraph s2["FedRAMP data center"]
        n3["Gateway TLS encryption (FIPS) terminated"]
  end
 subgraph s3["Private internal network"]
        n5["FedRAMP compliant cloudflared"]
        n6(["Private server"])
  end
    n1(["User near non-FedRAMP compliant data center"]) -- Gateway TLS connection wrapped with WARP TLS (MASQUE) --> n2
    n2 -- Gateway TLS connection --> n3
    n3 <-- FIPS tunnel --> n5
    n5 --> n6

    n5@{ shape: rect}
```

## Cipher suites

A cipher suite is a set of encryption algorithms for establishing a secure communications connection. There are several cipher suites in wide use, and a client and server agree on the cipher suite to use when establishing the TLS connection. Support of multiple cipher suites allows compatibility across various clients.

The following table lists the default cipher suites Gateway uses for TLS decryption.

| Name (OpenSSL) | Name (IANA) | FIPS-compliant |
| --- | --- | --- |
| ECDHE-ECDSA-AES128-GCM-SHA256 | TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 | ‚úÖ |
| ECDHE-ECDSA-AES256-GCM-SHA384 | TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 | ‚úÖ |
| ECDHE-RSA-AES128-GCM-SHA256 | TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 | ‚úÖ |
| ECDHE-RSA-AES256-GCM-SHA384 | TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 | ‚úÖ |
| ECDHE-RSA-AES128-SHA | TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 | ‚ùå |
| ECDHE-RSA-AES256-SHA384 | TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 | ‚úÖ |
| AES128-GCM-SHA256 | TLS_RSA_WITH_AES_128_GCM_SHA256 | ‚úÖ |
| AES256-GCM-SHA384 | TLS_RSA_WITH_AES_256_GCM_SHA384 | ‚úÖ |
| AES128-SHA | TLS_RSA_WITH_AES_128_CBC_SHA | ‚ùå |
| AES256-SHA | TLS_RSA_WITH_AES_256_CBC_SHA | ‚ùå |

For more information on cipher suites, refer to Cipher suites.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## HTTP/3 inspection

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/http3/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/http3/)

Page options # HTTP/3 inspection

Gateway supports inspection of HTTP/3 traffic, which uses the QUIC protocol over UDP. HTTP/3 inspection requires a user-side certificate to be deployed and traffic to be proxied over UDP with TLS version 1.3.

Gateway applies HTTP policies to HTTP/3 traffic last. For more information, refer to the order of enforcement.

## Enable HTTP/3 inspection

To enable HTTP/3 inspection, turn on the Gateway proxy for UDP:

1. In Zero Trust ‚Üó, go to Settings > Network.
2. In Firewall, turn on Proxy.
3. Select TCP and UDP.
4. Turn on TLS decryption.

### Application limitations

Gateway can inspect HTTP/3 traffic from Mozilla Firefox and Microsoft Edge by establishing an HTTP/3 proxy connection. Gateway will then terminate the HTTP/3 connection, decrypt and inspect the traffic, and connect to the destination server over HTTP/2. Gateway can also inspect other HTTP applications, such as cURL.

If the UDP proxy is turned on in Zero Trust, Google Chrome will cancel all HTTP/3 connections and retry them with HTTP/2, allowing you to enforce your HTTP policies. If the UDP proxy is turned off, HTTP/3 traffic from Chrome will bypass inspection.

## Exempt HTTP/3 traffic from inspection

If you require HTTP/3 traffic with end-to-end encryption from the client to the origin while still using the Gateway proxy, you can create a Do Not Inspect HTTP policy to match the desired traffic. Using a Do Not Inspect policy allows HTTP/3 traffic to preserve proxy performance and end-to-end encryption by bypassing Gateway's TLS decryption and inspection.

## Force HTTP/2 traffic

To apply Gateway policies to HTTP traffic without turning on the UDP proxy, you must turn off QUIC in your users' browsers to ensure only HTTP/2 traffic reaches Gateway.

Google Chrome

1. Go to chrome://flags
2. Set Experimental QUIC protocol to Disabled.
3. Relaunch Chrome.

Safari

You cannot turn off QUIC in Safari. All traffic will be sent over HTTP/3.

Firefox

1. Go to about:config.
2. If you receive a warning, select Accept the Risk and Continue.
3. Set network.http.http3.enable to false.
4. Relaunch Firefox.

Microsoft Edge

1. Go to edge://flags
2. Set Experimental QUIC protocol to Disabled.
3. Relaunch Edge.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tenant control

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/tenant-control/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/tenant-control/)

Page options # Tenant control

With Gateway tenant control, you can allow your users access to corporate SaaS applications while blocking access to personal applications. This helps prevent the loss of sensitive or confidential data from a corporate network.

When creating an HTTP policy with an Allow action, you will have the option to configure custom headers. Gateway can use custom headers to control SaaS application access. If a user's HTTP request is headed to your organization's account for the SaaS application, Gateway will approve the request. If the request does not match the information in the header, Gateway will block the request.

## Add custom headers for a SaaS application

To create an HTTP policy with custom headers:

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies. Select HTTP.
2. Select Add a policy.
3. Build an expression to match the SaaS traffic you want to control.
4. In Action, select Allow. In Untrusted certificate action, select Block.
5. Under Add headers to matched requests, select Add a header.
6. Add any custom header names and values corresponding to your SaaS application.
7. Select Create policy.

Your policy is now displayed in your list of HTTP policies. When your users attempt to authenticate your configured SaaS application with a personal account, authentication will fail.

## Common policy configurations

Depending on which SaaS application your organization needs access to, different tenant control policies are required.

### Microsoft 365

Microsoft 365 tenant control requires two policies. When you order your policies, make sure they follow order of precedence.

| Precedence | Selector | Operator | Value | Action | Untrusted certificate action |
| --- | --- | --- | --- | --- | --- |
| 1 | Domain | is | login.live.com | Allow | Block |

| Custom header name | Custom header value |
| --- | --- |
| Sec-Restrict-Tenant-Access-Policy | restrict-msa |

| Precedence | Selector | Operator | Value | Action | Untrusted certificate action |
| --- | --- | --- | --- | --- | --- |
| 2 | Application | in | Microsoft Office365 | Allow | Block |

| Custom header name | Custom header value |
| --- | --- |
| Restrict-Access-To-Tenants, Restrict-Access-Context | Your organization's domain |

For more information, refer to the Microsoft Entra ID documentation ‚Üó.

### Google Workspace

| Selector | Operator | Value | Action | Untrusted certificate action |
| --- | --- | --- | --- | --- |
| Application | in | Google Workspace | Allow | Block |

| Custom header name | Custom header value |
| --- | --- |
| X-GooGApps-Allowed-Domains | Your organization's domain |

For more information, refer to the Google Workspace documentation ‚Üó.

### Slack

| Selector | Operator | Value | Action | Untrusted certificate action |
| --- | --- | --- | --- | --- |
| Application | in | Slack | Allow | Block |

| Custom header name | Custom header value |
| --- | --- |
| X-Slack-Allowed-Workspaces-Requester, X-Slack-Allowed-Workspaces | Your organization's workspace |

For more information, refer to the Slack documentation ‚Üó.

### Dropbox

| Selector | Operator | Value | Action | Untrusted certificate action |
| --- | --- | --- | --- | --- |
| Application | in | Dropbox | Allow | Block |

| Custom header name | Custom header value |
| --- | --- |
| X-Dropbox-allowed-Team-Ids | Your organization's ID |

For more information, refer to the Dropbox documentation ‚Üó.

## Exempt users in Cloudflare WAF

You can include custom headers in an HTTP policy to allow your users through Cloudflare WAF. This is useful for allowing only WARP users through your WAF.

1. Create an Allow policy for an internal domain behind your WAF with a custom header.

















SelectorOperatorValueActionDomainininternalapp.comAllow













Custom header nameCustom header valueX-Example-Headerexample-value
2. In Cloudflare WAF, create a custom rule to require the same HTTP header.

## Use tenant control with Browser Isolation

You can configure Browser Isolation to send custom headers. This is useful for implementing tenant control for isolated SaaS applications or sending arbitrary custom request headers to isolated websites.

To use custom headers with Browser Isolation, create two HTTP policies targeting the same domain or application group. For example, you can create policies for httpbin ‚Üó, an open-source site for testing HTTP requests:

1. Create an Isolate policy for httpbin.org.

















SelectorOperatorValueActionDomaininhttpbin.orgIsolate
2. Create an Allow policy for httpbin.org with a custom header.

















SelectorOperatorValueActionDomaininhttpbin.orgAllow













Custom header nameCustom header valueExample-Headerexample-value
3. Go to httpbin.org/anything ‚Üó. Cloudflare will render the site in an isolated browser. Your custom header will appear in the list of headers.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## AV scanning

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/antivirus-scanning/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/antivirus-scanning/)

Page options # AV scanning

Cloudflare Gateway protects users as they browse the Internet. When users download or upload a file to an origin on the Internet, that file could potentially contain malicious code that may cause their device to perform undesired behavior. To prevent this, Cloudflare Gateway allows admins to turn on anti-virus (AV) scanning of files that are uploaded or downloaded by users as the file passes through Gateway.

In addition to scanning files, Gateway can quarantine files as your users download them. Quarantining files helps protect organizations from zero-day vulnerabilities not yet available in anti-virus databases. For more information, refer to File sandboxing.

## Get started

To turn on AV scanning:

1. In Zero Trust ‚Üó, go to Settings > Network.
2. In Firewall, turn on AV inspection.
3. Choose whether to scan files for malicious payloads during uploads, downloads, or both. You can also block requests containing non-scannable files.
4. (Optional) Turn on Display AV block notification for WARP Client to send block notifications to users connected to Gateway with the WARP Client when AV inspection blocks a file.

When a request is blocked due to the presence of malware, Gateway will log the match as a Block decision in your HTTP logs.

### WARP client block notifications

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP Secure Web Gateway without DNS filtering | Enterprise |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.1.159.0 |
| macOS | ‚úÖ | 2024.1.160.0 |
| Linux | ‚ùå |  |
| iOS | ‚úÖ | 1.7 |
| Android | ‚úÖ | 1.4 |
| ChromeOS | ‚úÖ | 1.4 |

Turn on Display AV block notification for WARP Client to display notifications for Gateway block events. Blocked users will receive an operating system notification from the WARP client with a custom message you set. If you do not set a custom message, the WARP client will display a default message. Custom messages must be 100 characters or less. WARP will only display one notification per minute.

Upon selecting the notification, WARP will direct your users to the Gateway block page you have configured. Optionally, you can direct users to a custom URL, such as an internal support form.

When you turn on Send policy context, Gateway will append details of the matching request to the redirected URL as a query string. Not every context field will be included. Potential policy context fields include:

Policy context fields

| Field | Definition | Example |
| --- | --- | --- |
| User email | Email of the user that made the query. | &cf_user_email=user@example.com |
| Site URL | Full URL of the original HTTP request or domain name in DNS query. | &cf_site_uri=https%3A%2F%2Fmalware.testcategory.com%2F |
| URL category | Domain categories of the URL to be redirected. | &cf_request_categories=New%20Domains,Newly%20Seen%20Domains |
| Original HTTP referer | For HTTP traffic, the original HTTP referer header of the HTTP request. | &cf_referer=https%3A%2F%2Fexample.com%2F |
| Rule ID | ID of the Gateway policy that matched the request. | &cf_rule_id=6d48997c-a1ec-4b16-b42e-d43ab4d071d1 |
| Source IP | Source IP address of the device that matched the policy. | &cf_source_ip=203.0.113.5 |
| Device ID | UUID of the device that matched the policy. | &cf_device_id=6d48997c-a1ec-4b16-b42e-d43ab4d071d1 |
| Application names | Name of the application the redirected domain corresponds to, if any. | &cf_application_name=Salesforce |
| Filter | The traffic type filter that triggered the block. | &cf_filter=http, &cf_filter=dns, &cf_filter=av, or &cf_filter=l4 |
| Account ID | Cloudflare account ID of the associated Zero Trust account. | &cf_account_id=d57c3de47a013c03ca7e237dd3e61d7d |
| Query ID | ID of the DNS query for which the redirect took effect. | &cf_query_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |
| Connection ID | ID of the proxy connection for which the redirect took effect. | &cf_connection_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |
| Request ID | ID of the HTTP request for which the redirect took effect. | &cf_request_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |

Ensure that your operating system allows notifications for WARP. Your device may not display notifications if focus, do not disturb, or screen sharing settings are turned on. To turn on client notifications on macOS devices running DisplayLink software, you may have to allow system notifications when mirroring your display. For more information, refer to the macOS documentation ‚Üó.

## File scan criteria

If AV scanning is turned on, Gateway will use the following criteria to determine whether a file is present in a request or response, and whether to scan that file. The first match will result in the file being scanned.

- If the Content-Disposition HTTP header is Attachment
- If the byte signature of the body of the request matches a signature Gateway identifies as one of the following file type categories:

Executable (for example, .exe, .bat, .dll, and .wasm)
Documents (for example, .doc, .docx, .pdf, .ppt, and .xls)
Compressed (for example, .7z, .gz, .zip, and .rar)
- Executable (for example, .exe, .bat, .dll, and .wasm)
- Documents (for example, .doc, .docx, .pdf, .ppt, and .xls)
- Compressed (for example, .7z, .gz, .zip, and .rar)
- If the file name in the Content-Disposition header contains a file extension that indicates it is one of the file type categories above

If none of the above conditions trigger a file to be scanned, Gateway will use the origin's Content-Type header to determine whether or not to scan the file. Additionally, Gateway will not scan files it determines to be image, video, or audio files.

If a file does not trigger a scan based on the three methods above but also does not match criteria to be exempted from scanning, Gateway will default to scanning the file for malware.

## Opt content out from scanning

When an admin turns on AV scanning for uploads and/or downloads, Gateway will scan every supported file. Admins can selectively choose to disable scanning using HTTP policies. All HTTP selectors can opt HTTP traffic out from AV scanning using the Do Not Scan action. When traffic matches a Do Not Scan policy, nothing is scanned, regardless of file size or whether the file type is supported or not. For example, to prevent AV scanning of files uploaded to or downloaded from example.com, you can create the following policy:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Hostname | matches regex | example.com | Do Not Scan |

Opting out of AV scanning applies to uploads and/or downloads of files, matching your account's global AV scanning setting. For example, if you have configured Gateway to globally scan uploads only, then opting out of AV scanning will only apply to uploads.

## Compatibility

### Supported compressed file types

In addition to standard object files like PDFs, Zero Trust supports AV scanning for the following archive types:

Supported compressed file types

- 7-Zip
- 7-Zip SFX
- ACE
- ACE SFX
- AutoHotkey
- AutoIt
- BASE64
- BZ2
- CHM Help Files
- CPIO SVR4
- Chrome Extension (CRX) Package Format
- eXtensible ARchive format (XAR)
- GZIP compressed files
- ISO 9660
- Inno Setup
- Indigo Rose Setup Factory
- Java ARchive
- LZH/LHA
- MacBinary
- MIME base64
- MSCOMPRESS
- Microsoft CAB
- Microsoft TNEF
- NSIS Nullsoft Installer
- Office Legacy XML
- PGP signed message, document, etc.
- RPM
- RAR
- SAPCar
- Self-extracting ARJ
- Self-extracting CA
- Self-extracting LZH/LHA
- Self-extracting RAR
- Self-extracting ZIP
- Smart Install Maker
- TAR
- UUE and XXE compressed files
- Windows Imaging File (WIM)
- XE compressed files (UUE and XXE)
- XZ file format
- ZIP
- ZOO

Gateway cannot scan certain archive files regardless of file type, such as large or encrypted files.

### Non-scannable files

Gateway cannot scan all files for malware. When Gateway encounters a non-scannable file, you can configure AV scanning whether to fail open (allow the file to pass through unscanned) or to fail closed (deny the file transfer).

Gateway cannot scan requests containing the following files:

- Files larger than:

15 MB on Free plans
25 MB on Pay-as-you-go plans
100 MB on Enterprise plans
- 15 MB on Free plans
- 25 MB on Pay-as-you-go plans
- 100 MB on Enterprise plans
- PGP encrypted files
- Password protected archives
- Archives with more than three recursion levels
- Archives with more than 300 files

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## File sandboxing

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/file-sandboxing/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/file-sandboxing/)

Page options # File sandboxing

Note

Available as an add-on to Zero Trust Enterprise plans. For more information, contact your account team.

In addition to anti-virus (AV) scanning, Gateway can quarantine previously unseen files downloaded by your users into a sandbox and scan them for malware.

If AV scanning does not detect malware in a file download, Gateway will quarantine the file in the sandbox. If the file has not been downloaded before, Gateway will monitor any actions taken by the file and compare them to known malware patterns. During this process, Gateway will display an interstitial page in the user's browser. If the sandbox does not detect malicious activity, Gateway will release the file from quarantine and download it to your user's device. If the sandbox detects malicious activity, Gateway will block the download. For any subsequent downloads of the file, Gateway will remember and apply its allow/block decision.

Gateway will log any file sandbox decisions in your HTTP logs.

```
flowchart TD
    A(["User starts file download"]) --> B["File sent to AV scanner"]
    B --> C["Malicious file detected?"]
    C -- Yes --> D["Download blocked"]
    C -- No --> G["File sent to sandbox"]
    G --> n1["First time file downloaded?"]
    K["Malicious activity detected?"] -- Yes --> N["Download blocked"]
    K -- No --> n3["Download allowed"]
    n2["Interstitial page displayed for user during scan"] --> n4["File activity monitored"]
    n1 -- Yes --> n2
    n4 --> K
    n1 -- No --> K

    B@{ shape: subproc}
    C@{ shape: hex}
    D@{ shape: terminal}
    n1@{ shape: hex}
    K@{ shape: hex}
    N@{ shape: terminal}
    n3@{ shape: terminal}
    n2@{ shape: display}
    n4@{ shape: rect}
    style D stroke:#D50000
    style N stroke:#D50000
    style n3 stroke:#00C853
```

## Get started

To begin quarantining downloaded files, turn on file sandboxing:

1. In Zero Trust ‚Üó, go to Settings > Network.
2. In Firewall, turn on File sandboxing.
3. (Optional) To block requests containing non-scannable files, select Block requests for files that cannot be scanned.

You can now create Quarantine HTTP policies to determine what files to scan in the sandbox.

## Create test policy

To test if file sandboxing is working, you can create a Quarantine policy that matches the Cloudflare Sandbox Test ‚Üó:

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies, then select HTTP.
2. Select Add a policy.
3. Add the following expression:

















SelectorOperatorValueActionHostissandbox.cloudflaredemos.comQuarantine
4. In Sandbox file types, select ZIP Archive (zip).
5. From a device connected to your Zero Trust organization, open a browser and go to the Cloudflare Sandbox Test ‚Üó.
6. Select Download Test File.

Gateway will quarantine and scan the file, display an interstitial status page in the browser, then release the file for download.

## Sandbox environment

Gateway executes quarantined files in a sandboxed Windows operating system environment. Using machine learning, the sandbox compares how files of a certain type behave compared to how these files should behave. The sandbox detects file actions down to the kernel level and compare these a real-time malware database. In addition, Gateway checks the sandbox's network activity for malicious behavior and data exfiltration.

## Compatibility

### Supported file types

File sandboxing supports scanning the following file types:

Supported sandboxing file types

- .exe
- .pdf
- .doc
- .docm
- .docx
- .rtf
- .ppt
- .pptx
- .xls
- .xlsm
- .xlsx
- .zip
- .rar

### Non-scannable files

Gateway cannot scan requests containing the following files:

- Files larger than 100 MB
- PGP encrypted files

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Egress policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/egress-policies/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/egress-policies/)

Page options # Egress policies

Note

Only available on Enterprise plans.

When your users connect to the Internet through Cloudflare Gateway, by default their traffic is assigned a source IP address that is shared across all Cloudflare WARP users. Enterprise users can purchase dedicated egress IPs to ensure that egress traffic from your organization is assigned a unique, static IP. These source IPs are dedicated to your account and can be used within allowlists on upstream services.

Egress policies allow you to control which dedicated egress IP is used and when, based on attributes such as identity, IP address, and geolocation. Traffic that does not match an egress policy will default to using the most performant dedicated egress IP.

Cloudflare does not publish WARP egress IP ranges. WARP egress IPs are not documented at Cloudflare's IP Ranges ‚Üó. To obtain a dedicated WARP egress IP, contact your account team.

Terraform provider v4 precedence limitation

To avoid conflicts, version 4 of the Terraform Cloudflare provider applies a hash calculation to policy precedence. For example, a precedence of 1000 may become 1000901. This can cause errors when reordering policies. To avoid this issue, manually set the precedence of policies created with Terraform using the Update a Zero Trust Gateway rule endpoint.

To ensure your precedence is set correctly, Cloudflare recommends upgrading your Terraform provider to version 5 ‚Üó.

## Load balancing

When using either the default Cloudflare egress IPs or any dedicated egress IPs, Gateway traffic that does not match an egress policy will egress from the closest Cloudflare data center with a default Gateway egress IP. If there are two data centers of equal distance from the user, Gateway will split the traffic between the two data centers, and the load balancer will retain the same user selection and egress IP regardless of data center.

## Force IP version

To control whether only IPv4 or IPv6 is used to egress, ensure you are filtering DNS traffic, then create a DNS policy to block AAAA or A records.

## Example policies

The following egress policy configures all traffic destined for a third-party network to use a static source IP:

| Policy name | Selector | Operator | Value | Egress method |
| --- | --- | --- | --- | --- |
| Access third-party provider | Destination IP | is | 198.51.100.158 | Dedicated Cloudflare egress IPs |

| Primary IPv4 address | IPv6 address |
| --- | --- |
| 203.0.113.88 | 2001:db8::/32 |

### Catch-all policy

For the best performance, we recommend creating a catch-all policy to route all other users through the default Zero Trust IP range:

| Policy name | Selector | Operator | Value | Egress method |
| --- | --- | --- | --- | --- |
| Default egress policy | Protocol | in | All options (Protocol) | Cloudflare default egress method |

Since Gateway policies evaluate from top to bottom in the UI, be sure to place the catch-all policy at the bottom of the list. If you do not include a catch-all policy, all other traffic will attempt to use the closest dedicated egress IP location. To control which egress IP Gateway uses, create an egress policy.

## Egress methods

Choose one of the following options for your egress policy:

- Use default Cloudflare egress method uses the default source IP range shared across all Zero Trust accounts. Ensures the most performant Internet experience as user traffic egresses from the nearest Cloudflare data center.
- Use dedicated egress IPs (Cloudflare or BYOIP) uses the primary IPv4 address and IPv6 range selected in the dropdown menus. You can optionally specify a secondary IPv4 address in a different data center. If the primary data center goes down, Gateway will egress from the secondary data center to avoid traffic drops during reroutes. There is no need for a secondary IPv6 because IPv6 traffic can egress from any Cloudflare data center. Dedicated egress IPs can be provided by either Cloudflare or BYOIP. To learn more about IPv4 and IPv6 egress behavior, refer to Egress locations.

## Selectors

Gateway matches egress traffic against the following selectors, or criteria:

### Application Beta

You can apply egress policies to a growing list of popular web applications. Refer to Application and app types for more information.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Application | any(app.ids[*] in {505}) | Before DNS resolution |

This selector is only available for traffic onboarded to Gateway with WARP, PAC files, or Browser Isolation. For more information, refer to Selector prerequisites.

### Content Categories Beta

Applications within a specific security category as categorized by Cloudflare Radar.

| UI name | API example |
| --- | --- |
| Content Categories | any(net.fqdn.content_category[*] in {1}) |

This selector is only available for traffic onboarded to Gateway with WARP, PAC files, or Browser Isolation. For more information, refer to Selector prerequisites.

### Destination Continent

The continent where the request is destined. Geolocation is determined from the target IP address. To specify a continent, enter its two-letter code into the Value field:

| Continent | Code |
| --- | --- |
| Africa | AF |
| Antarctica | AN |
| Asia | AS |
| Europe | EU |
| North America | NA |
| Oceania | OC |
| South America | SA |
| Tor network | T1 |

| UI name | API example |
| --- | --- |
| Destination Continent IP Geolocation | net.dst.geo.continent == "EU" |

### Destination Country

The country that the request is destined for. Geolocation is determined from the target IP address. To specify a country, enter its ISO 3166-1 Alpha 2 code ‚Üó in the Value field.

| UI name | API example |
| --- | --- |
| Destination Country IP Geolocation | net.dst.geo.country == "RU" |

### Destination IP

The IP address of the request's target.

| UI name | API example |
| --- | --- |
| Destination IP | any(net.dst.ip[*] in {10.0.0.0/8}) |

### Destination Port

The port number of the request's target.

| UI name | API example |
| --- | --- |
| Destination Port | net.dst.port == 2222 |

### Device Posture

With the Device Posture selector, admins can use signals from end-user devices to secure access to their internal and external resources. For example, a security admin can choose to limit all access to internal applications based on whether specific software is installed on a device and/or if the device or software are configured in a particular way.

For more information on device posture checks, refer to Device posture.

| UI name | API example |
| --- | --- |
| Passed Device Posture Checks | any(device_posture.checks.failed[*] in {"1308749e-fcfb-4ebc-b051-fe022b632644"}), any(device_posture.checks.passed[*] in {"1308749e-fcfb-4ebc-b051-fe022b632644"})" |

### Domain Beta

Use this selector to match against a domain and all subdomains. For example, you can match example.com and its subdomains, such as www.example.com.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Domain | any(net.fqdn.domains[*] == "example.com") | Before DNS resolution |

Gateway policies do not support domains with non-Latin characters directly. To use a domain with non-Latin characters, add it to a list.

This selector is only available for traffic onboarded to Gateway with WARP, PAC files, or Browser Isolation. For more information, refer to Selector prerequisites.

### Host Beta

Use this selector to match against only the hostname specified. For example, you can match test.example.com but not example.com or www.test.example.com.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Host | net.fqdn.host == "example.com" | Before DNS resolution |

Gateway policies do not support hostnames with non-Latin characters directly. To use a hostname with non-Latin characters, add it to a list.

Note

Some hostnames (example.com) will invisibly redirect to the www subdomain (www.example.com). To match this type of website, use the Domain selector instead of the Host selector.

This selector is only available for traffic onboarded to Gateway with WARP, PAC files, or Browser Isolation. For more information, refer to Selector prerequisites.

### Protocol

The protocol used to send the packet.

| UI name | API example |
| --- | --- |
| Protocol | net.protocol == "tcp" |

### Proxy Endpoint

The proxy server where your browser forwards HTTP traffic.

| UI name | API example |
| --- | --- |
| Proxy Endpoint | proxy.endpoint == "3ele0ss56t.proxy.cloudflare-gateway.com" |

### Source Continent

The continent of the user making the request.

Geolocation is determined from the device's public IP address (typically assigned by the user's ISP). To specify a continent, enter its two-letter code into the Value field:

| Continent | Code |
| --- | --- |
| Africa | AF |
| Antarctica | AN |
| Asia | AS |
| Europe | EU |
| North America | NA |
| Oceania | OC |
| South America | SA |
| Tor network | T1 |

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Source Continent IP Geolocation | net.src.geo.continent == "North America" | Before DNS resolution |

### Source Country

The country of the user making the request.

Geolocation is determined from the device's public IP address (typically assigned by the user's ISP). To specify a country, enter its ISO 3166-1 Alpha-2 code ‚Üó in the Value field.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Source Country IP Geolocation | net.src.geo.country == "RU" | Before DNS resolution |

### Source Internal IP

Use this selector to apply egress policies to a private IP address, assigned by a user's local network, that requests arrive to Gateway from. This selector will only apply to users connected through a Magic GRE or IPSec tunnel.

| UI name | API example |
| --- | --- |
| Source Internal IP | net.src.internal_src_ip == "192.168.86.0/27" |

### Source IP

The originating IP address or addresses of a device proxied by Gateway.

| UI name | API example |
| --- | --- |
| Source IP | net.src.ip[*] in {10.0.0.0/8} |

### Source Port

The originating port of a device proxied by Gateway.

| UI name | API example |
| --- | --- |
| Source Port | net.src.port == "2222" |

### Users

Identity-based selectors include:

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

To use identity-based selectors, enable Gateway with WARP in the Zero Trust WARP client and enroll your user in your organization. For more information, refer to Identity-based policies.

### Virtual Network

Use this selector to match all traffic routed through a specific Tunnel Virtual Network via the WARP client.

| UI name | API example |
| --- | --- |
| Virtual Network | net.vnet_id == "957fc748-591a-e96s-a15d-1j90204a7923" |

## Comparison operators

Comparison operators are the way Gateway matches traffic to a selector. When you choose a Selector in the dashboard policy builder, the Operator dropdown menu will display the available options for that selector.

| Operator | Meaning |
| --- | --- |
| is | equals the defined value |
| is not | does not equal the defined value |
| in | matches at least one of the defined values |
| not in | does not match any of the defined values |
| in list | in a pre-defined list of values |
| not in list | not in a pre-defined list of values |
| matches regex | regex evaluates to true |
| does not match regex | regex evaluates to false |
| greater than | exceeds the defined number |
| greater than or equal to | exceeds or equals the defined number |
| less than | below the defined number |
| less than or equal to | below or equals the defined number |

## Value

You can input a single value or use regular expressions to specify a range of values.

Gateway uses Rust to evaluate regular expressions. The Rust implementation is slightly different than regex libraries used elsewhere. To evaluate if your regex matches, you can use Rustexp ‚Üó.

## Logical operators

To evaluate multiple conditions in an expression, select the And logical operator. These expressions can be compared further with the Or logical operator.

| Operator | Meaning |
| --- | --- |
| And | match all of the conditions in the expression |
| Or | match any of the conditions in the expression |

The Or operator will only work with conditions in the same expression group. For example, you cannot compare conditions in Traffic with conditions in Identity or Device Posture.

## Limitations

### Selector prerequisites

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP | Enterprise |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2025.4.929.0 |
| macOS | ‚úÖ | 2025.4.929.0 |
| Linux | ‚úÖ | 2025.4.929.0 |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

The Application, Content Categories, Domain, and Host selectors are only available for traffic on-ramped to Gateway with the following methods:

| On-ramp method | Compatibility |
| --- | --- |
| WARP | ‚úÖ |
| PAC files | ‚úÖ |
| Browser Isolation | ‚úÖ |
| WARP Connector | ‚ùå |
| Magic WAN | ‚ùå |

When you use these selectors in an egress policy for traffic from a supported on-ramp, Gateway will assign initial resolved IPs in the 100.80.0.0/16 range to the DNS queries, then apply the correct egress IP according to the egress policy. Unsupported traffic will be resolved with your default Gateway settings. Gateway will only overwrite the DNS response when the query matches a condition in the egress policy. If you use DNS locations to send a DNS query to Gateway with IPv4, IPv6, DoT, or DoH, Gateway will not return the initial resolved IP for supported traffic nor resolve unsupported traffic.

Gateway will overwrite the DNS response for all supported traffic, even if you use identity or device posture selectors to limit which users or devices are affected by the policy. In these cases, while the DNS response is overwritten, Gateway will still apply the correct egress policy.

To turn on the selectors for your account:

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Settings > Network.
2. In Firewall, turn on Host selector.

Use the Patch Zero Trust account configuration endpoint to update your Zero Trust configuration. For example:

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Patch Zero Trust account configuration ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/configuration" \  --request PATCH \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "settings": {        "host_selector": {            "enabled": true        }    }  }'
```

Additionally, to use these selectors to filter traffic onboarded with WARP, you need to:

1. Ensure you have deployed WARP version 2025.4.929.0 or later on your users' desktop devices. If you need to apply your policies to mobile devices or devices running a version of WARP prior to 2025.4.929.0, add and deploy the following key-value pair to your devices' WARP configuration file (mdm.xml on Windows and Linux or com.cloudflare.warp.plist on macOS):
<array>  <dict>    <key>doh_in_tunnel</key>    <true/>  </dict></array>

1. In your WARP device profile, configure your Split Tunnel depending on the mode:
      Exclude IPs and domains     Include IPs and domains      
Remove the route to the IP address 100.64.0.0/10 from your Split Tunnel exclude list.
Add routes to exclude the following IP addresses:

100.64.0.0/12
100.81.0.0/16
100.82.0.0/15
100.84.0.0/14
100.88.0.0/13
100.96.0.0/11


  
Add the required Zero Trust domains or [IP addresses](/cloudflare-one/connections/connect-devices/warp/ configure-warp/route-traffic/split-tunnels/#cloudflare-zero-trust-ip-addresses) to your Split Tunnel include list.
Add a route to include the IP address 100.80.0.0/16.
2. Exclude IPs and domains
3. Include IPs and domains
4. Remove the route to the IP address 100.64.0.0/10 from your Split Tunnel exclude list.
5. Add routes to exclude the following IP addresses:

100.64.0.0/12
100.81.0.0/16
100.82.0.0/15
100.84.0.0/14
100.88.0.0/13
100.96.0.0/11
6. 100.64.0.0/12
7. 100.81.0.0/16
8. 100.82.0.0/15
9. 100.84.0.0/14
10. 100.88.0.0/13
11. 100.96.0.0/11
12. Add the required Zero Trust domains or [IP addresses](/cloudflare-one/connections/connect-devices/warp/ configure-warp/route-traffic/split-tunnels/#cloudflare-zero-trust-ip-addresses) to your Split Tunnel include list.
13. Add a route to include the IP address 100.80.0.0/16.

The WARP client must be set to Gateway with WARP mode for traffic affected by these selectors to route correctly.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Dedicated egress IPs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/egress-policies/dedicated-egress-ips/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/egress-policies/dedicated-egress-ips/)

Page options # Dedicated egress IPs

Note

Only available as an add-on to Zero Trust Enterprise plans.

Dedicated egress IPs are static IP addresses that can be used to allowlist traffic from your organization. These IPs are unique to your account and are not used by any other customers routing traffic through Cloudflare's network. Each dedicated egress IP consists of an IPv4 address and an IPv6 range that are assigned to a specific Cloudflare data center. At minimum, Cloudflare will provision your account with two dedicated egress IPs corresponding to data centers in two different cities.

An account can have any number of additional dedicated egress IPs. To request additional dedicated egress IPs, contact your account team to schedule a service window.

## Turn on egress IPs

To start routing traffic through dedicated egress IPs:

1. Contact your account team to obtain a dedicated egress IP.
2. In Zero Trust ‚Üó, go to Settings > Network.
3. In Firewall, turn on Proxy.
4. Select TCP.
5. (Optional) Select UDP. This will allow HTTP/3 traffic to egress with your dedicated IPs.

Dedicated egress IPs are now turned on for all network and HTTP traffic proxied by Gateway. To selectively turn on dedicated egress IPs for a subset of your traffic, refer to egress policies.

## Verify egress IPs

To check if your device is using the correct dedicated egress IP:

1. Verify that the device is connected to your Zero Trust organization through the WARP client.
2. Determine the source IPv4 address of your device by going to https://ipv4.icanhazip.com/.
3. Determine the source IPv6 address of your device by going to https://ipv6.icanhazip.com/.
4. Verify that the source IPv4 and IPv6 addresses match your dedicated egress IP.

When testing against another origin, you may see either an IPv4 or IPv6 address. Gateway has no control over whether connections are made over IPv4 or IPv6. Some origins are only available over IPv4, while others are only available over IPv6. When both protocols are supported, the decision is made by the operating system and browser on the client device. For example, Windows will by default favor IPv6 ‚Üó over IPv4.

## Bring your own IP address (BYOIP)

Enterprise users can use their own authority-provided IPv4 and IPv6 addresses as dedicated egress IPs. Gateway supports bringing your own IPv4 and IPv6 addresses. To obtain an IPv6 range, refer to American Registry for Internet Numbers (ARIN) ‚Üó or Regional Internet Registry for Europe, Middle East and Central Asia (RIPE NCC) ‚Üó.

After you onboard your IP addresses, the IP addresses will appear when you create a egress policy and choose Use dedicated egress IPs (Cloudflare or BYOIP) as the egress method. BYOIP dedicated egress IPs do not support IP geolocation.

For more information, refer to Cloudflare BYOIP or contact your account team.

## Limitations

### Concurrent connections

Each dedicated egress IP assigned to your organization supports 40,000 concurrent connections per destination IP and destination port. You can configure multiple origins for each combination of dedicated egress IP and source port.

### Unsupported traffic

Dedicated egress IPs do not apply to:

- DNS queries resolved through Gateway
- Private networks connected to Zero Trust via Cloudflare Tunnel
- Traffic destined for private networks connected to Zero Trust via Magic WAN
- ICMP traffic (such as ping)

These origins will see the default shared IPs instead of the dedicated egress IPs. This is because Cloudflare can filter traffic to these origins by identifiers other than source IP.

### Traffic resilience

To improve traffic resilience, assign your dedicated egress IPs to different Cloudflare data center locations. If you have multiple IPs in the same city, choose different data centers within that city. For more information, contact your account team.

When creating egress policies with dedicated egress IPs, set your secondary IPv4 address to either Default Cloudflare egress or a Cloudflare location different from your primary IPv4 address. If the physical location of your primary IPv4 address is not available, traffic will be routed to either the location closest to the user (Default Cloudflare egress option) or another location of your choice.

### IP geolocation

Note

IP geolocation will take at least six weeks to update across databases.

Your egress traffic will geolocate to the city selected in your egress policies. If the traffic does not match an egress policy, IP geolocation defaults to the closest dedicated egress location to the user. We recommend you create a catch-all egress policy before dedicated egress IPs are assigned to your account. This will prevent incorrect geolocation for your users' traffic while geolocation databases update.

When you turn on dedicated egress IPs, Gateway will update third-party IP geolocation databases. Other websites, such as Google Search, will check these databases to geolocate a user's source IP. For example, if your users are in India, Google will direct them to the United States Google landing page instead of the India landing page until Google recognizes the updated IP geolocation.

To verify that the IP geolocation has updated, check your dedicated egress IP in one of the supported databases:

Supported IP geolocation databases

- Google ‚Üó
- MaxMind GeoIP ‚Üó
- TransUnion Neustar TruValidate IP Intelligence ‚Üó
- Abstract IP Geolocation API ‚Üó
- DB-IP ‚Üó
- Digital Element ‚Üó
- Geo Targetly ‚Üó
- IP-API.com ‚Üó
- IP2Location ‚Üó
- IPinfo.io ‚Üó
- ip2c.org ‚Üó
- ipapi ‚Üó
- ipgeolocation.io ‚Üó
- ipify ‚Üó
- Ipstack ‚Üó

### Egress location

Your users' physical egress location will vary depending on whether their connection is over IPv4 or IPv6.

| Destination IP | Destination proxied by Cloudflare | Physical egress location |
| --- | --- | --- |
| IPv4 | No | Egresses data center with dedicated egress IP |
| IPv4 | Yes | Egresses locally connected data center |
| IPv6 | No | Egresses locally connected data center |
| IPv6 | Yes | Egresses locally connected data center |

Regardless of egress location, the IP geolocation will match the assigned dedicated egress IP.

#### IPv4

To physically egress from a specific location, traffic must be proxied to Cloudflare via IPv4. The end user connects to the nearest Cloudflare data center, but Cloudflare will internally route their traffic to egress from the dedicated location configured in your egress policies. Therefore, the connected data center shown in the user's WARP client preferences may not match their actual egress location.

We are able to offer better IPv4 performance when users visit domains proxied by Cloudflare (also known as an orange-clouded domain). In this scenario, IPv4 traffic will physically egress from the most performant data center in our network while still appearing to egress from your dedicated location.

For example, assume you have a primary dedicated egress IP in Los Angeles and a secondary dedicated egress IP in New York. A user in Las Vegas would see Las Vegas as their connected data center. If they go to a site not proxied by Cloudflare (gray-clouded), such as espn.com, they will egress from Los Angeles (or whichever city is in the matching egress policy). If they go to an orange-clouded site such as cloudflare.com, they will physically egress from Las Vegas but use Los Angeles as their IP geolocation.

#### IPv6

Traffic proxied via IPv6, unlike IPv4, will physically egress from the connected data center but logically egress with one of your dedicated IP geolocations. In the example above, the Las Vegas user would egress from Las Vegas but IP geolocate from Los Angeles.

## Frequently asked questions (FAQ)

### Can I provision the same egress IP address to multiple data centers?

No, egress IPs are limited to a single data center.

### Can my users in different locations egress from their closest data center via a single egress IP?

No, traffic will only egress from the data center where the egress IP is provisioned. If you have users in locations far apart, we recommend reserving multiple egress IPs across different data centers and provisioning your users to their closest data centers.

### Can I use dedicated egress IPs with traffic proxied via PAC files?

Yes, your users will egress via their provisioned IP address.

### What happens when I use dedicated egress IPs with Cloudflare Browser Isolation?

Your users will connect to the nearest data center, where the remote browser session will load. The remote browser will then egress via the data center with their provisioned egress IP.

### Do dedicated egress IPs work on the Cloudflare China Network?

No, Gateway does not support dedicated egress IPs on the China Network.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Resolver policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/resolver-policies/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/resolver-policies/)

Page options # Resolver policies

Note

Only available on Enterprise plans.

By default, Gateway sends DNS requests to 1.1.1.1, Cloudflare's public DNS resolver, for resolution. Enterprise users can instead create Gateway policies to route DNS queries to custom resolvers.

```
flowchart TD
    %% Accessibility
    accTitle: How Gateway routes DNS queries
    accDescr: Flowchart describing the order Cloudflare Gateway routes a DNS query from an endpoint through DNS and resolver policies back to the user.

    %% Flowchart
    user(["User"])-->endpoint[/"Gateway DNS endpoint"/]

    endpoint-->query["DNS policy (query)"]

    query-->resolver["Resolver policy"]

    resolver--"Routes to </br>custom resolver"-->response["DNS policy (response)"]

    response--"Returns response"-->user
```

Gateway will route user traffic to your configured DNS resolver based on the matching policy, even if your resolvers' IP addresses overlap.

## Use cases

You may use resolver policies if you require access to non-publicly routed domains, such as private network services or internal resources. You may also use resolver policies if you need to access a protected DNS service or want to simplify DNS management for multiple locations.

### Internal DNS Beta

Cloudflare Internal DNS allows you to manage DNS records for internal resources on a private network. DNS zones configured in Internal DNS can only be queried by the Gateway resolver. With resolver policies, you can determine how Gateway resolves your organization's DNS queries to resolve to internal resources based on the context of the query, such as known source IPs for a geographic location.

To get started with resolving internal DNS queries with resolver policies, refer to Get started.

### Local Domain Fallback

If your resolver is only reachable by a client device and not by Gateway via a Cloudflare tunnel, Magic WAN tunnel, or other public Internet connections, you should configure Local Domain Fallback for your device. If both Local Domain Fallback and resolver policies are configured for the same device, Cloudflare will apply your client-side Local Domain Fallback rules first. If you onboard DNS queries to Gateway with the WARP client and route them with resolver policies, the source IP of the queries will be the IP address assigned by the WARP client.

Local Domain Fallback or Gateway Resolver policies?

If your DNS server can be configured to connect to a Cloudflare on-ramp, Cloudflare recommends using Gateway Resolver policies rather than Local Domain Fallback. Gateway Resolver policies provide more visibility by allowing you to log and review DNS traffic.

## Resolver connections

Resolver policies support TCP and UDP connections. Custom resolvers can point to the Internet via IPv4 or IPv6, or to a private network service, such as a Magic tunnel. Policies default to port 53. You can change which port your resolver uses by customizing it in your policy.

You can protect your authoritative nameservers from DDoS attacks by enabling DNS Firewall.

### Cloudflare Tunnel

You can configure connections to a private resolver connected to Cloudflare with Cloudflare Tunnel. To ensure cloudflared can route UDP traffic to your resolver, connect your tunnel via QUIC.

For more information on connecting a private DNS resolver to Cloudflare with Cloudflare Tunnel, refer to Private DNS.

### Magic WAN

To enable connections to a private resolver connected to Cloudflare via Magic WAN, contact your account team.

### Available DNS endpoints

Resolver policies can route queries for resolution from the following DNS endpoints:

- IPv4
- IPv6
- DNS over HTTPS (DoH)
- DNS over TLS (DoT)
- DNS queries generated by Cloudflare Browser Isolation and Clientless Web Isolation
- DNS queries generated by proxy endpoints

Gateway will filter, resolve, and log your queries regardless of endpoint.

## Create a resolver policy

Virtual network limitation

Resolver policies do not automatically update when you change the virtual networks associated with a route. If you move a route from one virtual network to another, the resolver policy will still reference the old virtual network. You will need to manually remove and recreate the resolver policy to update the route.

To create a resolver policy:

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Gateway > Resolver policies.
2. Select Add a policy.
3. Create an expression for your desired traffic. For example, you can resolve a hostname for an internal service:















SelectorOperatorValueHostininternal.example.com
Make sure your destination is not subject to Local Domain Fallback.
4. In Select DNS resolver, choose Configure custom DNS resolvers.
5. Enter the IP addresses of your custom DNS resolver. As you enter an IP address, Gateway will search through your virtual networks configured in Zero Trust.
6. In Network, choose whether to route queries publicly (to the Internet) or privately (to a private network service).
7. (Optional) Enter a custom port for each IP address.
8. Select Create policy.

Custom resolvers are saved to your account for future use. You can add up to 10 IPv4 and 10 IPv6 addresses to a policy.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Create a resolver policy using the cloudflare_zero_trust_gateway_policy ‚Üó resource:
resource "cloudflare_zero_trust_gateway_policy" "resolver_policy" {  name        = "Example resolver policy"  enabled     = true  account_id  = var.cloudflare_account_id  description = "TERRAFORM MANAGED resolver policy"  action      = "resolve"  traffic     = "dns.fqdn in {\"internal.example.com\"}"  identity    = "identity.email in {\"jdoe@example.com\"}"  precedence  = 1  rule_settings = {      dns_resolvers = {      # You can add up to 10 IPv4 and 10 IPv6 addresses to a policy.        ipv4 = [{          ip = "192.0.2.24"          port = 53          route_through_private_network = true          vnet_id = cloudflare_zero_trust_tunnel_cloudflared_virtual_network.staging_vnet.id        }]        ipv6 = [{          ip = "2001:DB8::"          port = 53          route_through_private_network = true          vnet_id = cloudflare_zero_trust_tunnel_cloudflared_virtual_network.staging_vnet.id        }]      }  }}

When a user's query matches a resolver policy, Gateway will send the query to your listed resolvers in the following order:

1. Public resolvers
2. Private resolvers behind the default virtual network for your account
3. Private resolvers behind a custom virtual network

Gateway will cache the fastest resolver for use in subsequent queries. Resolver priority is cached on a per user basis for each data center.

For more information on creating a DNS policy, refer to DNS policies.

Terraform provider v4 precedence limitation

To avoid conflicts, version 4 of the Terraform Cloudflare provider applies a hash calculation to policy precedence. For example, a precedence of 1000 may become 1000901. This can cause errors when reordering policies. To avoid this issue, manually set the precedence of policies created with Terraform using the Update a Zero Trust Gateway rule endpoint.

To ensure your precedence is set correctly, Cloudflare recommends upgrading your Terraform provider to version 5 ‚Üó.

## Selectors

### Content Categories

Use this selector to filter domains belonging to specific content categories.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Content Categories | any(dns.content_category[*] in {1}) | Before DNS resolution |

### DNS Resolver IP

Use this selector to apply policies to DNS queries that arrived to your Gateway Resolver IP address aligned with a registered DNS location. For most Gateway customers, this is an IPv4 anycast address and policies created using this IPv4 address will apply to all DNS locations. However, each DNS location has a dedicated IPv6 address and some Gateway customers have been supplied with a dedicated IPv4 address ‚Äî these both can be used to apply policies to specific registered DNS locations.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| DNS Resolver IP | any(dns.resolved_ip[*] == 198.51.100.0) | Before DNS resolution |

### DoH Subdomain

Use this selector to match against DNS queries that arrive via DNS-over-HTTPS (DoH) destined for the DoH endpoint configured for each DNS location. For example, you can use a DNS location with a DoH endpoint of abcdefg.cloudflare-gateway.com by choosing the DoH Subdomain selector and inputting a value of abcdefg.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| DOH Subdomain | dns.doh_subdomain == "abcdefg" | Before DNS resolution |

### Domain

Use this selector to match against a domain and all subdomains. For example, you can match example.com and its subdomains, such as www.example.com.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Domain | any(dns.domains[*] == "example.com") | Before DNS resolution |

Gateway policies do not support domains with non-Latin characters directly. To use a domain with non-Latin characters, add it to a list.

### Host

Use this selector to match against only the hostname specified. For example, you can match test.example.com but not example.com or www.test.example.com.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Host | dns.fqdn == "example.com" | Before DNS resolution |

Gateway policies do not support hostnames with non-Latin characters directly. To use a hostname with non-Latin characters, add it to a list.

Note

Some hostnames (example.com) will invisibly redirect to the www subdomain (www.example.com). To match this type of website, use the Domain selector instead of the Host selector.

### Location

Use this selector to apply policies to a specific Gateway DNS location or set of locations.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Location | dns.location in {"location_uuid_1" "location_uuid_2"} | Before DNS resolution |

### Query Record Type

Use this selector to choose the DNS resource record type that you would like to apply policies against. For example, you can match A records for a domain but not MX records.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Query Record Type | dns.query_rtype == "TXT" | Before DNS resolution |

### Security Categories

Use this selector to match domains (and optionally, IP addresses) belonging to specific security categories.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Security Categories | any(dns.security_category[*] in {1}) | Before DNS resolution |

### Source Continent

Use this selector to filter based on the continent where the query arrived to Gateway from.

Geolocation is determined from the device's public IP address (typically assigned by the user's ISP). To specify a continent, enter its two-letter code into the Value field:

| Continent | Code |
| --- | --- |
| Africa | AF |
| Antarctica | AN |
| Asia | AS |
| Europe | EU |
| North America | NA |
| Oceania | OC |
| South America | SA |
| Tor network | T1 |

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Source Continent IP Geolocation | dns.src.geo.continent == "North America" | Before DNS resolution |

### Source Country

Use this selector to filter based on the country where the query arrived to Gateway from.

Geolocation is determined from the device's public IP address (typically assigned by the user's ISP). To specify a country, enter its ISO 3166-1 Alpha-2 code ‚Üó in the Value field.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Source Country IP Geolocation | dns.src.geo.country == "RU" | Before DNS resolution |

### Source IP

Use this selector to apply policies to the source IP address of DNS queries. For example, this could be the WAN IP address of the stub resolver used by your organization to send queries to Gateway.

| UI name | API example | Evaluation phase |
| --- | --- | --- |
| Source IP | dns.src_ip == 198.51.100.0 | Before DNS resolution |

### Users

Identity-based selectors include:

- SAML Attributes
- User Email
- User Group Emails
- User Group IDs
- User Group Names
- User Name

To use identity-based selectors, enable Gateway with WARP in the Zero Trust WARP client and enroll your user in your organization. For more information, refer to Identity-based policies.

## Comparison operators

Comparison operators are the way Gateway matches traffic to a selector. When you choose a Selector in the dashboard policy builder, the Operator dropdown menu will display the available options for that selector.

| Operator | Meaning |
| --- | --- |
| is | equals the defined value |
| is not | does not equal the defined value |
| in | matches at least one of the defined values |
| not in | does not match any of the defined values |
| in list | in a pre-defined list of values |
| not in list | not in a pre-defined list of values |
| matches regex | regex evaluates to true |
| does not match regex | regex evaluates to false |
| greater than | exceeds the defined number |
| greater than or equal to | exceeds or equals the defined number |
| less than | below the defined number |
| less than or equal to | below or equals the defined number |

## Value

In the Value field, you can input a single value when using an equality comparison operator (such as is) or multiple values when using a containment comparison operator (such as in). Additionally, you can use regular expressions (or regex) to specify a range of values for supported selectors.

### Regular expressions

Gateway uses Rust to evaluate regular expressions. The Rust implementation is slightly different than regex libraries used elsewhere. For more information, refer to our guide for Wildcards. To evaluate if your regex matches, you can use Rustexp ‚Üó.

If you want to match multiple values, you can use the pipe symbol (|) as an OR operator. In Gateway, you do not need to use an escape character (\) before the pipe symbol. For example, the following policy blocks requests to two hostnames if either appears in a request header:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Host | matches regex | .\*whispersystems.org|.\*signal.org | Block |

In addition to regular expressions, you can use logical operators to match multiple values.

## Logical operators

To evaluate multiple conditions in an expression, select the And logical operator. These expressions can be compared further with the Or logical operator.

| Operator | Meaning |
| --- | --- |
| And | match all of the conditions in the expression |
| Or | match any of the conditions in the expression |

The Or operator will only work with conditions in the same expression group. For example, you cannot compare conditions in Traffic with conditions in Identity.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Identity-based policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/identity-selectors/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/identity-selectors/)

Page options # Identity-based policies

With Cloudflare Zero Trust, you can create Secure Web Gateway policies that filter outbound traffic down to the user identity level. To do that, you can build DNS, HTTP or Network policies using a set of identity-based selectors. These selectors require you to deploy the Zero Trust WARP client in Gateway with WARP mode.

You may also filter outbound traffic based on additional signals from device posture checks.

## Gateway identity checks

Gateway checks identity when a user logs in or re-authenticates. To check your users' identities and require re-authentication at regular intervals, you can enforce a WARP client session duration.

Unless you use an IdP that supports SCIM provisioning, Gateway will not detect when you add or remove a user from a group in your IdP until the user re-authenticates to your Zero Trust instance. There are two ways a user can re-authenticate:

- Log out from an Access-protected application and log back in.
- In their WARP client settings, select Preferences > Account > Re-Authenticate Session. This will open a browser window and prompt the user to log in.

To view the identity that Gateway will use when evaluating policies, check the user registry.

### Automatic SCIM IdP updates

Gateway will automatically detect changes in user name, title, and group membership for IdPs configured with System for Cross-domain Identity Management (SCIM) provisioning. For more information, refer to SCIM provisioning.

### Extended email addresses

Extended email addresses (also known as plus addresses) are variants of an existing email address with + or . modifiers. Many email providers, such as Gmail and Outlook, deliver emails intended for an extended address to its original address. For example, providers will deliver emails sent to contact+123@example.com or con.tact@example.com to contact@example.com.

By default, Gateway will either filter only exact matches or all extended variants depending on the type of policy and action used:

DNS policies

| Action | Behavior |
| --- | --- |
| Allow | Match exact address only |
| Block | Match exact address and all variants |
| Override | Match exact address and all variants |
| Safe Search | Match exact address and all variants |
| YouTube Restricted | Match exact address and all variants |

Network policies

| Action | Behavior |
| --- | --- |
| Allow | Match exact address only |
| Audit SSH | Match exact address and all variants |
| Block | Match exact address and all variants |
| Network Override | Match exact address only |

HTTP policies

| Action | Behavior |
| --- | --- |
| Allow | Match exact address only |
| Block | Match exact address and all variants |
| Do Not Inspect | Match exact address only |
| Do Not Isolate | Match exact address only |
| Do Not Scan | Match exact address only |
| Isolate | Match exact address and all variants |

Other policies

| Policy type | Behavior |
| --- | --- |
| Egress policy | Match exact address only |
| Resolver policy | Match exact address only |

To force Gateway to match all email address variants, go to Settings > Network > Firewall and turn on Match extended email addresses. This setting applies to all firewall, egress, and resolver policies.

## Identity-based selectors

### SAML Attributes

Specify a value from the SAML Attribute Assertion.

| UI name | API example |
| --- | --- |
| SAML Attributes | identity.saml_attributes == "\"group=finance\"" |

### User Email

Use this selector to create identity-based Gateway rules based on a user's email.

| UI name | API example value |
| --- | --- |
| User Email | identity.email == "user-name@company.com" |

### User Group IDs

Use this selector to create identity-based Gateway rules based on an IdP group ID of which the user is configured as a member in the IdP.

| UI name | API example |
| --- | --- |
| User Group IDs | identity.groups.id == "12jf495bhjd7893ml09o" |

### User Group Email

Use this selector to create identity-based Gateway rules based on an IdP group email address of which the user is configured as a member in the IdP.

| UI name | API example |
| --- | --- |
| User Group Email | identity.groups.email == "contractors@company.com" |

### User Group Names

Use this selector to create identity-based Gateway rules based on an IdP group name of which the user is configured as a member in the IdP.

| UI name | API example |
| --- | --- |
| User Group Names | identity.groups.name == "\"finance\"" |

### User Name

Use this selector to create identity-based Gateway rules based on an IdP username for a particular user in the IdP.

| UI name | API example |
| --- | --- |
| User Name | identity.name == "user-name" |

Gateway groups vs. Access rule groups

In Gateway, a User Group refers to a group in your IdP (for example, an Okta group). Gateway does not currently support applying DNS, HTTP, and Network policies to Access rule groups. This is because Access rule groups may include criteria not available through the IdP, such as device location or IP address.

## IdP groups in Gateway

Cloudflare Gateway can integrate with your organization's identity providers (IdPs). Before building a Gateway policy for IdP users or groups, be sure to add the IdP as an authentication method.

Because IdPs expose user groups in different formats, reference the list below to choose the appropriate identity-based selector.

### Microsoft Entra ID

| Selector | Value |
| --- | --- |
| User Group IDs | 61503835-b6fe-4630-af88-de551dd59a2 |

Value is the Object Id for an Entra group.

If you enabled user and group synchronization with SCIM, the synchronized groups will appear under User Group Names:

| Selector | Value |
| --- | --- |
| User Group Names | SCIM group |

### GitHub

| Selector | Value |
| --- | --- |
| User Group Names | Marketing |

### Google

| Selector | Value |
| --- | --- |
| User Group Names | Marketing |

### Okta (OIDC)

If you added Okta as an OIDC provider, use the User Group Names selector:

| Selector | Value |
| --- | --- |
| User Group Names | Marketing |

The Okta OIDC integration supports user and group synchronization with SCIM.

### Okta (SAML)

If you added Okta as a SAML provider, use the SAML Attributes selector:

| Selector | Attribute name | Attribute value |
| --- | --- | --- |
| SAML Attributes | groups | Marketing |

### Generic SAML IdP

For a generic SAML provider, use the SAML Attribute selector:

| Selector | Attribute name | Attribute value |
| --- | --- | --- |
| SAML Attributes | department | Marketing |

### Generic OIDC IdP

Custom OIDC claims are not supported in Gateway policies.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Global policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/global-policies/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/global-policies/)

Page options # Global policies

Cloudflare Zero Trust applies a set of global policies to all accounts.

Zero Trust logs prepend an identifier to global policy names. For example, matches for the global policy Allow Zero Trust Services will appear in your logs with the name Global Policy - Allow Zero Trust Services.

The following policies are sorted by order of precedence within each policy type.

## DNS resolution policies

Gateway enforces global DNS and resolver policies before any other policies. This ensures the traffic is not blocked by user policies and gets resolved with Cloudflare's public DNS resolver, 1.1.1.1. Each global DNS policy evaluates traffic based on the domain in the query.

| Name | ID | Value | Action |
| --- | --- | --- | --- |
| Allow DNS queries for cloudflareclient.com domain | 00000001-e139-4a1b-90d5-698d8fa371e0 | cloudflareclient.com | allow |
| Resolve cloudflareclient.com through 1.1.1.1 | 00000001-e738-4554-823b-0b2c75af2c66 | cloudflareclient.com | resolve |
| Allow DNS queries for content.browser.run domain | 00000001-9bff-4d83-a9e4-e5ed321fe0b9 | content.browser.run | allow |
| Resolve content.browser.run through 1.1.1.1 | 00000001-0df5-472b-80c0-02888e7167ee | content.browser.run | resolve |
| Allow DNS queries for edge.browser.run and cloudflarebrowser.com domains | 00000001-e2f1-4e99-bab3-91df88879587 | edge.browser.run and cloudflarebrowser.com | allow |
| Resolve edge.browser.run and cloudflarebrowser.com through 1.1.1.1 | 00000001-b103-44c6-a114-7a784cdf3fb7 | edge.browser.run and cloudflarebrowser.com | resolve |
| Allow DNS queries for help.teams.cloudflare.com and help.one.cloudflare.com domains | 00000001-b2fc-46db-b0f1-69ef3553bd7a | help.teams.cloudflare.com and help.one.cloudflare.com | allow |
| Resolve help.teams.cloudflare.com and help.one.cloudflare.com through 1.1.1.1 | 00000001-ce13-486a-b006-ba0435ccb013 | help.teams.cloudflare.com and help.one.cloudflare.com | resolve |
| Allow DNS queries for cloudflare-gateway.com domain | 00000001-e83d-492b-995e-351970cd5e8e | cloudflare-gateway.com | allow |
| Resolve cloudflare-gateway.com through 1.1.1.1 | 00000001-d9bc-4913-a2f5-905dbb3ecf9a | cloudflare-gateway.com | resolve |
| Allow DNS queries for cloudflarestatus.com domain | 00000001-78da-4f8a-b9ee-76563f1ec46b | cloudflarestatus.com | allow |
| Resolve cloudflarestatus.com through 1.1.1.1 | 00000001-4d1d-43a3-9015-c49fc3a6da31 | cloudflarestatus.com | resolve |
| Allow DNS queries for nel.cloudflare.com domain | 00000001-af28-4afa-8987-eadc21187e14 | nel.cloudflare.com | allow |
| Resolve nel.cloudflare.com through 1.1.1.1 | 00000001-0034-45a0-8333-f339451fba46 | nel.cloudflare.com | resolve |
| Allow DNS queries for api.cloudflare.com domain | 00000001-5eea-4932-8dd5-8e1ec9770396 | api.cloudflare.com | allow |
| Resolve api.cloudflare.com through 1.1.1.1 | 00000001-4f0c-4f86-9b96-5d26123a194b | api.cloudflare.com | resolve |
| Allow DNS queries for dash.teams.cloudflare.com domain | 00000001-0f75-48a9-b3e1-925a974d2b65 | dash.teams.cloudflare.com | allow |
| Resolve dash.teams.cloudflare.com through 1.1.1.1 | 00000001-3d84-41a6-bc84-3014685c0d81 | dash.teams.cloudflare.com | resolve |
| Allow DNS queries for one.dash.cloudflare.com domain | 00000001-a9fd-40de-a662-51d3a3ae0ad8 | one.dash.cloudflare.com and one.dash.fed.cloudflare.com | allow |
| Resolve one.dash.cloudflare.com through 1.1.1.1 | 00000001-70f2-4eea-b711-201bca434ed4 | one.dash.cloudflare.com and one.dash.fed.cloudflare.com | resolve |
| Allow DNS queries for dash.cloudflare.com domain | 00000001-0c2a-4b31-8606-3e5a1d87c1bf | dash.cloudflare.com and dash.fed.cloudflare.com | allow |
| Resolve dash.cloudflare.com through 1.1.1.1 | 00000001-c47f-41f3-b234-d66c82b8d422 | dash.cloudflare.com and dash.fed.cloudflare.com | resolve |
| Allow DNS queries for cloudflareportal.com, cloudflareok.com and cloudflarecp.com domains | 00000001-1c6c-4793-b48f-799eee6e0e31 | cloudflareportal.com, cloudflareok.com, and cloudflarecp.com | allow |
| Resolve cloudflareportal.com, cloudflareok.com and cloudflarecp.com through 1.1.1.1 | 00000001-8c35-4d7d-9dbb-cb7350375b7b | cloudflareportal.com, cloudflareok.com, and cloudflarecp.com | resolve |
| Allow DNS queries for cloudflareaccess.com domain | 00000001-d738-4dad-bac4-1a50201d9503 | cloudflareaccess.com | allow |
| Resolve cloudflareaccess.com through 1.1.1.1 | 00000001-4404-4572-80f6-f7b098909460 | cloudflareaccess.com | resolve |
| Allow DNS queries for blocked.teams.cloudflare.com domain | 00000001-76f4-4438-b8ab-a9da53f4a2f1 | blocked.teams.cloudflare.com and blocked.teams.fed.cloudflare.com | allow |
| Resolve blocked.teams.cloudflare.com through 1.1.1.1 | 00000001-af3c-458f-aeb2-b3bb5d3fe1d5 | blocked.teams.cloudflare.com and blocked.teams.fed.cloudflare.com | resolve |
| Allow DNS queries for developers.cloudflare.com domain | 00000001-4263-4808-8457-4d4329c91f66 | developers.cloudflare.com | allow |
| Resolve developers.cloudflare.com through 1.1.1.1 | 00000001-9f91-4462-9270-78beca5b4dbc | developers.cloudflare.com | resolve |
| Allow DNS queries for speed.cloudflare.com domain | 00000001-4fc0-4286-b783-6c442adda171 | speed.cloudflare.com | allow |
| Resolve speed.cloudflare.com through 1.1.1.1 | 00000001-ec51-4471-9e78-bd47d46a3002 | speed.cloudflare.com | resolve |
| Allow DNS requests to browser-rendered Access Apps | 00000001-1232-4a9f-a165-1e8ed59483c4 | *.zero-trust-apps.cfdata.org, *.zero-trust-apps-staging.cfdata.org, *.zero-trust-apps.fed.cfdata.org, or *.zero-trust-apps-staging.fed.cfdata.org | allow |
| Resolve browser-rendered Access Apps domains through 1.1.1.1 | 00000001-9461-43c7-ba63-d0fdf9376bd4 | *.zero-trust-apps.cfdata.org, *.zero-trust-apps-staging.cfdata.org, *.zero-trust-apps.fed.cfdata.org, or *.zero-trust-apps-staging.fed.cfdata.org | resolve |

## Network proxy policies

| Name | ID | Criteria | Value | Action | Description |
| --- | --- | --- | --- | --- | --- |
| Allow CF Network Error Logging L4 | 00000001-e4af-4b82-8f8c-c79c1d5d212e | Hostname | *.nel.cloudflare.com | allow | Allows SNI domains for WARP registration. |
| Allow CF Client | 00000001-8c3d-4e27-a01b-af8418000077 | Hostname | *.cloudflareclient.com and *.fed.cloudflareclient.com | allow | Allows Zero Trust client. |
| Allow Gateway Proxy PAC | 00000001-776e-438d-9856-987d7053762b | Hostname | *.cloudflare-gateway.com and *.fed.cloudflare-gateway.com | allow | Allows Gateway proxy with PAC files. |
| Allow Zero Trust Services | 00000001-e1e8-421b-a0fe-895397489f28 | Hostname | dash.teams.cloudflare.com, help.teams.cloudflare.com, blocked.teams.cloudflare.com, blocked.teams.fed.cloudflare.com, api.cloudflare.com, api.fed.cloudflare.com, cloudflarestatus.com, www.cloudflarestatus.com, one.dash.cloudflare.com, one.dash.fed.cloudflare.com, help.one.cloudflare.com, dash.cloudflare.com, dash.fed.cloudflare.com, and developers.cloudflare.com | allow | Allows Cloudflare Zero Trust services. |
| Allow Access Apps L4 | 00000001-daa2-41e2-8a88-698af4066951 | Hostname | *.cloudflareaccess.com and *.fed.cloudflareaccess.com | allow | Allows Cloudflare Access applications. |
| Allow HTTP requests to browser-rendered Access Apps | 00000001-1f93-4476-8f92-9aa4407d1c5f | Hostname | *.zero-trust-apps.cfdata.org, *.zero-trust-apps-staging.cfdata.org, *.zero-trust-apps.fed.cfdata.org, or *.zero-trust-apps-staging.fed.cfdata.org | allow | Allows Cloudflare Access terminal applications rendered in a browser. |

## HTTP inspection policies

| Name | ID | Criteria | Value | Action | Description |
| --- | --- | --- | --- | --- | --- |
| Prevent Account Change Block | 00000001-d1f2-461a-8253-501c8d882a15 | Hostname | *.cloudflareclient.com and *.fed.cloudflareclient.com; not notifications.cloudflareclient.com or notifications.fed.cloudflareclient.com | bypass | Ensures users cannot accidentally block themselves from making account changes. |
| Bypass RBI Assets | 00000001-df61-4068-aa6c-0f684c3cd4e6 | Hostname | *.content.browser.run | bypass | Required for Browser Isolation. |
| Inspect RBI Urls | 00000001-3faa-4f59-98d4-0f6d6af4b6d0 | Hostname | *.edge.browser.run and *.cloudflarebrowser.com | bypass | Required for Browser Isolation. |
| Allow Gateway Help Page | 00000001-8e9a-4429-b3c2-d267d0ce6114 | Hostname | help.teams.cloudflare.com and help.one.cloudflare.com | allow | Used by the WARP client to check if Gateway is on by inspecting the certificate and checking if it is properly installed on the client device. |
| Bypass Gateway DNS | 00000001-d9c0-46b0-8704-2ea5b9d7bdfc | Hostname | *.cloudflare-gateway.com and *.fed.cloudflare-gateway.com | bypass | Ensures requests to the cloudflare-gateway.com DNS endpoint will not be inspected. |
| Bypass CF Status | 00000001-5399-4b71-a9fc-d4d90ccf0758 | Hostname | *.cloudflarestatus.com | bypass | Bypasses cloudflarestatus.com so users can reach the status page in case of a Gateway outage. |
| Bypass CF Network Error Logging | 00000001-dfe0-4737-8d1e-8191e8f637df | Hostname | *.nel.cloudflare.com | bypass | Bypasses *.nel.cloudflarestatus.com for Cloudflare's network error logging feature. |
| Bypass CF API | 00000001-a424-43fb-b1f1-d3eb35ed7ddd | Hostname | api.cloudflare.com and api.fed.cloudflare.com | bypass | Bypasses Cloudflare's API endpoint. |
| Prevent ZT Dashboard Lockout | 00000001-d38e-42db-96fe-60613b6b308f | Hostname | dash.teams.cloudflare.com, one.dash.cloudflare.com, and one.dash.fed.cloudflare.com | bypass | Prevents users from being locked out of the Zero Trust dashboard. |
| Bypass CF Dashboard | 00000001-d343-4ded-908e-b3fe43c5e61e | Hostname | *.dash.cloudflare.com and *.dash.fed.cloudflare.com | bypass | Bypasses the Cloudflare dashboard and subdomains. |
| Bypass Zero Trust Captive Portal Sites | 00000001-8b62-4367-919e-5c160a06ddf7 | Hostname | cloudflareportal.com, cloudflareok.com, and cloudflarecp.com | bypass | Bypasses the Zero Trust captive portal detection sites. |
| Bypass OCSP | 00000001-34ce-47c7-ad0f-199f46eba194 | Application | Online Certificate Status Protocol | bypass | Enables OCSP stapling. |
| Allow Access Apps L7 | 00000001-8d6b-4951-8a18-3bbc9010976c | Hostname | *.cloudflareaccess.com and *.fed.cloudflareaccess.com | allow | Allows Cloudflare Access applications. |
| Prevent Block Page Loop | 00000001-48b1-4ade-93c1-f0f3759dc19c | Hostname | blocked.teams.cloudflare.com and blocked.teams.fed.cloudflare.com | bypass | Prevents an infinite loop on the Gateway block page. |
| Always Blocked Categories | 00000001-bed5-462e-b0f1-2e2c3555e9f7 | Content Category | Child Abuse category | block | Blocks child abuse materials (CSAM). |
| Don't Isolate RBI Help Pages | 00000001-1a18-431f-9c9d-bce431f1002a | Hostname | developers.cloudflare.com and help.cloudflarebrowser.com | noisolate | Prevents browser isolation of Cloudflare developer docs and help pages to help users troubleshoot configuration issues. |
| Don't AV Scan CF Speed | 00000001-c194-408f-87dd-9a366ce76e12 | Hostname | speed.cloudflare.com | noscan | Allows files transferred by the Cloudflare speed test. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Applications and app types

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/application-app-types/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/application-app-types/)

Page options # Applications and app types

Gateway allows you to create DNS, Network, and HTTP policies based on applications and app types. You can select individual applications or groups of app types to filter specific traffic on your network.

## Applications

When you choose the Application selector in a Gateway policy builder, the Value field will include all supported applications and their respective app types. Alternatively, you can use the Gateway API to fetch a list of applications, app types, and ID numbers.

To manage a consolidated list of applications across Zero Trust, you can use the Application Library.

## App types

Gateway sorts applications into the following app type groups:

| Value | Definition |
| --- | --- |
| Artificial Intelligence | AI assistance applications |
| Audio Streaming | Music streaming, podcasts, and other audio applications |
| Collaboration & Online Meetings | Business communication and collaboration applications |
| Dating | Online dating applications |
| Development | Software development and development operations applications |
| Email | Email applications |
| Encrypted DNS | DNS encryption applications |
| File Sharing | File sharing applications |
| Finance & Accounting | Financial and accounting applications |
| Gaming | Games and gaming applications |
| Human Resources | Employee management applications and workforce tools |
| Instant Messaging | Instant messaging applications |
| IT Management | IT deployment management applications |
| Legal | Legal tools and applications |
| News | News applications |
| Productivity | Business and productivity applications |
| Public Cloud | Public cloud infrastructure management applications |
| Sales & Marketing | Sales and marketing applications |
| Search Engines | Web search engines and applications |
| Security | Information security applications, including shadow IT |
| Shopping | Online shopping applications |
| Social Networking | Social networking applications |
| Sports | Sports streaming and news applications |
| Video Streaming | Video streaming applications |
| Do Not Inspect | Applications incompatible with the TLS certificate required by the Gateway proxy |

## Application hostnames

Applications categorized by Cloudflare may independently rely on a number of different internal and external resources to provide functionality. To enable effective behavior of Allow and Block Gateway policies, Zero Trust separates application definitions into hostnames and support hostnames.

### Hostnames

Hostnames are domains that are core to the application and not used by other applications. These are the domains that are specifically blocked when you block an application. The App Library surfaces these hostnames in the Hostnames table for an application.

### Support hostnames

Support hostnames are shared resources which applications may call in order to function. Applications can use support hostnames for content delivery, application behavior, or third-party system integrations. Blocking these hostnames may result in unexpected behavior for other policies. In addition, not taking a specific action on one of these hostnames may affect the application's behavior, even if the application hostnames are allowed. For example, assume that file-sharing-service.com relies on content-delivery.com. If you allow access to file-sharing-service.com and its associated subdomains but not content-delivery.com, some of the functionality of file-sharing-service.com may break when Gateway matches the traffic.

To ensure effective application behavior, Gateway only uses support hostnames in Allow policies. Cloudflare explicitly allows support hostname connections in these policies but will not block the connections in Block policies. For example, many Google applications use accounts.google.com for authentication. In a Zero Trust environment with highly restrictive policies, accounts.google.com must be allowed for many applications to function correctly. If you use an application with accounts.google.com in its support hostnames in an Allow policy, Gateway will allow both accounts.google.com and the application's domains.

## Application controls

With Application Granular Controls, you can choose specific actions and operations to match application traffic. Supported applications and operations include:

ChatGPT (app ID 1199)

| Operation name | Operation ID | Application Control name | Application Control ID | Contains payload | Operation Group | Operation Group ID |
| --- | --- | --- | --- | --- | --- | --- |
| SendPrompt | 8004 | Prompt | 1652 | ‚úÖ | Chat | 1650 |
| UploadFile | 8008 | Upload | 1653 | ‚ùå | Chat | 1650 |
| UploadFilePayload | 8013 | Upload | 1653 | ‚úÖ | Chat | 1650 |
| ShareResponse | 8006 | Share | 1654 | ‚ùå | Chat | 1650 |
| ShareCanvas | 8007 | Share | 1654 | ‚ùå | Chat | 1650 |
| TranscribeVoice | 8011 | Voice | 1655 | ‚ùå | Chat | 1650 |
| EnableVoiceMode | 8003 | Voice | 1655 | ‚ùå | Chat | 1650 |
| AllowTraining | 8009 |  |  | ‚ùå | Settings | 1651 |
| AllowVoiceTraining | 8010 |  |  | ‚ùå | Settings | 1651 |
| AllowVideoTraining | 8016 |  |  | ‚ùå | Settings | 1651 |
| ExportData | 8020 |  |  | ‚ùå | Settings | 1651 |

Google Gemini (app ID 1340)

| Operation name | Operation ID | Application Control name | Application Control ID | Contains payload | Operation Group | Operation Group ID |
| --- | --- | --- | --- | --- | --- | --- |
| SendPrompt | 8021 | Prompt | 1657 | ‚úÖ | Chat | 1656 |
| UploadFile | 8022 | Upload | 1658 | ‚ùå | Chat | 1656 |
| UploadFilePayload | 8023 | Upload | 1658 | ‚úÖ | Chat | 1656 |
| TranscribeVoice | 8025 | Voice | 1659 | ‚ùå | Chat | 1656 |

Perplexity (app ID 1937)

| Operation name | Operation ID | Application Control name | Application Control ID | Contains payload | Operation Group | Operation Group ID |
| --- | --- | --- | --- | --- | --- | --- |
| SendPrompt | 11947 | Prompt | 2598 | ‚úÖ | Chat | 2596 |
| ClarifyingPrompt | 11951 | Prompt | 2598 | ‚úÖ | Chat | 2596 |
| CreateUploadUrl | 11948 | Upload | 2599 | ‚ùå | Chat | 2596 |
| UploadFile | 11955 | Upload | 2599 | ‚úÖ | Chat | 2596 |
| UploadOrganizationFile | 11950 | Upload | 2599 | ‚ùå | Settings | 2597 |
| ShareChat | 11952 | Share | 2600 | ‚ùå | Chat | 2596 |
| VoiceTranscription | 11953 | Voice | 2601 | ‚ùå | Chat | 2596 |
| ExportChat | 11949 |  |  | ‚ùå | Chat | 2596 |
| DeleteThread | 11954 |  |  | ‚ùå | Chat | 2596 |
| DeleteOrganizationFile | 11956 |  |  | ‚ùå | Settings | 2597 |

Claude (app ID 2430)

| Operation name | Operation ID | Application Control name | Application Control ID | Contains payload | Operation Group | Operation Group ID |
| --- | --- | --- | --- | --- | --- | --- |
| SendPrompt | 10048 | Prompt | 2127 | ‚úÖ | Chat | 2126 |
| PromptCompletion | 10050 | Prompt | 2127 | ‚úÖ | Chat | 2126 |
| RetryPromptCompletion | 10040 | Prompt | 2127 | ‚úÖ | Chat | 2126 |
| UploadFile | 10039 | Upload | 2128 | ‚úÖ | Chat | 2126 |
| ConvertDocument | 10041 | Upload | 2128 | ‚úÖ | Chat | 2126 |
| ShareConversation | 10043 | Share | 2129 | ‚ùå | Chat | 2126 |
| GetShares | 10052 | Share | 2129 | ‚ùå | Chat | 2126 |
| CreateConversation | 10038 |  |  | ‚ùå | Chat | 2126 |
| GetConversation | 10046 |  |  | ‚ùå | Chat | 2126 |
| UpdateConversation | 10047 |  |  | ‚ùå | Chat | 2126 |
| DeleteConversation | 10045 |  |  | ‚ùå | Chat | 2126 |
| UpdateAccount | 10036 |  |  | ‚ùå | Settings | 2125 |
| InitiateDataExport | 10037 |  |  | ‚ùå | Settings | 2125 |
| GiveFeedback | 10042 |  |  | ‚ùå | Chat | 2126 |
| SetConversationTitle | 10044 |  |  | ‚ùå | Chat | 2126 |
| GetOrganisation | 10049 |  |  | ‚ùå | Settings | 2125 |
| GetFilePreview | 10051 |  |  | ‚ùå | Chat | 2126 |

## Usage

### Overlapping hostnames

Overlapping hostnames are most common for vendors with many applications, such as Google or Meta. When you use the Application selector in Gateway policies, actions taken by Gateway will be limited to the specific application defined. Gateway will also log other applications that use the same hostnames, but it will not take action unless the application was matched by the policy. For example, both the Facebook and Facebook Messenger apps use the chat-e2ee.facebook.com hostname. When evaluating traffic to the Facebook Messenger app, Gateway will only take action on Facebook Messenger traffic but may log both the Facebook and Facebook Messenger apps.

To ensure Gateway evaluates traffic with your desired precedence, order your most specific policies with the highest priority according to order of precedence.

### Do Not Inspect applications

Gateway automatically groups applications incompatible with TLS decryption into the Do Not Inspect app type. As Cloudflare identifies incompatible applications, Gateway will periodically update this app type to add new applications. To ensure Gateway does not intercept any current or future incompatible traffic, you can create a Do Not Inspect HTTP policy with the entire Do Not Inspect app type selected.

When managing applications with the Application Library, Do Not Inspect applications will appear under the corresponding application. For example, the App Library will group Google Drive (Do Not Inspect) under Google Drive.

Install Cloudflare certificate manually to allow TLS decryption

Instead of creating a Do Not Inspect policy for an application, you may be able to configure the application to trust a Cloudflare certificate. Doing so will allow the application to function without losing visibility into your traffic.

#### TLS decryption limitations

Applications can be incompatible with TLS decryption for various reasons:

- Certificate pinning: Certificate pinning is a security mechanism used to prevent on-path attacks on the Internet by hardcoding information about the certificate that the application expects to receive. If the wrong certificate is received, even if it is trusted by the system, the application will refuse to connect.
- Non-web traffic: Some applications send non-web traffic, such as Session Initiation Protocol (SIP) and Extensible Messaging and Presence Protocol (XMPP), over TLS. Gateway cannot inspect these protocols.

#### Microsoft 365 integration

To optimize performance for Microsoft 365 applications and services, you can bypass TLS decryption by turning on the Microsoft 365 traffic integration. This will create a Do Not Inspect policy for all Microsoft 365 domains and IP addresses ‚Üó specified by Microsoft. This policy also uses Cloudflare intelligence to identify other Microsoft 365 traffic not explicitly defined.

To turn on the Microsoft 365 integration:

1. In Zero Trust ‚Üó, go to Settings > Network > Integrated experiences.
2. In Bypass decryption of Microsoft 365 traffic, select Create policy.
3. To verify the policy was created, select View policy. Alternatively, go to Gateway > Firewall policies > HTTP. A policy named Microsoft 365 Auto Generated will be enabled in your list.

All future Microsoft 365 traffic will bypass Gateway logging and filtering. To disable this behavior, turn off or delete the policy.

### Terraform

Terraform users can retrieve the app types list with the cloudflare_zero_trust_gateway_app_types_list data source. This allows you to create Gateway policies with the application's name rather than its numeric ID. For example:

```
data "cloudflare_zero_trust_gateway_app_types_list" "gateway_apptypes" {  account_id = var.cloudflare_account_id}
locals {  apptypes_map = merge([    for c in data.cloudflare_zero_trust_gateway_app_types_list.gateway_apptypes.result :    { (c.name) = c.id }  ]...)}
resource "cloudflare_zero_trust_gateway_policy" "zt_block_dns_apps" {  account_id = var.cloudflare_account_id  name       = "DNS Blocked apps"  action     = "block"  traffic    = "any(app.ids[*] in {${join(" ", [    local.apptypes_map["Discord"],    local.apptypes_map["GoToMeeting"],    local.apptypes_map["Greenhouse"],    local.apptypes_map["Zelle"],    local.apptypes_map["Microsoft Visual Studio"]  ])}})"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Domain categories

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/domain-categories/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/domain-categories/)

Page options # Domain categories

Cloudflare Gateway allows you to block known and potential security risks on the public Internet, as well as specific categories of content. Domains are categorized by Cloudflare Radar.

Cloudflare categorizes domains into content categories and security categories, which cover security risks and security threats:

- Content categories: An upstream vendor supplies content categories for domains. These categories help us organize domains into broad topic areas. However, the specific criteria and methods used by our vendor may not be disclosed.
- Security risks: Cloudflare determines security risks for domains using internal models. These models analyze various factors, including the age of a domain and its reputation. This allows us to identify potentially risky domains.
- Security threats: To identify malicious domains that pose security threats, Cloudflare employs a mix of internal data sources, machine learning models, commercial feeds, and open-source threat intelligence.

You can block security and content categories by creating DNS or HTTP policies. Once you have configured your policies, you will be able to inspect network activity and the associated categories in your Gateway logs.

To request changes to a domain's categorization, refer to Change categorization. For more information on investigating potentially risky domains, refer to Investigate threats.

Subdomain category

Subdomains that have not been assigned a category will inherit the category of their parent domain. When Gateway categorizes a subdomain, the subdomain will carry only its own category. Categorized subdomains will not inherit their parent domain's categories.

## Security categories

| Category | Definition |
| --- | --- |
| Anonymizer | Sites that allow users to surf the Internet anonymously. |
| Brand Embedding | Sites that imitate a verified brand, for example facobook.com. |
| Command and Control & Botnet | Sites that are queried by compromised devices to exfiltrate information or potentially infect other devices in a network. |
| Compromised Domain | Sites where a legitimate domain has been compromised or taken over and had malicious content planted or injected. |
| Cryptomining | Sites that mine cryptocurrency by taking over the user's computing resources. |
| DGA Domains | Domains detected as generated by algorithms seen in malware. |
| DNS Tunneling | Domains with detected DNS tunneling activity. |
| Malware | Sites hosting malicious content and other compromised websites. |
| Phishing | Domains that are known for stealing personal information. |
| Potentially Unwanted Software | Domains that distribute software that may come bundled with other less legitimate software or functionality, like toolbars, adware, and grayware. |
| Private IP Address | Domains that resolve to private IP Addresses. |
| Scam | Fraudulent websites and schemes designed to trick victims into giving away money or personal information. |
| Spam | Sites that are known for targeting users with unwanted sweepstakes, surveys, and advertisements. |
| Spyware | Sites that are known to distribute or contain code that displays unwanted advertisements or that gathers user information without the user's knowledge. |

## Content categories

| Category | Definition |
| --- | --- |
| Ads | Sites that are hosting content related to advertising. |
| Adult Themes | Sites that are hosting content related to pornography, nudity, sexuality, and other adult themes. |
| Business & Economy | Sites that are related to business, economy, finance, education, science and technology. |
| Child Abuse | Sites hosting child abuse content. |
| CIPA | Sites related to aiding schools and organizations in abiding by CIPA requirements. |
| Education | Sites hosting educational content that are not included in other categories like Science, Technology or Educational institutions. |
| Entertainment | Sites that are hosting entertaining content that are not included in other categories like Comic books, Audio streaming, Video streaming etc. |
| Gambling | Sites that are providing online gambling or are related to gambling. |
| Government & Politics | Sites related to government and politics. |
| Health | Sites containing information about health and fitness. |
| Information Technology | Sites related to information technology. |
| Internet Communication | Sites hosting applications that are used for communication like chat, mail etc. |
| Job Search & Careers | Sites that facilitate searching for jobs and careers. |
| Miscellaneous | Sites that are not included in the listed security and content categories. |
| Questionable Content | Sites hosting content that are related to hacking, piracy, profanity and other questionable activities. |
| Real Estate | Sites related to real estate. |
| Religion | Sites hosting content about religion, alternative religion, religious teachings, religious groups, and spirituality. |
| Security Risks | Sites that are new or misconfigured. We recommend that you allow or isolate this content category to avoid accidentally blocking trusted domains. |
| Shopping & Auctions | Sites that are hosting content related to ecommerce, coupons, shopping, auctions and marketplaces. |
| Social & Family | Sites related to society and lifestyle. |
| Society & Lifestyle | Sites hosting information about lifestyle that are not included in other categories like fashion, food & drink etc. |
| Sports | Sites related to sports & recreation. |
| Technology | Sites hosting information about technology that are not included in the science category. |
| Travel | Sites that contain information about listings, reservations, services for travel. |
| Vehicles | Sites related vehicles, automobiles, including news, reviews, and other hobbyist information. |
| Violence | Sites hosting and/or promoting violent content. |
| Weather | Sites related to weather. |

### Miscellaneous subcategories

| Category | Definition |
| --- | --- |
| Login Screens | Sites hosting login screens that might also be included in other categories. |
| Miscellaneous | Sites that do not belong to other content categories. |
| No Content | Sites that have no content. |
| Redirect | Domains that redirect to other sites. |
| Unreachable | Domains that resolve to unreachable IP addresses. |

### Security risk subcategories

| Category | Definition |
| --- | --- |
| New Domains | Domains registered within the past 30 days. |
| Newly Seen Domains | Domains that were resolved for the first time within the past 30 days. |
| Parked & For Sale Domains | Domains that are not connected to a hosting service. |

### Category and subcategory IDs

| Category ID | Category Name | Subcategory ID | Subcategory Name |
| --- | --- | --- | --- |
| 1 | Ads | 66 | Advertisements |
| 2 | Adult Themes | 67 | Adult Themes |
| 2 | Adult Themes | 125 | Nudity |
| 2 | Adult Themes | 133 | Pornography |
| 3 | Business & Economy | 186 | Brokerage & Investing |
| 3 | Business & Economy | 75 | Business |
| 3 | Business & Economy | 89 | Economy & Finance |
| 3 | Business & Economy | 183 | Cryptocurrency |
| 3 | Business & Economy | 185 | Personal Finance |
| 6 | Education | 90 | Education |
| 6 | Education | 91 | Educational Institutions |
| 6 | Education | 189 | Reference |
| 6 | Education | 144 | Science |
| 6 | Education | 150 | Space & Astronomy |
| 7 | Entertainment | 70 | Arts |
| 7 | Entertainment | 74 | Audio Streaming |
| 7 | Entertainment | 76 | Cartoons & Anime |
| 7 | Entertainment | 79 | Comic Books |
| 7 | Entertainment | 92 | Entertainment |
| 7 | Entertainment | 96 | Fine Art |
| 7 | Entertainment | 100 | Gaming |
| 7 | Entertainment | 106 | Home Video/DVD |
| 7 | Entertainment | 107 | Humor |
| 7 | Entertainment | 116 | Magazines |
| 7 | Entertainment | 120 | Movies |
| 7 | Entertainment | 121 | Music |
| 7 | Entertainment | 122 | News & Media |
| 7 | Entertainment | 127 | Paranormal |
| 7 | Entertainment | 139 | Radio |
| 7 | Entertainment | 156 | Television |
| 7 | Entertainment | 164 | Video Streaming |
| 8 | Gambling | 99 | Gambling |
| 9 | Government & Politics | 190 | Charity and Non-profit |
| 9 | Government & Politics | 101 | Government/Legal |
| 9 | Government & Politics | 137 | Politics, Advocacy, and Government-Related |
| 10 | Health | 103 | Health & Fitness |
| 10 | Health | 146 | Sex Education |
| 12 | Internet Communication | 77 | Chat |
| 12 | Internet Communication | 98 | Forums |
| 12 | Internet Communication | 108 | Information Security |
| 12 | Internet Communication | 110 | Instant Messengers |
| 12 | Internet Communication | 111 | Internet Phone & VOIP |
| 12 | Internet Communication | 118 | Messaging |
| 12 | Internet Communication | 126 | P2P |
| 12 | Internet Communication | 129 | Personal Blogs |
| 12 | Internet Communication | 168 | Webmail |
| 12 | Internet Communication | 172 | Photo Sharing |
| 13 | Job Search & Careers | 113 | Job Search & Careers |
| 15 | Miscellaneous | 115 | Login Screens |
| 15 | Miscellaneous | 119 | Miscellaneous |
| 15 | Miscellaneous | 124 | No Content |
| 15 | Miscellaneous | 141 | URL Alias/Redirect |
| 15 | Miscellaneous | 161 | Unreachable |
| 17 | Questionable Content | 85 | Deceptive Ads |
| 17 | Questionable Content | 87 | Drugs |
| 17 | Questionable Content | 102 | Hacking |
| 17 | Questionable Content | 135 | Profanity |
| 17 | Questionable Content | 138 | Questionable Activities |
| 17 | Questionable Content | 157 | Militancy, Hate & Extremism |
| 17 | Questionable Content | 162 | Unreliable Information |
| 18 | Real Estate | 140 | Real Estate |
| 19 | Religion | 142 | Religion & Spirituality |
| 20 | Safe for Kids | 143 | Safe for Kids |
| 21 | Security threats | 68 | Anonymizer |
| 21 | Security threats | 80 | Command and Control & Botnet |
| 21 | Security threats | 187 | Compromised Domain |
| 21 | Security threats | 83 | Cryptomining |
| 21 | Security threats | 117 | Malware |
| 21 | Security threats | 131 | Phishing |
| 21 | Security threats | 188 | Potentially unwanted software |
| 21 | Security threats | 134 | Private IP Address |
| 21 | Security threats | 151 | Spam |
| 21 | Security threats | 153 | Spyware |
| 21 | Security threats | 175 | DNS Tunneling |
| 21 | Security threats | 176 | Domain Generation Algorithm |
| 21 | Security threats | 178 | Brand Embedding |
| 21 | Security threats | 191 | Scam |
| 22 | Shopping & Auctions | 73 | Auctions & Marketplaces |
| 22 | Shopping & Auctions | 82 | Coupons |
| 22 | Shopping & Auctions | 88 | Ecommerce |
| 22 | Shopping & Auctions | 148 | Shopping |
| 24 | Society & Lifestyle | 71 | Arts & Crafts |
| 24 | Society & Lifestyle | 72 | Astrology |
| 24 | Society & Lifestyle | 78 | Clothing |
| 24 | Society & Lifestyle | 84 | Dating & Relationships |
| 24 | Society & Lifestyle | 86 | Digital Postcards |
| 24 | Society & Lifestyle | 93 | Parenting |
| 24 | Society & Lifestyle | 94 | Fashion |
| 24 | Society & Lifestyle | 97 | Food & Drink |
| 24 | Society & Lifestyle | 104 | Hobbies & Interests |
| 24 | Society & Lifestyle | 105 | Home & Garden |
| 24 | Society & Lifestyle | 114 | Lifestyle |
| 24 | Society & Lifestyle | 130 | Pets |
| 24 | Society & Lifestyle | 132 | Photography |
| 24 | Society & Lifestyle | 136 | Professional Networking |
| 24 | Society & Lifestyle | 147 | Sexuality |
| 24 | Society & Lifestyle | 149 | Social Networks |
| 24 | Society & Lifestyle | 154 | Swimsuits |
| 24 | Society & Lifestyle | 158 | Tobacco |
| 24 | Society & Lifestyle | 173 | Body Art |
| 24 | Society & Lifestyle | 174 | Lingerie & Bikini |
| 24 | Society & Lifestyle | 181 | Alcohol |
| 25 | Sports | 152 | Sports |
| 26 | Technology | 69 | APIs |
| 26 | Technology | 81 | Content Servers |
| 26 | Technology | 95 | File Sharing |
| 26 | Technology | 109 | Information Technology |
| 26 | Technology | 123 | News, Portal & Search |
| 26 | Technology | 145 | Search Engines |
| 26 | Technology | 155 | Technology |
| 26 | Technology | 159 | Translator |
| 26 | Technology | 184 | Artificial Intelligence |
| 27 | Travel | 160 | Travel |
| 28 | Vehicles | 163 | Vehicles |
| 29 | Violence | 165 | Violence |
| 29 | Violence | 166 | Weapons |
| 30 | Weather | 167 | Weather |
| 31 | Always blocked | 170 | Child Abuse |
| 32 | Security Risks | 128 | Parked & For Sale Domains |
| 32 | Security Risks | 169 | New Domains |
| 32 | Security Risks | 177 | Newly Seen Domains |
| 34 | CIPA | 182 | CIPA Filter |

## Filtering options

### Filter traffic by resolved IP category

When creating a DNS policy for security or content categories, you can optionally turn on Filter traffic by resolved IP category in the policy settings. When turned on, Gateway will block queries based on their resolved IP address in addition to the domain name. This setting may increase the number of false positives because domains in the blocked category can share IP addresses with legitimate domains.

### Ignore CNAME domain categories

The categories for a site's CNAME records may differ from its A record. For example, blog.example.com may be categorized under Personal Blogs, while example.com is categorized under Technology. To limit matches for a DNS policy to only the root domain's categories, turn on Ignore CNAME domain categories.

Regardless of this setting, CNAME domain categories will still appear in your Gateway Logpush logs.

## Categorization process

Cloudflare's domain categorization engine begins with multiple data sources, including:

1. Cloudflare's proprietary data using our global network.
2. Third-party intelligence feeds. Cloudflare uses data from over 30 open-source intelligence feeds and premium commercial feeds, such as Avira and Zvelo.

Then, the initial categorization is refined via:

1. Machine learning models. Our algorithms, including DGA Domains, DNS tunneling, and phishing detection models analyze patterns and behaviors to detect new and evolving threats.
2. Community feedback. Through a review process, Cloudflare assesses feedback by both our internal models and threat analysts. This ensures that our categorizations reflect the most current and accurate threat intelligence.

## Terraform

Terraform users can retrieve the category list with the cloudflare_zero_trust_gateway_categories_list data source. This allows you to create Gateway policies with the category's name rather than its numeric ID. For example:

```
data "cloudflare_zero_trust_gateway_categories_list" "categories" {  account_id = var.cloudflare_account_id}
locals {  main_categories_map = {    for idx, c in data.cloudflare_zero_trust_gateway_categories_list.categories[0].result :    c.name => c.id  }
  subcategories_map = merge(flatten([    for idx, c in data.cloudflare_zero_trust_gateway_categories_list.categories[0].result : {      for k, v in coalesce(c.subcategories, []) :      v.name => v.id    }  ])...)}
resource "cloudflare_zero_trust_gateway_policy" "zt_block_dns_tech_categories" {  account_id = var.cloudflare_account_id  name       = "DNS Blocked"  action     = "block"  traffic    = "any(dns.content_category[*] in {${join(" ", [    local.main_categories_map["Technology"],    local.subcategories_map["APIs"],    local.subcategories_map["Artificial Intelligence"],    local.subcategories_map["Content Servers"],    local.subcategories_map["Translator"]  ])}})"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Order of enforcement

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/order-of-enforcement/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/order-of-enforcement/)

Page options # Order of enforcement

With Cloudflare Gateway, you can enable and configure any combination of DNS, network, and HTTP policies.

```
flowchart TB
    %% Accessibility
    accTitle: Gateway order of enforcement
    accDescr: Flowchart describing the order of enforcement for Gateway policies.

 subgraph Resolution["Resolution"]
        dns2["1.1.1.1"]
        dns4["Custom resolver"]
        dns3["Resolver policies <br>(Enterprise users only)"]
        internal["Internal DNS"]
  end
 subgraph DNS["DNS"]
        dns1["DNS policies"]
        Resolution
  end
 subgraph HTTP["HTTP policies"]
        http1{{"Do Not Inspect policies"}}
        http2["Isolate policies  <br>(with Browser Isolation add-on)"]
        http3["Allow, Block, Do Not Scan, Quarantine, and Redirect policies, DLP, and anti-virus scanning"]
        https["HTTP or HTTPS?"]
  end
 subgraph Proxy["Proxy"]
        HTTP
        network1["Network policies"]
        nonhttp["Non-HTTP(S) traffic"]
  end
 subgraph Egress["Egress"]
        egress1["Egress policies <br>(Enterprise users only)"]
  end
    start(["Traffic"]) --> dns0[/"DNS query"/] & http0["Network connections"]
    dns0 ----> dns1
    dns1 -- Resolved by --> dns2
    dns1 --> dns3
    dns3 -- Resolved by --> dns4
    dns2 -----> internet(["Internet"])
    dns4 -----> internet
    dns4 ---> cloudflare["Private network services <br>(Cloudflare Tunnel, Magic WAN, WARP Connector)"]
    http1 -- Do Not Inspect --> internet
    http1 -- Inspect --> http2
    http2 --> http3
    http0 --> magic["Magic Firewall (Enterprise users only)"]
    magic --> egress1
    egress1 --> tcp["Check for origin availability (TCP SYN)"]
    tcp --> network1
    http3 --> internet
    https -- HTTPS --> http1
    https -- HTTP --> http2
    network1 --> https & nonhttp
    dns3 -- Resolved by --> internal & dns2
    nonhttp -----> internet

    https@{ shape: hex}
    http0@{ shape: lean-r}
```

Order of enforcement change on 2025-07-14

On 2025-07-14, Gateway began evaluating network-level policies before application-level policies and verify the network path to an origin server before accepting a connection. This only affects your policies if you are applying HTTP policies in your account. For example:

Comparison of old and new order of enforcement

|  | Old order of enforcement | New order of enforcement |
| --- | --- | --- |
| Network Block policy and HTTP Block policy | Gateway blocks traffic and displays the block page and/or follows the client notification settings on the HTTP policy. | Gateway blocks traffic. Gateway does not display the block page but will follow the client notification settings on the Network policy. |
| Network Allow policy and HTTP Block policy | Gateway blocks traffic and displays the block page and follows the client notification settings on the HTTP policy. | No change. |
| Network Block policy and HTTP Allow policy | Gateway blocks traffic and follows the client notification settings on the Network policy. | No change. |

## Connection establishment

When a user connects to a server with Gateway, Gateway first establishes a TCP connection with the destination server on the port the user requested. Because TCP traffic is proxied by Cloudflare, the connection Gateway establishes with the origin is independent from the connection users establish with Gateway. This means Gateway assigns a new source IP and port to the user's connection and no details from the user's TCP handshake are included in the TCP handshake with the origin server.

If the TCP connection to the destination server is successful, Gateway will apply policies. If Gateway policies allow the connection, Gateway will connect the user to the destination server. If Gateway policies block the connection, Gateway will end the connection and will not send any data between the user and the destination server. If the TCP connection to the destination server is unsuccessful, Gateway will not run any policies and retry TCP connections from the user to the server.

```
flowchart TD
    %% Accessibility
    accTitle: How Gateway proxy works
    accDescr: Flowchart describing how the Gateway proxy uses the Happy Eyeballs algorithm to establish TCP connections and proxy user traffic.

    %% Flowchart
    A[User's device sends TCP SYN to Gateway] --> B[Gateway sends TCP SYN to origin server]
    B --> C{{Origin server responds with TCP SYN-ACK?}}
    C -->|Yes| E[TCP handshakes completed]
    C -->|No| D[Connection fails]
    E --> F{{Connection allowed?}}
    F -->|Allow policy| G[Gateway proxies traffic bidirectionally]
    F -->|Block policy| H[Connection blocked by firewall policies]

    %% Styling
    style D stroke:#D50000
    style G stroke:#00C853
    style H stroke:#D50000
```

Connections to Zero Trust will always appear in your Zero Trust network session logs regardless of connection success. Because Gateway does not inspect failed connections, they will not appear in your Gateway activity logs.

## Priority between policy builders

Gateway applies your policies in the following order:

1. DNS policies with selectors evaluated before resolution
2. Resolver policies (if applicable)
3. DNS policies with selectors evaluated after resolution
4. Network policies
5. Egress policies (if applicable)
6. HTTP policies

DNS and resolver policies are standalone. For example, if you block a site with a DNS policy but do not create a corresponding HTTP policy, users can still access the site if they know its IP address.

### HTTP/3 traffic

For proxied HTTP/3 traffic, Gateway applies your policies in the following order:

1. DNS policies
2. Network policies
3. HTTP policies

## Priority within a policy builder

### DNS policies

Gateway evaluates DNS policies first in order of DNS resolution, then in order of precedence.

When DNS queries are received, Gateway evaluates policies with pre-resolution selectors, resolves the DNS query, then evaluates policies with post-resolution selectors. This means policies with selectors evaluated before DNS resolution take precedence. For example, the following set of policies will block example.com:

| Precedence | Selector | Operator | Value | Action |
| --- | --- | --- | --- | --- |
| 1 | Resolved Country IP Geolocation | is | United States | Allow |
| 2 | Domain | is | example.com | Block |

Despite an explicit Allow policy ordered first, policy 2 takes precedence because the Domain selector is evaluated before DNS resolution.

If a policy contains both pre-resolution and post-resolution selectors, Gateway will evaluate the entire policy after DNS resolution. For information on when each selector is evaluated, refer to the list of DNS selectors.

### Network policies

Gateway evaluates network policies in order of precedence.

### HTTP policies

Gateway applies HTTP policies based on a combination of action type and order of precedence:

1. All Do Not Inspect policies are evaluated first, in order of precedence.
2. If no policies match, all Isolate policies are evaluated in order of precedence.
3. All Allow, Block and Do Not Scan policies are evaluated in order of precedence.
4. The body of the HTTP request, including Data Loss Prevention (DLP), AV scanning, and file sandboxing, is evaluated.

This order of enforcement allows Gateway to first determine whether decryption should occur. If a site matches a Do Not Inspect policy, it is automatically allowed through Gateway and bypasses all other HTTP policies.

Note

The only exception is if you are using Clientless Web Isolation ‚Äî all sites within the clientless remote browser are implicitly isolated even if they match a Do Not Inspect policy.

Next, Gateway checks decrypted traffic against your Isolate policies. When a user makes a request which triggers an Isolate policy, the request will be rerouted to a remote browser.

Next, Gateway evaluates all Allow, Block, and Do Not Scan policies. These policies apply to both isolated and non-isolated traffic. For example, if example.com is isolated and example.com/subpage is blocked, Gateway will block the subpage (example.com/subpage) inside of the remote browser.

Lastly, Gateway inspects the body of the HTTP request by evaluating it against DLP policies, and running anti-virus scanning and file sandboxing. If DLP Block policies are present, the action Gateway ultimately takes may not match the action it initially logs. For more information, refer to DLP policy precedence.

### Resolver policies

When resolver policies are present, Gateway first evaluates any DNS policies with pre-resolution selectors, then routes any DNS queries according to the order of precedence of your resolver policies, and lastly evaluates any DNS policies with post-resolution selectors.

### Order of precedence

Order of precedence refers to the priority of individual policies within the DNS, network, or HTTP policy builder. Gateway evaluates policies in ascending order beginning with the lowest value.

The order of precedence follows the first match principle. Once traffic matches an Allow or Block policy, evaluation stops and no subsequent policies can override the decision. Therefore, Cloudflare recommends assigning the most specific policies and exceptions with the highest precedence and the most general policies with the lowest precedence.

#### Zero Trust dashboard

In the Zero Trust dashboard, policies are in order of precedence from top to bottom of the list. Policies begin with precedence 1 and count upward. You can modify the order of precedence by dragging and dropping individual policies in the dashboard.

#### Cloudflare API

To update the precedence of a policy with the Cloudflare API, use the Update a Zero Trust Gateway rule endpoint to update the precedence field.

#### DLP policy precedence

For Gateway configurations with DLP policies, Gateway will filter and log traffic based on first match, then scan the body of the HTTP request for matching content. Because of the first match principle, Gateway may perform and log a decision for traffic, then perform a contradicting decision. For example, if traffic is first allowed with an Allow HTTP policy, then blocked with a DLP Block policy, Gateway will log the initial Allow action despite ultimately blocking the request.

#### Access applications

If Gateway traffic is headed to a private IP address protected as an Access application, that traffic will still be evaluated by the destination application's Access policies, even if a Gateway Allow policy matched first. Gateway Block policies that match traffic will terminate any other policy evaluation. This is expected behavior. A Gateway Allow policy does not override or bypass Access policies.

Terraform provider v4 precedence limitation

To avoid conflicts, version 4 of the Terraform Cloudflare provider applies a hash calculation to policy precedence. For example, a precedence of 1000 may become 1000901. This can cause errors when reordering policies. To avoid this issue, manually set the precedence of policies created with Terraform using the Update a Zero Trust Gateway rule endpoint.

To ensure your precedence is set correctly, Cloudflare recommends upgrading your Terraform provider to version 5 ‚Üó.

## Example

Suppose you have a list of policies arranged in the following order of precedence:

- DNS policies:

































PrecedenceSelectorOperatorValueAction1Hostisexample.comBlock2Hostistest.example.comAllow3Domainmatches regex.\Block
- HTTP policies:


























PrecedenceSelectorOperatorValueAction1Hostisexample.comBlock2Hostistest2.example.comDo Not Inspect
- Network policies:

































PrecedenceSelectorOperatorValueAction1Destination Portis80Block2Destination portis443Allow3SNI Domainistest.example.comBlock

When a user goes to https://test.example.com, Gateway performs the following operations:

1. Evaluate DNS request against DNS policies:

Policy #1 does not match test.example.com ‚Äî move on to check Policy #2.
Policy #2 matches, so DNS resolution is allowed.
Policy #3 is not evaluated because there has already been an explicit match.
2. Policy #1 does not match test.example.com ‚Äî move on to check Policy #2.
3. Policy #2 matches, so DNS resolution is allowed.
4. Policy #3 is not evaluated because there has already been an explicit match.
5. Evaluate HTTPS request against HTTP policies:

Policy #2 is evaluated first because Do Not Inspect always takes precedence over Allow and Block. Since there is no match, move on to check Policy #1.
Policy #1 does not match test.example.com. Since there are no matching Block policies, the request passes the HTTP filter and moves on to network policy evaluation.
6. Policy #2 is evaluated first because Do Not Inspect always takes precedence over Allow and Block. Since there is no match, move on to check Policy #1.
7. Policy #1 does not match test.example.com. Since there are no matching Block policies, the request passes the HTTP filter and moves on to network policy evaluation.
8. Evaluate HTTPS request against network policies:

Policy #1 does not match because port 80 is used for standard HTTP, not HTTPS.
Policy #2 matches, so the request is allowed and proxied to the upstream server.
Policy #3 is not evaluated because there has already been an explicit match.
9. Policy #1 does not match because port 80 is used for standard HTTP, not HTTPS.
10. Policy #2 matches, so the request is allowed and proxied to the upstream server.
11. Policy #3 is not evaluated because there has already been an explicit match.

Therefore, the user is able to connect to https://test.example.com.

## Precedence calculations

When arranging policies in Zero Trust, Gateway automatically calculates the precedence for rearranged policies.

When using the API to create a policy, unless the precedence is explicitly defined in the policy, Gateway will assign precedence to policies starting at 1000. Every time a new policy is added to the bottom of the order, Gateway will calculate the current highest precedence in the account and add a random integer between 1 and 100 to 1000 so that it now claims the maximum precedence in the account. To manually update a policy's precedence, use the Update a Zero Trust Gateway rule endpoint. You can set a policy's precedence to any value that is not already in use.

Changing the order within the Zero Trust dashboard or API may result in configuration issues when using Terraform.

## Manage precedence with Terraform

You can manage the order of execution of your Gateway policies using Terraform. With version 5 of the Terraform Cloudflare provider, Gateway users can list their policies in a Terraform file with any desired integer precedence value. Cloudflare recommends starting with a precedence of 1000 and adding extra space between each policy's precedence for any future policies. For example:

```
resource "cloudflare_zero_trust_gateway_policy" "policy_1" {  account_id = var.cloudflare_account_id  # other attributes...  precedence = 1000}
resource "cloudflare_zero_trust_gateway_policy" "policy_2" {  account_id = var.cloudflare_account_id  # other attributes...  precedence = 2000}
resource "cloudflare_zero_trust_gateway_policy" "policy_3" {  account_id = var.cloudflare_account_id  # other attributes...  precedence = 3000}
```

To avoid precedence calculation errors when reordering policies with Terraform, you should move one policy at a time before running terraform plan and terraform apply. If you use both Terraform and the Zero Trust dashboard or API, sync your polices with terraform refresh before reordering policies in Terraform. Alternatively, you can set your account to read-only in the Zero Trust dashboard, only allowing changes using the API or Terraform.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Proxy

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/proxy/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/proxy/)

Page options # Proxy

You can forward HTTP and network traffic to Gateway for logging and filtering. Gateway can proxy both outbound traffic and traffic directed to resources connected via a Cloudflare Tunnel, GRE tunnel, or IPsec tunnel. When a user connects to the Gateway proxy, Gateway will accept the connection and establish a new, separate connection to the origin server.

The Gateway proxy is required for filtering HTTP and network traffic via the WARP client in Gateway with WARP mode. To proxy HTTP traffic without deploying the WARP client, you can configure PAC files on your devices.

## Proxy algorithm

Gateway uses the Happy Eyeballs algorithm ‚Üó to proxy traffic in the following order:

1. The user's browser initiates the TCP handshake by sending Gateway a TCP SYN segment.
2. Gateway sends a SYN segment to the origin server.
3. If the origin server sends a SYN-ACK segment back, Gateway establishes separate TCP connections between the user and Gateway and between Gateway and the origin server.
4. Gateway inspects and filters traffic received from the user.
5. If the traffic passes inspection, Gateway proxies traffic bidirectionally between the user and the origin server.

```
flowchart TD
    %% Accessibility
    accTitle: How Gateway proxy works
    accDescr: Flowchart describing how the Gateway proxy uses the Happy Eyeballs algorithm to establish TCP connections and proxy user traffic.

    %% Flowchart
    A[User's device sends TCP SYN to Gateway] --> B[Gateway sends TCP SYN to origin server]
    B --> C{{Origin server responds with TCP SYN-ACK?}}
    C -->|Yes| E[TCP handshakes completed]
    C -->|No| D[Connection fails]
    E --> F{{Connection allowed?}}
    F -->|Allow policy| G[Gateway proxies traffic bidirectionally]
    F -->|Block policy| H[Connection blocked by firewall policies]

    %% Styling
    style D stroke:#D50000
    style G stroke:#00C853
    style H stroke:#D50000
```

## Supported protocols

Gateway supports proxying TCP, UDP, and ICMP traffic.

### TCP

When the proxy is enabled, Gateway will always forward TCP traffic.

By default, TCP connection attempts will timeout after 30 seconds and idle connections will disconnect after 8 hours.

### UDP

The UDP proxy forwards UDP traffic such as VoIP, internal DNS requests, and thick client applications.

When the UDP proxy is enabled, Gateway will force all HTTP/3 traffic to HTTP/2 to allow inspection. Otherwise, HTTP/3 traffic will bypass inspection. For more information, refer to HTTP/3 inspection.

### ICMP Beta

The ICMP proxy forwards traffic for diagnostic tools such as ping and traceroute.

Limitation

Gateway cannot log or filter ICMP traffic.

#### Allow ICMP traffic through cloudflared

To use the ICMP proxy with Cloudflare Tunnel, you may need to configure the cloudflared host to allow ICMP traffic through cloudflared.

- Linux
- Docker

1. Ensure that ping_group_range includes the Group ID (GID) of the user running cloudflared:
a. Find the user that owns the cloudflared process:
Terminal windowps -aux | grep cloudflared
johndoe         407  0.8  1.7 1259904 35296 ?       Ssl  21:02   0:00 /usr/bin/cloudflared --no-autoupdate tunnel run --token eyJhI...
b. Get the Group ID of the cloudflared user:
Terminal windowid -g johndoe
10001
c. Determine the Group IDs that are allowed to use ICMP:
Terminal windowsudo sysctl net.ipv4.ping_group_range
net.ipv4.ping_group_range= 0 10000
d. Either add the user to a group within that range, or update the range to encompass a group the user is already in. To update ping_group_range:
Terminal windowecho 0 10001 | sudo tee /proc/sys/net/ipv4/ping_group_range
e. To make the change persist on reboot, update your systcl parameters:
Terminal windowecho "net.ipv4.ping_group_range = 0 10001" | sudo tee -a /etc/sysctl.d/99-cloudflared.conf
2. If you are running multiple network interfaces (for example, eth0 and eth1), configure cloudflared to use the external Internet-facing interface:
Terminal windowcloudflared tunnel run --icmpv4-src <IP of primary interface>

In your environment, modify the ping_group_range parameter to include the Group ID (GID) of the user running cloudflared.

By default the cloudflared Docker container ‚Üó executes as a user called nonroot inside of the container. nonroot is a specific user that exists in the base image ‚Üó we use, and its Group ID is hardcoded to 65532.

## Turn on the Gateway proxy

1. In Zero Trust ‚Üó, go to Settings > Network.
2. In Firewall, turn on Proxy.
3. Select TCP.
4. (Optional) Depending on your use case, you can select UDP and/or ICMP.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Lists

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/lists/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/lists/)

Page options # Lists

With Cloudflare Zero Trust, you can create lists of URLs, hostnames, or other entries to reference when creating Gateway policies or Access policies. This allows you to quickly create rules that match and take actions against several items at once.

Before creating a list, make note of the limitations.

## List types

Lists can contain a single type of data each. Supported data types include:

- URLs
- Hostnames or domains
- Serial numbers
- User email addresses
- IP addresses
- Device ID numbers

## Create a list from a CSV file

To test uploading CSV lists, you can download a sample CSV file of IP address ranges or copy the following into a file:

list-test.csv ```
value,description192.0.2.0/24,This is an IP address range in CIDR format198.51.100.0/24,This is also an IP address range203.0.113.0/24,This is the third IP address range
```

When you format a CSV file for upload:

- Each line should be a single entry that includes a value and an optional description.
- A header row must be present for Zero Trust to recognize descriptions.
- Trailing whitespace characters are not allowed.
- CRLF (Windows) and LF (Unix) line endings are valid.

To upload the list to Zero Trust:

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to My Team > Lists.
2. Select Upload CSV.
3. Next, specify a List name, enter an optional description, and choose a List type.
4. Drag and drop a file into the CSV file window, or select a file.
5. Select Create.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Decode the contents of the CSV file and store it as a local value:
locals {  ip_list = csvdecode(file("${path.module}/list-test.csv"))}
4. Create a list using the cloudflare_zero_trust_list ‚Üó resource:
resource "cloudflare_zero_trust_list" "ips_from_csv" {  account_id  = var.cloudflare_account_id  name        = "IPs imported from CSV"  description = "Managed by Terraform"  type        = "IP"  items       = local.ip_list}

You can now use this list in the policy builder by choosing the in list operator.

## Create a list manually

- Dashboard
- API
- Terraform (v5)

1. In Zero Trust ‚Üó, go to My Team > Lists.
2. Select Create manual list.
3. Next, specify a List name, enter an optional description, and choose a List type.
4. Enter your list element manually into the Add entry field and select Add.
5. Select Save.

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create Zero Trust list ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/lists" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "description": "Private application IPs",    "items": [        {            "value": "10.226.0.177/32"        },        {            "value": "10.226.1.177/32"        }    ],    "name": "Corporate IP list",    "type": "IP"  }'
```

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. Create a list using the cloudflare_zero_trust_list ‚Üó resource.
Example list of IPs:
resource "cloudflare_zero_trust_list" "wiki_IPs" {  account_id  = var.cloudflare_account_id  name        = "Company Wiki IP addresses"  description = "Managed by Terraform"  type        = "IP"  items = [    {      description = "Example IP address range"      value = "192.0.2.0/24",    },    {      value = "198.51.100.0/24"    }  ]}
Example list of domains:
resource "cloudflare_zero_trust_list" "wiki_domains" {  account_id  = var.cloudflare_account_id  name        = "Company Wiki Domains"  description = "Managed by Terraform"  type        = "DOMAIN"  items = [    {      value = "wiki.example.com"    },    {      value = "wiki2.example.com"    }]}

You can now use this list in the policy builder by choosing the in list operator.

## Edit a list

1. In the Lists page, locate the list you want to edit.
2. Select Edit. This will allow you to:

Edit list name and description by selecting on the three-dots menu to the right of your list's name.
Delete the list by selecting the three-dots menu to the right of your list's name.
Delete individual entries.
Manually add entries to your list.
3. Edit list name and description by selecting on the three-dots menu to the right of your list's name.
4. Delete the list by selecting the three-dots menu to the right of your list's name.
5. Delete individual entries.
6. Manually add entries to your list.
7. Once you have edited your list, select Save.

## Limitations

### List size

Your lists can include up to 1,000 entries for Standard plans and 5,000 for Enterprise plans. An uploaded CSV file must be smaller than 2 MB.

### Wildcard entries

Hostname lists do not support wildcard entries (*.example.com). You will need to add domains as exact matches. Adding a wildcard to lists comprised of hostnames will return an error when you save.

### Non-Latin characters

Gateway supports non-Latin characters by converting all domains and hostnames to Punycode ‚Üó. Once you save a list with non-Latin characters, Gateway will display the entry as Punycode.

### Duplicate entries

Lists cannot have duplicate entries. Because domains and hostnames are converted to Punycode, multiple list entries that convert to the same string will count as duplicates. For example, √©x√†mple.com converts to xn‚Äîxmple-rqa5d.com, so including both √©x√†mple.com and xn‚Äîxmple-rqa5d.com in a list will result in a duplicate error.

### URL slashes

Gateway ignores trailing forward slashes (/) in URLs. For example, https://example.com and https://example.com/ will count as the same URL and may return a duplicate error.

### Extended email addresses

Extended email addresses (also known as plus addresses) are variants of an existing email address with + or . modifiers. Many email providers, such as Gmail and Outlook, deliver emails intended for an extended address to its original address. For example, providers will deliver emails sent to contact+123@example.com or con.tact@example.com to contact@example.com.

By default, Gateway will either filter only exact matches or all extended variants depending on the type of policy and action used:

DNS policies

| Action | Behavior |
| --- | --- |
| Allow | Match exact address only |
| Block | Match exact address and all variants |
| Override | Match exact address and all variants |
| Safe Search | Match exact address and all variants |
| YouTube Restricted | Match exact address and all variants |

Network policies

| Action | Behavior |
| --- | --- |
| Allow | Match exact address only |
| Audit SSH | Match exact address and all variants |
| Block | Match exact address and all variants |
| Network Override | Match exact address only |

HTTP policies

| Action | Behavior |
| --- | --- |
| Allow | Match exact address only |
| Block | Match exact address and all variants |
| Do Not Inspect | Match exact address only |
| Do Not Isolate | Match exact address only |
| Do Not Scan | Match exact address only |
| Isolate | Match exact address and all variants |

Other policies

| Policy type | Behavior |
| --- | --- |
| Egress policy | Match exact address only |
| Resolver policy | Match exact address only |

To force Gateway to match all email address variants, go to Settings > Network > Firewall and turn on Match extended email addresses. This setting applies to all firewall, egress, and resolver policies.

### API rate limit

You can send 600 requests to the Gateway Lists endpoint per minute. If you exceed the rate limit, Cloudflare will block subsequent requests for 120 seconds.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Block page

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/block-page/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/block-page/)

Page options # Block page

When Gateway blocks traffic with a DNS or HTTP Block policy, you can configure a block page to display in your users' browsers. You can provide a descriptive reason for blocking traffic and contact information, or you can redirect your users' browsers to another page. You can apply these customizations globally for every Block policy, or override the settings on a per-policy basis.

## Prerequisites

In order to display the block page as the URL of the blocked domain, your organization's devices must have a Cloudflare certificate installed. Enterprise users can also deploy their own root CA certificate. If you do not install a certificate, the block page will not display correctly.

## Configure the block page

Gateway will display a global block page in the browser of any user whose traffic is blocked. By default, Gateway will display the block page for any DNS Block policies you turn it on for and all HTTP Block policies. You can turn on or override the global setting on a per-policy basis.

To configure the global block page:

1. In Zero Trust ‚Üó, go to Settings > Custom Pages.
2. Under Account Gateway block page, Gateway will display the current block page setting. Select Customize.
3. Choose whether to use the default Gateway block page, a URL redirect, or a custom Gateway block page.
4. Select Save.

### Use the default block page

When you choose Default Gateway block page, Gateway will display a block page hosted by Cloudflare ‚Üó. This is the default option for all traffic blocked by Gateway.

### Redirect to a block page

Instead of displaying the Cloudflare block page, you can configure Gateway to return a 307 (Temporary Redirect) HTTP response code and redirect to a custom URL.

To redirect users to a non-Cloudflare block page:

1. In Zero Trust ‚Üó, go to Settings > Custom Pages.
2. Under Account Gateway block page, select Customize.
3. Choose URL redirect
4. Enter the URL you want to redirect blocked traffic to.
5. (Optional) Turn on Send policy context to send additional policy context to the redirected URL.
6. Select Save.

Gateway will now redirect users to a custom page when user traffic matches a Block policy with the block page configured.

To create an HTTP policy to redirect URLs, refer to the Redirect action.

#### Policy context

When you turn on Send policy context, Gateway will append details of the matching request to the redirected URL as a query string. Not every context field will be included. Potential policy context fields include:

Policy context fields

| Field | Definition | Example |
| --- | --- | --- |
| User email | Email of the user that made the query. | &cf_user_email=user@example.com |
| Site URL | Full URL of the original HTTP request or domain name in DNS query. | &cf_site_uri=https%3A%2F%2Fmalware.testcategory.com%2F |
| URL category | Domain categories of the URL to be redirected. | &cf_request_categories=New%20Domains,Newly%20Seen%20Domains |
| Original HTTP referer | For HTTP traffic, the original HTTP referer header of the HTTP request. | &cf_referer=https%3A%2F%2Fexample.com%2F |
| Rule ID | ID of the Gateway policy that matched the request. | &cf_rule_id=6d48997c-a1ec-4b16-b42e-d43ab4d071d1 |
| Source IP | Source IP address of the device that matched the policy. | &cf_source_ip=203.0.113.5 |
| Device ID | UUID of the device that matched the policy. | &cf_device_id=6d48997c-a1ec-4b16-b42e-d43ab4d071d1 |
| Application names | Name of the application the redirected domain corresponds to, if any. | &cf_application_name=Salesforce |
| Filter | The traffic type filter that triggered the block. | &cf_filter=http, &cf_filter=dns, &cf_filter=av, or &cf_filter=l4 |
| Account ID | Cloudflare account ID of the associated Zero Trust account. | &cf_account_id=d57c3de47a013c03ca7e237dd3e61d7d |
| Query ID | ID of the DNS query for which the redirect took effect. | &cf_query_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |
| Connection ID | ID of the proxy connection for which the redirect took effect. | &cf_connection_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |
| Request ID | ID of the HTTP request for which the redirect took effect. | &cf_request_id=f8dc6fd3-a7a5-44dd-8b77-08430bb4fac3 |

#### Redirect precedence

Paths and queries in the redirect URL take precedence over the original URL. When you turn on Send policy context, Gateway will append context to the end of the redirected URL. For example, if the original URL is example.com/path/to/page?querystring=X&k=1 and the redirect URL is cloudflare.com/redirect-path?querystring=Y, Gateway will redirect requests to:

```
cloudflare.com/redirect-path?querystring=Y&cf_user_email=user@example.com
```

### Customize the block page

You can customize the Cloudflare-hosted block page by making global changes that Gateway will display every time a user reaches your block page. Customizations will apply regardless of the type of policy (DNS or HTTP) that blocks the traffic.

To customize your block page:

- Dashboard
- Terraform (v5)

1. In Zero Trust ‚Üó, go to Settings > Custom Pages.
2. Under Account Gateway block page, select Customize.
3. Choose Custom Gateway block page. Gateway will display a preview of your custom block page. Available customizations include:

Your organization's name
Logo
Header text
Global block message, which will be displayed above the policy-specific block message
Mailto link
Background color
4. Your organization's name
5. Logo
6. Header text
7. Global block message, which will be displayed above the policy-specific block message
8. Mailto link
9. Background color
10. Select Save.

1. Add the following permission to your cloudflare_api_token ‚Üó:

Zero Trust Write
2. Zero Trust Write
3. In cloudflare_zero_trust_gateway_settings ‚Üó, configure the block_page argument with your customizations:
resource "cloudflare_zero_trust_gateway_settings" "team_name" {  account_id = var.cloudflare_account_id  settings = {    block_page = {      enabled = true //do not use the default Gateway block page      mode = "customized_block_page" //use a custom block page      name = "Cloudflare"      logo_path = "https://logos.com/a.png"      header_text = "--header--"      footer_text = "--footer--"      mailto_address = "admin@example.com"      mailto_subject = "Blocked Request"      background_color = "#ffffff"      suppress_footer = false    }  }}

Gateway will now display a custom Gateway block page when your users visit a blocked website.

#### Add a logo image

You can include an external logo image to display on your custom block page. The block page resizes all images to 146x146 pixels. The URL must be valid and no longer than 2048 characters. Accepted file types include SVG, PNG, JPEG, and GIF.

#### Allow users to email an administrator

You can add a Mailto link to your custom block page, which allows users to directly email you about the blocked site. When users select Contact your Administrator on your block page, an email template opens with the email address and subject line you configure, as well as the following diagnostic information:

| Field | Description |
| --- | --- |
| Site URL | The URL of the blocked page. |
| Rule ID | The ID of the Gateway policy that blocked the page. |
| Source IP | The public source IP of the user device. |
| Account ID | The Cloudflare account associated with the block policy. |
| User ID | The ID of the user who visited the page. Currently, User IDs are not surfaced in the dashboard and can only be viewed by calling the API. |
| Device ID | The ID of the device that visited the page. This is generated by the WARP client. |
| Block Reason | Your policy-specific block message. |

## Configure policy block behavior

For DNS Block policies, you will need to turn on the block page for each policy you want to display it. For HTTP Block policies, Gateway automatically displays your global block page setting by default. You can override your global block page setting for both policy types within each policy's settings.

To turn on the block page or override your global block page setting for an individual policy:

- DNS policy
- HTTP policy

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies > DNS.
2. Select Add a policy to create a new policy, or choose the policy you want to customize and select Edit. You can only edit the block page for policies with a Block action.
3. Under Configure policy settings, turn on Modify Gateway block behavior.
4. Choose your block behavior:

Use account-level block setting: Use the global block page setting configured in your account settings. The global setting can be the default Gateway block page, an HTTP redirect, or a custom Gateway block page.
Override account setting with URL redirect: Redirect users with a 307 HTTP redirect to a URL you specify on a policy level.
5. Use account-level block setting: Use the global block page setting configured in your account settings. The global setting can be the default Gateway block page, an HTTP redirect, or a custom Gateway block page.
6. Override account setting with URL redirect: Redirect users with a 307 HTTP redirect to a URL you specify on a policy level.
7. (Optional) If your account-level block page setting uses a custom Gateway block page, you can turn on Add an additional message to your custom block page when traffic matches this policy to add a custom message to your custom block page when traffic is blocked by this policy. This option will replace the Message field.
8. Select Save policy.

Depending on your settings, Gateway will display a block page in your users' browsers or redirect them to a specified URL when they are blocked by this policy.

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies > HTTP.
2. Select Add a policy to create a new policy, or choose the policy you want to customize and select Edit. You can only edit the block page for policies with a Block action.
3. Under Configure policy settings, go to Modify Gateway block behavior.
4. Choose your block behavior:

Use account-level block setting: Use the global block page setting configured in your account settings. The global setting can be the default Gateway block page, an HTTP redirect, or a custom Gateway block page.
Override account setting with URL redirect: Redirect users with a 307 HTTP redirect to a URL you specify on a policy level.
5. Use account-level block setting: Use the global block page setting configured in your account settings. The global setting can be the default Gateway block page, an HTTP redirect, or a custom Gateway block page.
6. Override account setting with URL redirect: Redirect users with a 307 HTTP redirect to a URL you specify on a policy level.
7. (Optional) If your account-level block page setting uses a custom Gateway block page, you can turn on Add an additional message to your custom block page when traffic matches this policy to add a custom message to your custom block page when traffic is blocked by this policy. This option will replace the Message field.
8. Select Save policy.

Depending on your settings, Gateway will display a block page in your users' browsers or redirect them to a specified URL when they are blocked by this policy.

## Limitations

### Certificate error

If your users receive a security risk warning in their browser when visiting a blocked page, check that you have correctly installed a certificate on their devices. If a certificate is not installed or the installed certificate is invalid or expired, your user's browser may:

- Display an HTTP Response Code: 526 error page, indicating an insecure upstream.
- Close the connection and fail to display any pages.

For more information on fixing certificate issues, refer to Troubleshooting.

### Incompatible DNS record types

To block the resolution of queries for DNS records with types other than A or AAAA, Gateway will respond with the REFUSED (RCODE:5) DNS return code. Gateway will block the request but will not display a block page.

### Third-party filtering conflict

Gateway will not properly filter traffic sent through third-party VPNs or other Internet filtering software, such as iCloud Private Relay ‚Üó or Google Chrome IP Protection ‚Üó. To ensure your DNS policies apply to your traffic, Cloudflare recommends turning off software that may interfere with Gateway.

To turn off iCloud Private Relay, refer to the Apple user guides for macOS ‚Üó or iOS ‚Üó.

### Data center and IP address matching

If an HTTP request that matches a block policy does not arrive at the same Cloudflare data center as its DNS query, Gateway will display the default block page instead of your custom block page.

This applies to DNS queries sent to any Gateway resolver endpoint, including those over IPv4, IPv6, and encrypted protocols like DoH (DNS over HTTPS) and DoT (DNS over TLS). If a DNS query is routed to a different Cloudflare data center than the corresponding HTTP request (for example, if DoH traffic is sent outside the WARP tunnel), Gateway cannot correlate the two requests and will display the default block page instead of your custom block page.

If the HTTP request comes from a different IP address than the DNS request, Gateway may not display the rule ID, custom message, or other fields on the block page. This can happen when a recursive DNS resolver's source IP address differs from the user device's IP address.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Managed service providers (MSPs)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/managed-service-providers/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/managed-service-providers/)

Page options # Managed service providers (MSPs)

Note

Only available on Enterprise plans. For more information, contact your account team.

Gateway supports the Cloudflare Tenant API, which allows Cloudflare-partnered managed service providers (MSPs) to set up and manage Cloudflare accounts and services for their customers. With the Tenant API, MSPs can create Zero Trust deployments with global Gateway policy control. Policies can be customized or overridden at a group or individual account level.

The Tenant platform only supports DNS policies. For more information, refer to the Cloudflare Zero Trust for managed service providers ‚Üó blog post.

## Get started

To set up the Tenant API, refer to Get started. Once you have provisioned and configured your customer's Cloudflare accounts, you can create DNS policies.

## Account types

The Gateway Tenant platform supports tiered and siloed account configurations.

### Tiered accounts

In a tiered account configuration, a top-level parent account enforces global security policies that apply to all of its child accounts. Child accounts can override or add policies as needed while still being managed by the parent account. MSPs can also configure child accounts independently from the parent account, including:

- Configuring a custom block page
- Generating or uploading root certificates
- Mapping DNS locations
- Creating lists

Each child account is subject to the default Zero Trust account limits.

Gateway evaluates parent account policies before any child account policies. To allow a child account to override a specific parent account policy, you can use the Update a Zero Trust Gateway rule endpoint to set the policy's allow_child_bypass rule setting to true.

```
flowchart TD
%% Accessibility
 accTitle: How Gateway policies work in a tiered account configuration
 accDescr: Flowchart describing the order of precedence Gateway applies policies in a tiered account configuration.

%% Flowchart
 subgraph s1["Parent account"]
        n1["Block malware"]
        n2["Block DNS tunnel"]
        n3["Block spyware"]
  end
 subgraph s2["Child account A"]
        n4["Block social media"]
  end
 subgraph s3["Child account B"]
        n5["Block instant messaging"]
  end
    n1 ~~~ n2
    n2 ~~~ n3
    A["Tenant"] --Administers--> s1
    s1 -- "Applies policies to" --> s2 & s3

    n1@{ shape: lean-l}
    n2@{ shape: lean-l}
    n3@{ shape: lean-l}
    n4@{ shape: lean-l}
    n5@{ shape: lean-l}
```

### Siloed accounts

In a siloed account configuration, each account operates independently within the same tenant. MSPs manage each account's own security policies, resources, and configurations separately.

```
flowchart TD
%% Accessibility
 accTitle: How Gateway policies work in a siloed account configuration
 accDescr: Flowchart describing the order of precedence Gateway applies policies in a siloed account configuration.

%% Flowchart
 subgraph s1["Siloed account A"]
        n1["Block social media"]
  end
 subgraph s2["Siloed account C"]
        n2["Block instant messaing"]
  end
 subgraph s3["Siloed account B"]
        n3["Block news"]
  end
    A["Tenant"] -- Administers --> s1 & s3 & s2

    n1@{ shape: lean-l}
    n2@{ shape: lean-l}
    n3@{ shape: lean-l}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Access

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/access/](https://developers.cloudflare.com/cloudflare-one/policies/access/)

Page options # Access

Cloudflare Access determines who can reach your application by applying the Access policies you configure.

An Access policy consists of an Action as well as rules which determine the scope of the action. To build a rule, you need to choose a Rule type, Selector, and a Value for the selector.

- Actions
- Rule types
- Selectors

## Actions

Actions let you grant or deny permission to a certain user or user group. You can set only one action per policy.

### Allow

The Allow action allows users that meet certain criteria to reach an application behind Access.

The following example lets any user with an @example.com email address, as validated against an IdP, reach the application:

| Action | Rule type | Selector | Value |
| --- | --- | --- | --- |
| Allow | Include | Emails Ending In: | @example.com |

You can add a Require rule in the same policy action to enforce additional checks. Finally, if the policy contains an Exclude rule, users meeting that definition are prevented from reaching the application.

For example, this second configuration lets any user from Portugal with a @team.com email address, as validated against an IdP, reach the application, except for user-1 and user-2:

| Action | Rule type | Selector | Value |
| --- | --- | --- | --- |
| Allow | Include | Country | Portugal |
|  | Require | Emails Ending In | @team.com |
|  | Exclude | Email | user-1@team.com, user-2@team.com |

### Block

The Block action prevents users who meet certain critera from reaching an application behind Access. For example, the following policy blocks requests from Russian source IPs that are not on your list of approved IPs.

| Action | Rule type | Selector | Value |
| --- | --- | --- | --- |
| Block | Include | Country | Russian Federation |
|  | Exclude | IP list | Corporate IP allowlist |

Block policies are best used in conjunction with Allow policies as a way to carve out exceptions in those Allow policies. Since Access is deny by default, users who do not match a Block policy will still be denied access unless they explicitly match an Allow policy.

### Bypass

Warning

Bypass does not enforce any Access security controls and requests are not logged. Bypass policies should be tested before deploying to production. Consider using Service Auth if you would like to enforce policies and maintain logging without requiring user authentication.

As Bypass does not enforce Access security controls, Bypass policies do not support identity-based rule types. When making Bypass policies, you will not be able to apply certain identity-based selectors (such as email).

The Bypass action disables any Access enforcement for traffic that meets the defined rule criteria. Bypass is typically used to enable applications that require specific endpoints to be public.

For example, some applications have an endpoint under the /admin route that must be publicly routable. In this situation, you could create an Access application for the domain test.example.com/admin/<your-url> and add the following Bypass policy:

| Action | Rule type | Selector | Value |
| --- | --- | --- | --- |
| Bypass | Include | Everyone | Everyone |

As part of implementing a Zero Trust security model, Cloudflare does not recommend using Bypass to grant direct permanent access to your internal applications. To enable seamless and secure access for on-network employees, use Cloudflare Tunnel to connect your private network and have users connect through WARP.

Note

When applying a Bypass action, security settings revert to the defaults configured for the zone and any configured Page Rules. If Always use HTTPS is enabled for the site, then traffic to the bypassed destination continues in HTTPS. If Always use HTTPS is disabled, traffic is HTTP.

### Service Auth

Service Auth rules enforce authentication flows that do not require an identity provider IdP login, such as service tokens and mutual TLS.

| Action | Rule type | Selector |
| --- | --- | --- |
| Service Auth | Include | Valid certificate |

## Rule types

Rules work like logical operators. They help you define which categories of users your policy will affect. All Access policies must contain an Include rule. This is what defines the initial pool of eligible users who can access an application. You can then add Exclude and Require rules to enforce specific policies for those users.

### Include

The Include rule is similar to an OR logical operator. In case more than one Include rule is specified, users need to meet only one of the criteria.

### Exclude

The Exclude rule works like a NOT logical operator. A user meeting any Exclusion criteria will not be allowed access to the application.

### Require

The Require rule works like an AND logical operator. A user must meet all specified Require rules to be allowed access.

#### Require rules with OR operators

By default, any values added to a Require rule are concatenated by an AND operator. For example, let's say you want to grant access to an application to both the full-time employees and the contractors, and only the ones based in specific countries ‚Äî say Portugal and the United States. If you set up a rule with the following configuration:

| Action | Rule type | Selector | Value |
| --- | --- | --- | --- |
| Allow | Require | Country | United States, Portugal |
|  | Require | Emails ending in | @cloudflare.com, @contractors.com |

the policy will only grant access to people reaching the application from both the United States AND Portugal, and who have both an email ending in @cloudflare.com AND in @contractors.com. Therefore, nobody will have access to the application.

To require only one country and one email ending:

1. Create a rule group that includes users in Portugal OR in the United States:















Rule typeSelectorValueIncludeCountryUnited States, Portugal
2. Create a policy that requires the rule group, and that also includes users with emails ending in either @cloudflare.com OR @contractors.com:























ActionRule typeSelectorValueAllowRequireRule groupCountry requirementsIncludeEmails ending in@cloudflare.com, @contractors.com

## Selectors

When you add a rule to your policy, you will be asked to specify the criteria/attributes you want users to meet. These attributes are available for all Access application types, including SaaS, self-hosted, and non-HTTP applications.

Non-identity attributes are polled continuously, meaning they are-evaluated with each new HTTP request for changes during the user session. If you have configured SCIM provisioning, you can force a user to re-attest all attributes with Access whenever you revoke the user in the IdP or update their IdP group membership.

| Selector | Description | Checked at login | Checked continuously1 | Identity-based selector? |
| --- | --- | --- | --- | --- |
| Emails | you@company.com | ‚úÖ | ‚ùå | ‚úÖ |
| Emails ending in | @company.com | ‚úÖ | ‚ùå | ‚úÖ |
| External Evaluation | Allows or denies access based on custom logic in an external API. | ‚úÖ | ‚ùå | ‚úÖ |
| IP ranges | 192.168.100.1/24 (supports IPv4/IPv6 addresses and CIDR ranges) | ‚úÖ | ‚úÖ | ‚ùå |
| Country | Uses the IP address to determine country. | ‚úÖ | ‚úÖ | ‚ùå |
| Everyone | Allows, denies, or bypasses access to everyone. | ‚úÖ | ‚ùå | ‚ùå |
| Common Name | The request will need to present a valid certificate with an expected common name. | ‚úÖ | ‚úÖ | ‚ùå |
| Valid Certificate | The request will need to present any valid client certificate. | ‚úÖ | ‚úÖ | ‚ùå |
| Service Token | The request will need to present the correct service token headers configured for the specific application. | ‚úÖ | ‚úÖ | ‚ùå |
| Any Access Service Token | The request will need to present the headers for any service token created for this account. | ‚úÖ | ‚úÖ | ‚ùå |
| Login Methods | Checks the identity provider used at the time of login. | ‚úÖ | ‚ùå | ‚úÖ |
| Authentication Method | Checks the multifactor authentication method used by the user, if supported by the identity provider. | ‚úÖ | ‚ùå | ‚úÖ |
| Identity provider group | Checks the user groups configured with your identity provider (IdP). This selector only displays if you use Microsoft Entra ID, GitHub, Google, Okta, or an IdP that provisions groups with SCIM. | ‚úÖ | ‚ùå | ‚úÖ |
| SAML Group | Checks a SAML attribute name / value pair. This selector only displays if you use a generic SAML identity provider. | ‚úÖ | ‚ùå | ‚úÖ |
| OIDC Claim | Checks an OIDC claim name / value pair. This selector only displays if you use a generic OIDC identity provider. | ‚úÖ | ‚ùå | ‚úÖ |
| Device posture | Checks device posture signals from the WARP client or a third-party service provider. | ‚úÖ | ‚úÖ | ‚ùå |
| Warp | Checks that the device is connected to WARP, including the consumer version. | ‚úÖ | ‚úÖ | ‚ùå |
| Gateway | Checks that the device is connected to your Zero Trust instance through the WARP client. | ‚úÖ | ‚úÖ | ‚ùå |

1 For SaaS applications, Access can only enforce policies at the time
of initial sign on and when reissuing the SaaS session. Once the user has
authenticated to the SaaS app, session management falls solely within the
purview of the SaaS app.

## Order of execution

Policies are evaluated based on their action type and ordering. Bypass and Service Auth policies are evaluated first, from top to bottom as shown in the UI. Then, Block and Allow policies are evaluated based on their order.

For example, if you have a list of policies arranged as follows:

- Allow A
- Block B
- Service Auth C
- Bypass D
- Allow E

The policies will execute in this order: Service Auth C > Bypass D > Allow A > Block B > Allow E. Once a user matches an Allow or Block policy, evaluation stops and no subsequent policies can override the decision.

## Common misconfigurations

If you add any of the following rules to an Allow policy, anyone will be able to access your application.

### Include everyone

| Rule type | Selector | Value |
| --- | --- | --- |
| Include | Everyone | Everyone |

### Include all valid emails

| Rule type | Selector | Value |
| --- | --- | --- |
| Include | Login Methods | One-time PIN |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Manage Access policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/access/policy-management/](https://developers.cloudflare.com/cloudflare-one/policies/access/policy-management/)

Page options # Manage Access policies

Access policies define the users who can log in to your Access applications. You can create, edit, or delete policies at any time and reuse policies across multiple applications.

## Create a policy

To create a reusable Access policy:

1. In Zero Trust ‚Üó, go to Access > Policies.
2. Select Add a policy.
3. Enter a Policy name.
4. Choose an Action for the policy.
5. Choose a Session duration for the policy.
6. Configure as many Rules as needed.
7. (Optional) Configure additional settings for users who match this policy:

Isolate application.
Purpose justificaton
Temporary authentication
8. Isolate application.
9. Purpose justificaton
10. Temporary authentication
11. Select Save.

You can now add this policy to an Access application.

## Edit a policy

To make changes to an existing Access policy:

1. In Zero Trust ‚Üó, go to Access > Policies.
2. Locate the policy you want to update and select Configure.
3. Once you have made the necessary changes, select Save.

The updated policy is now in effect for all associated Access applications.

## Delete a policy

To delete a reusable Access policy:

1. In Zero Trust ‚Üó, go to Access > Policies and locate the policy you want to delete.
2. If the policy is used by an application, remove the policy from all associated applications.
3. Select Delete.
4. A pop-up message will ask you to confirm your decision to delete the policy. Select Delete.

## Test your policies

You can test your Access policies against all existing user identities in your Zero Trust organization.  For the policy tester to work, users must have logged into the App Launcher or any other Access application at some point in time.

Cloudflare will use the most recent device that was authenticated with Access to test your policies.

### Test a single policy

The Access policy builder allows you to test your rules before saving any changes.

To test an individual Access policy:

1. In Zero Trust ‚Üó, go to Access > Policies.
2. Locate the policy you want to test and select Configure.
3. Go to Policy tester and select Test policies.

The policy tester reports the percentage of active users who are allowed or denied access to an application based on this policy. You can expand the test results to view a list of allowed or blocked users.

### Test all policies in an application

You can test your Access application policies against your user population before deploying changes to your users. After saving your changes, you can also perform a more detailed policy test for a specific user.

To test if users have access to an application:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Locate the application you want to test and select Configure.
3. Go to Policies > Policy tester.
4. To test all active users in your organization, select Test policies.
The policy tester reports the percentage of users who are allowed or denied access to this application based on all configured policies. You can expand the test results to view a list of allowed or blocked users.
5. To perform a detailed test on a single user:
a. If you made any changes to your policies, first save the application.
b. Select testing a single user.
c. Enter their email address and select Test policies.
The single user test results will show:

Whether the user is allowed or denied access to this application based on all configured policies.
The user's identity from their most recent Access login attempt.
Whether the user matches individual Allow, Block, or Bypass policies.
6. Whether the user is allowed or denied access to this application based on all configured policies.
7. The user's identity from their most recent Access login attempt.
8. Whether the user matches individual Allow, Block, or Bypass policies.

## Legacy policies

Legacy policies are scoped to a specific application and cannot be added to newly created Access applications.

### Migrate to reusable policies

To migrate legacy policies to reusable policies:

1. Create a reusable policy that will replace the legacy policy.
2. Go to the Access application associated with the legacy policy.
3. Add the reusable policy to the application and remove the legacy policy.
4. Repeat these steps for each legacy policy. If you have duplicate legacy policies, you can replace them with a single reusable policy.

### Convert a legacy policy

You can use the API to convert a legacy policy into a reusable policy. To convert a legacy policy, make a PUT request with an empty request body:

Required API token permissions

At least one of the following token permissions is required: - Access: Apps and Policies Write

Convert an Access application policy to a reusable policy ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/apps/$APP_ID/policies/$POLICY_ID/make_reusable" \  --request PUT \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN"
```

The policy is now removed from the applications endpoint (/access/apps/$APP_ID/policies) and managed using the reusable policies endpoints(/access/policies/$POLICY_ID).

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Rule groups

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/access/groups/](https://developers.cloudflare.com/cloudflare-one/policies/access/groups/)

Page options # Rule groups

A rule group is a collection of Access rules that can be configured once and then quickly applied across many Access policies. Rule groups use the same rule types and selectors shown in the Access policy builder.

Note

Rule groups are distinct from groups in your identity provider, like Okta groups. Rule groups can contain a mix of individual users, groups from identity providers, and service authentication options like service tokens.

## Create a rule group

To create an Access rule group:

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Access > Rule groups.
2. Select Add a group.
3. Enter a name for the group (for example, Lisbon-team).
4. Specify as many rules as needed to define your user group. For example, the following rules define a team based in Lisbon, Portugal:




















Rule typeSelectorValueIncludeCountryPortugalRequireEmails Ending In@team.com
5. Select Save.

Send a POST request to the /access/groups endpoint:

Required API token permissions

At least one of the following token permissions is required: - Access: Organizations, Identity Providers, and Groups Write

Create an Access group ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/groups" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Lisbon-team",    "include": [        {            "geo": {                "country_code": "PT"            }        }    ],    "exclude": [],    "require": [        {            "email_domain": {                "domain": "team.com"            }        }    ],    "is_default": false  }'
```

You can now add this group to an Access policy using the Rule groups selector.

## Use cases

### IP-based rules

We recommend using rule groups to define any IP address-based rules you configure in policies. Keeping IP addresses in one place allows you to modify or remove addresses once, rather than in each policy, and reduces the potential for mistakes.

Note

If adding more than one IP address or range to a rule group, use an Include rule for the IPs. If you do not use an Include rule, the policy will require traffic to originate from all ranges.

### Country requirements

You can create a rule group that consists of countries to allow or block. Access will treat the countries in the Include rule with an OR logical operator. When building policies for an Access application, you can assign this rule group to a Require policy to require at least one of the countries inside of the group. For an example policy, refer to Require rules with OR operators.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Require purpose justification

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/access/require-purpose-justification/](https://developers.cloudflare.com/cloudflare-one/policies/access/require-purpose-justification/)

Page options # Require purpose justification

Cloudflare Access allows security and IT teams to present users with a purpose justification screen directly after they log in to an Access application. This allows organizations to audit not only for who is accessing their resources, but also for why they are requesting access.

The purpose justification screen will show for any new sessions of an application. For example, if an Access application has a session time of eight hours, a user will see the purpose justification screen once every eight hours.

Configuring a purpose justification screen is done as part of configuring an Access policy.

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Choose an application and select Configure.
3. Go to Policies.
4. Choose an Allow policy and select Configure.
5. Under Additional settings, turn on Purpose justification.
6. (Optional) Set a custom purpose justification message. This will appear on the purpose justification screen and will be visible to the user.
7. Save the policy.

Users who match this policy will see the following screen:

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## External Evaluation rules

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/access/external-evaluation/](https://developers.cloudflare.com/cloudflare-one/policies/access/external-evaluation/)

Page options # External Evaluation rules

With Cloudflare Access, you can create Allow or Block policies which evaluate the user based on custom criteria. This is done by adding an External Evaluation rule to your policy. The External Evaluation selector requires two values:

- Evaluate URL ‚Äî the API endpoint containing your business logic.
- Keys URL ‚Äî the key that Access uses to verify that the response came from your API

After the user authenticates with your identity provider, Access sends the user's identity to the external API at Evaluate URL. The external API returns a True or False response to Access, which will then allow or deny access to the user. To protect against man-in-the-middle attacks, Access signs all requests with your Access account key and checks that responses are signed by the key at Keys URL.

You can set up External Evaluation rules using any API service, but to get started quickly we recommend using Cloudflare Workers.

## Set up external API and key with Cloudflare Workers

### Prerequisites

- Workers account
- Install npm ‚Üó
- Install Node.js ‚Üó
- Application protected by Access

### 1. Create a new Worker

1. Open a terminal and clone our example project.
Terminal windownpm create cloudflare@latest my-worker -- --template https://github.com/cloudflare/workers-access-external-auth-example
2. Go to the project directory.
Terminal windowcd my-worker
3. Create a Workers KV namespace to store the key. The binding name should be KV if you want to run the example as written.
Terminal windownpx wrangler kv namespace create "KV"
The command will output the binding name and KV namespace ID, for example
  [[kv_namespaces]]   binding = "KV"   id = "YOUR_KV_NAMESPACE_ID"
4. Open the Wrangler configuration file in an editor and insert the following:

[[kv_namespaces]]: Add the output generated in the previous step.
<TEAM_NAME>: your Cloudflare Zero Trust team name.
5. [[kv_namespaces]]: Add the output generated in the previous step.
6. <TEAM_NAME>: your Cloudflare Zero Trust team name.

- wrangler.jsonc
- wrangler.toml

```
{  "name": "my-worker",  "workers_dev": true,  "compatibility_date": "2024-08-06",  "main": "index.js",  "kv_namespaces": [    {      "binding": "KV",      "id": "YOUR_KV_NAMESPACE_ID"    }  ],  "vars": {    "TEAM_DOMAIN": "<TEAM_NAME>.cloudflareaccess.com",    "DEBUG": false  }}
```

```
name = "my-worker"workers_dev = truecompatibility_date = "2024-08-06"main = "index.js"

[[kv_namespaces]]binding = "KV"id = "YOUR_KV_NAMESPACE_ID"
[vars]TEAM_DOMAIN="<TEAM_NAME>.cloudflareaccess.com"DEBUG=false
```

### 2. Program your business logic

1. Open index.js and modify the externalEvaluation function to perform logic on any identity-based data sent by Access.

Note

- Sample code is available in our GitHub repository ‚Üó.
- To view a list of identity-based data fields, log in to your Access application and append /cdn-cgi/access/get-identity to the URL. For example, if www.example.com is behind Access, visit https://www.example.com/cdn-cgi/access/get-identity.

1. Deploy the Worker to Cloudflare's global network.
Terminal windownpx wrangler deploy

The Worker will be deployed to your *.workers.dev subdomain at my-worker.<YOUR_SUBDOMAIN>.workers.dev.

### 3. Generate a key

To generate an RSA private/public key pair:

1. Open a browser and go to https://my-worker.<YOUR_SUBDOMAIN>.workers.dev/keys.
2. (Optional) Verify that the key has been stored in the KV namespace:

In the Cloudflare dashboard, go to the Workers KV page.
  Go to Storage & Databases    

Select View next to my-worker-KV.
3. In the Cloudflare dashboard, go to the Workers KV page.
  Go to Storage & Databases
4. Select View next to my-worker-KV.

Other key formats (such as DSA) are not supported at this time.

### 4. Create an External Evaluation rule

1. In Zero Trust ‚Üó, go to Access > Policies.
2. Edit an existing policy or select Add a policy.
3. Add the following rule to your policy:

| Rule Type | Selector | Evaluate URL | Keys URL |
| --- | --- | --- | --- |
| Include | External Evaluation | https://my-worker.<YOUR_SUBDOMAIN>.workers.dev/ | https://my-worker.<YOUR_SUBDOMAIN>.workers.dev/keys/ |

1. Save the policy.
2. Go to Access > Applications and edit the application for which you want to apply the External Evaluation rule.
3. In the Policies tab, add the policy that contains the External Evaluation rule.
4. Select Save application.

When a user logs in to your application, Access will now check their email, device, location, and other identity-based data against your business logic.

### Troubleshooting the Worker

To debug your External Evaluation rule:

1. Go to your Worker directory.
Terminal windowcd my-worker
2. Open the Wrangler configuration file in an editor and set the debug variable to TRUE.
3. Deploy your changes.
Terminal windownpx wrangler deploy
4. Next, start a session to output realtime logs from your Worker.
Terminal windowwrangler tail -f pretty
5. Log in to your Access application.
The session logs should show an incoming and outgoing JWT. The incoming JWT was sent by Access to the Worker API, while the outgoing JWT was sent by the Worker back to Access.
6. To decode the contents of a JWT, you can copy the token into jwt.io ‚Üó.
The incoming JWT should contain the user's identity data. The outgoing JWT should look similar to:
{"success": true,"iat": 1655409315,"exp": 1655409375,"nonce": "9J2E9Xg6wYj8tlnA5MV4Zgp6t8rzmS0Q"}
Access checks the outgoing JWT for all of the following criteria:

Token was signed by Keys URL.
Expiration date has not elapsed.
API returns "success": true.
nonce is unchanged from the incoming JWT. The nonce value is unique per request.

If any condition fails, the External Evaluation rule evaluates to false.
7. Token was signed by Keys URL.
8. Expiration date has not elapsed.
9. API returns "success": true.
10. nonce is unchanged from the incoming JWT. The nonce value is unique per request.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Isolate self-hosted application

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/access/isolate-application/](https://developers.cloudflare.com/cloudflare-one/policies/access/isolate-application/)

Page options # Isolate self-hosted application

Note

Requires Cloudflare Browser Isolation.

With Access policies, you can require users to open self-hosted applications in a secure remote browser. Because the remote browser is directly integrated into our Secure Web Gateway platform, HTTP policies can be applied to isolated applications without needing to install the WARP client. This allows you to distribute internal applications to unmanaged users while retaining control over sensitive data.

## Prerequisites

Your browser must allow third-party cookies on the application domain.

## Enable Browser Isolation

1. In Zero Trust ‚Üó, go to Settings > Browser Isolation.
2. Enable Clientless Web Isolation.

1. Go to Access > Applications.
2. Choose a self-hosted application and select Configure.
3. Go to Policies.
4. Choose an Allow policy and select Configure.
5. Under Additional settings, turn on Isolate application.
6. Save the policy.

Browser Isolation is now enabled for users who match this policy. After the user logs into Access, the application will launch in a remote browser. To confirm that the application is isolated, refer to Check if a web page is isolated.

You can optionally add another Allow policy for users on managed devices who do not require isolation.

## Policies for isolated applications

Traffic to the isolated Access application is filtered by your Gateway HTTP policies. Useful policies include:

- Identity-based policies to allow or block requests based on user identity.
- Data Loss Prevention policies to log or block transmission of sensitive data.
- Isolation policies to disable browser actions such as copy/paste, printing, or file downloads.

For example, if your application is hosted on internal.site.com, the following policy blocks users from uploading and downloading credit card numbers within the remote browser:

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Domain | in | internal.site.com | And | Block |
| DLP Profile | in | Financial Information |  |  |

## Product compatibility

For a list of products that are incompatible with the Isolate application feature, refer to Product Compatibility .

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Application paths

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/access/app-paths/](https://developers.cloudflare.com/cloudflare-one/policies/access/app-paths/)

Page options # Application paths

Application paths define the URLs protected by an Access policy. When adding a self-hosted application to Access, you can choose to protect the entire website by entering its apex domain, or alternatively, protect specific subdomains and paths.

## Policy inheritance

Cloudflare Zero Trust allows you to create unique rules for parts of an application that share a root path. Imagine an example application is deployed at dashboard.com/eng that anyone on the engineering team should be able to access. However, a tool deployed at dashboard.com/eng/exec should only be accessed by the executive team.

When multiple rules are set for a common root path, the more specific rule takes precedence. For example, when setting rules for dashboard.com/eng and dashboard.com/eng/exec separately, the more specific rule for dashboard.com/eng/exec takes precedence, and no rule is inherited from dashboard.com/eng. If no separate, specific rule is set for dashboard.com/eng/exec, it will inherit any rules set for dashboard.com/eng.

## Wildcards

When you create an application for a specific subdomain or path, you can use asterisks (*) as wildcards. Wildcards allow you to extend the application you are creating to multiple subdomains or paths in a given apex domain.

### Examples

#### Match all subdomains of an apex domain

A wildcard in the Subdomain field only matches that specific subdomain level. It does not cover the apex domain or multiple levels of the subdomain. If you want to cover multiple subdomain levels, you can use multiple wildcards.

| Application | Covers | Does not cover |
| --- | --- | --- |
| *.example.com | alpha.example.com  beta.example.com | example.com  foo.bar.example.com |

#### Match all paths of an apex domain

To protect an apex domain and all of the paths under it, leave the Path field empty. Alternatively, use a wildcard in the Path field.

| Application | Covers | Does not cover |
| --- | --- | --- |
| example.com  or example.com/* | example.com  example.com/alpha  example.com/beta | alpha.example.com |

#### Match multi-level subdomains

Using a wildcard in the Subdomain field does not cover the parent subdomain nor the apex domain.

| Application | Covers | Does not cover |
| --- | --- | --- |
| *.test.example.com | alpha.test.example.com  beta.test.example.com | test.example.com   example.com |

#### Partially match subdomains

Using a wildcard at the beginning or end of the Subdomain field does not cover multiple levels of the subdomain.

| Application | Covers | Does not cover |
| --- | --- | --- |
| *test.example.com | test.example.com  alphatest.example.com | beta.test.example.com |

#### Match multi-level paths

Using a wildcard in the Path field does not cover the parent path nor the apex domain.

| Application | Covers | Does not cover |
| --- | --- | --- |
| example.com/alpha/* | example.com/alpha/one  example.com/alpha/two | example.com/alpha  example.com |

#### Partially match paths

Using a wildcard in the middle of the Path field covers multiple segments of the URL.

| Application | Covers |
| --- | --- |
| example.com/foo*/bar | example.com/foo/bar example.com/food/bar  example.com/food/stuff/bar |

### Limitations

- At most one wildcard in between each dot in the Subdomain. For example, foo*bar*baz.example.com is not allowed.
- At most one wildcard in between each slash in the Path. For example, example.com/foo*bar*baz is not allowed.

## Subdomain setups

Subdomain setups allow you to manage a child domain separately from its parent domain. In Access application paths, your configured child domains will appear in the Domain dropdown menu. If you split out a subdomain which already has an Access application, you will need to re-save the Access application to associate it with the new child domain.

## Unsupported URLs

### Port numbers

Port numbers are not supported in Access application paths. If a request includes a port number in the URL, Access will strip the port number and redirect the request to the default HTTP/HTTPS port.

### Query strings

Query strings (such as?foo=bar) are not supported in Access application paths.

### Anchor links

Since anchor links are processed by the browser and not the server, Access applications do not support # characters in the URL. For example, requests to dashboard.com/#settings will redirect to dashboard.com.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Enforce MFA

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/access/mfa-requirements/](https://developers.cloudflare.com/cloudflare-one/policies/access/mfa-requirements/)

Page options # Enforce MFA

With Zero Trust policies, you can require that users log in to certain applications with specific types of multifactor authentication (MFA) methods. For example, you can create rules that only allow users to reach a given application if they authenticate with a physical hard key.

This feature is only available if you are using the following identity providers:

- Okta
- Microsoft Entra ID (formerly Azure AD)
- OpenID Connect (OIDC)
- SAML

To enforce an MFA requirement to an application:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Find the application for which you want to enforce MFA and select Configure. Alternatively, create a new application.
3. Go to Policies.
4. If your application already has a policy containing an identity requirement, find it and select Configure.
NoteThe policy should contain an Include rule that uses identity-based selectors. For example, the Include rule could allow users who are part of a rule group, email domain, or identity provider group.
5. Add the following rule to the policy:















Rule typeSelectorValueRequireAuthentication methodmfa - multiple-factor authentication
6. Save the policy.

Important

What happens if the user fails to present the required MFA method?

Cloudflare Access will reject the user, even if they successfully login to the identity provider with an alternative method.

## Adding authentication methods into the JWT

When users authenticate with their identity provider, the identity provider then shares their username with Cloudflare Access. Cloudflare Access then writes that value into the JSON Web Token (JWT) generated for the user.

Certain identity providers can also share the multifactor authentication (MFA) method presented by the user to login. Cloudflare Access can add these values into the JWT and force. For example, if the user authenticated with their password and a physical hard key, the identity provider can send a confirmation to Cloudflare Access.

Cloudflare Access then stores that method into the same JWT issued to the user.

Cloudflare Access follows RFC 8176 ‚Üó, Authentication Method Reference Values, to define authentication methods.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Temporary authentication

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/access/temporary-auth/](https://developers.cloudflare.com/cloudflare-one/policies/access/temporary-auth/)

Page options # Temporary authentication

With Cloudflare Access, you can require that users obtain approval before they can access a specific self-hosted application or SaaS application. The administrator will receive an email notification to approve or deny the request. Unlike a typical Allow policy, the user will have to request access at the end of each session. This allows you to define the users who should have persistent access and those who must request temporary access.

## Set up temporary authentication

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Choose a Self-hosted or SaaS application and select Configure.
3. Choose an Allow policy and select Configure.
4. Under Additional settings, turn on Purpose justification.
5. Turn on Temporary authentication.
6. Enter the Email addresses of the approvers.
NoteYour approvers must be authenticated by Access. If they do not have an active session, Access will verify their identity against your App Launcher Access policy.
7. Save the policy.

Temporary authentication is now enabled for users who match this policy. You can optionally add a second Allow policy for users who should have persistent access. Be sure the policy order is set to allow persistent users through.

## Temporary authentication requests

Approvers will receive a request similar to the example below. The approver can then grant access for a set amount of time, up to a maximum of 24 hours.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Browser Isolation

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/](https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/)

Page options # Browser Isolation

Cloudflare Browser Isolation complements the Secure Web Gateway and Zero Trust Network Access solutions by executing active webpage content in a secure isolated browser. Executing active content remotely from the endpoint protects users from zero-day attacks and malware. In addition to protecting endpoints, Browser Isolation also protects users from phishing attacks by preventing user input on risky websites and controlling data transmission to sensitive web applications. You can further filter isolated traffic with Gateway HTTP and DNS policies.

Remote browsing is invisible to the user who continues to use their browser normally without changing their preferred browser and habits. Every open tab and window is automatically isolated. When the user closes the isolated browser, their session is automatically deleted.

Note

Available as an add-on to Zero Trust Pay-as-you-go and Enterprise plans.

## Privacy

Cloudflare Browser Isolation is a security product. In order to serve transparent isolated browsing and block web based threats our network decrypts Internet traffic using the Cloudflare root CA. Traffic logs are retained as per the Zero Trust documentation.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Set up Browser Isolation

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/setup/](https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/setup/)

Page options # Set up Browser Isolation

Browser Isolation is enabled through Secure Web Gateway HTTP policies. By default, no traffic is isolated until you have added an Isolate policy to your HTTP policies.

## 1. Connect devices to Cloudflare

Setup instructions vary depending on how you want to connect your devices to Cloudflare. Refer to the links below to view the setup guide for each deployment option.

| Connection | Mode | Description |
| --- | --- | --- |
| Gateway with WARP | In-line | Apply identity-based HTTP policies to traffic proxied through the WARP client. |
| Access | In-line | Apply identity-based HTTP policies to Access applications that are rendered in a remote browser. |
| Gateway proxy endpoint | In-line | Apply non-identity HTTP policies to traffic forwarded to a proxy endpoint. |
| Magic WAN | In-line | Apply non-identity HTTP policies to traffic connected through a GRE or IPsec tunnel. |
| Clientless remote browser | Prefixed URL | Render web pages in a remote browser when users go to https://<your-team-name>.cloudflareaccess.com/browser/<URL>. |

## 2. Build an Isolation policy

To configure Browser Isolation policies:

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies > HTTP.
2. Select Add a policy and enter a name for the policy.
3. Use the HTTP policy selectors and operators to specify the websites or content you want to isolate.
4. For Action, choose either Isolate or Do not Isolate.
5. (Optional) Configure settings for an Isolate policy.
6. Select Create policy.

Next, verify that your policy is working.

## 3. Check if a web page is isolated

Users can see if a webpage is isolated by using one of the following methods:

- Select the padlock in the address bar and check for the presence of a Cloudflare Root CA.
- Right-click the web page and view the context menu options.

### Normal browsing

- A non-Cloudflare root certificate indicates that Cloudflare did not proxy this web page.
- The right-click context menu will have all of the normal options.

### Isolated browsing

- A Cloudflare root certificate indicates traffic was proxied through Cloudflare Gateway.
- The right-click context menu will be simplified.

#### Disconnect Browser Isolation

WARP users can temporarily disable remote browsing by disconnecting the WARP client.
Once WARP is disconnected, a refresh will return the non-isolated page.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Clientless Web Isolation

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/setup/clientless-browser-isolation/](https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/setup/clientless-browser-isolation/)

Page options # Clientless Web Isolation

Clientless Web Isolation allows users to securely browse high risk or sensitive websites in a remote browser without having to install the Cloudflare WARP client on their device.

## Set up Clientless Web Isolation

1. In Zero Trust ‚Üó, go to Settings > Browser Isolation.
2. Enable Clientless Web Isolation.

1. To configure permissions, in Settings > Browser Isolation > select Manage next to Permissions. You can add authentication methods and rules to control who can access the remote browser.
2. Under Policies > Access Policies > select Create new policy.
3. Name your policy and define who will have access to your isolated application. Refer to the Access policy documentation to construct your policy.
4. Select Save.
5. Under Policies > Access Policies > select Select existing policies and select the policy or policies you created in the previous step > select Confirm.
6. At the bottom of the page, select Save.

Your application will now be served in an isolated browser for users matching your policies.

### Open links in Browser Isolation

To open links using Browser Isolation:

1. In Zero Trust ‚Üó, go to Browser Isolation.
2. Select Launch isolated browser. Turn Clientless web isolation on.
3. In Launch browser, enter the URL link, and then select Launch. Your URL will open in a secure isolated browser.

## Filter DNS queries

Gateway filters and resolves DNS queries for isolated sessions via DNS policies. Enterprise users can resolve domains available only through private resolvers by creating resolver policies.

Gateway DNS and resolver policies will always apply to Clientless Web Isolation traffic, regardless of device configuration.

## Use the remote browser

Clientless Web Isolation is implemented through a prefixed URL, where <your-team-name> is your organization's team name.

```
https://<your-team-name>.cloudflareaccess.com/browser/<URL>
```

For example, to isolate www.example.com, users would visit https://<your-team-name>.cloudflareaccess.com/browser/https://www.example.com/ in their preferred browser.

If <url> is not provided, users are presented with a Cloudflare Zero Trust landing page where they can input a target URL or search for a website.

## Optional configurations

### Allow or block websites

When users visit a website through the Clientless Web Isolation URL, the traffic passes through Cloudflare Gateway. This allows you to apply HTTP policies to control what websites the remote browser can connect to, even if the user's device does not have WARP installed.

For example, if you use a third-party Secure Web Gateway to block example.com, users can still access the page in the remote browser by visiting https://<your-team-name>.cloudflareaccess.com/browser/https://www.example.com/. To block https://<your-team-name>.cloudflareaccess.com/browser/https://www.example.com/, create a Cloudflare Gateway HTTP policy to block example.com:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Domain | in | example.com | Block |

### Bypass TLS decryption

If TLS decryption is turned on, Gateway will decrypt all sites accessed through the Clientless Web Isolation URL. To connect to sites that are incompatible with TLS decryption, you will need to add a Do Not Inspect HTTP policy for the application or domain.

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Domain | is | mysite.com | Do Not Inspect |

Note

Clientless Web Isolation can function without TLS decryption enabled. However, TLS decryption is required to apply HTTP policies to Clientless Web Isolation traffic.

### Connect private networks

With Clientless Web Isolation, users can reach any internal web server you have connected through Cloudflare Tunnel. For more information, refer to Connect private networks.

For example, if you added 192.168.2.1 to your tunnel, users can connect to your application through the remote browser by going to https://<your-team-name>.cloudflareaccess.com/browser/http://192.168.2.1. Clientless Web Isolation also supports connecting over private ports, for example https://<your-team-name>.cloudflareaccess.com/browser/http://192.168.2.1:7148.

Note

All users with access to your remote browser can access your Cloudflare Tunnel applications unless you create a Gateway HTTP policy to block them.

### Disable remote browser controls

You can configure remote browser controls such as disabling copy/paste, printing, or keyboard input. These settings display in the Gateway HTTP policy builder when you select the Isolate action.

### Sync cookies between local and remote browser

The Cloudflare One Chrome extension allows a user to seamlessly access isolated and non-isolated applications without needing to re-authenticate. The user can log in once to their identity provider (whether through a Clientless Web Isolation link or their local browser) and gain access to all applications behind the SSO login.

Note

The Chrome extension is available in early access. To install, contact your account team.

## Address bar

Clientless Web Isolation has an embedded address bar. This feature is designed to improve the user's experience while visiting isolated pages with prefixed URLs.

The clientless address bar has three views: hostname notch, full address bar and hidden. The user's selected view is remembered across domains and remote browsing sessions.

### Hostname notch view

By default the isolated domain name appears in the notch positioned at the top and center of an isolated page.

Selecting Expand or the hostname text will expand the notch to the full address bar view. If isolated page content is obscured by the notch, expanding to the full address bar view will make the content accessible.

### Full address bar view

The full address bar allows users to search and go to isolated websites. Users can jump to the address bar at any time by pressing CTRL + L on the keyboard.

### Hidden view

To turn on or off the address bar, users can right-click on any isolated page and select Show / Hide address bar.

## Logs

- Authentication events: User login events are available in Access audit logs.
- HTTP requests: Traffic from the remote browser to the Internet is logged in Gateway activity logs.
- DNS queries: DNS queries from the remote browser are shown in Gateway activity logs.
- User actions: Track copy/paste, download/upload, and print actions initiated by users in the remote browser (only available in Logpush).

## Redirect traffic to the remote browser

If you want to isolate a website without Cloudflare WARP installed, you will need to redirect traffic to the Clientless Web Isolation prefixed URL. One way to do this is through a third-party Secure Web Gateway. To redirect users to the remote browser, you can implement a custom block page similar to the example shown below.

```
<!DOCTYPE html><html>  <head>    <title>Redirecting website to a remote browser</title>    <script>      window.location.href =        "https://<your-team-name>.cloudflareaccess.com/browser/<URL>}";    </script>    <noscript>      <meta        http-equiv="refresh"        content="0; url=https://<your-team-name>.cloudflareaccess.com/browser/<URL>"      />    </noscript>  </head>  <body>    <p>      This website is being redirected to a remote browser. Select      <a href="https://<your-team-name>.cloudflareaccess.com/browser/<URL>"        >here</a      >      if you are not automatically redirected.    </p>  </body></html>
```

## Troubleshooting

Review troubleshooting guidance related to Clientless Web Isolation.

- Clientless Web Isolation is loading a blank screen on a Windows device

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Non-identity on-ramps

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/setup/non-identity/](https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/setup/non-identity/)

Page options # Non-identity on-ramps

With Cloudflare Zero Trust, you can isolate HTTP traffic from on-ramps such as proxy endpoints or Magic WAN. Since these on-ramps do not require users to log in to Cloudflare WARP, identity-based policies are not supported.

Note

If you want to apply Isolate policies based on user identity, you will need to either install the WARP client or manually redirect users to the Clientless Web Isolation URL.

## Set up non-identity browser isolation

1. Install a Cloudflare certificate on your devices.
2. Connect your infrastructure to Gateway using one of the following on-ramps:

Configure your browser to forward traffic to a Gateway proxy endpoint with PAC files.
Connect your enterprise site router to Gateway with the anycast GRE or IPsec tunnel on-ramp to Magic WAN.
3. Configure your browser to forward traffic to a Gateway proxy endpoint with PAC files.
4. Connect your enterprise site router to Gateway with the anycast GRE or IPsec tunnel on-ramp to Magic WAN.
5. Enable non-identity browser isolation:

In Zero Trust ‚Üó, go to Settings > Browser Isolation.
Turn on Non-identity on-ramp support.
6. In Zero Trust ‚Üó, go to Settings > Browser Isolation.
7. Turn on Non-identity on-ramp support.
8. Build a non-identity HTTP policy to isolate websites in a remote browser.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Isolation policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/isolation-policies/](https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/isolation-policies/)

Page options # Isolation policies

With Browser Isolation, you can define policies to dynamically isolate websites based on identity, security threats, or content.

## Isolate

When an HTTP policy applies the Isolate action, the user's web browser is transparently served an HTML compatible remote browser client. Isolation policies can be applied to requests that include Accept: text/html*. This allows Browser Isolation policies to co-exist with API traffic.

The following example enables isolation for all web traffic:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Host | matches regex | .* | Isolate |

If instead you need to isolate specific pages, you can list the domains for which you would like to isolate traffic:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Domain | In | example.com, example.net | Isolate |

Isolate identity providers for applications

Existing cookies and sessions from non-isolated browsing are not sent to the remote browser. Websites that implement single sign-on using third-party cookies will also need to be isolated.

For example, if example.com authenticates using Google Workspace, you will also need to isolate the top level Google Workspace URLs ‚Üó.

## Do Not Isolate

You can choose to disable isolation for certain destinations or categories. The following configuration disables isolation for traffic directed to example.com:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Host | In | example.com | Do Not Isolate |

## Policy settings

The following optional settings appear in the Gateway HTTP policy builder when you select the Isolate action. Configure these settings to prevent data loss ‚Üó when users interact with untrusted websites in the remote browser.

### Copy (from remote to client)

```
flowchart LR
			subgraph remotebrowser[Remote browser]
        siteA["Isolated
				website"]--Data-->remoteclip["Remote
				clipboard"]
      end
			subgraph client[Client]
        localclip["Local
				clipboard"]
      end
			remoteclip-->localclip
```

- Allow: (Default) Users can copy content from an isolated website to their local clipboard.
- Allow only within isolated browser: Users can only copy content from an isolated website to the remote clipboard. Users cannot copy content out of the remote browser to the local clipboard. You can use this setting alongside Paste (from client to remote): Allow only within isolated browser to only allow copy-pasting between isolated websites.
- Do not allow: Prohibits users from copying content from an isolated website.

### Paste (from client to remote)

```
flowchart LR
			subgraph client[Client]
        localclip["Local
				clipboard"]
      end
			subgraph remotebrowser[Remote browser]
				remoteclip["Remote
				clipboard"]-->siteA["Isolated
				website"]
      end
			localclip--Data-->remoteclip
```

- Allow: (Default) Users can paste content from their local clipboard to an isolated website.
- Allow only within isolated browser: Users can only paste content from the remote clipboard to an isolated website. Users cannot paste content from their local clipboard to the remote browser. You can use this setting alongside Copy (from remote to client): Allow only within isolated browser to only allow copy-pasting between isolated websites.
- Do not allow: Prohibits users from pasting content into an isolated website.

### File downloads

- Allow: (Default) User can download files from an isolated website to their local machine.
- Do not allow: Prohibits users from downloading files from an isolated website to their local machine.

Note

This option does not prevent files from being downloaded into the remote browser. To prevent files being downloaded into the remote browser, use HTTP Policies to block by Download Mime Type.

### File uploads

- Allow: (Default) Users can upload files from their local machine into an isolated website.
- Do not allow: Prohibits users from uploading files from their local machine into an isolated website.

Note

This option does not prevent files being uploaded to websites from third-party cloud file managers or files downloaded into the remote browser download bar from other isolated websites. To prevent files being uploaded from the remote browser into an isolated website, use HTTP Policies to block by Upload Mime Type.

### Keyboard

- Allow: (Default) Users can perform keyboard inputs into an isolated website.
- Do not allow: Prohibits users from performing keyboard inputs into an isolated website.

Note

Mouse input remains available to allow users to browse a website by following hyperlinks and scrolling. This does not prevent user input into third-party virtual keyboards within an isolated website.

### Printing

- Allow: (Default) Users can print isolated web pages to their local machine.
- Do not allow: Prohibits users from printing isolated web pages to their local machine.

## Custom block dialog Beta

With custom block dialogs, you can host a custom block page when users are blocked from taking specific actions, like copying, pasting, downloading, uploading, performing keyboard inputs, or printing, within an isolated browser session.

Administrators can configure custom block dialogs to explain the reason for the block, and guide the users on how to resolve their issue using the provided query parameters:

- action: copy, paste, download, upload, perform keyboard inputs, and print
- cf_colo: for example, sea01
- client_url: for example, https://example.com
- policy_id: 32-character id
- rbi_debug_id: 32-character id
- user_id: 32-character id

Custom block dialogs are still in beta. Contact your account team to start using custom block dialogs.

## Common policies

### Isolate all security threats

Isolate security threats such as malware and phishing.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Security Categories | in | All security risks | Isolate |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Isolate all security threats",    "description": "Isolate security threats such as malware and phishing",    "enabled": true,    "action": "isolate",    "filters": [        "http"    ],    "traffic": "any(http.request.uri.security_category[*] in {68 178 80 83 176 175 117 131 134 151 153})",    "identity": "",    "device_posture": ""  }'
```

### Isolate high risk content

Isolate high risk content categories such as newly registered domains.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | Security Risks | Isolate |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Isolate high risk content",    "description": "Isolate high risk content categories such as newly registered domains",    "enabled": true,    "action": "isolate",    "filters": [        "http"    ],    "traffic": "any(http.request.uri.content_category[*] in {32 169 177 128})",    "identity": "",    "device_posture": ""  }'
```

### Isolate news and media

Isolate news and media sites, which are targets for malvertising attacks.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | News and Media | Isolate |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Isolate news and media",    "description": "Isolate news and media sites, which are targets for malvertising attacks",    "enabled": true,    "action": "isolate",    "filters": [        "http"    ],    "traffic": "any(http.request.uri.content_category[*] in {122})",    "identity": "",    "device_posture": ""  }'
```

### Isolate uncategorized content

Isolate content that has not been categorized by Cloudflare Radar.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | not in | All content categories | Isolate |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Isolate uncategorized content",    "description": "Isolate content not categorized by Cloudflare Radar",    "enabled": true,    "action": "isolate",    "filters": [        "http"    ],    "traffic": "not(any(http.request.uri.content_category[*] in {2 67 125 133 3 75 183 89 182 6 90 91 144 150 7 70 74 76 79 92 96 100 106 107 116 120 121 122 127 139 156 164 99 9 101 137 10 103 146 11 12 77 98 108 110 111 118 126 129 172 168 113 33 179 166 15 115 119 124 141 161 17 85 87 102 157 135 138 180 162 140 142 32 169 177 128 22 73 82 88 148 23 24 181 71 72 173 78 84 86 94 97 104 105 114 174 93 130 132 136 147 149 154 158 152 26 69 184 81 95 109 123 145 155 159 160 163 165 167}))",    "identity": "",    "device_posture": ""  }'
```

### Isolate ChatGPT

Isolate the use of ChatGPT.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Application | in | ChatGPT | Isolate |

In Configure policy settings, you can customize restrictions for ChatGPT. For example, to prevent your users from inputting sensitive information, you can select Disable copy / paste and Disable file uploads.

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Isolate ChatGPT",    "description": "Isolate the use of ChatGPT",    "enabled": true,    "action": "isolate",    "filters": [        "http"    ],    "traffic": "any(app.ids[*] in {1199})",    "identity": "",    "device_posture": ""  }'
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Extensions

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/extensions/](https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/extensions/)

Page options # Extensions

Browser Isolation supports running native Chromium Web Extensions in the remote browser.

This capability allows extending tools that require DOM access (such as password managers and ad blockers) to isolated pages.

## Install an extension inside the remote browser

### Prerequisite: Isolate Chrome Web Store

Note

This step is not required when browsing via Clientless Web Isolation. You can access the Chrome Web Store at https://<authdomain>.cloudflareaccess.com/browser/https://chrome.google.com/webstore.

Installing extensions requires Chrome Web Store isolation. Create an HTTP policy to isolate the Chrome Web Store (chrome.google.com).

### Install an extension

1. Go to https://chrome.google.com/webstore while isolated.
2. Choose your desired extension.
3. Select Add to Chrome. To confirm extension installation, select Add extension.

Remote browser extensions are automatically reinstalled across isolated sessions.

## Remove an extension from the remote browser

1. Go to any isolated webpage.
2. Right-click anywhere to open the context menu and select Show isolation toolbar.
3. Select the jigsaw icon in the isolation toolbar to open the extension manager.
4. Select the hamburger icon for the desired extension to open the extension controls.
5. Select Remove from Chromium. To confirm removal, select Remove.

## Useful extensions

### Modify remote browser user agent

User-Agent Switcher for Chrome ‚Üó enables controlling the User Agent sent from the remote browser to an isolated website.

### Control remote browser request headers

ModHeader ‚Üó enables controlling arbitrary request headers sent from the remote browser to an isolated website.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Accessibility

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/accessibility/](https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/accessibility/)

Page options # Accessibility

Browser Isolation offers features to support users who have visual impairments or non-English language requirements.

## Screen reader

The isolated browser has a built-in screen reader which speaks out loud the content of the isolated page.

### Turn the screen reader on or off

To turn the built-in screen reader on or off, right-click on any isolated page and select Accessibility > Enable / Disable screen reader.

Alternatively, to use a keyboard shortcut, press CTRL + ALT + Z.

## Languages

The isolated browser supports keyboard inputs in all languages. Users can use their native keyboard to type in languages that use diacritics (for example, √° or√ß) or character-based scripts (for example, Chinese, Japanese, or Korean).

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Browser Isolation with firewall

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/network-dependencies/](https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/network-dependencies/)

Page options # Browser Isolation with firewall

If your organization uses a firewall or other policies to restrict Internet traffic, you may need to make a few changes to allow Browser Isolation to connect.

## Remoting client

Isolated pages are served by the remoting client. This client communicates to Cloudflare's network via HTTPS and WebRTC.

### Remoting Client (Services)

The remoting client provides static assets and API endpoints. For Browser Isolation to function, you must allow:

- HTTPS traffic to *.browser.run on port 443

#### Clientless Web Isolation

Users connecting through Clientless Web Isolation also require connectivity to Cloudflare Access. For users to connect to Access, you must allow:

- HTTPS traffic to https://<team-name>.cloudflareaccess.com on port 443

### WebRTC channel

Browser Isolation uses WebRTC for low-latency communication between the local browser and the remote browser.

In order to pass WebRTC traffic, the remoting client must be able to connect to the following IP addresses:

| IP range | Port range | Protocol |
| --- | --- | --- |
| IPv4: 162.159.201.10 - 162.159.201.255  IPv6: 2606:4700:f2::/48 | 10000 - 59999 | UDP |

Each remote browser instance is randomly assigned a port, and the port that a user is allocated to will change often and without notice.

Note

WebRTC traffic does not flow through proxies specified in local browser HTTP/HTTPS proxy settings. The connecting device needs to be able to directly connect to the WebRTC IP ranges.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Known limitations

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/known-limitations/](https://developers.cloudflare.com/cloudflare-one/policies/browser-isolation/known-limitations/)

Page options # Known limitations

Below, you will find information regarding the current limitations for Browser Isolation.

## Website compatibility

Our Network Vector Rendering (NVR) technology allows us to deliver a secure remote computing experience without the bandwidth limitations of video streams. While we expect most websites to work perfectly, some browser features and web technologies are unsupported and will be implemented in the future:

- Webcam and microphone support is unavailable.
- Websites that use WebGL may not function. To turn off WebGL in the browser, refer to WebGL Rendering Error.
- Netflix and Spotify Web Player are unavailable.

## Browser compatibility

| Browser | Compatibility |
| --- | --- |
| Google Chrome | ‚úÖ |
| Mozilla Firefox | ‚úÖ |
| Safari | ‚úÖ |
| Microsoft Edge (Chromium-based) | ‚úÖ |
| Other Chromium-based browsers (Opera, Brave) | ‚úÖ |
| Internet Explorer 11 and below | ‚ùå |

### Brave

Brave‚Äôs WebRTC IP Handling Policy can impact how Cloudflare RBI loads and functions. If the WebRTC IP Handling Policy is configured to Disable Non-Proxied UDP, RBI may fail to load correctly.

To ensure RBI loads correctly, go to brave://settings/privacy in your Brave browser window, find WebRTC IP Handling Policy, and change the setting from Disable Non-Proxied UDP to one of the following:

- Default
- Default Public and Private Interfaces
- Default Public Interface Only

## Protocol support

Browser Isolation does not support HTTP.

## Virtual machines

Browser Isolation is not supported in virtualized environments (VMs).

## Gateway selectors

Certain selectors for Gateway HTTP policies bypass Browser Isolation, including:

- Destination Continent IP Geolocation
- Destination Country IP Geolocation
- Destination IP

You cannot use these selectors to isolate traffic and isolation matches for these selectors will not appear in your Gateway logs. Additionally, you cannot apply other policies based on these selectors while in isolation. For example, if you have a Block policy that matches traffic based on destination IP, Gateway will not block the matching traffic if it is already isolated by an Isolate policy.

## File download size

When a user downloads a file within the remote browser, the file is held in memory and destroyed at the end of the remote browser session. Therefore, the total size of files downloaded per session is shared with the amount of memory available to the remote browser. We recommend a maximum individual file size of 512 MB.

## Multifactor authentication

Clientless Web Isolation does not support Yubikey or WebAuthN. These authentication technologies require the isolated website to use the same domain name as the non-isolated website. Therefore, they will not work with prefixed Clientless Web Isolation URLs but will work normally for in-line deployments such as isolated Access applications.

## SAML applications

Cloudflare Remote Browser Isolation now supports SAML applications that use HTTP-POST bindings. This resolves previous issues such as 405 errors and login loops during SSO authentication flows.

You no longer need to isolate both the Identity Provider (IdP) and Service Provider (SP), or switch to HTTP-Redirect bindings, to use Browser Isolation with POST-based SSO. Users can log in to internal or SaaS applications in the isolated browser securely and seamlessly.

Clientless Web Isolation may still be preferred in some deployment models. Clientless Web Isolation implicitly isolates all traffic (both IdP and SP) and supports HTTP-POST SAML bindings.

## Browser Isolation is not compatible with private IPs on non-443 ports

Browser Isolation is not compatible with self-hosted private applications that use private IP addresses on ports other than 443. Trying to access self-hosted applications defined by private IPs on ports other than 443 will result in a Gateway block page.

To use Browser Isolation for an application on a private IP address with a non-443 port, configure a private network application instead.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Data Loss Prevention

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/](https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/)

Page options # Data Loss Prevention

Availability

Available as an add-on to Zero Trust Enterprise plans.

Users on Zero Trust Free and Pay-as-you-go plans can use the Financial Information and Social Security, Insurance, Tax, and Identifier Numbers predefined profiles, payload logging, and false positive reporting.

Cloudflare Data Loss Prevention (DLP) allows you to scan your web traffic and SaaS applications for the presence of sensitive data such as social security numbers, financial information, secret keys, and source code.

To prevent interference, Cloudflare does not write scanned content to disk. Instead, DLP only encrypts and temporarily stores content in memory. Optionally, you can configure payload logging to store encrypted copies of payloads from matching HTTP requests or a Logpush destination to export entire matching HTTP requests.

## Data in transit

Data Loss Prevention complements Secure Web Gateway to detect sensitive data transferred in HTTP requests. DLP scans the entire HTTP body, which may include uploaded or downloaded files, chat messages, forms, and other web content. You can also use DLP with Email Security to scan outbound emails.

DLP requires Gateway HTTP filtering with TLS decryption for visibility into data in transit. The depth of visibility varies for each site or application. DLP does not scan any traffic that bypasses Cloudflare Gateway (such as traffic that matches a Do Not Inspect policy).

To get started, refer to Scan HTTP traffic with DLP.

## Data at rest

Data Loss Prevention complements Cloudflare CASB to detect sensitive data stored in your SaaS applications. Unlike data in transit scans which read files sent through Cloudflare Gateway, CASB retrieves files directly via the API. Therefore, Gateway and WARP settings (such as Do Not Inspect policies and Split Tunnel configurations) will not affect data at rest scans.

To get started, refer to Scan SaaS applications with DLP.

## Supported file types

### Formats

DLP supports scanning the following file types:

- Text and CSV
- Microsoft Office 2007 and later (.docx, .xlsx, .pptx), including Microsoft 365
- PDF
- ZIP files containing the above

DLP will scan the text contained in Microsoft Office and PDF files.

### Size

The maximum file size is 100 MB. Size limitation is assessed against the file after unzipping. ZIP files can be recursively compressed a maximum of 10 times.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Scan HTTP traffic

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-policies/](https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-policies/)

Page options # Scan HTTP traffic

You can scan HTTP traffic for sensitive data through Secure Web Gateway policies. To perform DLP filtering, first configure a DLP profile with the data patterns you want to detect, and then build a Gateway HTTP policy to allow or block the sensitive data from leaving your organization. Gateway will parse and scan your HTTP traffic for strings matching the keywords or regular expressions (regexes) specified in the DLP profile.

## Prerequisites

- Set up Gateway HTTP filtering.

HTTP filtering requires turning on the Gateway proxy for TCP traffic.
- HTTP filtering requires turning on the Gateway proxy for TCP traffic.
- Turn on TLS decryption.

## 1. Configure a DLP profile

Refer to Configure a DLP profile. We recommend getting started with a predefined profile.

Important

DLP scans will not start until you create a DLP policy.

## 2. Create a DLP policy

DLP Profiles may be used alongside other Zero Trust rules in a Gateway HTTP policy. To start logging or blocking traffic, create a policy for DLP:

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies. Select HTTP.
2. Select Add a policy.
3. Build an HTTP policy using the DLP Profile selector. For example, the following policy prevents users from uploading sensitive data to any location other than an approved corporate application:

































SelectorOperatorValueLogicActionDLP ProfileinSocial Security, Insurance, Tax, and Identifer NumbersAndBlockHTTP MethodinPOSTAndApplicationnot inWorkday
4. Select Create policy.

DLP scanning is now turned on.

## 3. Test DLP policy

You can test your DLP policy on any device connected to your Zero Trust organization. To perform a basic test:

1. Go to dlptest.com ‚Üó.
2. Enter a text message or upload a file containing the sensitive data.
3. Select Submit to send the request.

The request will be allowed or blocked according to your DLP policies. If the data matches a DLP policy, you will see the request in your DLP logs.

Different sites will send requests in different ways. For example, some sites will split a file upload into multiple requests. Therefore, even if the policy works on dlptest.com, it is not guaranteed to work the same way on another site or application.

## 4. View DLP logs

1. In Zero Trust ‚Üó, go to Logs > Gateway > HTTP.
2. Select Filter.
3. Choose an item under one of the following filters:

DLP Profiles shows the requests which matched a specific DLP profile.
Policy shows the requests which matched a specific DLP policy.
4. DLP Profiles shows the requests which matched a specific DLP profile.
5. Policy shows the requests which matched a specific DLP policy.

You can expand an individual row to view details about the request. To see the data that triggered the DLP policy, configure logging options.

### Report false positives

1. Select the log you want to report.
2. Select Report DLP false positive under DLP details.
3. The information to be sent to Cloudflare will appear. To confirm your report, select Send report.

Cloudflare will not respond directly to your report, but reporting false positives helps us improve our products. If you require technical assistance, reach out to support ‚Üó.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Common policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-policies/common-policies/](https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-policies/common-policies/)

Page options # Common policies

The following in-line DLP policies are commonly used to secure data in uploaded and downloaded files.

## Log uploads/downloads

The Allow action functions as an implicit logger, providing visibility into where your sensitive data is going without impacting the end user experience. The following example scans for your enabled Financial Information profile entries when users upload or download data to file sharing apps.

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| DLP Profile | in | Financial Information | And | Allow |
| Content Categories | in | File Sharing |  |  |

## Block file types

Block the upload or download of files based on their type.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Upload File Types | in | Microsoft Office Word Document (docx) | And | Block |
| Download File Types | in | PDF (pdf) |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block file types",    "description": "Block the upload or download of files based on their type",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(http.upload.file.types[*] in {\"docx\"}) and any(http.download.file.types[*] in {\"pdf\"})",    "identity": "",    "device_posture": ""  }'
```

For more information on what file formats DLP can scan, refer to Supported file types.

## Block uploads/downloads for specific users

You can configure access on a per-user or group basis by adding identity-based conditions to your policies. The following example blocks only contractors from uploading/downloading Financial Information to file sharing apps.

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| DLP Profile | in | Financial Information | And | Block |
| Content Categories | in | File Sharing | And |  |
| User Group Names | in | Contractors |  |  |

## Exclude Android applications

Many Android applications (such as Google Drive) use certificate pinning, which is incompatible with Gateway inspection. If needed, you can create a Do Not Inspect policy so that the app can continue to function on Android:

1. Set up an OS version device posture check that checks for the Android operating system.
2. Create the following HTTP policy in Gateway:


























SelectorOperatorValueLogicActionApplicationinGoogle DriveAndDo Not InspectPassed Device Posture ChecksinOS Version Android

Android users can now use the app, but the app traffic will bypass DLP scanning.

## Exclude specific sites

In your DLP logs, you may find that certain sites are a common source of noise. To exempt these sites from DLP scanning:

1. Create a list of hostnames or URLs.
2. Exclude the list from your DLP policy as shown in the example below:

































SelectorOperatorValueLogicActionDLP ProfileinFinancial InformationAndBlockApplicationinGoogle DriveAndDomainnot in listDo not DLP - SSN

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Logging options

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-policies/logging-options/](https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-policies/logging-options/)

Page options # Logging options

Data Loss Prevention allows you to capture, store, and view the data that triggered a specific DLP policy for use as forensic evidence. Users on all plans can log the payload or generative AI prompt content of matched HTTP requests in their Cloudflare logs. Additionally, Enterprise users can configure a Logpush job to send copies of entire matched HTTP requests to storage destinations.

The data that triggers a DLP policy is stored in the portion of the HTTP request known as the payload. Payload logging is especially useful when diagnosing the behavior of DLP policies. Since the values that triggered a rule may contain sensitive data, they are encrypted with a customer-provided public key so that only you can examine them later. The stored data will include a redacted version of the match, plus 75 bytes of additional context on both sides of the match.

## Set a DLP payload encryption public key

Before you begin logging DLP payloads, you will need to set a DLP payload encryption public key.

### Generate a key pair

To generate a public/private key pair in the command line, refer to these instructions.

### Upload the public key to Cloudflare

1. In Zero Trust ‚Üó, go to Settings > Network.
2. In the DLP Payload Encryption public key field, paste your public key.
3. Select Save.

Note

The matching private key is required to view logs. If you lose your private key, you will need to generate and upload a new public key. The payload of new requests will be encrypted with the new public key.

## Log the payload of matched rules

DLP can log the payload of matched HTTP requests in your Cloudflare logs.

### Turn on payload logging for a DLP policy

You can enable payload logging for any Allow or Block HTTP policy that uses the DLP Profile selector.

1. Go to Gateway > Firewall policies > HTTP.
2. Edit an existing Allow or Block DLP policy, or create a new policy.
3. In the policy builder, scroll down to Configure policy settings and turn on Log the payload of matched rules.
4. Select Save.

Data Loss Prevention will now store a portion of the payload for HTTP requests that match this policy.

### View payload logs

To view DLP payload logs:

1. Go to Logs > Gateway > HTTP.
2. Go to the DLP log you are interested in reviewing and expand the row.
3. Select Decrypt payload log.
4. Enter your private key and select Decrypt.

You will see the ID of the matched DLP Profile followed by the decrypted payload.

Note

Cloudflare does not store the key or the decrypted payload.

### Report false and true positives to AI context analysis

When you have AI context analysis turned on for a DLP profile, you can train the AI model to adjust its confident threshold by reporting false and true positives.

To report a DLP match payload as a false or true positive:

1. Find and decrypt the payload log you want to report.
2. In Log details, choose a detected context match.
3. In Context, select the redacted match data.
4. In Match details, choose whether you want to report the match as a false positive or a true positive.

Based on your report, DLP's machine learning will adjust its confidence in future matches for the associated profile.

### Data privacy

- All Cloudflare logs are encrypted at rest. Encrypting the payload content adds a second layer of encryption for the matched values that triggered a DLP rule.
- Cloudflare cannot decrypt encrypted payloads, since this operation requires your private key. Cloudflare staff will never ask for the private key.
- DLP will redact all predefined alphanumeric characters in the log. For example, 123-45-6789 will become XXX-XX-XXXX.

You can define sensitive data with Exact Data Match (EDM). EDM match logs will redact your defined strings.
- You can define sensitive data with Exact Data Match (EDM). EDM match logs will redact your defined strings.

## Log generative AI prompt content

DLP can detect and log the prompt topic sent to an AI tool.

### Turn on AI prompt content logging for a DLP policy

You can enable payload logging for any Allow or Block HTTP policy that uses the Application selector with a supported Application Granular Controls application.

1. Go to Gateway > Firewall policies > HTTP.
2. Edit an existing Allow or Block DLP policy, or create a new policy.
3. In the policy builder, scroll down to Configure policy settings and turn on Capture generative AI prompt content in logs.
4. Select Save.

Data Loss Prevention will now store the user prompt and AI model response for requests that match this policy.

### View prompt logs

To view generative AI prompt log details:

1. Go to Logs > Gateway > HTTP.
2. Go to the DLP log you are interested in reviewing and expand the row.
3. Select Decrypt payload log.
4. Enter your private key and select Decrypt.
5. In Summary > GenAI prompt captured, select View prompt.

Gateway logs will provide a summary of the conversation, including the topic and AI model used, and the user prompt and AI model's raw response if available. A text prompt must be present for DLP to capture the prompt.

## Send DLP forensic copies to Logpush destination

Availability

Only available on Enterprise plans.

Gateway allows you to send copies of entire HTTP requests matched in HTTP Allow and Block policies to storage destinations configured in Logpush, including third-party destinations. Forensic copies include unaltered payloads and headers which may include sensitive data. Logpush logs are encrypted in transit only, such as when sent as TLS traffic. Further encryption depends on your storage destination's policies.

To set up the DLP Forensic Copy Logpush job:

1. In Zero Trust ‚Üó, go to Logs > Logpush.
2. If this is your first Logpush job, select Add a Logpush job. Otherwise, select Go to logpush configurations.
3. In Logpush, select Create a Logpush job.
4. Choose a Logpush destination.
5. In Configure logpush job, choose the DLP forensic copies dataset. Select Create Logpush job.
6. Return to Zero Trust and go to Gateway > Firewall policies > HTTP.
7. Edit an existing Allow or Block policy, or create a new policy. Your policy does not need to include a DLP profile.
8. In the policy builder, scroll down to Configure policy settings and turn on Send DLP forensic copies to storage.
9. Select a storage destination. Gateway will list any configured Logpush jobs or integrations that can receive HTTP requests.
10. Select Save policy.

DLP will now send a copy of HTTP requests that match this policy to your Logpush destination.

Logpush supports up to four DLP Forensic Copy Logpush jobs per account. By default, Gateway will send all matched HTTP requests to your configured DLP Forensic Copy jobs. To send specific policy matches to specific jobs, configure Log filters. If the request contains an archive file, DLP will only send up to 100 MB of uncompressed content to your configured storage.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## DLP profiles

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-profiles/](https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-profiles/)

Page options # DLP profiles

A DLP profile is a collection of regular expressions and detection entries that define the data patterns you want to detect. Cloudflare DLP provides predefined profiles for common detections, or you can build custom DLP profiles specific to your data, organization, and risk tolerance.

## Configure a predefined profile

1. In Zero Trust ‚Üó, go to Data loss prevention > DLP profiles.
2. Choose a predefined profile and select Configure.
3. Enable one or more Detection entries according to your preferences. The DLP Profile matches using the OR logical operator ‚Äî if multiple entries are enabled, your data needs to match only one of the entries.
4. Select Save profile.

You can now use this profile in a DLP policy or CASB integration.

## Build a custom profile

1. In Zero Trust ‚Üó, go to Data loss prevention > DLP profiles.
2. Select Create profile.
3. Enter a name and optional description for the profile.
4. Add custom or existing detection entries.
 Add a custom entry
 

Select Add custom entry and give it a name.


In Value, enter a regular expression (or regex) that defines the text pattern you want to detect. For example, test\d\d will detect the word test followed by two digits.

Regular expressions are written in Rust. We recommend validating your regex with Rustexp ‚Üó.
DLP detects UTF-8 characters, which can be up to 4 bytes each. Custom text pattern detections are limited to 1024 bytes in length.
DLP does not support regular expressions with + or * operators because they are prone to exceeding the length limit. For example, the regex pattern a+ can detect an infinite number of a characters. We recommend using a{min,max} instead, such as a{1,1024}.



To save the detection entry, select Done.

 
 Add existing entries
 Existing entries include predefined and user-defined detection entries.
Select Add existing entries.
Choose which entries you want to add, then select Confirm.
To save the detection entry, select Done.
5. Select Add custom entry and give it a name.
6. In Value, enter a regular expression (or regex) that defines the text pattern you want to detect. For example, test\d\d will detect the word test followed by two digits.

Regular expressions are written in Rust. We recommend validating your regex with Rustexp ‚Üó.
DLP detects UTF-8 characters, which can be up to 4 bytes each. Custom text pattern detections are limited to 1024 bytes in length.
DLP does not support regular expressions with + or * operators because they are prone to exceeding the length limit. For example, the regex pattern a+ can detect an infinite number of a characters. We recommend using a{min,max} instead, such as a{1,1024}.
7. Regular expressions are written in Rust. We recommend validating your regex with Rustexp ‚Üó.
8. DLP detects UTF-8 characters, which can be up to 4 bytes each. Custom text pattern detections are limited to 1024 bytes in length.
9. DLP does not support regular expressions with + or * operators because they are prone to exceeding the length limit. For example, the regex pattern a+ can detect an infinite number of a characters. We recommend using a{min,max} instead, such as a{1,1024}.
10. To save the detection entry, select Done.
11. Select Add existing entries.
12. Choose which entries you want to add, then select Confirm.
13. To save the detection entry, select Done.
14. (Optional) Configure profile settings for the profile.
15. Select Save profile.

You can now use this profile in a DLP policy or CASB integration.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Predefined profiles

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-profiles/predefined-profiles/](https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-profiles/predefined-profiles/)

Page options # Predefined profiles

Cloudflare Zero Trust provides predefined DLP profiles for common types of sensitive data. Some profiles include built-in validation checks to increase detection granularity. Additionally, you can configure advanced settings for predefined profiles.

## Credentials and Secrets

The following secrets are validated with regex.

- Google Cloud Platform keys
- AWS keys
- Azure API keys
- SSH keys

## Financial Information

Availability

This predefined profile is available on all Zero Trust plans.

Credit card numbers begin with a six or eight-digit Issuer Identification Number (IIN) and are followed by up to 23 additional digits. Card verification values (CVVs) are not validated.

| Detection entry | Notes |
| --- | --- |
| American Express Card Number | Validated using Luhn's algorithm ‚Üó. |
| American Express Text | Text matching amex or american express. |
| Diners Club Card Number | Validated using Luhn's algorithm. |
| Generic CVV Card Number | Validated with regex. |
| Mastercard Card Number | Validated using Luhn's algorithm. |
| Mastercard Text | Text matching mastercard. |
| Union Pay Card Number | Validated using Luhn's algorithm. |
| Union Pay Text | Text matching union pay. |
| Visa Card Number | Validated using Luhn's algorithm. |
| Visa Text | Text matching visa. |
| United States ABA Routing Number | Validated algorithmically with checksum. |
| IBAN | Validated with checksum. |

## Health Information

The following diagnosis and medication names are checked for surrounding ASCII characters to prevent false positives.

- FDA active ingredients
- FDA drug names
- ICD-10 FY2023 short descriptions

## Social Security, Insurance, Tax, and Identifier Numbers

Availability

This predefined profile is available on all Zero Trust plans.

The following national identifier detections are validated algorithmically when possible.

| Detection entry | Notes |
| --- | --- |
| United States SSN Numeric Detection | Commonly used separators are required to match the detection entry. For example, 000-00-0000 matches but 000000000 does not. Social security numbers do not adhere to algorithmic validation. |
| Social Security Number Text | Text matching ssn or social security. |
| Australia Tax File Number | Validated with checksum. |
| Canada Social Insurance Number | Validated using Luhn's algorithm. |
| France Social Security Number | Validated with regex. |
| Hong Kong Identity Card (HKIC) Number | Validated with checksum. |
| Indonesia Identity Card Number | Validated with regex. |
| Malaysian National Identity Card Number | Validated with regex. |
| Philippines Unified Multi-Purpose ID (UMID) Number | Validated with regex. |
| Singapore National Registration Identity Card Number | Validated with checksum. |
| Taiwan National Identification Number | Validated with checksum. |
| Thai Identity Card Number | Validated with checksum. |
| United Kingdom NHS Number | Validated with checksum. |
| United Kingdom National Insurance Number | Validated with regex. |

## Source Code

The following programming languages are validated with natural language processing (NLP).

- C
- C++
- C#
- Go
- Haskell
- Java
- JavaScript
- Lua
- Python
- R
- Rust
- Swift

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Integration profiles

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-profiles/integration-profiles/](https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-profiles/integration-profiles/)

Page options # Integration profiles

Note

Integration profiles require Cloudflare CASB.

Cloudflare DLP integration profiles enable data loss prevention support for third-party data classification providers. Data classification information is retrieved from the third-party platform and populated into a DLP Profile. You can then enable detection entries in the profile and create a DLP policy to allow or block matching data.

Detection entries in integration profiles are managed by the third-party platform and cannot be manually added, edited, or deleted within Cloudflare DLP.

## Microsoft Purview Information Protection (MIP) sensitivity labels

Microsoft provides Purview Information Protection sensitivity labels ‚Üó to classify and protect sensitive data.

### Setup

To add MIP sensitivity labels to a DLP Profile, simply integrate your Microsoft account with Cloudflare CASB. A new integration profile will appear under Data loss prevention > DLP profiles. The profile is named MIP Sensitivity Labels followed by the name of the CASB integration.

MIP sensitivity labels can also be added to a custom DLP profile as an existing entry.

### Syncing

Allow 24 hours for label additions and edits in your Microsoft account to propagate to Cloudflare DLP. At this time, deletions in your Microsoft account will not delete entries in your Cloudflare DLP Profile.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Profile settings

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-profiles/advanced-settings/](https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/dlp-profiles/advanced-settings/)

Page options # Profile settings

This page lists the profile settings available when configuring a predefined or custom DLP profile. You can configure profile settings when you create a custom profile or edit profile settings for an existing predefined or custom profile.

## Edit profile settings

To edit profile settings for an existing predefined or custom DLP profile:

1. In Zero Trust ‚Üó, go to Data loss prevention > DLP profiles.
2. Choose a profile, then select Edit.
3. In Settings, configure the settings for your profile.
4. Select Save profile.

## Available settings

The following advanced detection settings are available for predefined and custom DLP profiles.

### Match count

Match count refers to the number of times that any enabled entry in the profile can be detected before an action is triggered, such as blocking or logging. For example, if you select a match count of 10, the scanned file or HTTP body must contain 11 or more matching strings. Detections do not have to be unique.

### Optical Character Recognition (OCR)

Optical Character Recognition (OCR) analyzes and interprets text within image files. When used with DLP profiles, OCR can detect sensitive data within images your users upload.

OCR supports scanning .jpg/.jpeg and .png files between 4 KB and 1 MB in size. Text is encoded in UTF-8 format, including support for non-Latin characters.

### AI context analysis Beta

Note

AI context analysis only supports Gateway HTTP and HTTPS traffic.

AI context analysis uses a pretrained model to analyze and adjust the confidence in a detection based on its surrounding context. DLP will log any matches that are above your confidence threshold.

DLP redacts any matched text, then submits the context as an AI text embedding vector to Cloudflare Workers AI. Vectors are stored in user-specific private namespaces for up to six months, along with hit count and the false positive/negative report.

To use AI context analysis:

1. Turn on AI context analysis in a DLP profile.
2. Add the profile to a DLP policy.
3. When configuring the DLP policy, turn on payload logging.

AI context analysis results will appear in the payload section of your DLP logs. To improve future detections of sensitive data, you need to report false and true positives.

### Confidence thresholds

Confidence thresholds indicate how confident Cloudflare DLP is in a DLP detection. DLP determines the confidence by inspecting the content for proximity keywords around the detection.

Confidence threshold is set on the DLP profile. When you select a confidence threshold in Zero Trust, you will see which DLP entries will be affected by the confidence threshold. Entries that do not reflect a confidence threshold in Zero Trust are not yet supported or are not applicable.

DLP confidence detections consist of Low, Medium, and High confidence thresholds. DLP will default to Low confidence detections, which are based on regular expressions, require few keywords, and will trigger more often. Medium and High confidence detections require more keywords, will trigger less often, and have a higher likelihood of accuracy.

To change the confidence threshold of a DLP profile:

1. In Zero Trust ‚Üó, go to Data loss prevention > DLP profiles.
2. Select the profile, then select Edit.
3. In Settings > Confidence threshold, choose a new confidence threshold from the dropdown menu.

Setting the confidence to Low will also consider Medium and High confidence detections as matches. Setting the confidence to Medium or High will filter out lower confidence detections.

#### Gateway detections

For inline detections in Gateway, to display Low and Medium confidence detections but block High confidence detections, Cloudflare recommends creating two HTTP policies. The first policy should use a Low confidence DLP profile with an Allow action. The second policy should use a High confidence DLP profile with a Block action. For example:

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| DLP Profile | in | Low Confidence Detections | Allow |

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| DLP Profile | in | High Confidence Detections | Block |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Detection entries

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/detection-entries/](https://developers.cloudflare.com/cloudflare-one/policies/data-loss-prevention/detection-entries/)

Page options # Detection entries

Cloudflare DLP can scan your web traffic and SaaS applications for specific data defined in custom detection entries. Detection entries allow you to define custom data patterns for DLP to detect using DLP profiles. Detection entries include custom datasets with defined data, document entries with example fingerprints, and AI prompt topics.

You can configure sensitive data to be hashed before reaching Cloudflare and redacted from matches in payload logs.

## Datasets

You can create and upload custom datasets to scan for specific matching data.

### Dataset types

#### Exact Data Match

Exact Data Match (EDM) protects sensitive information, such as names, addresses, phone numbers, and credit card numbers.

All data in uploaded EDM datasets is encrypted before reaching Cloudflare. To detect matches, Cloudflare hashes traffic and compares it to hashes from your dataset. Matched data will be redacted in payload logs.

#### Custom Wordlist

Custom Wordlist (CWL) protects non-sensitive data, such as intellectual property and SKU numbers. Optionally, CWL can detect case-sensitive data.

Cloudflare stores data from CWL datasets within DLP. Plaintext matches appear in payload logs.

### Prepare DLP datasets

#### Formatting

To prepare a dataset for DLP, add your desired data to a multi-column spreadsheet. Each line must be at least six characters long. Entries do not require trailing or final commas.

For compatibility, save your file in either .csv or .txt format with LF (\n) newline characters. DLP does not support CRLF (\r\n) newline characters. For information on dataset limits, refer to Account limits.

#### Column title cells

Column title cells may result in false positives in Custom Wordlist datasets and should be removed.

DLP will detect and use title cells as column names for Exact Data Match datasets. If multiple columns have the same name, DLP will append a number sign (#) and number to their names.

Update EDM datasets

To select which Exact Data Match columns to use, you will need to reupload any EDM datasets added prior to column support.

### Upload a new dataset

Upload an Exact Data Match dataset

1. In Zero Trust ‚Üó, go to Data loss prevention > Detection entries.
2. Go to Datasets.
3. Select Add a dataset. In Exact Data Match (EDM), choose Select.
4. Upload your dataset file. Select Next.
5. Review and choose the detected columns you want to include. Select Next.
6. Name your dataset. Optionally, add a description. Select Next.
7. Review the details for your uploaded dataset. Select Save dataset.

DLP will encrypt your dataset and save its hash.

Upload a Custom Wordlist dataset

1. In Zero Trust ‚Üó, go to Data loss prevention > Detection entries.
2. Go to Datasets.
3. Select Add a dataset. In Custom Wordlist (CWL), choose Select.
4. Name your dataset. Optionally, add a description.
5. (Optional) In Settings, turn on Enforce case sensitivity to require matched values to contain exact capitalization.
6. In Upload file, choose your dataset file.
7. Select Save.

DLP will save your dataset in cleartext.

The dataset will appear in the list with an Uploading status. Once the upload is complete, the status will change to Complete. To use your uploaded dataset, add it as an existing entry to a custom DLP profile.

### Manage existing datasets

Uploaded DLP datasets are read-only. To update a dataset, you must upload a new file to replace the original.

1. In Zero Trust ‚Üó, go to Data loss prevention > DLP datasets.
2. Select the dataset you want to update.
3. Select Upload dataset and choose your updated dataset. Select Next.
4. If your select dataset is an Exact Data Match dataset, review and choose the new columns. Select Next.
5. Select Save dataset.

Your new dataset will replace the original dataset.

Remove existing column entries

If you want to update an Exact Data Match dataset to remove a column in use as an existing detection entry, you must remove the existing entry from any custom DLP profiles using it before updating the dataset.

## Documents

You can upload example documents to scan for unstructured data or specific document types common to your organization. DLP will create a unique fingerprint of the document and detect patterns in your organization's traffic based on how similar it is to the original fingerprint.

DLP stores uploaded documents encrypted at rest in a Cloudflare R2 bucket. To upload sensitive data that is only stored in memory, use Exact Data Match.

### Prepare document entries

DLP supports documents in .docx and .txt format. Documents must be under 10 MB.

### Upload a new document entry

To upload a new document entry to DLP:

1. In Zero Trust ‚Üó, go to Data loss prevention > Detection entries.
2. Go to Documents.
3. Select Add a document entry.
4. Name your document. Optionally, add a description.
5. In Minimum similarity for matches, enter a value between 0% and 100%.
6. In Upload document, choose and upload your document file.
7. Select Save.

The document will appear in the list with a Pending status. Once the upload is complete, the status will change to Complete. If you created a document entry with Terraform, the status will be No file until you upload a file.

To use your uploaded document fingerprint, add it as an existing entry to a custom DLP profile.

### Manage existing document entries

Uploaded document entries are read-only. To update a document entry, you must upload a new file to replace the original.

1. In Zero Trust ‚Üó, go to Data loss prevention > Detection entries.
2. Choose the document you want to update and select Edit.
3. (Optional) Update the name and minimum similarity for matches for your document entry. You can also open the existing uploaded document.
4. In Update document entry, choose and upload your updated document file.
5. Select Save.

Your new document entry will replace the original document entry. If your file upload fails, DLP will still use the original document fingerprint to scan traffic until you delete the entry.

## AI prompt topics

DLP uses Application Granular Controls to detect and categorize prompts submitted to generative AI tools. Application Granular Controls analyzes prompts for both content and user intent. Supported prompt topic detections include:

| Detection entry | Description |
| --- | --- |
| Content: PII | Prompt contains personal information such as names, SSNs, or email addresses |
| Content: Credentials and Secrets | Prompt contains API keys, passwords, or other sensitive credentials |
| Content: Source Code | Prompt contains actual source code, code snippets, or proprietary algorithms |
| Content: Customer Data | Prompt contains customer names, projects, business activities, or confidential customer contexts |
| Content: Financial Information | Prompt contains financial numbers or confidential business data |
| Intent: PII | Prompt requests specific personal information about individuals |
| Intent: Code Abuse and Malicious Code | Prompt requests malicious code for attacks, exploits, or harmful activities |
| Intent: Jailbreak | Prompt attempts to circumvent AI security policies |

To use an AI prompt topic, add it as an existing entry to a custom DLP profile.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Analytics overview

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/analytics/analytics-overview/](https://developers.cloudflare.com/cloudflare-one/insights/analytics/analytics-overview/)

Page options # Analytics overview

The Cloudflare One Analytics overview provides a dashboard that reports on how Cloudflare One is protecting your organization and networks.

To view the Analytics overview in Zero Trust ‚Üó, go to Analytics.

The Analytics overview includes reports and insights across the following products and categories:

- Global status of your Cloudflare One organization
- Access
- Gateway

HTTP traffic
Network traffic
DNS traffic
Firewall policies
- HTTP traffic
- Network traffic
- DNS traffic
- Firewall policies

## Global status

In Global status, you can view a report on your organization's Cloudflare One adoption that contains the following metrics:

- Access apps configured
- Gateway HTTP policies
- Gateway network policies
- Gateway DNS policies
- SaaS integrations
- DLP profiles

You can also view a report on your seat usage across your Cloudflare One organization that contains the following metrics:

- Total seats
- Used seats
- Unused seats

## Access

In Access, you can view a report on your Access configuration that contains:

Metrics:

- Total access attempts
- Granted access
- Denied (policy violation)
- Active logins overtime
- Top applications with most logins

Filters:

- Access data by country

## Gateway

### Proxy traffic

In Proxy traffic, you can view a report on your Gateway HTTP traffic that contains:

Metrics:

- Total requests overtime
- Allowed requests
- Blocked requests
- Isolated requests
- Do not inspect requests
- Top bandwidth consumers (GB)
- Top denied users

Filters:

- Gateway HTTP traffic data by country

### Gateway (network requests)

In Gateway (network requests), you can view a report on your Gateway network traffic that contains:

Metrics:

- Total sessions
- Authenticated sessions
- Blocked sessions
- Audit SSH sessions
- Allowed sessions
- Override sessions
- Top bandwidth consumers in GB
- Top denied users

Filters:

- Gateway network traffic data by country

### DNS traffic

In DNS traffic, you can view a report on your Gateway DNS traffic that contains:

Metrics:

- Total DNS queries
- Allowed DNS queries
- Blocked DNS queries
- Override DNS queries
- Safe Search DNS queries
- Restricted DNS queries
- Other DNS queries

Filters:

- Gateway DNS traffic by query type
- Gateway DNS traffic by country

### Gateway insights

In Gateway insights, you can view a report on your Gateway firewall policies that contains the following metrics:

- Top domain blocking policies
- Top destination domains
- Most user queries
- Top devices
- Top countries

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Access event analytics

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/analytics/access/](https://developers.cloudflare.com/cloudflare-one/insights/analytics/access/)

Page options # Access event analytics

Access event analytics allows you to review login attempts to the applications you protect behind Access. Access event analytics are powered by Access audit logs.

To view Access event analytics:

1. Log into Zero Trust ‚Üó.
2. Go to Analytics > Dashboards.
3. Select Access event analytics.

Access Event Analytics aggregates authentication activity based on your Access policies.

## Available insights

The Access event analytics dashboard includes a chart of Access activity over time. You can view a chronological chart of access events. The Access event analytics dashboard shows when access requests occurred, helping you spot spikes in login attempts.

- Events are displayed on the vertical axis.
- Time (in your local timezone) is shown along the horizontal axis.

The Access event analytics dashboard also shows data on your usage patterns with metrics including:

- Top used applications
- Top users
- Top IP addresses
- Top identities
- Top countries
- Top application types

These insights help you detect anomalies, and optimize policy rules.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Gateway analytics

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/analytics/gateway/](https://developers.cloudflare.com/cloudflare-one/insights/analytics/gateway/)

Page options # Gateway analytics

To see the top Allowed and Blocked requests across all of your DNS locations, go to Analytics > Gateway. You can filter the data by selecting a specific location and/or time.

- Requests ‚Äî This chart shows an overview of the number of requests made by end users within the time period you specify. It shows a breakdown of requests based on the decision Gateway took (either Allowed or Blocked).
- Allowed requests ‚Äî This chart shows a breakdown of the five domains which received the highest number of Allowed requests. It also shows the five domains which received the lowest amount of Allowed requests. By selecting View all to the right of either section of the chart, you will see a list of highest 100 and lowest 100 domains ranked by number of Allowed requests.
- Top blocked requests ‚Äî This chart shows a breakdown of the five domains which received the highest number of Blocked requests. It also shows the five domains which received the lowest number of Blocked requests. By selecting View all to the right of either section of the chart, you'll see a list of highest 100 and lowest 100 domains ranked by number of Blocked requests.
- Requests by category ‚Äî The charts in this card show a breakdown of the Top allowed categories and the Top blocked categories based on the number of requests that Gateway classified as belonging to a content category.

## GraphQL queries

You can use the GraphQL Analytics API to query your Gateway Analytics data. Available datasets for Gateway include:

| Dataset | Description |
| --- | --- |
| gatewayL4DownstreamSessionsAdaptiveGroups | Metrics for Gateway network sessions from user devices to the Cloudflare global network. |
| gatewayL4UpstreamSessionsAdaptiveGroups | Metrics for Gateway network sessions from the Cloudflare global network to user devices. |
| gatewayL4SessionsAdaptiveGroups | Metrics for Gateway network sessions with adaptive sampling. |
| gatewayL7RequestsAdaptiveGroups | Metrics for Gateway HTTP requests with adaptive sampling. |
| gatewayResolverQueriesAdaptiveGroups | Metrics for Gateway DNS queries with adaptive sampling. |
| gatewayResolverByRuleExecutionPerformanceAdaptiveGroups | Time to execute Gateway DNS policies on the Cloudflare global network. |
| gatewayResolverByCustomResolverGroups | Metrics for Gateway DNS queries resolved using custom resolvers. |
| gatewayResolverByCategoryAdaptiveGroups | Metrics for Gateway DNS queries sorted by domain category with adaptive sampling. |

To explore the schema, you can use a GraphQL client such as GraphiQL ‚Üó or Altair ‚Üó.

1. Create an API token with the following permissions:















TypeItemPermissionAccountAccount AnalyticsRead
2. In your GraphQL client, add your API token as an Authorization header.
3. Compose a query to access your Gateway Analytics datasets. For example, you can query the gatewayResolverQueriesAdaptiveGroups dataset to return the adaptive groups of DNS queries resolved by Gateway:
query GatewaySampleQuery($accountTag: string!, $start: Time) {  viewer {    accounts(filter: { accountTag: $accountTag }) {      gatewayResolverQueriesAdaptiveGroups(        filter: { datetime_gt: $start }        limit: 10      ) {        count        dimensions {          queryNameReversed          resolverDecision        }      }    }  }}Run in GraphQL API Explorer

For more information, refer to Compose a query in GraphiQL.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Shadow IT SaaS analytics

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/analytics/shadow-it-discovery/](https://developers.cloudflare.com/cloudflare-one/insights/analytics/shadow-it-discovery/)

Page options # Shadow IT SaaS analytics

Shadow IT SaaS analytics provides visibility into the SaaS applications your users are visiting. This information allows you to create identity and device-driven Zero Trust policies to secure your users and data.

To access Shadow IT SaaS analytics, in Zero Trust ‚Üó, go to Analytics > Dashboards, then select Shadow IT: SaaS analytics.

## Prerequisites

To allow Cloudflare to discover shadow IT in your traffic, you must set up HTTP filtering.

## Use Shadow IT SaaS analytics

### 1. Review applications

The first step in using the Shadow IT SaaS analytics dashboard is to review applications in the Application Library. The App Library synchronizes application review statuses with approval statuses from the Shadow IT Discovery SaaS analytics dashboard.

To organize applications into their approval status for your organization, you can mark them as Unreviewed (default), In review, Approved, and Unapproved.

| Status | API value | Description |
| --- | --- | --- |
| Approved | approved | Applications that have been marked as sanctioned by your organization. |
| Unapproved | unapproved | Applications that have been marked as unsanctioned by your organization. |
| In review | in review | Applications in the process of being reviewed by your organization. |
| Unreviewed | unreviewed | Unknown applications that are neither sanctioned nor being reviewed by your organization at this time. |

To set the status of an application:

1. In Zero Trust ‚Üó, go to My team > App Library.
2. Locate the card for the application.
3. In the three-dot menu, select the option to mark your desired status.

Once you mark the status of an application, its badge will change. You can filter applications by their status to review each application in the list for your organization. The review status for an application in the App Library and Shadow IT Discovery will update within one hour.

Note

Approval status does not impact a user's ability to access an application. Users are allowed or blocked according to your Access and Gateway policies. To filter traffic based on approval status, use the Application Status selector.

### 2. Monitor usage

Review the Shadow IT SaaS analytics dashboard for application usage. Filter the view based on:

| Field | Description |
| --- | --- |
| Application | SaaS application's name and logo. |
| Application type | Application type assigned by Cloudflare Zero Trust. |
| Status | Application's approval status. |
| Secured | Whether the application is currently secured behind Cloudflare Access. |
| Users | Number of users who connected to the application over the period of time specified on the Shadow IT Discovery overview page. |

To manage application statuses in bulk, select Set Application Statuses to review applications your users commonly visit and update their approval statuses.

### 3. Create policies

After marking applications, you can create HTTP policies based on application review status. For example, you can create policies that:

- Launch all Unreviewed and In review applications in an isolated browser.
- Block access to all Unapproved applications.
- Limit file upload capabilities for specific application statuses.

To create an HTTP status policy directly from Shadow IT Discovery:

1. In Zero Trust ‚Üó, go to Analytics > Dashboards, then select Shadow IT: SaaS analytics.
2. Select Set application statuses.
3. Select Manage HTTP status policies, then choose an application status and select Create policy.

## Available insights

The Shadow IT SaaS analytics dashboard includes several insights to help you monitor and manage SaaS application usage.

- Number of applications by status: A breakdown of how many applications have been categorized into each approval status. The list of applications is available in the App Library.
- Data transferred per application status: A time-series graph showing the amount of data (in gigabytes) transferred to an application in the given status.
- User count per application status: A time-series graph showing the number of users who have interacted with at least one application in a given status. For example, a user can use an Approved application shortly followed by an In review application, contributing to counts for both of those statuses.
- Top-N metrics: A collection of metrics providing insights into top applications, users, devices, and countries.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## DEX

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/dex/](https://developers.cloudflare.com/cloudflare-one/insights/dex/)

Page options # DEX

Digital Experience Monitoring (DEX) provides visibility into device, network, and application performance across your Zero Trust organization.

With DEX, you can monitor the state of your WARP client deployment and resolve issues impacting end-user productivity. DEX is designed for IT and security teams who need to proactively monitor and troubleshoot device and network health across distributed environments. DEX is available on all Cloudflare Zero Trust and SASE plans.

Use DEX to troubleshoot other Zero Trust features:

- Test connectivity to a SaaS application secured with Access.
- Verify that a website routed through Gateway is reachable from user devices.
- Confirm that users can successfully reach internal resources after configuring a Tunnel.

### Get started

To start using DEX for device, network, and application monitoring:

1. Create a Zero Trust organization.
2. Install the WARP client and sign in to register your device to the organization.
3. Create tests to verify device connectivity to applications and networks.
4. Monitor device and network health across your fleet using real-time and historical metrics.
5. Run remote captures to collect diagnostic logs and packet captures from user devices.
6. Set up notifications to get alerts when degraded connectivity or application performance is detected.

### Directory

Review all available documentation for DEX capabilities.

- Monitoring
- Tests
- Rules
- Remote captures
- Notifications
- IP visibility
- DEX MCP Server

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Monitoring

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/dex/monitoring/](https://developers.cloudflare.com/cloudflare-one/insights/dex/monitoring/)

Page options # Monitoring

Monitor performance and network status for your organization's fleet or individual user devices.

Network and device performance data helps IT administrators troubleshoot performance issues, investigate network connectivity problems, and monitor device health.

## Fleet status

A fleet is a collection of user devices. All devices in a fleet have WARP installed and are connected to a Cloudflare Zero Trust organization.

To view fleet status:

1. In Zero Trust ‚Üó, go to DEX > Monitoring.
2. In DEX Monitoring, review the information under the Fleet Status tab.

### View metrics

The Fleet Status tab will show real-time and historical connectivity metrics for all devices in your organization.

To view analytics on a per-device level, go to Device monitoring.

### Available metrics

- Devices connected by colo: Number of devices that are connected to a given Cloudflare data center ‚Üó.
- Connectivity status: Percentage of devices in a given WARP client state.

























StatusDescriptionConnectedWARP has successfully established a connection to the Cloudflare global network.DisconnectedWARP has been intentionally or unintentionally disconnected from the Cloudflare global network.PausedA user or administrator has taken an explicit action to temporarily turn off WARP, for example by entering an Admin Override code. Paused clients will auto-connect after a timeout period.ConnectingWARP is pending connection, but is actively trying to establish a connection to the Cloudflare global network.
- Mode: WARP mode deployed on the device.
- Colo: Percentage of devices connected to a given Cloudflare data center.
- Platform: Operating system of the device.
- Major Version: WARP client version installed on the device.
- Device Status Over Time: WARP client connection status over the selected time period.
- Connection Methods Over Time: WARP mode used by the device over the selected time period.

## Device monitoring

Review network and device performance for a device enrolled in your fleet.

### View a device's performance

To view a device's network and device performance metrics:

1. In Zero Trust ‚Üó, go to My team > Devices.
2. Select a device > View details.
3. Select the DEX tab.
4. In Device Monitoring, scroll down to Network performance and Device Performance.

### Network and device performance metrics

#### Network performance metrics

- Unique networks over time: How many unique SSIDs the device was connected to.
- Network I/O: How much data has been transferred (uploads and downloads) over the primary network interface.

#### Device performance metrics

- Battery percentage and cycles: Displays battery percentage and battery cycles ‚Üó over time. Used to debug potential performance issues possibly related to battery health or power-saving measures that are triggered at low-battery levels.
- CPU usage: CPU utilization over time. Used to debug slow system performance due to high CPU usage.
- Memory utilization: Memory utilization over time. Used to debug performance issues related to an overtaxed memory.
- Disk I/O: Displays number of disk read/write operations over time. Used to debug performance errors due to heavy disk operations.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tests

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/dex/tests/](https://developers.cloudflare.com/cloudflare-one/insights/dex/tests/)

Page options # Tests

With Digital Experience Monitoring (DEX), you can test if your devices can connect to a private or public endpoint through the WARP client. Tests allow you to monitor availability for a given application and investigate performance issues reported by your end users.

DEX tests will only run when the WARP client is turned on, whereas fleet status metrics are always available.

To specify the target group of a test, use DEX rules.

- HTTP test
- Traceroute test
- View test results

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## HTTP test

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/dex/tests/http/](https://developers.cloudflare.com/cloudflare-one/insights/dex/tests/http/)

Page options # HTTP test

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP   Secure Web Gateway without DNS Filtering | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2023.3.381 |
| macOS | ‚úÖ | 2023.3.381 |
| Linux | ‚úÖ | 2023.3.398 |
| iOS | ‚ùå |  |
| Android | ‚úÖ | 1.0 |
| ChromeOS | ‚úÖ | 1.0 |

An HTTP test sends a GET request from an end-user device to a specific web application. You can use the response metrics to troubleshoot connectivity issues. For example, you can check whether the application is inaccessible for all users in your organization, or only certain ones.

## Create a test

To set up an HTTP test for an application:

1. In Zero Trust ‚Üó, go to DEX > Tests.
2. Select Add a Test.
3. Fill in the following fields:

Name: Enter any name for the test.
Target: Enter the URL of the website or application that you want to test (for example, https://jira.site.com). Both public and private hostnames are supported. If testing a private hostname, ensure that the domain is on your local domain fallback list.
Source device profiles: (Optional) Select the WARP device profiles that you want to run the test on. If no profiles are selected, the test will run on all supported devices connected to your Zero Trust organization.
Test type: Select HTTP Get.
Test frequency: Specify how often the test will run. Input a minute value between 5 and 60.
4. Name: Enter any name for the test.
5. Target: Enter the URL of the website or application that you want to test (for example, https://jira.site.com). Both public and private hostnames are supported. If testing a private hostname, ensure that the domain is on your local domain fallback list.
6. Source device profiles: (Optional) Select the WARP device profiles that you want to run the test on. If no profiles are selected, the test will run on all supported devices connected to your Zero Trust organization.
7. Test type: Select HTTP Get.
8. Test frequency: Specify how often the test will run. Input a minute value between 5 and 60.
9. Select Add test.

Next, view the results of your test.

## Test results

An HTTP test measures the following data:

| Data | Description |
| --- | --- |
| Resource fetch time | Total time of all steps of the request, measured from startTime to responseEnd ‚Üó. |
| Server response time | Round-trip time for the device to receive a response from the target. |
| DNS response time | Round-trip time for the DNS query to resolve. |
| HTTP status codes | Status code ‚Üó returned by the target. |

## Related resources

- DEX rules - Specify the target group of a test.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Traceroute test

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/dex/tests/traceroute/](https://developers.cloudflare.com/cloudflare-one/insights/dex/tests/traceroute/)

Page options # Traceroute test

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP   Secure Web Gateway without DNS Filtering | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2023.5.587 |
| macOS | ‚úÖ | 2023.5.589 |
| Linux | ‚ùå |  |
| iOS | ‚ùå |  |
| Android | ‚úÖ | 1.0 |
| ChromeOS | ‚úÖ | 1.0 |

A traceroute test measures the network path of an IP packet from an end-user device to a server. You can use the test results to troubleshoot network issues. For example, increased latency may indicate a problem with connectivity along the network path.

## Create a test

To set up a traceroute test for an application:

1. In Zero Trust ‚Üó, go to DEX > Tests.
2. Select Add a Test.
3. Fill in the following fields:

Name: Enter any name for the test.
Target: Enter the IP address of the server you want to test (for example, 192.0.2.0). You can test either a public-facing endpoint or a private endpoint you have connected to Cloudflare.
Source device profiles: (Optional) Select the WARP device profiles that you want to run the test on. If no profiles are selected, the test will run on all supported devices connected to your Zero Trust organization.
Test type: Select Traceroute.
Test frequency: Specify how often the test will run. Input a minute value between 5 and 60.
4. Name: Enter any name for the test.
5. Target: Enter the IP address of the server you want to test (for example, 192.0.2.0). You can test either a public-facing endpoint or a private endpoint you have connected to Cloudflare.
6. Source device profiles: (Optional) Select the WARP device profiles that you want to run the test on. If no profiles are selected, the test will run on all supported devices connected to your Zero Trust organization.
7. Test type: Select Traceroute.
8. Test frequency: Specify how often the test will run. Input a minute value between 5 and 60.
9. Select Add test.

Next, view the results of your test.

## Test results

A traceroute test measures the following data:

| Data | Description |
| --- | --- |
| Network path | IP address, average response time, and packet loss for each hop between the device and the target. |
| Round trip time | Time between sending out a packet and receiving a response from the target. |
| Number of hops | Number of routers encountered between the device and the target. |
| Packet loss | Percentage of IP packets that failed to receive a response. |
| Availability | Percentage of tests where at least one packet reached the destination. |
| Last seen ISP | The Internet Service Provider that is managing the connection from the device to Cloudflare. (Only available on macOS and Windows.)   DEX looks up the IP address of the ISP in a geolocation database and returns the corresponding ASO and ASN ‚Üó. If the ASO and ASN are Unknown, it means this information is unavailable in the geolocation data provider. |

## Related resources

- DEX rules - Specify the target group of a test.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## View test results

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/dex/tests/view-results/](https://developers.cloudflare.com/cloudflare-one/insights/dex/tests/view-results/)

Page options # View test results

Use the results of a DEX test to monitor availability and performance for a specific application. DEX will store test results according to our log retention policy.

## Prerequisites

- At least one test has been created under DEX > Tests.
- Admins must have at least the Cloudflare Zero Trust Reporting role.

## View results for all devices

To view an overview of test results for all devices:

1. In Zero Trust ‚Üó, go to DEX > Monitoring.
2. Select the Tests tab.
3. Under Application tests, select a test to view detailed results.

## View results for an individual device

To view analytics on a per-device level:

1. In Zero Trust ‚Üó, go to My Team > Devices.
2. Select the device you want to view, and then select View details.
3. Select the Tests tab.
4. Select a test to view detailed results.

## Related resources

- DEX HTTP test - Assess the accessibility of a web application.
- DEX Traceroute test - Measure the network path of an IP packet from an end-user device to a server.
- DEX rules - Specify the target group of a test.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Rules

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/dex/rules/](https://developers.cloudflare.com/cloudflare-one/insights/dex/rules/)

Page options # Rules

DEX rules allow you to create and manage testing policies for targeted user groups within your fleet. After creating a rule, you can use it to define the scope of a test to specific groups such as departments (like finance or sales), devices, and/or users. You can apply and reuse rules on your desired tests.

DEX rules are ideal for admins who want to define the scope of a test to a specific group within their fleet to allow for more precise problem detection and resolution.

## Create a rule

To create a rule:

1. In Zero Trust ‚Üó, go to DEX > Rules.
2. Select Add a rule.
3. Give your rule a name and build your desired expressions.
4. Select Create rule to finalize your rule.

### Selectors

Selectors are required categories in a DEX rule expression that define a group within a fleet. The selector(s) you have defined in a rule will determine which group a test will impact.

Review the available selectors and their scope in the following list.

| Selector | Description |
| --- | --- |
| User email | For specifying user emails. |
| User group emails | For specifying group emails. |
| User group IDs | For specifying group IDs. |
| User group names | For specifying a group name. |
| Operating systems | For specifying operating systems. |
| Operating system version | For specifying an operating system version (use Operator in) or versions (use Operator is). |
| Managed network | For specifying users accessing the network from the office (managed network) compared to those accessing remotely. |
| SAML attributes | For specifying a value from the SAML Attribute Assertion. |
| Colos | For specifying a Cloudflare data center location users are connected to. |

## Add a rule to a test

After you have created a rule, you can add it to a test. If you do not add a rule to a test, the test will run on your entire device fleet.

To add a rule to a test:

1. In Zero Trust ‚Üó, go to DEX > Tests.
2. Choose an existing test and select Edit, or select Add a test to make a new test.
3. Under Select DEX rules, select the rule you would like to apply.
4. Select Save test for an existing rule or Add rule for the new test.

Note

It may take up to 10 minutes for newly updated settings to propagate to devices.

To view which tests a rule is being applied to:

1. In Zero Trust ‚Üó, go to DEX > Rules.
2. Select a rule > Edit.
3. Select the DEX tests tab and review the list of tests that include your selected rule.

## Create a test using a rule

You can create a new test from the DEX test dashboard as described above or directly from the DEX rules dashboard.

To create a new test using a rule from DEX rules:

1. In Zero Trust ‚Üó, go to DEX > Rules.
2. Select a rule > Edit.
3. Select the DEX tests tab.
4. You will be able to review all the tests that currently include this rule. To create a new test, select Create a test using this rule.
5. Enter all required information, making sure that the box next to your rule name is checked.
6. Select Add test.

## Related resources

- DEX HTTP test - Assess the accessibility of a web application.
- DEX Traceroute test - Measure the network path of an IP packet from an end-user device to a server.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Remote captures

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/dex/remote-captures/](https://developers.cloudflare.com/cloudflare-one/insights/dex/remote-captures/)

Page options # Remote captures

Feature availability

| WARP modes | Zero Trust plans ‚Üó |
| --- | --- |
| Gateway with WARP   Secure Web Gateway without DNS Filtering | All plans |

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2024.12.492.0 |
| macOS | ‚úÖ | 2024.12.492.0 |
| Linux | ‚úÖ | 2024.12.492.0 |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

Remote captures allow administrators to collect packet captures (PCAPs) and WARP diagnostic logs directly from end user devices. This data can be used to troubleshoot network problems, investigate security incidents, and identify performance bottlenecks.

## Start a remote capture

Devices must be actively connected to the Internet for remote captures to run.

To capture data from a remote device:

1. In Zero Trust ‚Üó, go to DEX > Remote captures.
2. Select up to 10 devices that you want to run a capture on. Devices must be registered in your Zero Trust organization.
3. Configure the types of captures to run.

Packet captures (PCAP): Performs packet captures for traffic outside of the WARP tunnel (default network interface) and traffic inside of the WARP tunnel (WARP virtual interface).
WARP Diagnostics Logs: Generates a WARP diagnostic log of the past 96 hours. To include a routing test for all IPs and domains in your Split Tunnel configuration, select Test all routes.
NoteTest all routes will extend the time for diagnostics to run and may temporarily impact device performance during the test.
4. Packet captures (PCAP): Performs packet captures for traffic outside of the WARP tunnel (default network interface) and traffic inside of the WARP tunnel (WARP virtual interface).
5. WARP Diagnostics Logs: Generates a WARP diagnostic log of the past 96 hours. To include a routing test for all IPs and domains in your Split Tunnel configuration, select Test all routes.
NoteTest all routes will extend the time for diagnostics to run and may temporarily impact device performance during the test.
6. Select Run diagnostics.

DEX will now send capture requests to the configured devices. If the WARP client is disconnected, the capture will time out after 10 minutes.

## Check remote capture status

To view a list of captures, go to DEX > Remote captures. The Status column displays one of the following options:

- Success: The capture is complete and ready for download. Any partially successful captures will still upload to Cloudflare. For example, there could be a scenario where the PCAP succeeds on the primary network interface but fails on the WARP tunnel interface. You can review PCAP results to determine which PCAPs succeeded or failed.
- Running: The capture is in progress on the device.
- Pending Upload: The capture is complete but not yet ready for download.
- Failed: The capture has either timed out or encountered an error. To retry the capture, check the WARP client version and connectivity status, then start a new capture.

## Download remote captures

1. In Zero Trust ‚Üó, go to DEX > Remote captures.
2. Find a successful capture.
3. Select the three-dot menu and select Download.

This will download a ZIP file to your local machine called <capture-id>.zip. DEX will store capture data according to our log retention policy.

### Device PCAP contents

The downloaded PCAP folder contains three files:

- capture-default.pcap: Packet captures for the primary network interface.
- capture-tunnel.pcap: Packet captures for traffic inside of the WARP tunnel.
- results.json: Reports successful and failed packet captures.

You can analyze .pcap files using Wireshark or another third-party packet capture tool.

### WARP Diag contents

Refer to WARP diagnostic logs for a description of each file.

## WARP diagnostics analyzer (beta)

The WARP diagnostics analyzer highlights what Cloudflare determines to be the most important detection events in a warp-diag log. You can use the detection report to help parse your log files and identify the root cause of client issues. The WARP diagnostic analyzer is only available for logs collected via the dashboard.

To access the WARP diagnostic analyzer:

1. In Zero Trust ‚Üó, go to DEX > Remote captures.
2. Locate an existing warp-diag log from the list or select Run diagnostics to generate a new warp-diag log.
3. Select the three dots for the warp-diag log that you want to analyze, then select View WARP Diag.
The Overview tab will display an AI-generated summary of the results, a list of detection events, and basic device information.
NoteTo view Cloudy AI summaries, account members must have the Administrator or Super Administrator role.
 Explanation of the fields
 












































FieldDescriptionDetection typeA common WARP issue that can appear in the diagnostic logs.OccurencesNumber of times an issue was detected in the logs.Severity levelIndicates the impact of the issue on WARP client functionality. The severity levels are:   Critical: Issue causes complete loss of functionality.   Warning: Issue causes degraded functionality but core features should still work.   No detection: Issue was not detected in the logs.  Operating systemOS and OS version of the device.WARP versionWARP release versionProfile IDWARP device profile UUIDService modeWARP modeConfiguration nameName of the Zero Trust organization that WARP is connected to.Device IDID generated by the WARP client.
4. Critical: Issue causes complete loss of functionality.
5. Warning: Issue causes degraded functionality but core features should still work.
6. No detection: Issue was not detected in the logs.
7. Select a detection type for more information about the event and recommended next steps.

Cloudflare will store the warp-diag log and its detection report per our log retention policy. To save a copy onto your local machine, download the log file and go to the JSON file tab to copy the report in JSON format.

## Limitations

- Packet captures are subject to the following limits:





















Limit TypeMaximum ValueTime limit600 secondsFile size50 MBPacket size1500 bytes
- WARP diagnostic logs have no file size limit, but files larger than 100 MB cannot be uploaded to Cloudflare and must be shared directly with the admin.
- Windows devices do not support concurrent remote captures. If you start a remote capture while another is in progress, the second capture will fail immediately.
- PCAPs will fail on Windows if you have another third-party packet capture tool (such as, Packet Monitor pktmon) running.
- On Windows, packet captures may fail on devices configured with a non-English language due to limitations with the underlying PktMon tool.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Notifications

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/dex/notifications/](https://developers.cloudflare.com/cloudflare-one/insights/dex/notifications/)

Page options # Notifications

Administrators can receive alerts when Cloudflare detects connectivity issues with the WARP client or degraded application performance. Notifications can be delivered via email, webhook, and third-party services.

## Manage notifications

DEX notifications are configured on the Cloudflare dashboard ‚Üó. For more information, refer to Create a notification.

## Available notifications

Device connectivity anomaly

Who is it for? Zero Trust customers who want to be notified when Cloudflare detects a spike or drop in the number of devices connected to the WARP client.

Other options / filters - Alert configuration: Choose when to trigger a notification. Available options are Connectivity spike, Connectivity drop, and Connectivity spike or drop.
- Filters:
Colo: Cloudflare data center that the device is connected to.
Platform: Operating system of the device.
Version: WARP client version (for example, 2024.3.409.0).
Mode: WARP mode deployed on the device.
- Colo: Cloudflare data center that the device is connected to.
- Platform: Operating system of the device.
- Version: WARP client version (for example, 2024.3.409.0).
- Mode: WARP mode deployed on the device.

Included with All Cloudflare Zero Trust plans.

What should you do if you receive one? Review your fleet status to investigate why the spike or drop occurred and which devices are impacted.

Additional information To learn more about the alert logic, refer to Z-score.

DEX test latency

Who is it for? Zero Trust customers who wish to receive alerts when there is a spike or drop in application latency, as measured by the HTTP test Resource Fetch time or Traceroute test Round trip time. Requires setting up a DEX test.

Other options / filters - Alert configuration: Choose when to trigger a notification. Available options are Latency spike, Latency drop, and Latency spike or drop.
- Filters:
Colo: Cloudflare data center that the device is connected to.
Platform: Operating system of the device.
Version: WARP client version (for example, 2024.3.409.0).
Test name: Choose which DEX test the alert should monitor. You will receive individual notifications for each test.
- Colo: Cloudflare data center that the device is connected to.
- Platform: Operating system of the device.
- Version: WARP client version (for example, 2024.3.409.0).
- Test name: Choose which DEX test the alert should monitor. You will receive individual notifications for each test.

Included with All Cloudflare Zero Trust plans.

What should you do if you receive one? View your test results to investigate why the spike occurred.

Additional information To learn more about the alert logic, refer to Z-score.

DEX test low availability

Who is it for? Zero Trust customers who wish to receive alerts when the percentage of successful HTTP or traceroute requests to an application drops below the selected service-level objective (SLO). Requires setting up a DEX test.

Other options / filters - Service Level Objective (SLO): Specify the availability threshold that will trigger an alert. Enter a percentage in xx.x format (for example, 98.0).
- Filters:
Colo: Cloudflare data center that the device is connected to.
Platform: Operating system of the device.
Version: WARP client version (for example, 2024.3.409.0).
Test name: Choose which DEX test the alert should monitor. You will receive individual notifications for each test.
- Colo: Cloudflare data center that the device is connected to.
- Platform: Operating system of the device.
- Version: WARP client version (for example, 2024.3.409.0).
- Test name: Choose which DEX test the alert should monitor. You will receive individual notifications for each test.

Included with All Cloudflare Zero Trust plans.

What should you do if you receive one? View your test results to investigate why the degradation occurred.

Additional information To learn more about the alert logic, refer to SLO.

## ‚Äã‚ÄãAlert logic

### Z-score

Cloudflare uses a z-score to detect traffic spikes or drops. A z-score ‚Üó is the number of standard deviations the current value is to the mean. We calculate the mean and standard deviation by comparing the current five minutes to the past four hours. This is measured every five minutes.

To trigger an alert, the z-score value must be above 3.5 or less than -3.5.

### SLO

A service-level objective (SLO) is defined as (x / y) * 100 where x = the number of good events and y = the number of valid events for a given time period. DEX notifications look at both a short window (five minutes) and a long time window (one hour) and triggers an alert if the availability falls below the SLO threshold in either window.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## IP visibility

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/dex/ip-visibility/](https://developers.cloudflare.com/cloudflare-one/insights/dex/ip-visibility/)

Page options # IP visibility

Feature availability

| System | Availability | Minimum WARP version |
| --- | --- | --- |
| Windows | ‚úÖ | 2025.1.861.0 |
| macOS | ‚úÖ | 2025.1.861.0 |
| Linux | ‚úÖ | 2025.1.861.0 |
| iOS | ‚ùå |  |
| Android | ‚ùå |  |
| ChromeOS | ‚ùå |  |

DEX's IP visibility gives administrators insight into three different IP types per device:

1. Device: The private IP address of an end-user device.
2. ISP: The public IP assigned by the ISP that the end-user device is being routed though.
3. Gateway: The router's private IP (the router the end device is connected to.)

Note

The ISP IP is only visible to users with the Zero Trust PII role.

DEX's IP visibility supports both IPv6 and IPv4 addresses.

IP information is crucial for IT administrators to accurately troubleshoot network issues and identify user locations. IT administrators face challenges like:

- Pinpointing the exact location of a user experiencing issues ("AP 87 is bad.")
- Identifying network access control policy violations ("NAC Policies is not applied properly.")
- Troubleshooting firewall restrictions ("Firewall on VLAN 93 is blocking.")
- Resolving Layer 2 and DHCP related problems.
- Indirectly determining user identity and device location.

## View a device's IP information

To view IP information for a user device:

1. In Zero Trust ‚Üó, go to My team > Devices.
2. Select a device, then select View details.
3. Under Details, scroll down to IP details.
4. Review the IP details for your selected device's most recent session.

## View a device's IP history

DEX's IP visibility allows you to review an event log of a device's IP history for the last seven days. To view a device's IP history:

1. In Zero Trust ‚Üó, go to My team > Devices.
2. Select a device > View details > under Details, scroll down to IP details.
3. Select View device history.
4. View the device's IP history and status from the last seven days.
5. Select a time to view more information about the device at that time.

Refer to Available metrics to review Status and Mode descriptions.

## Troubleshoot with IP visibility

While IP visibility allows you to inspect a device's IP information, use DEX's live analytics to review which Cloudflare data center the device is connected to. When traffic leaves a WARP-connected end-user device, it will hit a Cloudflare data center.

To find which Cloudflare data center a device is connected to:

1. Follow the steps listed in View IP information to find a device's IP information.
2. Select Device Monitoring above Device event log.
3. Find Colo in the Device details table to review which Cloudflare data center your selected device's egress traffic is connected to.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## DEX MCP Server

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/dex/dex-mcp-server/](https://developers.cloudflare.com/cloudflare-one/insights/dex/dex-mcp-server/)

Page options # DEX MCP Server

The MCP server (Model Context Protocol) ‚Üó for Digital Experience Monitoring (DEX) is an AI tool that allows customers to ask a question like, "Show me the connectivity and performance metrics for the device used by carly‚Äå@acme.com", and receive an answer that contains data from the DEX API.

Any Cloudflare One customer using a Free, PayGo, or Enterprise account can access the DEX MCP Server. This feature is available to everyone.

There are two primary options for connecting to the DEX MCP server:

- In Cloudflare's AI Playground
- With your preferred AI assistant

## Cloudflare AI Playground

Cloudflare's AI Playground is a great way to quickly try out a new MCP Server.

You can test the DEX MCP server in less than one minute by visiting the AI Playground's website.

1. Copy the URL for the DEX MCP server: https://dex.mcp.cloudflare.com/sse.
2. Open playground.ai.cloudflare.com ‚Üó in a browser.
3. Find the section in the left sidebar titled MCP Servers.
4. Paste the URL for the DEX MCP server into the URL input box and select Connect.
5. Authenticate your Cloudflare account, and then start asking questions about your DEX data.

Note

You need to ask specific and explicit questions to get a response. For example, first you need to provide the following instruction: "Set XYZ as the active account". Then, you can ask a specific question: "Fetch the DEX test results for the user bob@‚Äåacme.com over the past 24 hours".

## AI Assistant

Customers will get a more flexible and robust prompt experience by configuring the DEX MCP server with their preferred AI assistant (for example, Claude, Gemini, or ChatGPT).

If you have any issues during the configuration process, you can ask your AI assistant for help with configuring an MCP server via URL.

### Claude

You need a Claude Pro account (or higher subscription) to configure an MCP server.

1. Download the Claude desktop client ‚Üó.
2. Open the Claude desktop client, and log in or set up an account.
3. Expand the left sidebar menu, and select Claude Code.
4. Under Desktop app, select Developer to show the Local MCP servers page.
5. Select Edit Config and open the claude_desktop_config.json file in a text editor of your choice.
6. Copy the JSON configuration for the DEX MCP server and paste it into claude_desktop_config.json. Save the file.
{  "globalShortcut": "",  "mcpServers": {    "cloudflare-dex-analysis": {      "command": "npx",      "args": ["mcp-remote", "https://dex.mcp.cloudflare.com/sse"]    }  }}
7. Fully close Claude by using the task manager to stop any background processes related to Claude.
8. Open Claude, and your DEX MCP server configuration should appear on the Local MCP servers page.
9. Authenticate your Cloudflare account and allow the DEX MCP server.
10. You can start asking Claude questions about DEX. As a simple test, you can ask "Are you connected to the DEX MCP server".

### Gemini CLI

All tiers of Google AI Free, Pro, and Ultra offer an MCP server integration via the Gemini CLI.

You will need to use a CLI of your choice and npm or homebrew to install and access the Gemini CLI.

1. Visit the GitHub page for the Gemini CLI ‚Üó and follow the installation instructions.
2. Navigate to the settings.json file for your Gemini CLI install and open it in a text editor of your choice.
File path for the settings.json file
Windows: %USERPROFILE%\.gemini\settings.json
Mac and Linux: ~/.gemini/settings.json
3. Windows: %USERPROFILE%\.gemini\settings.json
4. Mac and Linux: ~/.gemini/settings.json
5. Copy the JSON configuration for the DEX MCP server and paste it into settings.json. Save the file.
{  "globalShortcut": "",  "mcpServers": {    "cloudflare-dex-analysis": {      "command": "npx",      "args": ["mcp-remote", "https://dex.mcp.cloudflare.com/sse"]    }  }}
6. Run Gemini in your CLI of choice.
7. If everything is working as expected, the Gemini CLI will show the following message:
Using: 1 MCP server (ctrl+t to view)
8. Authenticate the email associated with your Cloudflare account in the Gemini CLI.
9. You can start asking the Gemini CLI questions about DEX. As a simple test, you can ask "Are you connected to the DEX MCP server".

### ChatGPT

You need a ChatGPT Pro or Business account to configure an MCP server. ChatGPT Free and Plus do not support MCP servers.

1. Download the ChatGPT desktop app ‚Üó.
2. Open the ChatGPT desktop app, and log in or set up an account.
3. Open the Settings menu and select Connectors.
4. Select the option to create a new Connector.
5. Provide a Name (like DEX MCP), Description (optional), and MCP Server URL for the Connector. The DEX MCP Server URL is: https://dex.mcp.cloudflare.com/sse.
6. Create the new Connector.
7. Before you ask ChatGPT a question about DEX, select the + (plus) button next to the ChatGPT prompt box.
8. Select Use Connectors > Add Sources, then select the DEX MCP as a source.
9. You can start asking ChatGPT questions about DEX. As a simple test, you can ask "Are you connected to the DEX MCP server".

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Logs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/logs/](https://developers.cloudflare.com/cloudflare-one/insights/logs/)

Page options # Logs

Review detailed logs for your Zero Trust organization.

- User logs
- Access audit logs
- Gateway activity logs
- SCIM activity logs
- Tunnel audit logs
- Posture logs
- Logpush integration
- Enable Email Security logs

## Log retention

Cloudflare Zero Trust logs are stored for a varying period of time based on the service used and plan type:

|  | Free | Standard | Access | Gateway | Enterprise |
| --- | --- | --- | --- | --- | --- |
| Admin logs | 18 months | 18 months | 18 months | 18 months | 18 months |
| Access logs | 24 hours | 30 days | 30 days | 24 hours | 180 days |
| DNS logs | 24 hours | 30 days | 24 hours | 30 days | 180 days1 |
| Network logs | 24 hours | 30 days | 24 hours | 30 days | 30 days |
| HTTP logs | 24 hours | 30 days | 24 hours | 30 days | 30 days |
| DEX logs | 7 days | 7 days | 7 days | 7 days | 7 days |
| Device posture logs | 30 days | 30 days | 30 days | 30 days | 30 days |

## Log Explorer Beta

Log Explorer users can store Zero Trust logs directly within Cloudflare in an R2 bucket and access them with the dashboard or API. Log Explorer supports the following Zero Trust datasets:

- Access requests (FROM access_requests)
- CASB Findings (FROM casb_findings)
- Device posture results (FROM device_posture_results)
- Gateway DNS (FROM gateway_dns)
- Gateway HTTP (FROM gateway_http)
- Gateway Network (FROM gateway_network)
- Zero Trust Network Session Logs (FROM zero_trust_network_sessions)

For more information, refer to Log Explorer.

## Customer Metadata Boundary

Cloudflare Zero Trust can be used with the Data Localization Suite to ensure that data storage is restricted to a specific geographic region. For more information refer to Customer Metadata Boundary.

## Data privacy

For more information on how we use this data, refer to our Privacy Policy ‚Üó.

## Footnotes

1. Enterprise users on per query plans cannot store DNS logs via Cloudflare. You can still export logs via Logpush. For more information, contact your account team. ‚Ü©

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## User logs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/logs/users/](https://developers.cloudflare.com/cloudflare-one/insights/logs/users/)

Page options # User logs

User logs show a list of all users who have authenticated to Cloudflare Zero Trust. For each user who has logged in, you can view their enrolled devices, login history, seat usage, and identity used for policy enforcement.

## View user logs

In Zero Trust ‚Üó, go to My Team > Users. This page lists all users who have registered the WARP client or authenticated to a Cloudflare Access application. You can select a user's name to view detailed logs, revoke their session, or remove their seat.

### Available logs

- User Registry identity: Select the user's name to view their last seen identity. This identity is used to evaluate Gateway policies and WARP device profiles. A refresh occurs when the user re-authenticates WARP, logs into an Access application, or has their IdP group membership updated via SCIM provisioning. To track how the user's identity has changed over time, go to the Audit logs tab.
- Session identities: The user's active sessions, the identity used to authenticate each session, and when each session will expire.
- Devices: Devices registered to the user via WARP.
- Recent activities: The user's five most recent Access login attempts. For more details, refer to your authentication audit logs.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Access audit logs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/logs/audit-logs/](https://developers.cloudflare.com/cloudflare-one/insights/logs/audit-logs/)

Page options # Access audit logs

Cloudflare Access generates two types of audit logs:

- Authentication audit logs maintain a record of authentication events.
- Per-request audit logs record requests to protected URI paths and infrastructure targets.

## Authentication logs

Cloudflare Access logs an authentication event whenever a user or service attempts to log in to an application, whether the attempt succeeds or not.

Identity-based authentication refers to login attempts that matched on user email, IdP group, SAML group, or OIDC claim.

Non-identity authentication refers to login attempts that matched a non-identity policy such as IP address, device posture, country, valid certificate, or service token.

Note

Authentication logs do not capture the user's actions during a self-hosted or SaaS application session.

### Identity-based authentication

#### View Access authentication logs

- Dashboard
- API

To view logs for identity-based authentication events:

1. In Zero Trust ‚Üó, go to Logs > Access.
2. Select a row to view details such as the login method, the IP address of the user, and more.

The Access authentication logs API endpoint provides a custom URL to export audit log events for your account.

Required API token permissions

At least one of the following token permissions is required: - Access: Audit Logs Read

Get Access authentication logs ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/access/logs/access_requests?limit=25&direction=desc&since=2020-07-01T05%3A20%3A00Z&until=2020-10-01T05%3A20%3A00Z" \  --request GET \  --header "X-Auth-Email: $CLOUDFLARE_EMAIL" \  --header "X-Auth-Key: $CLOUDFLARE_API_KEY"
```

Response ```
{  "success": true,  "errors": [],  "messages": [],  "result": [    {      "user_email": "michelle@example.com",      "ip_address": "198.41.129.166",      "app_uid": "df7e2w5f-02b7-4d9d-af26-8d1988fca630",      "app_domain": "test.example.com/admin",      "action": "login",      "connection": "saml",      "allowed": false,      "created_at": "2014-01-01T05:20:00.12345Z",      "ray_id": "187d944c61940c77"    }  ]}
```

#### Explanation of the fields

Identity-based authentication logs contain the following fields:

##### Basic information

| Field | Description |
| --- | --- |
| App | Name of the Access application. |
| User email | Email address of the authenticating user. |
| User ID | UUID of the authenticating user. |
| IP address | IP address of the authenticating user. |
| App UID | UUID of the Access application. |
| App domain | URL of the Access application. |
| App type | Specifies the type of Access application: self-hosted, browser SSH, browser VNC, browser RDP, SaaS, or infrastructure. |
| Event | Type of authentication event, such as a login attempt. |
| Connection | IdP used to authenticate. |
| Allow | Result of the authentication event. |
| Request time | Timestamp of the authentication event. |
| Ray ID | A unique identifier for every request through Cloudflare. |
| Country | Country associated with the user's IP address. |

##### Infrastructure applications

Cloudflare Access logs the following information when the user authenticates to an infrastructure application:

| Field | Description |
| --- | --- |
| Hostname | Hostname of the infrastructure target. |
| Target ID | UUID of the infrastructure target. |
| SSH user | The UNIX user, such as root, that the authenticating user specified when connecting to the infrastructure target. |
| SSH logs | SSH commands that the user ran on the target. Requires configuring an SSH encryption key before the session begins. |

### Non-identity authentication

To retrieve logs for non-identity authentication events, use the GraphQL Analytics API. These logs are not available in Zero Trust.

## Per-request logs

Users who have authenticated through Access have access to authorized URL paths for the duration of their session. Cloudflare provides several ways to audit these requests.

### Using Cloudflare Logs

Enterprise customers have access to detailed logs of requests on their Cloudflare dashboard. Enterprise customers also have access to Cloudflare's Logpush service, which can be configured from the Cloudflare dashboard or API. For more information about Cloudflare HTTP and infrastructure logging, refer to Cloudflare Logs.

Once a member of your team authenticates to reach an HTTP resource behind Access, Cloudflare generates a token for that user that contains their SSO identity. The token is structured as a JSON Web Token (JWT). Cloudflare relies on an RSA Signature with SHA-256, or RS256, an asymmetric algorithm, to perform that signature. Cloudflare also makes the public key available, so that you can validate their authenticity, as well.

When a user requests a given URL, Access appends the user identity from that token as a request header, which we then log as the request passes through our network. Your team can collect these logs in your preferred third-party Security information and event management (SIEM) software or storage destination by using Cloudflare Logpush. When enabled with the Access user identity field, the logs will export to your systems as JSON similar to the logs below.

```
{   "ClientIP": "198.51.100.206",   "ClientRequestHost": "jira.widgetcorp.tech",   "ClientRequestMethod": "GET",   "ClientRequestURI": "/secure/Dashboard/jspa",   "ClientRequestUserAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.87 Safari/537.36",   "EdgeEndTimestamp": "2019-11-10T09:51:07Z",   "EdgeResponseBytes": 4600,   "EdgeResponseStatus": 200,   "EdgeStartTimestamp": "2019-11-10T09:51:07Z",   "RayID": "5y1250bcjd621y99",   "RequestHeaders":{"cf-access-user":"srhea"}},{   "ClientIP": "198.51.100.206",   "ClientRequestHost": "jira.widgetcorp.tech",   "ClientRequestMethod": "GET",   "ClientRequestURI": "/browse/EXP-12",   "ClientRequestUserAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.87 Safari/537.36",   "EdgeEndTimestamp": "2019-11-10T09:51:27Z",   "EdgeResponseBytes": 4570,   "EdgeResponseStatus": 200,   "EdgeStartTimestamp": "2019-11-10T09:51:27Z",   "RayID": "yzrCqUhRd6DVz72a",   "RequestHeaders":{"cf-access-user":"srhea"}}
```

### Using the cf-access-user field

In addition to the HTTP request fields available in Cloudflare Enterprise logging, requests made to applications behind Access include the cf-access-user field, which contains the user identity string. This offers another tool for auditing user behavior. To add the cf-access-user field to your HTTP request logs, you must add it as a custom field. Refer to Custom fields for instructions.

Keep in mind that Access does not log all interactions. For example, per-request audit logs can indicate that a specific user visited domain.com/admin and then domain.com/admin/panel, but the logs can only identify user interactions that result in a new HTTP request.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Gateway activity logs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/logs/gateway-logs/](https://developers.cloudflare.com/cloudflare-one/insights/logs/gateway-logs/)

Page options # Gateway activity logs

Private source IP substitution

Gateway logs will only show the public IP address for the Source IP field. Private IP addresses are substituted by a public IP address via network address translation (NAT).

Gateway activity logs show the individual DNS queries, Network packets, and HTTP requests inspected by Gateway. You can also download encrypted SSH command logs for sessions proxied by Gateway.

To view Gateway activity logs, log in to Zero Trust ‚Üó and go to Logs > Gateway. Select an individual row to investigate the event in more detail.

Enterprise users can generate more detailed logs with Logpush.

## Selective logging

By default, Gateway logs all events, including DNS queries and HTTP requests that are allowed and not a risk. You can choose to disable logs or only log blocked requests. To customize what type of events are recorded, log in to Zero Trust ‚Üó and go to Settings > Network. Under Activity Logging, indicate your DNS, Network, and HTTP log preferences.

These settings will only apply to logs displayed in Zero Trust. Logpush data is unaffected.

## DNS logs

### Explanation of the fields

#### Basic information

| Field | Description |
| --- | --- |
| Query name | Name of the domain that was queried. |
| Query ID | UUID of the query assigned by Cloudflare. |
| Email | Email address of the user who registered the WARP client where traffic originated from. If a non-identity on-ramp (such as a proxy endpoint) or machine-level authentication (such as a service token) was used, this value will be non_identity@<team-domain>.cloudflareaccess.com. |
| Action | The Action Gateway applied to the query (such as Allow or Block). |
| Time | Date and time of the DNS query. |
| Resolver decision | The reason why Gateway applied a particular Action to the request. Refer to the list of resolver decisions. |
| Resolved IPs | Resolved IP addresses in the response. |
| CNAMEs | CNAME records in the query. |

#### Configuration information

| Field | Description |
| --- | --- |
| DNS location | User-configured location from where the DNS query was made. |
| Policy name | Name of the matched policy. |
| Policy ID | ID of the matched policy. |
| Policy description | Description of the matched policy. |
| DoH subdomain | DoH subdomain of the DNS location. |
| Protocol | Protocol that was used to make the DNS query (such as https). |

#### Identities

| Field | Description |
| --- | --- |
| Email | Email address of the user who registered the WARP client where traffic originated from. |
| User ID | UUID of the user. Each unique email address in your organization will have a UUID associated with it. |
| Registration ID | UUID of the user's WARP client registration. A unique registration ID is generated each time a device is registered for a particular email. The same physical device may have multiple registration IDs. |
| Device name | Display name of the device returned by the operating system to the WARP client. Typically this is the hostname of a device. Not all devices will have a device name. Device names are not guaranteed to be unique. |
| Device ID | UUID of the device connected with the WARP client. Each physical device in your organization will have a UUID. |
| Last authenticated | Date and time the user last authenticated their Zero Trust session. |

#### DNS query details

| Field | Description |
| --- | --- |
| Query ID | UUID of the query assigned by Cloudflare. |
| Query type | Type of DNS query ‚Üó. |
| Initial query domain categories | Content categories that the domain belongs to. |
| Matched categories | Name of the Gateway policy category that match the domain. |
| Matched indicator feed names | Name of the indicator feeds that matched a Gateway policy. |
| Query indicator feed names | Name of the indicator feeds that a matched domain or IP belongs to. |
| Resolved continent IP geolocation | Continent code of the resolved IP address. |
| Resolved country IP geolocation | Country code of the resolved IP address. |
| DoT subdomain | DoT subdomain of the DNS location. |
| Source IP | Public source IP address of the DNS query. |
| Source IP continent | Continent code of the source IP address. |
| Source IP country | Country code of the source IP address. |
| Source internal IP | Private IP address assigned by the user's local network. |
| Application name | Name of the application that matched the domain. |
| Resolver IP | Public IP address of the DNS resolver. |
| Port | Port that was used to make the DNS query. |
| Location ID | ID of the DNS location where the query originated. |
| Scheduling - Time zone | Time zone of the DNS query source. |
| Scheduling - Time zone inferred method | Method used to determine the DNS query source's time zone. |

#### DNS response details

| Field | Description |
| --- | --- |
| Resolved CNAME categories | Content categories associated with the resolved CNAME records in the response. |
| Resolved IP categories | Content categories associated with the resolved IPs in the response. |
| Resolved IPs | Resolved IPs in the response. |
| Authoritative nameserver IP | IP address of the authoritative nameserver answering the DNS query. |
| EDE errors | Extended DNS error codes ‚Üó in the response. |

#### Custom resolver

| Field | Description |
| --- | --- |
| Address | Address of your custom resolver. |
| Policy | Name of the matched resolver policy. |
| Response | Status of the custom resolver response. |
| Time (in milliseconds) | Duration of time it took for the custom resolver to respond. |

### Resolver decisions

| Name | Value | Description |
| --- | --- | --- |
| blockedByCategory | 3 | Domain or hostname matched a category in a Block policy. |
| allowedOnNoLocation | 4 | Allowed because query did not match a Gateway DNS location. |
| allowedOnNoPolicyMatch | 5 | Allowed because query did not match a policy. |
| blockedAlwaysCategory | 6 | Domain or hostname is always blocked by Cloudflare. |
| overrideForSafeSearch | 7 | Response was overridden by a Safe Search policy. |
| overrideApplied | 8 | Response was overridden by an Override policy. |
| blockedRule | 9 | IP address in the response matched a Block policy. |
| allowedRule | 10 | IP address in the response matched an Allow policy. |

## Network logs

Failed connection logs

Gateway will only log TCP traffic with completed connections. If a connection is not complete (such as a TCP SYN with no SYN ACK), Gateway will not log this traffic in network logs.

Gateway can log failed connections in network session logs. These logs are available for Enterprise users via Logpush or GraphQL.

### Explanation of the fields

#### Basic information

| Field | Description |
| --- | --- |
| Source IP | IP address of the user sending the packet. |
| Source Internal IP | Private IP address assigned by the user's local network. |
| Destination IP | IP address of the packet's target. |
| Action | The Gateway Action taken based on the first rule that matched (such as Allow or Block). |
| Session ID | ID of the unique session. |
| Time | Date and time of the session. |

#### Matched policies

| Field | Description |
| --- | --- |
| DNS location | User-configured location from where the DNS query was made. |
| Policy name | Name of the matched policy. |
| Policy ID | ID of the policy enforcing the decision Gateway made. |
| Policy description | Description of the matched policy. |

#### Identities

| Field | Description |
| --- | --- |
| Email | Email address of the user sending the packet. This is generated by the WARP client. |
| User ID | ID of the user sending the packet. This is generated by the WARP client. |
| Registration ID | ID of the user's device registration. This is generated by the WARP client. |
| Device name | Name of the device that sent the packet. |
| Device ID | ID of the physical device that sent the packet. This is generated by the WARP client. |
| Last authenticated | Date and time the user last authenticated with Zero Trust. |

#### Network query details

| Field | Description |
| --- | --- |
| Source IP | IP address of the user sending the packet. |
| Source port | Source port number for the packet. |
| Source country | Country code for the packet source. |
| Source IP continent | Continent code of the source IP address. |
| Source IP country | Country code of the source IP address. |
| Destination IP | IP address of the packet's target. |
| Destination port | Destination port number for the packet. |
| Destination IP continent | Continent code of the IP address for the packet's destination. |
| Destination IP country | Country code of the IP address for the packet's destination. |
| Transport protocol | Protocol over which the packet was sent. |
| Detected Protocol | The detected network protocol. |
| SNI | Host whose Server Name Indication (SNI) header Gateway will filter traffic against. |
| Virtual Network | Virtual network that the client is connected to. |
| Category details | Category or categories associated with the packet. |
| Proxy endpoint | PAC file proxy endpoint Gateway forwarded traffic to, if applicable. |
| Application ID | ID of the application that matched the domain. |
| Application name | Name of the application that matched the domain. |

## HTTP logs

Note

When an HTTP request results in an error, Gateway logs the first 512 bytes of the request for 30 days for internal troubleshooting. Otherwise, Gateway does not log HTTP bodies.

### Explanation of the fields

#### Basic information

| Field | Description |
| --- | --- |
| Host | Hostname in the HTTP header for the HTTP request. Gateway will log the SNI in this field if it responded to the request with a Do Not Inspect action. If Gateway does not receive the SNI, this field will be empty. |
| Email | Email address of the user who made the HTTP request. This is generated by the WARP client. |
| Action | The Gateway Action taken based on the first rule that matched (such as Allow or Block). |
| Request ID | Unique ID of the request. |
| Time | Date and time of the HTTP request. |
| Source internal IP | Private IP address assigned by the user's local network. |
| User agent | User agent header sent in the request by the originating device. |
| Policy details | Policy corresponding to the decision Gateway made based on the traffic criteria of the request. |
| DLP profiles | Name of the matched DLP profile. |
| DLP profile entries | Name of the matched entry within the DLP profile. |
| Uploaded/downloaded file | Information about the file transferred in the request found by enhanced file detection. Details include: File nameFile typeFile sizeFile hash (for Allowed requests only)Content typeDirection (Upload/Download)Action (Block/Allow) |

#### Matched policies

| Field | Description |
| --- | --- |
| DNS location | User-configured location from where the DNS query was made. |
| Policy name | Name of the matched policy. |
| Policy ID | ID of the matched policy. |
| Policy description | Description of the matched policy. |
| Matched category ID | ID of the category matched in the policy. |
| Matched category name | Name of the category matched in the policy. |

#### Identities

| Field | Description |
| --- | --- |
| Email | Email address of the user who made the HTTP request. This is generated by the WARP client. |
| User ID | ID of the user who made the request. This is generated by the WARP client. |
| Registration ID | ID of the user's device registration. This is generated by the WARP client. |
| Device name | Name of the device that made the request. |
| Device ID | ID of the physical device that made the request. This is generated by the WARP client on the device that created the request. |
| Last authenticated | Date and time the user last authenticated with Zero Trust. |

#### HTTP query details

| Field | Description |
| --- | --- |
| HTTP Version | HTTP version of the origin that Gateway connected to on behalf of the user. |
| HTTP Method | HTTP method used for the request (such as GET or POST). |
| HTTP Status Code | HTTP status code returned in the response. |
| URL | Full URL of the HTTP request. |
| Referer | Referer request header containing the address of the page making the request. |
| Source IP | Public source IP address of the HTTP request. |
| Source Port | Port that was used to make the HTTP request. |
| Source IP continent | Continent code of the HTTP request. |
| Source IP country | Country code of the HTTP request. |
| Destination IP | Public IP address of the destination requested. |
| Destination Port | Port of the destination requested. |
| Destination IP continent | Continent code of the destination requested. |
| Destination IP country | Country code of the destination requested. |
| Blocked file reason | Reason why the file was blocked if a file transfer occurred or was attempted. |
| Category details | Detailed information on the category the blocked file belongs to. |
| Application ID | ID of the application that matched the domain. |
| Application name | Name of the application that matched the domain. |
| Categories | Content categories that the domain belongs to. |
| Proxy endpoint | PAC file proxy endpoint Gateway forwarded traffic to, if applicable. |
| Virtual Network | Virtual network that the client is connected to. |
| Sandbox scanned | Status of the file quarantine. |

#### File detection details

| Field | Description |
| --- | --- |
| Name | Name of the detected file. |
| Type | File type of the detected file. |
| Size | Size of the detected file. |
| Hash | Hash of the detected file, generated by DLP. |
| Content type | MIME type of the detected file. |
| Direction | Upload or download direction of the detected file. |
| Action | The Action Gateway applied to the request. |

### Enhanced file detection

Enhanced file detection is an optional feature to extract more file information from HTTP traffic. When turned on, Gateway will read file information from the HTTP body rather than the HTTP headers to provide greater accuracy and reliability. This feature may have a minor impact on performance for file-heavy organizations.

To turn on enhanced file detection:

1. In Zero Trust ‚Üó, go to Settings > Network.
2. In Firewall, turn on TLS decryption.
3. In Gateway Logging, turn on Enable enhanced file detection.

### Isolate requests

When a user creates an isolation policy, Gateway logs the initial request that triggers isolation as an Isolate action. Because this request is not isolated yet, the is_isolated field will return false. Zero Trust then securely returns the result to the user in an isolated browser. Gateway will log all subsequent requests in the isolated browser with the action (such as Allow or Block), and the is_isolated field will return true.

## Limitations

If a connection closes before Gateway inspects and filters the traffic, Gateway will log the traffic with an Unknown action.

Gateway activity logs are not available in the dashboard if you turn on the Customer Metadata Boundary (CMB) within Cloudflare Data Localization Suite (DLS). Enterprise users using CMB can still export logs via Logpush. For more information, refer to DLS product compatibility.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Manage PII

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/logs/gateway-logs/manage-pii/](https://developers.cloudflare.com/cloudflare-one/insights/logs/gateway-logs/manage-pii/)

Page options # Manage PII

Cloudflare Gateway gives you multiple ways to safely handle your employees' personally identifiable information (PII). You can choose to exclude PII from activity logging, or you can choose to redact PII from everyone except for designated administrators.

## Types of PII

Cloudflare Gateway can log the following types of PII:

- Source IP
- User email
- User ID
- Device ID
- URL
- Referer
- User agent

## Exclude PII

Enabling this setting means Cloudflare Gateway will log activity without storing any employee PII. Changes to this setting will not change PII storage of any previous logs. This means if Exclude PII is enabled and then disabled, there will be no PII data for logs captured while Exclude PII was enabled. The PII data will be unavailable to all roles within your Zero Trust organization, including the Super Admin.

To enable or disable this setting, log in to Zero Trust ‚Üó and go to Settings > Network > Exclude PII.

## Redact PII

Note

This feature is only available on Enterprise plans.

PII is by default redacted from Gateway Activity logs for all permission roles except the Super Admin and users with the Cloudflare Zero Trust PII role assigned to them. Only the Super Admin can assign roles and determine who has permission to view PII. Redacting PII does not affect the way PII is captured in logs ‚Äî the data is simply hidden and no information is lost.

To add or remove the Cloudflare Zero Trust PII role for a user, refer to our Account setup documentation.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SCIM activity logs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/logs/scim-logs/](https://developers.cloudflare.com/cloudflare-one/insights/logs/scim-logs/)

Page options # SCIM activity logs

SCIM activity logs allow administrators to audit how SCIM provisioning events in an identity provider (such as create, update, and delete) affect a user's identity and group membership in Zero Trust. You can compare your Zero Trust SCIM logs with your identity provider's SCIM logs to track how identity data is shared between the two services and pinpoint the source of any provisioning errors.

## View SCIM logs

For an overview of SCIM events across all users, log in to Zero Trust ‚Üó and go to Logs > SCIM provisioning. This page lists the inbound SCIM requests from all identity providers configured with SCIM. You can select an individual request to view more details about the SCIM operation.

To investigate how SCIM events impacted a specific user, go to their User Registry identity.

Note

New users must first register the WARP client or authenticate to an Access application before SCIM provisioning can begin.

## Log fields

SCIM provisioning logs show the following information for each inbound SCIM request:

- IdP name: Name of the identity provider
- Timestamp: Date and time of the request
- Action: HTTP request method (POST, PUT, PATCH, DELETE)
- User email: User who received the SCIM identity update
- Group name: Group that received the SCIM identity update
- Resource type: SCIM resource that was modified (GROUP or USER)
- CF resource ID: Persistent identifier for the user or group created by Cloudflare SCIM
- IDP resource ID: Identifier for the user or group provided by the identity provider
- Outcome: Whether the SCIM request was applied successfully (SUCCESS or ERROR)
- Request body: HTTP request body containing the data that was added, modified, or removed
- JSON log: SCIM request log in JSON format

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tunnel audit logs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/logs/tunnel-audit-logs/](https://developers.cloudflare.com/cloudflare-one/insights/logs/tunnel-audit-logs/)

Page options # Tunnel audit logs

Audit logs for Tunnel are available in the account section of the Cloudflare dashboard ‚Üó which you can find by selecting your name or email in the upper right-hand corner of the dashboard. The following actions are logged:

| Action | Description |
| --- | --- |
| Registered | This is logged when Tunnel is started and connects to the Cloudflare edge. |
| Unregistered | This is logged when Tunnel is disconnected from the Cloudflare edge. |
| CNAME add | This is logged when Tunnel registers a new DNS (CNAME or AAAA) record for the tunneled application. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Posture logs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/logs/posture-logs/](https://developers.cloudflare.com/cloudflare-one/insights/logs/posture-logs/)

Page options # Posture logs

Posture logs show the device posture check results reported by the WARP client.

To view device posture logs, log in to Zero Trust ‚Üó and go to Logs > Posture. Logs will only display if you have configured device posture checks for your Zero Trust organization.

Enterprise users can generate more detailed logs with Logpush.

## Explanation of the fields

### Device details

| Field | Description |
| --- | --- |
| Name | Name of the device. |
| ID | Device ID generated by the WARP client. |
| Serial number | Serial number of the device. |
| Manufacturer | Manufacturer of the device. |
| Model | Model of the device. |

### User details

| Field | Description |
| --- | --- |
| Email | Email used to register the device with Zero Trust. |
| User ID | UUID of the user who registered the device. |
| Registration ID | UUID of the user's WARP client registration. |

### Posture details

| Field | Description |
| --- | --- |
| Name | Name of the device posture check. |
| Type | Type of WARP client check or service provider check. |
| Rule ID | UUID of the device posture check. |
| Conditions met | Whether the device passed or failed the posture check criteria. Evaluates to true if the Received values match the Expected values. |
| Expected values | Values required to pass the device posture check. |
| Received values | Posture check values detected by the WARP client. |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Logpush integration

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/logs/logpush/](https://developers.cloudflare.com/cloudflare-one/insights/logs/logpush/)

Page options # Logpush integration

Note

Only available on Enterprise plans.

With Cloudflare's Logpush service, you can configure the automatic export of Zero Trust logs to third-party storage destinations or to third-party security information and event management (SIEM) solutions. Once exported, your team can analyze and audit the data as needed.

## Export Zero Trust logs with Logpush

Dashboard limitation

Zero Trust does not support configuring Cloudflare R2 as a Logpush destination in the dashboard. To use R2 as a destination for Zero Trust logs, configure your Logpush jobs with the API.

To configure Logpush for Zero Trust logs:

1. In Zero Trust ‚Üó, go to Logs > Logpush.
2. If this is your first Logpush job, select Add a Logpush job. Otherwise, select Go to logpush configurations.
3. In Logpush, select Create a Logpush job.
4. Choose a Logpush destination.
5. Follow the service-specific instructions to configure and validate your destination.
6. Choose the Zero Trust datasets to export.
7. Enter a Job name, any filters you would like to add, and the data fields you want to include in the logs.
8. (Optional) In Advanced settings, choose the timestamp format you prefer and whether you want to enable log sampling.
9. Select Submit.

The setup of your Logpush integration is now complete. Logpush will send updated logs every five minutes to your selected destination. You can configure multiple destinations and add additional fields to your logs by returning to the Logpush page.

For more information on supported destinations, refer to Enable destinations.

## Zero Trust datasets

Refer to Logpush datasets for a list of all available fields.

| Dataset | Description |
| --- | --- |
| Access Requests | HTTP requests to sites protected by Cloudflare Access |
| Audit Logs | Authentication events through Cloudflare Access |
| Browser Isolation User Actions | Data transfer actions performed by a user in the remote browser |
| CASB Findings | Security issues detected by Cloudflare CASB |
| Device Posture Results | Device posture status from the WARP client |
| DLP Forensic Copies | Entire HTTP requests or payloads of HTTP requests captured by Cloudflare DLP |
| Gateway DNS | DNS queries inspected by Cloudflare Gateway |
| Gateway HTTP | HTTP requests inspected by Cloudflare Gateway |
| Gateway Network | Network packets inspected by Cloudflare Gateway |
| SSH Logs | SSH command logs for Access for Infrastructure targets |
| Zero Trust Network Session Logs | Network session logs for traffic proxied by Cloudflare Gateway |

## Parse DNS logs

Logpush logs the following fields for each DNS query:

- Query name
- Query type
- Query class
- Response TTL
- Response data

DNS query resource records are available in Base64-encoded binary format ‚Üó and JSON. For example:

```
{  "ResourceRecords": [    {      "type": "5",      "data": "d3d3LmV4YW1wbGUuY29tAAABAAUAAABleGFtcGxlLmNvbQ=="    },    {      "type": "1",      "data": "ZXhhbXBsZS5jb20AAAEAAQAAAQIDBAUGBwgJ"    }  ],  "ResourceRecordsJSON": "[{\"name\":\"www.example.com\",\"type\":\"CNAME\",\"class\":\"IN\",\"ttl\":300,\"rdata\":\"example.com.\"},{\"name\":\"example.com\",\"type\":\"A\",\"class\":\"IN\",\"ttl\":300,\"rdata\":\"203.0.113.0\"}]"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Enable Email Security logs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/logs/enable-logs/](https://developers.cloudflare.com/cloudflare-one/insights/logs/enable-logs/)

Page options # Enable Email Security logs

Email Security allows you to configure Logpush to send detection data to an endpoint of your choice.

## Enable detection logs

Detection logs generate logs made by Email Security and some of the metadata associated with the detection.

To enable detection logs, refer to Enable destinations.

If you enable detection logs using R2, choose Email security alerts when configuring the Dataset.

## Enable user action logs

User action logs allow you to view logs regarding all actions taken via the API or the dashboard.

Before you can enable audit logs for Email Security, you will have to enable logpush jobs to your storage destination. Refer to Enable destinations to enable logs on destinations such as Cloudflare R2, HTTP, Amazon S3, and more.

Once you have configured your destination, you can set up audit logs for user action:

1. Log in to the Cloudflare dashboard ‚Üó.
2. Select Analytics & Logs > Logpush.
3. Select Audit logs.
4. Under Configure logpush job:

- Job name: Enter the job name.
- If logs match: Select Filtered logs:

Field: Choose ResourceType.
Operator: Choose starts with.
Value: Enter email_security.
- Field: Choose ResourceType.
- Operator: Choose starts with.
- Value: Enter email_security.

1. Select Submit.

You can now view logs via the Cloudflare dashboard.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Risk score

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/risk-score/](https://developers.cloudflare.com/cloudflare-one/insights/risk-score/)

Page options # Risk score

Note

Only available on Enterprise plans.

Zero Trust risk scoring detects user activity and behaviors that could introduce risk to your organization's systems and data. Risk scores add user and entity behavior analytics (UEBA) to the Zero Trust platform.

## User risk scoring

Cloudflare Zero Trust assigns a risk score of Low, Medium, or High based on detections of users' activities, posture, and settings. A user's score is equal to the highest-level risk behavior they trigger.

### View a user's risk score

To view a user's risk score in Zero Trust ‚Üó, go to Risk score > User risk scoring. Select a user's name to view their instances of risk behaviors, if any. You can select an instance of a risk behavior to view the log associated with the detection.

Users that have had their risk score cleared will not appear in the table unless they trigger another risk behavior.

### Clear a user's risk score

If required, you can reset risk scores for specific users. Once reset, users will not appear in the associated risk table until they trigger another risk behavior.

1. In Zero Trust ‚Üó, go to Risk score > User risk scoring.
2. Select the user you want to clear the risk score for.
3. In User risk overview, select Reset user risk.
4. Select Confirm.

### Send risk score to Okta

In addition to controls in Zero Trust, Okta users can send risk scores to Okta to apply SSO-level policies.

First, configure Zero Trust to send user risk scores to Okta.

1. Set up the Okta SSO integration.
2. In Zero Trust ‚Üó, go to Settings > Authentication.
3. In Login methods, locate your Okta integration and select Edit.
4. Turn on Send risk score to Okta.
5. Select Save.
6. Upon saving, Zero Trust will display the well-known URL for your organization. Copy the value.

Next, configure Okta to receive your risk scores.

1. On your Okta admin dashboard, go to Security > Device Integrations.
2. Go to Receive shared signals, then select Create stream.
3. Name your integration. In Set up integration with, choose Well-known URL.
4. In Well-known URL, enter the well-known URL value provided by Zero Trust.
5. Select Create.

For more information on configuring user risk score within Okta, refer to the Okta documentation ‚Üó.

While the Okta integration is turned on, Zero Trust will send any user risk score updates to Okta, including score increases and resets. Score update events will appear in your Access audit logs.

## Predefined risk behaviors

By default, all predefined behaviors are disabled. When a behavior is enabled, Zero Trust will continuously evaluate all users within the organization for the behavior. You can change the risk level for predefined behaviors if the default assignment does not suit your environment.

| Risk behaviors | Requirements | Description |
| --- | --- | --- |
| Impossible travel | A configured Access application | User has a successful login from two different locations that they could not have traveled between in that period of time. Matches will appear in your Access audit logs. |
| High number of DLP policies triggered | A configured DLP profile | User has created a high number of DLP policy matches within a narrow frame of time. Matches will appear in your Gateway activity logs. |
| SentinelOne threat detected on machine | SentinelOne service provider integration | SentinelOne returns one or more configured device posture attributes for a user. |

## Manage risk behaviors

To toggle risk behaviors, go to Risk score > Risk behaviors.

### Enable risk behaviors

When a specific behavior is enabled, Zero Trust will continuously monitor all users within the organization for any instances of that behavior.

If a user engages in an enabled risk behavior, their risk level is re-evaluated. Zero Trust will update their risk score to the highest value between the current risk level and the risk level of the behavior they triggered.

### Disable risk behaviors

When a risk behavior is disabled, monitoring for future activity will cease. Previously detected risk behaviors will remain in the logs and associated with a user.

### Change risk behavior risk levels

You can change the risk level for a behavior at any time.

1. In Zero Trust ‚Üó, go to Risk score > Risk behaviors.
2. Select the risk behavior you want to modify.
3. In the drop-down menu, choose your desired risk level.
4. Select Save.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Email Security

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/](https://developers.cloudflare.com/cloudflare-one/email-security/)

Page options # Email Security

Important

Refer to Area 1 if you are looking for the Area 1 documentation.

Protect your email inbox with Email Security. Email Security protects your email inbox from phishing attacks, malware, Business Email Compromise ‚Üó attacks, and vendor email fraud.

Email Security integrates with your existing email provider (such as Microsoft 365 or Gmail), and reduces the amount of spam and phishing emails landing in your inbox. You can configure Email Security via API deployment, BCC/Journaling, or MX/Inline. All three deployments aim at protecting your organization for malicious activities.

The Cloudflare dashboard will display the Email Security overview page only after completing the setup process.

Note

If you have not yet purchased Email Security, you can try Email Security with Retro Scan. Refer to Retro Scan to learn more.

To access the Email Security overview:

1. Log in to Zero Trust ‚Üó.
2. Go to Email Security > Overview.

Email Security overview displays:

- Quick actions, where you can:

View reclassifications
Manage detection settings: manage allow policies, blocked senders, trusted domains, impersonation registry and additional detections.
Run screens
- View reclassifications
- Manage detection settings: manage allow policies, blocked senders, trusted domains, impersonation registry and additional detections.
- Run screens
- Recommendations: A series of recommendations. For example, you may be recommended to learn how to submit emails for reclassification, create policies, or protect users at risk of impersonation
- Email Security metrics: Activity from the last seven days.
- Recently modified policies A list of modified policies.
- Education and resources: Links to implementation guides, Email Security changelogs, and API documentation ‚Üó

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Retro Scan

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/retro-scan/](https://developers.cloudflare.com/cloudflare-one/email-security/retro-scan/)

Page options # Retro Scan

Retro Scan allows you to scan up to 14 days of old messages in your Microsoft 365 inboxes and check if your current email security solution missed any threats.

Note

Retro Scan is only available for Microsoft 365 accounts.

To start a free scan:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security > Overview.
3. Select Start a free scan > Generate report.
4. Enable your Microsoft integration.
5. Generate Retro Scan report:

Connect domains: Select at least one domain from your integration.
Select current solution: Select the email security tool you are currently using.
Review details: Review the details you previously selected. Then, select Continue. You will be notified by email once the report is available.
6. Connect domains: Select at least one domain from your integration.
7. Select current solution: Select the email security tool you are currently using.
8. Review details: Review the details you previously selected. Then, select Continue. You will be notified by email once the report is available.
9. Go to your email inbox and select the link to view the full report.
10. On the dashboard, select View report.

The dashboard will display Overview and Details pages.

### Overview

Overview displays the total scanned domains. The overview shows you:

- Disposition evaluation
- Malicious threat types
- Malicious targets
- Malicious threat origins

### Details

Details allows you to review the first 1,000 emails assigned a disposition.

Select an email to review details about the message.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Before you begin

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/)

Page options # Before you begin

Before you start the onboarding process, you will have to:

1. Choose a deployment path: Email Security provides two deployment modes, post-delivery for API and BCC/Journaling and pre-delivery for MX/Inline.
2. Learn about dispositions, impersonation registry, and reclassifications.
3. Know the steps to configure your email environment correctly.

## 1. Choose a deployment

### Post-delivery deployment

When you choose post-delivery deployment, Cloudflare scans emails after they reach a users' inbox.

If you are a Microsoft 365 user, this is done via Microsoft's Graph API or journaling.

If you are a Google Workspace or Microsoft Exchange user, this is done via BCC.

#### Why you should consider post-delivery deployment

Post-delivery deployment is time-efficient, because it does not involve MX changes. Post-delivery deployment does not disrupt mail flow. Post-delivery deployment allows you to enable auto-move events to hard or soft delete messages, and synchronize your directory when you use Microsoft Graph API or Google Workspace.

Note

When you choose post-delivery deployment:

- The threat is removed after the message has been delivered to the inbox.
- It requires API scopes, or BCC/Journaling rule configuration.
- Auto-move is only available in BCC/Journaling if you associate an integration.

### Pre-delivery deployment

When you choose pre-delivery deployment, Cloudflare scans emails before they reach a users' inbox. The MX record points to Cloudflare.

#### Why you should consider pre-delivery deployment

Pre-delivery deployment provides you with the highest level of protection. It enforces text add-ons or link rewrite at delivery.

Pre-delivery blocks threats in transit, and it adds banners or texts before the user views the email.

Note

When you choose pre-delivery deployment:

- You must edit MX records or create a connector.
- You can enable auto-move events only after you associate an integration.
- Cloudflare egress IPs are allowed on downstream mail servers.

## 2. Understand dispositions

Dispositions allow you to configure policies and tune reporting. For example, you can configure a policy to move suspicious emails to your junk folder.

Refer to Dispositions to learn more about dispositions.

## 3. Set up the impersonation registry

Most business email compromise (BEC) ‚Üó targets executives or finance roles. You must add addresses of roles who are likely to be impersonated. Refer to Impersonation registry to learn how to add a user to the impersonation registry.

Roles you may want to include in the impersonation registry are:

- C-suites
- Finance roles
- HR
- IT help-desk
- Legal

You should review your impersonation registry on a quarterly basis as roles change.

## 4. Reclassify messages

A reclassification is a change to an email's disposition after initial scanning. It is Cloudflare's built-in feedback loop for correcting false positives/negatives and training the detection models to get smarter over time. Refer to Reclassify messages to learn how to reclassify a message.

### Who can reclassify messages

Security teams and end users can submit a reclassification.

### Why you should reclassify messages

Reclassifications are critical because:

- They help improve model accuracy: Every validated reclassification teaches Cloudflare's machine learning to recognise new lures, language, infrastructure, and benign patterns.
- They reduce alert fatigue: Correcting Suspicious or Spam emails that users actually want tailors detections to your organization, cutting noise in the dashboard.
- They close the remediation loop: When a disposition is upgraded to Malicious, Cloudflare auto-moves those emails out of every inbox (Graph API or Google Workspace API integrations).
- They can help you log activity taken on any reclassification: Each reclassification displays a submission ID, details about original, requested and final dispositions, and more. Refer to Reclassify messages to learn more about reclassifications.

To make the most of reclassifications:

1. Review reclassifications on a weekly basis.
2. Ensure you have an integration associated with any MX/Inline deployment. When you associate an integration, you will not need to upload the EMLs every time; Cloudflare can use APIs to receive a copy of your email messages.
3. Investigate any increase in user submissions (users may have found a phish that bypassed filters) and confirm that analyst-final dispositions align with your policies.

A correct use of reclassifications ensures that Email Security delivers a stronger protection with less manual tuning.

## 5. Configuration checklist

Follow the below checklist to ensure your email environment is set up correctly:

| Step | Post-delivery | Pre-delivery |
| --- | --- | --- |
| Authorize integration (Graph API or Google Workspace) | Required1 | Required 2 |
| Associate an integration with an MX/Inline domain |  | Required |
| Add/verify domains | Required | Required |
| Update MX records/connector, then allow Cloudflare egress IPs on downstream mail server |  | Required |
| Enable Post‚Äëdelivery response and Phish submission response | Required | Required |
| Populate impersonation registry and allow/block lists | Required | Required |
| Configure partner domain TLS and admin quarantine |  | Required |
| Configure text add-ons and link actions |  | Required |
| Send a test email and verify it appears in Monitoring > Email activity with expected disposition | Required | Required |

Now that you know which deployment path to choose, you can begin your onboarding process.

## Footnotes

1. Associating an integration with BCC/Journaling is required for post-delivery but not for pre-delivery. ‚Ü©
2. Still used for directory/auto‚Äëmove insight if desired as well as authorizing free API CASB. ‚Ü©

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## API deployment

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/api/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/api/)

Page options # API deployment

When you choose an API deployment, email messages only reach Email Security after they have already reached a user's inbox.

Then, through an integration with your email provider, Email Security can auto-move messages based on your organization's policies.

## Benefits

When you choose API deployment, you get the following benefits:

- Easy protection for complex email architectures, without requiring any change to mailflow operations.
- Agentless deployment for Microsoft 365.

## Limitations

However, API deployment also has the following disadvantages:

- Email Security is dependent on Microsoft's Graph API, and outages will increase the message dwell time in the inbox.
- Your email provider may throttle API requests from Email Security.
- Email Security requires read and write access to mailboxes.
- Requires API support from your email provider (does not typically support on-premise providers).
- Detection rates may be lower if multiple solutions exist.
- Messages cannot be modified or quarantined.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Set up with Microsoft 365

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/api/m365-api/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/api/m365-api/)

Page options # Set up with Microsoft 365

This guide will instruct you through setting up Microsoft 365 with Email Security via the Cloudflare dashboard.

## Prerequisites

To use Email Security, you will need to have:

- A Cloudflare account ‚Üó
- A Zero Trust organization
- A domain to protect

## Enable Email Security via the dashboard

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Overview. Select one of the following options depending on your use case:

- If you have not purchased Email Security, select Contact sales.
- If you have not associated any integration:

Select Set up.
Choose MS Graph API > Authorize.
Refer to Enable Microsoft integration to continue the onboarding process.
- Select Set up.
- Choose MS Graph API > Authorize.
- Refer to Enable Microsoft integration to continue the onboarding process.
- If you have associated an integration, but have not connected a domain:

Select Connect a domain.
Choose MS Graph API. Refer to Connect your domains to connect your domain(s).
- Select Connect a domain.
- Choose MS Graph API. Refer to Connect your domains to connect your domain(s).

### Enable Microsoft integration

To enable Microsoft integration:

1. Name integration: Add your integration name, then select Continue.
2. Authorize integration:

Select Authorize. Selecting Authorize will take you to the Microsoft Sign in page where you will have to enter your email address.
Once you enter your email address, select Next.
After selecting Next, the system will show a dialog box with a list of requested permissions. Select Accept to authorize Email Security. Upon authorization, you will be redirected to a page where you can review details and enroll integration.
3. Select Authorize. Selecting Authorize will take you to the Microsoft Sign in page where you will have to enter your email address.
4. Once you enter your email address, select Next.
5. After selecting Next, the system will show a dialog box with a list of requested permissions. Select Accept to authorize Email Security. Upon authorization, you will be redirected to a page where you can review details and enroll integration.
6. Review details: Review your integration details, then:

Select Complete Email Security set up where you will be able to connect your domains and configure auto-moves.
Select Continue to Email Security.
7. Select Complete Email Security set up where you will be able to connect your domains and configure auto-moves.
8. Select Continue to Email Security.

Continue with Connect your domains for the next steps.

### Connect your domains

On the Set up Email Security page, you will be able to connect your Microsoft domains. To connect your domains:

1. Connect domains: Select at least one domain. Then, select Continue.
2. (Optional) Modify default scanning: You can configure which folder Email Security can scan.
3. (Optional - select Skip for now to skip this step) Redirect messages: Refer to Auto-moves to learn what auto-moves are, and how to configure auto-moves.
4. Review details: Review your connected domains, then select Go to Domains.

Your domains are now connected successfully.

### Connect new domains

To connect new domains:

1. In Zero Trust ‚Üó, select Email Security.
2. Select Settings > Domain management > Domains, then select View.
3. Select Add a domain.
4. Select a method for connecting your mail environment to Email Security:

If you select MS Graph API, refer to Enable Microsoft integration.
If you select BCC/Journaling, choose how to connect your domains:

If you select Integrate with MS, refer to Enable Microsoft integration.
If you select Integrate with Google, refer to Connect your domains.
If you select Manual add, refer to Enter domain manually.
5. If you select MS Graph API, refer to Enable Microsoft integration.
6. If you select BCC/Journaling, choose how to connect your domains:

If you select Integrate with MS, refer to Enable Microsoft integration.
If you select Integrate with Google, refer to Connect your domains.
If you select Manual add, refer to Enter domain manually.
7. If you select Integrate with MS, refer to Enable Microsoft integration.
8. If you select Integrate with Google, refer to Connect your domains.
9. If you select Manual add, refer to Enter domain manually.

## Prevent Cloudflare from scanning a domain

If you want to prevent Cloudflare from scanning a domain:

1. In Zero Trust ‚Üó, select Email Security.
2. Go to Settings > Domain management > Domains, then select View.
3. On the Domain management page, select the domain you do not want to be scanned.
4. Select the three dots > Stop scanning.

## View an integration

To view the integration for each connected domain:

1. In Zero Trust ‚Üó, select Email Security.
2. Go to Settings > Domain management > Domains, then select View.
3. Select a domain.
4. Select the three dots > View integration.

Once you have set up Email Security to scan through your inbox, Email Security will display detailed information about your inbox. Refer to Monitor your inbox to learn more.

## Next steps

Enable logs to send detection data to an endpoint of your choice.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Overview

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/gmail-bcc-setup/gmail-bcc-setup/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/gmail-bcc-setup/gmail-bcc-setup/)

Page options # Overview

For customers using Gmail as their email provider, setting up Email Security is quick and easy.

You will need to create an integration, add BCC rules, and connect your domain(s). You can choose to add additional domains at a later stage.

Once you set up Google integration, Email Security will receive a copy of your email messages. You will need a Google integration to enable auto-moves.

The following email flow shows how this works:

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Enable Gmail BCC integration

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/gmail-bcc-setup/enable-gmail-integration/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/gmail-bcc-setup/enable-gmail-integration/)

Page options # Enable Gmail BCC integration

## Prerequisites

To use Email Security, you will need to have:

- A Cloudflare account ‚Üó
- A Zero Trust organization
- A domain to protect

## Enable Gmail BCC integration:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Overview. Select one of the following options:

- If you have not purchased Email Security, select Contact sales.
- If you have not associated any integration:

Select Set up, then choose BCC/Journaling.
Select Integrate with Google > Authorize.
Name your integration, then select Next.
Go to step 1 to continue the process of associating an integration.
- Select Set up, then choose BCC/Journaling.
- Select Integrate with Google > Authorize.
- Name your integration, then select Next.
- Go to step 1 to continue the process of associating an integration.
- If you have associated an integration, but have not connected a domain:

Select Connect a domain.
Choose BCC/Journaling > Integrate with Google.
Refer to Connect your domains to connect your domain(s).
- Select Connect a domain.
- Choose BCC/Journaling > Integrate with Google.
- Refer to Connect your domains to connect your domain(s).

### 1. Create a Service Account in your GCP Project

1. Once you have named your integration, select Next.
2. On the Google Cloud Console ‚Üó, go to the sidebar, select APIs & Services, then select Credentials.
3. Select CREATE CREDENTIALS > Service account.
4. Fill in the details to create a service account:

Service account name: Enter Cloudflare Google Integration.
Service account ID: Enter cloudflare-google-integration.
Service account description: Enter Cloudflare Google Integration.
Select CREATE AND CONTINUE.
5. Service account name: Enter Cloudflare Google Integration.
6. Service account ID: Enter cloudflare-google-integration.
7. Service account description: Enter Cloudflare Google Integration.
8. Select CREATE AND CONTINUE.

### 2. Create a JSON Key for your Service Account

On the Google Cloud Console ‚Üó, select Service Accounts on the sidebar: - Select the three dots, then: - Select Manage keys. - Select ADD KEY > Create new key. - Select JSON > Select CREATE. This downloads a .json file which you will use at a later stage.

### 3. Upload JSON Key

On the Zero Trust dashboard ‚Üó, upload the .json file downloaded on step 3.

### 4. Enable Necessary Google Workspace APIs in GCP

Enable the following APIs on the Google Cloud Console: - Enable Google Calendar API ‚Üó - Enable Google Drive API ‚Üó - Enable Google Admin SDK API ‚Üó - Enable Gmail API ‚Üó - Enable Google Service Usage API ‚Üó

### 5. Log in to Google Workspace Admin Console

Log in to Google Workspace Admin Console: Enter your password and log in to the Google Workspace Admin Console.

### 6. Create a Domain-Wide Delegation API Client

1. Copy the Client ID and Scopes displayed on the Zero Trust dashboard.
2. On Google Admin, go to Security > Access and data control > API controls.
3. Select MANAGE DOMAIN WIDE DELEGATION > Add new.
4. Use the Client ID and copy the scopes to create a new API client. Refer to Delegate domain-wide authority to your service account ‚Üó. Then, select Next.

### 7. Confirm Workspace Administrator Email

Enter the email associated with the Google Workspace Administrator account. Your email must match the email associated with your Google Workspace account, or else your integration will not work.

### 8. Create integration

1. Select Create integration.
2. Once you created your integration, you will be redirected to the Review details page, where you will be able to review Integration details.
3. Review your details, then select Complete Email Security set up > Continue to Email Security.

## Verify integration

To verify that the integration has been successful:

1. In Zero Trust ‚Üó, go to Email Security.
2. Go to Settings (the gear icon) > SaaS integrations.
3. Go to your integration, and ensure that the integration displays CASB+EMAIL under Type.

Note

If you do not reach the step to complete the Email Security set up:

1. Go to Settings (the gear icon) > SaaS Integrations.
2. Delete the integration, if present. Locate your integration, select Configure, then select Delete.
3. Follow the steps from the beginning to enable Gmail BCC integration.

## Next steps

Now that you have created an integration:

- Connect your domains for Email Security to start scanning your inbox.
- Enable logs to send detection data to an endpoint of your choice.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect your domains

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/gmail-bcc-setup/connect-domains/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/gmail-bcc-setup/connect-domains/)

Page options # Connect your domains

To connect your domains, you will need to enable your Gmail BCC integration. Once you have enabled your Gmail BCC integration, the Cloudflare dashboard will redirect you to the Set up Email Security page.

On the Set up Email Security page:

1. Connect domains: Select at least one domain. Then, select Continue.
2. (Optional) Add manual domains: Select Add domain name to manually enter additional domains. Then, select Continue.
3. (Optional) Adjust hop count: Enter the number of hops. Then, select Continue.
4. (Optional, select Skip for now to skip this step) Move messages: Refer to Auto-moves to configure auto-moves. Then, select Continue.
5. Configure service address with your third party email provider: Copy the service address into your third-party email provider to allow BCC/Journaling: <account tag>@CF-emailsecurity.com. You will need to paste this address in step 7 in Add BCC rules, where you will replace your recipient.
6. Review details: Review your connected domains. Then, select Go to domains.

Your domains are now added successfully.

On the Domains page, select the three dots > View integration. The dashboard will display your domain information.

Under Source, the dashboard will display Google integration, along with the Integration name.

## Add additional domains

To add additional domains:

1. In Zero Trust ‚Üó, go to Email Security > Settings.
2. Select Connect an integration > BCC/Journaling > Integrate with Google > Authorize.
3. Connect domains: Select the domains you want to add, then select Next.
4. (Optional) Select Add manual domains: Enter additional domains manually, then select Next.
5. (Optional) Select Adjust hop count: Enter the number of hops.
6. Review details: Review your selected domains, then use the following email to configure the service address with your third-party email provider:
<account tag>@CF-emailsecurity.com
7. Select Save.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Add BCC rules

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/gmail-bcc-setup/add-bcc-rules/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/gmail-bcc-setup/add-bcc-rules/)

Page options # Add BCC rules

1. Log in to the Google Admin Console ‚Üó.
2. On the sidebar, go to Apps > Google Workspace > Gmail > Compliance.
3. Go to Content Compliance > Select Edit.
4. Add a Content Compliance filter, and name it Email Security - BCC.
5. In Email messages to affect, select Inbound.
6. Select the recipients you want to send emails to Email Security via BCC. Under Add expressions that describe the content you want to search for in each message:

Select If ANY of the following match the message.
Select Add to configure the expression.

Select Advanced content match.
In Location, select Headers + Body.
In Match type, select Matches regex.
In Regexp, input .*. You can customize the regex as needed and test within the admin page or on sites like Regexr ‚Üó.
Select SAVE.
7. Select If ANY of the following match the message.
8. Select Add to configure the expression.

Select Advanced content match.
In Location, select Headers + Body.
In Match type, select Matches regex.
In Regexp, input .*. You can customize the regex as needed and test within the admin page or on sites like Regexr ‚Üó.
Select SAVE.
9. Select Advanced content match.
10. In Location, select Headers + Body.
11. In Match type, select Matches regex.
12. In Regexp, input .*. You can customize the regex as needed and test within the admin page or on sites like Regexr ‚Üó.
13. Select SAVE.
14. In If the above expressions match, do the following:

Select Modify message.

Ensure that Envelope recipient > Change envelope recipient is unselected, so that emails will not be dropped as an unintended consequence. You will select this option at a later stage.
Go to Also deliver to, select Add more recipients > ADD > Choose Advanced:

Under Envelope recipient, select Change envelope recipient > Replace recipient > Enter the service address. This is the service address you copied and pasted in step 5 when connecting your domains.
If you did not copy and paste the service address:

In Zero Trust ‚Üó, go to Email Security.
Go to Settings and locate your domain under Your domains.
Select the three dots > View domain > Service address. Copy and paste the service address.


Under Spam and delivery options, select Suppress bounces from this recipient.
Under Headers, select Add X-Gm-Spam and X-Gm-Phishy headers.
Select SAVE.
15. Select Modify message.

Ensure that Envelope recipient > Change envelope recipient is unselected, so that emails will not be dropped as an unintended consequence. You will select this option at a later stage.
Go to Also deliver to, select Add more recipients > ADD > Choose Advanced:

Under Envelope recipient, select Change envelope recipient > Replace recipient > Enter the service address. This is the service address you copied and pasted in step 5 when connecting your domains.
If you did not copy and paste the service address:

In Zero Trust ‚Üó, go to Email Security.
Go to Settings and locate your domain under Your domains.
Select the three dots > View domain > Service address. Copy and paste the service address.


Under Spam and delivery options, select Suppress bounces from this recipient.
Under Headers, select Add X-Gm-Spam and X-Gm-Phishy headers.
Select SAVE.
16. Ensure that Envelope recipient > Change envelope recipient is unselected, so that emails will not be dropped as an unintended consequence. You will select this option at a later stage.
17. Go to Also deliver to, select Add more recipients > ADD > Choose Advanced:

Under Envelope recipient, select Change envelope recipient > Replace recipient > Enter the service address. This is the service address you copied and pasted in step 5 when connecting your domains.
If you did not copy and paste the service address:

In Zero Trust ‚Üó, go to Email Security.
Go to Settings and locate your domain under Your domains.
Select the three dots > View domain > Service address. Copy and paste the service address.


Under Spam and delivery options, select Suppress bounces from this recipient.
Under Headers, select Add X-Gm-Spam and X-Gm-Phishy headers.
Select SAVE.
18. Under Envelope recipient, select Change envelope recipient > Replace recipient > Enter the service address. This is the service address you copied and pasted in step 5 when connecting your domains.
If you did not copy and paste the service address:

In Zero Trust ‚Üó, go to Email Security.
Go to Settings and locate your domain under Your domains.
Select the three dots > View domain > Service address. Copy and paste the service address.
19. In Zero Trust ‚Üó, go to Email Security.
20. Go to Settings and locate your domain under Your domains.
21. Select the three dots > View domain > Service address. Copy and paste the service address.
22. Under Spam and delivery options, select Suppress bounces from this recipient.
23. Under Headers, select Add X-Gm-Spam and X-Gm-Phishy headers.
24. Select SAVE.
25. In Account types to affect, select Users and Groups.
26. Select SAVE.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Enable auto-moves

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/gmail-bcc-setup/enable-auto-moves/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/gmail-bcc-setup/enable-auto-moves/)

Page options # Enable auto-moves

If you do not have an integration:

1. In Zero Trust ‚Üó, go to Email Security.
2. Go to Settings > Domain management > Domains > select View.
3. Locate your domain, select the three dots > Select Associate an integration.
4. Select Connect an integration. You will then be redirected to the Add an integration page.
5. Select Google Workspace CASB+EMAIL > Select Integration.
6. Once you select an integration, you can enable Gmail BCC integration.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Microsoft Exchange BCC setup

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/bcc-microsoft-exchange/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/bcc-microsoft-exchange/)

Page options # Microsoft Exchange BCC setup

For customers using Microsoft Exchange, setting up Email Security via BCC is quick and easy. You need to configure an inbound rule to send emails to Email Security via BCC for processing and detection of potential phishing attacks. The following email flow shows how this works:

## Configure Inbound Rule

1. Access Exchange's Management Console, and go to Organization Configuration > Hub Transport.
2. On the Actions pane, select New Transport Rule.
3. Give the transport rule a name and a description and select Next.
4. In the Condition configuration panel, select the option from users that are inside or outside the organization option. In the dropdown that opens, select Outside the organization.
5. Still in the same Condition configuration panel, add a second condition to the transport rule. Select sent to users that are inside or outside the organization, or partners. Keep the default value of Inside the organization.
6. Select Next.
7. In the Action configuration panel, select Blind carbon copy (Bcc) the message to addresses. Edit the addresses variable to add the addresses you want to copy as BCC.
8. In Specify Recipient, select the down arrow next to the Add button > External E-Mail Address.
9. Enter the BCC address provided by Email Security. This address is specific to your account.
10. Select OK > OK to return to the main configuration page of the transport rule.
11. At the main configuration page of the transport rule, select Next to continue to the Exception configuration panel.
12. You do not need to configure an exception rule. Select Next.
13. In Create Rule, select the New button.
14. Select Finish to close the transport rule configuration panel. This will return you to the Exchange Management Console.

Note

If you have multiple rules, you may need to change the order of the BCC rule and move it to the right location in your rule sequence. This is needed so you can send BCC messages to Email Security. Usually, the Email Security BCC rule will be at the top of the ruleset. The configured conditions of the Email Security BCC rule will only trigger for inbound messages.

## Email processing and reports

In BCC mode, all emails are put through automated phishing detections by Email Security. Emails that trigger phishing detections are logged for reporting via product portal, email and Slack. Emails that do not trigger any detections are deleted.

## Next steps

Enable logs to send detection data to an endpoint of your choice.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Microsoft 365 journaling setup

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/journaling-setup/m365-journaling/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/journaling-setup/m365-journaling/)

Page options # Microsoft 365 journaling setup

When you receive an email, the email lands on your Microsoft 365 inbox, and then Email Security receives a copy of that email. The following email flow shows how this works:

To enable Microsoft 365 journaling deployment:

1. Log in to Zero Trust ‚Üó > Email Security.
2. Select Overview. If you have not purchased Email Security, select Contact Sales. Otherwise, select Set up > BCC/Journaling.
3. Select Integrate with MS > Authorize.
4. Continue with Integrate with Microsoft 365 to connect your Microsoft integration.

## 1. Integrate with Microsoft 365

To integrate with Microsoft 365:

1. Name integration: Add your integration name, then select Continue.
2. Authorize integration:

Select Authorize. Selecting Authorize will take you to the Microsoft Sign in page where you will have to enter your email address.
Once you enter your email address, select Next.
After selecting Next, the dashboard will show you a dialog box with a list of requested permissions. Select Accept to authorize Email Security. Upon authorization, you will be redirected to a page where you can review details and enroll the integration.
3. Select Authorize. Selecting Authorize will take you to the Microsoft Sign in page where you will have to enter your email address.
4. Once you enter your email address, select Next.
5. After selecting Next, the dashboard will show you a dialog box with a list of requested permissions. Select Accept to authorize Email Security. Upon authorization, you will be redirected to a page where you can review details and enroll the integration.
6. Review details: Review your integration details, then:

Select Complete Email Security set up where you will be able to connect your domains and configure auto-moves.
Select Continue to Email Security.
7. Select Complete Email Security set up where you will be able to connect your domains and configure auto-moves.
8. Select Continue to Email Security.

Continue with Connect your domains for the next steps.

### Connect your domains

On the Set up Email Security page:

1. Connect domains: Select at least one domain. Then, select Continue.
2. (Optional) Add manual domains: Select Add domain name to manually enter additional domains. Then, select Continue.
3. (Optional) Adjust hop count: Enter the number of hops. Then, select Continue.
4. (Optional, select Skip for now to skip this step) Move messages: Refer to Auto-moves to configure auto-moves. Then, select Continue.
5. Configure service address with your third party email provider: Copy and paste the service address into your third-party email provider to allow BCC/Journaling: <account tag>@CF-emailsecurity.com.
6. Review details: Review your connected domains. Then, select Go to domains.

Your domains are now added successfully.

To view your connected domains:

1. Go to Settings.
2. Locate your domain, select the three dots > View domain. Selecting View domain will display information about your domain.

## 2. Configure journal rule

1. Log in to the Microsoft Purview compliance portal ‚Üó.
2. On the sidebar, go to Settings (the gear icon) > Data Lifecycle Management > Exchange (legacy).
3. In Send undeliverable journal reports to enter the email address of a valid user account. Note that you cannot use a team or group address. Select Save once you entered the email address.
4. On the sidebar, go to Solutions > Data Lifecycle Management > Exchange (legacy).
5. Select Journal rules.
6. Select New rule to configure a journaling rule, and configure it as follows:

Send journal reports to: This is the address you copied and pasted in step 5 of Connect your domains.
Journal rule name: Journal Messages to Email Security
Journal messages sent or received from: Everyone
Type of message to journal: External messages only
7. Send journal reports to: This is the address you copied and pasted in step 5 of Connect your domains.
8. Journal rule name: Journal Messages to Email Security
9. Journal messages sent or received from: Everyone
10. Type of message to journal: External messages only
11. Select Next.
12. Verify the information is correct, and select Submit > Done.

Once saved, the rule is automatically active. However, it may take a few minutes for the configuration to propagate and start pushing messages to Email Security. After it propagates, you can monitor your inbox in the Cloudflare dashboard to check the number of messages processed. This number will grow as journaled messages are sent to Email Security from your Exchange server.

## Next steps

Enable logs to send detection data to an endpoint of your choice.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Manually add domains

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/journaling-setup/manual-add/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/journaling-setup/manual-add/)

Page options # Manually add domains

## Prerequisites

To use Email Security, you will need to have:

- A Cloudflare account ‚Üó
- A Zero Trust organization
- A domain to protect

## Manually add domains

1. Log in to Zero Trust ‚Üó > Email Security.
2. Select Overview. If you have not purchased Email Security, select Contact Sales. Otherwise, select Set up > BCC/Journaling.
3. Select Manual add.

## Users with domains on Cloudflare

On the Set up Email Security page:

1. Connect domains: Select at least one domain. Then, select Continue.
2. (Optional) Add manual domains: Manually enter additional domains. Then, select Continue.
3. (Optional) Adjust hop count: Enter the number of hops, and then select Continue.
4. Configure service address with your third party email provider: Copy and paste the service address into your third-party email provider to allow BCC/Journaling: <account tag>@CF-emailsecurity.com
5. Review details: Review your connected domains. Then, select Go to domains.

## Users who do not have domains with Cloudflare

If you do not have domains with Cloudflare, the Cloudflare dashboard will display two options:

- Add a domain to Cloudflare.
- Enter domain manually.

### Add a domain to Cloudflare

Selecting Add a domain to Cloudflare will redirect you to a new page where you will connect your domain to Cloudflare. Once you have entered an existing domain, select Continue.

### Enter domain manually

On the Set up Email Security page:

1. Connect domains: Select at least one domain. Then, select Continue.
2. (Optional) Add manual domains: Manually enter additional domains. Then, select Continue.
3. (Optional) Adjust hop count: Enter the number of hops, and then select Continue.
4. Configure service address with your third party email provider: Copy and paste the service address into your third-party email provider to allow BCC/Journaling: <account tag>@CF-emailsecurity.com.
5. Review details: Review your connected domains. Then, select Go to domains.

## Enable auto-moves

To enable auto-move events, you will have to associate an integration.

To associate an integration:

1. Log in to Zero Trust ‚Üó > Email Security.
2. Go to Settings > Domain management > Domains > Select View.
3. On the Domain management page, locate your domain, select the three dots, then select Associate an integration.
4. Select Connect an integration. Follow the steps to enable the Microsoft 365 integration.
5. Select the three dots, then select Associate an integration. Select the integration, then select Associate.

Now that your domain has an associated integration, enable auto-move events on your domain.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Microsoft 365 as MX Record

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/)

Page options # Microsoft 365 as MX Record

In this tutorial, you will learn how to configure Microsoft 365 with Email Security as its MX record.

## Prerequisites

To ensure changes made in this tutorial take effect quickly, update the Time to Live (TTL) value of the existing MX records on your domains to five minutes. Do this on all the domains you will be deploying.

Changing the TTL value instructs DNS servers on how long to cache this value before requesting an update from the responsible nameserver. You need to change the TTL value before changing your MX records to Email Security. This will ensure that changes take effect quickly and can also be reverted quickly if needed. If your DNS manager does not allow for a TTL of five minutes, set it to the lowest possible setting.

Note

Make TTL changes a few days before the production update, and wait at least as long as the old TTL values before making the update, since some senders might still be using the old cached values.

To check your existing TTL, open a terminal window and run the following command against your domain:

Terminal window ```
dig mx <YOUR_DOMAIN>
```

```
; <<>> DiG 9.10.6 <<>> mx <YOUR_DOMAIN>;; global options: +cmd;; Got answer:;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 39938;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 1
;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 4096;; QUESTION SECTION:;<YOUR_DOMAIN>.    IN  MX
;; ANSWER SECTION:<YOUR_DOMAIN>.    300    IN    MX    10 mxa.global.inbound.cf-emailsecurity.net.<YOUR_DOMAIN>.    300    IN    MX    10 mxb.global.inbound.cf-emailsecurity.net.
```

In the above example, TTL is shown in seconds as 300 (or five minutes).

If you are using Cloudflare for DNS, you can leave the TTL setting as Auto.

Below is a list with instructions on how to edit MX records for some popular services:

- Cloudflare: Set up email records
- GoDaddy: Edit an MX Record ‚Üó
- AWS: Creating records by using the Amazon Route 53 console ‚Üó
- Azure: Create DNS records in a custom domain for a web app ‚Üó

## 1. Add Email Security IP addresses to Allow List

1. Go to the Anti-spam policies page ‚Üó > Select Edit connection filter policy.
2. In Always allow messages from the following IP addresses or address range, add IP addresses and CIDR blocks mentioned in Egress IPs.
3. Select Save.
4. Microsoft recommends disabling SPF Hard fail when an email solution is placed in front of it:

Return to the Anti-spam option ‚Üó.
Select Default anti-spam policy.
Select Edit spam threshold and properties ‚Üó > Mark as spam > SPF record: hard fail, and ensure it is set to Off.
5. Return to the Anti-spam option ‚Üó.
6. Select Default anti-spam policy.
7. Select Edit spam threshold and properties ‚Üó > Mark as spam > SPF record: hard fail, and ensure it is set to Off.
8. Select Save.

## 2. Configure Enhanced Filtering

### Create an inbound connector

1. Set up a connector ‚Üó.
2. Select Partner organization under Connection from.

Provide a name for the connector:

Name: Email Security Inbound Connector
Description: Inbound connector for Enhanced Filtering
3. Provide a name for the connector:

Name: Email Security Inbound Connector
Description: Inbound connector for Enhanced Filtering
4. Name: Email Security Inbound Connector
5. Description: Inbound connector for Enhanced Filtering
6. In Authenticating sent email, select By verifying that the IP address of the sending server matches one of the following IP addresses, which belongs to your partner organization.
7. Enter all of the egress IPs in the Egress IPs page.
8. In Security restrictions, accept the default Reject email messages if they aren't sent over TLS setting.

### Enable enhanced filtering

Now that the inbound connector has been configured, you will need to enable the enhanced filtering configuration of the connector.

1. Go to the Security admin console ‚Üó, and enable enhanced filtering ‚Üó.
2. Select Automatically detect and skip the last IP address and Apply to entire organization.
3. Select Save.

## 3. Configure anti-spam policies

To configure anti-spam policies:

1. Open the Microsoft 365 Defender console ‚Üó.
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Policies, select Anti-spam.
5. Select the Anti-spam inbound policy (Default) text (not the checkbox).
6. In Actions, scroll down and select Edit actions.
7. Set the following conditions and actions (you might need to scroll up or down to find them):

- Spam: Move messages to Junk Email folder.
- High confidence spam: Quarantine message.

Select quarantine policy: AdminOnlyAccessPolicy.
- Select quarantine policy: AdminOnlyAccessPolicy.
- Phishing: Quarantine message.

Select quarantine policy: AdminOnlyAccessPolicy.
- Select quarantine policy: AdminOnlyAccessPolicy.
- High confidence phishing: Quarantine message.

Select quarantine policy: AdminOnlyAccessPolicy.
- Select quarantine policy: AdminOnlyAccessPolicy.
- Retain spam in quarantine for this many days: Default is 15 days. Email Security recommends 15-30 days.

Select the spam actions in the above step:
- Select the spam actions in the above step:

1. Select Save.

## 4. Create transport rules

To create the transport rules that will send emails with certain dispositions to Email Security:

1. Open the new Exchange admin center ‚Üó.
2. Go to Mail flow > Rules.
3. Select Add a Rule > Create a new rule.
4. Set the following rule conditions:

Name: Email Security Deliver to Junk Email folder.
Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: BULK > Add > Save.


Apply this rule if: Select + to add a second condition.
And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs mentioned in Egress IPs.
Do the following - Modify the message properties > Set the Spam Confidence Level (SCL) > 5.
5. Name: Email Security Deliver to Junk Email folder.
6. Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: BULK > Add > Save.
7. Enter text: X-CFEmailSecurity-Disposition > Save.
8. Enter words: BULK > Add > Save.
9. Apply this rule if: Select + to add a second condition.
10. And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs mentioned in Egress IPs.
11. Do the following - Modify the message properties > Set the Spam Confidence Level (SCL) > 5.
12. Select Next.
13. You can use the default values on this screen. Select Next.
14. Review your settings and select Finish > Done.
15. Select the rule Email Security Deliver to Junk Email folder you have just created, and Enable.
16. Select Add a Rule > Create a new rule.
17. Set the following rule conditions:

Name: Email Security Deliver to Junk Email folder.
Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: MALICIOUS, UCE, SPOOF > Add > Save.


Apply this rule if: Select + to add a second condition.
And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs.
Do the following: Redirect the message to > hosted quarantine.
18. Name: Email Security Deliver to Junk Email folder.
19. Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: MALICIOUS, UCE, SPOOF > Add > Save.
20. Enter text: X-CFEmailSecurity-Disposition > Save.
21. Enter words: MALICIOUS, UCE, SPOOF > Add > Save.
22. Apply this rule if: Select + to add a second condition.
23. And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs.
24. Do the following: Redirect the message to > hosted quarantine.
25. Select Next.
26. You can use the default values on this screen. Select Next.
27. Review your settings and select Finish > Done.
28. Select the rule you have just created, and select Enable.

## 5. Set up MX/Inline

Now that you have completed the prerequisite steps, set up MX/Inline on the Cloudflare dashboard. Refer to Set up MX/Inline deployment for the next steps.

## 6. (Recommended) Secure Microsoft 365 from MX records bypass

One method of a DNS attack is to search for old MX records and send phishing emails directly to the mail server. To secure the email flow, you should enforce an email flow where inbound messages are accepted by Microsoft 365 only when they originate from Email Security. This can be done by adding a connector to only allow email from Email Security with TLS encryption. This step is optional but recommended.

Important

This step should not be performed until 72 hours after all domains in your Microsoft 365 organization have been onboarded to Email Security, and Email Security is their MX record. If a domain has not been onboarded or DNS is still propagating, you will impact production email flow for that domain.

#### Create Connector

1. Go to the new Exchange admin center ‚Üó.
2. Go to Mail flow > Connectors.
3. Select Add a connector.
4. Go to Connection from > Partner organization.
5. Select Next.
6. Set the following options:

Name - Secure M365 Inbound
Description - Only accept inbound email from Email Security
7. Name - Secure M365 Inbound
8. Description - Only accept inbound email from Email Security
9. Select Next.
10. Make sure By Verifying that the sender domain matches one of the following domains is selected.
11. Enter * in the text field, and select +.
12. Select Next.
13. Make sure Reject email messages if they aren't sent over TLS is selected.
14. Still in the same screen, select Reject email messages if they aren't sent from within this IP address range, and enter all the egress IPs in the Egress IPs page.
15. Select Next.
16. Review your settings and select Create connector.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## 1 - Junk email and Email Security Admin Quarantine

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/use-cases/one-junk-admin-quarantine/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/use-cases/one-junk-admin-quarantine/)

Page options # 1 - Junk email and Email Security Admin Quarantine

In this tutorial, you will learn how to deliver emails to the Microsoft 365 junk email folder and the Admin Quarantine in Email Security.

## Create quarantine policies

To create quarantine policies:

1. Open the Microsoft 365 Defender console ‚Üó
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Rules, select Quarantine policies.
5. Select Add custom policy.
6. Set the Policy name to UserNotifyAdminRelease.
7. Select Next.
8. In Recipient message access, select Set specific access (Advanced), and then:

In Select release action preference, choose Allow recipients to request a message to be released from quarantine.
In Select additional actions recipients can take on quarantined messages, select the Delete and Preview checkboxes.
9. In Select release action preference, choose Allow recipients to request a message to be released from quarantine.
10. In Select additional actions recipients can take on quarantined messages, select the Delete and Preview checkboxes.
11. Select Next.
12. In Quarantine notification, select Enable.
13. Select Next.
14. Review your settings and select Submit.
15. Select Done.

## Configure quarantine notifications

To configure quarantine notifications:

1. Open the Microsoft 365 Defender console ‚Üó.
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Rules, select Quarantine policies.
5. Select Global settings.
6. Scroll to the bottom and set the desired frequency in Send end-user spam notifications every (days). This value can only be incremented in days.
7. Select Save.

## Configure anti-spam policies

To configure anti-spam policies:

1. Open the Microsoft 365 Defender console ‚Üó.
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Policies, select Anti-spam.
5. Select the Anti-spam inbound policy (Default) text (not the checkbox).
6. In Actions, scroll down and select Edit actions.
7. Set the following conditions and actions (you might need to scroll up or down to find them):

- Spam: Move messages to Junk Email folder.
- High confidence spam: Quarantine message.

Select quarantine policy: _UserNotifyAdminRelease_.
- Select quarantine policy: _UserNotifyAdminRelease_.
- Phishing: Quarantine message.

Select quarantine policy: _UserNotifyAdminRelease_.
- Select quarantine policy: _UserNotifyAdminRelease_.
- High confidence phishing: Quarantine message.

Select quarantine policy: _UserNotifyAdminRelease_.
- Select quarantine policy: _UserNotifyAdminRelease_.
- Retain spam in quarantine for this many days: Default is 15 days. Email Security recommends 15-30 days.

Select the spam actions in the above step.
- Select the spam actions in the above step.

1. Select Save.

## Create transport rules

To create the transport rules that will send emails with certain dispositions to Email Security:

1. Open the new Exchange admin center ‚Üó.
2. Go to Mail flow > Rules.
3. Select Add a Rule > Create a new rule.
4. Set the following rule conditions:

Name: Email Security Deliver to Junk Email folder.
Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: BULK > Add > Save.


Apply this rule if: Select + to add a second condition.
And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
Do the following - Modify the message properties > Set the Spam Confidence Level (SCL) > 5.
5. Name: Email Security Deliver to Junk Email folder.
6. Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: BULK > Add > Save.
7. Enter text: X-CFEmailSecurity-Disposition > Save.
8. Enter words: BULK > Add > Save.
9. Apply this rule if: Select + to add a second condition.
10. And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
11. Do the following - Modify the message properties > Set the Spam Confidence Level (SCL) > 5.
12. Select Next.
13. You can use the default values on this screen. Select Next.
14. Review your settings and select Finish > Done.
15. Select the rule Email Security Deliver to Junk Email folder you have just created, and select Enable.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## 2 - Junk email and user managed quarantine

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/use-cases/two-junk-user-quarantine/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/use-cases/two-junk-user-quarantine/)

Page options # 2 - Junk email and user managed quarantine

In this tutorial, you will learn how to deliver BULK messages to the user's junk folder, and SPAM and SPOOF messages to the user managed quarantine.

## Create quarantine policies

To create quarantine policies:

1. Open the Microsoft 365 Defender console ‚Üó.
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Rules, select Quarantine policies.
5. Select Add custom policy.
6. Set the Policy name to UserNotifyUserRelease.
7. Select Next.
8. In Recipient message access, select Set specific access (Advanced), and then:

In Select release action preference, choose Allow recipients to release a message from quarantine.
In Select additional actions recipients can take on quarantined messages, select the Delete and Preview checkboxes.
9. In Select release action preference, choose Allow recipients to release a message from quarantine.
10. In Select additional actions recipients can take on quarantined messages, select the Delete and Preview checkboxes.
11. Select Next.
12. In Quarantine notification, select Enable.
13. Select Next.
14. Review your settings and select Submit.
15. Select Done.
16. Select Add custom policy.
17. Set the Policy name to UserNotifyAdminRelease.
18. Select Next.
19. In Recipient message access, select Set specific access (Advanced), and then:

In Select release action preference, from the drop-down menu, choose Allow recipients to request a message to be released from quarantine.
In Select additional actions recipients can take on quarantined messages, select the Delete and Preview checkboxes.
20. In Select release action preference, from the drop-down menu, choose Allow recipients to request a message to be released from quarantine.
21. In Select additional actions recipients can take on quarantined messages, select the Delete and Preview checkboxes.
22. Select Next.
23. In Quarantine notification, select Enable.
24. Select Next.
25. Review your settings and select Submit.
26. Select Done.

## Configure quarantine notifications

To configure quarantine notifications:

1. Open the Microsoft 365 Defender console ‚Üó.
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Rules, select Quarantine policies.
5. Select Global settings.
6. Scroll to the bottom and set the desired frequency in Send end-user spam notifications every (days). This value can only be incremented in days.
7. Select Save.

## Configure anti-spam policies

To configure anti-spam policies:

1. Open the Microsoft 365 Defender console ‚Üó.
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Policies, select Anti-spam.
5. Select the Anti-spam inbound policy (Default) text (not the checkbox).
6. In Actions, scroll down and select Edit actions.
7. Set the following conditions and actions (you might need to scroll up or down to find them):

- Spam: Move messages to Junk Email folder.
- High confidence spam: Quarantine message.

Select quarantine policy: _UserNotifyUserRelease_.
- Select quarantine policy: _UserNotifyUserRelease_.
- Phishing: Quarantine message.

Select quarantine policy: _UserNotifyAdminRelease_.
- Select quarantine policy: _UserNotifyAdminRelease_.
- High confidence phishing: Quarantine message.

Select quarantine policy: _UserNotifyAdminRelease_.
- Select quarantine policy: _UserNotifyAdminRelease_.
- Retain spam in quarantine for this many days: Default is 15 days. Email Security recommends 15-30 days.

Select the spam actions in the above step.
- Select the spam actions in the above step.

1. Select Save.

## Create transport rules

To create the transport rules that will send emails with certain disposition to Email Security:

1. Open the new Exchange admin center ‚Üó.
2. Go to Mail flow > Rules.
3. Select Add a Rule > Create a new rule.
4. Set the following rule conditions:

Name: `Email Security Deliver to Junk Email folder`.
Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: BULK > Add > Save.


Apply this rule if: Select + to add a second condition.
And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
Do the following - _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _5_.
5. Name: `Email Security Deliver to Junk Email folder`.
6. Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: BULK > Add > Save.
7. Enter text: X-CFEmailSecurity-Disposition > Save.
8. Enter words: BULK > Add > Save.
9. Apply this rule if: Select + to add a second condition.
10. And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
11. Do the following - _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _5_.
12. Select Next.
13. You can use the default values on this screen. Select Next.
14. Review your settings and select Finish > Done.
15. Select the rule `Email Security Deliver to Junk Email folder` you have just created, and Enable.
16. Select Add a Rule > Create a new rule.
17. Set the following rule conditions:

Name: `Email Security User Quarantine Message`.
Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: `UCE`, `SPOOF` > Add > Save.


Apply this rule if: Select + to add a second condition.
And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
Do the following: _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _9_.
18. Name: `Email Security User Quarantine Message`.
19. Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: `UCE`, `SPOOF` > Add > Save.
20. Enter text: X-CFEmailSecurity-Disposition > Save.
21. Enter words: `UCE`, `SPOOF` > Add > Save.
22. Apply this rule if: Select + to add a second condition.
23. And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
24. Do the following: _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _9_.
25. Select Next.
26. You can use the default values on this screen. Select Next.
27. Review your settings and select Finish > Done.
28. Select the rule `Email Security User Quarantine Message` you have just created, and select Enable.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## 3 - Junk email and administrative quarantine

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/use-cases/three-junk-admin-quarantine/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/use-cases/three-junk-admin-quarantine/)

Page options # 3 - Junk email and administrative quarantine

In this tutorial, you will learn how to deliver BULK messages to the users's junk email folder, and MALICIOUS, SPAM, and SPOOF messages to the administrative quarantine (this requires an administrator to release the emails).

## Create quarantine policies

To create quarantine policies:

1. Open the Microsoft 365 Defender console ‚Üó
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Rules, select Quarantine policies.
5. Select Add custom policy.
6. Set the Policy name to UserNotifyAdminRelease.
7. Select Next.
8. In Recipient message access, select Set specific access (Advanced), and then:

In Select release action preference, choose Allow recipients to request a message to be released from quarantine.
In Select additional actions recipients can take on quarantined messages, select the Delete and Preview checkboxes.
9. In Select release action preference, choose Allow recipients to request a message to be released from quarantine.
10. In Select additional actions recipients can take on quarantined messages, select the Delete and Preview checkboxes.
11. Select Next.
12. In Quarantine notification, select Enable.
13. Select Next.
14. Review your settings and select Submit.
15. Select Done.

## Configure quarantine notifications

To configure quarantine notifications:

1. Open the Microsoft 365 Defender console ‚Üó.
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Rules, select Quarantine policies.
5. Select Global settings.
6. Scroll to the bottom and set the desired frequency in Send end-user spam notifications every (days). This value can only be incremented in days.
7. Select Save.

## Configure anti-spam policies

To configure anti-spam policies:

1. Open the Microsoft 365 Defender console ‚Üó.
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Policies, select Anti-spam.
5. Select the Anti-spam inbound policy (Default) text (not the checkbox).
6. In Actions, scroll down and select Edit actions.
7. Set the following conditions and actions (you might need to scroll up or down to find them):

- Spam: Move messages to Junk Email folder.
- High confidence spam: Quarantine message.

Select quarantine policy: _UserNotifyAdminRelease_.
- Select quarantine policy: _UserNotifyAdminRelease_.
- Phishing: Quarantine message.

Select quarantine policy: _UserNotifyAdminRelease_.
- Select quarantine policy: _UserNotifyAdminRelease_.
- High confidence phishing: Quarantine message.

Select quarantine policy: _UserNotifyAdminRelease_.
- Select quarantine policy: _UserNotifyAdminRelease_.
- Retain spam in quarantine for this many days: Default is 15 days. Email Security recommends 15-30 days.

Select the spam actions in the above step.
- Select the spam actions in the above step.

1. Select Save.

## Create transport rules

To create the transport rules that will send emails with certain disposition to Email Security:

1. Open the new Exchange admin center ‚Üó.
2. Go to Mail flow > Rules.
3. Select Add a Rule > Create a new rule.
4. Set the following rule conditions:

Name: `Email Security Deliver to Junk Email folder`.
Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: BULK > Add > Save.


Apply this rule if: Select + to add a second condition.
And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
Do the following - _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _5_.
5. Name: `Email Security Deliver to Junk Email folder`.
6. Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: BULK > Add > Save.
7. Enter text: X-CFEmailSecurity-Disposition > Save.
8. Enter words: BULK > Add > Save.
9. Apply this rule if: Select + to add a second condition.
10. And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
11. Do the following - _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _5_.
12. Select Next.
13. You can use the default values on this screen. Select Next.
14. Review your settings and select Finish > Done.
15. Select the rule `Email Security Deliver to Junk Email folder` you have just created, and Enable.
16. Select Add a Rule > Create a new rule.
17. Set the following rule conditions:

Name: `Email Security User Quarantine Message`.
Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: `MALICIOUS`, `UCE`, `SPOOF` > Add > Save.


Apply this rule if: Select + to add a second condition.
And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
Do the following: _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _9_.
18. Name: `Email Security User Quarantine Message`.
19. Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: `MALICIOUS`, `UCE`, `SPOOF` > Add > Save.
20. Enter text: X-CFEmailSecurity-Disposition > Save.
21. Enter words: `MALICIOUS`, `UCE`, `SPOOF` > Add > Save.
22. Apply this rule if: Select + to add a second condition.
23. And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
24. Do the following: _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _9_.
25. Select Next.
26. You can use the default values on this screen. Select Next.
27. Review your settings and select Finish > Done.
28. Select the rule `Email Security User Quarantine Message` you have just created, and select Enable.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## 4 - User managed quarantine and administrative quarantine

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/use-cases/four-user-quarantine-admin-quarantine/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/use-cases/four-user-quarantine-admin-quarantine/)

Page options # 4 - User managed quarantine and administrative quarantine

In this tutorial, you will learn to deliver SPAM and SPOOF messages to the user managed quarantine, and MALICIOUS messages to the administrative quarantine (this requires an administrator to release the emails).

## Create quarantine policies

To create quarantine policies:

1. Open the Microsoft 365 Defender console ‚Üó.
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Rules, select Quarantine policies.
5. Select Add custom policy.
6. Set the Policy name to UserNotifyUserRelease.
7. Select Next.
8. In Recipient message access, select Set specific access (Advanced), and then:

In Select release action preference, choose Allow recipients to release a message from quarantine.
In Select additional actions recipients can take on quarantined messages, select the Delete and Preview checkboxes.
9. In Select release action preference, choose Allow recipients to release a message from quarantine.
10. In Select additional actions recipients can take on quarantined messages, select the Delete and Preview checkboxes.
11. Select Next.
12. In Quarantine notification, select Enable.
13. Select Next.
14. Review your settings and select Submit.
15. Select Done.
16. Select Add custom policy.
17. Set the Policy name to UserNotifyAdminRelease.
18. Select Next.
19. In Recipient message access, select Set specific access (Advanced), and then:

In Select release action preference, from the drop-down menu, choose Allow recipients to request a message to be released from quarantine.
In Select additional actions recipients can take on quarantined messages, select the Delete and Preview checkboxes.
20. In Select release action preference, from the drop-down menu, choose Allow recipients to request a message to be released from quarantine.
21. In Select additional actions recipients can take on quarantined messages, select the Delete and Preview checkboxes.
22. Select Next.
23. In Quarantine notification, select Enable.
24. Select Next.
25. Review your settings and select Submit.
26. Select Done.

## Configure quarantine notifications

To configure quarantine notifications:

1. Open the Microsoft 365 Defender console ‚Üó.
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Rules, select Quarantine policies.
5. Select Global settings.
6. Scroll to the bottom and set the desired frequency in Send end-user spam notifications every (days). This value can only be incremented in days.
7. Select Save.

## Configure anti-spam policies

To configure anti-spam policies:

1. Open the Microsoft 365 Defender console ‚Üó
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Policies, select Anti-spam.
5. Select the Anti-spam inbound policy (Default) text (not the checkbox).
6. In the Actions section, scroll down and select Edit actions.
7. Set the following conditions and actions (you might need to scroll up or down to find them):

Spam: Quarantine message.

Select quarantine policy: UserNotifyUserRelease.


High confidence spam: Quarantine message.

Select quarantine policy: UserNotifyAdminRelease.


Phishing: Quarantine message.

Select quarantine policy: UserNotifyAdminRelease.


High confidence phishing: Quarantine message.

Select quarantine policy: UserNotifyAdminRelease.


Retain spam in quarantine for this many days: Default is 15 days. Email Security recommends 15-30 days.
8. Spam: Quarantine message.

Select quarantine policy: UserNotifyUserRelease.
9. Select quarantine policy: UserNotifyUserRelease.
10. High confidence spam: Quarantine message.

Select quarantine policy: UserNotifyAdminRelease.
11. Select quarantine policy: UserNotifyAdminRelease.
12. Phishing: Quarantine message.

Select quarantine policy: UserNotifyAdminRelease.
13. Select quarantine policy: UserNotifyAdminRelease.
14. High confidence phishing: Quarantine message.

Select quarantine policy: UserNotifyAdminRelease.
15. Select quarantine policy: UserNotifyAdminRelease.
16. Retain spam in quarantine for this many days: Default is 15 days. Email Security recommends 15-30 days.
17. Select Save.

## Create transport rules

To create the transport rules that will send emails with certain disposition to Email Security:

1. Open the new Exchange admin center ‚Üó.
2. Go to Mail flow > Rules.
3. Select Add a Rule > Create a new rule.
4. Set the following rule conditions:

Name: `Email Security User Quarantine Message`.
Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: `UCE`, `SPOOF` > Add > Save.


Apply this rule if: Select + to add a second condition.
And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
Do the following - _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _5_.
5. Name: `Email Security User Quarantine Message`.
6. Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: `UCE`, `SPOOF` > Add > Save.
7. Enter text: X-CFEmailSecurity-Disposition > Save.
8. Enter words: `UCE`, `SPOOF` > Add > Save.
9. Apply this rule if: Select + to add a second condition.
10. And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
11. Do the following - _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _5_.
12. Select Next.
13. You can use the default values on this screen. Select Next.
14. Review your settings and select Finish > Done.
15. Select the rule `Email Security User Quarantine Message` you have just created, and Enable.
16. Select Add a Rule > Create a new rule.
17. Set the following rule conditions:

Name: `Email Security User Quarantine Message Admin Release`.
Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: `MALICIOUS` > Add > Save.


Apply this rule if: Select + to add a second condition.
And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
Do the following: _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _9_.
18. Name: `Email Security User Quarantine Message Admin Release`.
19. Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: `MALICIOUS` > Add > Save.
20. Enter text: X-CFEmailSecurity-Disposition > Save.
21. Enter words: `MALICIOUS` > Add > Save.
22. Apply this rule if: Select + to add a second condition.
23. And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
24. Do the following: _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _9_.
25. Select Next.
26. You can use the default values on this screen. Select Next.
27. Review your settings and select Finish > Done.
28. Select the rule `Email Security User Quarantine Message Admin Release` you have just created, and select Enable.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## 5 - Junk email folder and administrative quarantine

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/use-cases/five-junk-admin-quarantine/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/use-cases/five-junk-admin-quarantine/)

Page options # 5 - Junk email folder and administrative quarantine

In this tutorial, you will learn to deliver BULK messages to the user's junk email folder, and MALICIOUS, SPAM, and SPOOF messages to the Administrative Quarantine (this requires an administrator to release the emails).

## Configure anti-spam policies

To configure anti-spam policies:

1. Open the Microsoft 365 Defender console ‚Üó.
2. Go to Email & collaboration > Policies & rules.
3. Select Threat policies.
4. Under Policies, select Anti-spam.
5. Select the Anti-spam inbound policy (Default) text (not the checkbox).
6. In Actions, scroll down and select Edit actions.
7. Set the following conditions and actions (you might need to scroll up or down to find them):

- Spam: Move messages to Junk Email folder.
- High confidence spam: Quarantine message.

Select quarantine policy: _AdminOnlyAccessPolicy_.
- Select quarantine policy: _AdminOnlyAccessPolicy_.
- Phishing: Quarantine message.

Select quarantine policy: _AdminOnlyAccessPolicy_.
- Select quarantine policy: _AdminOnlyAccessPolicy_.
- High confidence phishing: Quarantine message.

Select quarantine policy: _AdminOnlyAccessPolicy_.
- Select quarantine policy: _AdminOnlyAccessPolicy_.
- Retain spam in quarantine for this many days: Default is 15 days. Email Security recommends 15-30 days.

Select the spam actions in the above step.
- Select the spam actions in the above step.

1. Select Save.

## Create transport rules

To create the transport rules that will send emails with certain disposition to Email Security:

1. Open the new Exchange admin center ‚Üó.
2. Go to Mail flow > Rules.
3. Select Add a Rule > Create a new rule.
4. Set the following rule conditions:

Name: Email Security Deliver to Junk Email folder`.
Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: BULK > Add > Save.


Apply this rule if: Select + to add a second condition.
And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
Do the following - _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _5_.
5. Name: Email Security Deliver to Junk Email folder`.
6. Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words: BULK > Add > Save.
7. Enter text: X-CFEmailSecurity-Disposition > Save.
8. Enter words: BULK > Add > Save.
9. Apply this rule if: Select + to add a second condition.
10. And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
11. Do the following - _Modify the message properties_ > _Set the Spam Confidence Level (SCL)_ > _5_.
12. Select Next.
13. You can use the default values on this screen. Select Next.
14. Review your settings and select Finish > Done.
15. Select the rule Email Security Deliver to Junk Email folder` you have just created, and Enable.
16. Select Add a Rule > Create a new rule.
17. Set the following rule conditions:

Name: `Email Security Admin Managed Host Quarantine`.
Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words:  `MALICIOUS`, `UCE`, `SPOOF` > Add > Save.


Apply this rule if: Select + to add a second condition.
And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
Do the following: _Redirect the message to_ > _hosted quarantine_.
18. Name: `Email Security Admin Managed Host Quarantine`.
19. Apply this rule if: The message headers > includes any of these words.

Enter text: X-CFEmailSecurity-Disposition > Save.
Enter words:  `MALICIOUS`, `UCE`, `SPOOF` > Add > Save.
20. Enter text: X-CFEmailSecurity-Disposition > Save.
21. Enter words:  `MALICIOUS`, `UCE`, `SPOOF` > Add > Save.
22. Apply this rule if: Select + to add a second condition.
23. And: The sender > IP address is in any of these ranges or exactly matches > enter the egress IPs in the Egress IPs page.
24. Do the following: _Redirect the message to_ > _hosted quarantine_.
25. Select Next.
26. You can use the default values on this screen. Select Next.
27. Review your settings and select Finish > Done.
28. Select the rule `Email Security Admin Managed Host Quarantine` you have just created, and select Enable.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Workspace as MX Record

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/gsuite-email-security-mx/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/gsuite-email-security-mx/)

Page options # Google Workspace as MX Record

In this tutorial, you will learn how to configure Google Workspace with Email Security as MX record.

## Prerequisites

To ensure changes made in this tutorial take effect quickly, update the Time to Live (TTL) value of the existing MX records on your domains to five minutes. Do this on all the domains you will be deploying.

Changing the TTL value instructs DNS servers on how long to cache this value before requesting an update from the responsible nameserver. You need to change the TTL value before changing your MX records to Email Security. This will ensure that changes take effect quickly and can also be reverted quickly if needed. If your DNS manager does not allow for a TTL of five minutes, set it to the lowest possible setting.

Note

Make TTL changes a few days before the production update, and wait at least as long as the old TTL values before making the update, since some senders might still be using the old cached values.

To check your existing TTL, open a terminal window and run the following command against your domain:

Terminal window ```
dig mx <YOUR_DOMAIN>
```

```
; <<>> DiG 9.10.6 <<>> mx <YOUR_DOMAIN>;; global options: +cmd;; Got answer:;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 39938;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 1
;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 4096;; QUESTION SECTION:;<YOUR_DOMAIN>.    IN  MX
;; ANSWER SECTION:<YOUR_DOMAIN>.    300    IN    MX    10 mxa.global.inbound.cf-emailsecurity.net.<YOUR_DOMAIN>.    300    IN    MX    10 mxb.global.inbound.cf-emailsecurity.net.
```

In the above example, TTL is shown in seconds as 300 (or five minutes).

If you are using Cloudflare for DNS, you can leave the TTL setting as Auto.

Below is a list with instructions on how to edit MX records for some popular services:

- Cloudflare: Set up email records
- GoDaddy: Edit an MX Record ‚Üó
- AWS: Creating records by using the Amazon Route 53 console ‚Üó
- Azure: Create DNS records in a custom domain for a web app ‚Üó

## Requirements

- Provisioned Email Security account.
- Access to the Google administrator console (Google administrator console ‚Üó > Apps > Google Workspace > Gmail).
- Access to the domain nameserver hosting the MX records for the domains that will be processed by Email Security.

## 1. Set up Inbound Email Configuration

Set up Inbound Email Configuration ‚Üó with the following details:

- In Gateway IPs, select the Add link, and add the IPs mentioned in Egress IPs.
- Select Automatically detect external IP (recommended).
- Select Require TLS for connections from the email gateways listed above.
- Do not select Reject all mail not from gateway IPs. You will enable this option at a later time to ensure your mail flows.
- Select SAVE.

## 2. (Optional) Set up an email quarantine

Set up an email quarantine ‚Üó with the following details:

- Name: Email Security Malicious.
- Description: Email Security Malicious.
- For the Inbound denial consequence, select Drop message.
- For the Outbound denial consequence, select Drop message.
- Select SAVE.

To access the newly created quarantine, select GO TO ADMIN QUARANTINE or access the quarantine directly by pointing your browser to https://email-quarantine.google.com/adminreview ‚Üó.

## 3. (Optional) Create a content compliance filter

Go to Compliance, and create a content compliance filter ‚Üó to send malicious messages to quarantine. Enter the following details:

- Content compliance: Add Quarantine Email Security Malicious.
- Email messages to affect: Select Inbound.
- Add expressions that describe the content you want to search for in each message:

Select Add to add the condition.
In Simple content match, select Advanced content match.
In Location, select Full headers.
In Match type, select Contains text.
In Content, enter X-CFEmailSecurity-Disposition: MALICIOUS.
Select SAVE to save the condition.
- Select Add to add the condition.
- In Simple content match, select Advanced content match.
- In Location, select Full headers.
- In Match type, select Contains text.
- In Content, enter X-CFEmailSecurity-Disposition: MALICIOUS.
- Select SAVE to save the condition.
- If the above expression match, do the following, select Quarantine message and the Email Security Malicious quarantine that was created in the previous step.
- Select SAVE.

If you would like to quarantine the other dispositions, repeat the above steps and use the following strings for the other dispositions:

- X-CFEmailSecurity-Disposition: BULK
- X-CFEmailSecurity-Disposition: SPOOF
- X-CFEmailSecurity-Disposition: UCE (UCE is the equivalent of SPAM)

If desired, you can create a separate quarantine for each of the dispositions.

## 4. Set up MX/Inline

Now that you have completed the prerequisite steps, set up MX/Inline on the Cloudflare dashboard. Refer to Set up MX/Inline deployment for the next steps.

## 5. (Recommended) Secure Google Workspace from MX records bypass

One method of a DNS attack is to search for old MX records and send phishing emails directly to the mail server. To secure the email flow, you should enforce an email flow where inbound messages are accepted by Google Workspace only when they originate from Email Security. This can be done by adding a connector to only allow email from Email Security with TLS encryption. This step is optional but recommended.

Important

This step should not be performed until 72 hours after all domains in your Google Workspace have been onboarded to Email Security, and Email Security is their MX record. If a domain has not been onboarded or DNS is still propagating, you will impact production email flow for that domain.

After 72 hours, the MX record DNS update will have sufficiently propagated across the Internet. It is now safe to secure your email flow. This will ensure that Google Workspace only accepts messages that are first received by Email Security. This step is highly recommended to prevent threat actors from using cached MX entries to bypass Email Security by injecting messages directly into Google Workspace.

1. Access the Google Administrative Console ‚Üó, then select Apps > Google Workspace > Gmail.
2. Select Spam, Phishing and Malware.
3. Go to Inbound gateway and select Edit Inbound gateway.
4. Enable Reject all mail not from gateway IPs and select Save.
5. Select Save once more to commit and activate the configuration change in the Gmail advanced configuration console.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Cisco - Email Security as MX Record

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/cisco-email-security-mx/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/cisco-email-security-mx/)

Page options # Cisco - Email Security as MX Record

In this tutorial, you will learn how to configure Cisco IronPort with Email Security as MX record.

## Prerequisites

To ensure changes made in this tutorial take effect quickly, update the Time to Live (TTL) value of the existing MX records on your domains to five minutes. Do this on all the domains you will be deploying.

Changing the TTL value instructs DNS servers on how long to cache this value before requesting an update from the responsible nameserver. You need to change the TTL value before changing your MX records to Email Security. This will ensure that changes take effect quickly and can also be reverted quickly if needed. If your DNS manager does not allow for a TTL of five minutes, set it to the lowest possible setting.

Note

Make TTL changes a few days before the production update, and wait at least as long as the old TTL values before making the update, since some senders might still be using the old cached values.

To check your existing TTL, open a terminal window and run the following command against your domain:

Terminal window ```
dig mx <YOUR_DOMAIN>
```

```
; <<>> DiG 9.10.6 <<>> mx <YOUR_DOMAIN>;; global options: +cmd;; Got answer:;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 39938;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 1
;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 4096;; QUESTION SECTION:;<YOUR_DOMAIN>.    IN  MX
;; ANSWER SECTION:<YOUR_DOMAIN>.    300    IN    MX    10 mxa.global.inbound.cf-emailsecurity.net.<YOUR_DOMAIN>.    300    IN    MX    10 mxb.global.inbound.cf-emailsecurity.net.
```

In the above example, TTL is shown in seconds as 300 (or five minutes).

If you are using Cloudflare for DNS, you can leave the TTL setting as Auto.

Below is a list with instructions on how to edit MX records for some popular services:

- Cloudflare: Set up email records
- GoDaddy: Edit an MX Record ‚Üó
- AWS: Creating records by using the Amazon Route 53 console ‚Üó
- Azure: Create DNS records in a custom domain for a web app ‚Üó

## 1. Add a Sender Group for Email Security Email Protection IPs

To add a new Sender Group:

1. Go to Mail Policies > HAT Overview.
2. Select Add Sender Group.
3. Configure the new Sender Group as follows:

Name: Email Security.
Order: Order above the existing WHITELIST sender group.
Comment: Email Security Email Protection egress IP Addresses.
Policy: TRUSTED (by default, spam detection is disabled for this mail flow policy).
SBRS: Leave blank.
DNS Lists: Leave blank.
Connecting Host DNS Verification: Leave all options unchecked.
4. Name: Email Security.
5. Order: Order above the existing WHITELIST sender group.
6. Comment: Email Security Email Protection egress IP Addresses.
7. Policy: TRUSTED (by default, spam detection is disabled for this mail flow policy).
8. SBRS: Leave blank.
9. DNS Lists: Leave blank.
10. Connecting Host DNS Verification: Leave all options unchecked.
11. Select Submit and Add Senders and add the IP addresses mentioned in Egress IPs

## 2. Configure Incoming Relays

You need to configure the Incoming Relays section to tell IronPort to ignore upstream hops, since all the connections are now coming from Email Security. This step is needed so the IronPort can retrieve the original IPs to calculate IP reputation. IronPort also uses this information in the Anti-Spam (IPAS) scoring of messages.

1. To enable the Incoming Relays Feature, select Network > Incoming Relays.
2. Select Enable and commit your changes.
3. Now, you will have to add an Incoming Relay. Select Network > Incoming Relays.
4. Select Add Relay and give your relay a name.
5. Enter the IP address of the MTA, MX, or other machine that connects to the email gateway to relay incoming messages. You can use IPv4 or IPv6 addresses.
6. Specify the Received: header that will identify the IP address of the original external sender.
7. Commit your changes.

## 3. Disable SPF checks

Make sure you disable Sender Policy Framework (SPF) checks in IronPort. Because Email Security is acting as the MX record, if you do not disable SPF checks, IronPort will block emails due to an SPF failure.

Refer to Cisco's documentation ‚Üó for more information on how to disable SPF checks.

## 4. Set up MX/Inline

Now that you have completed the prerequisite steps, set up MX/Inline on the Cloudflare dashboard. Refer to Set up MX/Inline deployment for the next steps.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Cisco - Cisco as MX Record

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/cisco-mx/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/cisco-mx/)

Page options # Cisco - Cisco as MX Record

In this tutorial, you will learn how to configure Email Security with Cisco as MX record.

## 1. Add a Sender Group for Email Security Email Protection IPs

To add a new Sender Group:

1. Go to Mail Policies > HAT Overview.
2. Select the Add Sender Group button.
3. Configure the new Sender Group as follows:

Name: Email Security.
Order: Order above the existing WHITELIST sender group.
Comment: Email Security Email Protection egress IP Addresses.
Policy: TRUSTED (by default, spam detection is disabled for this mail flow policy).
SBRS: Leave blank.
DNS Lists: Leave blank.
Connecting Host DNS Verification: Leave all options unchecked.
4. Name: Email Security.
5. Order: Order above the existing WHITELIST sender group.
6. Comment: Email Security Email Protection egress IP Addresses.
7. Policy: TRUSTED (by default, spam detection is disabled for this mail flow policy).
8. SBRS: Leave blank.
9. DNS Lists: Leave blank.
10. Connecting Host DNS Verification: Leave all options unchecked.
11. Select Submit and Add Senders, and add the IP addresses mentioned in Egress IPs. If you need to process emails in the EU or India regions for compliance purposes, add those IP addresses as well.

## 2. Add SMTP route for the Email Security Email Protection Hosts

To add a new SMTP Route:

1. Go to Network > SMTP Routes.
2. Select Add Route.
3. Configure the new SMTP Route as follows:

Receiving Domain: a1s.mailstream
In Destination Hosts, select Add Row, and add the Email Security MX hosts. Refer to the Geographic locations table for more information on which MX hosts to use.
4. Receiving Domain: a1s.mailstream
5. In Destination Hosts, select Add Row, and add the Email Security MX hosts. Refer to the Geographic locations table for more information on which MX hosts to use.

## 3. Create Incoming Content Filters

To manage the mail flow between Email Security and Cisco ESA, you need two filters:

- One to direct all incoming messages to Email Security.
- One to recognize messages coming back from Email Security to route for normal delivery.

### Incoming Content Filter - To Email Security

To create a new Content Filter:

1. Go to Mail Policies > Incoming Content Filters.
2. Select Add Filter to create a new filter.
3. Configure the new Incoming Content Filter as follows:

Name: ESA_to_A1S
Description: Redirect messages to Email Security for anti-phishing inspection
Order: This will depend on your other filters.
Condition: No conditions.
Actions:

For Action select Send to Alternate Destination Host.
For Mail Host input a1s.mailstream (the SMTP route configured in step 2).
4. Name: ESA_to_A1S
5. Description: Redirect messages to Email Security for anti-phishing inspection
6. Order: This will depend on your other filters.
7. Condition: No conditions.
8. Actions:

For Action select Send to Alternate Destination Host.
For Mail Host input a1s.mailstream (the SMTP route configured in step 2).
9. For Action select Send to Alternate Destination Host.
10. For Mail Host input a1s.mailstream (the SMTP route configured in step 2).

### Incoming Content Filter - From Email Security

To create a new Content Filter:

1. Go to Mail Policies > Incoming Content Filters.
2. Select the Add Filter button to create a new filter.
3. Configure the new Incoming Content Filter as follows:

Name: A1S_to_ESA
Description: Email Security inspected messages for final delivery
Order: This filter must come before the previously created filter.
Conditions: Add conditions of type Remote IP/Hostname with all the IP addresses mentioned in Egress IPs. For example:














































OrderConditionRule1Remote IP/HostnameRemote IP/Hostname2Remote IP/Hostname52.89.255.113Remote IP/Hostname52.0.67.1094Remote IP/Hostname54.173.50.1155Remote IP/Hostname104.30.32.0/196Remote IP/Hostname158.51.64.0/267Remote IP/Hostname158.51.65.0/26

Ensure that the Apply rule: dropdown is set to If one or more conditions match.
Actions: Select Add Action, and add the following:















OrderActionRule--1Skip Remaining Content Filters (Final Action)skip-filters()
4. Name: A1S_to_ESA
5. Description: Email Security inspected messages for final delivery
6. Order: This filter must come before the previously created filter.
7. Conditions: Add conditions of type Remote IP/Hostname with all the IP addresses mentioned in Egress IPs. For example:
8. Ensure that the Apply rule: dropdown is set to If one or more conditions match.
9. Actions: Select Add Action, and add the following:















OrderActionRule--1Skip Remaining Content Filters (Final Action)skip-filters()

## 4. Add the Incoming Content Filter to the Inbound Policy table

Assign the Incoming Content Filters created in step 3 to your primary mail policy in the Incoming Mail Policy table. Then, commit your changes to activate the email redirection.

## 5. Geographic locations

When configuring the Email Security (formerly Area 1) MX records, it is important to configure hosts with the correct MX priority. This will allow mail flows to the preferred hosts and fail over as needed.

Choose from the following Email Security MX hosts, and order them by priority. For example, if you are located outside the US and want to prioritize email processing in the EU, add mailstream-eu1.mxrecord.io as your first host, and then the US servers.

| Host | Location | Note |
| --- | --- | --- |
| mailstream-central.mxrecord.mx mailstream-east.mxrecord.io mailstream-west.mxrecord.io | US | Best option to ensure all email traffic processing happens in the US. |
| mailstream-eu1.mxrecord.io | EU | Best option to ensure all email traffic processing happens in Germany, with backup to US data centers. |
| mailstream-bom.mxrecord.mx | India | Best option to ensure all email traffic processing happens within India. |
| mailstream-india-primary.mxrecord.mx | India | Same as mailstream-bom.mxrecord.mx, with backup to US data centers. |
| mailstream-asia.mxrecord.mx | India | Best option to ensure all email traffic processing happens in India, with Australia data centers as backup. |
| mailstream-syd.area1.cloudflare.net | Australia / New Zealand | Best option to ensure all email traffic processing happens within Australia. |
| mailstream-australia-primary.area1.cloudflare.net | Australia / New Zealand | Best option to ensure all email traffic processing happens in Australia, with India and US data centers as backup. |

## 6. Set up MX/Inline

Now that you have completed the prerequisite steps, set up MX/Inline on the Cloudflare dashboard. Refer to Set up MX/Inline deployment for the next steps.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## MX/Inline deployment

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/mx-inline-deployment/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/mx-inline-deployment/)

Page options # MX/Inline deployment

With pre-delivery deployment, also known as Inline deployment, Email Security evaluates email messages before they reach a user's inbox.

Before you change your MX records, you will have to set up the Time to Live (TTL) on your DNS records. If you do not set up the TTL, the DNS propagation will take longer to happen.

Cloudflare recommends to decrease the TTL to five minutes (also known as Auto) 3 to 5 days prior to the planned MX record change. Reducing the TTL allows the DNS record to propagate ahead of time, so changes take effect rapidly. Once you have completed your onboarding process, you can choose to increase the TTL.

When you have configured your TTL, you can deploy Email Security via MX/Inline. An MX record is a DNS record.

If your DNS records are hosted by Cloudflare (or any other provider, except for Google), you can edit your DNS records via the dashboard or the API to point your MX records to Cloudflare.

By changing your MX records, Email Security will be positioned between your incoming emails and Microsoft 0365 or Gmail.

Email Security becomes a hop in the SMTP ‚Üó processing chain and physically interacts with incoming email messages. Based on your policies, various messages are blocked before reaching the inbox.

When you choose an inline deployment, you get the following benefits:

- Messages are processed and physically blocked before arriving in a user's mailbox.
- Your deployment is simpler, because any complex processing can happen downstream and without modification.
- Email Security can modify delivered messages, adding subject or body mark-ups.
- Email Security can offer high availability and adaptive message pooling.
- You can set up advanced handling downstream for non-quarantined messages with added X-headers.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Set up MX/Inline deployment

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/mx-inline-deployment-setup/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/mx-inline-deployment-setup/)

Page options # Set up MX/Inline deployment

## Prerequisites

To use Email Security, you will need to have:

- A Cloudflare account ‚Üó
- A Zero Trust organization
- A domain to protect

## Initiate MX/Inline configuration

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Overview. Select one of the following options:

- If you have not purchased Email Security, select Contact sales.
- If you have not associated any integration, associate an integration, then select Set up.
- If you have associated an integration, but have not connected a domain, select Connect a domain.

1. Select MX/Inline.
2. To start the MX/Inline configuration, you will need to have completed the prerequisite setup on your email provider's platform. Once you have completed this step, select I confirm that I have completed all the necessary requirements. Then, select Start configuration.

Note

You can only onboard one domain at a time.

## Associate an integration

MX/Inline does not require an integration for protection to be effective. However, it is a best practice to connect an integration.

To associate an integration:

1. In Zero Trust ‚Üó, go to Settings (gear icon).
2. Select SaaS Integrations > Connect an integration.
3. Select an application: Choose between Google Workspace CASB + EMAIL, or Microsoft CASB + EMAIL.

Refer to Enable Gmail BCC integration if you select Google Workspace CASB + EMAIL.
Refer to Enable Microsoft integration if you select Microsoft CASB + EMAIL.
4. Refer to Enable Gmail BCC integration if you select Google Workspace CASB + EMAIL.
5. Refer to Enable Microsoft integration if you select Microsoft CASB + EMAIL.
6. After you have associated an integration, go to Email Security > Set up.
7. Follow the instructions to connect a domain.

## Connect a domain

If you have verified zones on Cloudflare, continue with the following steps:

1. Connect a domain: Select your domain. Then, select Continue.
2. Select position: This step allows you to choose where Email Security fits into your mail flow and configure position settings:

Select position: Choose between:

Sit first (hop count = 1): Email Security is the first server that receives the email. There are no other email scanners or services between the Internet and Cloudflare.
Sit in the middle (hop count > 1): Email Security sits anywhere other than the first position. Other servers receive emails before Email Security. There are other email scanners or email services in between.


Position settings: Refine how Email Security receives and forwards emails:

Forwarding address: This is your mail flow next hop after Email Security. This value is auto-filled, but you can still change it.
Outbound TLS: Choose between:

Forward all messages over TLS (recommended).
Forward all messages using opportunistic TLS.




Select Continue.
3. Select position: Choose between:

Sit first (hop count = 1): Email Security is the first server that receives the email. There are no other email scanners or services between the Internet and Cloudflare.
Sit in the middle (hop count > 1): Email Security sits anywhere other than the first position. Other servers receive emails before Email Security. There are other email scanners or email services in between.
4. Sit first (hop count = 1): Email Security is the first server that receives the email. There are no other email scanners or services between the Internet and Cloudflare.
5. Sit in the middle (hop count > 1): Email Security sits anywhere other than the first position. Other servers receive emails before Email Security. There are other email scanners or email services in between.
6. Position settings: Refine how Email Security receives and forwards emails:

Forwarding address: This is your mail flow next hop after Email Security. This value is auto-filled, but you can still change it.
Outbound TLS: Choose between:

Forward all messages over TLS (recommended).
Forward all messages using opportunistic TLS.
7. Forwarding address: This is your mail flow next hop after Email Security. This value is auto-filled, but you can still change it.
8. Outbound TLS: Choose between:

Forward all messages over TLS (recommended).
Forward all messages using opportunistic TLS.
9. Forward all messages over TLS (recommended).
10. Forward all messages using opportunistic TLS.
11. Select Continue.
12. (Optional, select Skip for now to skip this step) Configure quarantine policy: Select dispositions to automatically prevent certain types of incoming messages from reaching a recipient's inbox.
13. (Optional) Update MX records:

Email Security can automatically update MX records for domains that proxy traffic through Cloudflare. Under Your mail processing location, select your mail processing location.
You can also choose to allow Cloudflare to update MX records by selecting I confirm that I allow Cloudflare to update to the new MX records. When Email Security updates MX records, we replace your original MX records with Email Security MX records.
Select Continue.
14. Email Security can automatically update MX records for domains that proxy traffic through Cloudflare. Under Your mail processing location, select your mail processing location.
15. You can also choose to allow Cloudflare to update MX records by selecting I confirm that I allow Cloudflare to update to the new MX records. When Email Security updates MX records, we replace your original MX records with Email Security MX records.
16. Select Continue.
17. Review details: Review your domain, then select Go to domains.

## Users who do not have domains with Cloudflare

If you do not have domains with Cloudflare, the dashboard will display two options:

- Enter domain manually.
- Add a domain to Cloudflare.

## Enter domain manually

1. Add domains: Manually enter domain names.
2. Review all domains: Review all your domains, then select Continue.
3. Verify your domains: It may take up to 24 hours for your domains to be verified. Select Done.
4. Once your domains have been verified, the dashboard will display a message like this: You have verified domains ready to connect to Email Security. This means that you can now set up Email Security via MX/Inline.
5. Select Set up, then select MX/Inline.
6. Follow the steps to initiate MX/Inline configuration.

### Add a domain to Cloudflare

Selecting Add a domain to Cloudflare will redirect you to a new page where you will connect your domain to Cloudflare. Once you have entered an existing domain, select Continue.

Then, follow the steps to Set up MX/Inline.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Egress IPs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/egress-ips/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/egress-ips/)

Page options # Egress IPs

When you set up Email Security using an MX/Inline deployment, your existing email provider will accept messages coming from Email Security's egress IP addresses.

Setting up egress IPs allows Cloudflare to deliver emails to your inbox.

Refer to this page for reference on what IP subnet mask ranges to use.

Additional information for Microsoft 365

Microsoft 365 does not support IPv6 addresses nor the following IPv4 subnet mask ranges:

- 104.30.32.0/19
- 134.195.26.0/23

If you use Microsoft 365, you will have to use the broken down /24 subnet mask IP addresses. Refer to Microsoft 365 /24 addresses for a list of supported IPv4 addresses.

### IPv4

```
52.11.209.21152.89.255.1152.0.67.10954.173.50.115104.30.32.0/19158.51.64.0/26158.51.65.0/26134.195.26.0/2335.157.195.6352.58.35.43
```

### IPv6

```
2405:8100:c400::/38
```

## Microsoft 365 /24 addresses

Use these IPv4 addresses for Microsoft 365, instead of the /19 and /23 subnets:

```
104.30.32.0/24104.30.33.0/24104.30.34.0/24104.30.35.0/24104.30.36.0/24104.30.37.0/24104.30.38.0/24104.30.39.0/24104.30.40.0/24104.30.41.0/24104.30.42.0/24104.30.43.0/24104.30.44.0/24104.30.45.0/24104.30.46.0/24104.30.47.0/24104.30.48.0/24104.30.49.0/24104.30.50.0/24104.30.51.0/24104.30.52.0/24104.30.53.0/24104.30.54.0/24104.30.55.0/24104.30.56.0/24104.30.57.0/24104.30.58.0/24104.30.59.0/24104.30.60.0/24104.30.61.0/24104.30.62.0/24104.30.63.0/24134.195.26.0/24134.195.27.0/24
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Partner domain TLS

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/partner-domain-tls/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/partner-domain-tls/)

Page options # Partner domain TLS

To add additional TLS (Transport Layer Security) requirements for emails coming from certain domains, you can enforce higher levels of SSL/TLS inspection. If TLS is required, mail without TLS from the specified domain will be dropped.

Note

To enforce TLS across all emails, you will need to enforce TLS requirements when you are onboarding your domain. To only enforce TLS for specific emails, you can do so by going to Settings > Partner domain TLS > Add a domain.

To set up a partner domain:

1. Log in to Zero Trust ‚Üó and select Email security.
2. Select Settings > Partner domain TLS > View.
3. Select Add a domain.
4. Enter a valid domain name. You can also exclude subdomains by selecting Add exclude.
5. (Optional) Add an optional note to describe your rule(s).
6. Select Save.

To edit a partner domain, select the three dots > Edit.

To delete a partner domain, select the three dots > Delete.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Manage domains

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/manage-domains/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/manage-domains/)

Page options # Manage domains

Once you have deployed your domain, Email Security allows you to filter and edit domains. You can also choose to stop a domain from being scanned.

## Filter domains

To filter your domains:

1. Log in to Zero Trust ‚Üó > Email Security.
2. Go to Settings > Domain management > Domains, then select View.
3. Select Show filters > Configured method. Choose among the following filters:

MS Graph API: To view domains connected via MS Graph API.
BCC/Journaling: To view domains connected via BCC/Journaling.
MX/Inline: To view domains connected via MX/Inline.
Retro Scan: To view domains scanned by Retro Scan.
4. MS Graph API: To view domains connected via MS Graph API.
5. BCC/Journaling: To view domains connected via BCC/Journaling.
6. MX/Inline: To view domains connected via MX/Inline.
7. Retro Scan: To view domains scanned by Retro Scan.
8. Select Apply filters.

## Edit domains

To edit your domains:

1. Log in to Zero Trust ‚Üó > Email Security.
2. Go to Settings > Domain management > Domains, then select View.
3. On the Domains page, locate your domain, select the three dots > Edit.
4. If you did not manually add your domain, you will only be able to edit Hops. If you manually added your domain, you will be able to edit Domain name and Hops.
5. Select Save.

## Prevent Cloudflare from scanning a domain

To stop scanning domains:

1. Log in to Zero Trust ‚Üó > Email Security.
2. Go to Settings > Domain management > Domains, then select View.
3. On the Domains page, locate your domain, select the three dots > Stop scanning.
4. Select Stop scanning again to stop Cloudflare from scanning your domain.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Email monitoring

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/email-monitoring/](https://developers.cloudflare.com/cloudflare-one/email-security/email-monitoring/)

Page options # Email monitoring

Once you have chosen a domain to scan, Email Security allows you to monitor the traffic scanned from your email inboxes.

Note

With Email Security, you can enable logs to send detection data to an endpoint of your choice. Refer to Enable Email Security logs for more information.

To monitor your inbox:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Under Email Security, select Monitoring.

The dashboard will display the following metrics:

- Email activity
- Disposition evaluation
- Detection details
- Impersonations
- Phish submissions
- Auto-move events
- Detection settings metrics

## Email activity

Email activity aggregates statistics about emails scanned and dispositions assigned (the number of email flagged due to a detection) within a given timeframe.

To view the live number of email scanned and dispositions scanned, enable Live mode.

## Disposition evaluation

Email traffic that flows through Email Security is given a final disposition, which represents Email Security's evaluation of that specific message.

Disposition evaluation displays the following dispositions:

- Malicious: Traffic associated with active threat campaigns. Malicious messages invoked multiple phishing verdict triggers and met thresholds for bad behavior.

Recommendation: Block.
- Recommendation: Block.
- Suspicious: Traffic associated with phishing campaigns (and is under further analysis by our automated systems).

Recommendation: Research these messages internally to evaluate legitimacy.
- Recommendation: Research these messages internally to evaluate legitimacy.
- Spam: Traffic associated with non-malicious, commercial campaigns.

Recommendation: Route to existing Spam quarantine folder.
- Recommendation: Route to existing Spam quarantine folder.
- Spoof: Traffic associated with phishing campaigns that is either non-compliant with your email authentication policies (SPF ‚Üó, DKIM ‚Üó, DMARC ‚Üó) or has mismatching Envelope From and Header From values.

Recommendation: Block after investigating (can be triggered by third-party mail services).
- Recommendation: Block after investigating (can be triggered by third-party mail services).
- Bulk: Traffic often associated with newsletters or marketing campaigns. Refer to Graymail ‚Üó for more details.

Recommendation: Monitor or tag.
- Recommendation: Monitor or tag.

## Detection details

Detection details displays information about:

- Malicious disposition:

Email threat types: Top malicious threat types, and their number relative to the total amount of malicious threats received.
Targeted users: Top number of emails targeted, and their number relative to the total amount of malicious targets.
Malicious links: A graph displaying the total number of malicious links and their distribution throughout the month.
Malicious attachments: Number of malicious attachments, and the top types of malicious files received.
- Email threat types: Top malicious threat types, and their number relative to the total amount of malicious threats received.
- Targeted users: Top number of emails targeted, and their number relative to the total amount of malicious targets.
- Malicious links: A graph displaying the total number of malicious links and their distribution throughout the month.
- Malicious attachments: Number of malicious attachments, and the top types of malicious files received.
- Suspicious disposition:

Suspicious threat types: Top suspicious threat types, and their number relative to the total amount of threats received.
Suspicious targets: Top number of emails targeted, and their number relative to the total amount of malicious targets.
Suspicious links: A graph displaying the total number of suspicious links and their distribution throughout the month.
- Suspicious threat types: Top suspicious threat types, and their number relative to the total amount of threats received.
- Suspicious targets: Top number of emails targeted, and their number relative to the total amount of malicious targets.
- Suspicious links: A graph displaying the total number of suspicious links and their distribution throughout the month.
- Spoof disposition:

Spoof users (impersonated names): Top number of impersonated names, and their number relative to the total number of detection received.
Spoof targets: Top number of targeted emails.
Sender v. envelope mismatch: This field indicates the number of mismatches between the email address the message was sent from, and the email address the message was actually sent from.
- Spoof users (impersonated names): Top number of impersonated names, and their number relative to the total number of detection received.
- Spoof targets: Top number of targeted emails.
- Sender v. envelope mismatch: This field indicates the number of mismatches between the email address the message was sent from, and the email address the message was actually sent from.

## Impersonations

Impersonations are a form of phishing attack where the actor pretends to be someone else to steal sensitive information.

Impersonations displays the number of targeted users, and a chart describing the total number of impersonation attempts.

- To view all targeted users, select View all targeted users.
- To view all impersonation emails, select View all impersonation emails.
- To view impersonated users, select View impersonated users.

Refer to Trusted domains to add a trusted domain, and Impersonation registry to add a user to the impersonation registry.

## Phish submissions

Phishing is a type of attack that involves stealing sensitive information with the aim of using and selling the information.

A phish submission happens when a user or an administrator reports a phishing attack. Refer to Phish submissions to learn how to submit a phish.

Phish submissions displays the following information:

- All submissions: The total number of phish submissions.
- User submissions: The number of phish submissions reported by your users.
- Admin submissions: The number of phish submissions reported by an administrator.

Select Review submissions to review a filtered list of phish submissions reported by your team.

## Auto-move events

Auto-move events are emails moved to different inboxes based on the disposition Email Security assigned.

This panel shows you the total number of auto-moves and the source folder from which these retractions are originating from.

Refer to Auto-moves to configure auto-move events.

## Detection settings metrics

Detection settings metric displays information about:

- Allowed traffic: Traffic that Email Security will exempt emails that match certain patterns from normal detection scanning. Allowed traffic shows metrics on emails that were allowed to go through user inboxes.
- Blocked traffic: Traffic that Email Security automatically blocks from senders. Blocked traffic shows metrics on emails that were blocked from user inboxes.
- Domain age: The number of days since domain registration.

Select Configure to configure policy and rules for allowed traffic, blocked traffic and domain age.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Search email

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/email-monitoring/search-email/](https://developers.cloudflare.com/cloudflare-one/email-security/email-monitoring/search-email/)

Page options # Search email

With Email Security, you can use different screen criteria to search through your email, reclassify and move a certain volume of messages, find similar emails, and export messages.

## Screen criteria

Email Security allows you to use popular, regular, and advanced screening criteria to search through your inbox. Advanced screening will give you the most in-depth investigation of your inbox.

To screen through your email traffic:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Investigation, then Run new screen.
4. Choose between Popular, Regular, and Advanced screen methods. Refer to the explanation below to learn what each method does.

The results will be displayed on a table. The table allows you to review and take action on the messages that match your chosen screening criteria.

### Popular screen

A popular screen allows you to view messages based on common pre-defined criteria.

To use a popular screen criteria:

1. Under Method, select Popular screens.
2. Select one of the following criteria:

Moved emails: View emails automatically or manually moved within the last seven days.
Reclassified emails: Emails that had their disposition reclassified within the last seven days.
Malicious emails: Emails assigned the malicious disposition within the last seven days.
Spoof emails: Emails assigned the spoof disposition within the last seven days.
Suspicious emails: Emails assigned the suspicious disposition within the last seven days.
Spam emails: Emails assigned to the spam disposition within the last seven days.
3. Moved emails: View emails automatically or manually moved within the last seven days.
4. Reclassified emails: Emails that had their disposition reclassified within the last seven days.
5. Malicious emails: Emails assigned the malicious disposition within the last seven days.
6. Spoof emails: Emails assigned the spoof disposition within the last seven days.
7. Suspicious emails: Emails assigned the suspicious disposition within the last seven days.
8. Spam emails: Emails assigned to the spam disposition within the last seven days.
9. Select Run screen.

To modify your screening criteria, under Active screen criteria, select Modify.

### Regular screen

A regular screen allows you to investigate your inbox by inserting a term to screen across all criteria.

To use a regular screen criteria:

1. Under Method, select Regular screen.
2. Select a Date range.
3. Enter a keyword.
4. Select Run screen.

To include all emails as part of the search, enable Include all mail.

To modify your screening criteria, under Active screen criteria, select Modify.

To reset your screening criteria, select Reset.

### Advanced screen

The advanced screen criteria gives you the option to narrow message results based on specific criteria. The advanced screen has several options (such as keywords, subject keywords, sender domain, and more) to scan your inbox.

To use advanced screen criteria:

1. Under Method, select Advanced screen.
2. (Required) Select a date range.
3. (Optional) Fill in the other fields. All fields, except for Subject, must be filled with one value only.
4. Select Run screen.

To include all emails as part of the search, enable Include all mail.

To modify your screening criteria, under Active screen criteria, select Modify.

To reset your screening criteria, select Reset.

## Reclassify messages

Reclassifying messages allows you to choose the disposition of your messages if the disposition is incorrect.

To reclassify a message:

1. In Zero Trust ‚Üó, go to Email Security and select Investigation.
2. On the Investigation page, under Your matching messages, select the message you want to reclassify.
3. Select the three dots, then select Request reclassification.
4. Under New disposition, select among the following:

Malicious: Traffic invoked multiple phishing verdict triggers, met thresholds for bad behavior, and is associated with active campaigns.
Spoof: Traffic associated with phishing campaigns that is either non-compliant with your email authentication policies (SPF, DKIM, DMARC) or has mismatching Envelope From and Header From values.
Spam: Traffic associated with non-malicious, commercial campaigns.
Bulk: Traffic associated with Graymail ‚Üó, that falls in between the definitions of SPAM and SUSPICIOUS. For example, a marketing email that intentionally obscures its unsubscribe link.
Clean: Traffic not associated with any phishing campaigns.
5. Malicious: Traffic invoked multiple phishing verdict triggers, met thresholds for bad behavior, and is associated with active campaigns.
6. Spoof: Traffic associated with phishing campaigns that is either non-compliant with your email authentication policies (SPF, DKIM, DMARC) or has mismatching Envelope From and Header From values.
7. Spam: Traffic associated with non-malicious, commercial campaigns.
8. Bulk: Traffic associated with Graymail ‚Üó, that falls in between the definitions of SPAM and SUSPICIOUS. For example, a marketing email that intentionally obscures its unsubscribe link.
9. Clean: Traffic not associated with any phishing campaigns.
10. Select Save.

To reclassify messages in bulk, select Select all messages > Action > Request reclassification.

To release messages in bulk, select Select all messages > Action > Release.

### Upload EML files

Email Security classifies certain emails as "Clean". If you disagree with the disposition, you can upload an EML file and reclassify the email.

On the Investigation page:

1. Go to the email marked as Clean.
2. Select the three dots > Request reclassification.
3. Upload the EML file.
4. Select a new disposition.
5. Select Save.

Once you have reclassified your messages, you can access those on Reclassifications.

To view reclassifications:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security > Reclassifications.
3. Choose Team submissions to view emails your security team submitted for reclassification, or User submissions to view emails your users submitted for reclassification.

### Team submissions

Team submissions are the emails your security team submitted for reclassification. All team submissions receive a human review by Cloudflare.

Select among the following filters:

- Date Range: You can select a date range from the last 7, last 30, and last 90 days.
- Original disposition: Select among the available values.
- Submitted as: Select among the available values.
- Final disposition: Select among the available values.
- Escalation: Filter by team submissions that have been escalated or not. Select among Yes, No, or All.

Once you have selected all the filters, select Apply filters.

The dashboard will populate the table with the list of emails your security team submitted for reclassification, including a Submission ID, and the Email subject.

To gain more details on a specific reclassification:

1. Go to the reclassification you want to have more details for.
2. Select the three dots > select among View more, View email message and View similar details.

### User submissions

User submissions are the emails your users submitted for reclassification. User submissions help enhance our detection model, but can be escalated for human review.

Any email that is reported as phish will be displayed under User submissions.

Note

PhishGuard customers can have submissions analyzed when submitting at either user or team level. Any non-PhishGuard customer can still have submissions analyzed by submitting at team level.

Select among the following filters:

- Date Range: Select a date range from the last 7, last 30, and last 90 days.
- Original disposition: Select among the available values.
- Submitted as: Select among the available values.

Once you have selected all the filters, select Apply filters.

The dashboard will populate the table with the list of emails your users submitted for reclassification, including a Submission ID, and the Email subject.

To gain more details on a specific reclassification:

1. Go to the reclassification you want to have more details for.
2. Select the three dots > select among View more, View email message, View similar details, and Escalate.

To escalate a reclassification:

1. Go to the reclassification you want to escalate.
2. Select the three dots > select Escalate.
3. The dashboard will display a message to authorize escalation. Select Escalate.

### Invalid submissions

A submission is invalid when:

- A submission has no EML file attached.
- A submission has been made with an incorrect file extension.
- A submission was made to the wrong team or user alias.

To ensure your submission is valid:

- Ensure your submission has a file attached with a .eml file extension.
- Ensure you configure the domain you are submitting emails for.
- Ensure policies are configured correctly.

To view invalid submissions:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security > Reclassifications.
3. Select Invalid submissions.

You can search by submission ID or submitted email.

You can filter based on Date Range and Submitted by (which will list emails that made the invalid submissions). Once you have configured your desired filters, select Apply filters.

## Move messages

Moving messages allows you to move messages to a specific folder. You can move up to 1,000 messages at a time.

To move messages:

1. In Zero Trust ‚Üó, go to Email Security, and select Investigation.
2. On the Investigation page, select all the messages you want to move.
3. Select the Action dropdown, then select Move.
4. Select among one of the following folders:

Inbox: Move messages to the primary email folder.
Junk email: Move messages to the junk or spam folder.
Trash: Move messages to the trash or deleted items email folder.
Soft delete (user recoverable): Move messages to the user's Deleted Items folder. This option is for Microsoft 365 only.
Hard delete (admin recoverable): Delete messages from a user's inbox.
5. Inbox: Move messages to the primary email folder.
6. Junk email: Move messages to the junk or spam folder.
7. Trash: Move messages to the trash or deleted items email folder.
8. Soft delete (user recoverable): Move messages to the user's Deleted Items folder. This option is for Microsoft 365 only.
9. Hard delete (admin recoverable): Delete messages from a user's inbox.
10. Select Save.

To move messages in bulk, select Select all messages > Action > Move.

## Find similar emails

Each detection has an Email Detection Fingerprint (EDF) hash that Email Security sends to the Search API to retrieve similar detections.

To find similar detection results:

1. In Zero Trust ‚Üó, go to Email Security, and select Investigation.
2. On the Investigation page, under Your matching messages, search for the Similar emails column.
3. Select the number of similar emails. Selecting the number will show you a list of similar emails.

## Export messages

With Email Security, you can export messages to a CSV file.

To export messages:

1. In Zero Trust ‚Üó, go to Email Security, and select Investigation.
2. On the Investigation page, under Your matching messages, select Export to CSV.
3. Select Export messages on the pop-up message. You can export up to 500 messages from the dashboard. To export up to 1,000 matching messages, use the API.

To export messages in bulk, select Select all messages > Export to CSV.

## Email status

Email Security allows you to review the status and actions of each email.

To view status and actions for each email:

1. In Zero Trust ‚Üó, go to Email Security, and select Investigation.
2. On the Investigation page, select the three dots.
3. Selecting the three dots will show you the following options:

If the email is quarantined:

View details: Refer to Email details to learn more.
View similar emails: Find similar emails based on the value_edf_hash (Electronic Detection Fingerprint hash).
Release: Email Security will no longer quarantine your chosen messages.
Request reclassification: Choose the dispositions of your messages if they are incorrect. Refer to Reclassify messages to learn more.
4. If the email is quarantined:

View details: Refer to Email details to learn more.
View similar emails: Find similar emails based on the value_edf_hash (Electronic Detection Fingerprint hash).
Release: Email Security will no longer quarantine your chosen messages.
Request reclassification: Choose the dispositions of your messages if they are incorrect. Refer to Reclassify messages to learn more.
5. View details: Refer to Email details to learn more.
6. View similar emails: Find similar emails based on the value_edf_hash (Electronic Detection Fingerprint hash).
7. Release: Email Security will no longer quarantine your chosen messages.
8. Request reclassification: Choose the dispositions of your messages if they are incorrect. Refer to Reclassify messages to learn more.
9. If the email is not quarantined:

View details.
View similar emails.
View submission detail.
Move (only available if you authorized moves).
Request reclassification.
10. View details.
11. View similar emails.
12. View submission detail.
13. Move (only available if you authorized moves).
14. Request reclassification.

## Email details

Email Security shows you the following email detail information:

- Details
- Action log
- Raw message
- Mail trace

### Details

Email Security displays the following details:

1. Threat type: Threat type of the email, for example, credential harvester, and IP-based spam.
2. Validation: Email validation methods SPF ‚Üó, DKIM ‚Üó, DMARC ‚Üó. The dashboard will display Pass if SPF, DKIM and DMARC checks have passed.
3. Sender details: Information include:

IP address
Registered domain
Autonomous sys number: This number identifies your autonomous system (AS) ‚Üó.
Autonomous sys name: This name identifies your autonomous system (AS).
Country
4. IP address
5. Registered domain
6. Autonomous sys number: This number identifies your autonomous system (AS) ‚Üó.
7. Autonomous sys name: This name identifies your autonomous system (AS).
8. Country
9. Links identified: A list of malicious links identified by Email Security. Refer to Open links to open links in Security Center, Browser Isolation or an external tool of your choice.
10. Attachments: If an email has an attachment, the Cloudflare dashboard will display the filename, and the disposition assigned. You can open attachments in Browser Isolation. Only PDF files are currently supported.
11. Reasons for disposition: Description of why the email was deemed as malicious, suspicious, or spam.

#### Open links

You can open links in Security Center or Browser Isolation, or copy and paste the link so you can investigate content in external tools.

To open links in Security Center:

1. In Zero Trust ‚Üó, go to Email Security > Investigation.
2. Locate the message you want to open links for, select the three dots, then select View details.
3. Under Details, go to Links identified.
4. Locate the link you want to open, and select Open in Security Center.
5. You will be redirected to Investigate in the Cloudflare dashboard.
6. Select Scan now.
7. The dashboard will generate a report for your link.

To open links in Browser Isolation:

1. In Zero Trust ‚Üó, go to Email Security > Investigation.
2. Locate the message you want to open links for, select the three dots, then select View details.
3. Under Details, go to Links identified.
4. Locate the link you want to open, and select Open in Browser Isolation.
5. The link will open in a separate window where you will be able to browse the content securely.

Alternatively, you can directly open links in Browser Isolation.

To open and investigate a link in an external tool:

1. In Zero Trust ‚Üó, go to Email Security > Investigation.
2. Locate the message you want to open links for, select the three dots, then select View details.
3. Under Details, go to Links identified.
4. Locate the link you want to open, and select Copy URL.
5. Paste the link in your external tool.

Warning

You may encounter a 400 Bad Request error after turning Clientless Web Isolation on.

If you encounter this error:

1. In Zero Trust ‚Üó, go to Settings > Resources.
2. Select Generate certificate.
3. Choose the Expiration (5 years is recommended), then select Generate certificate. Your certificate is now generated, and the dashboard will display its Deployment Status as INACTIVE.
4. Select the three dots, and then select Activate to activate your certificate.
5. Select the three dots, and then select Mark as in-use.
6. Your certificate deployment status should display AVAILABLE IN-USE.

### Action log

Action log allows you to review post-delivery actions performed on your selected message. The action log displays:

- Date: Date when the post-delivery action was performed.
- Activity: The activity taken on an email. For example, moving the email to the trash folder, releasing a quarantined email, and more.

### Raw message

Raw message allows you to view the raw details of the message. You can also choose to download the email message. To download the message, select Download .EML.

### Mail trace

Mail trace allows you to track the path your selected message took from the sender to the recipient. Mail trace displays:

- Date: The date and time when the mail was tracked.
- Type: An email can be inbound (email sent to you from another email), or outbound (emails sent from your email address).
- Activity: The activity taken on an email. For example, moving the email to the trash folder, releasing a quarantined email, and more.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Download disposition report

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/email-monitoring/download-disposition-report/](https://developers.cloudflare.com/cloudflare-one/email-security/email-monitoring/download-disposition-report/)

Page options # Download disposition report

Email Security allows you to download a report that shows you all the email messages based on the disposition type you selected.

To download a disposition report:

1. In Zero Trust ‚Üó, select Email Security.
2. Select Monitoring > Download report.
3. Select the Report type. Choose between Email disposition report or Retro scan report.

If you select Email disposition report:

1. Select the Date Range (required).
2. Select the Disposition.
3. Select Export to CSV.

If you choose Retro scan report, select View report to view a report of your last 14 days of emails. Refer to Retro Scan for more details.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Directories

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/directories/](https://developers.cloudflare.com/cloudflare-one/email-security/directories/)

Page options # Directories

Directories are folders to store user data. Email Security allows you to manage directories from the Cloudflare dashboard.

To add a directory:

1. Log in to Zero Trust ‚Üó > Email Security.
2. Select Directories.
3. Select Add a directory > Connect an integration.
4. Select either Google Workspace CASB + EMAIL or Microsoft CASB+EMAIL.
5. Refer to Enable Gmail BCC integration if you choose Google Workspace. Refer to Enable Microsoft integration if you choose Microsoft 365.

To sync a directory:

1. Locate the directory you want to sync.
2. Select the three dots, then select Sync now.

Note

The Auto sync option is on by default. It is recommended to keep this option on at all times to ensure directories are always synchronized.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Manage groups in your directory

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/directories/manage-integrated-directories/manage-groups-directory/](https://developers.cloudflare.com/cloudflare-one/email-security/directories/manage-integrated-directories/manage-groups-directory/)

Page options # Manage groups in your directory

Email Security allows you to view and manage your groups directory and their impersonation registry. When a group is added to the registry, all members are registered by default.

To manage a group directory:

1. In Zero Trust ‚Üó, go to Email Security > Directories.
2. Locate your directory, select the three dots > View details.
3. Select Groups.

## Add groups to registry

Email Security allows you to add group names to the registry.

To add a single group to the registry:

1. Select the group name you want to add.
2. Select the three dots > Add to registry.

To add multiple groups to the registry at once:

1. Select the group names you want to add to the registry.
2. Select the Action dropdown list.
3. Select Add to registry.

## Remove groups from registry

Email Security allows you to remove group names from the registry.

To remove a single group from the registry:

1. Select the group name you want to remove.
2. Select the three dots > Remove from registry.

To remove multiple groups from the registry at once:

1. Select the group names you want to remove from registry.
2. Select the Action dropdown list.
3. Select Remove from registry.

## Filter impersonation registry

You can filter the list of group names by registered and unregistered.

A group name is registered when it is part of the impersonation registry. A group name is unregistered when they are not part of the impersonation registry.

To filter the list:

1. Select Show filters > Impersonation registry.
2. Select one of the following:

All: To view registered and unregistered groups.
Registered: To view registered groups.
Unregistered: To view unregistered groups.
3. All: To view registered and unregistered groups.
4. Registered: To view registered groups.
5. Unregistered: To view unregistered groups.
6. Select Apply filters.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Manage users in your directory

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/directories/manage-integrated-directories/manage-users-directory/](https://developers.cloudflare.com/cloudflare-one/email-security/directories/manage-integrated-directories/manage-users-directory/)

Page options # Manage users in your directory

Email Security allows you to view and manage the impersonation registry status of your users directory.

To manage users directory:

1. In Zero Trust ‚Üó, go to Email Security > Directories.
2. Locate your directory, select the three dots > View details.
3. Select Users.

## Add users to registry

To add a single user to the registry:

1. Select the name you want to add.
2. Select the three dots > Add to registry.

To add multiple users to the registry at once:

1. Select the names you want to add to the registry.
2. Select the Action dropdown list.
3. Select Add to registry.

## Remove users from registry

Email Security allows you to remove users from the registry.

To remove a single user from the registry:

1. Select the name you want to remove.
2. Select the three dots > Remove from registry.

To remove multiple users from the registry at once:

1. Select the names you want to remove from the registry.
2. Select the Action dropdown list.
3. Select Remove from registry.

## Edit a user

To edit a user:

1. Under Display name, locate the user you want to edit.
2. Select the three dots > Edit.
3. Edit the user, then select Save.

## Filter a user

You can filter the list of users by registered and unregistered.

A user is registered when they are added to the impersonation registry. A user is unregistered when they are not part of the impersonation registry.

To filter the impersonation registry:

1. Select Show filters > Impersonation registry.
2. Choose one of the following:

All: To view registered and unregistered users.
Registered: To view registered users.
Unregistered: To view unregistered users.
3. All: To view registered and unregistered users.
4. Registered: To view registered users.
5. Unregistered: To view unregistered users.
6. Select Apply filters.

To filter users:

1. Select Show filters > Users.
2. Choose one of the following:

All: To view users in groups and not in groups.
Users in groups: To view users in groups.
Users not in groups: To view users not in groups.
3. All: To view users in groups and not in groups.
4. Users in groups: To view users in groups.
5. Users not in groups: To view users not in groups.
6. Select Apply filters.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Manage Email Security directories

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/directories/manage-es-directories/](https://developers.cloudflare.com/cloudflare-one/email-security/directories/manage-es-directories/)

Page options # Manage Email Security directories

You can manage your Email Security directory by editing and deleting added users.

Registered users

The Email Security directory contains registered users only. A registered user is a user added to the impersonation registry.

To modify or delete users in the Email Security directory:

1. In Zero Trust ‚Üó, go to Email Security > Directories.
2. Select Email Security Directory.

## Add a user

To manually add a user to the Email Security directory:

1. On the sidebar, go to Settings > Impersonation registry > View.
2. Select Add a user:

- Choose Manual input as the Input method.
- Under User info, enter the Display name.
- Under User email, enter the Email addresses.

1. Select Save.

To view users you manually added:

1. Go to Directories.
2. Select Email Security Directory.
3. Any manually added user will be displayed under the table as REGISTERED.

## Edit a user

To edit a user in the Email Security directory:

1. Select the user you want to edit.
2. Select the three dots > Edit.
3. Enter a user name and/or email.
4. Select Save.

## Delete a user

To delete a user from the Email Security directory:

1. Select the user you want to delete.
2. Select the three dots > Delete.
3. Read the pop-up message, and then select Delete user.

To delete multiple users from the registry at once:

1. Select the users you want to delete.
2. Select the Action dropdown list > Delete.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Allow policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/allow-policies/](https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/allow-policies/)

Page options # Allow policies

Email Security allows you to configure allow policies. An allow policy exempts messages that match certain patterns from normal detection scanning.

## How allow policies work

Allow policies are crucial for legitimate messages that may otherwise be blocked due to, for example, an incorrect setup.

Example of allow policy

An example of allow policy is a phishing simulation product. You want to configure a phishing simulation product as Accept sender so Email Security does not scan the messages (or crawl links) in these simulated messages.

Allow policies can be configured to match messages based on specific criteria such as individual email addresses, IP address ranges, or domains. This flexibility allows you to exempt legitimate messages from specific sources, even if those sources have low spam reputation or send bulk messages from their own servers.

Allow policies are used to mitigate false positives. When an email has been marked as malicious or suspicious, but you still want to receive that email, you configure that email as part of an allow policy.

### Accept sender

Allow policies in Email Security give you the option to choose Accept sender.

Accept sender creates exceptions for messages that would otherwise be marked as spam, bulk, or spoof. However, Email Security will continue to scan the message for maliciousness.

It is recommended to choose this option, as it is the safest option to protect your email inbox from malicious or suspicious activities.

Example of a use case where marketing emails that are legitimate have been blocked

When a marketing email does not follow the correct template, it may be marked as malicious or spam. It may not be possible to change the template. However, in this scenario, the marketing email is legitimate.

To make sure that users still receive the marketing email, you will have to select Accept sender and add the marketing domain in Rule Type > Domains.

Accept sender and Domains combined exempt marketing emails that may not follow the correct template.

## Configure allow policies

To configure allow policies:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Settings, then go to Detection settings > Allow policies.
4. On the Detection settings page, select Add a policy.
5. On the Add an allow policy page, enter the policy information:

Input method: Choose between Manual input, and Uploading an allow policy:

Manual input:

Action: Select one of the following to choose how Email Security will handle messages that match your criteria:

Trust sender: Messages will bypass all detections and link following.
Exempt recipient: Message to this recipient will bypass all detections.
Accept sender: Messages from this sender will be exempted from Spam, Spoof, and Bulk dispositions. Refer to Allow policy configuration use cases for use case examples on how to configure allow policies for accept sender.




Rule type: Specify the scope of your policy. Choose one of the following:

Email addresses: Must be a valid email. Enter an email address whose emails are going to be exempted.
IP addresses: This is the IP address of the email server. Any email address sent from this email server is going to be allowed. The IP address can only be IPv4. IPv6 and CIDR are invalid entries.
Domains: Must be a valid domain.
Regular expressions: Must be valid Java expressions. Regular expressions are matched with fields related to the sender email address (envelope from, header from, reply-to), the originating IP address, and the server name for the email. For example, you can enter .*@domain\.com to exempt any email address that ends with domain.com.


(Recommended) Sender verification: This option enforces DMARC, SPF, or DKIM authentication. If you choose to enable this option, Email Security will only honor policies that pass authentication.

Notes: Provide additional information about your allow policy.




Uploading an allow policy: Upload a file no larger than 150 KB. The file can only contain Pattern, Pattern Type, Verify Email, Trusted Sender, Exempt Recipient, Acceptable Sender, Notes fields. The first row must be a header row. Refer to CSV uploads for an example file.
6. Input method: Choose between Manual input, and Uploading an allow policy:

Manual input:

Action: Select one of the following to choose how Email Security will handle messages that match your criteria:

Trust sender: Messages will bypass all detections and link following.
Exempt recipient: Message to this recipient will bypass all detections.
Accept sender: Messages from this sender will be exempted from Spam, Spoof, and Bulk dispositions. Refer to Allow policy configuration use cases for use case examples on how to configure allow policies for accept sender.




Rule type: Specify the scope of your policy. Choose one of the following:

Email addresses: Must be a valid email. Enter an email address whose emails are going to be exempted.
IP addresses: This is the IP address of the email server. Any email address sent from this email server is going to be allowed. The IP address can only be IPv4. IPv6 and CIDR are invalid entries.
Domains: Must be a valid domain.
Regular expressions: Must be valid Java expressions. Regular expressions are matched with fields related to the sender email address (envelope from, header from, reply-to), the originating IP address, and the server name for the email. For example, you can enter .*@domain\.com to exempt any email address that ends with domain.com.


(Recommended) Sender verification: This option enforces DMARC, SPF, or DKIM authentication. If you choose to enable this option, Email Security will only honor policies that pass authentication.

Notes: Provide additional information about your allow policy.
7. Manual input:

Action: Select one of the following to choose how Email Security will handle messages that match your criteria:

Trust sender: Messages will bypass all detections and link following.
Exempt recipient: Message to this recipient will bypass all detections.
Accept sender: Messages from this sender will be exempted from Spam, Spoof, and Bulk dispositions. Refer to Allow policy configuration use cases for use case examples on how to configure allow policies for accept sender.
8. Action: Select one of the following to choose how Email Security will handle messages that match your criteria:

Trust sender: Messages will bypass all detections and link following.
Exempt recipient: Message to this recipient will bypass all detections.
Accept sender: Messages from this sender will be exempted from Spam, Spoof, and Bulk dispositions. Refer to Allow policy configuration use cases for use case examples on how to configure allow policies for accept sender.
9. Trust sender: Messages will bypass all detections and link following.
10. Exempt recipient: Message to this recipient will bypass all detections.
11. Accept sender: Messages from this sender will be exempted from Spam, Spoof, and Bulk dispositions. Refer to Allow policy configuration use cases for use case examples on how to configure allow policies for accept sender.
12. Rule type: Specify the scope of your policy. Choose one of the following:

Email addresses: Must be a valid email. Enter an email address whose emails are going to be exempted.
IP addresses: This is the IP address of the email server. Any email address sent from this email server is going to be allowed. The IP address can only be IPv4. IPv6 and CIDR are invalid entries.
Domains: Must be a valid domain.
Regular expressions: Must be valid Java expressions. Regular expressions are matched with fields related to the sender email address (envelope from, header from, reply-to), the originating IP address, and the server name for the email. For example, you can enter .*@domain\.com to exempt any email address that ends with domain.com.
13. Email addresses: Must be a valid email. Enter an email address whose emails are going to be exempted.
14. IP addresses: This is the IP address of the email server. Any email address sent from this email server is going to be allowed. The IP address can only be IPv4. IPv6 and CIDR are invalid entries.
15. Domains: Must be a valid domain.
16. Regular expressions: Must be valid Java expressions. Regular expressions are matched with fields related to the sender email address (envelope from, header from, reply-to), the originating IP address, and the server name for the email. For example, you can enter .*@domain\.com to exempt any email address that ends with domain.com.
17. (Recommended) Sender verification: This option enforces DMARC, SPF, or DKIM authentication. If you choose to enable this option, Email Security will only honor policies that pass authentication.

Notes: Provide additional information about your allow policy.
18. Notes: Provide additional information about your allow policy.
19. Uploading an allow policy: Upload a file no larger than 150 KB. The file can only contain Pattern, Pattern Type, Verify Email, Trusted Sender, Exempt Recipient, Acceptable Sender, Notes fields. The first row must be a header row. Refer to CSV uploads for an example file.
20. Select Save.

Allow policy configuration use cases

The following use cases show how you could configure allow policies for accept sender.

### Use case 1

Company receives emails from third-party providers not used internally. These emails are sent from the service provider, and Email Security gives these emails an incorrect disposition.

This use case can affect companies such as Shopify, PayPal, and Docusign.

To solve this:

1. Create a team submission.
2. Inform your Cloudflare contact about the escalation.
3. Do not set up allow policies or blocked senders. In this use case, configuring allow policies will create a security gap. Setting up blocked senders will block legitimate emails from providers such as Shopify, PayPal, and Docusign.

### Use case 2

Company receives emails via third-party providers that are used internally. These emails are sent from the company's custom domain, but Email Security marks these emails as bulk, spam, or spoof.

This use case can cause the emails you want to receive to follow the auto-moves rules you set up. This use case affects emails from internal tools (such as Salesforce, Atlassian, and Figma) that are given an incorrect disposition.

To solve this, when you add an allow policy in the Zero Trust dashboard:

1. Choose Accept sender.
2. Verify that Sender verification (recommended) is turned on.

### Use case 3

Company receives emails via third-party providers that are used internally. These emails are sent from the company's custom domain, but Email Security marks these emails as bulk, spam, or spoof. The custom email domain does not support DMARC, SPF, or DKIM, and would fail Sender Verification.

This use case impacts the emails from internal tools (such as Salesforce, Atlassian, and Figma) that are given an incorrect disposition.

To solve this, when you add an allow policy in the Zero Trust dashboard:

1. Choose Accept sender based on the static IP you own.
2. Ensure that Sender verification (recommended) is turned off.

Warning

Do not use email addresses or email domains for this policy as they can be easily spoofed without Sender Verification (Recommended) enabled.

### CSV uploads

You can upload a file no larger than 150 KB. The file can only contain Pattern, Pattern Type, Verify Email, Trusted Sender, Exempt Recipient, Acceptable Sender, Notes. The first row must be a header row.

An example file would look like this:

```
Pattern, Pattern Type, Verify Email, Trusted Sender, Exempt Recipient, Acceptable Sender, Noteswhale@notaphish.com, EMAIL, true, true, false, true, not a phish
```

## Export allow policies

To export all allow policies:

1. On the Detection settings page, select Value(s). Selecting Value(s) will select all allow policies.
2. Select Export to CSV.

To export specific allow policies:

1. On the Detection settings page, select the allow policies you want to export.
2. Select Export to CSV.

## Edit allow policy

To edit an allow policy:

1. On the Detection settings page, select the allow policy you want to edit.
2. Select the three dots > Edit.
3. Edit the allow policy.
4. Select Save.

## Delete allow policy

To delete an allow policy:

1. On the Detection settings page, select the allow policy you want to delete.
2. Select the three dots > Delete.
3. On the pop-up message, select Delete.

To delete multiple allow policies at once:

1. On the Detection settings page, select the allow policies you want to delete.
2. Select Action.
3. Select Delete.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Blocked senders

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/blocked-senders/](https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/blocked-senders/)

Page options # Blocked senders

Email Security marks all messages from these senders with a malicious disposition.

## How blocked senders work

Blocked senders ensures messages from any sender is automatically marked as malicious, preventing them from reaching users' inbox.

Sometimes, the same email, IP address or domain always sends malicious emails to the company. In this case, you can add an email address, IP address or domain as a blocked sender. You can choose to enter a regular expression by turning Regular expression on.

## Configure blocked senders

To configure blocked senders:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Settings, go to Detection settings > Blocked senders.
4. On the Detection settings page, select Add a sender.
5. Select the Input method: Choose between Manual input, and Upload blocked sender list:

Manual input:

Sender type:

Email addresses: Must be a valid email.
IP addresses: Can only be IPv4. IPv6 and CIDR are invalid entries.
Domains: Must be a valid domain.
Regular expressions: Must be valid Java expressions. Regular expressions are matched with fields related to the sender email address (envelope from, header from, reply-to), the originating IP address, and the server name for the email. For example, you can enter .*@domain\.com to exempt any email address that ends with domain.com.


Notes: Provide additional information about the blocked sender policy.


Upload blocked sender list: Upload a file no larger than 150 KB. The file cannot can only contain Blocked_Sender, Pattern Type, and Notes fields. The first row must be a header row. Refer to CSV uploads for an example file.
6. Manual input:

Sender type:

Email addresses: Must be a valid email.
IP addresses: Can only be IPv4. IPv6 and CIDR are invalid entries.
Domains: Must be a valid domain.
Regular expressions: Must be valid Java expressions. Regular expressions are matched with fields related to the sender email address (envelope from, header from, reply-to), the originating IP address, and the server name for the email. For example, you can enter .*@domain\.com to exempt any email address that ends with domain.com.


Notes: Provide additional information about the blocked sender policy.
7. Sender type:

Email addresses: Must be a valid email.
IP addresses: Can only be IPv4. IPv6 and CIDR are invalid entries.
Domains: Must be a valid domain.
Regular expressions: Must be valid Java expressions. Regular expressions are matched with fields related to the sender email address (envelope from, header from, reply-to), the originating IP address, and the server name for the email. For example, you can enter .*@domain\.com to exempt any email address that ends with domain.com.
8. Email addresses: Must be a valid email.
9. IP addresses: Can only be IPv4. IPv6 and CIDR are invalid entries.
10. Domains: Must be a valid domain.
11. Regular expressions: Must be valid Java expressions. Regular expressions are matched with fields related to the sender email address (envelope from, header from, reply-to), the originating IP address, and the server name for the email. For example, you can enter .*@domain\.com to exempt any email address that ends with domain.com.
12. Notes: Provide additional information about the blocked sender policy.
13. Upload blocked sender list: Upload a file no larger than 150 KB. The file cannot can only contain Blocked_Sender, Pattern Type, and Notes fields. The first row must be a header row. Refer to CSV uploads for an example file.
14. Select Save.

### CSV uploads

You can upload a file no larger than 150 KB. The file cannot can only contain Blocked_Sender, Pattern Type, and Notes fields. The first row must be a header row.

An example file would look like this:

```
Blocked Sender, Pattern Type, Notesjohn.smith@gmail.com, EMAIL, John Smithexample.com, DOMAIN, Melanie Turner
```

## Export blocked senders

To export all blocked senders:

1. On the Detection settings page, select Sender. Selecting Sender will select all blocked senders.
2. Select Export to CSV.

To export specific blocked senders:

1. On the Detection settings page, select Value(s). Select the blocked senders you want to export.
2. Select Export to CSV.

## Edit a blocked sender

To edit a blocked sender:

1. On the Detection settings page, select the blocked sender you want to edit.
2. Select the three dots > Edit.
3. Edit the blocked sender.
4. Select Save.

## Delete a blocked sender

To delete a blocked sender:

1. On the Detection settings page, select the blocked sender you want to delete.
2. Select the three dots > Delete.
3. On the pop up message, select Delete.

To delete multiple blocked senders at once:

1. On the Detection settings page, under Blocked senders, select the senders you want to delete.
2. Select Action
3. Select Delete.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Trusted domains

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/trusted-domains/](https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/trusted-domains/)

Page options # Trusted domains

Email Security allows you to exempt known partner and internal domains from typical detection scanning. Adding trusted domains helps to reduce false positives on malicious, suspicious, and spoof dispositions. Email Security only checks the date when the domain is created.

## How trusted domains work

Trusted domains are not for the email message itself, but for entire domains.

By default, Email Security automatically detects lookalike domains. Lookalike domains can be something like this: thisisdomain.com and thisisadomain.com. Both domains almost look identical.

If an email is received from a domain that looks like a configured domain, this will trigger a detection. Trusted domain is configured to ignore this detection.

In Additional detections, you can configure malicious domain and suspicious domain age.

Malicious domain age means that someone may create a domain today, similar to a target, and start sending emails with that domain. This is usually how many phish campaigns start. In this case, the domain is usually marked as Malicious. Malicious domain age is usually set to 7 days.

Suspicious domain age means that after 7 days (this number corresponds to the Malicious domain age), a domain may not be malicious, but it can still be suspicious. Email Security will mark these domains as Suspicious. It is recommended to configure the Suspicious domain age between 30 and 45 days.

To view whether a domain is malicious or suspicious:

1. In Zero Trust ‚Üó, go to Investigation.
2. Run a screen. For example, select Run screen for Malicious emails, then select Run screen.
3. Under Your matching messages, if any message displays Domain Age under Threat types, that means that the domain age is too low, and therefore the disposition assigned is Malicious. If the domain is legitimate, you can add it as a trusted domain:

Go to Settings > Trusted Domains.
Under Domain Info, add the domain, and select New Domain. This will mark the domain whose age is low as a trusted domain.
4. Go to Settings > Trusted Domains.
5. Under Domain Info, add the domain, and select New Domain. This will mark the domain whose age is low as a trusted domain.

## Configure trusted domains

To configure a trusted domain:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Settings, go to Detection settings > Trusted domains.
4. On the Detection settings page, select Add a domain.
5. Select the Input method: Choose between Manual input, and Upload trusted domain list:

Manual input:

Domain info: Enter a valid domain name.
Domain type: Select one or both options:

Proximity domain: Domains with similar spelling to your existing domain.
Recent domain: Domains created recently.




Notes: Provide additional information about the trusted domain list.


Upload trusted domain list: You can upload a file no larger than 150 KB of multiple trusted domains. The file can only contain Domain, Proximity, New and Notes fields. The first row must be a header row. Refer to CSV uploads for an example file.
6. Manual input:

Domain info: Enter a valid domain name.
Domain type: Select one or both options:

Proximity domain: Domains with similar spelling to your existing domain.
Recent domain: Domains created recently.




Notes: Provide additional information about the trusted domain list.
7. Domain info: Enter a valid domain name.
8. Domain type: Select one or both options:

Proximity domain: Domains with similar spelling to your existing domain.
Recent domain: Domains created recently.
9. Proximity domain: Domains with similar spelling to your existing domain.
10. Recent domain: Domains created recently.
11. Notes: Provide additional information about the trusted domain list.
12. Upload trusted domain list: You can upload a file no larger than 150 KB of multiple trusted domains. The file can only contain Domain, Proximity, New and Notes fields. The first row must be a header row. Refer to CSV uploads for an example file.
13. Select Save.

### CSV uploads

You can upload a file no larger than 150 KB of multiple trusted domains. The file can only contain Domain, Proximity, New and Notes fields. The first row must be a header row.

An example file would look like this:

```
Domain, Proximity, New, Notesmydomain.com, true, true, First Persontestdomain.com, false, true, New Hire
```

## Export trusted domains

To export all trusted domains:

1. On the Detection settings page, select Domain. Selecting Domain will select all trusted domains.
2. Select Export to CSV.

To export specific trusted domains:

1. On the Detection settings page, select the trusted domains you want to export.
2. Select Export to CSV.

## Edit trusted domains

To edit a trusted domain:

1. On the Detection settings page, select the trusted domains you want to edit.
2. Select the three dots > Edit.
3. Edit the trusted domain.
4. Select Save.

## Delete trusted domains

To delete trusted domains:

1. On the Detection settings page, select the trusted domain you want to delete.
2. Select the three dots > Delete.
3. On the pop up message, select Delete.

To delete multiple trusted domains at once:

1. On the Detection settings page, select the trusted domains you want to delete.
2. Select Action.
3. Select Delete.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Impersonation registry

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/impersonation-registry/](https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/impersonation-registry/)

Page options # Impersonation registry

The impersonation registry contains combinations of emails of users who are likely to be impersonated. If there is an email that is on the impersonation registry not listed as an alternative email address, that email will be reported as potential business email compromise (BEC) ‚Üó.

Note

The impersonation registry should contain a list of users who are likely to be impersonated. Email Security applies enhanced security to variations of registered email addresses for additional Business Email Compromise (BEC) ‚Üó protection.

For easier tracking, the Email Security team recommends syncing and structuring VIPs in groups, and avoid doing manual inputs of users.

To add a user to the impersonation registry:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Settings > Impersonation registry.
4. Select Add a user.
5. Select Input method: Choose between Manual input, Upload manual list, and Select from existing directories:

Manual input: Enter the following information:

User info: enter a valid Display name.
User email: Enter one of the following:

Email address: Enter all known email addresses, separated by a comma.
Regular expressions: Must be valid Java expressions.




Upload manual list: You can upload a file no larger than 150 KB containing all variables of potential emails. The file must contain Display_Name and Email, and the first row must be the header row. Refer to CSV uploads for an example file.
Select from existing directories:

Select directory: Select your directory.
Add users or groups: Choose the users or groups you want to register.
6. Manual input: Enter the following information:

User info: enter a valid Display name.
User email: Enter one of the following:

Email address: Enter all known email addresses, separated by a comma.
Regular expressions: Must be valid Java expressions.
7. User info: enter a valid Display name.
8. User email: Enter one of the following:

Email address: Enter all known email addresses, separated by a comma.
Regular expressions: Must be valid Java expressions.
9. Email address: Enter all known email addresses, separated by a comma.
10. Regular expressions: Must be valid Java expressions.
11. Upload manual list: You can upload a file no larger than 150 KB containing all variables of potential emails. The file must contain Display_Name and Email, and the first row must be the header row. Refer to CSV uploads for an example file.
12. Select from existing directories:

Select directory: Select your directory.
Add users or groups: Choose the users or groups you want to register.
13. Select directory: Select your directory.
14. Add users or groups: Choose the users or groups you want to register.
15. Select Save.

### CSV uploads

You can upload a file no larger than 150 KB containing all variables of potential emails. The file must contain Display_Name and Email, and the first row must be the header row.

An example file would look like this:

```
Display Name, EmailStar Phish, star@nophish.comPhish Ee, phishee@nophish.com
```

## Edit users

Note

Administrators can edit the names and emails of users who belong to the Email Security directory. Administrators from other integrated directories cannot edit the name and the primary emails of users.

To edit users from the Email Security directory:

1. Select the user you want to edit.
2. Select the three dots > Edit.
3. Enter the Display name, Email and Secondary email.
4. Select Save.

To edit users from other integrations:

1. Select the user you want to edit.
2. Select the three dots > Edit.
3. Enter the Secondary email.
4. Select Save.

## Remove users

Note

Adiministrators can remove users who belong to the Email Security directory from the Impersonation registry. Users who come from an integrated directory cannot be removed from the Impersonation registry directly.

To remove a user from an integrated directory:

1. Select Directories on the sidebar.
2. Select the directory where your user is allocated.
3. Select the Users tab.
4. Search for the user you want to remove.
5. Select the three dots > Remove from registry.

To remove a user from the impersonation registry:

1. Select the user you want to remove.
2. Select the three dots > Remove from registry.
3. Read the pop-up message, then select Remove user.

To remove multiple users at once from the impersonation registry:

1. Select all the users you want to remove.
2. Select Action > Remove from registry.
3. Read the pop-up message, then select Remove users.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Additional detections

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/additional-detections/](https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/additional-detections/)

Page options # Additional detections

Email Security allows you to configure the following additional detections:

- Domain age
- Blank email detection
- Automated Clearing House (ACH) ‚Üó change from free email detection
- HTML attachment email detection

To configure additional detections:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Settings.
4. On the Settings page, go to Detection settings > Additional detections, and select Edit.

## Configure domain age

The domain age is the time since the domain has been registered.

Because of the domain age detection, trusted domains can be used to create an exception to the age detection.

To configure a domain age:

1. On the Edit additional detections page:

Select Malicious domain age: Controls the threshold for a malicious disposition. Maximum of 100 days. It is recommended to set the Malicious domain age to 7 days.
Select Suspicious domain age: Controls the threshold for a suspicious disposition. Maximum of 100 days. It is recommended to set the Suspicious domain age between 30 and 45 days.
2. Select Malicious domain age: Controls the threshold for a malicious disposition. Maximum of 100 days. It is recommended to set the Malicious domain age to 7 days.
3. Select Suspicious domain age: Controls the threshold for a suspicious disposition. Maximum of 100 days. It is recommended to set the Suspicious domain age between 30 and 45 days.
4. Select Save.

## Configure blank email detection

Blank email detection detects emails with blank bodies and assigns a default disposition. You can choose between Malicious and Suspicious as dispositions.

To enable blank email detection:

1. On the Edit additional detections page, enable Blank email detection.
2. Choose between Malicious and Suspicious.
3. Select Save.

## Configure ACH change from free email detection

Automated Clearing House (ACH) ‚Üó is a banking term related to direct deposits. ACH change from free email detection detects payroll inquiries or change requests from free email domains and assigns a default disposition. You can choose between Malicious and Suspicious as dispositions.

To enable ACH change from free email detection:

1. On the Edit additional detections page, enable ACH change from free email detection.
2. Choose between Malicious and Suspicious.
3. Select Save.

## Configure HTML attachment email detection

HTML attachment email detection detects HTM and HTML attachments in emails and assigns a default disposition.

To enable HTML attachment email detection:

1. On the Edit additional detections page, enable HTML attachment email detection.
2. Choose between Malicious and Suspicious.
3. Select Save.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Configure link actions

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/configure-link-actions/](https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/configure-link-actions/)

Page options # Configure link actions

You can configure how Email Security handles links in emails.

Note

You can only configure link actions if you deploy Email Security via MX/Inline.

To configure link actions:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Settings, then go to Detection settings > Link actions > View.

You can configure Link actions settings, or URL rewrite ignore patterns.

## Link actions settings

To configure link actions, select Configure.

The dashboard will display Open links evaluated as suspicious in a remote browser (Recommended). This option is turned on by default. Email Security will also allow you to select message dispositions to open all the links for dispositioned emails in a remote browser.

Select one or more disposition, then select Save.

If Open links evaluated as suspicious in a remote browser (Recommended) is turned off, you can select URL defang or No action on each disposition. Select Save once you have completed the configuration.

## Add patterns for URLs

You can add patterns for URLs that should be rewritten.

1. Under URL rewrite ignore patterns, select Add a pattern.
2. Enter a valid IP, URL, or regular expression. You can enter up to 512 characters.
3. Select Save.

To edit a pattern, go to the pattern you want to edit, select the three dots, then Edit. Once you have finished modifying the URL patter, select Save.

To delete a pattern, go to the pattern you want to delete, select the three dots, then Delete.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Configure text add-ons

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/configure-text-add-ons/](https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/configure-text-add-ons/)

Page options # Configure text add-ons

You can create custom labels to be used as the subject or body prefix for emails with specific dispositions.

Note

You can only configure text add-ons if you deploy Email Security via MX/Inline.

Warning

If you currently do not have text add-ons enabled, configuring text add-ons will add a banner to the subject line. As a result, the subject line and the email body will be reduced.

## Subject prefix

To configure a subject prefix:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Settings, then go to Detection settings > Text add-ons > View.
4. Select Configure > Subject prefix.
5. Populate each disposition with a subject prefix, and turn on the Status to enable the subject prefix for a specific disposition.

### Advanced settings

In Advanced settings, you can configure Add "labels" variable. This option allows you to add a dynamic value for a label that lists dispositions and allows for additional text.

To turn on Add "labels" variable:

1. Go to Advanced settings > Add "labels" variable.
2. Choose between:

Use default.
Use custom "labels" variable: Enter the custom label in the text box.
3. Use default.
4. Use custom "labels" variable: Enter the custom label in the text box.

Once you have configured the subject prefix, select Save.

## Body prefix

A body prefix is a custom label added to the top of the email body for emails with specific dispositions.

Populate each disposition with a body prefix, and turn on the Status to enable the body prefix for a specific disposition.

### Advanced settings

In Advanced settings, you can configure Add "labels" or "threat types" variable. This option allows you to add a dynamic value for labels that lists dispositions, or threats that lists the threat types behind an assigned disposition.

To turn on Add "labels" or "threat types" variable:

1. Go to Advanced settings:
2. Choose between:

Add "labels" variable: This option allows you to add a dynamic value that for a label that lists dispositions and allows for additional text. Choose between:

Use default.
Use custom "labels" variable: Enter the custom label in the text box.
3. Add "labels" variable: This option allows you to add a dynamic value that for a label that lists dispositions and allows for additional text. Choose between:

Use default.
Use custom "labels" variable: Enter the custom label in the text box.
4. Use default.
5. Use custom "labels" variable: Enter the custom label in the text box.

Once you have configured the body prefix, select Save.

### Add threat types variable

This option allows you to include a dynamic value for '%THREATS' that lists the threat types behind an assigned disposition. It can include additional, HTML-formatted text.

The dashboard will display Default or Custom (to use "labels" or "threat types" variable), depending on how you configured the advanced settings.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Auto-move events

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/auto-moves/](https://developers.cloudflare.com/cloudflare-one/email-security/auto-moves/)

Page options # Auto-move events

Auto-move events are events where emails are automatically moved to different inboxes based on the disposition Email Security assigned to them.

Email Security shows you the total number of auto-moves and the source folder from which these moves are originating from.

To configure auto-move events:

1. Log in to Zero Trust ‚Üó.
2. Select Email security.
3. Select Settings.
4. Select Moves.
5. Under Auto-moves, select Configure.
6. Assign actions based on malicious, spoof, suspicious, spam, and bulk dispositions. Select among:

Soft delete - user recoverable: Moves the message to the user's Recoverable Items - Deleted folder. Messages can be recovered by the user.
Hard delete - admin recoverable: Completely deletes messages from a user's inbox.
Move to trash: Moves messages to the trash or deleted items email folder.
Move to junk: Moves the message to the junk or spam folder.
No action: Messages stay in the origin folder.
7. Soft delete - user recoverable: Moves the message to the user's Recoverable Items - Deleted folder. Messages can be recovered by the user.
8. Hard delete - admin recoverable: Completely deletes messages from a user's inbox.
9. Move to trash: Moves messages to the trash or deleted items email folder.
10. Move to junk: Moves the message to the junk or spam folder.
11. No action: Messages stay in the origin folder.
12. Select Post-delivery moves:

(Recommended) Post-delivery response: Enabling this option allows Email Security to rescan delivered emails at multiple time intervals for previously unknown phishing sites or campaigns.
(Recommended) Phish submission response: Enabling this option allows Email Security to move emails that your users reported as phishing and Email Security determined to be malicious.
13. (Recommended) Post-delivery response: Enabling this option allows Email Security to rescan delivered emails at multiple time intervals for previously unknown phishing sites or campaigns.
14. (Recommended) Phish submission response: Enabling this option allows Email Security to move emails that your users reported as phishing and Email Security determined to be malicious.
15. Select Save.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Phish submissions

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/phish-submissions/](https://developers.cloudflare.com/cloudflare-one/email-security/phish-submissions/)

Page options # Phish submissions

As part of your continuous email security posture, administrators and security analysts need to submit missed phishing samples to Email Security, so Cloudflare can process them and take necessary action.

Submitting missed phish samples to Cloudflare is of paramount importance and necessary for continuous protection. Submitting missed phish samples helps Cloudflare improve our machine learning (ML) models, and alerts us of new attack vectors before they become prevalent.

There are three routes you can use to report an email as a phish:

- Via Investigation, by reclassifying an email.
- Via PhishNet M365 or PhishNet for Google Workspace, depending on your email provider.
- Via Submission addresses.

## Reclassify an email

1. Log in to Zero Trust ‚Üó.
2. Select Email Security > Investigation.
3. On the Investigation page, under Your matching messages, select the message you want to reclassify. Select the three dots, then select Request reclassification. By selecting Request reclassification, you are requesting a new disposition for the message.
4. Select the new disposition, then select Save.

When you report an email as phish, this email will be displayed under User submissions.

## PhishNet M365

PhishNet is an add-in button that helps users to submit directly to Email Security phish samples missed by Email Security's detection.

To set up PhishNet M365:

1. Get the customized manifest URL from Zero Trust ‚Üó.
2. Log in to the Microsoft admin panel ‚Üó.
3. Go to Microsoft 365 admin center > Settings > Integrated Apps.
4. Select Upload custom apps.
5. Choose Provide link to manifest file and paste the URL you copied from the Zero Trust dashboard.
6. Verify and complete the wizard.

## PhishNet for Google Workspace

To set up PhishNet with Google Workspace you need admin access to your Google Workspace account.

### Set up PhishNet for Google Workspace

1. Log in to Google Workspace Marketplace apps ‚Üó using this direct link and an administrator account.
2. Select Admin install to install Cloudflare PhishNet. Read the warning, and select Continue.
3. You will be redirected to the Allow data access page, where you can choose to install Cloudflare PhishNet for Everyone at your organization, or Certain groups or organizational units. If you choose the latter option, you will have to select the users in the next step.
4. After choosing the groups you want to install PhishNet for, agree with Google's terms of service, and select Finish.
5. Cloudflare PhishNet has been installed. Select DONE.

You have now successfully installed Cloudflare PhishNet.

### Submit phish with PhishNet

1. In your Gmail web client, open the message you would like to flag as either spam or phish.
2. Select the PhishNet logo on the side panel.
3. Under Select Submission Type, select Spam or Phish.
4. Select Submit Report.

## Submission addresses

To view the destination addresses of user and team submissions:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Settings.
4. Go to Phish submission > Submission addresses > View.

The dashboard will display User submission addresses and Team submission addresses.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Outbound Data Loss Prevention (DLP)

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/outbound-dlp/](https://developers.cloudflare.com/cloudflare-one/email-security/outbound-dlp/)

Page options # Outbound Data Loss Prevention (DLP)

Compatibility

Outbound DLP is only compatible with Microsoft 365. You need to have Microsoft E3 or E5 license to enable Outbound DLP.

Outbound Data Loss Prevention ensures the protection of sensitive information in outbound emails with Cloudflare Data Loss Prevention (DLP). Outbound Data Loss Prevention integrates with your inbox, and it proactively monitors your email to prevent unauthorized data leaks.

To enable Outbound DLP:

1. Create an outbound policy.
2. Set up DLP Assist add-in.

## 1. Create an outbound policy

An outbound policy allows you to control outbound email flow.

To create an outbound DLP policy:

1. In Zero Trust ‚Üó, go to Email Security > Outbound DLP.
2. Select Add a policy.
3. Name your policy.
4. Build an expression to match specific email traffic. For example, you can create a policy that blocks outbound emails containing identifying numbers:


























SelectorOperatorValueLogicActionRecipient emailnot inexample.comAndBlockMatched DLP profileinSocial Security, Insurance, Tax, and Identifier Numbers
5. (Optional) Choose whether to use the default block message or a custom message.
6. Select Create policy.

After creating your policy, you can modify or reorder your policies in Email Security > Outbound DLP.

### Selectors

| Selector | Description |
| --- | --- |
| Recipient email | The intended recipient of an outbound email. |
| Email sender | The user in your organization sending an email. |
| Matched DLP profile | The DLP profile that content of an email matches upon scan. |

## 2. DLP Assist add-in

The Data Loss Prevention (DLP) Assist add-in allows Microsoft 365 users to deploy a DLP solution for free using Cloudflare's Email Security.

To set up DLP Assist add-in:

1. In Zero Trust ‚Üó, go to Email Security > Outbound DLP.
2. Select View Microsoft add-in instructions > Select Download add-in. This downloads a .xml file necessary to install the add-in on the client side.
3. Set up the add-in in Microsoft 365:

Log in to the Microsoft admin panel ‚Üó and go to Microsoft 365 Admin Center > Settings > Integrated Apps.
Choose Upload custom apps and select Office Add-in for the application type.
Select Upload manifest file (.xml) from device.
Upload the Cloudflare add-in file you downloaded in step three. Then, verify and complete the wizard. It can take up to 24 hours for an add-in to propagate.
4. Log in to the Microsoft admin panel ‚Üó and go to Microsoft 365 Admin Center > Settings > Integrated Apps.
5. Choose Upload custom apps and select Office Add-in for the application type.
6. Select Upload manifest file (.xml) from device.
7. Upload the Cloudflare add-in file you downloaded in step three. Then, verify and complete the wizard. It can take up to 24 hours for an add-in to propagate.

The add-in works by inserting headers into the EML ‚Üó on the client side before the message is sent out.

To block, encrypt, or send approval, you can configure rules within Microsoft Purview DLP:

1. Go to Microsoft Purview ‚Üó.
2. Select Policies > Create policy.
3. Do not choose any templates or custom policy. Select Next.
4. Choose a name and description for the policy: You can choose any name. However, this guide will use Cloudflare Assist Block.
5. Select Next on Admin Units:

Choose to only apply to Exchange Email.
Choose Create or customize advanced DLP Rules.
6. Choose to only apply to Exchange Email.
7. Choose Create or customize advanced DLP Rules.
8. Select Create rule:

Create a policy name.
Add the following conditions:

Header contains words or phrases: Key: cf_outbound_dlp with Value: BLOCK
Select AND.
Content is shared from Microsoft 365: Select with people from outside my organization.
9. Create a policy name.
10. Add the following conditions:

Header contains words or phrases: Key: cf_outbound_dlp with Value: BLOCK
Select AND.
Content is shared from Microsoft 365: Select with people from outside my organization.
11. Header contains words or phrases: Key: cf_outbound_dlp with Value: BLOCK
12. Select AND.
13. Content is shared from Microsoft 365: Select with people from outside my organization.
14. Under Actions, the admin can choose what to do with the message. You can use the Restrict access or encrypt the content in Microsoft 365 locations to block the message or encrypt it.
15. Under User notifications, turn on notifications. Admins can also edit the message if they want to. You can also configure if the admin wants to receive a notification under Incident reports >  Use this severity level in admin alerts and reports.
16. Select Save.
17. Select Turn the Policy On Immediately.

Note

The Cloudflare add-in can take up to 24 hours to propagate after install.

### Limitations

Outbound DLP presents its limitations:

- Outbound DLP only protects user-managed inboxes.
- Outbound DLP offers the most consistent experience on Outlook Web App and Outlook desktop, due to limitations imposed by Microsoft.

| Platform | Status |
| --- | --- |
| Web client | Stable |
| New Outlook desktop client - Windows | Stable |
| Desktop client - macOS | Can cause scanning to be delayed due to Apple limitation |
| Old Outlook desktop client | Does not work due to Microsoft limitation |
| Mobile client - iOS | Unstable due to Apple limitation |
| Mobile client - Android | Unstable due to Microsoft limitation |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## PhishGuard

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/phish-guard/](https://developers.cloudflare.com/cloudflare-one/email-security/phish-guard/)

Page options # PhishGuard

PhishGuard is a managed email security service that provides resources for end-to-end phish and targeted attack management and response. With PhishGuard, you can preemptively block phishing attacks ‚Üó, malware ‚Üó, Business Email Compromise (BEC) ‚Üó, and vendor email fraud.

To use PhishGuard:

1. Log in to Zero Trust ‚Üó.
2. Select Email security.
3. Select PhishGuard.

The dashboard will display the following metrics:

- ROI Calculator
- Insider threat defense
- Email threat hunting
- Actions
- API Status
- Managed email security operations
- Reports

## ROI Calculator

Use the ROI Calculator to compare triage durations and hourly rates to calculate PhishGuard's return on investment.

The ROI Calculator displays:

- Total aggregated saved number in USD dollars.
- Triage duration: The amount of time in minutes spent triaging the message.
- Hourly rate.

## Insider threat defense

An insider threat ‚Üó is a risk to an organization's security stemming from someone associated with the organization.

Insider threat defense on the dashboard displays Insider leads and Insider reports generated. Insider leads displays the number of emails identified as potential insider threat email. Insider reports generated displays the number of reports created based on insider leads.

## Email threat hunting

Email threat hunting displays previously unknown phishing attacks.

Email threat hunting displays Threat leads generated and Total reposts generated.

## Actions

Actions allows you to review the most common actions taken by the PhishGuard team, such as escalations, threat hunts, and moves.

## API Status

API Status allows you to monitor and configure the current status of API message auto-moves and directory integrations.

Select Message moves to configure auto-moves. Select Directory integration to configure directories.

## Managed email security operations

Managed email security operations allows you to review the results of phish submissions reviewed by the PhishGuard team.

It displays the following:

- Total phish submissions
- Tracked incidents
- Median time to resolve
- Resolved track incidents

## Reports

Under Reports, you can review reports of threats discovered and resolved by the PhishGuard team.

If you select the three dots, you can:

- View report details: Report Details gives you the following information about each report:

Overview: An Overview of the report. This includes date and time of the report, type of attack performed, and more.
Target and victimology: Company targeted.
Details: Displays information such as delivery disposition, current disposition, ES Alert ID, Message-ID, Timestamp, Subject, and Attempted Fraudulent Amount.
Indicators of compromise (IOC): Indicators of compromise (IOC) ‚Üó are information about a specific security breach that can help security teams determine if an attack has taken place.
- Overview: An Overview of the report. This includes date and time of the report, type of attack performed, and more.
- Target and victimology: Company targeted.
- Details: Displays information such as delivery disposition, current disposition, ES Alert ID, Message-ID, Timestamp, Subject, and Attempted Fraudulent Amount.
- Indicators of compromise (IOC): Indicators of compromise (IOC) ‚Üó are information about a specific security breach that can help security teams determine if an attack has taken place.
- Preview email.
- Move email.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## How Email Security detects phish

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/reference/how-es-detects-phish/](https://developers.cloudflare.com/cloudflare-one/email-security/reference/how-es-detects-phish/)

Page options # How Email Security detects phish

Email Security uses a variety of factors to determine whether a given email message, a web domain or URL, or specific network traffic is part of a phishing campaign (marked with a Malicious disposition) or other common campaigns (for example, Spam).

Note

Certain URL rewrite schemes cannot be decoded (for example, Mimecast).

These small pattern assessments are dynamic in nature and ‚Äî in many cases ‚Äî no single one in and of itself will determine the final verdict. Instead, our automated systems use a combination of factors and non-factors to clearly distinguish between a valid phishing campaign and benign traffic.

## Sample attack types and detections

### Malicious payload attached to the message

- Example: Classic campaign technique which utilizes a variety of active attachment types (EXE, DOC, XLS, PPT, OLE, PDF, and more) as the malicious payload for ransomware attacks, Trojans, viruses, and malware.
- Detections applied: Machine learning (ML) models on binary bitmaps of the payload as well as higher-level attributes of the payload, with specific focus on signatureless detections for maximum coverage. Additionally, for relevant active payloads, the engine invokes a real-time sandbox to assess behavior and determine maliciousness.

### Encrypted malicious payload attached to the message, with password in message body as text

- Example: Campaigns that induce the user to apply a password within the message body to the attachment.
- Detections applied: Real-time lexical parsing of message body for password extraction and ML models on binary bitmaps of the payload, signatureless detections for maximum coverage.

### Encrypted malicious payload attached to the message, with password in message body as an image

- Example: Campaigns that induce the user to apply a password within the message body to the attachment, with the entire body or part of the body being an image.
- Detections applied: Real-time OCR parsing of message body for password extraction and ML models on binary bitmaps of the payload, signatureless detections for maximum coverage.

### Malicious payload within an archive attached to the message

- Example: Campaigns with payloads within typical archives, such as .zip files.
- Detections applied: ML detection tree on the payload, as well as decomposition of each individual archive into component parts and fragments for compound documents.

### Malicious URLs within message body

- Example: Typical phish campaigns with a socially engineered call to action URL that will implant malware (for example, Watering Hole attacks, Malvertizing, or scripting attacks).
- Detections applied: Continuous web crawling, followed by real-time link crawling for a select group of suspicious urls, followed by machine learning applied to URL patterns in combination with other pattern rules and topic-based machine learning models for exhaustive coverage of link-based attacks.

### Malicious payload linked through a URL in a message

- Example: Campaigns where the URL links through to a remote malicious attachment (for example, in a .doc or .pdf file).
- Detections applied: Remote document and/or attachment extraction followed by ML detection tree on the payload, instant crawl of links.

### Blind URL campaigns

- Example: Entirely new domain with intentional obfuscation, seen for the first time in a campaign.
- Detections applied: Link structure analysis, link length analysis, domain age analysis, neural net models on entire URL as well as domain and IP reputation of URL host, including autonomous system name reputation and geolocation based reputation.

### Malicious URLs within a benign attachment in the message

- Example: Campaigns obfuscating the payload within attachments.
- Detections applied: URL extraction within attachments, followed by above mentioned URL detection mechanisms.

### Malicious URLs within an archive attached to the message

- Example: Campaigns obfuscating the payload within attachments.
- Detections applied: Attachments decomposed recursively (both in archive formats and compound document formats) to extract URLs, followed by above mentioned URL detection mechanisms.

### Malicious URLs behind URL shortening services

- Example: Campaigns leveraging Bitly, Owly, and similar services at multiple levels of redirection to hide the target URL.
- Detections applied: URL shorteners crawled in real time at the moment of message delivery to get to the eventual target URL, followed by URL detection methods. Real-time shorterners are intentionally not crawled ahead of time due to the dynamic nature of these services and the variation of target URLs based on time and source.

### Malicious URLs associated with QR codes (QR Code Phishing Attacks, Quishing)

- Example: Campaigns leveraging QR code image attachment to deliver malicious payload links for malware distribution and/or credential harvesting.
- Detections applied: Resolving for images resembling QR codes into URL, followed by above mentioned URL detection mechanisms.

### Instant crawl of URLs within message body

- Example: Typical phish campaigns with a socially engineered call to action URL that will implant a malware (for example, Watering Hole attacks, Malvertizing, or scripting attacks).
- Detections applied: Heuristics applied to URLs in message bodies that are not already detected from ahead of time crawling and those deemed suspicious according to strict criteria are crawled in real time.

### Credential Harvesters

- Example: Form-based credential submission attacks, leveraging known brands (Office 365, PayPal, Dropbox, Google, and more).
- Detections applied: Continuous web crawling, computer vision on top brand lures, ML models, and infrastructure association.

### Domain Spoof Attacks

- Example: Campaigns spoofing sender domains to refer to the recipient domain or some known partner domain.
- Detections applied: Header mismatches, email authentication assessments, sender reputation analysis, homographic analysis, and punycode manipulation assessments.

### Domain proximity attacks

- Example: Campaigns taking advantage of domain similarity to confuse the end user (for example, sampledoma1n.com or sampledomaln.com compared to sampledomain.com).
- Detections applied: Header mismatches, email authentication assessments, and sender reputation analysis.

### Email Auth violations

- Example: Campaigns taking advantage of incorrect or invalid sender Auth records (SPF/DKIM/DMARC) and bypassing incoming Auth-based controls.
- Detections applied: Assessment of sender authentication records against published SPF/DKIM/DMARC records which is applied in combination with overall message attributes.

### Name Spoof Attacks / Executive Attacks (BEC)

- Example: Campaigns targeting executives and high-value targets within the organization or using the high-value targets as sources to attack other employees within the organization.
- Detections applied: Display names compared with known executive names for similarity using several matching models including the Levenshtein algorithm, and if matched, flagged when sender is originating from an unknown domain.

### Fileless / Linkless campaigns (BEC)

- Example: Typically BEC campaigns with an offline call to action (call me, wire money, invoice, or others).
- Detections applied: Message lexical analysis, subject analysis, word count assessments, and sender analysis.

### Deferred campaign attacks

- Example: Campaigns that have no malicious payload and the URL is clean when delivered, but is activated in a deferred manner (3-4 hours later), so the end user is compromised at click time.
- Detections applied: URL rewrites and/or DNS blocks.

### IP-based spam

- Example: Volume-based, large scale spam campaigns primarily originating from compromised IP address spaces or botnets.
- Detections applied: Sender and IP reputation, history, and volume analysis.

### Content-based spam

- Example: Commodity spam largely focused on selling wares.
- Detections applied: Sender reputation, history, volume analysis, and message content analysis for commercial intent.

### Web phishing

- Example: Directly originated or targeted through web (for example, LinkedIn, Malvertizing, and more).
- Detections applied: Web and DNS service and network device integrations, like web proxies and firewalls.

### Mobile phishing

- Example: Remote employee getting phished while outside the corporate network.
- Detections applied: Employee email protection and web and DNS services enforcement in remote users (typically through an MDM integration or an always-on VPN solution).

### Network phishing

- Example: C2 communications for lateral spread within the network or malicious phish downloaded from an external host. Typically seen when an end user gets infected outside the organization, comes back into the network and the C2 hosts uses the infected endpoint to download the implant based on the IP address space it is now resident in.
- Detections applied: Network device integrations (firewalls) and API-based integrations within existing orchestration services.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Information about your domain

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/reference/domain-information/](https://developers.cloudflare.com/cloudflare-one/email-security/reference/domain-information/)

Page options # Information about your domain

- Domain: Domain name.
- Configured method: The deployment method you used to configure your domain.
- Status: Status indicates the state of the configuration. If the dashboard displays No mail flow, you may have to connect a domain to scan.
- Service address: This is the email address you will use to send a copy of your email.
- Source: Depending on how you added the domains, the dashboard will display MS integration, Google, CF zones, or Manual add.
- Integration name: Name of the integration. This field will only be displayed for Microsoft integrations.
- Hops: The number of hops. This will not be displayed if the configuration method is Microsoft Graph API. Hop count will be visible only if it has been configured.
- Date added: Date when the domain was added.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Dispositions and attributes

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/reference/dispositions-and-attributes/](https://developers.cloudflare.com/cloudflare-one/email-security/reference/dispositions-and-attributes/)

Page options # Dispositions and attributes

Email Security uses a variety of factors to determine whether a given email message, domain, URL, or packet is part of a phishing campaign. These small pattern assessments are dynamic in nature and ‚Äî in many cases ‚Äî no single pattern will determine the final verdict.

Detection vs. disposition

Detection is the process Email Security does to identify what threat an email may contain. An email can have multiple detections, but they will only have one and final disposition. The detections an email have will determine the disposition of the email.

## Dispositions

Any traffic that flows through Email Security is given a final disposition, which represents our evaluation of that specific message. Each message will receive only one disposition header, so your organization can take clear and specific actions on different message types.

You can use disposition values when setting up auto-moves.

### Available values

The following disposition values follow an order of maliciousness:

- Malicious: Traffic associated with active threat campaigns. Malicious messages invoked multiple phishing verdict triggers and met thresholds for bad behavior.

Recommendation: Block.
- Recommendation: Block.
- Suspicious: Traffic associated with phishing campaigns (and is under further analysis by our automated systems).

Recommendation: Research these messages internally to evaluate legitimacy.
- Recommendation: Research these messages internally to evaluate legitimacy.
- Spam: Traffic associated with non-malicious, commercial campaigns.

Recommendation: Route to existing Spam quarantine folder.
- Recommendation: Route to existing Spam quarantine folder.
- Spoof: Traffic associated with phishing campaigns that is either non-compliant with your email authentication policies (SPF ‚Üó, DKIM ‚Üó, DMARC ‚Üó) or has mismatching Envelope From and Header From values.

Recommendation: Block after investigating (can be triggered by third-party mail services).
- Recommendation: Block after investigating (can be triggered by third-party mail services).
- Bulk: Traffic often associated with newsletters or marketing campaigns. Refer to Graymail ‚Üó for more details.

Recommendation: Monitor or tag.
- Recommendation: Monitor or tag.

### Header structure

When Email Security adds a disposition header to an email message, that header matches the following format:

```
X-CFEmailSecurity-Disposition: [Value]
```

Note that emails with a disposition of SPAM will be tagged with UCE (unsolicited commercial emails) in their headers:

```
X-CFEmailSecurity-Disposition: UCE
```

## Attributes

Traffic that flows through Email Security can also receive one or more Attributes, which indicate that a specific condition has been met.

### Available values

| Attribute | Notes |
| --- | --- |
| CUSTOM_BLOCK_LIST | This message matches a value you have defined in your custom block list. |
| NEW_DOMAIN_SENDER=<REGISTRATION_DATE> | Alerts to mail from a newly registered domain. Formatted as yyyy-MM-dd HH:mm:ss ZZZ. |
| NEW_DOMAIN_LINK=<REGISTRATION_DATE> | Alerts to mail with links pointing out to a newly registered domain. Formatted as yyyy-MM-dd HH:mm:ss ZZZ. |
| ENCRYPTED | Email message is encrypted. |
| EXECUTABLE | Email message contains an executable file. |
| BEC | Indicates that an email address was contained in your impersonation registry list. Associated with MALICIOUS or SPOOF dispositions. |

### Header structure

When Email Security adds a disposition header to an email message, that header matches the following format:

```
X-CFEmailSecurity-Attribute: [Value]X-CFEmailSecurity-Attribute: [Value2]
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## API and Terraform

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/](https://developers.cloudflare.com/cloudflare-one/api-terraform/)

Page options # API and Terraform

This section covers a few common use cases with the API and Terraform to manage Cloudflare Zero Trust. For more information, refer to our API documentation and Terraform reference guide ‚Üó.

- Access API examples
- Terraform

## Set dashboard to read-only

Super Administrators can lock all settings as read-only in Zero Trust. Read-only mode ensures that all updates for the account are made through the API or Terraform.

To enable read-only mode:

1. In Zero Trust ‚Üó, go to Settings > Account.
2. Enable API/Terraform read-only mode.

All users, regardless of user permissions, will be prevented from making configuration changes through the UI.

## Scoped API tokens

The administrators managing policies and groups in Cloudflare Zero Trust might be different from those responsible for configuring WAF custom rules or other Cloudflare settings. You can configure scoped API tokens so that team members and automated systems can manage Zero Trust settings without having permission to modify other configurations in Cloudflare.

You can create a scoped API token via the dashboard or via the API. For a list of available token permissions, refer to API token permissions.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Access API examples

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/)

Page options # Access API examples

You can use the Cloudflare Access API to create policies, including individual rule blocks inside of group or policy bodies. For example, this policy allows all Cloudflare email account users to reach the application with the exception of one account:

```
{  "name": "allow cloudflare employees",  "decision": "allow",  "include": [    {      "email_domain": {        "domain": "cloudflare.com"      }    }  ],  "exclude": [    {      "email": {        "email": "notthisperson@cloudflare.com"      }    }  ],  "require": []}
```

## Example rule configurations

Rule group

Use a pre-existing rule group. Any valid service token

The request will need to present the headers for any service token created for this account. Authentication method

Allow access based on the "amr" identifier. Common name

The request will need to present a valid certificate with an expected common name. Country Code

Allow a specific country. Email domain

Allow an entire email domain. Email

Allow a specific email address. Microsoft Entra Group

Allow members of a Microsoft Entra group. The ID is the group UUID (`id`) in Microsoft Entra ID. Everyone

Allow anyone to log in. GitHub‚Ñ¢ Organization

Allow members of a specific GitHub organization. G Suite Group

Allow members of a specific G Suite group. IP range

Allow an IP range. mTLS certificate

The request will need to present a valid certificate. Okta Group

Allow members of an Okta Group. SAML Attribute

Allow users with specific SAML attributes. Service token

The request will need to present the correct service token headers. ## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Any valid service token

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/any-service-token/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/any-service-token/)

Page options # Any valid service token

The request will need to present the headers for any service token created for this account.

The request will need to present the headers for any service token created for this account

```
{  "any_valid_service_token": {}}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Authentication method

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/authentication-method/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/authentication-method/)

Page options # Authentication method

Allow access based on the "amr" identifier.

```
{  "auth_method": {    "auth_method": "hwk"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Common name

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/common-name/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/common-name/)

Page options # Common name

The request will need to present a valid certificate with an expected common name.

```
{  "common_name": {    "common_name": "james@example.com"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Country Code

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/country-code/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/country-code/)

Page options # Country Code

Allow a specific country.

```
{  "geo": {    "country_code": "US"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Email

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/email/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/email/)

Page options # Email

Allow a specific email address.

```
{  "email": {    "email": "james@example.com"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Email domain

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/email-domain/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/email-domain/)

Page options # Email domain

Allow an entire email domain.

```
{  "email_domain": {    "domain": "cloudflare.com"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Everyone

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/everyone/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/everyone/)

Page options # Everyone

Allow anyone to log in.

```
{  "everyone": {}}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## G Suite Group

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/gsuite-group/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/gsuite-group/)

Page options # G Suite Group

Allow members of a specific G Suite group.

```
{  "gsuite": {    "email": "admins@mycompanygsuite.com",    "identity_provider_id": "ca298b82-93b5-41bf-bc2d-10493f09b761"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## GitHub‚Ñ¢ Organization

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/github-org/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/github-org/)

Page options # GitHub‚Ñ¢ Organization

Allow members of a specific GitHub organization.

```
{  "github-organization": {    "name": "cloudflare",    "identity_provider_id": "ca298b82-93b5-41bf-bc2d-10493f09b761"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## IP range

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/ip-range/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/ip-range/)

Page options # IP range

Allow an IP range.

```
{  "ip": {    "ip": "127.0.0.1/32"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Microsoft Entra Group

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/entra-group/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/entra-group/)

Page options # Microsoft Entra Group

Allow members of a Microsoft Entra group. The ID is the group UUID (id) in Microsoft Entra ID.

Allow members of a Microsoft Entra group. The ID is the group UUID (id) in Microsoft Entra ID:

```
{  "azureAD": {    "id": "86773093-5feb-48dd-814b-7ccd3676ff50",    "identity_provider_id": "ca298b82-93b5-41bf-bc2d-10493f09b761"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## mTLS certificate

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/mtls-certificate/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/mtls-certificate/)

Page options # mTLS certificate

The request will need to present a valid certificate.

```
{  "certificate": {}}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Okta Group

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/okta-group/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/okta-group/)

Page options # Okta Group

Allow members of an Okta Group.

```
{  "okta": {    "name": "admins",    "identity_provider_id": "ca298b82-93b5-41bf-bc2d-10493f09b761"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Rule group

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/access-group/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/access-group/)

Page options # Rule group

Use a pre-existing rule group.

```
{  "group": {    "id": "aa0a4aab-672b-4bdb-bc33-a59f1130a11f"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## SAML Attribute

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/saml-attribute/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/saml-attribute/)

Page options # SAML Attribute

Allow users with specific SAML attributes.

```
{  "saml": {    "attribute_name": "group",    "attribute_value": "admins",    "identity_provider_id": "ca298b82-93b5-41bf-bc2d-10493f09b761"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Service token

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/service-token/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-api-examples/service-token/)

Page options # Service token

The request will need to present the correct service token headers.

```
{  "service_token": {    "token_id": "e9808c3a-705c-4afc-a507-6e4b083ff399"  }}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Terraform

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/api-terraform/access-with-terraform/](https://developers.cloudflare.com/cloudflare-one/api-terraform/access-with-terraform/)

Page options # Terraform

| Requirements |
| --- |
| Terraform ‚Üó installed on your machine |
| The Cloudflare provider ‚Üó properly configured |

Terraform ‚Üó is a tool for building, changing, and versioning infrastructure, and provides components and documentation for building Cloudflare resources ‚Üó. Listed below are examples to help you get started with building Access with Terraform. For a more generalized guide on configuring Cloudflare and Terraform, visit our Getting Started with Terraform and Cloudflare ‚Üó blog post.

## Create an application with Terraform

1. Create an application.
Here is an example configuration:
variable "domain" {  default = "example.com"}
variable "zone_id" {  default = <CLOUDFLARE_ZONE_ID>}
resource "cloudflare_access_application" "cf_app" {  zone_id          = var.zone_id  name             = "My Example App"  domain           = var.domain  session_duration = "24h"}
2. Next, we need to export our environment variables and secrets:
Terminal windowexport CLOUDFLARE_EMAIL=<CLOUDFLARE_EMAIL>export CLOUDFLARE_API_KEY=<CLOUDFLARE_API_KEY>
3. Now we can run a terraform plan which will output any proposed changes. Make sure to review the plan carefully:
Terminal windowterraform plan
Refreshing Terraform state in-memory prior to plan...The refreshed state will be used to calculate this plan, but will not bepersisted to local or remote state storage.
------------------------------------------------------------------------
An execution plan has been generated and is shown below.Resource actions are indicated with the following symbols:  + create
Terraform will perform the following actions:
  # cloudflare_access_application.cf_app will be created  + resource "cloudflare_access_application" "cf_app" {      + aud              = (known after apply)      + domain           = "example.com"      + id               = (known after apply)      + name             = "My Example App"      + session_duration = "24h"      + zone_id          = "1ce82492016e71df631bf4af9c02587f"    }
Plan: 1 to add, 0 to change, 0 to destroy.
------------------------------------------------------------------------
Note: You didn't specify an "-out" parameter to save this plan, so Terraformcan't guarantee that exactly these actions will be performed if"terraform apply" is subsequently run.
4. Apply these changes using the apply command, once they look accurate and you're comfortable moving forward:
Terminal windowterraform apply --auto-approve
cloudflare_access_application.cf_app: Creating...cloudflare_access_application.cf_app: Creation complete after 2s [id=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx]
Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

## Create a policy

After you've created an application, you can start creating policies and attaching them to applications:

```
resource "cloudflare_access_policy" "cf_policy" {     application_id = cloudflare_access_application.cf_app.id     zone_id        = var.zone_id     name           = "Example Policy"     precedence     = "1"     decision       = "allow"
     include {       email = ["test@example.com"]     }   }
```

To do so:

1. Run a terraform plan:
Terminal windowterraform plan
Refreshing Terraform state in-memory prior to plan...The refreshed state will be used to calculate this plan, but will not bepersisted to local or remote state storage.
cloudflare_access_application.cf_app: Refreshing state... [id=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx]
------------------------------------------------------------------------
An execution plan has been generated and is shown below.Resource actions are indicated with the following symbols: + create
Terraform will perform the following actions:
 # cloudflare_access_policy.cf_policy will be created + resource "cloudflare_access_policy" "cf_policy" {     + application_id = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"     + decision       = "allow"     + id             = (known after apply)     + name           = "My Example Policy"     + precedence     = 1     + zone_id        = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
     + include {         + email = [             + "test@example.com",           ]       }   }
Plan: 1 to add, 0 to change, 0 to destroy.
------------------------------------------------------------------------
Note: You didn't specify an "-out" parameter to save this plan, so Terraformcan't guarantee that exactly these actions will be performed if"terraform apply" is subsequently run.
2. Next, apply these changes using the apply command, once they look accurate and you're comfortable moving forward:
Terminal windowterraform apply --auto-approve

### Configuring an identity provider

The example below shows how you can configure an identity provider and attach it to a policy:

```
resource "cloudflare_access_identity_provider" "github_oauth" {  account_id = <CLOUDFLARE_ACCOUNT_ID>  name       = "GitHub OAuth"  type       = "github"  config {    client_id     = <GITHUB_CLIENT_ID>    client_secret = <GITHUB_CLIENT_SECRET>  }}
resource "cloudflare_access_policy" "cf_policy" {  application_id = cloudflare_access_application.cf_app.id  zone_id        = var.zone_id  name           = "My Example Policy"  precedence     = "1"  decision       = "allow"
  include {    email = ["test@example.com"]    github {      name                 = "My GitHub Org"      identity_provider_id = cloudflare_access_identity_provider.github_oauth.id    }  }}
```

These are the basics to get up and running with Access and Terraform. Refer to our API documentation for other endpoints that can be managed via Terraform.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tutorials

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/](https://developers.cloudflare.com/cloudflare-one/tutorials/)

Page options # Tutorials

| Name | Last Updated | Type | Difficulty |
| Create and secure an AI agent wrapper using AI Gateway and Zero Trust | 4 months ago | üìù Tutorial |  |
| Use Cloudflare Tunnels with Kubernetes client-go plugin | 11 months ago | üìù Tutorial |  |
| Send SSO attributes to Access-protected origins with Workers | 11 months ago | üìù Tutorial | Advanced |
| Use virtual networks to change user egress IPs | over 1 year ago | üìù Tutorial | Intermediate |
| Access and secure a MySQL database using Cloudflare Tunnel and network policies | over 1 year ago | üìù Tutorial |  |
| Access a web application via its private hostname without WARP | over 1 year ago | üìù Tutorial |  |
| Use Microsoft Entra ID Conditional Access policies in Cloudflare Access | over 1 year ago | üìù Tutorial |  |
| Protect access to Microsoft 365 with dedicated egress IPs | over 1 year ago | üìù Tutorial | Intermediate |
| Monitor Cloudflare Tunnel with Grafana | almost 2 years ago | üìù Tutorial |  |
| Use Cloudflare R2 as a Zero Trust log destination | almost 2 years ago | üìù Tutorial | Beginner |
| Create custom headers for Cloudflare Access-protected origins with Workers | almost 2 years ago | üìù Tutorial | Intermediate |
| Protect access to Amazon S3 buckets with Cloudflare Zero Trust | almost 2 years ago | üìù Tutorial | Advanced |
| Validate the Access token with FastAPI | about 2 years ago | üìù Tutorial |  |
| Isolate risky Entra ID users | over 2 years ago | üìù Tutorial | Advanced |
| Connect through Cloudflare Access using kubectl | about 3 years ago | üìù Tutorial |  |
| Render a VNC client in browser | about 3 years ago | üìù Tutorial | Advanced |
| Integrate Microsoft MCAS with Cloudflare Zero Trust | about 4 years ago | üìù Tutorial |  |
| Connect through Cloudflare Access using a CLI | over 4 years ago | üìù Tutorial |  |
| Migrate to Named Tunnels with Load Balancer | over 4 years ago | üìù Tutorial |  |
| MongoDB SSH | over 4 years ago | üìù Tutorial | Advanced |
| Zero Trust GitLab SSH & HTTP | over 4 years ago | üìù Tutorial | Advanced |
| Require U2F with Okta | almost 5 years ago | üìù Tutorial | Medium |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Videos

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/video-tutorials/](https://developers.cloudflare.com/cloudflare-one/video-tutorials/)

Page options # Videos

Build and secure your SASE corporate network Dive into Cloudflare's Secure Access Service Edge (SASE) platform and learn how it's been designed to revolutionize the idea of the corporate network. Understand and troubleshoot Cloudflare WARP In this series, we cover the basics of Cloudflare WARP, share useful troubleshooting tips, and explain the warp-diag logs in detail. ## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Account limits

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/account-limits/](https://developers.cloudflare.com/cloudflare-one/account-limits/)

Page options # Account limits

This page lists the default account limits for rules, applications, fields, and other features. These limits may be increased on Enterprise accounts. To request a limit increase, contact your account team.

## Access

| Feature | Limit |
| --- | --- |
| Applications | 500 |
| Audit Logpush jobs | 5 |
| Email addresses per rule | 1,000 |
| Rule groups | 300 |
| Rules per rule group | 1,000 |
| IP addresses per rule | 1,000 |
| mTLS root certificates | 50 |
| Service tokens | 50 |
| Identity providers | 50 |
| Reusable policies | 500 |
| Rules per application | 1,000 |
| Domains per application | 5 |
| Infrastructure targets | 5,000 |
| MCP portals | 20 |
| MCP servers per portal | 10 |

## Gateway

| Feature | Limit |
| --- | --- |
| DNS policies per account | 500 |
| Network policies per account | 500 |
| HTTP policies per account | 500 |
| Egress policies per account | 500 |
| Resolver policies per account | 500 |
| DNS locations | 250 |
| Source IP CIDRs per DNS location | 1,500 |
| Concurrent streams for HTTP/2 connections | 256 |
| Proxy endpoints | 500 |
| Source IP CIDRs per proxy endpoint | 2,000 |
| Lists | 100 |
| Entries per list (Standard users) | 1,000 |
| Entries per list (Enterprise users) | 5,000 |
| List API requests per minute | 600 |
| DNS Logpush jobs | 5 |
| HTTP Logpush jobs | 5 |

## Data Loss Prevention (DLP)

| Feature | Limit |
| --- | --- |
| Custom entries | 25 |
| Exact Data Match cells per spreadsheet | 100,000 |
| Custom Wordlist keywords per spreadsheet | 200 |
| Custom Wordlist keywords per account | 1,000 |
| Dataset cells per account | 1,000,000 |

## Cloudflare Tunnel

| Feature | Limit |
| --- | --- |
| cloudflared tunnels per account | 1,000 |
| WARP Connectors per account | 10 |
| IP routes per account | 1,000 |
| Active cloudflared replicas per tunnel | 25 |

## Digital Experience Monitoring (DEX)

| Feature | Limit |
| --- | --- |
| DEX Tests per account | Zero Trust Free: 10  Zero Trust Standard: 30  Zero Trust Enterprise: 50 |
| Remote captures per day | Zero Trust Free: 100  Zero Trust Standard: 200  Zero Trust Enterprise: 800 |

## Certificates

| Feature | Limit |
| --- | --- |
| Active certificates | 10 |
| Certificates generated per day | 3 |
| Custom certificates | 5 |

## Maximum number of characters

| Feature | Character limit |
| --- | --- |
| Application name | 350 |
| Group name | 350 |
| mTLS certificates name | 350 |
| Service token name | 350 |
| IdP name | 350 |
| Target name | 255 |
| Application URL | 63 |
| Team domain | 63 |
| Gateway API policy expression | 140,000 |

## WARP

| Feature | Character limit |
| --- | --- |
| Device profile expression | 10,000 |
| Combined Split Tunnel and Local Domain Fallback entries per device profile | 1,000 |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Roles and permissions

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/roles-permissions/](https://developers.cloudflare.com/cloudflare-one/roles-permissions/)

Page options # Roles and permissions

When creating a Cloudflare Zero Trust account, you will be given the Super Administrator role. As a Super Administrator, you can invite members to join your Zero Trust account and assign them different roles. There is no limit to the number of members which can be added to a given account. Any members with the proper permissions will be able to make configuration changes while actively logged into Zero Trust (unless read-only mode is enabled).

To check the list of members in your account, or to manage roles and permissions, refer to our Account setup documentation.

## Zero Trust roles

Only Super Administrators will be able to assign or remove the following roles from users in their account. Scroll to the right to see a full list of permissions for each role.

|  | Access Read | Access Edit | Gateway Read | Gateway Edit | Gateway Report | DNS Location Read | DNS Location Edit | Billing Read | Billing Edit | DEX Read | DEX Edit |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Super Administrator | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| Cloudflare Zero Trust1 | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ |
| Cloudflare Access | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ | ‚ùå | ‚ùå | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Cloudflare Gateway | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| Cloudflare Zero Trust Read Only | ‚úÖ | ‚ùå | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ | ‚ùå | ‚úÖ | ‚ùå |
| Cloudflare Zero Trust Reporting | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ | ‚ùå | ‚ùå | ‚úÖ | ‚ùå | ‚úÖ | ‚ùå |
| Cloudflare Zero Trust DNS Locations Write2 | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| Cloudflare DEX | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |

### Cloudflare Zero Trust PII

By default, only Super Administrators can view end users' PII in the Gateway activity logs, such as Device IDs, Source IPs, or user emails. No other roles will have the ability to read PII unless Super Administrators explicitly assign the Cloudflare Zero Trust PII role to them.

The Cloudflare Zero Trust PII role should be considered an add-on role, to be combined with any role from the table above. For example, Super Administrators may decide to assign the Cloudflare Gateway role to a user, and add the Cloudflare Zero Trust PII role to allow that user to access PII in the Gateway logs.

Note

The Cloudflare Zero Trust PII role does not apply to Access audit logs. PII is always visible in Access logs.

## Email Security roles

For more information on Email Security roles, refer to Account-scoped roles.

- Cloudflare Zero Trust: Can edit Cloudflare Zero Trust. Grants administrator access to all Zero Trust products including Access, Gateway, WARP, Tunnel, Browser Isolation, CASB, DLP, DEX, and Email Security.
- Cloudflare Zero Trust PII: Can read PII in Zero Trust. This includes Email Security.
- Email Security Analyst and Email Security Configuration Admin: Has full access to all admin features in Email Security.
- Email Security Integration Admin: Can read and set up integrations only.
- Email Security Configuration Admin: Has administrator access. Cannot take actions on emails, or read emails.
- Email Security Analyst: Has analyst access. Can take action on emails and read emails.
- Email Security Reporting: Can read metrics.
- Email Security Read Only: Can read all information, but cannot take action on anything.
- Email Security Policy Admin: Can read all settings, but only write allow policies, trusted domains, and blocked senders.

## Footnotes

1. The Cloudflare Zero Trust role grants administrator access to all Zero Trust products including Access, Gateway, WARP, Tunnel, Browser Isolation, CASB, DLP, DEX, and Email Security. ‚Ü©
2. Users with the Cloudflare Zero Trust DNS Locations Write role can view all DNS locations for an organization but can only create and edit secure DNS locations. ‚Ü©

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Glossary

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/glossary/](https://developers.cloudflare.com/cloudflare-one/glossary/)

Page options # Glossary

Review definitions for Cloudflare Zero Trust terms.

| Term | Definition |
| --- | --- |
| App Launcher | The App Launcher portal provides end users with a single dashboard to open applications secured by Cloudflare Zero Trust. |
| application | The resource protected by Cloudflare Zero Trust, which can be a subdomain, a path, or a SaaS application. |
| application token | A piece of data that grants a user access to a specific Access application for a period of time. Can be stored in a browser cookie or passed to the application in place of a normal password. |
| captive portal | A login screen shown to users when they connect to a public Wi-Fi. Captive portals typically occur in places such as airports, cafes, and hotels. |
| CGNAT IP | A unique, virtual IP address assigned to each WARP device from the 100.96.0.0/12 range. You can view the CGNAT IP for a device in My Team > Devices > Virtual IPv4/IPv6. |
| Cloudflare Access | Cloudflare Access replaces corporate VPNs with Cloudflare's network. It verifies attributes such as identity and device posture to grant users secure access to internal tools. |
| Cloudflare Browser Isolation | Cloudflare Browser Isolation seamlessly executes active webpage content in a secure isolated browser to protect users from zero-day attacks, malware, and phishing. |
| Cloudflare CASB | Cloudflare CASB provides comprehensive visibility and control over SaaS apps to prevent data leaks and compliance violations. It helps detect insider threats, shadow IT, risky data sharing, and bad actors. |
| Cloudflare Data Loss Prevention (DLP) | Cloudflare Data Loss Prevention (DLP) allows you to scan your web traffic and SaaS applications for the presence of sensitive data such as social security numbers, financial information, secret keys, and source code. |
| Cloudflare DEX | Cloudflare Digital Experience Monitoring (DEX) provides visibility into device, network, and application performance across your Zero Trust organization. |
| Cloudflare Gateway | Cloudflare Gateway is a modern next-generation firewall between your user, device, or network and the public Internet. It includes DNS filtering to inspect and apply policies to all Internet-bound DNS queries. |
| Cloudflare One | The name for Cloudflare's Secure Access Service Edge (SASE) platform, which includes Zero Trust and network services. |
| Cloudflare One Agent | The name of the Cloudflare WARP client app on iOS and Android devices. |
| Cloudflare Tunnel | Cloudflare Tunnel uses software agents (cloudflared or WARP Connector) to establish a secure connection between a private network and Cloudflare. |
| Cloudflare Zero Trust | Cloudflare Zero Trust provides the power of Cloudflare's global network to your internal teams and infrastructure. It empowers users with secure, fast, and seamless access to any device on the Internet. |
| cloudflared | The software powering Cloudflare Tunnel. It runs on origin servers to connect applications or private networks to Cloudflare. |
| cloudflared replica | An additional instance of cloudflared that points to the same Cloudflare Tunnel. It ensures that your network remains online in case a single host running cloudflared goes down. |
| daemon | A program that performs tasks without active management or maintenance. |
| device posture | A way to evaluate the security of a user's device, for example by verifying its serial number or checking if it has the latest software updates. |
| device profile | A collection of WARP client settings applied to a specific set of devices in your organization. |
| DNS filtering | DNS filtering uses the Domain Name System to block malicious websites and filter out harmful content, enhancing security and access control. |

View more terms ## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## FAQ

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/faq/](https://developers.cloudflare.com/cloudflare-one/faq/)

Page options # FAQ

Review answers to the most commonly asked questions on Cloudflare Zero Trust, as well as a troubleshooting section to help you solve common issues and errors you may come across.

If you cannot find the answer you are looking for, go to our community page ‚Üó and post your question there.

## Getting started with Cloudflare Zero Trust

For extra guidance on experiencing Cloudflare Zero Trust for the first time.

Getting started ‚ùØ

## General

For general questions on Cloudflare Zero Trust and how it works.

General ‚ùØ

## Identity

For questions on identity providers and accessing applications behind Cloudflare Zero Trust.

Identity ‚ùØ

## Policies

For questions on how policies work, and how to create and test them.

Policies ‚ùØ

## Devices

For questions on device connectivity and the WARP client.

Devices ‚ùØ

## Tunnels

For questions on connecting applications with Tunnels.

Tunnels ‚ùØ

## Troubleshooting

Got an unexpected error? Check if it is covered in our troubleshooting section.

Troubleshooting ‚ùØ

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Device UUID

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/device-uuid](https://developers.cloudflare.com/cloudflare-one/identity/devices/warp-client-checks/device-uuid)

Page options # Device UUID

Cloudflare Zero Trust allows you to build Zero Trust rules based on device UUIDs supplied in an MDM file. You can create these rules so that access to applications is granted only to users connecting from company devices.

## Prerequisites

- Cloudflare WARP client is deployed on the device. For a list of supported modes and operating systems, refer to WARP Client Checks.

## 1. Assign UUIDs to devices

You will need to use a managed deployment tool to assign UUIDs. It is not possible to assign them manually.

1. Generate a unique identifier for each corporate device. For best practices on choosing UUIDs, refer to the Android documentation ‚Üó.
2. Enter the UUIDs into your MDM configuration file using the unique_client_id key.

## 2. Create a list of UUIDs

To create rules based on device UUIDs, you first need to create a Gateway List of UUIDs.

1. In Zero Trust ‚Üó, go to My Team > Lists.
2. Select Create manual list or Upload CSV. For larger teams, we recommend uploading a CSV or using Cloudflare's API endpoint.
3. Give your list a descriptive name, as this name will appear when configuring your policies.
4. Set List Type to Device IDs.
5. Enter the UUIDs of the devices your team manages, or upload your CSV file.
6. Select Save.

Note

Hyphens are automatically stripped from UUIDs. For example, the posture check will match 123e4567-e89b-12d3-a456-426614174000 to 123e4567e89b12d3a456426614174000.

## 3. Enable the posture check

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Scroll down to WARP client checks and select Add new.
3. Select Unique Client ID.
4. You will be prompted for the following information:

Name: Enter a unique name for this device posture check.
Operating system: Select the operating system of the device.
List: Select your list of UUIDs.
5. Name: Enter a unique name for this device posture check.
6. Operating system: Select the operating system of the device.
7. List: Select your list of UUIDs.
8. Select Save.
9. Verify that the posture check is returning the expected results.

You can now create an Access or Gateway device posture policy that checks if the device presents a UUID on your list.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Use Microsoft Entra ID Conditional Access policies in Cloudflare Access

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/entra-id-conditional-access/](https://developers.cloudflare.com/cloudflare-one/tutorials/entra-id-conditional-access/)

Page options # Use Microsoft Entra ID Conditional Access policies in Cloudflare Access

Last reviewed: over 1 year ago With Conditional Access ‚Üó in Microsoft Entra ID (formerly Azure Active Directory), administrators can enforce policies on applications and users directly in Entra ID. Conditional Access has a set of checks that are specialized to Windows and are often preferred by organizations with Windows power users.

## Before you begin

Make sure you have:

- Global admin rights to Microsoft Entra ID account
- Configured users in the Microsoft Entra ID account

## Set up an identity provider for your application

Refer to our IdP setup instructions for Entra ID.

## Add API permission in Entra ID

Once the base IdP integration is tested and working, grant permission for Cloudflare to read Conditional Access policies from Entra ID.

1. In Microsoft Entra ID, go to App registrations.
2. Select the application you created for the IdP integration.
3. Go to API permissions and select Add a permission.
4. Select Microsoft Graph.
5. Select Application permissions and add Policy.Read.ConditionalAccess.
NoteYou must select Application permissions; delegated permissions will not work for this feature.
6. Select Grant admin consent.

## Configure Conditional Access in Entra ID

1. In Microsoft Entra ID, go to Enterprise applications > Conditional Access.
2. Go to Authentication Contexts.
3. Create an authentication context ‚Üó to reference in your Cloudflare Access policies. Give the authentication context a descriptive name (for example, Require compliant devices).
4. Next, go to Policies.
5. Create a new Conditional Access policy ‚Üó or select an existing policy.
6. Assign the conditional access policy to an authentication context:

In the policy builder, select Target resources.
In the Select what this policy applies to dropdown, select Authentication context.
Select the authentication context that will use this policy.
Save the policy.
7. In the policy builder, select Target resources.
8. In the Select what this policy applies to dropdown, select Authentication context.
9. Select the authentication context that will use this policy.
10. Save the policy.

## Sync Conditional Access with Zero Trust

To import your Conditional Access policies into Cloudflare Access:

1. In Zero Trust ‚Üó, go to Settings > Authentication.
2. Find your Microsoft Entra ID integration and select Edit.
3. Enable Azure AD Policy Sync.
4. Select Save.

## Create an Access application

To enforce your Conditional Access policies on a Cloudflare Access application:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Select Self-hosted.
4. Enter any name for the application.
5. Select Add public hostname and enter the target URL of the protected application.
6. Select Create new policy and build an Access policy using the Azure AD - Auth context selector. For example:























ActionRule typeSelectorValueAllowIncludeEmails ending in@example.comRequireAzure AD - Auth contextRequire compliant devices
7. Add this policy to your application configuration.
8. For Identity providers, select your Microsoft Entra ID integration.
9. Follow the remaining self-hosted application creation steps to publish the application.

Users will only be allowed access if they pass the Microsoft Entra ID Conditional Access policies associated with this authentication context.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Seat management

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/users/seat-management](https://developers.cloudflare.com/cloudflare-one/identity/users/seat-management)

Page options # Seat management

Cloudflare Zero Trust subscriptions consist of seats that active users in your account consume. Active users are added to Zero Trust through any authentication event.

The amount of seats available in your Zero Trust account depends on the amount of users you purchase. If you want to increase the number of seats available, you will have to purchase more users. Learn more about adding and removing seats from your account in the Zero Trust FAQ.

## Authentication events

A user consumes a seat when they perform an authentication event. For Access, this is any Cloudflare Access authentication event, such as a login to the App Launcher or an application. For Gateway, this is when any devices associated with the user connect to Zero Trust within the specified period.

If either one of these events occurs, that user's identity is added as an Active user to Zero Trust and consumes one seat from your plan. The user will occupy and consume a single seat regardless of the number of applications accessed or login events from their user account. Once the total amount of seats in the subscription has been consumed, additional users who attempt to log in are blocked.

A user who authenticates will hold their seat until you remove the user from your account. By default, inactive users will not be automatically removed from your account. You can remove a single user or all users at any time, and those users will immediately stop counting against the seat count defined in your subscription.

If you notice a number of accounts greater than the number of your users, you may need to configure an Access bypass policy. Alternatively, you can use Access service tokens to allow access to applications without consuming seats.

## Manage users

### Check number of seats used

To check the number of seats consumed by active users in your organization, log in to Zero Trust ‚Üó. Zero Trust overview will display the amount of seats consumed and the remaining amount available. For more details on your users, go to My team > Users.

### Revoke a user

When you revoke a user, this action will terminate active sessions, but will not remove the user's consumption of an active seat.

To revoke a user from your Zero Trust organization:

1. In Zero Trust ‚Üó, go to My team > Users.
2. Select the checkbox next to a user with an Active status in the Seat usage column.
3. Select Action > Revoke.
4. Select Revoke sessions.

Revoked users can still log in if your policies allow them.

### Remove a user

Removing a user from your Zero Trust organization will free up the seat the user consumed. The user will still appear in your list of users.

To remove a user from your Zero Trust organization:

1. In Zero Trust ‚Üó, go to My team > Users.
2. Select the checkbox next to a user with an Active status in the Seat usage column.
3. Select Action > Remove users.
4. Select Remove.

The user will now show as Inactive and will no longer occupy a seat. If a user is removed but authenticates later, they will consume a seat again.

To automate the removal of users who have not logged in or triggered a device enrollment in a specific amount of time, turn on seat expiration.

User record persistence

You cannot delete or archive a user record. You can remove a user from a seat, but their user record will remain in your Zero Trust organization. Inactive users do not count towards billing.

### Enable seat expiration

Cloudflare Zero Trust can automatically remove any user who does not log in to an Access application or whose device does not show any Gateway activity for the specified period (between one month and one year). To determine if a user will be removed, Cloudflare looks for any authentication events and checks the Last seen value for all of the user's devices. If both of those are outside the expiration window, the user will be removed and will no longer count against your number of seats. This process occurs once daily for an account.

To enable user seat expiration:

1. In Zero Trust ‚Üó, go to Settings > Account.
2. In Seat Expiration, select Edit.
3. Select an inactivity time from the dropdown menu.
4. Select Save.

If a user is removed but authenticates later, they will consume a seat again.

For more information about removing a user for Access and Gateway, refer to the FAQ.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Validate JWTs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/authorization-cookie/validating-json](https://developers.cloudflare.com/cloudflare-one/identity/authorization-cookie/validating-json)

Page options # Validate JWTs

When Cloudflare sends a request to your origin, the request will include an application token as a Cf-Access-Jwt-Assertion request header. Requests made through a browser will also pass the token as a CF_Authorization cookie.

Cloudflare signs the token with a key pair unique to your account. You should validate the token with your public key to ensure that the request came from Access and not a malicious third party. We recommend validating the Cf-Access-Jwt-Assertion header instead of the CF_Authorization cookie, since the cookie is not guaranteed to be passed.

## Access signing keys

The public key for the signing key pair is located at https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/certs, where <your-team-name> is your Zero Trust team name.

By default, Access rotates the signing key every 6 weeks. This means you will need to programmatically or manually update your keys as they rotate. Previous keys remain valid for 7 days after rotation to allow time for you to make the update.

You can also manually rotate the key using the API. This can be done for testing or security purposes.

As shown in the example below, https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/certs contains two public keys: the current key used to sign all new tokens, and the previous key that has been rotated out.

- keys: both keys in JWK format
- public_cert: current key in PEM format
- public_certs: both keys in PEM format

```
{  "keys": [    {      "kid": "1a1c3986a44ce6390be42ec772b031df8f433fdc71716db821dc0c39af3bce49",      "kty": "RSA",      "alg": "RS256",      "use": "sig",      "e": "AQAB",      "n": "5PKw-...-AG7MyQ"    },    {      "kid": "6c3bffef71bb0a90c9cbef3b7c0d4a1c7b4b8b76b80292a623afd9dac45d1c65",      "kty": "RSA",      "alg": "RS256",      "use": "sig",      "e": "AQAB",      "n": "pwVn...AA6Hw"    }  ],  "public_cert": {    "kid": "6c3bffef71bb0a90c9cbef3b7c0d4a1c7b4b8b76b80292a623afd9dac45d1c65",    "cert": "-----BEGIN CERTIFICATE----- ... -----END CERTIFICATE----- "  },  "public_certs": [    {      "kid": "1a1c3986a44ce6390be42ec772b031df8f433fdc71716db821dc0c39af3bce49",      "cert": "-----BEGIN CERTIFICATE----- ... -----END CERTIFICATE----- "    },    {      "kid": "6c3bffef71bb0a90c9cbef3b7c0d4a1c7b4b8b76b80292a623afd9dac45d1c65",      "cert": "-----BEGIN CERTIFICATE----- ... -----END CERTIFICATE----- "    }  ]}
```

Avoid key rotation issues

- Validate tokens using the external endpoint rather than saving the public key as a hard-coded value.
- Do not fetch the current key from public_cert, since your origin may inadvertently read an expired value from an outdated cache. Instead, match the kid value in the JWT to the corresponding certificate in public_certs.

## Verify the JWT manually

To verify the token manually:

1. Copy the JWT from the Cf-Access-Jwt-Assertion request header.
2. Go to jwt.io ‚Üó.
3. Select the RS256 algorithm.
4. Paste the JWT into the Encoded box.
5. In the Payload box, ensure that the iss field points to your team domain (https://<your-team-name>.cloudflareaccess.com). jwt.io uses the iss value to fetch the public key for token validation.
6. Ensure that the page says Signature Verified.

You can now trust that this request was sent by Access.

## Programmatic verification

You can run an automated script on your origin server to validate incoming requests. The provided sample code gets the application token from a request and checks its signature against your public key. You will need to insert your own team domain and Application Audience (AUD) tag into the sample code.

### Get your AUD tag

Cloudflare Access assigns a unique AUD tag to each application. The aud claim in the token payload specifies which application the JWT is valid for.

To get the AUD tag:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Configure for your application.
3. From the Basic information tab, copy the Application Audience (AUD) Tag.

You can now paste the AUD tag into your token validation script. The AUD tag will never change unless you delete or recreate the Access application.

### Golang example

```
package main
import (    "context"    "fmt"    "net/http"
    "github.com/coreos/go-oidc/v3/oidc")
var (    ctx        = context.TODO()    teamDomain = "https://test.cloudflareaccess.com"    certsURL   = fmt.Sprintf("%s/cdn-cgi/access/certs", teamDomain)
    // The Application Audience (AUD) tag for your application    policyAUD = "4714c1358e65fe4b408ad6d432a5f878f08194bdb4752441fd56faefa9b2b6f2"
    config = &oidc.Config{        ClientID: policyAUD,    }    keySet   = oidc.NewRemoteKeySet(ctx, certsURL)    verifier = oidc.NewVerifier(teamDomain, keySet, config))
// VerifyToken is a middleware to verify a CF Access tokenfunc VerifyToken(next http.Handler) http.Handler {    fn := func(w http.ResponseWriter, r *http.Request) {        headers := r.Header
        // Make sure that the incoming request has our token header        //  Could also look in the cookies for CF_AUTHORIZATION        accessJWT := headers.Get("Cf-Access-Jwt-Assertion")        if accessJWT == "" {            w.WriteHeader(http.StatusUnauthorized)            w.Write([]byte("No token on the request"))            return        }
        // Verify the access token        ctx := r.Context()        _, err := verifier.Verify(ctx, accessJWT)        if err != nil {            w.WriteHeader(http.StatusUnauthorized)            w.Write([]byte(fmt.Sprintf("Invalid token: %s", err.Error())))            return        }        next.ServeHTTP(w, r)    }    return http.HandlerFunc(fn)}
func MainHandler() http.Handler {    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {        w.Write([]byte("welcome"))    })}
func main() {    http.Handle("/", VerifyToken(MainHandler()))    http.ListenAndServe(":3000", nil)}
```

### Python example

pip install the following:

- flask
- requests
- PyJWT
- cryptography

```
from flask import Flask, requestimport requestsimport jwtimport jsonimport osapp = Flask(__name__)

# The Application Audience (AUD) tag for your applicationPOLICY_AUD = os.getenv("POLICY_AUD")
# Your CF Access team domainTEAM_DOMAIN = os.getenv("TEAM_DOMAIN")CERTS_URL = "{}/cdn-cgi/access/certs".format(TEAM_DOMAIN)
def _get_public_keys():    """    Returns:        List of RSA public keys usable by PyJWT.    """    r = requests.get(CERTS_URL)    public_keys = []    jwk_set = r.json()    for key_dict in jwk_set['keys']:        public_key = jwt.algorithms.RSAAlgorithm.from_jwk(json.dumps(key_dict))        public_keys.append(public_key)    return public_keys
def verify_token(f):    """    Decorator that wraps a Flask API call to verify the CF Access JWT    """    def wrapper():        token = ''        if 'CF_Authorization' in request.cookies:            token = request.cookies['CF_Authorization']        else:            return "missing required cf authorization token", 403        keys = _get_public_keys()
        # Loop through the keys since we can't pass the key set to the decoder        valid_token = False        for key in keys:            try:                # decode returns the claims that has the email when needed                jwt.decode(token, key=key, audience=POLICY_AUD, algorithms=['RS256'])                valid_token = True                break            except:                pass        if not valid_token:            return "invalid token", 403
        return f()    return wrapper

@app.route('/')@verify_tokendef hello_world():    return 'Hello, World!'

if __name__ == '__main__':    app.run()
```

### JavaScript example

```
const express = require("express");const jose = require("jose");
// The Application Audience (AUD) tag for your applicationconst AUD = process.env.POLICY_AUD;
// Your CF Access team domainconst TEAM_DOMAIN = process.env.TEAM_DOMAIN;const CERTS_URL = `${TEAM_DOMAIN}/cdn-cgi/access/certs`;
const JWKS = jose.createRemoteJWKSet(new URL(CERTS_URL));
// verifyToken is a middleware to verify a CF authorization tokenconst verifyToken = async (req, res, next) => {  const token = req.headers["cf-access-jwt-assertion"];
  // Make sure that the incoming request has our token header  if (!token) {    return res.status(403).send({      status: false,      message: "missing required cf authorization token",    });  }
  const result = await jose.jwtVerify(token, JWKS, {    issuer: TEAM_DOMAIN,    audience: AUD,  });
  req.user = result.payload;  next();};
const app = express();
app.use(verifyToken);
app.get("/", (req, res) => {  res.send("Hello World!");});
app.listen(3333);
```

## Related resources

- Verifying JWTs in Cloudflare Workers ‚Üó - Implement JWT verification in Cloudflare Workers.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Configure a tunnel

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/](https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/configure-tunnels/)

Page options # Configure a tunnel

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Tunnels FAQ

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/faq/cloudflare-tunnels-faq/](https://developers.cloudflare.com/cloudflare-one/faq/cloudflare-tunnels-faq/)

Page options # Tunnels FAQ

‚ùÆ Back to FAQ

## ‚ÄãCan I create a Tunnel for an apex domain?

Yes. With Named Tunnels ‚Üó you can create a CNAME at the apex that points to the named tunnel.

## ‚ÄãDoes Cloudflare Tunnel support Websockets?

Yes. Cloudflare Tunnel has full support for Websockets.

## ‚ÄãDoes Cloudflare Tunnel support gRPC?

Yes.

Cloudflare Tunnel supports gRPC traffic via private subnet routing. Public hostname deployments are not currently supported.

## How can Tunnel be used with Partial DNS (CNAME Setup)?

Cloudflare offers two modes of setup: Full Setup, in which the domain uses Cloudflare DNS nameservers, and Partial Setup (also known as CNAME setup) in which the domain uses non-Cloudflare DNS servers.

The best experience with Cloudflare Tunnel is using Full Setup because Cloudflare manages DNS for the domain and can automatically configure DNS records for newly started Tunnels.

You can still use Tunnel with Partial Setup. You will need to create a new DNS record with your current DNS provider for each new hostname connected through Cloudflare Tunnel. The DNS record should be of type CNAME or ALIAS if it is on the root of the domain. The name of the record should be the subdomain it corresponds to (e.g. example.com or tunnel.example.com) and the value of the record should be subdomain.domain.tld.cdn.cloudflare.net. (e.g. example.com.cdn.cloudflare.net or tunnel.example.com.cdn.cloudflare.net)

## How can origin servers be secured when using Tunnel?

Tunnel can expose web applications to the Internet that sit behind a NAT or firewall. Thus, you can keep your web server otherwise completely locked down. To double check that your origin web server is not responding to requests outside Cloudflare while Tunnel is running you can run netcat in the command line:

Terminal window ```
netcat -zv [your-server's-ip-address] 80netcat -zv [your-server's-ip-address] 443
```

If your server is still responding on those ports, you will see:

```
[ip-address] 80 (http) open
```

If your server is correctly locked down, you will see:

```
[ip-address] 443 (https): Connection refused
```

## What records are created for routing to a Named Tunnel's hostname?

Named Tunnels can be routed via DNS records, in which case we use CNAME records to point to the <UUID>.cfargotunnel.com; Or as Load Balancing endpoints, which also point to <UUID>.cfargotunnel.com.

## Does Cloudflare Tunnel send visitor IPs to my origin?

No. When using Cloudflare Tunnel, all requests to the origin are made internally between cloudflared and the origin.

To log external visitor IPs, you will need to configure an alternative method.

## Why does the name 'warp' and 'argo' appear in some legacy materials?

Cloudflare Tunnel was previously named Warp during the beta phase. As Warp was added to the Argo product family, we changed the name to Argo Tunnel to match. Once we no longer required users to purchase Argo to create Tunnels, we renamed Argo Tunnel to Cloudflare Tunnel.

For more information about migrating from Argo Tunnel, refer to Migrate legacy tunnels.

## Is it possible to restore a deleted tunnel?

No. You cannot undo a tunnel deletion. If the tunnel was locally-managed, its config.yaml file will still be present and you can create a new tunnel with the same configuration. If the tunnel was remotely-managed, both the tunnel and its configuration are permanently deleted.

## How do I contact support?

Before contacting the Cloudflare support team:

1. Take note of any specific error messages and/or problematic behaviors.
2. Make sure that cloudflared is updated to the latest version ‚Üó.
3. Gather any relevant error/access logs from your server.
4. (Locally-managed tunnels only) Set --loglevel to debug, so the Cloudflare support team can get more info from the cloudflared.log file.
5. Include your Cloudflare Tunnel diagnostic logs (cloudflared-diag-YYYY-MM-DDThh-mm-ss.zip).

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect through Cloudflare Access using kubectl

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/kubectl/](https://developers.cloudflare.com/cloudflare-one/tutorials/kubectl/)

Page options # Connect through Cloudflare Access using kubectl

Last reviewed: about 3 years ago You can connect to machines over kubectl using Cloudflare's Zero Trust platform.

This walkthrough covers how to:

- Build a policy in Cloudflare Access to secure the machine
- Connect a machine to Cloudflare's network using kubectl
- Connect from a client machine

Before you start

- Add a website to Cloudflare

Time to complete:

30 minutes

## Create a Zero Trust policy

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Select Self-hosted.
4. Enter a name for your Access application.
5. Select Add public hostname and input a subdomain. This will be the hostname where your application will be available to users.
6. Create a new policy to control who can reach the application, or select existing policies.
7. Follow the remaining self-hosted application creation steps to publish the application.

## Install cloudflared

Cloudflare Tunnel creates a secure, outbound-only connection between this machine and Cloudflare's network. With an outbound-only model, you can prevent any direct access to this machine and lock down any externally exposed points of ingress. And with that, no open firewall ports.

Cloudflare Tunnel is made possible through a lightweight daemon from Cloudflare called cloudflared. Download and install cloudflared on the DigitalOcean machine by following the instructions listed on the Downloads page.

## Authenticate cloudflared

Run the following command to authenticate cloudflared into your Cloudflare account.

Terminal window ```
cloudflared tunnel login
```

cloudflared will open a browser window and prompt you to log in to your Cloudflare account. If you are working on a machine that does not have a browser, or a browser window does not launch, you can copy the URL from the command-line output and visit the URL in a browser on any machine.

Choose any hostname presented in the list. Cloudflare will issue a certificate scoped to your account. You do not need to pick the specific hostname where you will serve the Tunnel.

## Create a Tunnel

Next, create a tunnel with the command below.

Terminal window ```
cloudflared tunnel create <NAME>
```

Replacing <NAME> with a name for the Tunnel. This name can be any value. A single Tunnel can also serve traffic for multiple hostnames to multiple services in your environment, including a mix of connection types like SSH and HTTP.

The command will output an ID for the Tunnel and generate an associated credentials file. At any time you can list the Tunnels in your account with the following command.

Terminal window ```
cloudflared tunnel list
```

## Configure the Tunnel

You can now configure the tunnel to serve traffic.

Create a YAML file that cloudflared can reach. By default, cloudflared will look for the file in the same folder where cloudflared has been installed.

Terminal window ```
vim ~/.cloudflared/config.yml
```

Next, configure the Tunnel, replacing the example ID below with the ID of the Tunnel created above. Additionally, replace the hostname in this example with the hostname of the application configured with Cloudflare Access.

```
tunnel: 6ff42ae2-765d-4adf-8112-31c55c1551efcredentials-file: /root/.cloudflared/6ff42ae2-765d-4adf-8112-31c55c1551ef.json
ingress:  - hostname: azure.widgetcorp.tech    service: tcp://kubernetes.docker.internal:6443    originRequest:      proxyType: socks  - service: http_status:404  # Catch-all rule, which responds with 404 if traffic doesn't match any of  # the earlier rules
```

## Route to the Tunnel

You can now create a DNS record that will route traffic to this Tunnel. Multiple DNS records can point to a single Tunnel and will send traffic to the configured service as long as the hostname is defined with an ingress rule.

1. Log in to the Cloudflare dashboard ‚Üó and select your account. Select your domain and go to DNS > Records.
2. Select Add record. Choose CNAME as the record type. For Name, choose the hostname where you want to create a Tunnel. This should match the hostname of the Access policy.
3. For Target, input the ID of your Tunnel followed by .cfargotunnel.com. For example:

```
6ff42ae2-765d-4adf-8112-31c55c1551ef.cfargotunnel.com
```

1. Select Save.

## Run the Tunnel

You can now run the Tunnel to connect the target service to Cloudflare. Use the following command to run the Tunnel, replacing <NAME> with the name created for your Tunnel.

Terminal window ```
cloudflared tunnel run <NAME>
```

We recommend that you run cloudflared as a service that is configured to launch on start.

## Connect from a client machine

You can now connect from a client machine using cloudflared.

This example uses a macOS laptop. On macOS, you can install cloudflared with the following command using Homebrew.

Terminal window ```
brew install cloudflared
```

Run the following command to create a connection from the device to Cloudflare. Any available port can be specified.

Terminal window ```
cloudflared access tcp --hostname azure.widgetcorp.tech --url 127.0.0.1:1234
```

With this service running, you can run a kubectl command and cloudflared will launch a browser window and prompt the user to authenticate with your SSO provider. Once authenticated, cloudflared will expose the connection to the client machine at the local URL specified in the command.

kubeconfig does not support proxy command configurations at this time, though the community has submitted plans to do so. In the interim, users can alias the cluster's API server to save time.

Terminal window ```
alias kubeone="env HTTPS_PROXY=socks5://127.0.0.1:1234 kubectl"
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Monitor Cloudflare Tunnel with Grafana

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/grafana/](https://developers.cloudflare.com/cloudflare-one/tutorials/grafana/)

Page options # Monitor Cloudflare Tunnel with Grafana

Last reviewed: almost 2 years ago Grafana ‚Üó is a dashboard tool that visualizes data stored in other databases. You can use Grafana to convert your tunnel metrics into actionable insights.

It is not possible to push metrics directly from cloudflared to Grafana. Instead, cloudflared runs a Prometheus ‚Üó metrics endpoint, which a Prometheus server periodically scrapes. Grafana then uses Prometheus as a data source to present metrics to the administrator.

```
flowchart LR

  subgraph 192.168.1.1
  A[cloudflared]-->B[Metrics endpoint]
  end

  B--->C
  subgraph 192.168.1.2
  C[Prometheus server]-->D[Grafana dashboard]
  end
```

This tutorial covers how to create the metrics endpoint, set up the Prometheus server, and view the data in Grafana.

## Before you begin

- You will need a Cloudflare Tunnel. To create a tunnel, refer to our getting started guide.

## Create the metrics endpoint

If your tunnel was created via the CLI, run the following command on the cloudflared server (192.168.1.1):

Terminal window ```
cloudflared tunnel --metrics 192.168.1.1:60123 run my-tunnel
```

If your tunnel was created via the dashboard, the --metrics flag must be added to your cloudflared system service configuration. Refer to Add tunnel run parameters for instructions on how to do this.

## Set up Prometheus

On the Prometheus and Grafana server (192.168.1.2):

1. Download ‚Üó Prometheus.
2. Extract Prometheus:
Terminal windowtar xvfz prometheus-*.tar.gzcd prometheus-*
3. Open prometheus.yml in a text editor and add the cloudflared job to the end of the file:
# my global configglobal:  scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.  # scrape_timeout is set to the global default (10s).
# Alertmanager configurationalerting:  alertmanagers:    - static_configs:        - targets:          # - alertmanager:9093
# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.rule_files:  # - "first_rules.yml"  # - "second_rules.yml"
# A scrape configuration containing exactly one endpoint to scrape:# Here it's Prometheus itself.scrape_configs:  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.  - job_name: "prometheus"
    # metrics_path defaults to '/metrics'    # scheme defaults to 'http'.
    static_configs:      - targets: ["localhost:9090"] ## Address of Prometheus dashboard
  - job_name: "cloudflared"    static_configs:      - targets: ["198.168.1.1:60123"] ## cloudflared server IP and the --metrics port configured for the tunnel
4. Start Prometheus:
Terminal window./prometheus --config.file="prometheus.yml"
You can optionally configure Prometheus to run as a service so that it does not need to be manually started if the machine reboots.
5. Open a browser and go to http://localhost:9090/. You should be able to access the Prometheus dashboard.
6. To verify that Prometheus is fetching tunnel metrics, enter cloudflared_tunnel_total_requests into the expression console and select Execute.

Refer to Available metrics to check what other metrics are available.

## Connect Grafana to Prometheus

1. Download ‚Üó and install Grafana.
2. Start Grafana as a system service:
Terminal windowsudo systemctl daemon-reloadsudo systemctl start grafana-server
3. Verify that Grafana is running:
Terminal windowsudo systemctl status grafana-server
4. Open a browser and go to http://localhost:3000/. The default HTTP port that Grafana listens to is 3000 unless you have configured a different port.
5. On the sign-in page, enter your Grafana credentials.
To test without an account, you can enter admin for both the username and password and skip the password change step.
6. In Grafana, go to Connections > Data sources.
7. Select Add a new data source and select Prometheus.
8. In the Prometheus server URL field, enter the IP address and port of your Prometheus dashboard (http://localhost:9090).
9. Select Save & test.

## Build Grafana dashboard

1. In Grafana, go to Dashboards > New > New dashboard.
2. Select Add visualization.
3. Select Prometheus.
4. In the metrics field, enter cloudflared_tunnel_total_requests and select Run queries. You will see a graph showing the number of requests as a function of time.

You can add operations to the queries to modify what is displayed. For example, you could show all tunnel requests over a recent period of time, such as a day, rather than all tunnel requests since metrics began reporting.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Troubleshooting

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/faq/troubleshooting/](https://developers.cloudflare.com/cloudflare-one/faq/troubleshooting/)

Page options # Troubleshooting

‚ùÆ Back to FAQ

## I tried to register the WARP client with my Zero Trust domain but received the following error messages: Authentication Expired and Registration error. Please try again later.

When a user logs into an organization, WARP will open a web page so the user can sign in via Cloudflare Access. Access then generates a JSON Web Token (JWT) that is passed from the web page to the WARP client to authenticate the device. This JWT has a timestamp indicating the exact time it was created, as well as a timestamp indicating it will expire 50 seconds into the future.

This error message means that when the JWT is finally passed to the WARP client, it has already expired. One of two things can be happening:

1. (Most likely): Your computer system clock is not properly synced using Network Time Protocol (NTP). Visit https://time.is ‚Üó on the affected machine to validate your clock is properly synchronized within 20 seconds of the actual time.
2. You are waiting more than one minute to open Cloudflare WARP from the time Cloudflare Access prompts you. Open the WARP client as soon as you get the prompt.

## I see a website is blocked, and it shouldn't be.

If you believe a domain has been incorrectly blocked, you can use this form ‚Üó to get the URL reviewed.

## I see an error saying No Access-Control-Allow-Origin header is present on the requested resource.

Cloudflare Access requires that the credentials: same-origin parameter be added to JavaScript when using the Fetch API (to include cookies). AJAX requests fail without this parameter present. For more information, refer to our documentation about CORS settings.

## I see untrusted certificate warnings for every page and I am unable to browse the Internet.

Advanced security features including HTTPS traffic inspection require users to install and trust the Cloudflare root certificate on their machine or device. If you are installing certificates manually on all of your devices, these steps will need to be performed on each new device that is to be subject to HTTP Filtering.
To install the Cloudflare root certificate, follow this guide.

## I see error 526 when browsing to a website.

Gateway presents an HTTP Response Code: 526 error page in the following cases:

- An untrusted certificate is presented from the origin to Gateway. Gateway will consider a certificate is untrusted if any of these conditions are true:

The server certificate issuer is unknown or is not trusted by the service.
The server certificate is revoked and fails a CRL check.
There is at least one expired certificate in the certificate chain for the server certificate.
The common name on the certificate does not match the URL you are trying to reach.
The common name on the certificate contains invalid characters (such as underscores). Gateway uses BoringSSL ‚Üó to validate certificates. Chrome's validation logic ‚Üó allows non-RFC 1305 compliant certificates, which is why the website may load when you turn off WARP.
- The server certificate issuer is unknown or is not trusted by the service.
- The server certificate is revoked and fails a CRL check.
- There is at least one expired certificate in the certificate chain for the server certificate.
- The common name on the certificate does not match the URL you are trying to reach.
- The common name on the certificate contains invalid characters (such as underscores). Gateway uses BoringSSL ‚Üó to validate certificates. Chrome's validation logic ‚Üó allows non-RFC 1305 compliant certificates, which is why the website may load when you turn off WARP.
- The connection from Gateway to the origin is insecure. Gateway does not trust origins which:

Only offer insecure cipher suites (such as RC4, RC4-MD5, or 3DES). You can use the SSL Server Test tool ‚Üó to check which ciphers are supported by the origin.
Do not support FIPS-compliant ciphers (if you have enabled FIPS compliance mode). In order to load the page, you can either disable FIPS mode or create a Do Not Inspect policy for this host (which has the effect of disabling FIPS compliance for this origin).
Redirect all HTTPS requests to HTTP.
- Only offer insecure cipher suites (such as RC4, RC4-MD5, or 3DES). You can use the SSL Server Test tool ‚Üó to check which ciphers are supported by the origin.
- Do not support FIPS-compliant ciphers (if you have enabled FIPS compliance mode). In order to load the page, you can either disable FIPS mode or create a Do Not Inspect policy for this host (which has the effect of disabling FIPS compliance for this origin).
- Redirect all HTTPS requests to HTTP.

If none of the above scenarios apply, contact Cloudflare support with the following information:

- Operating System (Windows 10, macOS 10.x, iOS 14.x)
- Web browser (Chrome, Firefox, Safari, Edge)
- URL of the request
- Screenshot or copy/paste of the content from the error page

For more troubleshooting information, refer to Support.

## I see an error in the Gateway Overview page, and no analytics are displayed.

You may not see analytics on the Overview page for the following reasons:

- You are not sending DNS queries to Gateway. Verify that the destination IP addresses you are sending DNS queries to are correct. You can check the destination IP addresses for your DNS location by going to Gateway > DNS locations and then expanding the location.
- You are using other DNS resolvers. If you have other DNS resolvers in your DNS settings, your device could be using IP addresses for resolvers that are not part of Gateway. Make sure to remove all other IP addresses from your DNS settings and only include Gateway's DNS resolver IP addresses.
- The source IPv4 address for your DNS location is incorrect. If you are using IPv4, check the source IPv4 address that you entered for the DNS location matches with the network's source IPv4 address.
- Analytics is not available yet. It takes some time to generate the analytics for Cloudflare Gateway. If you are not seeing anything even after 5 minutes, file a support ticket.

## I see a "No Browsers Available" alert.

If you encounter this error, file feedback via the WARP client and we will investigate.

## I see a "Maximum Sessions Reached" alert.

This can occur if your device is attempting to establish a connection to more than two remote browser instances.
A browser isolation session is a connection from your local browser to a remote browser. Tabs and windows within the same browser share a single remote browser session. In practice, this generally means that you can open both Chrome and Firefox to use browser isolation concurrently, but attempting to open a third browser such as Opera will cause this alert to appear. To release a browser session, close all tabs/windows in your local browser. The remote browser session will be automatically terminated within 15 minutes.

## I see SAML Verify: Invalid SAML response, SAML Verify: No certificate selected to verify when testing a SAML identity provider.

This error occurs when the identity provider has not included the signing public key in the SAML response. While not required by the SAML 2.0 specification, Cloudflare Access always checks that the public key provided matches the Signing certificate uploaded to Zero Trust. For the integration to work, you will need to configure your identity provider to add the public key.

## I see Error 0: Bad Request. Please create a ca for application. when attempting to connect to SSH with a short-lived certificate.

This error will appear if a certificate has not been generated for the Access application users are attempting to connect to. For more information on how to generate a certificate for the application on the Access Service Auth SSH page, refer to these instructions.

## Mobile applications warn of an invalid certificate, even though I installed a Cloudflare certificate on my system.

These mobile applications may use certificate pinning Cloudflare Gateway dynamically generates a certificate for all encrypted connections in order to inspect the content of HTTP traffic. This certificate will not match the expected certificate by applications that use certificate pinning.
To allow these applications to function normally, administrators can configure bypass rules to exempt traffic to hosts associated with the application from being intercepted and inspected.

## Firefox shows a network protocol violation when I use the WARP client.

If you see this warning, you may have to disable DNS over HTTPS setting in Firefox. If you need help doing that, see these instructions ‚Üó.

## Chrome shows NET::ERR_CERT_AUTHORITY_INVALID when I use the WARP client.

Advanced security features including HTTPS traffic inspection require you to deploy a root certificate on the device. If Install CA to system certificate store is enabled, the WARP client will automatically install a new root certificate whenever you install or update WARP.

Certain web browsers (such as Chrome and Microsoft Edge) load and cache root certificates when they start. Therefore, if you install a root certificate while the browser is already running, the browser may not detect the new certificate. To resolve the error, restart the browser.

## I see Access api error auth_domain_cannot_be_updated_dash_sso.

This error appears if you try to change your team domain while the Cloudflare dashboard SSO feature is enabled on your account.
Cloudflare dashboard SSO does not currently support team domain changes. Contact your account team for more details.

## WARP on Linux shows DNS connectivity check failed.

This error means that the systemd-resolved service on Linux is not allowing WARP to resolve DNS requests. You can identify this issue in the daemon.log file of the warp diag logs, where the error message appears as ERROR main_loop: warp::warp::connectivity_check: DNS connectivity check failed to resolve host="warp-svc.".

To solve the issue:

1. Add the following line to /etc/systemd/resolved.conf:

```
ResolveUnicastSingleLabel=yes
```

1. Make sure that no other DNS servers are configured in /etc/systemd/resolved.conf. For example, if the file contains DNS=X.Y.Z.Q, comment out the line.
2. Restart the service:

Terminal window ```
sudo systemctl restart systemd-resolved.service
```

## Windows incorrectly shows No Internet access when WARP is enabled.

NCSI ‚Üó is a Windows feature for determining network quality and connectivity. When WARP is enabled, NCSI checks can sometimes fail and cause a cosmetic UI error where the user believes they have no Internet even though the device still has full connectivity. Some apps (Outlook, JumpCloud) may refuse to connect because Windows is reporting there is no Internet connectivity.

To resolve the issue, you will need to edit two Windows registry keys:

1. Configure NCSI to detect WARP's local DNS proxy.
HKEY_LOCAL_MACHINE\SOFTWARE\POLICIES\MICROSOFT\Windows\NetworkConnectivityStatusIndicatorType: DWORDValue: UseGlobalDNSData: 1
2. Configure NCSI to use active probing mode, as WARP may be obscuring the number of hops expected by the passive probe ‚Üó.
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NlaSvc\Parameters\InternetType: DWORDValue: EnableActiveProbingData: 1

If you continue to have issues with Microsoft 365 applications, consider enabling Directly route Microsoft 365 traffic.

## I see WebGL Rendering Error.

Cloudflare Browser Isolation leverages Network Vector Rendering (NVR) technology. This allows us to deliver a secure, performant remote computing experience without the bandwidth limitations of traditional solutions. While we expect most websites to work perfectly, some browser features and web technologies such as WebGL (Web Graphics Library) are unsupported.

WebGL is a JavaScript API for rendering high-performance interactive 2D and 3D graphics within any compatible web browser without the use of plug-ins. Support for WebGL is present in all modern browsers. However, the user's device must also have access to the underlying hardware ‚Üó that supports these features.

When running remote browser isolation in a virtualized environment, the user's device may not have access to the required system resources. To resolve the error, you can configure your browser to render vector graphics entirely through software, without using the hardware acceleration provided by a GPU.

To enable software rasterization:

1. Go to chrome://flags/#override-software-rendering-list.
2. Set Override software rendering list to Enabled.
3. Select Relaunch to apply the change.

## I cannot send emails on port 25.

By default, the WARP client blocks outgoing SMTP traffic on port 25 to prevent users from abusing our service to send spam. Modern email service providers use port 587 or 465 to encrypt emails over a TLS/SSL connection. For more information, refer to What SMTP port should be used? ‚Üó.

If you need to unblock port 25, contact your account team.

## I see 502 Bad Gateway when browsing to a website.

This issue can occur when communicating with an origin that partially supports HTTP/2. In these scenarios, the connection from Gateway to the website starts using HTTP/2 but requests a downgrade to HTTP/1.1 for some requests. For example, servers such as Microsoft Internet Information Services (IIS) ‚Üó do not support authentication over HTTP/2. When errors occur, the website may send back a RST_STREAM frame with the error code HTTP_1_1_REQUIRED, which indicates that the browser should retry the request over HTTP/1.1. Gateway translates any received upstream RST_STREAM frames to a pseudo socket close, so this appears as a 502 Bad Gateway exception page. The browser will not indicate why it failed.

Gateway does not support this downgrade mechanism. When receiving the HTTP_1_1_REQUIRED error code, Gateway will not reissue requests over HTTP/1.1. To make the connection from Gateway to the website successfully, you will need to disable HTTP/2 at the origin.

## I see This site can't provide a secure connection.

If you see an error with the title This site can't provide a secure connection and a subtitle of <hostname> uses an unsupported protocol, you must order an Advanced Certificate.

If you added a multi-level subdomain (more than one level of subdomain), you must order an Advanced Certificate for the hostname as Cloudflare's Universal certificate will not cover the public hostname by default.

## As of February 2, 2025, my end-user device's browser is returning a Your connection is not private warning.

### Why am I getting this error?

The default global Cloudflare root certificate expired on 2025-02-02 at 16:05 UTC. If you installed the default Cloudflare certificate before 2024-10-17, you must generate a new certificate and activate it for your Zero Trust organization to avoid inspection errors. If you did not generate a new certificate before February 2, 2025, you will encounter browser warnings like Your connection is not private.

Starting with WARP client version 2024.12.554.0 and later, the WARP client will automatically install Cloudflare certificates in an end-user device's certificate store as soon as the Cloudflare certificates appear as Available in the Cloudflare dashboard.

For WARP client versions prior to 2024.12.554.0, certificates had to be marked as In-Use in the Cloudflare dashboard before the WARP client could push the Cloudflare certificates to an end-user device's certificate store.

### What do I need to do?

Before deploying a new certificate, update WARP to version 2024.12.554.0 or newer.

For WARP client versions before and after 2024.12.554.0, certificate propagation will only occur when the WARP client is responsible for automatically installing the certificate on the client device. To enable the WARP client to propogate certificates:

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. Turn on Install CA to system certificate store.

If Install CA to system certificate store is turned off, you must manually install the certificate, use an MDM solution to distribute the Cloudflare certificate to your fleet of devices, or not use the Cloudflare certificate because you do not want to have TLS decryption enabled. TLS decryption must be enabled to enforce Gateway HTTP policies for HTTPS traffic.

After enabling certificate propagation, you must update your certificate:

1. In Zero Trust ‚Üó, go to Settings > Resources, then select Manage next to Cloudflare certificates.
2. Select Generate certificate.
3. Select the expiration date for this new certificate (five years is the default, but this can be adjusted) and select Generate certificate.
4. The new certificate will be marked Inactive at first. Select the three dots to the right of the certificate, then select Activate to activate the certificate.

For WARP versions on or above 2024.12.554.0, selecting Activate will download the new certificate to end-user devices.

Certificate propagation to end-user devices can take up to 10 minutes, but can be expedited by resetting the encryption keys.

To reset the encryption keys:

1. Open the WARP GUI on your device.
2. Select the gear icon on the top right > Preferences.
3. Select Connection, then select Reset Encryption Keys.

macOS Big Sur and newer releases do not allow WARP to automatically trust the certificate. You must either manually trust the certificate as the user or use a MDM to trust the certificate.

After confirming that the certificate is installed and trusted on the end-user device, mark the certificate as In-Use. To mark the certificate as In-Use:

1. In Zero Trust ‚Üó, go to Settings > Resources, then select Manage next to Cloudflare certificates.
2. Select a certificate.
3. In the detailed menu under Basic Information, select Confirm and turn on certificate.
4. Once turned on, the new certificate will now show as In-Use in Zero Trust. In-Use indicates that the certificate is being used for inspection.

It is recommended to have end users disconnect and reconnect WARP to expedite this change being reflected on their local machine. To verify the new certificate is being used correctly:

1. Connect to WARP.
2. Visit an HTTPS site.
3. Verify that no certificate error is enountered.

Additionally, you can check the certificate used within your browser by viewing the certificate (steps vary by browser, but you can generally do this check by selecting the lock icon next to the URL) and verifying the Organizational Unit (OU) does not reference ECC Certificate Authority.

The new certificate will be valid until the configured expiration date.

### I followed all the instructions but I am still having problems with my certificate.

If the new certificate is not activating on the end-user device or you are getting a Certificate is missing warning even though the certificate is marked In-Use. Refer to the following troubleshooting options:

1. Rotate the keys used by WARP to force activate the new certificate by running:
Terminal windowwarp-cli tunnel rotate-keys
2. Upgrade to WARP version 2024.12.554.0.
Some customers who are on versions earlier than 2024.11.309.0 have experienced inconsistencies with certificate installation and may need to upgrade.
3. Turn off TLS Decryption.

If no measure is working quickly and you are encountering browser warnings that are blocking work, turning off TLS decryption will prevent HTTP policies from being enforced and will ensure websites resolve until the certificate can be deployed to more user devices.

Turning off TLS decryption should be a temporary measure. TLS decryption should be turned on if you need to enforce HTTP policies and log traffic for HTTPS traffic.

## I am getting an Error 401: deleted_client - The OAuth Client was deleted authorization error.

If you deleted the OAuth client (or the OAuth client expired) in Google, you will receive a Error 401: deleted_client authorization error.

To fix this issue, complete steps 6 through 12 in the Google guide and steps 9 through 15 in the Google Workspace guide.

## I entered an override code for WARP that was supposed to be valid for 3 hours but the override code expired faster than I expected.

Admin override codes are time-sensitive and adhere to fixed-hour time blocks. Override codes can be reused until the end of their timeout. An override code's timeout begins in the hour the override code was generated in. Refer to the following scenarios.

### Scenario one: Admin generates an override code at 9:00 AM with a timeout of one hour.

If admin generates an override code with a timeout of one hour at 9:00 AM and the user inputs the override code in their device at 9:59 AM, the user will be able to toggle WARP on and off until 10:59 AM (a one hour duration.)

However, if the user attempts to enter the override code at 10:00 AM, the override code will not work. The override code will not work because the override code was generated at 9:00 AM and its one hour validity was counted as used in the 9:00 AM to 10:00 AM hour.

### Scenario two: Admin generates an override code at 9:30 AM with timeout of three hours.

If admin generates an override code with a timeout of three hours at 9:30 AM and the user inputs the override code in their device at 9:59 AM, the user will be able to toggle WARP on and off until 12:59 PM (a three hour duration.)

However, if the user attempts to enter the override code at 10:00 AM, the override code will only be valid until 12:00 PM (a two hour duration). The override code was generated at 9:30 AM and one hour of its total three hour validity was counted as used in the 9:00 AM to 10:00 AM hour.

### Scenario three: Admin generates an override code at 12:30 PM with a timeout of 24 hours.

If admin generates an override code with a timeout of 24 hours at 12:30 PM and the user inputs the override code in their device at 12:59 PM the same day, the user will be able to toggle WARP on and off until 12:59 PM the next day (a 24 hour duration.)

However, if the user attempts to enter the override code at 1:00 PM the same day, the override code will only be valid until 11:00 AM the next day (a 23 hour duration). The override code was generated at 12:30 PM and one hour of its total 24 hour validity was counted as used in the 12:00 PM to 1:00 PM hour.

If the user attempts to enter the override code at 11:59 AM the next day, the override code will only be valid until 12:59 PM (a one hour duration). The override code was generated at 12:00 PM and 23 hours of its total 24 hour validity were counted as used from 12:00 PM to 11:00 AM the next day (a 23 hour duration).

## I disabled WARP using an override code but WARP turned on by itself before my override code expired.

If you are using an Admin override code with Auto connect also enabled, WARP will turn on automatically according to the Timeout set for Auto connect. Using an override code to override the WARP lock switch will not disable Auto connect. As best practice, review your Auto connect settings before sending the override code to the user.

To prevent WARP from auto connecting while using an admin override code, disable Auto connect or set a longer Timeout for Auto connect. Note the changes you make to Auto connect while the end user is using the admin override code if you need to revert these changes later.

## I am getting the error Failed to fetch user/group information from the identity provider.

This error is returned when proper API permissions are not set up in the identity provider. When Cloudflare attempts to fetch user/group information from the identity provider and proper API permissions have not been configured, the Failed to fetch user/group information from the identity provider error will appear. Review the SSO integration guide for your identity provider to ensure your application has the appropriate API permissions.

For example, Microsoft Entra and Okta have required permissions stated in their integration guides.

You can also examine logs in your identity provider to identify any denied requests related to API access.

## WSL2 is losing connectivity when using WARP.

If your WSL2 environment is losing connectivity while using WARP, check your split tunnel configuration.

The issue may arise because the IP range that the WSL environment uses to communicate with the host device is included in the split tunnel configuration. Excluding the WSL environment‚Äôs IP range should restore connectivity.

You must ensure the host device is included in the WARP tunnel while excluding the WSL environment to prevent connectivity issues between WSL and the host device.

To debug this issue:

1. Review the WSL2 environment's IP address and compare it with the laptop‚Äôs IP.
2. Check if the WSL network is included in the split tunnel configuration.
3. If the WSL network is included, exclude it from the split tunnel to prevent connectivity issues.

## Clientless Web Isolation is loading with a blank screen on a Windows device.

This issue can occur due to a conflict between browser settings and Windows network configuration.

In Chromium-based browsers like Chrome and Edge, the Anonymize local IPs exposed by WebRTC flag (chrome://flags/#enable-webrtc-hide-local-ips-with-mdns or edge://flags/#enable-webrtc-hide-local-ips-with-mdns) ‚Äî when set to Enabled or left at Default ‚Äî hides local IP addresses by replacing them with mDNS hostnames. Multicast DNS (mDNS) hostnames rely on multicast traffic to be resolved properly on the local network.

The Internet Group Management Protocol (IGMP) ‚Üó allows devices to join a multicasting group. On Windows, IGMPLevel determines whether the system participates in multicast group membership. When IGMPLevel is set to 0, multicast support is disabled.

To resolve this error, review the following options:

| IGMPLevel | Anonymize local IPs exposed by WebRTC setting | Result in Clientless Web Isolation |
| --- | --- | --- |
| 0 (disabled) | Enabled / Default | ‚ùå Blank screen |
| 0 (disabled) | Disabled | ‚úÖ Works - browser will use local IP address |
| 2 (enabled) | Enabled / Default | ‚úÖ Works - mDNS resolves successfully |

## After putting Google Workspace behind Access, I can‚Äôt log in. It keeps redirecting between Access and Google without ever completing authentication.

When you put your Google Workspace behind Access, users will not be able to log in using Google or Google Workspace as an identity provider.

This configuration creates an authentication loop. Cloudflare Access tries to authenticate the user via Google, but Google itself treats Cloudflare as its identity provider and requires authentication from Cloudflare. Since each system depends on the other to complete login first, the user is caught in an infinite redirect cycle and can never successfully authenticate.

## When installing WARP on Windows, the Setup Wizard ends prematurely.

This error can occur for several reasons, including missing dependencies, like the appropriate .NET Framework version or other Dynamic Link Libraries (DLLs) such as netstandard2.0, required during installation.

To investigate, run the following command to generate installation logs:

PowerShell ```
msiexec /i <PATH_TO_WARP_MSI> /L*V <PATH_TO_OUTPUT_LOG>
```

Check the logs to verify if there are any missing DLLs (for example, netstandard2.0), which may point to a missing or outdated version of the .NET Framework.

One common cause is a missing or outdated version of the .NET Framework Runtime. Cloudflare WARP requires a .NET Framework version of 4.7.2 or later.

Some legacy Windows systems (such as Windows 10 Enterprise 1607 LTSB, which is bundled with .NET 4.6) do not include this runtime by default and may fail during installation with a Setup Wizard ended prematurely error. More recent Windows versions include .NET 4.7.2 or later by default and do not encounter this error.

To fix this:

1. Download and install the .NET Framework 4.7.2 Runtime ‚Üó (make sure to install the Runtime, not the Developer Pack).
2. Re-run the WARP installer.

If the problem continues, try running the .NET Repair Tool ‚Üó, or check which .NET versions are installed by running the following command in PowerShell:

PowerShell ```
Get-ChildItem -Path "HKLM:\SOFTWARE\Microsoft\NET Framework Setup\NDP" -Recurse | ForEach-Object { $_.Name; Get-ItemProperty $_.PSPath; "" }
```

## I get an Invalid session. Please try logging in again. error from Access when trying to log in to the Cloudflare dashboard via SSO.

Cloudflare Access uses a CF_Session cookie to validate that the same browser both initiated and completed your sign-in. The Invalid session error means Access was unable to validate this cookie. Ensure that there is no software or firewall on your device or network that may be interfering with requests to Access.

## Long-lived SSH sessions frequently disconnect.

All connections proxied through Cloudflare Gateway, including traffic to Access for Infrastructure SSH targets, have a maximum guaranteed duration of 10 hours. It is possible for connections to last longer than 10 hours. However, if a connection is active at the time of a Gateway release, Gateway will terminate the connection 10 hours later. Releases are not scheduled and can occur multiple times a week.

To prevent long-lived SSH connections from breaking unexpectedly, we recommend terminating sessions on a predefined schedule. For example, you could set an 8-hour idle timeout so that inactive sessions automatically disconnect during off hours. To configure an idle timeout, add the ChannelTimeout option to either the SSH server (/etc/ssh/sshd_config) or client configuration file (~/.ssh/config):

```
ChannelTimeout global=8h
```

Implementing ChannelTimeout on the client side ‚Üó allows users to choose a time that works for them, whereas implementing it on the server side ‚Üó removes the configuration burden from the end user.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## WARP modes

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-modes](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/configure-warp/warp-modes)

Page options # WARP modes

You can deploy the WARP client in different modes to control the types of traffic sent to Cloudflare Gateway. The WARP mode determines which Zero Trust features are available on the device.

## Gateway with WARP (default)

This mode is best suited for organizations that want to use advanced firewall/proxy functionalities and enforce device posture rules.

| DNS filtering | Network filtering | HTTP filtering | Features enabled |
| --- | --- | --- | --- |
| Yes | Yes | Yes | DNS policies, network policies, HTTP policies, Browser Isolation, identity-based policies, device posture checks, AV scanning, and Data Loss Prevention |

## Gateway with DoH

Gateway with DNS-over-HTTPS (DoH) is best suited for organizations that only want to apply DNS filtering to outbound traffic from their company devices. Network and HTTP traffic is handled by the default mechanisms on your devices.

| DNS filtering | Network filtering | HTTP filtering | Features enabled |
| --- | --- | --- | --- |
| Yes | No | No | DNS policies |

## Secure Web Gateway without DNS filtering

Secure Web Gateway without DNS filtering mode (sometimes referred to as tunnel-only mode) is best suited for organizations that want to proxy network and HTTP traffic but keep their existing DNS filtering software. DNS traffic is handled by the default mechanism on your device.

| DNS filtering | Network filtering | HTTP filtering | Features enabled |
| --- | --- | --- | --- |
| No | Yes | Yes | Network policies, HTTP policies, Browser Isolation, identity-based policies, device posture checks, AV scanning, and Data Loss Prevention |

Note

- Secure Web Gateway without DNS filtering mode disables all features that rely on WARP for DNS resolution, including domain-based split tunneling and Local Domain Fallback.
- Only available on Windows, Linux, and macOS.
- Secure Web Gateway without DNS filtering mode has a known limitation concerning DNS servers with IPv6 addresses.

## Proxy mode

Proxy mode is best suited for organizations that want to filter traffic directed to specific applications.

| DNS filtering | Network filtering | HTTP filtering | Features enabled |
| --- | --- | --- | --- |
| No | No | Yes | HTTP policies, Browser Isolation, identity-based policies, AV scanning, and Data Loss Prevention for traffic sent through localhost proxy |

Note

- Proxy mode can only be used by applications/operating systems that support SOCKS5/HTTPS proxy communication.
- Only available on Windows, Linux, and macOS.
- Proxy mode has a timeout limit of 10 seconds for requests. If a request goes above the 10 second limit, Cloudflare will drop the connection.

## Device Information Only

This mode is best suited for organizations that only want to enforce WARP client device posture checks for zones in your account. DNS, Network and HTTP traffic is handled by the default mechanisms on your devices. To setup Device Information Only mode, refer to the dedicated page.

| DNS filtering | Network filtering | HTTP filtering | Features enabled |
| --- | --- | --- | --- |
| No | No | No | Device posture rules in Access policies |

## WARP modes comparison

Each WARP mode offers a different set of Zero Trust features.

| WARP Mode | DNS Filtering | Network Filtering | HTTP Filtering | Service mode (displayed in warp-cli settings) |
| --- | --- | --- | --- | --- |
| Gateway with WARP (default) | ‚úÖ | ‚úÖ | ‚úÖ | WarpWithDnsOverHttps |
| Gateway with DoH | ‚úÖ | ‚ùå | ‚ùå | DnsOverHttps |
| Secure Web Gateway without DNS filtering | ‚ùå | ‚úÖ | ‚úÖ | TunnelOnly |
| Proxy mode | ‚ùå | ‚ùå | ‚úÖ | WarpProxy on port 40000 |
| Device Information Only | ‚ùå | ‚ùå | ‚ùå | PostureOnly |

## Related resources

- Connectivity status - Learn about the status messages displayed by the WARP client during its connection process, and understand each stage as WARP establishes a secure tunnel to Cloudflare.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Êú™Áü•Ê®ôÈ°å

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/static/mdm/com.cloudflare.warp.plist](https://developers.cloudflare.com/cloudflare-one/static/mdm/com.cloudflare.warp.plist)

configs organization your-team-name display_name Company Name auto_connect 120 onboarding

---

## Êú™Áü•Ê®ôÈ°å

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/static/mdm/CloudflareWARP.mobileconfig](https://developers.cloudflare.com/cloudflare-one/static/mdm/CloudflareWARP.mobileconfig)

PayloadDisplayName Cloudflare WARP PayloadIdentifier cloudflare_warp PayloadOrganization Cloudflare, Ltd. PayloadRemovalDisallowed PayloadType Configuration PayloadScope System PayloadUUID F5046847-2B1C-4DA0-A872-F6E040B1B20E PayloadVersion 1 PayloadContent organization your-team-name auto_connect 120 onboarding PayloadDisplayName Warp Configuration PayloadIdentifier com.cloudflare.warp.5A31FA24-FF8C-41EA-989E-F070820F2A80 PayloadOrganization Cloudflare Ltd. PayloadType com.cloudflare.warp PayloadUUID 5A31FA24-FF8C-41EA-989E-F070820F2A80 PayloadVersion 1

---

## Êú™Áü•Ê®ôÈ°å

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/static/mdm/multiple-orgs/com.cloudflare.warp.plist](https://developers.cloudflare.com/cloudflare-one/static/mdm/multiple-orgs/com.cloudflare.warp.plist)

configs organization mycompany display_name Production environment organization mycompany override_api_endpoint 203.0.113.0 override_doh_endpoint 203.0.113.0 override_warp_endpoint 203.0.113.0:2408 display_name Cloudflare China network organization test-org display_name Test environment

---

## Êú™Áü•Ê®ôÈ°å

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/static/mdm/multiple-orgs/CloudflareWARP.mobileconfig](https://developers.cloudflare.com/cloudflare-one/static/mdm/multiple-orgs/CloudflareWARP.mobileconfig)

PayloadContent PayloadDisplayName Warp Configuration PayloadIdentifier com.cloudflare.warp.CB8B22D4-50E1-48E8-8874-A7594627013A PayloadOrganization Cloudflare Ltd. PayloadType com.cloudflare.warp PayloadUUID CB8B22D4-50E1-48E8-8874-A7594627013A PayloadVersion 1 configs organization mycompany display_name Production environment organization mycompany override_api_endpoint 203.0.113.0 override_doh_endpoint 203.0.113.0 override_warp_endpoint 203.0.113.0:2408 display_name Cloudflare China network organization test-org display_name Test environment PayloadDisplayName Cloudflare WARP PayloadIdentifier cloudflare_warp PayloadOrganization Cloudflare, Ltd. PayloadRemovalDisallowed PayloadScope System PayloadType Configuration PayloadUUID 2B7763B8-64F6-41EB-AA5E-7761651B8131 PayloadVersion 1

---

## WARP with firewall

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/firewall](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/firewall)

Page options # WARP with firewall

If your organization uses a firewall or other policies to restrict or intercept Internet traffic, you may need to exempt the following IP addresses and domains to allow the WARP client to connect.

## Client orchestration API

The WARP client connects to Cloudflare via a standard HTTPS connection outside the tunnel for operations like registration or settings changes. To perform these operations, you must allow zero-trust-client.cloudflareclient.com which will lookup the following IP addresses:

- IPv4 API Endpoints: 162.159.137.105 and 162.159.138.105
- IPv6 API Endpoints: 2606:4700:7::a29f:8969 and 2606:4700:7::a29f:8a69

If your firewall allows traffic only by domain, you may need to explicitly allow zero-trust-client.cloudflareclient.com. Even though zero-trust-client.cloudflareclient.com may resolve to different IP addresses, WARP overrides the resolved IPs with the IPs listed above. To avoid connectivity issues, ensure that the above IPs are permitted through your firewall.

## DoH IP

Note

Only required for Gateway with DoH mode.

In Gateway with DoH mode, the WARP client sends DNS requests to Gateway over an HTTPS connection. For DNS to work correctly, you must allow <ACCOUNT_ID>.cloudflare-gateway.com which will lookup the following IPs:

- IPv4 DoH Addresses: 162.159.36.1 and 162.159.46.1
- IPv6 DoH Addresses: 2606:4700:4700::1111 and 2606:4700:4700::1001

If your firewall allows traffic only by domain, you may need to explicitly allow <ACCOUNT_ID>.cloudflare-gateway.com. Even though <ACCOUNT_ID>.cloudflare-gateway.com may resolve to different IP addresses, WARP overrides the resolved IPs with the IPs listed above. To avoid connectivity issues, ensure that the above IPs are permitted through your firewall.

### Android devices

If you are deploying the Cloudflare One Agent on Android/ChromeOS, you must also add cloudflare-dns.com to your firewall exception list. On Android/ChromeOS devices, WARP uses cloudflare-dns.com to resolve domains on your Split Tunnel list.

## Client authentication endpoint

When you log in to your Zero Trust organization, you will have to complete the authentication steps required by your organization in the browser window that opens. To perform these operations, you must allow the following domains:

- The IdP used to authenticate to Cloudflare Zero Trust
- <your-team-name>.cloudflareaccess.com

## WARP ingress IP

WARP connects to the following IP addresses, depending on which tunnel protocol is configured for your device (WireGuard or MASQUE). All network traffic from your device to Cloudflare goes through these IPs and ports over UDP.

### WireGuard

|  |  |
| --- | --- |
| IPv4 address | 162.159.193.0/24 |
| IPv6 address | 2606:4700:100::/48 |
| Default port | UDP 2408 |
| Fallback ports | UDP 500  UDP 1701  UDP 4500 |

### MASQUE

|  |  |
| --- | --- |
| IPv4 address | 162.159.197.0/24 |
| IPv6 address | 2606:4700:102::/48 |
| Default port | UDP 443 |
| Fallback ports | UDP 500  UDP 1701  UDP 4500  UDP 4443  UDP 8443  UDP 8095  TCP 443 1 |

Note

Before you log in to your Zero Trust organization, you may see the IPv4 range 162.159.192.0/24. This IP is used for consumer WARP services (1.1.1.1 w/ WARP) and is not required for Zero Trust deployments.

## Captive portal

The following domains are used as part of our captive portal check:

- cloudflareportal.com
- cloudflareok.com
- cloudflarecp.com
- www.msftconnecttest.com
- captive.apple.com
- connectivitycheck.gstatic.com

## Connectivity checks

As part of establishing the WARP connection, the client runs connectivity checks inside and outside of the WARP tunnel.

### Outside tunnel

The client connects to the following destinations to verify general Internet connectivity outside of the WARP tunnel. Make sure that these IPs and domains are on your firewall allowlist.

- engage.cloudflareclient.com: The client will always send requests directly to an IP in the WARP ingress IPv4 or IPv6 range (or to your override_warp_endpoint if set). Requests will not use a proxy server, even if one is configured for the system.
- 162.159.197.3
- 2606:4700:102::3

If your firewall allows traffic only by domain, you may need to explicitly allow engage.cloudflareclient.com. Even though engage.cloudflareclient.com may resolve to different IP addresses, WARP overrides the resolved IPs with the IPs listed above. To avoid connectivity issues, ensure that the above IPs are permitted through your firewall.

### Inside tunnel

The WARP client connects to the following IPs to verify connectivity inside of the WARP tunnel:

- 162.159.197.4
- 2606:4700:102::4

Because this check happens inside of the tunnel, you do not need to add these IPs to your firewall allowlist. However, since the requests go through Gateway, ensure that they are not blocked by a Gateway HTTP or Network policy.

If your firewall allows traffic only by domain, you may need to explicitly allow connectivity.cloudflareclient.com. Even though connectivity.cloudflareclient.com may resolve to different IP addresses, WARP overrides the resolved IPs with the IPs listed above. To avoid connectivity issues, ensure that the above IPs are permitted through your firewall.

## NEL reporting (optional)

The WARP client reports connectivity issues to our NEL endpoint via a.nel.cloudflare.com. This is not technically required to operate but will result in errors in our logs if not excluded properly.

## Latency statistics (optional)

The WARP client generates ICMP traffic to the WARP ingress IPs when running tunnel latency tests. This is not technically required to operate but will result in errors in our logs if not excluded properly.

## Time synchronization (optional)

The WARP client attempts to synchronize the exact time by NTP (UDP 123) to Cloudflare's Time Service via time.cloudflare.com. This is not technically required to operate but will result in errors in our logs if not excluded properly.

## Scope of firewall rules

### Required scopes

If your organization does not currently allow inbound/outbound communication over the IP addresses, ports, and domains described above, you must manually add an exception. The rule at a minimum needs to be scoped to the following process based on your platform:

- Windows: C:\Program Files\Cloudflare\Cloudflare WARP\warp-svc.exe
- macOS: You must explicitly allow both the core networking daemon and GUI component as shown in the following instructions.


Core networking daemon: /Applications/Cloudflare WARP.app/Contents/Resources/CloudflareWARP
This binary does not have a Bundle ID and must be allowed via full path.


GUI component, choose one of the following three identifiers depending on your MDM or firewall vendor's preferred format:
/Applications/Cloudflare WARP.app (Path)
/Applications/Cloudflare WARP.app/Contents/MacOS/Cloudflare WARP (Path)
com.cloudflare.1dot1dot1dot1dot1.macos (Bundle ID)


WarningDue to changes in macOS Sequoia version 15.0 and 15.0.1., you must update your macOS firewall settings to allow the WARP client to manage your device's firewall.To ensure proper functionality, disable the Block all incoming connections ‚Üó option in your macOS firewall settings.
- Core networking daemon: /Applications/Cloudflare WARP.app/Contents/Resources/CloudflareWARP
This binary does not have a Bundle ID and must be allowed via full path.
- GUI component, choose one of the following three identifiers depending on your MDM or firewall vendor's preferred format:
/Applications/Cloudflare WARP.app (Path)
/Applications/Cloudflare WARP.app/Contents/MacOS/Cloudflare WARP (Path)
com.cloudflare.1dot1dot1dot1dot1.macos (Bundle ID)

### Optional scopes

#### DEX tests

To run Digital Experience Monitoring tests, you will need to allow the warp-dex process to generate network traffic to your target destinations:

- Windows: C:\Program Files\Cloudflare\Cloudflare WARP\warp-dex.exe
- macOS: /Applications/Cloudflare WARP.app/Contents/Resources/warp-dex

#### WARP network statistics

To use the network connectivity tests built into the WARP GUI, you will need to allow the GUI application to generate network traffic:

- Windows: C:\Program Files\Cloudflare\Cloudflare WARP\Cloudflare WARP.exe
- macOS: /Applications/Cloudflare WARP.app

## Related resources

- Local Domain Fallback - Resolve selected domains via local DNS instead of Cloudflare Gateway.
- Split Tunnels - Control which traffic goes through WARP by including or excluding specific IPs or domains.

## Footnotes

1. Required for HTTP/2 fallback ‚Ü©

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## DNS

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/dns/](https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/agentless/dns/)

Page options # DNS

- Locations
- DNS over TLS (DoT)
- DNS over HTTPS (DoH)

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Glossary

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/glossary/?term=ecs](https://developers.cloudflare.com/cloudflare-one/glossary/?term=ecs)

Page options # Glossary

Review definitions for Cloudflare Zero Trust terms.

| Term | Definition |
| --- | --- |
| App Launcher | The App Launcher portal provides end users with a single dashboard to open applications secured by Cloudflare Zero Trust. |
| application | The resource protected by Cloudflare Zero Trust, which can be a subdomain, a path, or a SaaS application. |
| application token | A piece of data that grants a user access to a specific Access application for a period of time. Can be stored in a browser cookie or passed to the application in place of a normal password. |
| captive portal | A login screen shown to users when they connect to a public Wi-Fi. Captive portals typically occur in places such as airports, cafes, and hotels. |
| CGNAT IP | A unique, virtual IP address assigned to each WARP device from the 100.96.0.0/12 range. You can view the CGNAT IP for a device in My Team > Devices > Virtual IPv4/IPv6. |
| Cloudflare Access | Cloudflare Access replaces corporate VPNs with Cloudflare's network. It verifies attributes such as identity and device posture to grant users secure access to internal tools. |
| Cloudflare Browser Isolation | Cloudflare Browser Isolation seamlessly executes active webpage content in a secure isolated browser to protect users from zero-day attacks, malware, and phishing. |
| Cloudflare CASB | Cloudflare CASB provides comprehensive visibility and control over SaaS apps to prevent data leaks and compliance violations. It helps detect insider threats, shadow IT, risky data sharing, and bad actors. |
| Cloudflare Data Loss Prevention (DLP) | Cloudflare Data Loss Prevention (DLP) allows you to scan your web traffic and SaaS applications for the presence of sensitive data such as social security numbers, financial information, secret keys, and source code. |
| Cloudflare DEX | Cloudflare Digital Experience Monitoring (DEX) provides visibility into device, network, and application performance across your Zero Trust organization. |
| Cloudflare Gateway | Cloudflare Gateway is a modern next-generation firewall between your user, device, or network and the public Internet. It includes DNS filtering to inspect and apply policies to all Internet-bound DNS queries. |
| Cloudflare One | The name for Cloudflare's Secure Access Service Edge (SASE) platform, which includes Zero Trust and network services. |
| Cloudflare One Agent | The name of the Cloudflare WARP client app on iOS and Android devices. |
| Cloudflare Tunnel | Cloudflare Tunnel uses software agents (cloudflared or WARP Connector) to establish a secure connection between a private network and Cloudflare. |
| Cloudflare Zero Trust | Cloudflare Zero Trust provides the power of Cloudflare's global network to your internal teams and infrastructure. It empowers users with secure, fast, and seamless access to any device on the Internet. |
| cloudflared | The software powering Cloudflare Tunnel. It runs on origin servers to connect applications or private networks to Cloudflare. |
| cloudflared replica | An additional instance of cloudflared that points to the same Cloudflare Tunnel. It ensures that your network remains online in case a single host running cloudflared goes down. |
| daemon | A program that performs tasks without active management or maintenance. |
| device posture | A way to evaluate the security of a user's device, for example by verifying its serial number or checking if it has the latest software updates. |
| device profile | A collection of WARP client settings applied to a specific set of devices in your organization. |
| DNS filtering | DNS filtering uses the Domain Name System to block malicious websites and filter out harmful content, enhancing security and access control. |

View more terms ## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Êú™Áü•Ê®ôÈ°å

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/static/authenticated-doh.py](https://developers.cloudflare.com/cloudflare-one/static/authenticated-doh.py)



---

## MCP servers

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/mcp-servers/](https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/mcp-servers/)

Page options # MCP servers

- MCP server portals
- Secure MCP servers with Access for SaaS
- Authenticate MCP server to self-hosted apps

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Connect through Cloudflare Access using a CLI

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/cli/](https://developers.cloudflare.com/cloudflare-one/tutorials/cli/)

Page options # Connect through Cloudflare Access using a CLI

Last reviewed: over 4 years ago Cloudflare's cloudflared command-line tool allows you to interact with endpoints protected by Cloudflare Access. You can use cloudflared to interact with a protected application's API.

These instructions are not meant for configuring a service to run against an API. The token in this example is tailored to user identity and intended only for an end user interacting with an API via a command-line tool.

This walkthrough covers how to:

- Connect to resources secured by Cloudflare Access from a CLI

Time to complete:

30 minutes

## Authenticate a session from the command line

Once you have installed cloudflared, you can use it to retrieve a Cloudflare Access application token. This walkthrough uses the domain example.com as a stand-in for a protected API.

1. To generate a token, run the following command:
Terminal windowcloudflared access login https://example.com
With this command, cloudflared launches a browser window containing the same Access login page found when attempting to access a web application.
2. Select your identity provider and log in.

If the browser window does not launch, you can use the unique URL that is automatically printed to the command line.

1. Once you have successfully authenticated, the browser returns the token to cloudflared in a cryptographic transfer and stores it.

The token is valid for the session duration configured by the Access administrator.

## Access your API

Once you have retrieved a token, you can access the protected API. The cloudflared command-line tool includes a wrapper for transferring data via curl, which uses URL syntax (for more, see the curl ‚Üó GitHub project). The wrapper injects the token into the curl request as a query argument named token. You can invoke the wrapper as follows:

Terminal window ```
cloudflared access curl http://example.com
```

It is possible also to use the put command with cloudflared for any Unix tool to include the token in the request.

Read on for other available commands.

## Available commands

### login

The login command initiates the login flow for an application behind Access.

Terminal window ```
cloudflared access login http://example.com
```

### curl

The curl command invokes the client wrapper and includes the token in the request automatically.

Terminal window ```
cloudflared access curl http://example.com
```

### token

The token command retrieves the token scoped to that specific application for use in other command-line tools.

Terminal window ```
cloudflared access token -app=http://example.com
```

## Using the token as an environment variable

It is possible to save the token as an environment variable for convenience and concision in scripts that access a protected application.

Set up a token as an environment variable as follows:

1. Run the following command to export the token to the shell environment:
Terminal windowexport TOKEN=$(cloudflared access token -app=http://example.com)
2. Confirm the token was saved with the following:
Terminal windowecho $TOKEN

Once you have exported the token to your environment, use the variable with the Cloudflare Access request header in the script to access a protected endpoint, as in the following example:

Terminal window ```
curl -H "cf-access-token: $TOKEN" https://example.com/rest/api/2/item/foo-123
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Google Cloud Platform (GCP) Cloud Storage

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/gcp-cloud-storage](https://developers.cloudflare.com/cloudflare-one/applications/casb/casb-integrations/gcp-cloud-storage)

Page options # Google Cloud Platform (GCP) Cloud Storage

The Google Cloud Platform (GCP) Cloud Storage integration detects a variety of data loss prevention, account misconfiguration, and user security risks in an integrated GCP account that could leave you and your organization vulnerable.

## Integration prerequisites

- A GCP account using Cloud Storage.
- For initial setup, access to the GCP account with permission to create a new Service Account with the scopes listed below.

## Integration permissions

For the GCP Cloud Storage integration to function, Cloudflare CASB requires the following access scopes via a Service Account:

- roles/viewer
- roles/storage.admin

These permissions follow the principle of least privilege to ensure that only the minimum required access is granted. To learn more about each permission scope, refer to the GCP IAM roles for Cloud Storage documentation ‚Üó.

## Compute account

You can connect a GCP compute account to your CASB integration to perform Data Loss Prevention scans within your Cloud Storage bucket and avoid data egress. CASB will scan any objects that exist in the bucket at the time of configuration.

### Add a compute account

To connect a compute account to your GCP integration:

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Find and select your GCP integration.
3. Select Open connection instructions.
4. Follow the instructions provided to connect a new compute account.
5. Select Refresh.

You can only connect one compute account to an integration. To remove a compute account, select Manage compute accounts.

### Configure compute account scanning

Once your GCP compute account has successfully connected to your CASB integration, you can configure where and how to scan for sensitive data:

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Find and select your GCP integration.
3. Select Create new configuration.
4. In Resources, choose the buckets you want to scan. Select Continue.
5. Choose the file types, sampling percentage, and DLP profiles to scan for.
6. (Optional) Configure additional settings, such as the limit of API calls over time for CASB to adhere to.
7. Select Continue.
8. Review the details of the scan, then select Start scan.

CASB will take up to one hour to begin scanning. To view the scan results, go to CASB > Content > Cloud.

To manage your resources, go to CASB > Integrations, then find and select your GCP integration. From here, you can pause all or individual scans, add or remove resources, and change scan settings.

For more information, refer to Content findings.

## Security findings

The GCP Cloud Storage integration currently scans for the following findings, or security risks. Findings are grouped by category and then ordered by severity level.

To stay up-to-date with new CASB findings as they are added, bookmark this page or subscribe to its RSS feed.

### Cloud Storage Bucket security

Flag security issues in Cloud Storage Buckets, including overpermissioning, access policies, and user security best practices.

| Finding type | FindingTypeID | Severity |
| --- | --- | --- |
| Google Cloud Platform: GCS Bucket Allows Public Write | 4583f5a9-a343-4e2f-a8b3-9237a911f337 | Critical |
| Google Cloud Platform: GCS Bucket IAM Policy Allows Public Access | 032c1e88-0cff-47f6-8d75-046e0a7330de | Critical |
| Google Cloud Platform: GCS Bucket Publicly Accessible | cc028a95-46d4-4156-ac11-bc5713529824 | Critical |
| Google Cloud Platform: Public Access Prevention Enabled But Policy Grants Public | cc02680e-9cc3-49d1-99d5-29d425bf142f | Critical |
| Google Cloud Platform: GCS Bucket ACL Grants All Authenticated Users Access | e1a588af-0500-482e-b59d-fd2693ce7fc0 | Critical |
| Google Cloud Platform: GCS Bucket ACL Grants All Users Public Access | 1904c004-8d4f-470e-9460-e77db23d6a86 | Critical |
| Google Cloud Platform: Public Access Prevention but ACL Grants allUsers | fcf2e27e-673f-4cd2-9b76-ec89c4c5872c | Critical |
| Google Cloud Platform: GCS Bucket Versioning Disabled | bd66e214-f205-4e00-bd68-121dad0a7988 | High |
| Google Cloud Platform: GCS Bucket Without KMS Encryption | 0105d9c4-1a01-4b65-b33e-df6c55905147 | High |
| Google Cloud Platform: GCS Uniform Bucket-Level Access Disabled | 6960b459-aa9e-4b41-84f6-26cdb75a1995 | High |
| Google Cloud Platform: GCS Bucket IAM Policy Allows Public Read | 10420f34-8fdd-49cb-8d38-096a2de5824f | High |
| Google Cloud Platform: GCS Bucket Lacks Lifecycle Rules | edcd5a8b-b128-404b-8207-23a80f669b65 | Medium |
| Google Cloud Platform: GCS Bucket Logging Disabled | d26f43c8-9406-481c-8c8b-1a7f05f3cc27 | Medium |
| Google Cloud Platform: GCS Bucket Not Using 'Soft Delete' | 5542ed8e-77a6-43c1-8b9e-935e66009d34 | Medium |
| Google Cloud Platform: GCS Bucket Retention Policy Disabled | 2d4a247c-8adb-4f2b-ae58-3568d633cb81 | Medium |
| Google Cloud Platform: GCS Bucket IAM Policy Not Version 3 | ade2ede6-08c7-4962-b084-f6a29ee4a5b8 | Low |
| Google Cloud Platform: GCS Bucket IAM Policy Using Legacy Roles | 11a592b9-4f51-4a1a-9925-a48a5ed01521 | Low |

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Troubleshoot integrations

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/applications/casb/troubleshooting/](https://developers.cloudflare.com/cloudflare-one/applications/casb/troubleshooting/)

Page options # Troubleshoot integrations

Cloudflare CASB detects when integrations are unhealthy or outdated.

Common integration issues include changes to SaaS app or cloud environment configurations, user access, or permission scope. Integrations may need to be updated to support new features or permissions.

## Identify unhealthy or outdated integrations

To identify unhealthy CASB integrations, go to CASB > Integrations. If an integration is unhealthy, CASB will set its status to Broken. If an integration is outdated, CASB will set its status to Upgrade.

## Repair an unhealthy integration

Repair limitation

If CASB does not support self-service repairs for an integration, you will need to delete and recreate the integration to continue scanning.

You can repair unhealthy CASB integrations through your list of integrations or findings.

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Choose your unhealthy integration.
3. Select Reauthorize.
4. In your SaaS app or cloud environment, reauthorize your account.

## Upgrade an integration

Upgrading an outdated integration will allow the integration to access new features and permissions.

1. In Zero Trust ‚Üó, go to CASB > Integrations.
2. Choose your outdated integration.
3. Select Upgrade integration.
4. In your SaaS app or cloud environment, upgrade your app and reauthorize your account.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Get started

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/initial-setup/](https://developers.cloudflare.com/cloudflare-one/policies/gateway/initial-setup/)

Page options # Get started

This section covers best practices for setting up the following Gateway policy types:

- DNS filtering
- Network filtering
- HTTP filtering

For each type of policy, we recommend the following workflow:

1. Connect the devices and/or networks that you want to apply policies to.
2. Verify that Gateway is successfully proxying traffic from your devices.
3. Set up basic security and compatibility policies (recommended for most use cases).
4. Customize your configuration to the unique needs of your organization.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Common policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/dns-policies/common-policies](https://developers.cloudflare.com/cloudflare-one/policies/gateway/dns-policies/common-policies)

Page options # Common policies

The following policies are commonly used to secure DNS traffic.

Refer to the DNS policies page for a comprehensive list of other selectors, operators, and actions.

## Allow corporate domains

This policy allows users to access official corporate domains. By deploying the policy with high order of precedence, you ensure that employees can access trusted domains even if they fall under a blocked category like Newly seen domains or Login pages.

- Dashboard
- API

| Selector | Operator | Value | Action | Precedence |
| --- | --- | --- | --- | --- |
| Domain | in list | Allowed domains | Allow | 1 |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Allow corporate domains",    "description": "Allow any internal corporate domains added to a list",    "precedence": 0,    "enabled": true,    "action": "allow",    "filters": [        "dns"    ],    "traffic": "any(dns.domains[*] in $<LIST_UUID>)",    "identity": ""  }'
```

To get the UUIDs of your lists, use the List Zero Trust lists endpoint.

## Block security threats

Block security categories such as Command & Control, Botnet and Malware based on Cloudflare's threat intelligence.

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Security Categories | in | All security risks | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-DNS-SecurityCategories-Blocklist",    "description": "Block security categories based on Cloudflare'\''s threat intelligence",    "precedence": 20,    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.security_category[*] in {68 178 80 83 176 175 117 131 134 151 153})",    "identity": ""  }'
```

```
resource "cloudflare_zero_trust_gateway_policy" "block_security_threats" {  account_id  = var.cloudflare_account_id  name        = "All-DNS-SecurityCategories-Blocklist"  description = "Block security categories based on Cloudflare's threat intelligence"  precedence  = 20  enabled     = true  action      = "block"  filters     = ["dns"]  traffic     = "any(dns.security_category[*] in {68 178 80 83 176 175 117 131 134 151 153})"}
```

## Block content categories

The categories included in this policy are not always a security threat, but blocking them can help minimize the risk that your organization is exposed to. For more information, refer to domain categories.

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | Questionable Content, Security Risks, Miscellaneous | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-DNS-ContentCategories-Blocklist",    "description": "Block common content categories that may pose a risk",    "precedence": 30,    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.content_category[*] in {17 85 87 102 157 135 138 180 162 32 169 177 128 15 115 119 124 141 161})",    "identity": ""  }'
```

```
resource "cloudflare_zero_trust_gateway_policy" "block_content_categories" {  account_id  = var.cloudflare_account_id  name        = "All-DNS-ContentCategories-Blocklist"  description = "Block common content categories that may pose a risk"  enabled     = true  action      = "block"  filters     = ["dns"]  traffic     = "any(dns.content_category[*] in {17 85 87 102 157 135 138 180 162 32 169 177 128 15 115 119 124 141 161})"  identity    = ""}
```

## Block a dynamic list of categories

You can add a list of category IDs to the EDNS header ‚Üó of a request sent to Gateway as a JSON object using OPT code 65050. For example:

```
{  "categories": [2, 67, 125, 133]}
```

With the Request Context Categories selector, you can block the category IDs sent with EDNS. This is useful to filter by categories not known at the time of creating a policy, or to enforce device-specific DNS content filtering without reaching your account limit. When Gateway uses this selector to block a DNS query, the request will return an Extended DNS Error (EDE) Code 15 - Blocked error, along with a field containing an array of the matched categories.

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Request Context Category | is | Present | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-DNS-Bock-Category-Matches-In-Request",    "description": "Block all category matches in the request EDNS context",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "dns.categories_in_request_context_matches",    "identity": ""  }'
```

```
resource "cloudflare_zero_trust_gateway_policy" "block_content_categories" {  account_id  = var.cloudflare_account_id  name        = "All-DNS-Bock-Category-Matches-In-Request"  description = "Block all category matches in the request EDNS context"  enabled     = true  action      = "block"  filters     = ["dns"]  traffic     = "dns.categories_in_request_context_matches"  identity    = ""}
```

## Block unauthorized applications

Note

After seven days, view your Shadow IT SaaS Analytics and block additional applications based on what your users are accessing.

To minimize the risk of shadow IT, some organizations choose to limit their users' access to certain web-based tools and applications. For example, the following policy blocks known AI tools:

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Application | in | Artificial Intelligence | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-DNS-Application-Blocklist",    "description": "Block access to unauthorized AI applications",    "precedence": 40,    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(app.type.ids[*] in {25})",    "identity": ""  }'
```

```
resource "cloudflare_zero_trust_gateway_policy" "block_unauthorized_apps" {  account_id  = var.cloudflare_account_id  name        = "All-DNS-Application-Blocklist"  description = "Block access to unauthorized AI applications"  enabled     = true  action      = "block"  filters     = ["dns"]  traffic     = "any(app.type.ids[*] in {25})"  identity    = ""}
```

## Block banned countries

You can implement policies to block websites hosted in countries categorized as high risk. The designation of such countries may result from your organization's customers or through the implementation of regulations including EAR ‚Üó, OFAC ‚Üó, and ITAR ‚Üó.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Resolved Country IP Geolocation | in | Afghanistan, Belarus, Congo (Kinshasa), Cuba, Iran, Iraq, Korea, North, Myanmar, Russian Federation, Sudan, Syria, Ukraine, Zimbabwe | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block banned countries",    "description": "Block access to banned countries",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.dst.geo.country[*] in {\"AF\" \"BY\" \"CD\" \"CU\" \"IR\" \"IQ\" \"KP\" \"MM\" \"RU\" \"SD\" \"SY\" \"UA\" \"ZW\"})",    "identity": ""  }'
```

## Block top-level domains

Blocking frequently misused ‚Üó top-level domains (TLDs) can reduce security risks, especially when there is no discernible advantage to be gained from allowing access. Similarly, restricting access to specific country-level TLDs may be necessary to comply with regulations like ITAR ‚Üó or OFAC ‚Üó.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Domain | matches regex | [.](cn|ru)$ | Or | Block |
| Domain | matches regex | [.](rest|hair|top|live|cfd|boats|beauty|mom|skin|okinawa)$ | Or |  |
| Domain | matches regex | [.](zip|mobi)$ |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block top-level domains",    "description": "Block top-level domains that are frequently used for malicious practices",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.domains[*] matches \"[.](cn|ru)$\") or any(dns.domains[*] matches \"[.](rest|hair|top|live|cfd|boats|beauty|mom|skin|okinawa)$\") or any(dns.domains[*] matches \"[.](zip|mobi)$\")",    "identity": ""  }'
```

## Block phishing attacks

To protect against sophisticated phishing attacks ‚Üó, you could prevent users from accessing phishing domains that are specifically targeting your organization. The following policy blocks specific keywords associated with an organization or its authentication services (such as okta, 2fa, cloudflare or sso), while still allowing access to official corporate domains.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Domain | not in list | Corporate Domains | And | Block |
| Domain | matches regex | .*okta.*|.*cloudflare.*|.*mfa.*|.sso.* |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block phishing attacks",    "description": "Block attempts to phish specific domains targeting your organization",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "not(any(dns.domains[*] in $<LIST_UUID>)) and any(dns.domains[*] matches \".*okta.*\\|.*cloudflare.*\\|.*mfa.*\\|.sso.*\")",    "identity": ""  }'
```

To get the UUIDs of your lists, use the List Zero Trust lists endpoint.

## Block online tracking

To safeguard user privacy, some organizations will block tracking domains such as dig.whatsapp.com as well as other tracking domains embedded at the OS level. This policy is implemented by creating a custom blocklist. Refer to this repository ‚Üó for a list of widespread tracking domains that you can add to your blocklist.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Domain | in list | Top tracking domains | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block online tracking",    "description": "Block domains used for tracking at an OS level",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.domains[*] in $<LIST_UUID>)",    "identity": ""  }'
```

To get the UUIDs of your lists, use the List Zero Trust lists endpoint.

## Block malicious IPs

Block specific IP addresses that are known to be malicious or pose a threat to your organization. This policy is usually implemented by creating custom blocklists or by using blocklists provided by threat intelligence partners or regional Computer Emergency and Response Teams (CERTs).

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Resolved IP | in list | DShield | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block malicious IPs",    "description": "Block specific IP addresses that are known to be malicious or pose a threat to your organization",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.resolved_ips[*] in $<LIST_UUID>)",    "identity": ""  }'
```

To get the UUIDs of your lists, use the List Zero Trust lists endpoint.

## Turn on CIPA filter

The CIPA (Children's Internet Protection Act) Filter is a collection of subcategories that encompass a wide range of topics that could be harmful or inappropriate for minors. It is used as a part of Project Cybersafe Schools to block access to unwanted or harmful online content. Upon creating this policy, your organization will have minimum CIPA compliance ‚Üó.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | CIPA Filter | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Turn on CIPA filter",    "description": "Block access to unwanted or harmful online content for children",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.content_category[*] in {182})",    "identity": ""  }'
```

## Hide explicit search results

SafeSearch is a feature of search engines that helps you filter explicit or offensive content. You can force SafeSearch on search engines like Google, Bing, Yandex, YouTube, and DuckDuckGo:

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | Search Engines | Safe Search |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Hide explicit search results",    "description": "Force SafeSearch on search engines to filter explicit or offensive content",    "enabled": true,    "action": "safesearch",    "filters": [        "dns"    ],    "traffic": "any(dns.content_category[*] in {145})",    "identity": ""  }'
```

## Check user identity

Configure access on a per user or group basis by adding identity-based conditions to your policies.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application | in | Salesforce | And | Block |
| User Group Names | in | Contractors |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Check user identity",    "description": "Filter traffic based on a user identity group name",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(app.ids[*] in {606})",    "identity": "any(identity.groups.name[*] in {\"Contractors\"})"  }'
```

## Restrict access to specific groups

Filter DNS queries to allow only specific users access.

The following example includes two policies. The first policy allows the specified group, while the second policy blocks all other users. To ensure the policies are evaluated properly, place the Allow policy above the Block policy. For more information, refer to the order of precedence.

### 1. Allow a group

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Content Categories | in | Social Networks | And | Allow |
| User Group Names | in | Marketing |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Allow social media for Marketing",    "description": "Allow access to social media sites for users in the Marketing group",    "precedence": 1,    "enabled": true,    "action": "allow",    "filters": [        "dns"    ],    "traffic": "any(dns.content_category[*] in {149})",    "identity": "any(identity.groups.name[*] in {\"Marketing\"})"  }'
```

### 2. Block all other users

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | Social Networks | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block social media",    "description": "Block social media for all other users",    "precedence": 2,    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "any(dns.content_category[*] in {149})",    "identity": ""  }'
```

## Control IP version

Enterprise users can pair these policies with an egress policy to control which IP version is used to egress to the origin server.

Optionally, you can use the Domain selector to control the IP version for specific sites.

Note

To ensure traffic routes through your preferred IP version, turn off Modify Gateway block behavior.

### Force IPv4

Force users to connect with IPv4 by blocking IPv6 resolution.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Query Record Type | is | AAAA | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Force IPv4",    "description": "Force users to connect with IPv4 by blocking IPv6 resolution",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "dns.query_rtype == \"AAAA\"",    "identity": ""  }'
```

### Force IPv6

Force users to connect with IPv6 by blocking IPv4 resolution.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Query Record Type | is | A | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Force IPv6",    "description": "Force users to connect with IPv6 by blocking IPv4 resolution",    "enabled": true,    "action": "block",    "filters": [        "dns"    ],    "traffic": "dns.query_rtype == \"A\"",    "identity": ""  }'
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Common policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/network-policies/common-policies](https://developers.cloudflare.com/cloudflare-one/policies/gateway/network-policies/common-policies)

Page options # Common policies

The following policies are commonly used to secure network traffic.

Refer to the network policies page for a comprehensive list of other selectors, operators, and actions.

## Block unauthorized applications

Note

After seven days, view your Shadow IT SaaS Analytics and block additional applications based on what your users are accessing.

To minimize the risk of shadow IT, some organizations choose to limit their users' access to certain web-based tools and applications. For example, the following policy blocks known AI tools:

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Application | in | Artificial Intelligence | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block unauthorized applications",    "description": "Block access to unauthorized AI applications",    "enabled": true,    "action": "block",    "filters": [        "l4"    ],    "traffic": "any(app.type.ids[*] in {25})",    "identity": "",    "device_posture": ""  }'
```

## Check user identity

Configure access on a per user or group basis by adding identity-based conditions to your policies.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application | in | Salesforce | And | Block |
| User Group Names | in | Contractors |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Check user identity",    "description": "Block access to Salesforce by temporary employees and contractors",    "enabled": true,    "action": "block",    "filters": [        "l4"    ],    "traffic": "any(app.ids[*] in {606})",    "identity": "any(identity.groups.name[*] in {\"Contractors\"})",    "device_posture": ""  }'
```

## Enforce device posture

Require devices to have certain software installed or other configuration attributes. For instructions on enabling a device posture check, refer to the device posture section. For example, you can use a list of device serial numbers to ensure users can only access an application if they connect with the WARP client from a company device:

In the following example, you can use a list of device serial numbers to ensure users can only access an application if they connect with the WARP client from a company device:

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| SNI Domain | is | internalapp.com | And | Block |
| Passed Device Posture Checks | not in | Device serial numbers |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-NET-ApplicationAccess-Allow",    "description": "Ensure access to the application comes from authorized WARP clients",    "precedence": 70,    "enabled": false,    "action": "block",    "filters": [        "l4"    ],    "traffic": "any(net.sni.domains[*] == \"internalapp.com\")",    "device_posture": "not(any(device_posture.checks.passed[*] in {\"<DEVICE_SERIAL_NUMBERS_LIST_UUID>\"}))"  }'
```

To get the UUIDs of your device posture checks, use the List device posture rules endpoint.

```
resource "cloudflare_zero_trust_gateway_policy" "all_net_applicationaccess_allow" {  account_id  = var.cloudflare_account_id  name        = "All-NET-ApplicationAccess-Allow"  description = "Ensure access to the application comes from authorized WARP clients"  precedence  = 70  enabled     = false  action      = "block"  filters     = ["l4"]  traffic     = "any(net.sni.domains[*] == \"internalapp.com\")"  posture      =  "not(any(device_posture.checks.passed[*] in {\"${"$"}${cloudflare_zero_trust_list.allowed_devices_sn_list.id}\"}))"}
```

## Enforce session duration

To require users to re-authenticate after a certain amount of time has elapsed, configure WARP sessions.

## Allow only approved traffic

Restrict user access to only the specific sites or applications configured in your HTTP policies.

### 1. Allow HTTP and HTTPS traffic

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Detected Protocol | is | TLS | And | Allow |
| Destination Port | in | 80, 443 |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Allow HTTP and HTTPS traffic",    "description": "Restrict traffic to HTTP and HTTPS traffic",    "enabled": true,    "action": "allow",    "filters": [        "l4"    ],    "traffic": "net.detected_protocol == \"tls\" and net.dst.port in {80 443}",    "identity": "",    "device_posture": ""  }'
```

### 2. Block all other traffic

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Protocol | in | TCP, UDP | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block all other traffic",    "description": "Block all other traffic that is not HTTP or HTTPS",    "enabled": true,    "action": "block",    "filters": [        "l4"    ],    "traffic": "net.protocol in {\"tcp\" \"udp\"}",    "identity": "",    "device_posture": ""  }'
```

## Filter HTTPS traffic when inspecting on all ports

If your organization blocks traffic by default with a network policy and you want to inspect HTTP traffic on all ports, you need to explicitly allow HTTP and TLS traffic to filter it.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Detected Protocol | is | TLS | Or | Allow |
| Detected Protocol | is | HTTP |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Allow on inspect all ports",    "description": "Filter HTTPS traffic when using inspect all ports",    "enabled": true,    "action": "allow",    "filters": [        "l4"    ],    "traffic": "net.detected_protocol == \"tls\" or net.detected_protocol == \"http\"",    "identity": "",    "device_posture": ""  }'
```

## Restrict access to private networks

Restrict access to resources which you have connected through Cloudflare Tunnel.

The following example consists of two policies: the first allows specific users to reach your application, and the second blocks all other traffic.

### 1. Allow company employees

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Destination IP | in | 10.0.0.0/8 | And | Allow |
| User Email | matches regex | .*@example.com |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Allow company employees",    "description": "Allow any users with an organization email to reach the application",    "enabled": true,    "action": "allow",    "filters": [        "l4"    ],    "traffic": "net.dst.ip in {10.0.0.0/8}",    "identity": "identity.email matches \".*@example.com\"",    "device_posture": ""  }'
```

### 2. Block everyone else

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Destination IP | in | 10.0.0.0/8 | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block everyone else",    "description": "Block any other users from accessing the application",    "enabled": true,    "action": "block",    "filters": [        "l4"    ],    "traffic": "net.dst.ip in {10.0.0.0/8}",    "identity": "",    "device_posture": ""  }'
```

## Override IP address

Override traffic directed toward a specific IP address with a different IP address.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Destination IP | in | 203.0.113.17 | And | Network Override |
| Destination Port | is | 80 |  |  |

| Override IP | Override Port |
| --- | --- |
| 1.1.1.1 | 80 |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Override example.com with 1.1.1.1",    "description": "Override a site'\''s IP address with another IP",    "enabled": true,    "action": "l4_override",    "filters": [        "l4"    ],    "traffic": "net.dst.ip in {203.0.113.17} and net.dst.port == 80",    "identity": "",    "device_posture": "",    "rule_settings": {        "l4override": {            "ip": "1.1.1.1",            "port": 80        },        "override_host": "",        "override_ips": null    }  }'
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Common policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/common-policies](https://developers.cloudflare.com/cloudflare-one/policies/gateway/http-policies/common-policies)

Page options # Common policies

The following policies are commonly used to secure HTTP traffic.

Refer to the HTTP policies page for a comprehensive list of other selectors, operators, and actions.

## Block sites

Block attempts to reach sites by hostname or URL paths. Different approaches may be required based on how a site is organized.

### Block sites by hostname

Block all subdomains that use a host.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Host | matches regex | .*example\.com | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block sites by hostname",    "description": "Block all subdomains that use a specific hostname",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "http.request.host matches \".*example.com\"",    "identity": "",    "device_posture": ""  }'
```

### Block sites by URL

Block a section of a site without blocking the entire site. For example, you can block a specific subreddit, such as reddit.com/r/gaming, without blocking reddit.com.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| URL | matches regex | /r/gaming | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block sites by URL",    "description": "Block specific parts of a site without blocking the hostname",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "http.request.uri matches \"/r/gaming\"",    "identity": "",    "device_posture": ""  }'
```

## Block content categories

Block content categories which go against your organization's acceptable use policy.

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Content Categories | in | Questionable Content, Security Risks, Miscellaneous, Adult Themes, Gambling | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-HTTP-ContentCategories-Blocklist",    "description": "Block access to questionable content and potential security risks",    "precedence": 40,    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(http.request.uri.content_category[*] in {17 85 87 102 157 135 138 180 162 32 169 177 128 15 115 119 124 141 161 2 67 125 133 99})",    "identity": "",    "device_posture": ""  }'
```

```
resource "cloudflare_zero_trust_gateway_policy" "block_unauthorized_apps" {  account_id     = var.cloudflare_account_id  name           = "All-HTTP-ContentCategories-Blocklist"  description    = "Block access to questionable content and potential security risks"  precedence     = 40  enabled        = true  action         = "block"  filters        = ["dns"]  traffic        = "any(http.request.uri.content_category[*] in {17 85 87 102 157 135 138 180 162 32 169 177 128 15 115 119 124 141 161 2 67 125 133 99})""  identity       = ""  device_posture = ""}
```

## Block unauthorized applications

Note

After seven days, view your Shadow IT SaaS Analytics and block additional applications based on what your users are accessing.

To minimize the risk of shadow IT, some organizations choose to limit their users' access to certain web-based tools and applications. For example, the following policy blocks known AI tools:

- Dashboard
- API
- Terraform

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Application | in | Artificial Intelligence | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "All-HTTP-Application-Blocklist",    "description": "Limit access to shadow IT by blocking web-based tools and applications",    "precedence": 60,    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(app.type.ids[*] in {25})",    "identity": "",    "device_posture": ""  }'
```

```
resource "cloudflare_zero_trust_gateway_policy" "all_http_application_blocklist" {  account_id     = var.cloudflare_account_id  name           = "All-HTTP-Application-Blocklist"  description    = "Limit access to shadow IT by blocking web-based tools and applications"  precedence     = 60  enabled        = true  action         = "block"  filters        = ["http"]  traffic        = "any(app.type.ids[*] in {25})"  identity       = ""  device_posture = ""}
```

## Check user identity

Configure access on a per user or group basis by adding identity-based conditions to your policies.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application | in | Salesforce | And | Block |
| User Group Names | in | Contractors |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Check user identity",    "description": "Block access to Salesforce by temporary employees and contractors",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(app.ids[] in {606})",    "identity": "any(identity.groups.name[] in {\"Contractors\"})",    "device_posture": ""  }'
```

## Skip inspection for groups of applications

Certain client applications, such as Zoom or Apple services, rely on certificate pinning. The TLS decryption performed by Cloudflare Gateway will cause errors when users visit those applications. To avoid this behavior, you must add a Do Not Inspect HTTP policy.

Gateway evaluates Do Not Inspect policies first. We recommend moving your Do Not Inspect policies to the top of the list to reduce confusion.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Application | in | Do Not Inspect | Do Not Inspect |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Bypass incompatible applications",    "description": "Skip TLS decryption for applications that are incompatible with Gateway",    "enabled": true,    "action": "off",    "filters": [        "http"    ],    "traffic": "any(app.type.ids[*] in {16})",    "identity": "",    "device_posture": ""  }'
```

Note

You can select either individual applications or the entire Do Not Inspect set, which will update as new applications are added.

## Check device posture

Require devices to have certain software installed or other configuration attributes. For instructions on setting up a device posture check, refer to Enforce device posture.

### Enforce a minimum OS version

Perform an OS version check to ensure users are running at least a minimum version.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Passed Device Posture Checks | in | Minimum OS version | Allow |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Require OS version",    "description": "Perform an OS version check for minimum version",    "enabled": true,    "action": "allow",    "filters": [        "http"    ],    "traffic": "",    "identity": "",    "device_posture": "any(device_posture.checks.passed[*] in {\"<POSTURE_CHECK_UUID>\"})"  }'
```

To get the UUIDs of your device posture checks, use the List device posture rules endpoint.

### Check for a specific file

Perform a file check to ensure users have a certain file on their device.

Since the file path will be different for each operating system, you can configure a file check for each system and use the Or logical operator to only require one of the checks to pass.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Passed Device Posture Checks | in | macOS File Check | Or | Allow |
| Passed Device Posture Checks | in | Linux File Check |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Check for specific file",    "description": "Ensure users have a specific file on their device regardless of operating system",    "enabled": true,    "action": "allow",    "filters": [        "http"    ],    "traffic": "",    "identity": "",    "device_posture": "any(device_posture.checks.passed[] in {\"<POSTURE_CHECK_1_UUID>\"}) or any(device_posture.checks.passed[] in {\"<POSTURE_CHECK_2_UUID>\"})"  }'
```

To get the UUIDs of your device posture checks, use the List device posture rules endpoint.

## Enforce session duration

Require users to re-authenticate after a certain amount of time has elapsed.

## Isolate high risk sites in remote browser

If you are using the Browser Isolation add-on, refer to our list of common Isolate policies.

## Bypass inspection for self-signed certificates

When accessing origin servers with certificates not signed by a public certificate authority, you must bypass TLS decryption.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Domain | in | internal.example.com | Do Not Inspect |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Bypass internal site inspection",    "description": "Bypass TLS decryption for internal sites with self-signed certificates",    "enabled": true,    "action": "off",    "filters": [        "http"    ],    "traffic": "any(http.conn.domains[*] in {\"internal.example.com\"})",    "identity": "",    "device_posture": ""  }'
```

## Block file types

Block the upload or download of files based on their type.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Upload File Types | in | Microsoft Office Word Document (docx) | And | Block |
| Download File Types | in | PDF (pdf) |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block file types",    "description": "Block the upload or download of files based on their type",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(http.upload.file.types[*] in {\"docx\"}) and any(http.download.file.types[*] in {\"pdf\"})",    "identity": "",    "device_posture": ""  }'
```

For more information on supported file types, refer to Download and Upload File Types.

## Isolate or block shadow IT applications

Isolate shadow IT applications discovered by the Application Library that have not been reviewed yet or are currently under review, and block applications that are not approved by your organization.

For more information on reviewing shadow IT applications, refer to Review applications.

### 1. Isolate unreviewed or in review applications

Isolate applications if their approval status is Unreviewed or In review.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application Status | is | Unreviewed | Or | Isolate |
| Application Status | is | In review |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Isolate unreviewed or in review application status",    "description": "Isolate Shadow IT applications that have not been reviewed or are in review in the Application Library",    "enabled": true,    "action": "isolate",    "filters": [        "http"    ],    "traffic": "any(app.statuses[*] == \"unreviewed\") or any(app.statuses[*] == \"in review\")",    "identity": "",    "device_posture": ""  }'
```

### 2. Block unapproved applications

Block applications if their approval status is Unapproved.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| Application Status | is | Unapproved | Block |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block unapproved application status",    "description": "Block Shadow IT applications that have been marked as unapproved in the Application Library",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(app.statuses[*] == \"unapproved\")",    "identity": "",    "device_posture": ""  }'
```

## Block Google services

To enable Gateway inspection for Google Drive traffic, you must add a Cloudflare certificate to Google Drive.

### Block Google Drive downloads

Block file downloads from Google Drive.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application | in | Google Drive | And | Block |
| URL Path & Query | matches regex | .*(e=download|export).* |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block Google Drive downloads",    "description": "Block file downloads from Google Drive",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(app.ids[] in {554}) and http.request.uri.path_and_query matches \".(e=download|export).*\"",    "identity": "",    "device_posture": ""  }'
```

### Block Google Drive uploads

Block file uploads from Google Drive.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Application | in | Google Drive | And | Block |
| Upload Mime Type | matches regex | .* | And |  |
| Host | is not | drivefrontend-pa.clients6.google.com |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block Google Drive uploads",    "description": "Block file uploads to Google Drive",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "any(app.ids[] in {554}) and http.upload.mime matches \".\" and not(http.request.host == \"drivefrontend-pa.clients6.google.com\")",    "identity": "",    "device_posture": ""  }'
```

### Block Gmail downloads

Block file downloads from Gmail.

- Dashboard
- API

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Host | is | mail-attachment.googleusercontent.com | And | Block |
| URL Path & Query | is | /attachment/u/0 |  |  |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Block Gmail downloads",    "description": "Block file downloads from Gmail",    "enabled": true,    "action": "block",    "filters": [        "http"    ],    "traffic": "http.request.host == \"mail-attachment.googleusercontent.com\" and http.request.uri.path_and_query matches \"/attachment/u/0\"",    "identity": "",    "device_posture": ""  }'
```

## Filter WebSocket traffic

Gateway does not inspect or log WebSocket ‚Üó traffic. Instead, Gateway will only log the HTTP details used to make the WebSocket connection, as well as network session information. To filter your WebSocket traffic, create a policy with the 101 HTTP response code.

- Dashboard
- API

| Selector | Operator | Value | Action |
| --- | --- | --- | --- |
| HTTP Response | is | 101 SWITCHING_PROTOCOLS | Allow |

Required API token permissions

At least one of the following token permissions is required: - Zero Trust Write

Create a Zero Trust Gateway rule ```
curl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "name": "Filter WebSocket",    "description": "Filter WebSocket traffic with HTTP response code 101",    "enabled": true,    "action": "allow",    "filters": [        "http"    ],    "traffic": "http.response.status_code == 101",    "identity": "",    "device_posture": ""  }'
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Êú™Áü•Ê®ôÈ°å

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/static/list-test.csv](https://developers.cloudflare.com/cloudflare-one/static/list-test.csv)



---

## Insights

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/](https://developers.cloudflare.com/cloudflare-one/insights/)

Page options # Insights

Cloudflare Zero Trust gives you comprehensive and in-depth visibility into your network. Whether you need data on network usage, on security threats blocked by Cloudflare Zero Trust, or on how many users have logged in to your applications this month, Zero Trust provides you with the right tools for the job.

- Analytics
- DEX
- Logs
- Risk score

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Analytics overview

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/analytics/](https://developers.cloudflare.com/cloudflare-one/insights/analytics/)

Page options # Analytics overview

The Cloudflare One Analytics overview provides a dashboard that reports on how Cloudflare One is protecting your organization and networks.

To view the Analytics overview in Zero Trust ‚Üó, go to Analytics.

The Analytics overview includes reports and insights across the following products and categories:

- Global status of your Cloudflare One organization
- Access
- Gateway

HTTP traffic
Network traffic
DNS traffic
Firewall policies
- HTTP traffic
- Network traffic
- DNS traffic
- Firewall policies

## Global status

In Global status, you can view a report on your organization's Cloudflare One adoption that contains the following metrics:

- Access apps configured
- Gateway HTTP policies
- Gateway network policies
- Gateway DNS policies
- SaaS integrations
- DLP profiles

You can also view a report on your seat usage across your Cloudflare One organization that contains the following metrics:

- Total seats
- Used seats
- Unused seats

## Access

In Access, you can view a report on your Access configuration that contains:

Metrics:

- Total access attempts
- Granted access
- Denied (policy violation)
- Active logins overtime
- Top applications with most logins

Filters:

- Access data by country

## Gateway

### Proxy traffic

In Proxy traffic, you can view a report on your Gateway HTTP traffic that contains:

Metrics:

- Total requests overtime
- Allowed requests
- Blocked requests
- Isolated requests
- Do not inspect requests
- Top bandwidth consumers (GB)
- Top denied users

Filters:

- Gateway HTTP traffic data by country

### Gateway (network requests)

In Gateway (network requests), you can view a report on your Gateway network traffic that contains:

Metrics:

- Total sessions
- Authenticated sessions
- Blocked sessions
- Audit SSH sessions
- Allowed sessions
- Override sessions
- Top bandwidth consumers in GB
- Top denied users

Filters:

- Gateway network traffic data by country

### DNS traffic

In DNS traffic, you can view a report on your Gateway DNS traffic that contains:

Metrics:

- Total DNS queries
- Allowed DNS queries
- Blocked DNS queries
- Override DNS queries
- Safe Search DNS queries
- Restricted DNS queries
- Other DNS queries

Filters:

- Gateway DNS traffic by query type
- Gateway DNS traffic by country

### Gateway insights

In Gateway insights, you can view a report on your Gateway firewall policies that contains the following metrics:

- Top domain blocking policies
- Top destination domains
- Most user queries
- Top devices
- Top countries

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Monitoring

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/insights/dex/fleet-status/](https://developers.cloudflare.com/cloudflare-one/insights/dex/fleet-status/)

Page options # Monitoring

Monitor performance and network status for your organization's fleet or individual user devices.

Network and device performance data helps IT administrators troubleshoot performance issues, investigate network connectivity problems, and monitor device health.

## Fleet status

A fleet is a collection of user devices. All devices in a fleet have WARP installed and are connected to a Cloudflare Zero Trust organization.

To view fleet status:

1. In Zero Trust ‚Üó, go to DEX > Monitoring.
2. In DEX Monitoring, review the information under the Fleet Status tab.

### View metrics

The Fleet Status tab will show real-time and historical connectivity metrics for all devices in your organization.

To view analytics on a per-device level, go to Device monitoring.

### Available metrics

- Devices connected by colo: Number of devices that are connected to a given Cloudflare data center ‚Üó.
- Connectivity status: Percentage of devices in a given WARP client state.

























StatusDescriptionConnectedWARP has successfully established a connection to the Cloudflare global network.DisconnectedWARP has been intentionally or unintentionally disconnected from the Cloudflare global network.PausedA user or administrator has taken an explicit action to temporarily turn off WARP, for example by entering an Admin Override code. Paused clients will auto-connect after a timeout period.ConnectingWARP is pending connection, but is actively trying to establish a connection to the Cloudflare global network.
- Mode: WARP mode deployed on the device.
- Colo: Percentage of devices connected to a given Cloudflare data center.
- Platform: Operating system of the device.
- Major Version: WARP client version installed on the device.
- Device Status Over Time: WARP client connection status over the selected time period.
- Connection Methods Over Time: WARP mode used by the device over the selected time period.

## Device monitoring

Review network and device performance for a device enrolled in your fleet.

### View a device's performance

To view a device's network and device performance metrics:

1. In Zero Trust ‚Üó, go to My team > Devices.
2. Select a device > View details.
3. Select the DEX tab.
4. In Device Monitoring, scroll down to Network performance and Device Performance.

### Network and device performance metrics

#### Network performance metrics

- Unique networks over time: How many unique SSIDs the device was connected to.
- Network I/O: How much data has been transferred (uploads and downloads) over the primary network interface.

#### Device performance metrics

- Battery percentage and cycles: Displays battery percentage and battery cycles ‚Üó over time. Used to debug potential performance issues possibly related to battery health or power-saving measures that are triggered at low-battery levels.
- CPU usage: CPU utilization over time. Used to debug slow system performance due to high CPU usage.
- Memory utilization: Memory utilization over time. Used to debug performance issues related to an overtaxed memory.
- Disk I/O: Displays number of disk read/write operations over time. Used to debug performance errors due to heavy disk operations.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Device posture

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/identity/devices](https://developers.cloudflare.com/cloudflare-one/identity/devices)

Page options # Device posture

With Cloudflare Zero Trust, you can configure Zero Trust policies that rely on additional signals from the WARP client or from third-party endpoint security providers. When device posture checks are configured, users can only connect to a protected application or network resource if they have a managed or healthy device.

## 1. Enable device posture checks

Setup instructions and requirements vary depending on the device posture attribute. Refer to the links below to view the setup guide for your provider.

- WARP client checks are performed by the Cloudflare WARP client.
- Service-to-service checks are performed by third-party device posture providers.
- Access integration checks are only configurable for Access applications. These attributes cannot be used in Gateway policies.

## 2. Verify device posture checks

Before integrating a device posture check in a Gateway or Access policy, verify that the Pass/Fail results match your expectations. To view the latest test results for a specific device:

1. In Zero Trust ‚Üó, go to My Team > Devices.
2. Select the device.
3. Select View details.
4. Select the Posture checks tab.

## 3. Build a device posture policy

You can now use your device posture check in an Access policy or a Gateway network or HTTP policy. In Access, the enabled device posture attributes will appear in the list of available selectors. In Gateway, the attributes will appear when you choose the Passed Device Posture Check selector.

Gateway policy limitation

Gateway does not support device posture checks for the Tanium Access integration.

## 4. Ensure traffic is going through WARP

WARP client and service-to-service posture checks rely on traffic going through WARP to detect posture information for a device. In your Split Tunnel configuration, ensure that the following domains are included in WARP:

- The IdP used to authenticate to Cloudflare Zero Trust if posture check is part of an Access policy.
- <your-team-name>.cloudflareaccess.com if posture check is part of an Access policy.
- The application protected by the Access or Gateway policy.

## Policy enforcement rate

Access detects changes in device posture at the same rate as the polling frequency configured for the posture check.

Because Gateway evaluates network and HTTP policies on every request, it maintains a local cache of posture results that is only updated every five minutes. Therefore, Gateway policies are subject to an additional five-minute delay. For example, if you set your polling frequency to 10 minutes, it may take up to 15 minutes for Gateway to detect posture changes on a device.

```
flowchart LR
accTitle: Device posture policy enforcement
A[Device] --schedule--> B[WARP client]--> C((Cloudflare)) --> D[Access policy]
C --5 min--> E[Cache] --> F[Gateway policy]
A --> G[Service provider] --interval--> C
```

Warning

Gateway does not terminate an active session even if a subsequent posture check fails during that session. Gateway only evaluates posture checks at the beginning of a session, and ongoing sessions will remain uninterrupted.

For example, if you establish an SSH session based on a successful posture check, but a posture requirement fails after the session has started, the session will remain active.

### Expiration

By default, the posture result on Cloudflare remains valid until it is overwritten by new data. You can specify an expiration time using our API. We recommend setting the expiration to be longer than the polling frequency.

### Polling frequency

#### WARP client checks

By default, the WARP client polls the device for status changes every five minutes. To modify the polling frequency, use the API to update the schedule parameter.

#### Service provider checks

When setting up a service-to-service integration, you will choose a polling frequency to determine how often Cloudflare will query the third-party API. To set the polling frequency via the API, use the interval parameter.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Post-delivery deployment

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/)

Page options # Post-delivery deployment

- API deployment
- BCC/Journaling

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Pre-delivery deployment

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/)

Page options # Pre-delivery deployment

- Prerequisites
- MX/Inline deployment
- Set up MX/Inline deployment
- Egress IPs
- Partner domain TLS

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## BCC/Journaling

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/)

Page options # BCC/Journaling

BCC/Journaling deployment is a post-delivery type of deployment. Every time you receive an email, your email provider will send a blind copy to Cloudflare for an analysis.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## BCC setup

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/)

Page options # BCC setup

- Gmail BCC setup
- Microsoft Exchange BCC setup

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Gmail BCC setup

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/gmail-bcc-setup/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/bcc-setup/gmail-bcc-setup/)

Page options # Gmail BCC setup

- Overview
- Enable Gmail BCC integration
- Connect your domains
- Add BCC rules
- Enable auto-moves

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Journaling setup

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/journaling-setup/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/post-delivery-deployment/bcc-journaling/journaling-setup/)

Page options # Journaling setup

- Microsoft 365 journaling setup
- Manually add domains

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Prerequisites

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/)

Page options # Prerequisites

- Microsoft 365 as MX Record
- Google Workspace as MX Record
- Cisco - Email Security as MX Record
- Cisco - Cisco as MX Record

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Use cases

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/use-cases/](https://developers.cloudflare.com/cloudflare-one/email-security/setup/pre-delivery-deployment/prerequisites/m365-email-security-mx/use-cases/)

Page options # Use cases

- 1 - Junk email and Email Security Admin Quarantine
- 2 - Junk email and user managed quarantine
- 3 - Junk email and administrative quarantine
- 4 - User managed quarantine and administrative quarantine
- 5 - Junk email folder and administrative quarantine

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Detection settings

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/](https://developers.cloudflare.com/cloudflare-one/email-security/detection-settings/)

Page options # Detection settings

- Allow policies
- Blocked senders
- Trusted domains
- Impersonation registry
- Additional detections
- Configure link actions
- Configure text add-ons

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Manage integrated directories

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/directories/manage-integrated-directories/](https://developers.cloudflare.com/cloudflare-one/email-security/directories/manage-integrated-directories/)

Page options # Manage integrated directories

To manage an integrated directory:

1. Log in to Zero Trust ‚Üó.
2. Select Email Security.
3. Select Directories.
4. Under Directory name, select your directory.
5. You will be redirected to a page where you can manage Groups or Users directories.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Reference

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/email-security/reference/](https://developers.cloudflare.com/cloudflare-one/email-security/reference/)

Page options # Reference

- How Email Security detects phish
- Information about your domain
- Dispositions and attributes

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Create and secure an AI agent wrapper using AI Gateway and Zero Trust

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/ai-wrapper-tenant-control/](https://developers.cloudflare.com/cloudflare-one/tutorials/ai-wrapper-tenant-control/)

Page options # Create and secure an AI agent wrapper using AI Gateway and Zero Trust

Last reviewed: 4 months ago This tutorial explains how to use Cloudflare AI Gateway and Zero Trust to create a functional and secure website wrapper for an AI agent. Cloudflare Zero Trust administrators can protect access to the wrapper with Cloudflare Access. Additionally, you can enforce Gateway policies to control how your users interact with AI agents, including executing AI agents in an isolated browser with Browser Isolation, enforcing Data Loss Prevention profiles to prevent your users from sharing sensitive data, and scanning content to avoid answers from AI agents that violate internal corporate guidelines. Creating an AI agent wrapper is also an effective way to enforce tenant control if you have an enterprise plan for a specific AI provider, such as ChatGPT Enterprise.

This tutorial uses ChatGPT as an example AI agent.

## Before you begin

Make sure you have:

- A Cloudflare Zero Trust organization.
- An API key for your desired AI provider, such as an OpenAI API key ‚Üó for ChatGPT.

## 1. Create an AI gateway

First, create an AI gateway to control your AI app.

1. In the Cloudflare dashboard ‚Üó, go to the AI Gateway page.
  Go to AI Gateway
2. Select Create Gateway.
3. Name your gateway.
4. Select Create.
5. Configure your desired options for the gateway.
6. Connect your AI provider to proxy queries to your AI agent of choice using your AI gateway.
7. (Optional) Turn on Authenticated Gateway. The Authenticated Gateway feature ensures your AI gateway can only be called securely by enforcing a token in the form of a request header cf-aig-authorization.

Go to AI > AI Gateway.
Select your AI gateway, then go to Settings.
Turn on Authenticated Gateway, then choose Confirm.
Select Create authentication token, then select Create an AI Gateway authentication token.
Configure your token and copy the token value. When creating your Worker, you will need to pass this token when calling your AI gateway.
8. Go to AI > AI Gateway.
9. Select your AI gateway, then go to Settings.
10. Turn on Authenticated Gateway, then choose Confirm.
11. Select Create authentication token, then select Create an AI Gateway authentication token.
12. Configure your token and copy the token value. When creating your Worker, you will need to pass this token when calling your AI gateway.

For more information, refer to Getting started with AI Gateway.

## 2. (Optional) Use Guardrails to block unsafe or inappropriate content

Guardrails is an built-in AI Gateway security feature that allows Cloudflare to identify unsafe or inappropriate content in prompts and responses based on selected categories.

1. In the Cloudflare dashboard, go to the AI Gateway page.
  Go to AI Gateway
2. Select your AI gateway.
3. Go to Guardrails.
4. Turn on Guardrails.
5. Select Change to configure the categories you would like to filter for both prompts and responses.

## 3. Build a Worker to serve the wrapper

### 1. Create the Worker

In order to build the Worker, you will need to choose if you want to build it locally using Wrangler or remotely using the dashboard ‚Üó.

- Wrangler
- Dashboard

1. In a terminal, log in to your Cloudflare account:
Terminal windowwrangler login
2. Initiate the project locally:
Terminal windowmkdir ai-agent-wrappercd ai-agent-wrapperwrangler init
3. Create a wrangler.toml configuration file:
name = "ai-agent-wrapper"main = "src/index.js"compatibility_date = "2023-10-30"
[vars]# Add any environment variables here
4. Add your AI provider's API key as a secret:
Terminal windowwrangler secret put <OPENAI_API_KEY>

You can now build the Worker using the index.js file created by Wrangler.

1. In the Cloudflare dashboard, go to the Workers & Pages page.
  Go to Compute (Workers)
2. Select Create.
3. In Workers, choose the Hello world template.
4. Name your worker, then select Deploy.
5. Select your Worker, then go to the Settings tab.
6. Go to Variables and Secrets, then select Add.
7. Choose Secret as the type, name your secret (for example, OPENAI_API_KEY), and enter the value of your AI provider's API key in Value.

You can now build the Worker using the online code editor by selecting Edit code on your Worker page.

### 2. Build the Worker

The following is an example starter Worker that serves a simple front-end to allow a user to interact with an AI provider behind AI Gateway. This example uses OpenAI as its AI provider:

```
export default {  async fetch(request, env) {    if (request.url.endsWith("/api/chat")) {      if (request.method === "POST") {        try {          const { messages } = await request.json();
          const response = await fetch(            "https://gateway.ai.cloudflare.com/v1/$ACCOUNT_ID/$GATEWAY_ID/openai/chat/completions",            {              method: "POST",              headers: {                "Content-Type": "application/json",                Authorization: `Bearer ${env.OPENAI_API_KEY}`,              },              body: JSON.stringify({                model: "gpt-4o-mini",                messages: messages,              }),            },          );
          if (!response.ok) {            throw new Error(`AI Gateway Error: ${response.status}`);          }
          const result = await response.json();          return new Response(            JSON.stringify({              response: result.choices[0].message.content,            }),            {              headers: { "Content-Type": "application/json" },            },          );        } catch (error) {          return new Response(JSON.stringify({ error: error.message }), {            status: 500,            headers: { "Content-Type": "application/json" },          });        }      }      return new Response("Method not allowed", { status: 405 });    }
    return new Response(HTML, {      headers: { "Content-Type": "text/html" },    });  },};
const HTML = `<!DOCTYPE html>  <html lang="en" data-theme="dark">177 collapsed lines  <head>      <meta charset="UTF-8">      <meta name="viewport" content="width=device-width, initial-scale=1.0">      <title>ChatGPT Wrapper</title>      <style>          :root {              --background-color: #1a1a1a;              --chat-background: #2d2d2d;              --text-color: #ffffff;              --input-border: #404040;              --message-ai-background: #404040;              --message-ai-text: #ffffff;          }
          body {              font-family: system-ui, sans-serif;              margin: 0;              padding: 20px;              background: var(--background-color);              display: flex;              flex-direction: column;              align-items: center;              gap: 20px;              color: var(--text-color);          }
          .chat-container {              width: 100%;              max-width: 800px;              background: var(--chat-background);              border-radius: 10px;              box-shadow: 0 2px 10px rgba(0,0,0,0.1);              height: 80vh;              display: flex;              flex-direction: column;          }
          .chat-header {              padding: 15px 20px;              border-bottom: 1px solid var(--input-border);              background: var(--chat-background);              border-radius: 10px 10px 0 0;              text-align: center;          }
          .chat-messages {              flex-grow: 1;              overflow-y: auto;              padding: 20px;          }
          .message {              margin-bottom: 20px;              padding: 10px 15px;              border-radius: 10px;              max-width: 80%;          }
          .user-message {              background: #007AFF;              color: white;              margin-left: auto;          }
          .ai-message {              background: var(--message-ai-background);              color: var(--message-ai-text);          }
          .input-container {              padding: 20px;              border-top: 1px solid var(--input-border);              display: flex;              gap: 10px;          }
          input {              flex-grow: 1;              padding: 10px;              border: 1px solid var(--input-border);              border-radius: 5px;              font-size: 16px;              background: var(--chat-background);              color: var(--text-color);          }
          button {              padding: 10px 20px;              background: #007AFF;              color: white;              border: none;              border-radius: 5px;              cursor: pointer;              font-size: 16px;          }
          button:disabled {              background: #ccc;          }
          .error {              color: red;              padding: 10px;              text-align: center;          }      </style>  </head>  <body>      <div class="chat-container">          <div class="chat-header">              <h2>AI Assistant</h2>          </div>          <div class="chat-messages" id="messages"></div>          <div class="input-container">              <input type="text" id="userInput" placeholder="Type your message..." />              <button onclick="sendMessage()" id="sendButton">Send</button>          </div>      </div>
      <script>          let messages = [];          const messagesDiv = document.getElementById('messages');          const userInput = document.getElementById('userInput');          const sendButton = document.getElementById('sendButton');
          userInput.addEventListener('keypress', (e) => {              if (e.key === 'Enter') sendMessage();          });
          async function sendMessage() {              const content = userInput.value.trim();              if (!content) return;
              userInput.disabled = true;              sendButton.disabled = true;
              messages.push({ role: 'user', content });              appendMessage('user', content);              userInput.value = '';
              try {                  const response = await fetch('/api/chat', {                      method: 'POST',                      headers: { 'Content-Type': 'application/json' },                      body: JSON.stringify({                          messages                      })                  });
                  if (!response.ok) {                      throw new Error('API request failed');                  }
                  const result = await response.json();                  const aiMessage = result.response;
                  messages.push({ role: 'assistant', content: aiMessage });                  appendMessage('ai', aiMessage);              } catch (error) {                  appendMessage('ai', 'Sorry, there was an error processing your request.');                  console.error('Error:', error);              }
              userInput.disabled = false;              sendButton.disabled = false;              userInput.focus();          }
          function appendMessage(role, content) {              const messageDiv = document.createElement('div');              messageDiv.className = 'message ' + role + '-message';              messageDiv.textContent = content;              messagesDiv.appendChild(messageDiv);              messagesDiv.scrollTop = messagesDiv.scrollHeight;          }      </script>  </body>  </html>`;
```

Note that the account ID and gateway ID need to be replaced in the AI Gateway endpoint. You can add these as environment variables or secrets in Workers. If you chose to use Authenticated Gateway when creating your AI gateway, make sure to also add your token as a secret and pass its value to the AI gateway in the cf-aig-authorization header.

### 3. Publish the Worker

Once the Worker code is complete, you need to make the Worker addressable using a hostname controllable by Cloudflare Access.

- Wrangler
- Dashboard

Edit the wrangler.toml configuration file and add the following information to ensure that the Worker is only accessible using the custom hostname:

```
name = "ai-agent-wrapper"main = "src/index.js"compatibility_date = "2023-10-30"workers_dev = false
# Replace with your custom domainroutes = [  { pattern = "<YOUR_CUSTOM_DOMAIN>", custom_domain = true }]
[vars]# Add any environment variables here
```

To publish the worker, run wrangler publish.

If you built your Worker remotely using the code editor available in the Cloudflare dashboard, you can deploy it by selecting Deploy.

To ensure that the Worker is only accessible from the custom hostname:

1. In the Cloudflare dashboard, go to the Workers & Pages page.
  Go to Compute (Workers)
2. Select your Worker.
3. Go to Settings.
4. Within Domains & Routes, select Add.
5. Choose Custom domain.
6. Enter your desired custom domain name.
7. Select Add domain.

The Worker is now behind an addressable public hostname. Make sure to turn off both workers.dev and Preview URLs so that the Worker can only be accessed with its custom domain.

## 4. Secure the wrapper with Access

To secure the AI agent wrapper to ensure that only trusted users can access it:

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Choose Self-hosted.
4. Enter a name for your AI agent wrapper application.
5. In Session Duration, choose when the user's application token should expire.
6. Select Add public hostname and enter the custom domain you set for your Worker.
7. Configure your Access application for your Worker.
8. Add Access policies to control who can connect to your application.

Now your AI wrapper can only be accessed by your users that successfully match your Access policies.

## 5. Block access to public AI agents with Gateway

You can now block access to all unauthorized public AI agents with a Gateway HTTP policy.

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies.
2. Select HTTP.
3. Select Add a policy.
4. Add the following policy:

















SelectorOperatorValueActionContent CategoriesinArtificial IntelligenceBlock
5. Select Create policy.

This ensures that public AI agents are not accessible using a managed endpoint.

Alternatively, you can prevent users from using public AI agents by displaying a custom block message, redirect, or a user notification directing users to the AI agent wrapper.

## 6. Enforce Data Loss Prevention and Clientless Browser Isolation

Now that you have full control over access to your AI agent wrapper, you can enforce extra security methods such as Data Loss Prevention (DLP) and Clientless Web Isolation to protect and control data shared with the AI agent.

### Apply Data Loss Prevention profiles

You can use Data Loss Prevention (DLP) to prevent your users from sending sensitive data to the AI agent.

1. In Zero Trust ‚Üó, go to Data loss prevention > DLP profiles.
2. Ensure that the DLP profiles you want to enforce are properly configured.
3. Add an HTTP policy to enforce the DLP profile for the hostname for your wrapper. For example:


























SelectorOperatorValueLogicActionHostisai-wrapper.example.comAndBlockDLP ProfileinAI DLP profile
4. Select Create policy.

For more information on creating DLP policies, refer to Scan HTTP traffic.

### Execute in a clientless isolated browser

Because you published your wrapper as a self-hosted Access application, you can execute it in an isolated session for your users by creating an Access policy and configuring it for your application.

1. In Zero Trust ‚Üó, go to Settings > Browser Isolation.
2. Enable Clientless Web Isolation.

1. Go to Access > Policies.
2. Select Add a policy.
3. Set the Action to Allow.
4. In Add rules, add identity rules to define who the application should be isolated for.
5. In Additional settings (optional), turn on Isolate application.

Once the Access policy has been created, you can attach it to your wrapper.

1. Go to Access > Applications.
2. Choose your wrapper application, then select Configure.
3. In Policies, select Select existing policies.
4. Choose the Access policy you previously created.
5. Select Confirm, then select Save application.

Because Clientless Web Isolation traffic applies your Gateway HTTP policies, your configured DLP profiles will apply to isolated sessions.

For more information on isolating an Access application, refer to Isolate self-hosted application.

## Additional benefits

Organizations that adopt Cloudflare to secure access to AI agents will benefit from improved visibility and configurability.

### Visibility

Zero Trust will log all Access events and DLP detections. In addition, AI Gateway provides visibility into user prompts, model response, token usage, and costs.

Logs can be exported to external providers with Logpush.

### Configurability

You can configure your wrapper to use a different AI provider or give your users the option to choose between multiple AI providers, including AI models running directly on Cloudflare's global network with Workers AI. With this, you can control costs related to AI usage or adopt newer models without impacting your users or the access controls already put in place.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Use Cloudflare Tunnels with Kubernetes client-go plugin

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/tunnel-kubectl/](https://developers.cloudflare.com/cloudflare-one/tutorials/tunnel-kubectl/)

Page options # Use Cloudflare Tunnels with Kubernetes client-go plugin

Last reviewed: 11 months ago # Use Cloudflare Tunnels with Kubernetes client-go credential plugins

This tutorial explains how to use Cloudflare Tunnels with Kubernetes client-go credential plugins for authentication. By following these steps, you can securely access your Kubernetes cluster through a Cloudflare Tunnel using the kubectl command-line tool.

## Prerequisites

- A Cloudflare account
- The Cloudflare Tunnel client (cloudflared) installed on your machine
- Access to a Kubernetes cluster
- kubectl installed on your machine

## 1. Set up a Cloudflare Tunnel

1. Authenticate cloudflared with your Cloudflare account:
Terminal windowcloudflared tunnel login
2. Create a new tunnel:
Terminal windowcloudflared tunnel create k8s-tunnel
3. Configure your tunnel by creating a configuration file named config.yml:
tunnel: <TUNNEL_ID>credentials-file: /path/to/credentials.jsoningress:  - hostname: k8s.example.com    service: tcp://kubernetes.default.svc.cluster.local:443  - service: http_status:404
Replace <TUNNEL_ID> with your tunnel ID and adjust the hostname as needed.
4. Start the tunnel:
Terminal windowcloudflared tunnel run k8s-tunnel

## 2. Configure the Kubernetes API server

Ensure your Kubernetes API server is configured to accept authentication from Cloudflare Tunnels. This may involve setting up an authentication webhook or configuring the API server to trust the Cloudflare Tunnel's client certificates.

## 3. Set up client-go credential plugin

1. Create a script named cloudflare-k8s-auth.sh with the following content:
#!/bin/bash
echo '{  "apiVersion": "client.authentication.k8s.io/v1beta1",  "kind": "ExecCredential",  "status": {    "token": "'"$(cloudflared access token -app=https://k8s.example.com)"'"  }}'
Make the script executable:
Terminal windowchmod +x cloudflare-k8s-auth.sh
2. Update your ~/.kube/config file to use the credential plugin:
apiVersion: v1kind: Configclusters:- cluster:    server: https://k8s.example.com  name: cloudflare-k8susers:- name: cloudflare-user  user:    exec:      apiVersion: client.authentication.k8s.io/v1beta1      command: /path/to/cloudflare-k8s-auth.sh      interactiveMode: Nevercontexts:- context:    cluster: cloudflare-k8s    user: cloudflare-user  name: cloudflare-k8s-contextcurrent-context: cloudflare-k8s-context

## 4. Use kubectl with Cloudflare Tunnel

Now you can use kubectl commands as usual. The client-go credential plugin will automatically handle authentication through the Cloudflare Tunnel:

Terminal window ```
kubectl get pods
```

## Troubleshooting

If you encounter issues:

- Ensure cloudflared is running and the tunnel is active
- Check that your ~/.kube/config file is correctly configured
- Verify that the Kubernetes API server is properly set up to accept authentication from Cloudflare Tunnels
- Review the Cloudflare Tunnel logs for any error messages

For more information, refer to the Cloudflare Tunnels documentation ‚Üó and the Kubernetes client-go credential plugins documentation ‚Üó.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Send SSO attributes to Access-protected origins with Workers

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/extend-sso-with-workers/](https://developers.cloudflare.com/cloudflare-one/tutorials/extend-sso-with-workers/)

Page options # Send SSO attributes to Access-protected origins with Workers

Last reviewed: 11 months ago This tutorial will walk you through extending the single-sign-on (SSO) capabilities of Cloudflare Access with our serverless computing platform, Cloudflare Workers. Specifically, this guide will demonstrate how to modify requests sent to your secured origin to include additional information from the Cloudflare Access authentication event.

Time to complete: 45 minutes

## Authentication flow

Cloudflare Access is an authentication proxy in charge of validating a user's identity before they connect to your application. As shown in the diagram below, Access inserts a JWT into the request, which can then be verified by the origin server.

You can extend this functionality by using a Cloudflare Worker to insert additional HTTP headers into the request. In this example, we will add the device posture attributes firewall_activated and disk_encrypted, but you can include any attributes that Cloudflare Access collects from the authentication event.

## Benefits

This approach allows you to:

- Enhance security: By incorporating additional information from the authentication event, you can implement more robust security measures. For example, you can use device posture data to enforce access based on device compliance.
- Improve user experience: You can personalize the user experience by tailoring content or functionality based on user attributes. For example, you can display different content based on the user's role or location.
- Simplify development: By using Cloudflare Workers, you can easily extend your Cloudflare Access configuration without modifying your origin application code.

## Before you begin

- Add a self-hosted application to Cloudflare Access.
- Enable the Disk encryption and Firewall device posture checks.
- Install Wrangler on your local machine.

## 1. Create the Worker

1. Create a new Workers project:
      npm     yarn     pnpm      Terminal windownpm create cloudflare@latest -- device-posture-worker  Terminal windowyarn create cloudflare device-posture-worker  Terminal windowpnpm create cloudflare@latest device-posture-worker     
For setup, select the following options:
For What would you like to start with?, choose Hello World example.For Which template would you like to use?, choose Worker only.For Which language do you want to use?, choose JavaScript.For Do you want to use git for version control?, choose Yes.For Do you want to deploy your application?, choose No (we will be making some changes before deploying).
2. npm
3. yarn
4. pnpm
5. For What would you like to start with?, choose Hello World example.
6. For Which template would you like to use?, choose Worker only.
7. For Which language do you want to use?, choose JavaScript.
8. For Do you want to use git for version control?, choose Yes.
9. For Do you want to deploy your application?, choose No (we will be making some changes before deploying).
10. Change to the project directory:
Terminal window$ cd device-posture-worker
11. Copy-paste the following code into src/index.js. Be sure to replace <your-team-name> with your Zero Trust team name.
index.jsimport { parse } from "cookie";export default {  async fetch(request, env, ctx) {    // The name of the cookie    const COOKIE_NAME = "CF_Authorization";  const CF_GET_IDENTITY = "https://<your-team-name>.cloudflareaccess.com/cdn-cgi/access/get-identity";    const cookie = parse(request.headers.get("Cookie") || "");    if (cookie[COOKIE_NAME] != null) {    try {    let id = await (await fetch(CF_GET_IDENTITY, request)).json()    let diskEncryptionStatus = false;    let firewallStatus = false;
    for (const checkId in id.devicePosture) {      const check = id.devicePosture[checkId];      if (check.type === "disk_encryption") {        console.log(check.type)        diskEncryptionStatus = check.success;      }      if (check.type === "firewall") {        console.log(check.type)        firewallStatus = check.success;        break;      }    }    //clone request (immutable otherwise) and insert posture values in new header set    let newRequest = await new Request(request)    newRequest.headers.set("Cf-Access-Firewall-Activated", firewallStatus)    newRequest.headers.set("Cf-Access-Disk-Encrypted", firewallStatus)
    //sent modified request to origin    return await fetch(newRequest)
    } catch (e) {    console.log(e)    return await fetch(request)    }    }    return await fetch(request)  },};

## 2. View the user's identity

The script in index.js uses the get-identity endpoint to fetch a user's complete identity from a Cloudflare Access authentication event. To view a list of available data fields, log in to your Access application and append /cdn-cgi/access/get-identity to the URL. For example, if www.example.com is behind Access, go to https://www.example.com/cdn-cgi/access/get-identity.

Below is an example of a user identity that includes the disk_encryption and firewall posture checks. The Worker inserts the posture check results into the request headers Cf-Access-Firewall-Activated and Cf-Access-Disk-Encrypted.

Example user identity ```
{  "id": "P51Tuu01fWHMBjIBvrCK1lK-eUDWs2aQMv03WDqT5oY",  "name": "John Doe",  "email": "john.doe@cloudflare.com",  "amr": [    "pwd"  ],  "oidc_fields": {    "principalName": "XXXXXX_cloudflare.com#EXT#@XXXXXXcloudflare.onmicrosoft.com"  },  "groups": [    {      "id": "fdaedb59-e9be-4ab7-8001-3e069da54185",      "name": "XXXXX"    }  ],  "idp": {    "id": "b9f4d68e-dac1-48b0-b728-ae05a5f0d4b2",    "type": "azureAD"  },  "geo": {    "country": "FR"  },  "user_uuid": "ce40d564-c72f-475f-a9b8-f395f19ad986",  "account_id": "121287a0c6e6260ec930655e6b39a3a8",  "iat": 1724056537,  "devicePosture": {    "f6f9391e-6776-4878-9c60-0cc807dc7dc8": {      "id": "f6f9391e-6776-4878-9c60-0cc807dc7dc8",      "schedule": "5m",      "timestamp": "2024-08-19T08:31:59.274Z",      "description": "",      "type": "disk_encryption",      "check": {        "drives": {          "C": {            "encrypted": true          }        }      },      "success": false,      "rule_name": "Disk Encryption - Windows",      "input": {        "requireAll": true,        "checkDisks": []    },    "a0a8e83d-be75-4aa6-bfa0-5791da6e9186": {      "id": "a0a8e83d-be75-4aa6-bfa0-5791da6e9186",      "schedule": "5m",      "timestamp": "2024-08-19T08:31:59.274Z",      "description": "",      "type": "firewall",      "check": {        "firewall": false      },      "success": false,      "rule_name": "Local Firewall Check - Windows",      "input": {        "enabled": true      }    }    ...  }
```

## 3. Route the Worker to your application

In the Wrangler configuration file, set up a route that maps the Worker to your Access application domain:

- wrangler.jsonc
- wrangler.toml

```
{  "route": {    "pattern": "app.example.com/*",    "zone_name": "example.com"  }}
```

```
route = { pattern= "app.example.com/*", zone_name="example.com"}
```

## 4. Deploy the Worker

Terminal window ```
npx wrangler deploy
```

The Worker will now insert the Cf-Access-Firewall-Activated and Cf-Access-Disk-Encrypted headers into requests that pass your application's Access policies.

Example request headers ```
{  "headers": {    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",    "Accept-Encoding": "gzip",    "Accept-Language": "en-US,en;q=0.9,fr-FR;q=0.8,fr;q=0.7,en-GB;q=0.6",    "Cf-Access-Authenticated-User-Email": "John.Doe@cloudflare.com",    "Cf-Access-Disk-Encrypted": "false",    "Cf-Access-Firewall-Activated": "false",    "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"  }}
```

You can verify that these headers are received by the origin server.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Use virtual networks to change user egress IPs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/user-selectable-egress-ips/](https://developers.cloudflare.com/cloudflare-one/tutorials/user-selectable-egress-ips/)

Page options # Use virtual networks to change user egress IPs

Last reviewed: over 1 year ago Note

Only available on Enterprise plans.

This tutorial gives administrators an easy way to allow their users to change their egress IP address between any of your assigned dedicated egress IP addresses. Your users can choose which egress IP to use by switching virtual networks directly from in the WARP client.

Changing egress IPs can be useful in quality assurance (QA) and other similar scenarios in which users both use their local egress location and either switch to or simulate other remote locations.

## Before you begin

Make sure you have:

- Deployed the WARP client on your users' devices.
- Configured tunnels to connect your private network to Cloudflare. This tutorial assumes you have:

Created two tunnels through the dashboard.
Routed 10.0.0.0/8 through one tunnel.
Routed 192.168.88.0/24 through the other tunnel.
- Created two tunnels through the dashboard.
- Routed 10.0.0.0/8 through one tunnel.
- Routed 192.168.88.0/24 through the other tunnel.
- Received multiple dedicated egress IP addresses.

## Create a virtual network for each egress route

First, create virtual networks corresponding to your dedicated egress IPs.

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Settings > WARP Client.
2. In Network locations, go to Virtual networks and select Manage.
3. Select Create virtual network.
4. Name your virtual network. We recommend using a name related to the location of the corresponding dedicated egress IP. For example, if your users will egress from the Americas, you can name the virtual network vnet-AMER.
5. Select Save.
6. Repeat Steps 3-5 for each dedicated egress IP you want users to switch between. For example, you can create another virtual network called vnet-EMEA for egress from Europe, the Middle East, and Africa.

1. Create a virtual network corresponding to one of your dedicated egress IPs. We recommend using a name related to the location of the corresponding dedicated egress IP. For example, if your users will egress from the Americas, you can name the virtual network vnet-AMER.
 Required API token permissions
 
At least one of the following token permissions 
is required:
Cloudflare One Networks WriteCloudflare Tunnel Write Create a virtual networkcurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/teamnet/virtual_networks" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "comment": "Virtual network to egress from the Americas",    "is_default": false,    "name": "vnet-AMER"  }'
For more information, refer to Create a virtual network.
2. Cloudflare One Networks Write
3. Cloudflare Tunnel Write
4. Repeat Step 1 for each dedicated egress IP you want users to switch between. For example, you can create another virtual network called vnet-EMEA for egress from Europe, the Middle East, and Africa.

## Assign each virtual network to each tunnel

After creating your virtual networks, route your private network CIDRs over each virtual network. This ensures that users can reach all services on your network regardless of which egress IP they use.

- Dashboard
- API

1. Go to Networks > Tunnels.
2. Select your tunnel routing 10.0.0.0/8, then select Configure.
3. Go to Private Network. Select the 10.0.0.0/8 route.
4. In Additional settings, choose your first virtual network. For example, vnet-AMER.
5. Select Save private network.
6. To route 10.0.0.0/8 over another virtual network, select Add a private network.
7. In CIDR, enter 10.0.0.0/8. In Additional settings, choose your second virtual network. For example, vnet-EMEA.
8. Select Save private network.
9. Repeat Steps 6-8 for each virtual network you created.
10. Return to Networks > Tunnels. Repeat Steps 2-9 for each private network tunnel route.

1. Assign your first virtual network to your private network route. For example, assign vnet-AMER to your tunnel that routes 10.0.0.0/8:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Cloudflare One Networks WriteCloudflare Tunnel Write Update a tunnel routecurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/teamnet/routes/$ROUTE_ID" \  --request PATCH \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "network": "10.0.0.0/8",    "tunnel_id": "<TUNNEL_UUID>",    "virtual_network_id": "<VNET_AMER_UUID>"  }'
For more information, refer to Update a tunnel route.
2. Cloudflare One Networks Write
3. Cloudflare Tunnel Write
4. Repeat this process for each virtual network you created. For example:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Cloudflare One Networks WriteCloudflare Tunnel Write Update a tunnel routecurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/teamnet/routes/$ROUTE_ID" \  --request PATCH \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "network": "10.0.0.0/8",    "tunnel_id": "<TUNNEL_UUID>",    "virtual_network_id": "<VNET_EMEA_UUID>"  }'
5. Cloudflare One Networks Write
6. Cloudflare Tunnel Write
7. Repeat Steps 1-2 for each private network tunnel route.

Each tunnel connected to your private network should have each of your virtual networks assigned to it. For example, if you have tunnels routing 10.0.0.0/8 and 192.168.88.0/24, both tunnels should have the vnet-AMER and vnet-EMEA virtual networks assigned.

| Tunnel | CIDR | Virtual network |
| --- | --- | --- |
| Tunnel 1 | 10.0.0.0/8 | vnet-AMER |
|  | 10.0.0.0/8 | vnet-EMEA |
| Tunnel 2 | 192.168.88.0/24 | vnet-AMER |
|  | 192.168.88.0/24 | vnet-EMEA |

## Create virtual network egress policies

Next, assign your dedicated egress IPs to each virtual network using Gateway egress policies.

- Dashboard
- API

1. In Zero Trust ‚Üó, go to Gateway > Egress policies.
2. Select Add a policy.
3. Name your policy. We recommend including the country or region traffic will egress from.
4. Add the virtual network with the Virtual Network selector. For example:















SelectorOperatorValueVirtual Networkisvnet-AMER
5. In Select an egress IP, choose Use dedicated Cloudflare egress IPs. Choose the dedicated IPv4 and IPv6 addresses you want traffic to egress with.
6. Select Create policy.
7. Repeat Steps 1-6 to create a separate egress policy for each virtual network you created.

1. Add a Gateway egress policy that matches the corresponding virtual network. For example:
 Required API token permissions
 
At least one of the following token permissions 
is required:
Zero Trust Write Create a Zero Trust Gateway rulecurl "https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/gateway/rules" \  --request POST \  --header "Authorization: Bearer $CLOUDFLARE_API_TOKEN" \  --json '{    "action": "egress",    "description": "Egress via North America by connecting to vnet-AMER",    "enabled": true,    "filters": [        "egress"    ],    "name": "Egress AMER vnet",    "precedence": 0,    "traffic": "net.vnet_id == <VNET_AMER_UUID>",    "rule_settings": {        "egress": {            "ipv4": "<DEDICATED_IPV4_ADDRESS>",            "ipv4_fallback": "<SECONDARY_DEDICATED_IPV6_ADDRESS>",            "ipv6": "<DEDICATED_IPV6_ADDRESS>"        }    }  }'
For more information, refer to Create a Zero Trust Gateway rule.
2. Zero Trust Write
3. Repeat Step 1 to create an egress policy for each virtual network you created.

Each policy you create should correspond to a different primary dedicated egress IP.

## Test virtual network egress

Windows, macOS, and Linux

1. On your user's device, log in to your Zero Trust organization in the WARP client.
2. In a terminal, run the following command to check the default egress IP address.
Terminal windowcurl ifconfig.me -4
The command should output your organization's default egress IP.
3. In the WARP client, select the gear icon > Virtual Networks. Choose a virtual network you created.
4. Check the egress IP address by running curl ifconfig.me -4 again. The command should output the IP address specified in your egress policy.

iOS and Android

1. On your user's device, log in to your Zero Trust organization in the Cloudflare One Agent app.
2. In a browser, go to ifconfig.me ‚Üó. Your organization's default egress IP should appear in IP Address.
3. In Cloudflare One Agent, go to Advanced > Connection options > Virtual networks. Choose a virtual network you created.
4. Check the egress IP address by reloading the browser page from Step 1. The IP address specified in your egress policy should appear in IP Address.

While your users are connected to a virtual network, their traffic will route via the dedicated egress IP specified. You can repeat these steps to test that each virtual network is egressing from the correct IP.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Access and secure a MySQL database using Cloudflare Tunnel and network policies

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/mysql-network-policy/](https://developers.cloudflare.com/cloudflare-one/tutorials/mysql-network-policy/)

Page options # Access and secure a MySQL database using Cloudflare Tunnel and network policies

Last reviewed: over 1 year ago Using Cloudflare Tunnel's private networks, users can connect to arbitrary non-browser based TCP/UDP applications, like databases. You can set up network policies that implement zero trust controls to define who and what can access those applications using the WARP client.

By the end of this tutorial, users that pass network policies will be able to access a remote MySQL database available through a Cloudflare Tunnel on TCP port 3306.

## Before you begin

Make sure you have:

- A MySQL database listening for remote connections and configured with users that can connect remotely
- (Optional)Resolver policies enabled on your account

## Create a Cloudflare Tunnel

Install cloudflared on a server in your private network. This server should have connectivity to the MySQL database.

1. Log in to Zero Trust ‚Üó and go to Networks > Tunnels.
2. Select Create a tunnel.
3. Choose Cloudflared for the connector type and select Next.
4. Enter a name for your tunnel. We suggest choosing a name that reflects the type of resources you want to connect through this tunnel (for example, enterprise-VPC-01).
5. Select Save tunnel.
6. Next, you will need to install cloudflared and run it. To do so, check that the environment under Choose an environment reflects the operating system on your machine, then copy the command in the box below and paste it into a terminal window. Run the command.
7. Once the command has finished running, your connector will appear in Zero Trust.
8. Select Next.

## Add private network routes

1. In the Private Networks tab, add the following IP addresses:

- Private IP/CIDR of your MySQL server (for example, 10.128.0.175/32)
- (Optional) Private IP/CIDR of your internal DNS server

1. Select Save tunnel.

The application and (optional) DNS server are now connected to Cloudflare.

## Create a Gateway network policy

1. Go to Gateway > Firewall policies > Network.
2. Add a network policy that targets the private IP address and the port of the MySQL database (port 3306 by default). The following example allows access to the database to the users that enrolled into WARP using an @example.com email address. The network policies can also take into consideration device posture checks.

| Selector | Operator | Value | Logic | Action |
| --- | --- | --- | --- | --- |
| Destination IP | in | 10.128.0.175 | And | Allow |
| Destination Port | in | 3306 | And |  |
| User Email | matches regex | .*example.com |  |  |

In addition to the Allow rule above, Cloudflare recommends adding a catch-all block policy to the bottom of your network policy list to enforce a default-deny model.

Allowed WARP users can now connect to the MySQL server at 10.128.0.175 using the MySQL client of their choice.

## (Optional) Create a Gateway resolver policy

To allow users to access the MySQL database using an internal hostname instead of the private IP address, configure a Gateway resolver policy.

1. Go to Gateway > Resolver policies.
2. Select Add a policy.
3. Create an expression to match against the private domain or hostname of the application, like in the following example:















SelectorOperatorValueDomainininternalrecord.com
4. In Select DNS resolver, select Configure custom DNS resolvers.
5. Enter the private IP address of your DNS server.
6. In the dropdown menu, select <IP-address> - Private.
7. (Optional) Enter a custom port.
8. Select Create policy.

If your internal DNS server has an A record for the MySQL database, users can connect to the server using this record. For example, assuming a BIND server that includes the entry:

mysql IN  A  10.128.0.175

Allowed WARP users can connect to the MySQL database at mysql.internalrecord.com using the MySQL client of their choice.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Access a web application via its private hostname without WARP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/clientless-access-private-dns/](https://developers.cloudflare.com/cloudflare-one/tutorials/clientless-access-private-dns/)

Page options # Access a web application via its private hostname without WARP

Last reviewed: over 1 year ago With Cloudflare Browser Isolation and resolver policies, users can connect to private web-based applications via their private hostnames without needing to install the WARP client. By the end of this tutorial, users who pass your Gateway DNS and network policies will be able to access your private application at https://<your-team-name>.cloudflareaccess.com/browser/https://internalrecord.com.

## Before you begin

Make sure you have:

- Cloudflare Browser Isolation enabled on your account
- Resolver policies enabled on your account
- An HTTP or HTTPS application that users access through a browser

## Create a Cloudflare Tunnel

First, install cloudflared on a server in your private network:

1. Log in to Zero Trust ‚Üó and go to Networks > Tunnels.
2. Select Create a tunnel.
3. Choose Cloudflared for the connector type and select Next.
4. Enter a name for your tunnel. We suggest choosing a name that reflects the type of resources you want to connect through this tunnel (for example, enterprise-VPC-01).
5. Select Save tunnel.
6. Next, you will need to install cloudflared and run it. To do so, check that the environment under Choose an environment reflects the operating system on your machine, then copy the command in the box below and paste it into a terminal window. Run the command.
7. Once the command has finished running, your connector will appear in Zero Trust.
8. Select Next.

## Add private network routes

1. In the Private Networks tab, add the following IP addresses:

Private IP/CIDR of your application server (for example, 10.128.0.175/32)
Private IP/CIDR of your DNS server
2. Private IP/CIDR of your application server (for example, 10.128.0.175/32)
3. Private IP/CIDR of your DNS server
4. Select Save tunnel.

The application and DNS server are now connected to Cloudflare.

## Enable Clientless Web Isolation

1. In Zero Trust ‚Üó, go to Settings > Browser Isolation.
2. Enable Clientless Web Isolation.

1. For Permissions, select Manage.
2. Select Add a rule.
3. Create an expression that defines who can open the Clientless Web Isolation browser. For example,



















Rule actionRule typeSelectorValueActionAllowIncludeEmails ending in@example.comSelect Save.

To test, open a browser and go to https://<team-name>.cloudflareaccess.com/browser/https://<private-IP-of-application>.

## Create a Gateway resolver policy

1. Go to Gateway > Resolver policies.
2. Select Add a policy.
3. Create an expression to match against the private domain or hostname of the application:















SelectorOperatorValueDomainininternalrecord.com
4. In Select DNS resolver, select Configure custom DNS resolvers.
5. Enter the private IP address of your DNS server.
6. In the dropdown menu, select <IP-address> - Private.
7. (Optional) Enter a custom port.
8. Select Create policy.

To test, open a browser and go to https://<team-name>.cloudflareaccess.com/browser/https://internalrecord.com.

## Create a Gateway network policy (recommended)

1. Go to Gateway > Firewall policies > Network.
2. Add a network policy that targets the private IP address of your application. You can optionally include any ports or protocols relevant for application access. For example,

































SelectorOperatorValueLogicActionDestination IPin10.128.0.175AndAllowDestination Portin80OrUser Emailmatches regex.*example.com

Note

Device posture checks are not supported because they require the WARP client.

For best practices on securing private applications, refer to Build secure access policies.

## Connect as a user

Users can now access the application at the following URL:

https://<team-name>.cloudflareaccess.com/browser/https://internalrecord.com

The application will load in an isolated browser. You can optionally configure remote browser controls such as disabling copy/paste, printing, or keyboard input.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Protect access to Microsoft 365 with dedicated egress IPs

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/m365-dedicated-egress-ips/](https://developers.cloudflare.com/cloudflare-one/tutorials/m365-dedicated-egress-ips/)

Page options # Protect access to Microsoft 365 with dedicated egress IPs

Last reviewed: over 1 year ago Note

Only available on Zero Trust Enterprise plans.

This tutorial covers how to secure access to your Microsoft 365 applications with Cloudflare Gateway dedicated egress IPs.

You can map a named location in Microsoft Entra ID to a location associated with your dedicated egress IPs. Traffic will egress from Cloudflare with these IP addresses. If users attempt to access your Microsoft applications without these IPs, Entra ID will block access.

## Before you begin

Make sure you have:

- In Cloudflare, a Zero Trust Enterprise plan with dedicated egress IPs
- In Microsoft 365, an organization managed with Microsoft Entra ID ‚Üó

## Create an egress policy in Cloudflare Gateway

1. In Zero Trust ‚Üó, go to Gateway > Egress policies.
2. Select Add a policy.
3. Name your policy, then add conditions to check users are configured in Microsoft Entra ID. For example, you can check for identity conditions:















SelectorOperatorValueUser Group NamesinSales and Marketing, Retail, U.S. Sales
Additionally, you can check for device posture conditions:























SelectorOperatorValueLogicPassed Device Posture CheckisCrowdStrike Overall ZTA score (Crowdstrike s2s)AndPassed Device Posture CheckisAppCheckMac - Required Software (Application)
4. Enable Use dedicated Cloudflare egress IPs. Select your desired IPv4 and IPv6 addresses. For example:













Primary IPv4 addressIPv6 address203.0.113.02001:db8::/32

## Create a named IP range location in Microsoft Entra ID

1. Log in to the Microsoft Azure portal ‚Üó.
2. In the sidebar, select Microsoft Entra ID.
3. Go to Security > Named locations.
4. Select IP ranges location.
5. Name your location, then add the IP addresses used in your Cloudflare dedicated egress IP policy.
6. Select Upload.

This named location corresponds with the locations of your dedicated egress IPs.

## Create a conditional access policy in Microsoft Entra ID

1. In Protect, go to Conditional Access.
2. Select Create new policy.
3. Configure which Entra ID users you want to limit access for, and which traffic, applications, or actions you want to protect.
4. In Conditions, select Locations. Enable Configure.
5. In Include, select Any location. In Exclude, select the named location you created.
6. In Access controls, go to Grant. Enable Block access.

Your policy will block access for your selected users from any location except those using your dedicated egress IPs.

## Test your policies

1. Using WARP, sign in to your Zero Trust organization with a user's account.
2. Go to any Microsoft 365 app within your organization. Entra ID should allow access.
3. Disconnect WARP from your Zero Trust organization. Entra ID should block access to any Microsoft 365 applications.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Use Cloudflare R2 as a Zero Trust log destination

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/r2-logs/](https://developers.cloudflare.com/cloudflare-one/tutorials/r2-logs/)

Page options # Use Cloudflare R2 as a Zero Trust log destination

Last reviewed: almost 2 years ago Note

Only available on Zero Trust Enterprise plans.

This tutorial covers how to build a Cloudflare R2 bucket to store logs, and how to connect the bucket to the Zero Trust Logpush service to store logs persistently and export them into other tools.

## Before you begin

- Ensure Cloudflare R2 and the Zero Trust Logpush integration are included in your plan. For more information, contact your account team.

## Create a Cloudflare R2 bucket

1. In the Cloudflare dashboard ‚Üó, go to the R2 Overview page.
  Go to R2 object storage
2. Select Create bucket.
3. Enter an identifiable name for the bucket, then select Create bucket.

## Create an R2 API token

1. Return to R2, then select Manage R2 API tokens.
2. Select Create API token.
3. In Permissions, select Object Read & Write.
4. In Specify bucket(s), choose Apply to specific buckets only. Select the bucket you created.
5. Configure other token settings to your preferences.
6. Select Create API Token.
7. Copy the Access Key ID, Secret Access Key, and endpoint URL values. You will not be able to access these values again.
8. Select Finish.

## Connect a Zero Trust Logpush job

1. In Zero Trust ‚Üó, go to Logs > Logpush.
2. Select Connect a service.
3. Choose which data sets and fields you want to send to your bucket. Select Next.
4. Select S3 Compatible.
5. In S3 Compatible Bucket Path, enter the name of your bucket.
6. In Bucket region, enter auto.
7. Enter the values for Access Key ID, Secret Access Key, and Endpoint URL in their corresponding fields.
8. Select Push. If prompted, you do not need to prove ownership with a token challenge.

The Logpush job will send the selected Zero Trust logs to your R2 bucket.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Create custom headers for Cloudflare Access-protected origins with Workers

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/access-workers/](https://developers.cloudflare.com/cloudflare-one/tutorials/access-workers/)

Page options # Create custom headers for Cloudflare Access-protected origins with Workers

Last reviewed: almost 2 years ago This tutorial covers how to use a Cloudflare Worker to add custom HTTP headers to traffic, and how to send those custom headers to your origin services protected by Cloudflare Access.

Some applications and networking implementations require specific custom headers to be passed to the origin, which can be difficult to implement for traffic moving through a Zero Trust proxy. You can configure a Worker to send the user authorization headers required by Access.

## Before you begin

- Secure your origin server with Cloudflare Access

## Before you begin

1. In the Cloudflare dashboard ‚Üó, go to the Workers & Pages page.
  Go to Compute (Workers)
2. If this is your first Worker, select Create Worker. Otherwise, select Create application, then select Create Worker.
3. Enter an identifiable name for the Worker, then select Deploy.
4. Select Edit code.
5. Input the following Worker:

- JavaScript
- TypeScript

```
export default {  async fetch(request, env, ctx) {    const { headers } = request;    const cfaccessemail = headers.get("cf-access-authenticated-user-email");
    const requestWithID = new Request(request);    requestWithID.headers.set("company-user-id", cfaccessemail);
    return fetch(requestWithID);  },};
```

```
export default {  async fetch(request, env, ctx): Promise<Response> {    const { headers } = request;    const cfaccessemail = headers.get("cf-access-authenticated-user-email");
    const requestWithID = new Request(request);    requestWithID.headers.set('company-user-id', cfaccessemail);
    return fetch(requestWithID);  },} satisfies ExportedHandler<Env>;
```

1. Select Save and deploy.

Your Worker is now ready to send custom headers to your Access-protected origin services.

## Apply the Worker to your hostname

1. Select the Worker you created, then go to Triggers.
2. In Routes, select Add route.
3. Enter the hostname and zone for your origin, then select Add route.

The Worker will now insert a custom header into requests that match the defined route. For example:

Example custom header ```
"Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",    "Accept-Encoding": "gzip",    "Accept-Language": "en-US,en;q=0.9",    "Cf-Access-Authenticated-User-Email": "user@example.com",    "Company-User-Id": "user@example.com",    "Connection": "keep-alive"
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Protect access to Amazon S3 buckets with Cloudflare Zero Trust

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/s3-buckets/](https://developers.cloudflare.com/cloudflare-one/tutorials/s3-buckets/)

Page options # Protect access to Amazon S3 buckets with Cloudflare Zero Trust

Last reviewed: almost 2 years ago This tutorial demonstrates how to secure access to Amazon S3 buckets with Cloudflare Zero Trust so that data in these buckets is not publicly exposed on the Internet. You can combine Cloudflare Access and AWS VPC endpoints. Enterprise may also use Cloudflare Gateway egress policies with dedicated egress IPs.

## Method 1: Via Cloudflare Access and VPC endpoints

```
flowchart TB
    cf1[/Agentless and WARP </br>Zero Trust users/]--Access policy-->cf2{{Cloudflare}}
    cf2--Cloudflare Tunnel-->vpc1

    subgraph VPC
    vpc1[EC2 VM]-->vpc2[VPC endpoint]
    end
    vpc2-->s3_1

    subgraph S3 service
    s3_1([S3 bucket])
    end

    i1[/Users outside </br> Zero Trust/]-. "S3 access denied" .->s3_1
```

### Prerequisites

- S3 bucket to be protected by Cloudflare Zero Trust
- AWS VPC with one EC2 virtual machine (VM) hosting the Cloudflare Tunnel daemon
- S3 bucket and AWS VPC configured in the same AWS region ‚Üó

### 1. Create a VPC endpoint in AWS

1. In the AWS dashboard ‚Üó, go to Services > Networking & Content Delivery > VPC.
2. Under Virtual private cloud, go to Endpoints.
3. Select Create endpoint and name the endpoint.
4. Choose AWS services as the service category.
5. In Services, search and select the S3 service in the same region of the VPC. For example, for the AWS region Europe (London) - eu-west-2, the corresponding S3 service is named com.amazonaws.eu-west-2.s3 with a type of Gateway.
6. In VPC, select your VPC that contains the EC2 VM hosting the Cloudflare tunnel daemon.
7. In Route tables, select the route table associated with the VPC.
8. In Policy, choose Full access.
9. Select Create endpoint.

After you create the VPC endpoint, a new entry in the VPC route table with the target being your VPC endpoint. The entry will have the format vpce-xxxxxxxxxxxxxxxxx.

### 2. Set up a bucket policy for VPC access

1. Go to Services > Storage > S3.
2. In Amazon S3, go to Buckets > <your-S3-bucket> > Permissions.
3. Disable Block all public access.
4. In Bucket policy, add the following policy:

```
{  "Version": "2012-10-17",  "Id": "VPCe",  "Statement": [    {      "Sid": "VPCe",      "Effect": "Allow",      "Principal": "*",      "Action": "s3:*",      "Resource": [        "arn:aws:s3:::<your-S3-bucket01>",        "arn:aws:s3:::<your-S3-bucket01>/*"      ],      "Condition": {        "StringEquals": {          "aws:SourceVpce": "<your-vpc-endpoint>"        }      }    }  ]}
```

Your bucket policy will allow your VPC to access your S3 bucket.

### 3. Enable static website hosting for the S3 bucket

1. Return to Amazon S3, then go to Buckets > <your-S3-bucket01> > Properties.
2. In Static website hosting, select Edit.
3. Enable Static website hosting.
4. Specify the Index and Error documents for the S3 bucket.
5. Select Save changes.

A bucket website endpoint will be available at http://<your-S3-bucket01>.s3-website.<aws-region>.amazonaws.com. Because of the bucket policy, this website endpoint will only be accessible from the VPC with the VPC endpoint configured.

### 4. Add a new public hostname to the Cloudflare Tunnel

1. In Zero Trust ‚Üó, go to Networks > Tunnels
2. Select your Tunnel, then select Configure.
3. Go to Public Hostname, then select Add a public hostname.
4. Enter a subdomain your organization will use to access the S3 bucket. For example, s3-bucket.<your-domain>.com.
5. Under Service, choose HTTP for Type. In URL, enter <your-S3-bucket01>.s3-website.<aws-region>.amazonaws.com.
6. In Additional application settings > HTTP Settings, input the HTTP Host Header as <your-S3-bucket01>.s3-website.<aws-region>.amazonaws.com.
7. Select Save hostname.

Your Cloudflare Tunnel will terminate at the AWS VPC using your public hostname.

### 5. Restrict S3 access with an Access policy

1. Go to Access > Applications.
2. Select Add an application.
3. Select Self-hosted.
4. Enter a name for the application.
5. Select Add public hostname and enter the public hostname used by your Tunnel. For example, s3-bucket.<your-domain>.com.
6. Add Access policies to determine which users and applications may access your bucket. You can optionally create a service token policy to automatically authenticate access to your S3 bucket.
7. Follow the remaining self-hosted application creation steps to publish the application.

Users and applications that successfully authenticate via Cloudflare Access can access your S3 bucket at https://s3-bucket.<your-domain>.com.

## Method 2: Via Cloudflare Gateway egress policies

Note

This method is only available on Enterprise plans.

```
flowchart TB
    cf1[/WARP users/]--Egress policy-->cf2{{Cloudflare}}
    cf2--Egress with dedicated IP-->i1[Internet]
    i1-->s3_1

    subgraph S3 Service
    s3_1([S3 bucket])
    end

    i2[/Users outside </br> Zero Trust/]-. "IPs denied" .->s3_1
```

### Prerequisites

- Cloudflare Zero Trust account with dedicated egress IPs
- S3 bucket to be protected by Cloudflare Zero Trust

### 1. Set up a bucket policy to restrict access to a specific IP address

1. In the AWS dashboard ‚Üó, go to Services > Storage > S3.
2. Go to Buckets > <your-S3-bucket02> > Permissions.
3. Disable Block all public access.
4. In Bucket policy, add the following policy:

```
{  "Version": "2012-10-17",  "Id": "SourceIP",  "Statement": [    {      "Sid": "SourceIP",      "Effect": "Allow",      "Principal": "*",      "Action": "s3:*",      "Resource": [        "arn:aws:s3:::<your-S3-bucket02>",        "arn:aws:s3:::<your-S3-bucket02>/*"      ],      "Condition": {        "IpAddress": {          "aws:SourceIp": "<your-dedicated-ip>/32"        }      }    }  ]}
```

### 2. Enable static website hosting for the S3 bucket

1. Return to your bucket, then go to Properties.
2. In Static website hosting, select Edit.
3. Enable Static website hosting.
4. Specify the Index and Error documents for the S3 bucket.
5. Select Save changes.

A bucket website endpoint will be available at http://<your-S3-bucket02>.s3-website.<aws-region>.amazonaws.com. Because of the bucket policy, the website endpoint will only be accessible to traffic sourced from the dedicated egress IP specified.

### 3. Setup a dedicated egress IP policy

1. In Zero Trust ‚Üó, go to Gateway > Egress policies. Select Add a policy.
2. Create a policy that specifies which proxied traffic Gateway should assign a dedicated egress IP to. For more information, refer to Egress policies.
3. In Select an egress IP, choose Use dedicated Cloudflare egress IPs. Select the dedicated egress IP defined in your bucket policy.
4. Select Create policy.

Traffic proxied by Gateway and assigned your specified egress IP can access your S3 bucket at http://<your-S3-bucket02>.s3-website.<aws-region>.amazonaws.com.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Validate the Access token with FastAPI

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/fastapi/](https://developers.cloudflare.com/cloudflare-one/tutorials/fastapi/)

Page options # Validate the Access token with FastAPI

Last reviewed: about 2 years ago This tutorial covers how to validate that the Access JWT is on requests made to FastAPI apps.

Time to complete: 15 minutes

## Prerequisites

- A self-hosted Access application for your FastAPI app
- The AUD tag for your Access application

## 1. Create a validation function

1. In your FastAPI project, create a new file called cloudflare.py that contains the following code:

```
from fastapi import Request, HTTPException
# The Application Audience (AUD) tag for your applicationPOLICY_AUD = "XXXXX"
# Your CF Access team domainTEAM_DOMAIN = "https://<your-team-name>.cloudflareaccess.com"CERTS_URL = "{}/cdn-cgi/access/certs".format(TEAM_DOMAIN)
async def validate_cloudflare(request: Request):    """    Validate that the request is authenticated by Cloudflare Access.    """    if verify_token(request) != True:        raise HTTPException(status_code=400, detail="Not authenticated properly!")

def _get_public_keys():    """    Returns:        List of RSA public keys usable by PyJWT.    """    r = requests.get(CERTS_URL)    public_keys = []    jwk_set = r.json()    for key_dict in jwk_set["keys"]:        public_key = jwt.algorithms.RSAAlgorithm.from_jwk(json.dumps(key_dict))        public_keys.append(public_key)    return public_keys

def verify_token(request):    """    Verify the token in the request.    """    token = ""
    if "CF_Authorization" in request.cookies:        token = request.cookies["CF_Authorization"]    else:        raise HTTPException(status_code=400, detail="missing required cf authorization token")
    keys = _get_public_keys()
    # Loop through the keys since we can't pass the key set to the decoder    valid_token = False    for key in keys:        try:            # decode returns the claims that has the email when needed            jwt.decode(token, key=key, audience=POLICY_AUD, algorithms=["RS256"])            valid_token = True            break        except:            raise HTTPException(status_code=400, detail="Error decoding token")    if not valid_token:        raise HTTPException(status_code=400, detail="Invalid token")
    return True
```

## 2. Use the validation function in your app

You can now add the validation function as a dependency in your FastAPI app. One way to do this is by creating an APIRouter instance ‚Üó. The following example executes the validation function on each request made to paths that start with /admin:

```
from fastapi import APIRouter, Depends, HTTPExceptionfrom cloudflare import validate_cloudflare
router = APIRouter(    prefix="/admin",    tags=["admin"],    dependencies=[Depends(validate_cloudflare)]    responses={404: {"description": "Not found"}},)
@router.get("/")async def root():    return {"message": "Hello World"}
```

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Isolate risky Entra ID users

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/entra-id-risky-users/](https://developers.cloudflare.com/cloudflare-one/tutorials/entra-id-risky-users/)

Page options # Isolate risky Entra ID users

Last reviewed: over 2 years ago Microsoft Entra ID (formerly Azure Active Directory) calculates a user's risk level ‚Üó based on the probability that their account has been compromised. With Cloudflare Zero Trust, you can synchronize the Entra ID risky users list with Cloudflare Access and apply more stringent Zero Trust policies to users at higher risk.

This tutorial demonstrates how to automatically redirect users to a remote browser when they are deemed risky by Entra ID.

Time to complete:

1 hour

## Prerequisites

- Microsoft Entra ID Premium P2 license
- Cloudflare Browser Isolation add-on
- Gateway HTTP filtering enabled on your devices
- npm ‚Üó installation
- Node.js ‚Üó installation

## 1. Set up Entra ID as an identity provider

Refer to our IdP setup instructions for Entra ID.

Note

- When you configure the IdP in Zero Trust, be sure to select Enable group membership change reauthentication.
- Save the Application (client) ID, Directory (tenant) ID, and Client secret as you will need them again in a later step.

## 2. Add Entra ID API permissions

Once the base IdP integration is tested and working, enable additional permissions that will allow a script to create and update risky user groups in Entra ID:

1. In Microsoft Entra ID, go to App registrations.
2. Select the application you created for the IdP integration.
3. Go to API permissions and select Add a permission.
4. Select Microsoft Graph.
5. Select Application permissions and add the following permissions ‚Üó:

IdentityRiskyUser.ReadAll
Directory.ReadWriteAll
Group.Create
Group.ReadAll
GroupMember.ReadAll
GroupMember.ReadWriteAll
6. IdentityRiskyUser.ReadAll
7. Directory.ReadWriteAll
8. Group.Create
9. Group.ReadAll
10. GroupMember.ReadAll
11. GroupMember.ReadWriteAll
12. Select Grant admin consent.

You will see the list of enabled permissions.

## 3. Add risky users to Entra ID group

Next, configure an automated script that will populate an Entra ID security group with risky users.

To get started quickly, deploy our example Cloudflare Workers script by following the step-by-step instructions below. Alternatively, you can implement the script using Azure Functions ‚Üó or any other tool.

1. Open a terminal and clone our example project.
Terminal windownpm create cloudflare@latest risky-users -- --template https://github.com/cloudflare/msft-risky-user-ad-sync
2. Go to the project directory.
Terminal windowcd risky-users
3. Modify the Wrangler configuration file to include the following values:

<ACCOUNT_ID>: your Cloudflare account ID.
<TENANT_ID>: your Entra ID Directory (tenant) ID, obtained when setting up Entra ID as an identity provider.
<CLIENT_ID>: your Entra ID Application (client) ID, obtained when setting up Entra ID as an identity provider.

      wrangler.jsonc     wrangler.toml        {  "name": "risky-users",  "compatibility_date": "2023-01-04",  "main": "src/index.js",  "workers_dev": false,  "account_id": "<ACCOUNT-ID>",  "vars": {    "AZURE_AD_TENANT_ID": "<TENANT-ID>",    "AZURE_AD_CLIENT_ID": "<CLIENT-ID>"  },  "triggers": {    "crons": [      "* * * * *"    ]  }}     name = "risky-users"compatibility_date = "2023-01-04"main = "src/index.js"workers_dev = false
account_id = "<ACCOUNT-ID>"
[vars]AZURE_AD_TENANT_ID = "<TENANT-ID>"AZURE_AD_CLIENT_ID = "<CLIENT-ID>"
[triggers]crons = ["* * * * *"]
4. <ACCOUNT_ID>: your Cloudflare account ID.
5. <TENANT_ID>: your Entra ID Directory (tenant) ID, obtained when setting up Entra ID as an identity provider.
6. <CLIENT_ID>: your Entra ID Application (client) ID, obtained when setting up Entra ID as an identity provider.
7. wrangler.jsonc
8. wrangler.toml

Note

The Cron Trigger in this example schedules the script to run every minute. Learn more about supported cron expressions.

1. Deploy the Worker to Cloudflare's global network.
Terminal windownpx wrangler deploy
2. Create a secret variable named AZURE_AD_CLIENT_SECRET.
Terminal windowwrangler secret put AZURE_AD_CLIENT_SECRET
You will be prompted to input the secret's value. Enter the Client secret obtained when setting up Microsoft Entra ID as an identity provider.

The Worker script will begin executing once per minute. To view realtime logs, run the following command and wait for the script to execute:

Terminal window ```
wrangler tail --format pretty
```

After the initial run, the auto-generated groups will appear in the Entra ID dashboard.

## 4. Synchronize risky user groups

Next, synchronize Entra ID risky user groups with Cloudflare Access:

1. Enable SCIM synchronization.
2. In Entra ID, assign the following groups to your SCIM enterprise application:

IdentityProtection-RiskyUser-RiskLevel-high
IdentityProtection-RiskyUser-RiskLevel-medium
IdentityProtection-RiskyUser-RiskLevel-low
3. IdentityProtection-RiskyUser-RiskLevel-high
4. IdentityProtection-RiskyUser-RiskLevel-medium
5. IdentityProtection-RiskyUser-RiskLevel-low

Cloudflare Access will now synchronize changes in group membership with Entra ID. You can verify the synchronization status on the SCIM application's Provisioning page.

## 5. Create a browser isolation policy

Finally, create a Gateway HTTP policy to isolate traffic for risky user groups.

1. In Zero Trust ‚Üó, go to Gateway > Firewall policies > HTTP.
2. Select Add a policy.
3. Build an Isolate policy that contains a User Group Names rule. For example, the following policy serves app1.example.com and app2.example.com in a remote browser for all members flagged as high risk:


























SelectorOperatorValueLogicActionDomaininapp1.example.com, app2.example.comAndIsolateUser Group NamesinIdentityProtection-RiskyUser-RiskLevel-high

To test the policy, refer to the Microsoft documentation for simulating risky detections ‚Üó.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Render a VNC client in browser

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/vnc-client-in-browser/](https://developers.cloudflare.com/cloudflare-one/tutorials/vnc-client-in-browser/)

Page options # Render a VNC client in browser

Last reviewed: about 3 years ago Cloudflare can render a Virtual Network Computer (VNC) terminal in your browser without any client software or configuration required.

Administrators can use Cloudflare Tunnel to connect a VNC host to Cloudflare's network. Using Cloudflare Access, you can apply Zero Trust policies to determine who can access your VNC server. Cloudflare's network will then enforce the Zero Trust policies and, when a user is allowed, render the client in the browser.

This walkthrough covers how to:

- Install and run a Cloudflare Tunnel on a Linux virtual machine
- Install and configure VNC on a Linux virtual machine
- Build a Zero Trust policy to determine who can reach the host
- Render the VNC server in your browser

Time to complete:

10 minutes

Note

There are a number of VNC versions, deployments, and instances. This tutorial focuses on configuring a Tight VNC server on an Azure hosted Linux virtual machine (VM). For help with other configurations, post your questions in our community ‚Üó.

## Before you start

1. Add a website to Cloudflare.
2. Enable Cloudflare Zero Trust on your account.
3. Connect your identity provider to Cloudflare Zero Trust.

## Configure VNC on your virtual machine

This section covers how to install a VNC server with TightVNC and the GNOME desktop environment. If you already have a VNC server installed, you can skip this step.

1. Open a terminal window for your VM.
2. To install the VNC software, run the following commands:
Terminal windowsudo apt-get update
sudo apt-get install gnome-core gnome-panel ubuntu-gnome-desktop tightvncserver
3. Once installed, you can create the VNC server instance with the following command:
Terminal windowsudo tightvncserver
4. Select a password for the VNC server. This password will be used during login for your browser VNC server.
5. Run the following command, which will take you to your VNC server configuration directory.
Terminal windowcd .vnc
6. Open your xstartup file.
Terminal windowvim xstartup
7. Update the file to the following configuration (this is for demonstration purposes ‚Äî browser-based VNC will work with most configurations):
xsetroot -solid greyx-terminal-emulator -geometry 80x24+10+10 -ls -title "$VNCDESKTOP Desktop" &#x-window-manager &
# Fix to make GNOME workexport XKL_XMODMAP_DISABLE=1/etc/X11/Xsession
#gnome-session &gnome-panel &nautilus &
8. To create your VNC server, run the following command:
Terminal windowvncserver

At this point, you have a VNC server ready to test with browser-based VNC. We recommend performing a brief test with an existing VNC browser to verify any missing packages or configuration changes that might need to be made before continuing. Once your VNC server appears as desired, continue with your setup.

## Configure Cloudflare Tunnel on your machine

1. Follow these instructions to install cloudflared.
2. Authenticate cloudflared with the command:
Terminal windowcloudflared tunnel login
3. Create a Tunnel with the command:
Terminal windowcloudflared tunnel create <NAME>
4. Create a Tunnel configuration file with the command:
Terminal windowvim config.yml
5. Add the following configuration to your configuration file.
tunnel: <NAME>ingress:- hostname: vnc.kennyatx.com  service: tcp://localhost:5901- service: http_status:404
As you do that, replace <HOSTNAME> with the domain you wish to use to expose your VNC server in the browser. Also, replace 5901 with the port your VNC server is running on. To get a list of ports, run sudo ss -lnpt and look for VNC to get the value that should be specified in your configuration file.
6. Route your Tunnel to your website.
7. Run your Tunnel:
Terminal windowcloudflared tunnel --config path/config.yaml run <NAME>
8. Follow this guide to open outbound connections for Cloudflare Tunnel if you have a firewall enabled.

At this point you have a running VNC server and a Cloudflare Tunnel on your machine ready to accept inbound VNC requests.

## Create a Zero Trust VNC application

The last step is to create a Zero Trust application to run your VNC server in the Browser.

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Select Self-hosted.
4. Enter any name for the application.
5. Select Add public hostname and set the domain to which you would like to expose the VNC server.
6. In Access policies, add an Allow or Block policy. For example policies, refer to the Access policies documentation.

Note

Service Auth and Bypass policies are not supported for browser-based VNC applications.

1. In Advanced settings, set Browser rendering to VNC.

Users will see a login screen with your configured identity providers. After successful authentication, they may be prompted to enter the VNC server's password.

You can define granular access controls across each individual VNC instance.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Integrate Microsoft MCAS with Cloudflare Zero Trust

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/integrate-microsoft-mcas-teams/](https://developers.cloudflare.com/cloudflare-one/tutorials/integrate-microsoft-mcas-teams/)

Page options # Integrate Microsoft MCAS with Cloudflare Zero Trust

Last reviewed: about 4 years ago Many security teams rely on Microsoft MCAS (Microsoft Cloud App Security), Microsoft's CASB solution, to identify and block threats on the Internet, as well as allow or block access to cloud applications. This tutorial covers how to integrate MCAS with Cloudflare Zero Trust, and create Gateway HTTP policies to ensure visibility and control over data.

Microsoft provides an MCAS API endpoint to allow queries to see which applications have been marked as blocked or allowed. With an MCAS API call, you can manage a URL category that contains the blocked URLs returned by the API query, and use the output to create a Hostname List that can be used by Gateway HTTP policies to block them.

Time to complete:

20 minutes

## Basic configuration

In your Microsoft account, you first need to create an API token and URL endpoint to use to query the URLs blocked by MCAS.
Follow the guide for Managing API tokens for Microsoft Cloud App Security ‚Üó to generate a new API token and a custom API URL for the API endpoint.

## Using the API to query banned applications

Once you have the API token and API URL, use curl to get the list of banned applications from Microsoft MCAS:

Terminal window ```
curl -v "https://<MCAS API URL>/api/discovery_block_scripts/?format=120&type=banned" -H "Authorization: Token <API token>"
```

This will return a list of banned hostnames. In this case, Angie's List is the banned application.

### Processing the output

As you can see, the banned hostnames are preceded by a .. To use this output for a Zero Trust List, we need to do some text processing.

1. Run the curl API call and direct the output to a file, in this case mcas.txt:
Terminal windowcurl -v "https://<MCAS API URL>/api/discovery_block_scripts/?format=120&type=banned" -H "Authorization: Token <API token>" > mcas.txt
2. Remove the leading ., for example by running sed from the CLI:
Terminal windowsed -i 's/^.//' mcas.txt
3. This will give you the list of hostnames without leading ..
4. Replace the file's .txt extension with .csv. The file can now be imported into Cloudflare Zero Trust as a Hostname list.

## Using the API to query allowed applications

If you would like to get a list of all of the MCAS allowed applications, you can use the same API query, but instead of using type=banned, use type=allowed. This will return a much larger list.

Terminal window ```
curl -v "https://<MCAS API URL>/api/discovery_block_scripts/?format=120&type=allowed" -H "Authorization: Token <API token>"
```

## Adding a hostname list in Zero Trust

1. In Zero Trust, go to My Team > Lists
2. Select Upload CSV. Even though the hostname list is not really in CSV format, it will work with no issues.
3. Add a name for the list, specify "Hostnames" as the list type, and give it a description.
4. Drag and drop your MCAS output file created via the API call, or you can select Select a file.
5. Select Create. You will see the list of hostnames that have been added to the list.
6. Save the list.

Your list is now ready to be referenced by Gateway HTTP policies.

## Creating an HTTP policy

1. Go to Gateway > Firewall policies. Select HTTP.
2. Select Add a policy.
3. Create the following policy.

















SelectorOperatorValueActionHostin list<NEW_HOSTNAME_LIST>Block

Now when trying to visit one of the MCAS defined sites, the user will be blocked.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Migrate to Named Tunnels with Load Balancer

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/migrate-lb-tunnel/](https://developers.cloudflare.com/cloudflare-one/tutorials/migrate-lb-tunnel/)

Page options # Migrate to Named Tunnels with Load Balancer

Last reviewed: over 4 years ago Cloudflare Tunnel is available in two deployment modes: "Legacy" Tunnel and "Named" Tunnel. Named Tunnel ‚Üó mode improves maintainability and stability by distinguishing between routing and configuration.

Unlike Legacy mode, Named Tunnels give users the ability to manage routing in the Cloudflare dashboard and to run cloudflared once for multiple services ‚Üó.

If you are using Legacy Tunnel today you can migrate to Named Tunnel deployment in less than 10 minutes.

This tutorial covers how to:

- Migrate a Legacy Tunnel deployment to Named Tunnel model
- Use Cloudflare Load Balancer to perform a zero downtime migration

Time to complete:

10 minutes

See additional documentation for working with Kubernetes.

## Legacy Tunnel with Cloudflare Load Balancer

This tutorial starts by documenting the steps to create a Legacy Tunnel with Cloudflare Load Balancer so that those can be compared to the migration steps. If you would prefer to start the migration now, skip to Create a Named Tunnel.

In both modes, the first step is to create a load balancer and endpoint pool.

1. Go to Load Balancing and select Create load balancer.
2. On the Load Balancer Setup, select Public load balancer
3. Choose the website to which you want to add this load balancer.
4. On the Hostname page:

Enter a Hostname, which is the DNS name at which the load balancer is available. For more details on record priority, refer to DNS records for load balancing.
Toggle the orange cloud icon to update the proxy mode, which affects how traffic is routed and which IP addresses are advertised.
If you want session-based load balancing, toggle the Session Affinity switch.
5. Enter a Hostname, which is the DNS name at which the load balancer is available. For more details on record priority, refer to DNS records for load balancing.
6. Toggle the orange cloud icon to update the proxy mode, which affects how traffic is routed and which IP addresses are advertised.
7. If you want session-based load balancing, toggle the Session Affinity switch.

Next, create an endpoint pool for the load balancer. A pool is a group of endpoints or origins, whether Cloudflare Tunnel connections or traditional IP addresses, used by the load balancer.

In Legacy mode, adding a new instance of cloudflared into a Load Balancer pool must be done from the command line tool itself. The cloudflared agent will start and create 4 separate connections, enrolling each of these into a load balancer pool.

Terminal window ```
cloudflared tunnel --hostname app.widgetcorp.tech --url http://localhost:8000 --lb-pool lisbon-data-center
```

For this example, the load balancer app.widgetcorp.tech would have a pool lisbon-data-center with endpoints similar to the following:

| Endpoint Name | Endpoint Address | Weight |
| --- | --- | --- |
| 0-51cc...d004 | tunnel:snf...aad | 1 |
| 1-51cc...d004 | tunnel:10x...x1b | 1 |
| 2-51cc...d004 | tunnel:yeq...y15 | 1 |
| 3-51cc...d004 | tunnel:vn6...7p6 | 1 |

However, the Legacy Tunnel mode has some downsides, including:

- You cannot manage these connections from the Cloudflare dashboard.
- When cloudflared restarts, it will attempt to register these connections as new connections which can lead to service disruption.

The Named Tunnel, documented below, model provides easier management and greater stability.

## Create a Named Tunnel

To migrate to the Named Tunnel model, first download and authenticate cloudflared. Install the agent within your environment in a location that can reach the service you plan to connect to Cloudflare.

To begin, create a Named Tunnel with the following command.

Terminal window ```
cloudflared tunnel create lisbon-app
```

This command will create a Tunnel object in your Cloudflare account that is represented by this instance of cloudflared. You can point DNS records or LB records to this connection when you run the Tunnel.

## Create a configuration file

Next, configure your Tunnel. The example below consists of a web service that is available at port 8000. The ingress rule will send traffic that cloudflared receives for the specified hostname to that port. You can also connect multiple services with a single instance of cloudflared.

In the configuration file, you must specify the location of the credentials file generated previously when you created the Tunnel.

Save the configuration file.

## Run the Tunnel

You can now run the Tunnel. Running the Tunnel will connect cloudflared to Cloudflare's edge in a connection only available to your account. You can use the Tunnel ID value to treat that connection like the IP address of an endpoint or origin, without the risk of someone reaching it directly and bypassing Cloudflare.

Run the following command, replacing lisbon-app with the name of your Tunnel.

Terminal window ```
cloudflared tunnel run lisbon-app
```

## Migrate the Load Balancer configuration

You can now begin migrating your Load Balancer deployment to use the new Named Tunnel. Create a new pool in the load balancer. Add a new endpoint to the list.

In the Endpoint Address field, input the ID of the tunnel followed by cfargotunnel.com.

In this example, the endpoint address value would be 6b9b8f72-b655-46fb-b008-a45366e26b48.cfargotunnel.com.

| Endpoint Name | Endpoint Address | Weight |
| --- | --- | --- |
| lisbon-data-center-one | 6b9b8f72-b655-46fb-b008-a45366e26b48.cfargotunnel.com | 1 |

Wait 1 minute while the new origin is recognized as healthy by Cloudflare Load Balancer. Once healthy, you can begin to disable the Legacy Argo Tunnel endpoints from the legacy Load Balancer pool.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## MongoDB SSH

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/mongodb-tunnel/](https://developers.cloudflare.com/cloudflare-one/tutorials/mongodb-tunnel/)

Page options # MongoDB SSH

Last reviewed: over 4 years ago You can build Zero Trust rules to secure connections to MongoDB deployments using Cloudflare Access and Cloudflare Tunnel. Cloudflare Tunnel requires a lightweight daemon, cloudflared, running alongisde the deployment and as on the client side.

In this tutorial, a client running cloudflared connects over SSH to a MongoDB deployment running on Kubernetes. The deployment example is structured to connect Compass ‚Üó to the MongoDB instance. The MongoDB Kubernetes deployment runs both the MongoDB database service and cloudflared as a ingress service that operates like a jump host.

This tutorial covers how to:

- Create a Cloudflare Access rule to secure a MongoDB deployment
- Configure a StatefulSet and service definition for the deployment
- Configure an Cloudflare Tunnel connection to Cloudflare's edge
- Create an SSH configuration file for the client

Time to complete:

50 minutes

## Configure Cloudflare Access

You can build a rule in Cloudflare Access to control who can connect to your MongoDB deployment. Cloudflare Access rules are built around a hostname; even though this deployment will be accessible over SSH, the resource will be represented in Cloudflare as a hostname. For example, if you have the website app.com in your Cloudflare account, you can build a rule to secure mongodb.app.com.

1. In Zero Trust ‚Üó, go to Access > Applications.
2. Select Add an application.
3. Select Self-hosted.
4. Enter any name for the application.
5. Select Add public hostname and enter the subdomain where users will connect to your deployment (for example, mongodb.app.com).
6. Add Access policies to control who can reach the deployment. You can build a policy that allows anyone in your organization to connect or you can build more granular policies based on signals like identity provider groups, multifactor method, or country.
7. Follow the remaining self-hosted application creation steps to publish the application.

## Configure the Kubernetes deployment

To be accessible over SSH, the Kubernetes deployment should manage both the MongoDB standalone service and an SSH proxy service. The configuration below will deploy 1 replica of the database service, available at port 27017, as well as an SSH proxy available at port 22.

StatefulSet Configuration

```
apiVersion: apps/v1kind: StatefulSetmetadata:  name: mongodb-standalone  namespace: mongodbspec:  serviceName: database  replicas: 1  selector:    matchLabels:      app: database  template:    metadata:      labels:        app: database        selector: mongodb-standalone    spec:      containers:        - name: mongodb-standalone          image: mongo          command: ["mongod"]          args: ["--config=/config/mongod.conf"]          ports:            - containerPort: 27017              protocol: TCP              name: mongod          volumeMounts:            - name: mongodb-conf              mountPath: /config              readOnly: true            - name: mongodb-data              mountPath: /data/db            - name: tls              mountPath: /etc/tls            - name: mongodb-socket              mountPath: /socket        - name: ssh-proxy          image: ubuntu:20.04          command: ["/scripts/entrypoint.sh"]          ports:            - containerPort: 22              protocol: TCP              name: ssh-port          volumeMounts:            - name: mongodb-socket              mountPath: /socket            - name: scripts              mountPath: /scripts              readOnly: true            - name: ssh-authorized-keys              mountPath: /config/ssh              readOnly: true          resources:            requests:              cpu: 20m              memory: 32Mi      volumes:        - name: mongodb-socket          emptyDir: {}        - name: mongodb-conf          configMap:            name: mongodb-standalone            items:              - key: mongod.conf                path: mongod.conf        - name: tls          secret:            secretName: tls        - name: mongodb-data          persistentVolumeClaim:            claimName: mongodb-standalone        - name: scripts          configMap:            name: scripts            items:              - key: entrypoint.sh                path: entrypoint.sh                mode: 0744        - name: ssh-authorized-keys          configMap:            name: ssh-proxy-config            items:              - key: authorized_keys                path: authorized_keys                mode: 0400
```

The corresponding service definition should also specify the ports and target ports for the containers (in this case, the database service and the SSH proxy service).

Service Definition

```
apiVersion: v1kind: Servicemetadata:  name: database  namespace: mongodb  labels:    app: databasespec:  clusterIP: None  selector:    app: database  ports:    - protocol: TCP      port: 27017      targetPort: 27017---apiVersion: v1kind: Servicemetadata:  name: ssh-proxy  namespace: mongodb  labels:    app: databasespec:  selector:    app: database  ports:    - protocol: TCP      port: 22      targetPort: 22
```

The MongoDB pod and the SSH jump host will share a Unix socket over an empty directory volume. The entrypoint.sh file run by the jump host, example below, will start an OpenSSH server.

```
#!/bin/shexport TZ=America/Chicagoln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezoneapt-get update -y && apt-get install -y openssh-servermkdir /root/.sshcp /config/ssh/authorized_keys /root/.ssh/authorized_keyschmod 400 /root/.ssh/authorized_keysservice ssh startwhile true;do sleep 30;done;
```

## Configure Cloudflare Tunnel

Next, you can use cloudflared to connect to Cloudflare's Edge using Cloudflare Tunnel. Start by downloading and installing the Cloudflare Tunnel daemon, cloudflared.

Once installed, run the following command to authenticate the instance of cloudflared into your Cloudflare account.

Terminal window ```
cloudflared login
```

The command will launch a browser window and prompt you to login with your Cloudflare account. Choose a website that you have added into your account.

Once you select one of the sites in your account, Cloudflare will download a certificate file, called cert.pem to authenticate this instance of cloudflared. The cert.pem file uses a certificate to authenticate your instance of cloudflared and includes an API key for your account to perform actions like DNS record changes.

You can now use cloudflared to control Cloudflare Tunnel connections in your Cloudflare account.

### Create a Tunnel

You can now create a Tunnel that will connect cloudflared to Cloudflare's edge. You'll configure the details of that Tunnel in the next step.

Run the following command to create a Tunnel. You can replace mongodb with any name that you choose. This command requires the cert.pem file.

cloudflared tunnel create mongodb

Cloudflare will create the Tunnel with that name and generate an ID and credentials file for that Tunnel.

### Delete the cert.pem file

The credentials file is separate from the cert.pem file. Unlike the cert.pem file, the credentials file consists of a token that authenticates only the Named Tunnel you just created. Formatted as JSON, the file cannot make changes to your Cloudflare account or create additional Tunnels.

If you are done creating Tunnels, you can delete the cert.pem file, leave only the credentials file, and continue to manage DNS records directly in the Cloudflare dashboard or API. For additional information on the different functions of the two files, refer to the list of useful terms.

Store the JSON file as a Kubernetes secret.

### Configure Cloudflare Tunnel

The previous setps used cloudflared to generate a credentials file for your Cloudflare account. When run as a service alongside the MongoDB Kubernetes deployment you will need to use a Docker image of cloudflared. Cloudflare makes an official image available ‚Üó in DockerHub.

The configuration below will run a single replica of cloudflared as an ingress point alongside the MongoDB and SSH proxy services. cloudflared will proxy traffic to the SSH proxy service. The cloudflared instance will run as its own deployment in a different namespace and, if network policy allows, ingress to any service in the Kubernetes node.

cloudflared Configuration

```
apiVersion: apps/v1kind: Deploymentmetadata:  name: dashboard-tunnel  namespace: argotunnel  labels:    app: dashboard-tunnelspec:  replicas: 1  selector:    matchLabels:      app: dashboard-tunnel  template:    metadata:      labels:        app: dashboard-tunnel    spec:      containers:        - name: dashboard-tunnel          # Image from https://hub.docker.com/r/cloudflare/cloudflared          image: cloudflare/cloudflared:2020.11.11          command: ["cloudflared", "tunnel"]          args: ["--config", "/etc/tunnel/config.yaml", "run"]          ports:            - containerPort: 5000          livenessProbe:            tcpSocket:              port: 5000            initialDelaySeconds: 60            periodSeconds: 60          volumeMounts:            - name: dashboard-tunnel-config              mountPath: /etc/tunnel            - name: tunnel-credentials              mountPath: /etc/credentials      volumes:        - name: dashboard-tunnel-config          configMap:            name: dashboard-tunnel-config        - name: tunnel-credentials          secret:            secretName: tunnel-credentials---apiVersion: v1kind: ConfigMapmetadata:  name: dashboard-tunnel-config  namespace: argotunneldata:  config.yaml: |    tunnel: 9a00ef26-4997-4de2-83db-631efc74245c    credentials-file: /etc/credentials/k8s-dashboard.json    metrics: :5000    protocol: http2    no-autoupdate: true    ingress:    - hostname: mongodb.widgetcorp.tech      originRequest:        bastionMode: true    - service: http_status:404
```

## Connect from a client

Once deployed, you can run cloudflared on the client side to connect to the MongoDB deployment. Add the following lines to your SSH configuration file, replacing the examples with your hostname and details. The --destination value should match the URL of the SSH Proxy service configured previously.

Terminal window ```
Host mongodb  ProxyCommand /usr/local/bin/cloudflared access ssh --hostname mongodb.widgetcorp.tech --destination ssh-proxy.mongodb.svc.cluster.local:22  LocalForward 27000 /socket/mongodb-27017.sock  User root  IdentityFile /Users/username/.ssh/id_rsa
```

This is a one-time step. When you next attempt to make an SSH connection to the deployment, cloudflared will launch a browser window and prompt you to authenticate. Once authenticated, you will be connected if you have a valid session. Once the tunnel is established, all requests to localhost:27000 on your machine will be forwarded to /socket/mongodb-27017.sock on the SSH proxy container.

You can then set MongoDB Compass to connect to localhost:27000.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Zero Trust GitLab SSH & HTTP

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/gitlab/](https://developers.cloudflare.com/cloudflare-one/tutorials/gitlab/)

Page options # Zero Trust GitLab SSH & HTTP

Last reviewed: over 4 years ago You can use Cloudflare Access to add Zero Trust rules to a self-hosted instance of GitLab. Combined with Cloudflare Tunnel, users can connect through HTTP and SSH and authenticate with your team's identity provider.

This walkthrough covers how to:

- Deploy an instance of GitLab
- Lock down all inbound connections to that instance and use Cloudflare Tunnel to set outbound connections to Cloudflare
- Build policies with Cloudflare Access to control who can reach GitLab
- Connect over HTTP and SSH through Cloudflare

Time to complete:

1 hour

## Deploying GitLab

This section walks through deploying GitLab in DigitalOcean. If you have already deployed GitLab, you can skip this section.

Create a Droplet that has 16 GB of RAM and 6 CPUs. This should make it possible to support 500 users, based on GitLab's resource recommendations ‚Üó.

GitLab will provide an external IP that is exposed to the Internet (for now). You will need to connect to the deployed server using this external IP for the initial configuration. You can secure connections to the IP by adding SSH keys ‚Üó to your DigitalOcean account.

This example uses a macOS machine to configure the Droplet. Copy the IP address assigned to the machine from DigitalOcean.

Open Terminal and run the following command, replacing the IP address with the IP assigned by DigitalOcean.

Terminal window ```
ssh root@134.209.124.123
```

Next, install GitLab. This example uses the Ubuntu package ‚Üó and the steps in the GitLab documentation, with a few exceptions called out below.

Run the following commands to begin.

Terminal window ```
sudo apt-get update
sudo apt-get install -y curl openssh-server ca-certificatescurl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash
```

The commands above download the GitLab software to this machine. You must now install it. This is the first place this tutorial will diverge from the operations in the GitLab documentation. The next step in the GitLab-provided tutorial sets an external hostname. Instead, you can just install the software.

Terminal window ```
sudo apt-get install gitlab-ee
```

After a minute or so, GitLab will be installed.

However, the application is not running yet. You can check to see what ports are listening to confirm by using ss.

Terminal window ```
sudo ss -lntup
```

The result should be only the services currently active on the machine:

Terminal window ```
sudo ss -lntup
```

```
Netid   State    Recv-Q   Send-Q     Local Address:Port     Peer Address:Port   Processudp     UNCONN   0        0                      *:9094                *:*tcp     LISTEN   0        128              0.0.0.0:22            0.0.0.0:*       users:(("sshd",pid=29,fd=3))tcp     LISTEN   0        128                 [::]:22               [::]:*       users:(("sshd",pid=29,fd=4))
```

To start GitLab, run the software's reconfigure command.

Terminal window ```
sudo gitlab-ctl reconfigure
```

GitLab will launch its component services. Once complete, confirm that GitLab is running and listening on both ports 22 and 80.

Terminal window ```
sudo ss -lntup
```

```
Netid   State    Recv-Q   Send-Q     Local Address:Port     Peer Address:Port   Processudp     UNCONN   0        0                      *:9094                *:*tcp     LISTEN   0        4096           127.0.0.1:9236          0.0.0.0:*tcp     LISTEN   0        4096           127.0.0.1:8150          0.0.0.0:*tcp     LISTEN   0        128              0.0.0.0:22            0.0.0.0:*       users:(("sshd",pid=29,fd=3))tcp     LISTEN   0        4096           127.0.0.1:8151          0.0.0.0:*tcp     LISTEN   0        4096           127.0.0.1:3000          0.0.0.0:*tcp     LISTEN   0        4096           127.0.0.1:8153          0.0.0.0:*tcp     LISTEN   0        4096           127.0.0.1:8154          0.0.0.0:*tcp     LISTEN   0        4096           127.0.0.1:8155          0.0.0.0:*tcp     LISTEN   0        511              0.0.0.0:8060          0.0.0.0:*       users:(("nginx",pid=324,fd=8))tcp     LISTEN   0        4096           127.0.0.1:9121          0.0.0.0:*tcp     LISTEN   0        4096           127.0.0.1:9090          0.0.0.0:*tcp     LISTEN   0        4096           127.0.0.1:9187          0.0.0.0:*tcp     LISTEN   0        4096           127.0.0.1:9093          0.0.0.0:*tcp     LISTEN   0        4096           127.0.0.1:9229          0.0.0.0:*tcp     LISTEN   0        1024           127.0.0.1:8080          0.0.0.0:*tcp     LISTEN   0        511              0.0.0.0:80            0.0.0.0:*       users:(("nginx",pid=324,fd=7))tcp     LISTEN   0        4096           127.0.0.1:9168          0.0.0.0:*tcp     LISTEN   0        4096           127.0.0.1:8082          0.0.0.0:*tcp     LISTEN   0        128                 [::]:22               [::]:*       users:(("sshd",pid=29,fd=4))tcp     LISTEN   0        4096                   *:9094                *:*
```

Users connect to GitLab over SSH (port 22 here) and HTTP for the web app (port 80). In the next step, you will make it possible for users to try both through Cloudflare Access. I'll leave this running and head over to the Cloudflare dashboard.

## Securing GitLab with Zero Trust rules

### Building Zero Trust policies

You can use Cloudflare Access to build Zero Trust rules to determine who can connect to both the web application of GitLab (HTTP) and who can connect over SSH.

When a user makes a request to a site protected by Access, that request hits Cloudflare's network first. Access can then check if the user is allowed to reach the application. When integrated with Cloudflare Tunnel, the Zero Trust architecture looks like this:

To determine who can reach the application, Cloudflare Access relies on integration with identity providers like Okta, Microsoft Entra ID, or Google to issue the identity cards that get checked at the door. While a VPN allows users free range on a private network unless someone builds an active rule to stop them, Access enforces that identity check on every request (and at any granularity configured).

For GitLab, start by building two policies. Users will connect to GitLab in a couple of methods: in the web app and over SSH. Create policies to secure a subdomain for each. First, the web app.

Before you build the rule, you'll need to follow these instructions to set up Cloudflare Access in your account.

Once enabled, go to the Applications page in Zero Trust. Select Add an application.

Choose self-hosted from the options presented.

In the policy builder, you will be prompted to add a subdomain that will represent the resource. This must be a subdomain of a domain in your Cloudflare account. You will need separate subdomains for the web application and SSH flows.

This example uses gitlab.widgetcorp.tech for the web application and gitlab-ssh.widgetcorp.tech for SSH connectivity.

While on this page, you can decide which identity providers will be allowed to authenticate. By default, all configured providers are allowed. Select Next to build rules to determine who can reach the application.

You can then add rules to determine who can reach the site.

Select Next and Next again on the Setup page - this example does not require advanced CORS configuration. Repeat these steps for the second application, gitlab-ssh.widgetcorp.tech.

## Cloudflare Tunnel

Cloudflare Tunnel creates a secure, outbound-only, connection between this machine and Cloudflare's network. With an outbound-only model, you can prevent any direct access to this machine and lock down any externally exposed points of ingress. And with that, no open firewall ports.

Cloudflare Tunnel is made possible through a lightweight daemon from Cloudflare called cloudflared. Download and install cloudflared on the DigitalOcean machine by following the instructions listed on the Downloads page.

Once installed, authenticate the instance of cloudflared with the following command.

Terminal window ```
cloudflared login
```

The command will print a URL that you must visit to login with your Cloudflare account.

Choose a website that you have added into your account.

Once you select one of the sites in your account, Cloudflare will download a certificate file to authenticate this instance of cloudflared. You can now use cloudflared to control Cloudflare Tunnel connections in your Cloudflare account.

### Connecting to Cloudflare

You can now connect GitLab to Cloudflare using Cloudflare Tunnel.

1. Create a new Tunnel by running the following command.

Terminal window ```
cloudflared tunnel create gitlab
```

cloudflared will generate a unique ID for this Tunnel, for example 6ff42ae2-765d-4adf-8112-31c55c1551ef. You can use this Tunnel both for SSH and HTTP traffic.

1. You will need to configure Cloudflare Tunnel to proxy traffic to both destinations. The configuration below will take traffic bound for the DNS record that will be created for the web app and the DNS record to represent SSH traffic to the right port.

You use the text editor of your choice to edit the configuration file. The example relies on Vi.

Terminal window ```
vim ~/.cloudflared/config.yml
```

1. Configure the Tunnel to serve traffic.

```
tunnel: 6ff42ae2-765d-4adf-8112-31c55c1551efcredentials-file: /root/.cloudflared/6ff42ae2-765d-4adf-8112-31c55c1551ef.json
ingress:  - hostname: gitlab.widgetcorp.tech    service: http://localhost:80  - hostname: gitlab-ssh.widgetcorp.tech    service: ssh://localhost:22  # Catch-all rule, which just responds with 404 if traffic doesn't match any of  # the earlier rules  - service: http_status:404
```

1. You can test that the configuration file is set correctly with the following command:

Terminal window ```
cloudflared tunnel ingress validate
```

cloudflared should indicate the Tunnel is okay. You can now begin running the Tunnel.

Terminal window ```
cloudflared tunnel run
```

Note

This command should be run as a systemd service for long-term use; if it terminates, GitLab will be unavailable.

### Configure DNS records

You can now create DNS records for GitLab in the Cloudflare dashboard. Remember, you will still need two records - one for the web application and one for SSH traffic.

In the DNS tab, choose the website where you built your Access policies. Select Add record and select CNAME from type. In the Name field, input gitlab. In the Target field, input the ID of the Tunnel created followed by cfargotunnel.com. In this example, that value is:

```
6ff42ae2-765d-4adf-8112-31c55c1551ef.cfargotunnel.com
```

Select Save. Repeat the process again by creating a second CNAME record, with the same Target, but input gitlab-ssh for the Name. Both records should then appear, pointing to the same Tunnel. The ingress rules defined in the configuration file above will direct traffic to the appropriate port.

### Connecting to the web application

You can now test the end-to-end configuration for the web application. Visit the subdomain created for the web application. Cloudflare Access will prompt you to authenticate. Login with your provider.

Once authenticated, you should see the GitLab web application.

Register your own account and create a Blank project to test SSH in the next step.

GitLab will create a new project and repository.

Note

To pull or push code, you must also add an SSH key to your profile in GitLab.

### Configuring SSH

To push and pull code over SSH, you will need to install cloudflared on the client machine as well. This example uses a macOS laptop. On macOS, you can install cloudflared with the following command.

Terminal window ```
brew install cloudflared
```

While you need to install cloudflared, you do not need to wrap your SSH commands in any unique way. Instead, you will need to make a one-time change to your SSH configuration file.

Terminal window ```
vim /Users/samrhea/.ssh/config
```

Input the following values; replacing gitlab-ssh.widgetcorp.tech with the hostname you created.

```
Host gitlab-ssh.widgetcorp.tech  ProxyCommand /usr/local/bin/cloudflared access ssh --hostname %h
```

You can now test the SSH flow by attempting to clone the project created earlier.

Terminal window ```
git clone git@gitlab-ssh.widgetcorp.tech:samrhea/demo
```

cloudflared will prompt you to login with my identity provider and, once successful, issue a token to your device to allow you to authenticate.

### Lock down exposed ports

You can now configure your DigitalOcean firewall with a single rule, block any inbound traffic, to prevent direct access.

Cloudflare Tunnel will continue to run outbound-only connections and I can avoid this machine getting caught up in a crypto mining operation, or something worse.

## View logs

You can also view logs of the events that are allowed and blocked. Open the Access page of the Logs section in Zero Trust.

## Troubleshooting

If you are using Git Large File Storage (LFS), note that Git LFS is not automatically supported by cloudflared. To access repositories protected by Cloudflare Access, you need to authenticate manually by running:

Terminal window ```
cloudflared access login <your-git-access-url>
```

Replace <your-git-access-url> with the Cloudflare Access-protected URL.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Require U2F with Okta

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/tutorials/okta-u2f/](https://developers.cloudflare.com/cloudflare-one/tutorials/okta-u2f/)

Page options # Require U2F with Okta

Last reviewed: almost 5 years ago Many identity providers, like Okta, support multiple multifactor authentication (MFA) options simultaneously. For example, Okta will allow you to login with your password and a temporary code generated in an app or a U2F hard key like a Yubikey.

Some second factor methods are more resistant to phishing. U2F options require you to have access to a physical device, also known as a hardware key. Without that key, a user cannot impersonate you even if they have your password. You can build rules in Cloudflare Access to require that users authenticate with a hardware key - even if your provider supports multiple options. When users login with a less secure option, like an app-based code, Access will block them.

This tutorial covers how to:

- Integrate Cloudflare Access with Okta
- Configure Okta for U2F enrollment
- Build an Access policy that require users login with a hardware key
- Specify that policy to apply to certain Access applications

The first two sections of this tutorial link to guides to set up Cloudflare Access and integrate Okta. If you already use Cloudflare Access with Okta, you can skip ahead to the fourth section.

Time to complete:

20 minutes

## Configure Cloudflare Access

Before you begin, you'll need to follow these instructions to set up Cloudflare Access in your account. The hardware key feature is available on any plan, including the free plan.

## Integrate Okta

Follow these instructions to integrate Okta with your Cloudflare Access account. Once integrated, Access will be able to apply rules using identity, group membership, and multifactor method from Okta.

## Configure Okta for U2F

An Okta administrator in your organization must first enable U2F support ‚Üó in your Okta account and configure users ‚Üó to be prompted for it. This is a global setting; if your account has already configured U2F, you do not need to do anything unique to use it with Cloudflare Access.

## Test U2F in Access

You can begin building U2F policies by testing your Okta integration.

In Zero Trust ‚Üó, go to the Settings > Authentication. Next, choose the row for Okta and select Test.

Cloudflare Access will prompt you to login with your Okta account. For the purposes of the test, use a second factor option like an app-based code. Okta will return amr values to Cloudflare Access - these are standard indicators of multifactor methods shared between identity control systems.

The mfa value is sent by Okta to tell Cloudflare Access that you used a multifactor authentication option. The pwd value indicates you used a password. In this example, the otp value is sent because the user authenticatd with an app-based code.

You can test with a hardkey by logging out of Okta and returning to the list of providers in Access. Select Test again, but this time use your hardware key as a second factor. Cloudflare Access will now see Okta share hwk in the amr fields.

## Build a Zero Trust policy to require U2F

You can use this information to build a rule in Access. Go to the Applications list in the Cloudflare Access section of the dashboard. Choose an application that you have already built or create a new one. This example adds the requirement to an existing application.

Select Edit to edit the existing Allow rule.

Add a Require rule and select Authentication Method from the list. Choose hwk as the required Authentication Method. Select Save rule.

Optional: you can also configure Cloudflare Access to only show users Okta for this application if you have multiple other providers integrated. In the Authentication Tab, choose Okta as the only option to show users.

## Testing the rule

You can now test the rule. Visit the application and attempt to login using an app-based code or method other than a hardware security key. Access will block the attempt.

If you sign out of Okta, and reattempt with a hardware key, Access will then allow the connection.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Getting started with Cloudflare Zero Trust FAQ

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/faq/getting-started-faq/](https://developers.cloudflare.com/cloudflare-one/faq/getting-started-faq/)

Page options # Getting started with Cloudflare Zero Trust FAQ

‚ùÆ Back to FAQ

## How do I sign up for Cloudflare Zero Trust?

You can sign up today at this link ‚Üó. Follow the onboarding steps, choose a team name and a payment plan, and start protecting your network in just a few minutes.

## What is a team domain/team name?

Your team domain is a unique subdomain assigned to your Cloudflare account, for example, <your-team-name>.cloudflareaccess.com. Setting up a team domain is an essential step in your Zero Trust configuration. This is where your users will find the apps you have secured behind Cloudflare Zero Trust ‚Äî displayed in the App Launcher ‚Äî and will be able to make login requests to them. The customizable portion of your team domain is called team name. You can view your team name and team domain in Zero Trust under Settings > Custom Pages.

| team name | team domain |
| --- | --- |
| your-team-name | <your-team-name>.cloudflareaccess.com |

You can change your team name at any time, unless you have the Cloudflare dashboard SSO feature enabled on your account. If Cloudflare dashboard SSO is enabled, you must turn off SSO before changing your team name.

Note

Once a team name has been used, even if the team domain is later deleted, the team name cannot be reused by any account. Once you delete a team name, you will not be able to use it again. Consider this limitation before changing or deleting your team name.

Warning

If you change your team name, you need to update your organization's identity providers (IdPs) and the WARP client to reflect the new team name in order to avoid any mismatch errors.

### Why is my old team name is still showing up on the Login page and App Launcher?

After changing your team name, you will need to check your Block page, Login page, and App Launcher settings to make sure the new team name is reflected.

To verify that your team name change is successfully rendering on the Block page, Login page and App Launcher:

1. In Zero Trust ‚Üó, go to Settings > Custom Pages.
2. Find the Account Gateway block page and Login page sections, then select Customize next to the page you would like to review first.
3. Review that the value in Your Organization's name matches your new team name.
4. If the desired name is not already displayed, change the value to your desired team name and select Save.
5. Check both pages (Account Gateway block page and Login page) to set Your Organization's name as your desired team name.

The App Launcher will display the same team name set on the Login page, so you do not need to update the Your Organization's name field in the App Launcher page.

## How do I change my subscription plan?

To make changes to your subscription, visit the Billing section under Account in Zero Trust ‚Üó. You can change or cancel your subscription at any time. Just remember - if you downgrade your plan during a billing cycle, your downgraded pricing will apply in the next billing cycle. If you upgrade during a billing cycle, you will be billed for the upgraded plan at the moment you select it.

## How are active seats measured?

Cloudflare Zero Trust subscriptions consist of seats that users in your account consume. When users authenticate to an application or enroll their agent into WARP, they count against one of your active seats. Seats can be added, removed, or revoked at Settings > Account > Plan. If all seats are currently consumed, you must first remove users before decreasing your purchased seat count.

### Removing users

User seats can be removed for Access and Gateway at My Team > Users. Removing a user will have consequences both on Access and on Gateway:

- Access: All active sessions for that user will be invalidated. A user will be able to log back into an application unless you create an Access policy to block future logins from that user.
- Gateway: All active devices for that user will be logged out of your Zero Trust organization, which stops all filtering and routing via the WARP client. A user will be able to re-enroll their device unless you create a device enrollment policy to block them.

Warning

The Remove action will remove a user's seat, but it will not permanently revoke their ability to authenticate. To permanently disable a user's ability to authenticate, you must modify the policies that allow them to reach a given application or enroll a device in WARP.

### Revoking users

The Revoke action will terminate active sessions and log out active devices, but will not remove the user's consumption of an active seat.

## How do I know if my network is protected behind Cloudflare Zero Trust?

You can visit the Zero Trust help page ‚Üó. This page will give you an overview of your network details, as well as an overview of the categories that are being blocked and/or allowed.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## General

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/faq/general-faq/](https://developers.cloudflare.com/cloudflare-one/faq/general-faq/)

Page options # General

‚ùÆ Back to FAQ

## What is the difference between Cloudflare Gateway and 1.1.1.1?

1.1.1.1 does not block any DNS query. When a browser requests for example.com, 1.1.1.1 simply looks up the answer either in cache or by performing a full recursive DNS query.

Cloudflare Gateway's DNS resolver introduces security into this flow. Instead of allowing all DNS queries, Gateway first checks the hostname being queried against the intelligence Cloudflare has about threats on the Internet. If that query matches a known threat, or is requesting a blocked domain configured by an administrator as part of a Gateway policy, Gateway stops it before the site could load for the user - and potentially execute code or phish that team member.

## Is multi-factor authentication supported?

Access is subjected to the MFA policies set in your identity provider. For example, users attempting to log in to an Access protected app might log in through Okta. Okta would enforce an MFA check before sending the valid authentication confirmation back to Cloudflare Access.

Access does not have an independent or out-of-band MFA feature.

## Which browsers are supported?

These browsers are supported:

- Internet Explorer 11
- Edge (current release, last release)
- Firefox (current release, last release)
- Chrome (current release, last release)
- Safari (current release, last release)

## What data localization services are supported?

Cloudflare Zero Trust can be used with the Data Localization Suite to ensure that traffic is only inspected in the regions you choose. For more information refer to Use Zero Trust with Data Localization Suite.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Identity FAQ

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/faq/authentication-faq/](https://developers.cloudflare.com/cloudflare-one/faq/authentication-faq/)

Page options # Identity FAQ

‚ùÆ Back to FAQ

## Can Access work with multiple identity providers at the same time?

Yes. Your team can simultaneously use multiple providers, reducing friction when working with partners or contractors. Get started by adding your preferred identity providers as login methods in Zero Trust. Then, when securing a new application behind Access, you'll be able to choose which providers you want your users to log in with to reach that application.

## What if the identity provider my team uses is not listed?

You can add your preferred identity providers to Cloudflare Access even if you do not see them listed in Zero Trust, as long as these providers support SAML 2.0 or OpenID Connect (OIDC).

## How do end users log out of an application protected by Access?

Access provides a URL that will end a user's current session.

To force log out of an Access application, go to:

<your-application-domain>/cdn-cgi/access/logout

To log out of an App Launcher session, go to:

<your-team-name>.cloudflareaccess.com/cdn-cgi/access/logout

For more information, refer to our session management page.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Policies FAQ

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/faq/policies-faq/](https://developers.cloudflare.com/cloudflare-one/faq/policies-faq/)

Page options # Policies FAQ

‚ùÆ Back to FAQ

## What is the order of policy enforcement?

Gateway and Access policies generally trigger from top to bottom based on their position in the policy table in the UI. Exceptions include Bypass and Service Auth policies, which Access evaluates first. Similarly, for Gateway HTTP policies, Do Not Inspect and Isolate policies take precedence over all Allow or Block policies. To learn more about order of enforcement, refer to our documentation for Access policies and Gateway policies.

## How can I bypass the L7 firewall for a website?

Cloudflare Gateway uses the hostname in the HTTP CONNECT header to identify the destination of the request. Administrators who wish to bypass a site must create a Do Not Inspect policy in order to prevent HTTP inspection from occurring on both encrypted and plaintext traffic.

Bypassing the L7 firewall results in no HTTP traffic inspection, and logging is disabled for that HTTP session.

## Can I secure applications with a second-level subdomain URL?

Yes. Ensure that your SSL certificates cover the first- and second-level subdomain. Most certificates only cover the first-level subdomain and not the second. This is true for most Cloudflare certificates. To cover a second-level subdomain with a CF certificate, create an advanced certificate.

Wildcard-based policies in Cloudflare Access only cover the level where they are applied. Add the wildcard policy to the left-most subdomain to be covered.

## How do isolation policies work together with HTTP policies?

Isolation policies, like all HTTP policies, are evaluated in stages. When a user makes a request which evaluates an Isolation policy, the request will be rerouted to an isolated browser and re-evaluated for HTTP policies. This makes it possible for an isolated browser to remotely render a block page, or have malicious content within the isolated browser blocked by HTTP policies.

## Why is API or CLI traffic not isolated?

Isolation policies are applied to requests that include Accept: text/html*. This allows Browser Isolation policies to co-exist with API and command line requests.

## Can Access enforce policies on a specific nonstandard port?

No. Cloudflare Access cannot enforce a policy that would contain a port appended to the URL. However, you can use Cloudflare Tunnel to point traffic to non-standard ports. For example, if Jira is available at port 8443 on your origin, you can proxy traffic to that port via Cloudflare Tunnel.

## Why can I still reach domains blocked by a Gateway policy?

If the domain is blocked by a DNS, network, or HTTP policy, it may be because:

- Your policy is still being updated. After you edit or create a policy, Cloudflare updates the new setting across all of our data centers around the world. It takes about 60 seconds for the change to propagate.

If the domain is only blocked by a DNS policy, it may be because:

- Your device is using another DNS resolver. If you have other DNS resolvers in your DNS settings, your device could be using IP addresses for resolvers that are not part of Gateway. As a result, the domain you are trying to block is still accessible from your device. Make sure to remove all other IP addresses from your DNS settings and only include Gateway's DNS resolver IP addresses.
- Your policy is not assigned to a DNS location. If your policy is not assigned to a DNS location and you send a DNS query from that location, Gateway will not apply that policy. Assign a policy to a DNS location to make sure the desired policy is applied when you send a DNS query from that location.
- Your DoH endpoint is not a Gateway DNS location. Browsers can be configured to use any DoH endpoint. If you chose to configure DoH directly in your browser, make sure that the DoH endpoint is a Gateway DNS location.

If the domain is only blocked by a network policy, it may be because:

- Your browser is reusing an existing connection. Network policies only apply when a connection is opened. If a browser is connected to a domain to be blocked by a network policy, Gateway will not block requests until the connection is closed. To block the domain, close any related tabs or restart your browser.

## When does Access return a Forbidden status page versus a login page?

Access returns a Forbidden page with status codes 401/403 when it determines there is no way a user can pass a policy. If Cloudflare can make a full policy determination that a user will not be able to log in, Access will return a Forbidden page instead of a login page.

For example, your application has a policy that requires a user to be in a specific geolocation to log in.

As admin, you could define this geolocation policy by using Include rules, meaning the user could log in to the application from Country A or Country B.

Or you could define this geolocation policy using a Require rule, meaning the user must be in Country A to log in.

If a user from country C attempts to access the application, in both the Include and Require scenarios, the user will receive the Forbidden page. This is because Country C was not defined in either scenario. Therefore, Cloudflare has determined that this user cannot meet policy requirements and will receive the Forbidden status page.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Devices FAQ

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/faq/devices-faq/](https://developers.cloudflare.com/cloudflare-one/faq/devices-faq/)

Page options # Devices FAQ

‚ùÆ Back to FAQ

## Why does my Windows device appear to switch from Wi-Fi to Ethernet when I enable WARP?

As the WARP client has replaced WinDivert with WinTun architecture, all Windows machines using WinTun will show as being connected using a virtual adapter. Windows, by default, shows virtual adapter connections with a wired Ethernet connection icon, even if the device is connected over wireless. This is by design and should have no impact on connectivity.

## Why is my device not connecting to a closer Cloudflare data center?

As our Network Map ‚Üó shows, we have locations all over the globe. However, in the Advanced Connection stats of our application, you may notice that the data center (colo) you are connecting to isn't necessarily the one physically closest to your location. This can be due to a number of reasons:

- Sometimes your nearest colo may be undergoing maintenance or having problems. Check the Cloudflare Status page ‚Üó for system status.
- Your Internet provider may choose to route traffic along an alternate path for reasons such as cost savings, reliability, or other infrastructure concerns.

## Why is my public IP address sometimes visible?

Cloudflare WARP Client in WARP mode was meant to ensure all your traffic is kept private between you and the origin (the site you are connecting to), but not from the origin itself. In a number of cases, if the origin site you are communicating with can't determine who you are and where you're from, they can't serve locale relevant content to you.
Sites inside Cloudflare network are able to see this information. If a site is showing you your IP address, chances are they are in our network. Most sites outside our network (orange clouded sites) however are unable to see this information and instead see the nearest egress colo to their server. We are working to see if in the future we can't find a way to more easily share this information with a limited number of gray clouded sites where it is relevant to both parties.

## Why has my throughput dropped while using WARP?

Cloudflare WARP is in part powered by 1.1.1.1. When visiting sites or going to a new location on the Internet, you should see blazing fast DNS lookups. However, WARP is built to trade some throughput for enhanced privacy, because it encrypts all traffic both to and from your device. While this isn't noticeable at most mobile speeds, on desktop systems in countries where high speed broadband is available, you may notice a drop. We think the tradeoff is worth it though and continue to work on improving performance all over the system.

## Why is my device not connecting to a public Wi-Fi?

The Wi-Fi network may have a captive portal that is blocking WARP from establishing a secure connection. In order to access the portal, and therefore the Internet, you will need to temporarily turn off WARP. After you login to the captive portal through your browser, you can turn WARP back on to access corporate resources.

For more information, refer to Captive portal detection.

## Why is my device not connecting to the Internet?

A third-party service or ISP may be blocking WARP, or Zero Trust settings may be misconfigured. For a list of common issues and steps to resolve, refer to our troubleshooting guide.

## Why is my device not connecting to the corporate Wi-Fi?

An OS firewall rule on the device may be blocking the EAP/Radius server that allows users to join the Wi-Fi network. If your corporate Wi-Fi uses a Radius server for network authentication, add the Radius server to your Split Tunnel Exclude list.

## Why is my device not connecting to my private network?

If your private network is exposed via Cloudflare Tunnel:

- Verify that the WARP client is properly configured on the device.
- Verify that the user is allowed through by your Access and Gateway policies.
- Verify that the local LAN settings for the device do not overlap with the CIDR range of your private network.

When contacting Cloudflare support, ensure that you include WARP debug logs for your device. These logs will help Cloudflare support understand the overall architecture of your machine and networks.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

## Cloudflare Tunnel

**‰æÜÊ∫ê**: [https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/](https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/)

Page options # Cloudflare Tunnel

Cloudflare Tunnel provides you with a secure way to connect your resources to Cloudflare without a publicly routable IP address. With Tunnel, you do not send traffic to an external IP ‚Äî instead, a lightweight daemon in your infrastructure (cloudflared) creates outbound-only connections to Cloudflare's global network. Cloudflare Tunnel can connect HTTP web servers, SSH servers, remote desktops, and other protocols safely to Cloudflare. This way, your origins can serve traffic through Cloudflare without being vulnerable to attacks that bypass Cloudflare.

Refer to our reference architecture for details on how to implement Cloudflare Tunnel into your existing infrastructure.

## How it works

Cloudflared establishes outbound connections (tunnels) between your resources and Cloudflare's global network. Tunnels are persistent objects that route traffic to DNS records. Within the same tunnel, you can run as many 'cloudflared' processes (connectors) as needed. These processes will establish connections to Cloudflare and send traffic to the nearest Cloudflare data center.

## Outbound-only connection

Cloudflare Tunnel uses an outbound-only connection model to enable bidirectional communication. When you install and run cloudflared, cloudflared initiates an outbound connection through your firewall from the origin to the Cloudflare global network.

Once the connection is established, traffic flows in both directions over the tunnel between your origin and Cloudflare. Most firewalls allow outbound traffic by default. cloudflared takes advantage of this standard by connecting out to the Cloudflare network from the server you installed cloudflared on. You can then configure your firewall to allow only these outbound connections and block all inbound traffic, effectively blocking access to your origin from anything other than Cloudflare. This setup ensures that all traffic to your origin is securely routed through the tunnel.

## Next steps

- Create a tunnel using the Cloudflare dashboard or API.
- Learn more about cloudflared, the server-side daemon that connects your infrastructure to Cloudflare.
- Review useful Tunnel terms to familiarize yourself with the concepts used in Tunnel documentation.
- Troubleshoot your Tunnel by reviewing available logs and common errors.

## Was this helpful?

- Resources
- API
- New to Cloudflare?
- Directory
- Sponsorships
- Open Source

- Support
- Help Center
- System Status
- Compliance
- GDPR

- Company
- cloudflare.com
- Our team
- Careers

- Tools
- Cloudflare Radar
- Speed Test
- Is BGP Safe Yet?
- RPKI Toolkit
- Certificate Transparency

- Community
- X
- Discord
- YouTube
- GitHub

- ¬© 2025 Cloudflare, Inc.
- Privacy Policy
- Terms of Use
- Report Security Issues
- Trademark
- Cookie Settings

---

